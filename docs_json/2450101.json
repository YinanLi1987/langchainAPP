{
    "page_content": "\nContents\nForeword\t27\n1\tScope\t28\n2\tReferences\t28\n3\tDefinitions and abbreviations\t33\n3.1\tDefinitions\t33\n3.2\tAbbreviations\t45\n4\tGeneral\t49\n4.1\tOverview\t49\n4.2\tCoordination between the protocols for 5GS mobility management and 5GS session management\t49\n4.3\tUE domain selection\t50\n4.3.1\tUE's usage setting\t50\n4.3.2\tDomain selection for UE originating sessions / calls\t50\n4.3.3\tChange of UE's usage setting\t52\n4.3.4\tChange or determination of IMS voice availability\t52\n4.4\tNAS security\t53\n4.4.1\tGeneral\t53\n4.4.2\tHandling of 5G NAS security contexts\t53\n4.4.2.1\tGeneral\t53\n4.4.2.1.1\tEstablishment of 5G NAS security context\t53\n4.4.2.1.2\tUE leaving state 5GMM-DEREGISTERED\t56\n4.4.2.1.3\tUE entering state 5GMM-DEREGISTERED\t56\n4.4.2.2\tEstablishment of a mapped 5G NAS security context during inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode\t56\n4.4.2.3\tEstablishment of a 5G NAS security context during N1 mode to N1 mode handover\t57\n4.4.2.4\tEstablishment of an EPS security context during inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode\t58\n4.4.2.5\tEstablishment of secure exchange of NAS messages\t59\n4.4.2.6\tChange of security keys\t61\n4.4.3\tHandling of NAS COUNT and NAS sequence number\t61\n4.4.3.1\tGeneral\t61\n4.4.3.2\tReplay protection\t62\n4.4.3.3\tIntegrity protection and verification\t62\n4.4.3.4\tCiphering and deciphering\t63\n4.4.3.5\tNAS COUNT wrap around\t63\n4.4.4\tIntegrity protection of NAS signalling messages\t64\n4.4.4.1\tGeneral\t64\n4.4.4.2\tIntegrity checking of NAS signalling messages in the UE\t64\n4.4.4.3\tIntegrity checking of NAS signalling messages in the AMF\t65\n4.4.5\tCiphering of NAS signalling messages\t67\n4.4.6\tProtection of initial NAS signalling messages\t67\n4.4.7\tProtection of NAS IEs\t69\n4.5\tUnified access control\t70\n4.5.1\tGeneral\t70\n4.5.2\tDetermination of the access identities and access category associated with a request for access for UEs not operating in SNPN access operation mode over 3GPP access\t72\n4.5.2A\tDetermination of the access identities and access category associated with a request for access for UEs operating in SNPN access operation mode over 3GPP access\t78\n4.5.3\tOperator-defined access categories\t84\n4.5.4\tAccess control and checking\t86\n4.5.4.1\tAccess control and checking in 5GMM-IDLE mode and in 5GMM-IDLE mode with suspend indication\t86\n4.5.4.2\tAccess control and checking in 5GMM-CONNECTED mode and in 5GMM-CONNECTED mode with RRC inactive indication\t88\n4.5.5\tException handling and avoiding double barring\t90\n4.5.6\tMapping between access categories/access identities and RRC establishment cause\t94\n4.6\tNetwork slicing\t96\n4.6.1\tGeneral\t96\n4.6.2\tMobility management aspects\t99\n4.6.2.1\tGeneral\t99\n4.6.2.2\tNSSAI storage\t100\n4.6.2.3\tProvision of NSSAI to lower layers in 5GMM-IDLE mode\t106\n4.6.2.4\tNetwork slice-specific authentication and authorization\t108\n4.6.2.5\tMobility management based network slice admission control\t110\n4.6.2.6\tProvision of NSAG information to lower layers\t111\n4.6.2.7\tMobility management based network slice replacement\t112\n4.6.2.8\tMobility management for optimised handling of temporarily available network slices\t113\n4.6.2.9\tMobility management based network slice usage control\t114\n4.6.2.10\tMobility management aspects of handling network slices with NS-AoS not matching deployed tracking areas\t115\n4.6.2.11\tMobility management for partial network slice\t116\n4.6.3\tSession management aspects\t117\n4.6.3.0\tGeneral\t117\n4.6.3.1\tSession management based network slice admission control\t117\n4.6.3.2\tSupport of network slice admission control and interworking with EPC\t118\n4.6.3.3\tSession management based network slice data rate limitation control\t118\n4.6.3.4\tSession management based network slice replacement\t118\n4.6.3.5\tSession management for optimized handling of temporarily available network slices\t119\n4.6.3.6\tSession management for partial network slice\t120\n4.6.3.7\tSession management aspect of handling network slices with NS-AoS not matching deployed tracking areas\t121\n4.7\tNAS over non-3GPP access\t121\n4.7.1\tGeneral\t121\n4.7.2\t5GS mobility management aspects\t121\n4.7.2.1\tGeneral\t121\n4.7.2.2\tEstablishment cause for non-3GPP access\t122\n4.7.3\t5GS session management aspects\t124\n4.7.4\tLimited service state over non-3GPP access\t124\n4.7.5\tNAS signalling using trusted WLAN access network\t124\n4.8\tInterworking with E-UTRAN connected to EPC\t125\n4.8.1\tGeneral\t125\n4.8.2\tSingle-registration mode\t125\n4.8.2.1\tGeneral\t125\n4.8.2.2\tSingle-registration mode with N26 interface\t125\n4.8.2.3\tSingle-registration mode without N26 interface\t125\n4.8.2.3.1\tInterworking between NG-RAN and E-UTRAN\t125\n4.8.2.3.2\tInterworking between TNGF or N3IWF connected to 5GCN and E-UTRAN\t127\n4.8.3\tDual-registration mode\t128\n4.8.4\tCore Network selection for UEs not using CIoT 5GS optimizations\t129\n4.8.4A\tCore Network selection and redirection for UEs using CIoT optimizations\t130\n4.8.4A.1\tCore network selection\t130\n4.8.4A.2\tRedirection of the UE by the core network\t130\n4.9\tDisabling and re-enabling of UE's N1 mode capability\t131\n4.9.1\tGeneral\t131\n4.9.2\tDisabling and re-enabling of UE's N1 mode capability for 3GPP access\t131\n4.9.3\tDisabling and re-enabling of UE's N1 mode capability for non-3GPP access\t134\n4.10\tInterworking with ePDG connected to EPC\t135\n4.11\tUE configuration parameter updates\t135\n4.12\tAccess traffic steering, switching and splitting (ATSSS)\t135\n4.13\tSupport of NAS signalling using wireline access network\t136\n4.14\tNon-public network (NPN)\t137\n4.14.1\tGeneral\t137\n4.14.2\tStand-alone non-public network (SNPN)\t137\n4.14.3\tPublic network integrated non-public network (PNI-NPN)\t140\n4.15\tTime synchronization and time sensitive communication\t141\n4.15.1\tGeneral\t141\n4.15.2\tVoid\t141\n4.15.2.1\tVoid\t141\n4.15.2.2\tVoid\t141\n4.15.2.3\tVoid\t141\n4.15.3\tTime synchronization\t141\n4.15.4\tUser plane node management\t142\n4.16\tUE radio capability signalling optimisation\t142\n4.17\t5GS mobility management in NB-N1 mode\t144\n4.18\t5GS session management in NB-N1 mode\t144\n4.19\t5GS mobility management in WB-N1 mode for IoT\t144\n4.20\t5GS session management in WB-N1 mode for IoT\t145\n4.21\tAuthentication and Key Management for Applications (AKMA)\t145\n4.22\tUncrewed aerial vehicle identification, authentication, and authorization\t146\n4.22.1\tGeneral\t146\n4.22.2\tAuthentication and authorization of UAV\t146\n4.22.3\tAuthorization of C2 communication\t147\n4.22.4\tVoid\t147\n4.23\tNAS over Non-Terrestrial Network\t147\n4.23.1\tGeneral\t147\n4.23.2\tList of \"PLMNs not allowed to operate at the present UE location\"\t147\n4.23.3\t5GS mobility management via a satellite NG-RAN cell\t148\n4.23.4\t5GS session management via a satellite NG-RAN cell\t149\n4.23.5\tHandling multiple tracking area codes from the lower layers\t149\n4.24\tMinimization of service interruption\t150\n4.25\tSupport of MUSIM features\t151\n4.26\tSupport for Personal IoT Network service\t152\n4.27\tMobile base station relay support\t153\n5\tElementary procedures for 5GS mobility management\t153\n5.1\tOverview\t153\n5.1.1\tGeneral\t153\n5.1.2\tTypes of 5GMM procedures\t153\n5.1.3\t5GMM sublayer states\t155\n5.1.3.1\tGeneral\t155\n5.1.3.2\t5GMM sublayer states\t155\n5.1.3.2.1\t5GMM sublayer states in the UE\t155\n5.1.3.2.1.1\tGeneral\t155\n5.1.3.2.1.2\tMain states\t155\n5.1.3.2.1.2.1\t5GMM-NULL\t155\n5.1.3.2.1.2.2\t5GMM-DEREGISTERED\t155\n5.1.3.2.1.2.3\t5GMM-REGISTERED-INITIATED\t155\n5.1.3.2.1.2.4\t5GMM-REGISTERED\t156\n5.1.3.2.1.2.5\t5GMM-DEREGISTERED-INITIATED\t156\n5.1.3.2.1.2.6\t5GMM-SERVICE-REQUEST-INITIATED\t156\n5.1.3.2.1.3\tSubstates of state 5GMM-DEREGISTERED\t156\n5.1.3.2.1.3.1\tGeneral\t156\n5.1.3.2.1.3.2\t5GMM-DEREGISTERED.NORMAL-SERVICE\t156\n5.1.3.2.1.3.3\t5GMM-DEREGISTERED.LIMITED-SERVICE\t156\n5.1.3.2.1.3.4\t5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION\t156\n5.1.3.2.1.3.5\t5GMM-DEREGISTERED.PLMN-SEARCH\t156\n5.1.3.2.1.3.6\t5GMM-DEREGISTERED.NO-SUPI\t157\n5.1.3.2.1.3.7\t5GMM-DEREGISTERED.NO-CELL-AVAILABLE\t157\n5.1.3.2.1.3.8\t5GMM-DEREGISTERED.eCALL-INACTIVE\t157\n5.1.3.2.1.3.9\t5GMM-DEREGISTERED.INITIAL-REGISTRATION-NEEDED\t157\n5.1.3.2.1.4\tSubstates of state 5GMM-REGISTERED\t157\n5.1.3.2.1.4.1\tGeneral\t157\n5.1.3.2.1.4.2\t5GMM-REGISTERED.NORMAL-SERVICE\t157\n5.1.3.2.1.4.3\t5GMM-REGISTERED.NON-ALLOWED-SERVICE\t158\n5.1.3.2.1.4.4\t5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE\t158\n5.1.3.2.1.4.5\t5GMM-REGISTERED.LIMITED-SERVICE\t158\n5.1.3.2.1.4.6\t5GMM-REGISTERED.PLMN-SEARCH\t158\n5.1.3.2.1.4.7\t5GMM-REGISTERED.NO-CELL-AVAILABLE\t158\n5.1.3.2.1.4.8\t5GMM-REGISTERED.UPDATE-NEEDED\t158\n5.1.3.2.2\t5GS update status in the UE\t159\n5.1.3.2.3\t5GMM sublayer states in the network side\t159\n5.1.3.2.3.1\tGeneral\t159\n5.1.3.2.3.2\t5GMM-DEREGISTERED\t160\n5.1.3.2.3.3\t5GMM-COMMON-PROCEDURE-INITIATED\t160\n5.1.3.2.3.4\t5GMM-REGISTERED\t160\n5.1.3.2.3.5\t5GMM-DEREGISTERED-INITIATED\t160\n5.1.4\tCoordination between 5GMM and EMM\t160\n5.1.4.1\tGeneral\t160\n5.1.4.2\tCoordination between 5GMM for 3GPP access and EMM with N26 interface\t161\n5.1.4.3\tCoordination between 5GMM for 3GPP access and EMM without N26 interface\t161\n5.1.5\tCoordination between 5GMM and GMM\t162\n5.2\tBehaviour of the UE in state 5GMM-DEREGISTERED and state 5GMM-REGISTERED\t162\n5.2.1\tGeneral\t162\n5.2.2\tUE behaviour in state 5GMM-DEREGISTERED\t162\n5.2.2.1\tGeneral\t162\n5.2.2.2\tPrimary substate selection\t162\n5.2.2.2.1\tSelection of the substate after power on\t162\n5.2.2.3\tDetailed description of UE behaviour in state 5GMM-DEREGISTERED\t163\n5.2.2.3.1\tNORMAL-SERVICE\t163\n5.2.2.3.2\tLIMITED-SERVICE\t163\n5.2.2.3.3\tATTEMPTING-REGISTRATION\t163\n5.2.2.3.4\tPLMN-SEARCH\t165\n5.2.2.3.5\tNO-SUPI\t165\n5.2.2.3.6\tNO-CELL-AVAILABLE\t165\n5.2.2.3.7\teCALL-INACTIVE\t165\n5.2.2.3.8\tINITIAL-REGISTRATION-NEEDED\t165\n5.2.2.4\tSubstate when back to state 5GMM-DEREGISTERED from another 5GMM state\t165\n5.2.3\tUE behaviour in state 5GMM-REGISTERED\t166\n5.2.3.1\tGeneral\t166\n5.2.3.2\tDetailed description of UE behaviour in state 5GMM-REGISTERED\t166\n5.2.3.2.1\tNORMAL-SERVICE\t166\n5.2.3.2.2\tNON-ALLOWED-SERVICE\t166\n5.2.3.2.3\tATTEMPTING-REGISTRATION-UPDATE\t166\n5.2.3.2.4\tLIMITED-SERVICE\t168\n5.2.3.2.5\tPLMN-SEARCH\t168\n5.2.3.2.6\tNO-CELL-AVAILABLE\t169\n5.2.3.2.7\tUPDATE-NEEDED\t169\n5.3\tGeneral on elementary 5GMM procedures\t169\n5.3.1\t5GMM modes and N1 NAS signalling connection\t169\n5.3.1.1\tEstablishment of the N1 NAS signalling connection\t169\n5.3.1.2\tRe-establishment of the N1 NAS signalling connection\t171\n5.3.1.3\tRelease of the N1 NAS signalling connection\t172\n5.3.1.4\t5GMM-CONNECTED mode with RRC inactive indication\t177\n5.3.1.5\tSuspend and resume of the N1 NAS signalling connection\t180\n5.3.2\tPermanent identifiers\t181\n5.3.3\tTemporary identities\t184\n5.3.4\tRegistration areas\t185\n5.3.5\tService area restrictions\t186\n5.3.5.1\tGeneral\t186\n5.3.5.2\t3GPP access service area restrictions\t186\n5.3.5.3\tWireline access service area restrictions\t191\n5.3.6\tMobile initiated connection only mode\t192\n5.3.7\tHandling of the periodic registration update timer and mobile reachable timer\t194\n5.3.8\tHandling of timer T3502\t196\n5.3.9\tHandling of NAS level mobility management congestion control\t196\n5.3.10\tHandling of DNN based congestion control\t197\n5.3.11\tHandling of S-NSSAI based congestion control\t198\n5.3.12\tHandling of local emergency numbers\t198\n5.3.12A\tHandling of local emergency numbers received via 3GPP access and non-3GPP access\t199\n5.3.12A.1\tGeneral\t199\n5.3.12A.2\tReceiving a REGISTRATION ACCEPT message via non-3GPP access\t199\n5.3.13\tLists of 5GS forbidden tracking areas\t200\n5.3.13A\tForbidden PLMN lists\t201\n5.3.14\tList of equivalent PLMNs\t202\n5.3.14A\tList of equivalent SNPNs\t202\n5.3.15\tTransmission failure abnormal case in the UE\t203\n5.3.16\tExtended DRX cycle for UEs in 5GMM-IDLE and 5GMM-CONNECTED mode with RRC inactive indication\t203\n5.3.17\tService Gap Control\t204\n5.3.18\tRestriction on use of enhanced coverage\t206\n5.3.19\tHandling of congestion control for transport of user data via the control plane\t206\n5.3.19A\tSpecific requirements for UE configured to use timer T3245\t207\n5.3.19A.1\tUE not operating in SNPN access operation mode\t207\n5.3.19A.2\tUE operating in SNPN access operation mode\t207\n5.3.20\tSpecific requirements for UE when receiving non-integrity protected reject messages\t208\n5.3.20.1\tGeneral\t208\n5.3.20.2\tRequirements for UE in a PLMN\t208\n5.3.20.3\tRequirements for UE in an SNPN\t213\n5.3.21\tCIoT 5GS optimizations\t217\n5.3.22\tInteraction between MICO mode with active time and extended idle mode DRX cycle\t219\n5.3.23\tForbidden wireline access area\t220\n5.3.24\tWUS assistance\t220\n5.3.25\tPaging Early Indication with Paging Subgrouping Assistance\t221\n5.3.26\tSupport for unavailability period\t222\n5.4\t5GMM common procedures\t223\n5.4.1\tPrimary authentication and key agreement procedure\t223\n5.4.1.1\tGeneral\t223\n5.4.1.2\tEAP based primary authentication and key agreement procedure\t223\n5.4.1.2.1\tGeneral\t223\n5.4.1.2.2\tEAP-AKA' related procedures\t226\n5.4.1.2.3\tEAP-TLS related procedures\t233\n5.4.1.2.3A\tProcedures related to EAP methods other than EAP-AKA' and EAP-TLS\t237\n5.4.1.2.3B\tProcedures related to EAP methods used for primary authentication of an N5GC device\t241\n5.4.1.2.3C\tProcedures related to EAP methods used for primary authentication of an AUN3 device\t243\n5.4.1.2.4\tEAP message reliable transport procedure\t244\n5.4.1.2.4.3\tEAP message reliable transport procedure accepted by the UE\t245\n5.4.1.2.4.4\tAbnormal cases on the network side\t245\n5.4.1.2.4.5\tAbnormal cases in the UE\t245\n5.4.1.2.5\tEAP result message transport procedure\t247\n5.4.1.3\t5G AKA based primary authentication and key agreement procedure\t249\n5.4.1.3.1\tGeneral\t249\n5.4.1.3.2\tAuthentication initiation by the network\t249\n5.4.1.3.3\tAuthentication response by the UE\t250\n5.4.1.3.4\tAuthentication completion by the network\t251\n5.4.1.3.5\tAuthentication not accepted by the network\t251\n5.4.1.3.6\tAuthentication not accepted by the UE\t254\n5.4.1.3.7\tAbnormal cases\t254\n5.4.2\tSecurity mode control procedure\t259\n5.4.2.1\tGeneral\t259\n5.4.2.2\tNAS security mode control initiation by the network\t259\n5.4.2.3\tNAS security mode command accepted by the UE\t262\n5.4.2.4\tNAS security mode control completion by the network\t265\n5.4.2.5\tNAS security mode command not accepted by the UE\t266\n5.4.2.6\tAbnormal cases in the UE\t266\n5.4.2.7\tAbnormal cases on the network side\t266\n5.4.3\tIdentification procedure\t267\n5.4.3.1\tGeneral\t267\n5.4.3.2\tIdentification initiation by the network\t267\n5.4.3.3\tIdentification response by the UE\t267\n5.4.3.4\tIdentification completion by the network\t268\n5.4.3.5\tAbnormal cases in the UE\t268\n5.4.3.6\tAbnormal cases on the network side\t268\n5.4.4\tGeneric UE configuration update procedure\t269\n5.4.4.1\tGeneral\t269\n5.4.4.2\tGeneric UE configuration update procedure initiated by the network\t273\n5.4.4.3\tGeneric UE configuration update accepted by the UE\t280\n5.4.4.4\tGeneric UE configuration update completion by the network\t287\n5.4.4.5\tAbnormal cases in the UE\t288\n5.4.4.6\tAbnormal cases on the network side\t289\n5.4.5\tNAS transport procedure(s)\t291\n5.4.5.1\tGeneral\t291\n5.4.5.2\tUE-initiated NAS transport procedure\t291\n5.4.5.2.1\tGeneral\t291\n5.4.5.2.2\tUE-initiated NAS transport procedure initiation\t292\n5.4.5.2.3\tUE-initiated NAS transport of messages accepted by the network\t294\n5.4.5.2.4\tUE-initiated NAS transport of messages not accepted by the network\t300\n5.4.5.2.5\tAbnormal cases on the network side\t302\n5.4.5.2.6\tAbnormal cases in the UE\t308\n5.4.5.3\tNetwork-initiated NAS transport procedure\t310\n5.4.5.3.1\tGeneral\t310\n5.4.5.3.2\tNetwork-initiated NAS transport procedure initiation\t311\n5.4.5.3.3\tNetwork-initiated NAS transport of messages\t316\n5.4.6\t5GMM status procedure\t322\n5.4.6.1\tGeneral\t322\n5.4.6.2\t5GMM status received in the UE\t322\n5.4.6.3\t5GMM status received in the network\t322\n5.4.7\tNetwork slice-specific authentication and authorization procedure\t322\n5.4.7.1\tGeneral\t322\n5.4.7.2\tNetwork slice-specific EAP message reliable transport procedure\t324\n5.4.7.2.1\tNetwork slice-specific EAP message reliable transport procedure initiation\t324\n5.4.7.2.2\tNetwork slice-specific EAP message reliable transport procedure accepted by the UE\t324\n5.4.7.2.3\tAbnormal cases on the network side\t324\n5.4.7.2.4\tAbnormal cases in the UE\t325\n5.4.7.3\tNetwork slice-specific EAP result message transport procedure\t326\n5.4.7.3.1\tNetwork slice-specific EAP result message transport procedure initiation\t326\n5.5\t5GMM specific procedures\t327\n5.5.1\tRegistration procedure\t327\n5.5.1.1\tGeneral\t327\n5.5.1.2\tRegistration procedure for initial registration\t328\n5.5.1.2.1\tGeneral\t328\n5.5.1.2.2\tInitial registration initiation\t328\n5.5.1.2.3\t5GMM common procedure initiation\t339\n5.5.1.2.4\tInitial registration accepted by the network\t339\n5.5.1.2.5\tInitial registration not accepted by the network\t366\n5.5.1.2.6\tInitial registration for emergency services not accepted by the network\t381\n5.5.1.2.6A\tInitial registration for initiating an emergency PDU session not accepted by the network\t383\n5.5.1.2.7\tAbnormal cases in the UE\t383\n5.5.1.2.8\tAbnormal cases on the network side\t386\n5.5.1.3\tRegistration procedure for mobility and periodic registration update\t388\n5.5.1.3.1\tGeneral\t388\n5.5.1.3.2\tMobility and periodic registration update initiation\t389\n5.5.1.3.3\t5GMM common procedure initiation\t405\n5.5.1.3.4\tMobility and periodic registration update accepted by the network\t406\n5.5.1.3.5\tMobility and periodic registration update not accepted by the network\t441\n5.5.1.3.6\tMobility and periodic registration update for initiating an emergency PDU session not accepted by the network\t458\n5.5.1.3.6A\tMobility and periodic registration update for an emergency services fallback not accepted by the network\t458\n5.5.1.3.7\tAbnormal cases in the UE\t459\n5.5.1.3.8\tAbnormal cases on the network side\t463\n5.5.2\tDe-registration procedure\t466\n5.5.2.1\tGeneral\t466\n5.5.2.2\tUE-initiated de-registration procedure\t468\n5.5.2.2.1\tUE-initiated de-registration procedure initiation\t468\n5.5.2.2.2\tUE-initiated de-registration procedure completion\t469\n5.5.2.2.3\tUE-initiated de-registration procedure completion for 5GS services over 3GPP access\t469\n5.5.2.2.4\tUE-initiated de-registration procedure completion for 5GS services over non-3GPP access\t470\n5.5.2.2.5\tUE-initiated de-registration procedure completion for 5GS services over both 3GPP access and non-3GPP access\t470\n5.5.2.2.6\tAbnormal cases in the UE\t470\n5.5.2.2.7\tAbnormal cases in the network side\t473\n5.5.2.3\tNetwork-initiated de-registration procedure\t474\n5.5.2.3.1\tNetwork-initiated de-registration procedure initiation\t474\n5.5.2.3.2\tNetwork-initiated de-registration procedure completion by the UE\t475\n5.5.2.3.3\tNetwork-initiated de-registration procedure completion by the network\t488\n5.5.2.3.4\tAbnormal cases in the UE\t488\n5.5.2.3.5\tAbnormal cases in the network side\t488\n5.5.3\teCall inactivity procedure\t490\n5.5.4\tAuthentication and key agreement procedure for 5G ProSe UE-to-network relay and 5G ProSe UE-to-UE relay\t490\n5.5.4.1\tGeneral\t490\n5.5.4.2\tProSe relay transaction identity (PRTI)\t492\n5.5.4.3\tUE-initiated authentication and key agreement procedure initiation\t492\n5.5.4.4\tUE-initiated authentication and key agreement procedure accepted by the network\t492\n5.5.4.5\tUE-initiated authentication and key agreement procedure not accepted by the network\t493\n5.5.4.6\tAbnormal cases in the UE\t493\n5.5.4.7\tAbnormal cases on the network side\t494\n5.6\t5GMM connection management procedures\t494\n5.6.1\tService request procedure\t494\n5.6.1.1\tGeneral\t494\n5.6.1.2\tService request procedure initiation\t499\n5.6.1.2.1\tUE is not using 5GS services with control plane CIoT 5GS optimization\t499\n5.6.1.2.2\tUE is using 5GS services with control plane CIoT 5GS optimization\t502\n5.6.1.3\tCommon procedure initiation\t504\n5.6.1.4\tService request procedure accepted by the network\t505\n5.6.1.4.1\tUE is not using 5GS services with control plane CIoT 5GS optimization\t505\n5.6.1.4.2\tUE is using 5GS services with control plane CIoT 5GS optimization\t509\n5.6.1.5\tService request procedure not accepted by the network\t514\n5.6.1.6\tService request procedure for initiating an emergency PDU session not accepted by the network\t526\n5.6.1.6A\tService request procedure for an emergency services fallback not accepted by the network\t527\n5.6.1.7\tAbnormal cases in the UE\t527\n5.6.1.8\tAbnormal cases on the network side\t532\n5.6.2\tPaging procedure\t533\n5.6.2.1\tGeneral\t533\n5.6.2.2\tPaging for 5GS services\t534\n5.6.2.2.1\tGeneral\t534\n5.6.2.2.2\tAbnormal cases on the network side\t536\n5.6.2.2.3\tAbnormal cases in the UE\t536\n5.6.3\tNotification procedure\t536\n5.6.3.1\tGeneral\t536\n5.6.3.2\tNotification procedure initiation\t537\n5.6.3.3\tNotification procedure completion\t539\n5.6.3.4\tAbnormal cases on the network side\t540\n5.6.3.5\tAbnormal cases on the UE side\t541\n6\tElementary procedures for 5GS session management\t541\n6.1\tOverview\t541\n6.1.1\tGeneral\t541\n6.1.2\tTypes of 5GSM procedures\t542\n6.1.3\t5GSM sublayer states\t542\n6.1.3.1\tGeneral\t542\n6.1.3.2\t5GSM sublayer states in the UE\t542\n6.1.3.2.1\tOverview\t542\n6.1.3.2.2\tPDU SESSION INACTIVE\t543\n6.1.3.2.3\tPDU SESSION ACTIVE PENDING\t543\n6.1.3.2.4\tPDU SESSION ACTIVE\t543\n6.1.3.2.5\tPDU SESSION INACTIVE PENDING\t543\n6.1.3.2.6\tPDU SESSION MODIFICATION PENDING\t543\n6.1.3.2.7\tPROCEDURE TRANSACTION INACTIVE\t543\n6.1.3.2.8\tPROCEDURE TRANSACTION PENDING\t543\n6.1.3.3\t5GSM sublayer states in the network side\t544\n6.1.3.3.1\tOverview\t544\n6.1.3.3.2\tPDU SESSION INACTIVE\t544\n6.1.3.3.3\tPDU SESSION ACTIVE\t544\n6.1.3.3.4\tPDU SESSION INACTIVE PENDING\t544\n6.1.3.3.5\tPDU SESSION MODIFICATION PENDING\t545\n6.1.3.3.6\tPROCEDURE TRANSACTION INACTIVE\t545\n6.1.3.3.7\tPROCEDURE TRANSACTION PENDING\t545\n6.1.4\tCoordination between 5GSM and ESM\t545\n6.1.4.1\tCoordination between 5GSM and ESM with N26 interface\t545\n6.1.4.2\tCoordination between 5GSM and ESM without N26 interface\t559\n6.1.4a\tCoordination between 5GSM and SM\t561\n6.1.5\tCoordination for interworking with ePDG connected to EPC\t561\n6.2\tGeneral on elementary 5GSM procedures\t562\n6.2.1\tPrinciples of PTI handling for 5GSM procedures\t562\n6.2.2\tPDU session types\t564\n6.2.3\tPDU session management\t564\n6.2.4\tIP address allocation\t565\n6.2.4.1\tGeneral\t565\n6.2.4.2\tIP address allocation via NAS signalling\t565\n6.2.4.2a\tIPv6 prefix delegation via DHCPv6\t566\n6.2.4.3\tAdditional RG related requirements for IP address allocation\t566\n6.2.4.4\tAdditional requirements of the UE acting as 5G ProSe layer-3 UE-to-network relay UE for IP address allocation\t567\n6.2.5\tQuality of service\t567\n6.2.5.1\tGeneral\t567\n6.2.5.1.1\tQoS rules\t567\n6.2.5.1.1.1\tGeneral\t567\n6.2.5.1.1.2\tSignalled QoS rules\t567\n6.2.5.1.1.3\tDerived QoS rules\t569\n6.2.5.1.1.4\tQoS flow descriptions\t569\n6.2.5.1.2\tSession-AMBR\t570\n6.2.5.1.2A\tVoid\t570\n6.2.5.1.3\tUL user data packet matching\t570\n6.2.5.1.4\tReflective QoS\t571\n6.2.5.1.4.1\tGeneral\t571\n6.2.5.1.4.2\tDerivation of packet filter for UL direction from DL user data packet\t571\n6.2.5.1.4.3\tCreating a derived QoS rule by reflective QoS in the UE\t573\n6.2.5.1.4.4\tUpdating a derived QoS rule by reflective QoS in the UE\t573\n6.2.5.1.4.5\tDeleting a derived QoS rule in the UE\t574\n6.2.5.1.4.6\tIgnoring RQI in the UE\t574\n6.2.5.2\tQoS in MA PDU session\t574\n6.2.6\tLocal area data network (LADN)\t574\n6.2.7\tHandling of DNN based congestion control\t576\n6.2.8\tHandling of S-NSSAI based congestion control\t577\n6.2.9\tInteraction with upper layers\t581\n6.2.9.1\tGeneral\t581\n6.2.9.2\tURSP\t581\n6.2.9.3\tProSeP\t581\n6.2.10\tHandling of 3GPP PS data off\t582\n6.2.11\tMulti-homed IPv6 PDU session\t583\n6.2.12\tHandling of network rejection not due to congestion control\t583\n6.2.13\tHandling of Small data rate control\t585\n6.2.14\tHandling of Serving PLMN rate control\t586\n6.2.15\tHandling of Reliable Data Service\t587\n6.2.16\tHandling of header compression for control plane CIoT optimizations\t587\n6.2.17\tHandling of edge computing enhancements\t587\n6.2.18\tSupport of redundant PDU sessions\t588\n6.2.19\tHandling of maximum group data rate limitation control\t588\n6.2.20\tSupport of UL PDU set handling\t589\n6.3\tNetwork-requested 5GSM procedures\t589\n6.3.1\tPDU session authentication and authorization procedure\t589\n6.3.1.1\tGeneral\t589\n6.3.1.2\tPDU EAP message reliable transport procedure\t591\n6.3.1.2.1\tPDU EAP message reliable transport procedure initiation\t591\n6.3.1.2.2\tPDU EAP message reliable transport procedure accepted by the UE\t593\n6.3.1.2.3\tAbnormal cases on the network side\t593\n6.3.1.2.4\tAbnormal cases in the UE\t594\n6.3.1.3\tPDU EAP result message transport procedure\t594\n6.3.1.3.1\tPDU EAP result message transport procedure initiation\t594\n6.3.1.3.2\tAbnormal cases in the UE\t594\n6.3.1A\tService-level authentication and authorization procedure\t595\n6.3.1A.1\tGeneral\t595\n6.3.1A.2\tService-level authentication and authorization procedure initiation\t596\n6.3.1A.3\tService-level authentication and authorization procedure accepted by the UE\t598\n6.3.1A.4\tAbnormal cases on the network side\t598\n6.3.1A.5\tAbnormal cases in the UE\t598\n6.3.2\tNetwork-requested PDU session modification procedure\t599\n6.3.2.1\tGeneral\t599\n6.3.2.2\tNetwork-requested PDU session modification procedure initiation\t599\n6.3.2.3\tNetwork-requested PDU session modification procedure accepted by the UE\t605\n6.3.2.4\tNetwork-requested PDU session modification procedure not accepted by the UE\t614\n6.3.2.5\tAbnormal cases on the network side\t619\n6.3.2.6\tAbnormal cases in the UE\t621\n6.3.3\tNetwork-requested PDU session release procedure\t621\n6.3.3.1\tGeneral\t621\n6.3.3.2\tNetwork-requested PDU session release procedure initiation\t621\n6.3.3.3\tNetwork-requested PDU session release procedure accepted by the UE\t624\n6.3.3.4\tN1 SM delivery skipped\t641\n6.3.3.5\tAbnormal cases on the network side\t641\n6.3.3.6\tAbnormal cases in the UE\t641\n6.4\tUE-requested 5GSM procedures\t642\n6.4.1\tUE-requested PDU session establishment procedure\t642\n6.4.1.1\tGeneral\t642\n6.4.1.2\tUE-requested PDU session establishment procedure initiation\t643\n6.4.1.3\tUE-requested PDU session establishment procedure accepted by the network\t655\n6.4.1.4\tUE-requested PDU session establishment procedure not accepted by the network\t671\n6.4.1.4.1\tGeneral\t671\n6.4.1.4.2\tHandling of network rejection due to congestion control\t674\n6.4.1.4.3\tHandling of network rejection not due to congestion control\t686\n6.4.1.5\tHandling the maximum number of established PDU sessions\t697\n6.4.1.5A\tHandling the maximum number of allowed active user-plane resources for PDU sessions of UEs in NB-N1 mode\t698\n6.4.1.6\tAbnormal cases in the UE\t698\n6.4.1.7\tAbnormal cases on the network side\t701\n6.4.2\tUE-requested PDU session modification procedure\t702\n6.4.2.1\tGeneral\t702\n6.4.2.2\tUE-requested PDU session modification procedure initiation\t703\n6.4.2.3\tUE-requested PDU session modification procedure accepted by the network\t709\n6.4.2.4\tUE-requested PDU session modification procedure not accepted by the network\t709\n6.4.2.4.1\tGeneral\t709\n6.4.2.4.2\tHandling of network rejection due to congestion control\t711\n6.4.2.4.3\tHandling of network rejection not due to congestion control\t723\n6.4.2.5\tAbnormal cases in the UE\t727\n6.4.2.6\tAbnormal cases on the network side\t729\n6.4.3\tUE-requested PDU session release procedure\t730\n6.4.3.1\tGeneral\t730\n6.4.3.2\tUE-requested PDU session release procedure initiation\t730\n6.4.3.3\tUE-requested PDU session release procedure accepted by the network\t731\n6.4.3.4\tUE-requested PDU session release procedure not accepted by the network\t731\n6.4.3.5\tAbnormal cases in the UE\t731\n6.4.3.6\tAbnormal cases on the network side\t733\n6.5\t5GSM status procedure\t733\n6.5.1\tGeneral\t733\n6.5.2\t5GSM status received in the UE\t733\n6.5.3\t5GSM status received in the SMF\t734\n6.6\tMiscellaneous procedures\t734\n6.6.1\tExchange of extended protocol configuration options\t734\n6.6.2\tRemote UE report procedure\t735\n6.6.2.1\tGeneral\t735\n6.6.2.2\tRemote UE report procedure initiation\t735\n6.6.2.3\tRemote UE report procedure accepted by the network\t736\n6.6.2.4\tAbnormal cases in the UE\t736\n6.6.2.5\tAbnormal cases on the network side\t736\n7\tHandling of unknown, unforeseen, and erroneous protocol data\t737\n7.1\tGeneral\t737\n7.2\tMessage too short or too long\t737\n7.2.1\tMessage too short\t737\n7.2.2\tMessage too long\t737\n7.3\tUnknown or unforeseen procedure transaction identity or PDU Session identity\t738\n7.3.1\tProcedure transaction identity\t738\n7.3.2\tPDU Session identity\t739\n7.4\tUnknown or unforeseen message type\t739\n7.5\tNon-semantical mandatory information element errors\t740\n7.5.1\tCommon procedures\t740\n7.5.2\t5GS mobility management\t740\n7.5.3\t5GS session management\t740\n7.6\tUnknown and unforeseen IEs in the non-imperative message part\t741\n7.6.1\tIEIs unknown in the message\t741\n7.6.2\tOut of sequence IEs\t741\n7.6.3\tRepeated IEs\t741\n7.6.4\tUnknown and unforeseen IEs in a Type 6 IE container information element\t741\n7.6.4.1\tIEIs unknown in the Type 6 IE container information element\t741\n7.6.4.2\tOut of sequence IEs\t742\n7.6.4.3\tRepeated IEs\t742\n7.7\tNon-imperative message part errors\t742\n7.7.1\tSyntactically incorrect optional IEs\t742\n7.7.2\tConditional IE errors\t742\n7.7.3\tErrors in a Type 6 IE container information element\t742\n7.7.3.1\tSyntactically incorrect optional IEs\t742\n7.7.3.2\tConditional IE errors\t743\n7.8\tMessages with semantically incorrect contents\t743\n8\tMessage functional definitions and contents\t743\n8.1\tOverview\t743\n8.2\t5GS mobility management messages\t744\n8.2.1\tAuthentication request\t744\n8.2.1.1\tMessage definition\t744\n8.2.1.2\tAuthentication parameter RAND\t745\n8.2.1.3\tAuthentication parameter AUTN\t745\n8.2.1.4\tVoid\t745\n8.2.1.5\tEAP message\t745\n8.2.2\tAuthentication response\t745\n8.2.2.1\tMessage definition\t745\n8.2.2.2\tAuthentication response parameter\t746\n8.2.2.3\tEAP message\t746\n8.2.3\tAuthentication result\t746\n8.2.3.1\tMessage definition\t746\n8.2.3.2\tABBA\t747\n8.2.3.3\tAUN3 device security key\t747\n8.2.4\tAuthentication failure\t747\n8.2.4.1\tMessage definition\t747\n8.2.4.2\tAuthentication failure parameter\t747\n8.2.5\tAuthentication reject\t747\n8.2.5.1\tMessage definition\t747\n8.2.5.2\tEAP message\t748\n8.2.6\tRegistration request\t748\n8.2.6.1\tMessage definition\t748\n8.2.6.2\tNon-current native NAS key set identifier\t751\n8.2.6.3\t5GMM capability\t751\n8.2.6.4\tUE security capability\t751\n8.2.6.5\tRequested NSSAI\t751\n8.2.6.6\tLast visited registered TAI\t751\n8.2.6.7\tS1 UE network capability\t752\n8.2.6.8\tUplink data status\t752\n8.2.6.9\tPDU session status\t752\n8.2.6.10\tMICO indication\t752\n8.2.6.11\tUE status\t752\n8.2.6.12\tAdditional GUTI\t752\n8.2.6.13\tAllowed PDU session status\t752\n8.2.6.14\tUE's usage setting\t752\n8.2.6.15\tRequested DRX parameters\t752\n8.2.6.16\tEPS NAS message container\t752\n8.2.6.17\tLADN indication\t753\n8.2.6.17A\tPayload container type\t753\n8.2.6.18\tPayload container\t753\n8.2.6.19\tNetwork slicing indication\t753\n8.2.6.20\t5GS update type\t753\n8.2.6.21\tNAS message container\t754\n8.2.6.22\tRequested extended DRX parameters\t754\n8.2.6.23\tEPS bearer context status\t754\n8.2.6.24\tT3324 value\t754\n8.2.6.25\tMobile station classmark 2\t754\n8.2.6.26\tSupported codecs\t754\n8.2.6.27\tUE radio capability ID\t754\n8.2.6.28\tRequested mapped NSSAI\t754\n8.2.6.29\tAdditional information requested\t754\n8.2.6.30\tRequested WUS assistance information\t754\n8.2.6.31\tVoid\t755\n8.2.6.32\tN5GC indication\t755\n8.2.6.33\tRequested NB-N1 mode DRX parameters\t755\n8.2.6.34\tUE request type\t755\n8.2.6.35\tPaging restriction\t755\n8.2.6.35\tService-level-AA container\t755\n8.2.6.36\tNID\t755\n8.2.6.37\tMS determined PLMN with disaster condition\t755\n8.2.6.38\tRequested PEIPS assistance information\t755\n8.2.6.39\tRequested T3512 value\t755\n8.2.6.40\tUnavailability information\t755\n8.2.6.41\tNon-3GPP path switching information\t755\n8.2.6.42\tAUN3 indication\t756\n8.2.7\tRegistration accept\t756\n8.2.7.1\tMessage definition\t756\n8.2.7.2\t5G-GUTI\t760\n8.2.7.3\tEquivalent PLMNs\t760\n8.2.7.4\tTAI list\t760\n8.2.7.5\tAllowed NSSAI\t760\n8.2.7.6\tRejected NSSAI\t760\n8.2.7.7\tConfigured NSSAI\t760\n8.2.7.8\t5GS network feature support\t760\n8.2.7.9\tPDU session status\t761\n8.2.7.10\tPDU session reactivation result\t761\n8.2.7.11\tPDU session reactivation result error cause\t761\n8.2.7.12\tLADN information\t761\n8.2.7.13\tMICO indication\t761\n8.2.7.14\tNetwork slicing indication\t761\n8.2.7.15\tService area list\t761\n8.2.7.16\tT3512 value\t761\n8.2.7.17\tNon-3GPP de-registration timer value\t761\n8.2.7.18\tT3502 value\t761\n8.2.7.19\tEmergency number list\t762\n8.2.7.20\tExtended emergency number list\t762\n8.2.7.21\tSOR transparent container\t762\n8.2.7.22\tEAP message\t762\n8.2.7.23\tNSSAI inclusion mode\t762\n8.2.7.24\tOperator-defined access category definitions\t762\n8.2.7.25\tNegotiated DRX parameters\t762\n8.2.7.26\tNon-3GPP NW policies\t762\n8.2.7.27\tNegotiated extended DRX parameters\t762\n8.2.7.28\tT3447 value\t762\n8.2.7.29\tT3448 value\t763\n8.2.7.30\tT3324 value\t763\n8.2.7.31\tEPS bearer context status\t763\n8.2.7.32\tUE radio capability ID\t763\n8.2.7.33\tUE radio capability ID deletion indication\t763\n8.2.7.34\tPending NSSAI\t763\n8.2.7.35\tCiphering key data\t763\n8.2.7.36\tCAG information list\t763\n8.2.7.37\tTruncated 5G-S-TMSI configuration\t763\n8.2.7.38\tNegotiated NB-N1 mode DRX parameters\t764\n8.2.7.39\tNegotiated WUS assistance information\t764\n8.2.7.40\tExtended rejected NSSAI\t764\n8.2.7.41\tService-level-AA container\t764\n8.2.7.42\tNegotiated PEIPS assistance information\t764\n8.2.7.43\t5GS additional request result\t764\n8.2.7.44\tNSSRG information\t764\n8.2.7.45\tDisaster roaming wait range\t764\n8.2.7.46\tDisaster return wait range\t764\n8.2.7.47\tList of PLMNs to be used in disaster condition\t765\n8.2.7.48\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\"\t765\n8.2.7.49\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for\u00a0regional provision of service\"\t765\n8.2.7.50\tExtended CAG information list\t765\n8.2.7.51\tNSAG information\t765\n8.2.7.52\tEquivalent SNPNs\t765\n8.2.7.53\tNID\t765\n8.2.7.54\tRegistration accept type 6 IE container\t765\n8.2.7.54.1\tGeneral\t765\n8.2.7.54.2\tExtended LADN information\t766\n8.2.7.54.3\tS-NSSAI location validity information\t766\n8.2.7.54.4\tVoid\t766\n8.2.7.54.5\tPartially allowed NSSAI\t766\n8.2.7.54.6\tPartially rejected NSSAI\t766\n8.2.7.55\tRAN timing synchronization\t766\n8.2.7.56\tAlternative NSSAI\t766\n8.2.7.57\tMaximum time offset\t766\n8.2.7.58\tS-NSSAI time validity information\t766\n8.2.7.59\tUnavailability configuration\t766\n8.2.7.60\tFeature authorization indication\t767\n8.2.7.61\tOn-demand NSSAI\t767\n8.2.8\tRegistration complete\t767\n8.2.8.1\tMessage definition\t767\n8.2.8.2\tSOR transparent container\t767\n8.2.9\tRegistration reject\t767\n8.2.9.1\tMessage definition\t767\n8.2.9.2\tT3346 value\t768\n8.2.9.3\tT3502 value\t768\n8.2.9.4\tEAP message\t768\n8.2.9.5\tRejected NSSAI\t769\n8.2.9.6\tCAG information list\t769\n8.2.9.7\tExtended rejected NSSAI\t769\n8.2.9.8\tDisaster return wait range\t769\n8.2.9.9\tExtended CAG information list\t769\n8.2.9.10\tLower bound timer value\t769\n8.2.9.11\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\"\t769\n8.2.9.12\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for\u00a0regional provision of service\"\t769\n8.2.9.13\tN3IWF identifier\t769\n8.2.9.14\tTNAN information\t769\n8.2.10\tUL NAS transport\t770\n8.2.10.1\tMessage definition\t770\n8.2.10.2\tPDU session ID\t770\n8.2.10.3\tOld PDU session ID\t771\n8.2.10.4\tRequest type\t771\n8.2.10.5\tS-NSSAI\t771\n8.2.10.6\tDNN\t771\n8.2.10.7\tAdditional information\t771\n8.2.10.8\tMA PDU session information\t771\n8.2.10.9\tRelease assistance indication\t771\n8.2.10.10\tNon-3GPP access path switching indication\t771\n8.2.10.11\tAlternative S-NSSAI\t771\n8.2.10.12\tPayload container information\t771\n8.2.11\tDL NAS transport\t772\n8.2.11.1\tMessage definition\t772\n8.2.11.2\tPDU session ID\t772\n8.2.11.3\tAdditional information\t772\n8.2.11.4\t5GMM cause\t772\n8.2.11.5\tBack-off timer value\t772\n8.2.11.6\tLower bound timer value\t773\n8.2.12\tDe-registration request (UE originating de-registration)\t773\n8.2.12.1\tMessage definition\t773\n8.2.12.2\tUnavailability information\t773\n8.2.12.3\tNAS message container\t773\n8.2.13\tDe-registration accept (UE originating de-registration)\t773\n8.2.13.1\tMessage definition\t773\n8.2.14\tDe-registration request (UE terminated de-registration)\t774\n8.2.14.1\tMessage definition\t774\n8.2.14.2\t5GMM cause\t775\n8.2.14.3\tT3346 value\t775\n8.2.14.4\tRejected NSSAI\t775\n8.2.14.5\tCAG information list\t775\n8.2.14.6\tExtended rejected NSSAI\t776\n8.2.14.7\tDisaster return wait range\t776\n8.2.14.7A\tExtended CAG information list\t776\n8.2.14.8\tLower bound timer value\t776\n8.2.14.9\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\"\t776\n8.2.14.10\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for\u00a0regional provision of service\"\t776\n8.2.15\tDe-registration accept (UE terminated de-registration)\t776\n8.2.15.1\tMessage definition\t776\n8.2.16\tService request\t777\n8.2.16.1\tMessage definition\t777\n8.2.16.2\tUplink data status\t777\n8.2.16.3\tPDU session status\t777\n8.2.16.4\tAllowed PDU session status\t777\n8.2.16.5\tNAS message container\t778\n8.2.16.6\tUE request type\t778\n8.2.16.7\tPaging restriction\t778\n8.2.17\tService accept\t778\n8.2.17.1\tMessage definition\t778\n8.2.17.2\tPDU session status\t779\n8.2.17.3\tPDU session reactivation result\t779\n8.2.17.4\tPDU session reactivation result error cause\t779\n8.2.17.5\tEAP message\t779\n8.2.17.6\tT3448 value\t779\n8.2.17.7\t5GS additional request result\t779\n8.2.17.8\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\"\t779\n8.2.17.9\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for\u00a0regional provision of service\"\t779\n8.2.18\tService reject\t779\n8.2.18.1\tMessage definition\t779\n8.2.18.2\tPDU session status\t780\n8.2.18.3\tT3346 value\t780\n8.2.18.4\tEAP message\t780\n8.2.18.5\tT3448 value\t780\n8.2.18.6\tCAG information list\t781\n8.2.18.7\tDisaster return wait range\t781\n8.2.18.8\tExtended CAG information list\t781\n8.2.18.9\tLower bound timer value\t781\n8.2.18.10\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\"\t781\n8.2.18.11\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for\u00a0regional provision of service\"\t781\n8.2.19\tConfiguration update command\t781\n8.2.19.1\tMessage definition\t781\n8.2.19.2\tConfiguration update indication\t784\n8.2.19.3\t5G-GUTI\t784\n8.2.19.4\tTAI list\t784\n8.2.19.5\tAllowed NSSAI\t784\n8.2.19.6\tService area list\t784\n8.2.19.7\tFull name for network\t785\n8.2.19.8\tShort name for network\t785\n8.2.19.9\tLocal time zone\t785\n8.2.19.10\tUniversal time and local time zone\t785\n8.2.19.11\tNetwork daylight saving time\t785\n8.2.19.12\tLADN information\t785\n8.2.19.13\tMICO indication\t785\n8.2.19.14\tNetwork slicing indication\t785\n8.2.19.15\tConfigured NSSAI\t785\n8.2.19.16\tRejected NSSAI\t785\n8.2.19.17\tOperator-defined access category definitions\t785\n8.2.19.18\tSMS indication\t785\n8.2.19.19\tT3447 value\t785\n8.2.19.20\tCAG information list\t786\n8.2.19.21\tUE radio capability ID\t786\n8.2.19.22\tUE radio capability ID deletion indication\t786\n8.2.19.23\t5GS registration result\t786\n8.2.19.24\tTruncated 5G-S-TMSI configuration\t786\n8.2.19.25\tAdditional configuration indication\t786\n8.2.19.26\tExtended rejected NSSAI\t786\n8.2.19.27\tService-level-AA container\t786\n8.2.19.28\tNSSRG information\t786\n8.2.19.29\tDisaster roaming wait range\t786\n8.2.19.30\tDisaster return wait range\t786\n8.2.19.31\tList of PLMNs to be used in disaster condition\t787\n8.2.19.32\tExtended CAG information list\t787\n8.2.19.33\tUpdated PEIPS assistance information\t787\n8.2.19.34\tNSAG information\t787\n8.2.19.35\tPriority indicator\t787\n8.2.19.36\tRAN timing synchronization\t787\n8.2.19.37\tExtended LADN information\t787\n8.2.19.38\tAlternative NSSAI\t787\n8.2.19.39\tS-NSSAI location validity information\t787\n8.2.19.40\tS-NSSAI time validity information\t787\n8.2.19.41\tMaximum time offset\t787\n8.2.19.42\tPartially allowed NSSAI\t788\n8.2.19.43\tPartially rejected NSSAI\t788\n8.2.19.44\tFeature authorization indication\t788\n8.2.19.45\tOn-demand NSSAI\t788\n8.2.20\tConfiguration update complete\t788\n8.2.20.1\tMessage definition\t788\n8.2.20.2\tVoid\t788\n8.2.21\tIdentity request\t788\n8.2.21.1\tMessage definition\t788\n8.2.22\tIdentity response\t789\n8.2.22.1\tMessage definition\t789\n8.2.23\tNotification\t789\n8.2.23.1\tMessage definition\t789\n8.2.24\tNotification response\t790\n8.2.24.1\tMessage definition\t790\n8.2.24.2\tPDU session status\t790\n8.2.25\tSecurity mode command\t790\n8.2.25.1\tMessage definition\t790\n8.2.25.2\tIMEISV request\t791\n8.2.25.3\tVoid\t791\n8.2.25.4\tSelected EPS NAS security algorithms\t791\n8.2.25.5\tAdditional 5G security information\t791\n8.2.25.6\tEAP message\t792\n8.2.25.7\tABBA\t792\n8.2.25.8\tReplayed S1 UE security capabilities\t792\n8.2.25.9\tAUN3 device security key\t792\n8.2.26\tSecurity mode complete\t792\n8.2.26.1\tMessage definition\t792\n8.2.26.2\tIMEISV\t792\n8.2.26.3\tNAS message container\t792\n8.2.26.4\tnon-IMEISV PEI\t793\n8.2.27\tSecurity mode reject\t793\n8.6.27.1\tMessage definition\t793\n8.2.28\tSecurity protected 5GS NAS message\t793\n8.2.28.1\tMessage definition\t793\n8.2.29\t5GMM status\t794\n8.2.29.1\tMessage definition\t794\n8.2.30\tControl Plane Service request\t794\n8.2.30.1\tMessage definition\t794\n8.2.30.2\tCIoT small data container\t795\n8.2.30.3\tPayload container type\t795\n8.2.30.4\tPayload container\t795\n8.2.30.5\tPDU session ID\t795\n8.2.30.6\tPDU session status\t796\n8.2.30.7\tRelease assistance indication\t796\n8.2.30.8\tUplink data status\t796\n8.2.30.9\tNAS message container\t796\n8.2.30.10\tAdditional information\t796\n8.2.30.11\tAllowed PDU session status\t796\n8.2.30.12\tUE request type\t796\n8.2.30.13\tPaging restriction\t796\n8.2.31\tNetwork slice-specific authentication command\t796\n8.2.31.1\tMessage definition\t796\n8.2.32\tNetwork slice-specific authentication complete\t797\n8.2.32.1\tMessage definition\t797\n8.2.33\tNetwork slice-specific authentication result\t797\n8.2.33.1\tMessage definition\t797\n8.2.34\tRelay key request\t798\n8.2.34.1\tMessage definition\t798\n8.2.35\tRelay key accept\t798\n8.2.35.1\tMessage definition\t798\n8.2.36\tRelay key reject\t799\n8.2.36.1\tMessage definition\t799\n8.2.36.2\tEAP message\t799\n8.2.37\tRelay authentication request\t799\n8.2.37.1\tMessage definition\t799\n8.2.38\tRelay authentication response\t800\n8.2.38.1\tMessage definition\t800\n8.3\t5GS session management messages\t800\n8.3.1\tPDU session establishment request\t800\n8.3.1.1\tMessage definition\t800\n8.3.1.2\tPDU session type\t802\n8.3.1.3\tSSC mode\t802\n8.3.1.4\tMaximum number of supported packet filters\t802\n8.3.1.5\t5GSM capability\t802\n8.3.1.6\tVoid\t802\n8.3.1.7\tAlways-on PDU session requested\t802\n8.3.1.8\tSM PDU DN request container\t802\n8.3.1.9\tExtended protocol configuration options\t802\n8.3.1.10\tIP header compression configuration\t802\n8.3.1.11\tDS-TT Ethernet port MAC address\t802\n8.3.1.12\tUE-DS-TT residence time\t802\n8.3.1.13\tPort management information container\t803\n8.3.1.14\tEthernet header compression configuration\t803\n8.3.1.15\tSuggested interface identifier\t803\n8.3.1.16\tService-level-AA container\t803\n8.3.1.17\tRequested MBS container\t803\n8.3.1.18\tPDU session pair ID\t803\n8.3.1.19\tRSN\t803\n8.3.1.20\tURSP rule enforcement reports\t803\n8.3.2\tPDU session establishment accept\t803\n8.3.2.1\tMessage definition\t803\n8.3.2.2\t5GSM cause\t805\n8.3.2.3\tPDU address\t805\n8.3.2.4\tRQ timer value\t805\n8.3.2.5\tS-NSSAI\t805\n8.3.2.6\tAlways-on PDU session indication\t805\n8.3.2.7\tMapped EPS bearer contexts\t805\n8.3.2.8\tEAP message\t805\n8.3.2.9\tAuthorized QoS flow descriptions\t805\n8.3.2.10\tExtended protocol configuration options\t805\n8.3.2.11\tDNN\t805\n8.3.2.12\t5GSM network feature support\t805\n8.3.2.13\tVoid\t805\n8.3.2.14\tServing PLMN rate control\t805\n8.3.2.15\tATSSS container\t806\n8.3.2.16\tControl plane only indication\t806\n8.3.2.17\tIP header compression configuration\t806\n8.3.2.18\tEthernet header compression configuration\t806\n8.3.2.19\tService-level-AA container\t806\n8.3.2.20\tReceived MBS container\t806\n8.3.2.21\tN3QAI\t806\n8.3.2.22\tProtocol description\t806\n8.3.3\tPDU session establishment reject\t806\n8.3.3.1\tMessage definition\t806\n8.3.3.2\tBack-off timer value\t807\n8.3.3.3\tAllowed SSC mode\t807\n8.3.3.4\tEAP message\t807\n8.3.3.4A\t5GSM congestion re-attempt indicator\t807\n8.3.3.5\tExtended protocol configuration options\t807\n8.3.3.6\tRe-attempt indicator\t808\n8.3.3.7\tService-level-AA container\t808\n8.3.4\tPDU session authentication command\t808\n8.3.4.1\tMessage definition\t808\n8.3.4.2\tExtended protocol configuration options\t808\n8.3.4.3\tVoid\t809\n8.3.5\tPDU session authentication complete\t809\n8.3.5.1\tMessage definition\t809\n8.3.5.2\tExtended protocol configuration options\t809\n8.3.5.3\tVoid\t809\n8.3.6\tPDU session authentication result\t809\n8.3.6.1\tMessage definition\t809\n8.3.6.2\tEAP message\t810\n8.3.6.3\tExtended protocol configuration options\t810\n8.3.7\tPDU session modification request\t810\n8.3.7.1\tMessage definition\t810\n8.3.7.2\t5GSM capability\t811\n8.3.7.3\t5GSM cause\t812\n8.3.7.4\tMaximum number of supported packet filters\t812\n8.3.7.5\tAlways-on PDU session requested\t812\n8.3.7.6\tIntegrity protection maximum data rate\t812\n8.3.7.7\tRequested QoS rules\t812\n8.3.7.8\tRequested QoS flow descriptions\t812\n8.3.7.9\tExtended protocol configuration options\t812\n8.3.7.10\tMapped EPS bearer contexts\t812\n8.3.7.11\tPort management information container\t812\n8.3.7.12\tIP header compression configuration\t812\n8.3.7.13\tEthernet header compression configuration\t813\n8.3.7.14\tRequested MBS container\t813\n8.3.7.15\tService-level-AA container\t813\n8.3.7.16\tNon-3GPP delay budget\t813\n8.3.7.17\tURSP rule enforcement reports\t813\n8.3.8\tPDU session modification reject\t813\n8.3.8.1\tMessage definition\t813\n8.3.8.2\tBack-off timer value\t814\n8.3.8.2A\t5GSM congestion re-attempt indicator\t814\n8.3.8.3\tExtended protocol configuration options\t814\n8.3.8.4\tRe-attempt indicator\t814\n8.3.9\tPDU session modification command\t814\n8.3.9.1\tMessage definition\t814\n8.3.9.2\t5GSM cause\t815\n8.3.9.3\tSession-AMBR\t815\n8.3.9.4\tRQ timer value\t816\n8.3.9.5\tAlways-on PDU session indication\t816\n8.3.9.6\tAuthorized QoS rules\t816\n8.3.9.7\tMapped EPS bearer contexts\t816\n8.3.9.8\tAuthorized QoS flow descriptions\t816\n8.3.9.9\tExtended protocol configuration options\t816\n8.3.9.10\tVoid\t816\n8.3.9.11\tATSSS container\t816\n8.3.9.12\tIP header compression configuration\t816\n8.3.9.13\tPort management information container\t816\n8.3.9.14\tServing PLMN rate control\t816\n8.3.9.15\tEthernet header compression configuration\t816\n8.3.9.16\tReceived MBS container\t817\n8.3.9.17\tService-level-AA container\t817\n8.3.9.18\tAlternative S-NSSAI\t817\n8.3.9.19\tN3QAI\t817\n8.3.9.20\tProtocol description\t817\n8.3.10\tPDU session modification complete\t817\n8.3.10.1\tMessage definition\t817\n8.3.10.2\tExtended protocol configuration options\t818\n8.3.10.3\tPort management information container\t818\n8.3.11\tPDU session modification command reject\t818\n8.3.11.1\tMessage definition\t818\n8.3.11.2\tExtended protocol configuration options\t819\n8.3.12\tPDU session release request\t819\n8.3.12.1\tMessage definition\t819\n8.3.12.2\t5GSM cause\t819\n8.3.12.3\tExtended protocol configuration options\t819\n8.3.13\tPDU session release reject\t819\n8.3.13.1\tMessage definition\t819\n8.3.13.2\tExtended protocol configuration options\t820\n8.3.14\tPDU session release command\t820\n8.3.14.1\tMessage definition\t820\n8.3.14.2\tBack-off timer value\t821\n8.3.14.3\tEAP message\t821\n8.3.14.4\tExtended protocol configuration options\t821\n8.3.14.5\t5GSM congestion re-attempt indicator\t821\n8.3.14.6\tAccess type\t821\n8.3.14.7\tService-level-AA container\t821\n8.3.14.8\tAlternative S-NSSAI\t822\n8.3.15\tPDU session release complete\t822\n8.3.15.1\tMessage definition\t822\n8.3.15.2\t5GSM cause\t822\n8.3.15.3\tExtended protocol configuration options\t822\n8.3.16\t5GSM status\t822\n8.3.16.1\tMessage definition\t822\n8.3.17\tService-level authentication command\t823\n8.3.17.1\tMessage definition\t823\n8.3.18\tService-level authentication complete\t823\n8.3.18.1\tMessage definition\t823\n8.3.19\tRemote UE report\t824\n8.3.19.1\tMessage definition\t824\n8.3.19.2\tRemote UE context connected\t824\n8.3.19.3\tRemote UE context disconnected\t824\n8.3.20\tRemote UE report response\t825\n8.3.20.1\tMessage definition\t825\n8.3.20.2\tVoid\t825\n8.3.20.3\tVoid\t825\n8.3.20.4\tVoid\t825\n9\tGeneral message format and information elements coding\t825\n9.1\tOverview\t825\n9.1.1\tNAS message format\t825\n9.1.2\tField format and mapping\t826\n9.2\tExtended protocol discriminator\t827\n9.3\tSecurity header type\t827\n9.4\tPDU session identity\t827\n9.5\tSpare half octet\t827\n9.6\tProcedure transaction identity\t827\n9.7\tMessage type\t828\n9.8\tMessage authentication code\t829\n9.9\tPlain 5GS NAS message\t829\n9.10\tSequence number\t829\n9.11\tOther information elements\t830\n9.11.1\tGeneral\t830\n9.11.2\tCommon information elements\t830\n9.11.2.1\tAdditional information\t830\n9.11.2.1A\tAccess type\t831\n9.11.2.1B\tDNN\t831\n9.11.2.2\tEAP message\t831\n9.11.2.3\tGPRS timer\t832\n9.11.2.4\tGPRS timer 2\t832\n9.11.2.5\tGPRS timer 3\t832\n9.11.2.6\tIntra N1 mode NAS transparent container\t832\n9.11.2.7\tN1 mode to S1 mode NAS transparent container\t833\n9.11.2.8\tS-NSSAI\t833\n9.11.2.9\tS1 mode to N1 mode NAS transparent container\t835\n9.11.2.10\tService-level-AA container\t836\n9.11.2.11\tService-level device ID\t839\n9.11.2.12\tService-level-AA server address\t839\n9.11.2.13\tService-level-AA payload\t840\n9.11.2.14\tService-level-AA response\t840\n9.11.2.15\tService-level-AA payload type\t841\n9.11.2.16\tVoid\t842\n9.11.2.17\tService-level-AA pending indication\t842\n9.11.2.18\tService-level-AA service status indication\t842\n9.11.2.19\tTime duration\t842\n9.11.2.20\tUnavailability information\t842\n9.11.2.21\tUnavailability configuration\t843\n9.11.3\t5GS mobility management (5GMM) information elements\t843\n9.11.3.1\t5GMM capability\t843\n9.11.3.2\t5GMM cause\t852\n9.11.3.2A\t5GS DRX parameters\t855\n9.11.3.3\t5GS identity type\t855\n9.11.3.4\t5GS mobile identity\t856\n9.11.3.5\t5GS network feature support\t862\n9.11.3.6\t5GS registration result\t868\n9.11.3.7\t5GS registration type\t869\n9.11.3.8\t5GS tracking area identity\t870\n9.11.3.9\t5GS tracking area identity list\t871\n9.11.3.9A\t5GS update type\t876\n9.11.3.10\tABBA\t877\n9.11.3.11\tVoid\t878\n9.11.3.12\tAdditional 5G security information\t878\n9.11.3.12A\tAdditional information requested\t878\n9.11.3.13\tAllowed PDU session status\t879\n9.11.3.14\tAuthentication failure parameter\t880\n9.11.3.15\tAuthentication parameter AUTN\t880\n9.11.3.16\tAuthentication parameter RAND\t880\n9.11.3.17\tAuthentication response parameter\t880\n9.11.3.18\tConfiguration update indication\t880\n9.11.3.18A\tCAG information list\t880\n9.11.3.18B\tCIoT small data container\t882\n9.11.3.18C\tCiphering key data\t886\n9.11.3.18D\tControl plane service type\t895\n9.11.3.19\tDaylight saving time\t895\n9.11.3.20\tDe-registration type\t895\n9.11.3.21\tVoid\t896\n9.11.3.22\tVoid\t896\n9.11.3.23\tEmergency number list\t896\n9.11.3.23A\tEPS bearer context status\t896\n9.11.3.24\tEPS NAS message container\t896\n9.11.3.25\tEPS NAS security algorithms\t897\n9.11.3.26\tExtended emergency number list\t897\n9.11.3.26A\tExtended DRX parameters\t897\n9.11.3.27\tVoid\t897\n9.11.3.28\tIMEISV request\t897\n9.11.3.29\tLADN indication\t897\n9.11.3.30\tLADN information\t898\n9.11.3.31\tMICO indication\t899\n9.11.3.31A\tMA PDU session information\t900\n9.11.3.31B\tMapped NSSAI\t900\n9.11.3.31C\tMobile station classmark 2\t901\n9.11.3.32\tNAS key set identifier\t902\n9.11.3.33\tNAS message container\t902\n9.11.3.34\tNAS security algorithms\t903\n9.11.3.35\tNetwork name\t903\n9.11.3.36\tNetwork slicing indication\t903\n9.11.3.36A\tNon-3GPP NW provided policies\t904\n9.11.3.37\tNSSAI\t904\n9.11.3.37A\tNSSAI inclusion mode\t905\n9.11.3.38\tOperator-defined access category definitions\t905\n9.11.3.39\tPayload container\t909\n9.11.3.40\tPayload container type\t916\n9.11.3.41\tPDU session identity 2\t916\n9.11.3.42\tPDU session reactivation result\t917\n9.11.3.43\tPDU session reactivation result error cause\t917\n9.11.3.44\tPDU session status\t918\n9.11.3.45\tPLMN list\t918\n9.11.3.46\tRejected NSSAI\t918\n9.11.3.46A\tRelease assistance indication\t920\n9.11.3.47\tRequest type\t920\n9.11.3.48\tS1 UE network capability\t921\n9.11.3.48A\tS1 UE security capability\t921\n9.11.3.49\tService area list\t921\n9.11.3.50\tService type\t926\n9.11.3.50A\tSMS indication\t926\n9.11.3.51\tSOR transparent container\t927\n9.11.3.51A\tSupported codec list\t945\n9.11.3.52\tTime zone\t945\n9.11.3.53\tTime zone and time\t945\n9.11.3.53A\tUE parameters update transparent container\t945\n9.11.3.54\tUE security capability\t948\n9.11.3.55\tUE's usage setting\t953\n9.11.3.56\tUE status\t953\n9.11.3.57\tUplink data status\t954\n9.11.3.58\tVoid\t955\n9.11.3.59\tVoid\t955\n9.11.3.60\tVoid\t955\n9.11.3.61\tVoid\t955\n9.11.3.62\tVoid\t955\n9.11.3.63\tVoid\t955\n9.11.3.64\tVoid\t955\n9.11.3.65\tVoid\t955\n9.11.3.66\tVoid\t955\n9.11.3.67\tVoid\t955\n9.11.3.68\tUE radio capability ID\t955\n9.11.3.69\tUE radio capability ID deletion indication\t955\n9.11.3.70\tTruncated 5G-S-TMSI configuration\t956\n9.11.3.71\tWUS assistance information\t957\n9.11.3.72\tN5GC indication\t957\n9.11.3.73\tNB-N1 mode DRX parameters\t958\n9.11.3.74\tAdditional configuration indication\t958\n9.11.3.75\tExtended rejected NSSAI\t959\n9.11.3.76\tUE request type\t963\n9.11.3.77\tPaging restriction\t963\n9.11.3.78\tVoid\t964\n9.11.3.79\tNID\t964\n9.11.3.80\tPEIPS assistance information\t964\n9.11.3.81\t5GS additional request result\t966\n9.11.3.82\tNSSRG information\t967\n9.11.3.83\tList of PLMNs to be used in disaster condition\t968\n9.11.3.84\tRegistration wait range\t969\n9.11.3.85\tPLMN identity\t970\n9.11.3.86\tExtended CAG information list\t970\n9.11.3.87\tNSAG information\t975\n9.11.3.88\tProSe relay transaction identity\t976\n9.11.3.89\tRelay key request parameters\t977\n9.11.3.90\tRelay key response parameters\t978\n9.11.3.91\tPriority indicator\t979\n9.11.3.92\tSNPN list\t979\n9.11.3.93\tN3IWF identifier\t980\n9.11.3.94\tTNAN information\t981\n9.11.3.95\tRAN timing synchronization\t982\n9.11.3.96\tExtended LADN information\t983\n9.11.3.97\tAlternative NSSAI\t984\n9.11.3.98\tType 6 IE container\t985\n9.11.3.99\tNon-3GPP access path switching indication\t986\n9.11.3.100\tS-NSSAI location validity information\t987\n9.11.3.101\tS-NSSAI time validity information\t988\n9.11.3.102\tNon-3GPP path switching information\t990\n9.11.3.103\tPartial NSSAI\t991\n9.11.3.104\tAUN3 indication\t992\n9.11.3.106\tPayload container information\t993\n9.11.3.107\tAUN3 device security key\t993\n9.11.3.108\tOn-demand NSSAI\t994\n9.11.4\t5GS session management (5GSM) information elements\t995\n9.11.4.1\t5GSM capability\t995\n9.11.4.2\t5GSM cause\t997\n9.11.4.3\tAlways-on PDU session indication\t998\n9.11.4.4\tAlways-on PDU session requested\t999\n9.11.4.5\tAllowed SSC mode\t999\n9.11.4.6\tExtended protocol configuration options\t1000\n9.11.4.7\tIntegrity protection maximum data rate\t1000\n9.11.4.8\tMapped EPS bearer contexts\t1001\n9.11.4.9\tMaximum number of supported packet filters\t1005\n9.11.4.10\tPDU address\t1005\n9.11.4.11\tPDU session type\t1007\n9.11.4.12\tQoS flow descriptions\t1007\n9.11.4.13\tQoS rules\t1014\n9.11.4.14\tSession-AMBR\t1022\n9.11.4.15\tSM PDU DN request container\t1023\n9.11.4.16\tSSC mode\t1024\n9.11.4.17\tRe-attempt indicator\t1024\n9.11.4.18\t5GSM network feature support\t1025\n9.11.4.19\tVoid\t1026\n9.11.4.20\tServing PLMN rate control\t1026\n9.11.4.21\t5GSM congestion re-attempt indicator\t1026\n9.11.4.22\tATSSS container\t1026\n9.11.4.23\tControl plane only indication\t1027\n9.11.4.24\tIP header compression configuration\t1027\n9.11.4.25\tDS-TT Ethernet port MAC address\t1031\n9.11.4.26\tUE-DS-TT residence time\t1031\n9.11.4.27\tPort management information container\t1032\n9.11.4.28\tEthernet header compression configuration\t1032\n9.11.4.29\tRemote UE context list\t1033\n9.11.4.30\tRequested MBS container\t1037\n9.11.4.31\tReceived MBS container\t1039\n9.11.4.32\tPDU session pair ID\t1046\n9.11.4.33\tRSN\t1047\n9.11.4.34\tECS address\t1047\n9.11.4.35\tVoid\t1049\n9.11.4.36\tN3QAI\t1049\n9.11.4.37\tNon-3GPP delay budget\t1053\n9.11.4.38\tURSP rule enforcement reports\t1055\n9.11.4.39\tProtocol description\t1056\n9.12\t3GPP specific coding information defined within present document\t1060\n9.12.1\tServing network name (SNN)\t1060\n10\tList of system parameters\t1061\n10.1\tGeneral\t1061\n10.2\tTimers of 5GS mobility management\t1061\n10.3\tTimers of 5GS session management\t1072\n10.4\tVoid\t1078\nAnnex A (informative):\tCause values for 5GS mobility management\t1079\nA.1\tCauses related to UE identification\t1079\nA.2\tCause related to subscription options\t1079\nA.3\tCauses related to PLMN or SNPN specific network failures and congestion/authentication failures\t1081\nA.4\tCauses related to invalid messages\t1083\nAnnex B (informative):\tCause values for 5GS session management\t1084\nB.1\tCauses related to nature of request\t1084\nB.2\tProtocol errors (e.g., unknown message)\t1086\nAnnex C (normative):\tStorage of 5GMM information\t1088\nC.1\tStorage of 5GMM information for UEs not operating in SNPN access operation mode\t1088\nC.2\tStorage of 5GMM information for UEs operating in SNPN access operation mode\t1090\nAnnex D (normative):\tUE policy delivery service\t1094\nD.1\tGeneral\t1094\nD.1.1\tOverview\t1094\nD.1.2\tPrinciples of PTI handling for UE policy delivery service procedures\t1094\nD.2\tProcedures\t1096\nD.2.1\tNetwork-requested UE policy management procedure\t1096\nD.2.1.1\tGeneral\t1096\nD.2.1.2\tNetwork-requested UE policy management procedure initiation\t1096\nD.2.1.3\tNetwork-requested UE policy management procedure accepted by the UE\t1098\nD.2.1.4\tNetwork-requested UE policy management procedure not accepted by the UE\t1098\nD.2.1.5\tAbnormal cases on the network side\t1099\nD.2.1.6\tAbnormal cases in the UE\t1099\nD.2.2\tUE-initiated UE state indication procedure\t1100\nD.2.2.1\tGeneral\t1100\nD.2.2.2\tUE-initiated UE state indication procedure initiation\t1101\nD.2.2.3\tUE-initiated UE state indication procedure accepted by the network\t1101\nD.2.2.4\tAbnormal cases on the network side\t1102\nD.3\tUE policy re-assembly at the UE\t1102\nD.4\tVoid\t1103\nD.5\tMessage functional definition and contents\t1103\nD.5.1\tManage UE policy command\t1103\nD.5.1.1\tMessage definition\t1103\nD.5.1.2\tUE policy network classmark\t1103\nD.5.1.3\tVPS URSP configuration\t1103\nD.5.2\tManage UE policy complete\t1104\nD.5.2.1\tMessage definition\t1104\nD.5.3\tManage UE policy command reject\t1104\nD.5.3.1\tMessage definition\t1104\nD.5.4\tUE state indication\t1104\nD.5.4.1\tMessage definition\t1104\nD.6\tInformation elements coding\t1105\nD.6.1\tUE policy delivery service message type\t1105\nD.6.2\tUE policy section management list\t1106\nD.6.3\tUE policy section management result\t1111\nD.6.4\tUPSI list\t1113\nD.6.5\tUE policy classmark\t1115\nD.6.6\tUE OS Id\t1116\nD.6.7\tUE policy network classmark\t1117\nD.6.8\tVPS URSP configuration\t1117\nD.7\tTimers of UE policy delivery service\t1121\nD.8\tHandling of unknown, unforeseen, and erroneous UPDS data\t1121\nD.8.1\tGeneral\t1121\nD.8.2\tMessage too short or too long\t1121\nD.8.2.1\tMessage too short\t1121\nD.8.2.2\tMessage too long\t1121\nD.8.3\tUnknown or unforeseen procedure transaction identity\t1122\nD.8.3.1\tProcedure transaction identity\t1122\nD.8.4\tUnknown or unforeseen message type\t1122\nD.8.5\tNon-semantical mandatory information element errors\t1122\nD.8.5.1\tCommon procedures\t1122\nD.8.6\tUnknown and unforeseen IEs in the non-imperative message part\t1123\nD.8.6.1\tIEIs unknown in the message\t1123\nD.8.6.2\tOut of sequence IEs\t1123\nD.8.6.3\tRepeated IEs\t1123\nD.8.7\tNon-imperative message part errors\t1123\nD.8.7.1\tSyntactically incorrect optional IEs\t1123\nD.8.7.2\tConditional IE errors\t1123\nD.8.8\tMessages with semantically incorrect contents\t1124\nAnnex E (informative):\tVoid\t1125\nAnnex F (informative):\tChange history\t1126\n\nForeword\nThis Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n1\tScope\nThe present document specifies the non-access stratum (NAS) procedures in the 5G system (5GS) used by the protocols for:\n-\tmobility management between the user equipment (UE) and the access and mobility management function (AMF) for both 3GPP access and non-3GPP access; and\n-\tsession management between the user equipment (UE) and the session management function (SMF) for both 3GPP access and non-3GPP access.\nThe 5GS mobility management (5GMM) protocol defined in the present document provides procedures for the control of mobility when the user equipment (UE) is using the NG radio access network (NG-RAN), non-3GPP access network, or both. The 5GMM protocol also provides control of security for the NAS protocols.\nThe 5GS session management (5GSM) protocol defined in the present document provides procedures for the handling of 5GS PDU sessions. Together with the bearer control provided by the access stratum, this protocol is used for the control of user-plane resources.\nFor both NAS protocols the present document specifies procedures for the support of inter-system mobility between the NG-RAN and the evolved universal terrestrial radio access (E-UTRAN), between the NG-RAN and the non-3GPP access network connected to the EPC, and between the non-3GPP access network connected to the 5G core network (5GCN) and the E-UTRAN.\nFor both NAS protocols the present document specifies procedures for the support of mobility between the NG-RAN and the non-3GPP access network connected to the 5GCN.\nIn addition, the present document specifies the procedures in the 5GS for UE policy delivery service between the UE and the policy control function (PCF) for both 3GPP access and non-3GPP access.\nThe present document is applicable to the UE, the access and mobility management function (AMF), the session management function (SMF), and the PCF in the 5GS.\nThe clauses and subclauses in the present document are common for both 3GPP access and non-3GPP access unless it is explicitly stated that they apply to 3GPP access only or non-3GPP access only.\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP\u00a0TR\u00a021.905: \"Vocabulary for 3GPP Specifications\".\n[1A]\t3GPP\u00a0TS\u00a022.011: \"Service accessibility\".\n[2]\t3GPP\u00a0TS\u00a022.101: \"Service aspects; Service principles\".\n[3]\t3GPP\u00a0TS\u00a022.261: \"Service requirements for the 5G system; Stage 1\".\n[4]\t3GPP\u00a0TS\u00a023.003: \"Numbering, addressing and identification\".\n[4A]\t3GPP\u00a0TS\u00a023.040: \"Technical realization of Short Message Service (SMS)\".\n[4B]\t3GPP\u00a0TS\u00a023.032: \"Universal Geographical Area Description (GAD)\".\n[5]\t3GPP\u00a0TS\u00a023.122: \"Non-Access-Stratum functions related to Mobile Station (MS) in idle mode\".\n[6]\t3GPP\u00a0TS\u00a023.167: \"IP Multimedia Subsystem (IMS) emergency sessions\".\n[6A]\t3GPP\u00a0TS\u00a023.216: \"Single Radio Voice Call Continuity (SRVCC); Stage\u00a02\".\n[6AB]\t3GPP\u00a0TS\u00a023.256: \"Support of Uncrewed Aerial Systems (UAS) connectivity, identification and tracking; Stage 2\".\n[6B]\t3GPP\u00a0TS\u00a023.273: \"5G System (5GS) Location Services (LCS); Stage\u00a02\".\n[6C]\t3GPP\u00a0TS\u00a023.287: \"Architecture enhancements for 5G System (5GS) to support Vehicle-to-Everything (V2X) services\".\n[6D]\t3GPP\u00a0TS\u00a023.316: \"Wireless and wireline convergence access support for the 5G System (5GS)\".\n[6E]\t3GPP\u00a0TS\u00a023.304: \"Proximity based Services (ProSe) in the 5G System (5GS)\".\n[7]\t3GPP\u00a0TS\u00a023.401: \"GPRS enhancements for E-UTRAN access\".\n[8]\t3GPP\u00a0TS\u00a023.501: \"System Architecture for the 5G System; Stage 2\".\n[9]\t3GPP\u00a0TS\u00a023.502: \"Procedures for the 5G System; Stage 2\".\n[10]\t3GPP\u00a0TS\u00a023.503: \"Policy and Charging Control Framework for the 5G System; Stage\u00a02\".\n[10A]\t3GPP\u00a0TS\u00a023.548: \"5G System Enhancements for Edge Computing; Stage\u00a02\".\n[11]\t3GPP\u00a0TS\u00a024.007: \"Mobile radio interface signalling layer 3; General aspects\".\n[12]\t3GPP\u00a0TS\u00a024.008: \"Mobile Radio Interface Layer\u00a03 specification; Core Network Protocols; Stage\u00a03\".\n[13]\t3GPP\u00a0TS\u00a024.011: \"Point-to-Point Short Message Service (SMS) support on mobile radio interface\".\n[13A]\t3GPP\u00a0TS\u00a024.080: \"Mobile radio interface layer 3 Supplementary services specification; Formats and coding\".\n[13B]\t3GPP\u00a0TS\u00a024.193: \"Access Traffic Steering, Switching and Splitting; Stage\u00a03\".\n[13C]\t3GPP\u00a0TS\u00a024.173: \"IMS Multimedia telephony communication service and supplementary services; Stage\u00a03\".\n[13D]\t3GPP\u00a0TS\u00a024.174: \"Support of multi-device and multi-identity in the IP Multimedia Subsystem (IMS); Stage 3\".\n[14]\t3GPP\u00a0TS\u00a024.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\n[14AA]\t3GPP\u00a0TS\u00a024.237: \"IP Multimedia (IM) Core Network (CN) subsystem IP Multimedia Subsystem (IMS) service continuity; Stage 3\".\n[14A]\t3GPP\u00a0TS\u00a024.250: \"Protocol for Reliable Data Service; Stage\u00a03\".\n[15]\t3GPP\u00a0TS\u00a024.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet System (EPS); Stage\u00a03\".\n[16]\t3GPP\u00a0TS\u00a024.302: \"Access to the 3GPP Evolved Packet Core (EPC) via non-3GPP access networks; Stage 3\"\n[17]\t3GPP\u00a0TS\u00a024.368: \"Non-Access Stratum (NAS) configuration Management Object (MO)\".\n[18]\t3GPP\u00a0TS\u00a024.502: \"Access to the 3GPP 5G System (5GS) via non-3GPP access networks;\u00a0Stage\u00a03\".\n[19]\t3GPP\u00a0TS\u00a024.526: \"UE policies for 5G System (5GS); Stage 3\".\n[19BA]\t3GPP\u00a0TS\u00a024.539: \"5G System (5GS); Network to TSN translator (TT) protocol aspects; Stage 3\".\n[19A]\t3GPP\u00a0TS\u00a024.535: \"Device-Side Time-Sensitive Networking (TSN) Translator (DS-TT) to Network-Side TSN Translator (NW-TT) protocol aspects; Stage 3\".\n[19B]\t3GPP\u00a0TS\u00a024.587: \"Vehicle-to-Everything (V2X) services in 5G System (5GS); Protocol aspects; Stage 3\"\n[19C]\t3GPP\u00a0TS\u00a024.588: \"Vehicle-to-Everything (V2X) services in 5G System (5GS); User Equipment (UE) policies; Stage\u00a03\"\n[19D]\tVoid.\n[19E]\t3GPP\u00a0TS\u00a024.554: \"Proximity-service (ProSe) in 5G System (5GS) protocol aspects; Stage\u00a03\".\n[19F]\t3GPP\u00a0TS\u00a024.555: \"Proximity-services (ProSe) in 5G System (5GS); User Equipment (UE) policies; Stage\u00a03\".\n[20]\t3GPP\u00a0TS\u00a024.623: \"Extensive Markup Language (XML) Configuration Access Protocol (XCAP) over the Ut interface for Manipulating Supplementary Services\".\n[20AA]\t3GPP\u00a0TS\u00a029.500: \"5G System; Technical Realization of Service Based Architecture; Stage\u00a03\".\n[20A]\t3GPP\u00a0TS\u00a029.502: \"5G System; Session Management Services; Stage\u00a03\".\n[20AB]\t3GPP\u00a0TS\u00a029.503: \"5G System; Unified Data Management Services; Stage\u00a03\".\n[20B]\t3GPP\u00a0TS\u00a029.518:\u00a0\"5G System; Access and Mobility Management Services; Stage\u00a03\".\n[21]\t3GPP\u00a0TS\u00a029.525: \"5G System; UE Policy Control Service; Stage\u00a03\".\n[21A]\t3GPP\u00a0TS\u00a029.526: \"5G System; Network Slice-Specific Authentication and Authorization (NSSAA) services; Stage\u00a03\".\n[21B]\t3GPP\u00a0TS\u00a029.256: \"5G System; Uncrewed Aerial Systems Network Function (UAS-NF); Aerial Management Services; Stage\u00a03.\n[22]\t3GPP\u00a0TS\u00a031.102: \"Characteristics of the Universal Subscriber Identity Module (USIM) application\".\n[22A]\t3GPP\u00a0TS\u00a031.111: \"USIM Application Toolkit (USAT)\".\n[22B]\t3GPP\u00a0TS\u00a031.115: \"Secured packet structure for (Universal) Subscriber Identity Module (U)SIM Toolkit applications\".\n[23]\t3GPP\u00a0TS\u00a033.102: \"3G security; Security architecture\".\n[23A]\t3GPP\u00a0TS\u00a033.401: \"3GPP System Architecture Evolution; Security architecture\".\n[24]\t3GPP\u00a0TS\u00a033.501: \"Security architecture and procedures for 5G System\".\n[24A]\t3GPP TS 33.535: \"Authentication and Key Management for Applications (AKMA) based on 3GPP credentials in the 5G System (5GS)\".\n[24B]\t3GPP TS 33.256: \"Security aspects of Uncrewed Aerial Systems (UAS)\".\n[25]\t3GPP\u00a0TS\u00a036.323: \"NR; Packet Data Convergence Protocol (PDCP) specification\".\n[25A]\t3GPP\u00a0TS\u00a036.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Radio Resource Control (RRC) protocol specification\".\n[25B]\t3GPP\u00a0TS\u00a036.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall description\".\n[25C]\t3GPP\u00a0TS\u00a036.304: \"Evolved Universal Terrestrial Radio Access (E-UTRA); User Equipment (UE) procedures in idle mode\".\n[25D]\t3GPP\u00a0TS\u00a036.306: \"Evolved Universal Terrestrial Radio Access (E-UTRA); User Equipment (UE) radio access capabilities\".\n[25E]\t3GPP\u00a0TS\u00a036.321: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Medium Access Control (MAC) protocol specification\".\n[26]\t3GPP\u00a0TS\u00a037.355: \"LTE Positioning Protocol (LPP)\".\n[26A]\t3GPP\u00a0TS\u00a038.355: \"Sidelink Positioning Protocol (SLPP); Protocol specification\".\n[27]\t3GPP\u00a0TS\u00a038.300: \"NR; NR and NG-RAN Overall Description; Stage 2\".\n[28]\t3GPP\u00a0TS\u00a038.304: \"New Generation Radio Access Network; User Equipment (UE) procedures in Idle mode\".\n[29]\t3GPP\u00a0TS\u00a038.323: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Packet Data Convergence Protocol (PDCP) specification\".\n[30]\t3GPP\u00a0TS\u00a038.331: \"NR; Radio Resource Control (RRC); Protocol Specification\".\n[31]\t3GPP\u00a0TS\u00a038.413: \"NG Radio Access Network (NG-RAN); NG Application Protocol (NGAP)\".\n[31A]\tIEEE\u00a0Std\u00a0802.3\u2122-2022: \"Ethernet\".\n[31AA]\t3GPP\u00a0TS\u00a038.509: \"Special conformance testing functions for User Equipment (UE)\".\n[32]\tIETF\u00a0RFC\u00a0768: \"User Datagram Protocol\".\n[33]\tIETF\u00a0RFC\u00a0793: \"Transmission Control Protocol.\"\n[33A]\tIETF\u00a0RFC\u00a03095: \"RObust Header Compression (ROHC): Framework and four profiles: RTP, UDP, ESP and uncompressed\".\n[33B]\tVoid.\n[33C]\tVoid.\n[33D]\tIETF\u00a0RFC\u00a08415: \"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)\".\n[33E]\tIETF\u00a0RFC\u00a02131: \"Dynamic Host Configuration Protocol\".\n[33F]\tIETF\u00a0RFC\u00a02132: \"DHCP Options and BOOTP Vendor Extensions\".\n[34]\tIETF\u00a0RFC\u00a03748: \"Extensible Authentication Protocol (EAP)\".\n[34A]\tIETF\u00a0RFC\u00a03843: \"RObust Header Compression (ROHC): A Compression Profile for IP\".\n[35]\tVoid.\n[35A]\tIETF\u00a0RFC\u00a04122: \"A Universally Unique IDentifier (UUID) URN Namespace\".\n[36]\tIETF\u00a0RFC\u00a04191: \"Default Router Preferences and More-Specific Routes\".\n[36A]\tIETF\u00a0RFC\u00a05905: \"Network Time Protocol Version 4: Protocol and Algorithms Specification\".\n[37]\tIETF\u00a0RFC\u00a07542: \"The Network Access Identifier\".\n[38]\tIETF\u00a0RFC\u00a04303: \"IP Encapsulating Security Payload (ESP)\".\n[38A]\tIETF\u00a0RFC\u00a04815: \"RObust Header Compression (ROHC): Corrections and Clarifications to RFC\u00a03095\".\n[38B]\tIETF\u00a0RFC\u00a04861: \"Neighbor Discovery for IP version 6 (IPv6)\".\n[39]\tIETF\u00a0RFC\u00a04862: \"IPv6 Stateless Address Autoconfiguration\".\n[39A]\tIETF\u00a0RFC\u00a05225: \"RObust Header Compression (ROHC) Version 2: Profiles for RTP, UDP, IP, ESP and UDP Lite\".\n[39B]\tIETF\u00a0RFC\u00a05795: \"The RObust Header Compression (ROHC) Framework\".\n[40]\tIETF\u00a0RFC\u00a05448: \"Improved Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA')\".\n[40A]\tIETF\u00a0RFC\u00a06603: \"Prefix Exclude Option for DHCPv6-based Prefix Delegation\".\n[40B]\tIETF\u00a0RFC\u00a06846: \"RObust Header Compression (ROHC): A Profile for TCP/IP (ROHC-TCP)\".\n[41]\tIETF\u00a0RFC\u00a07296: \"Internet Key Exchange Protocol Version 2 (IKEv2)\".\n[42]\tITU-T\u00a0Recommendation\u00a0E.212: \"The international identification plan for public networks and subscriptions\", 2016-09-23.\n[43]\tIEEE\u00a0Std\u00a0802-2014: \"IEEE Standard for Local and Metropolitan Area Networks: Overview and Architecture\" (30 June 2014).\n[43A]\tVoid\n[43B]\tIEEE\u00a0Std\u00a01588\u2122-2019: \"IEEE Standard for a Precision Clock Synchronization Protocol for Networked Measurement and Control Systems\".\n[43C]\tVoid.\n[43D]\tVoid.\n[43E]\tVoid.\n[44]\tVoid.\n[45]\tVoid.\n[46]\tVoid.\n[47]\tVoid.\n[48]\tIEEE: \"Guidelines for Use of Extended Unique Identifier (EUI), Organizationally Unique Identifier (OUI), and Company ID (CID)\".\n[49]\tBBF\u00a0TR-069: \"CPE WAN Management Protocol\".\n[50]\tBBF\u00a0TR-369: \"User Services Platform (USP)\".\n[51]\t3GPP\u00a0TS\u00a037.340: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and NR; Multi-connectivity; Stage\u00a02\".\n[52]\tIETF\u00a0RFC\u00a08106:\"IPv6 Router Advertisement Options for DNS Configuration\".\n[53]\t3GPP\u00a0TS\u00a023.247: \"Architectural enhancements for 5G multicast-broadcast services; Stage 2\".\n[54]\t3GPP\u00a0TS\u00a023.380: \"IMS Restoration Procedures\".\n[55]\tIETF\u00a0RFC\u00a03948: \"UDP Encapsulation of IPsec ESP Packets\".\n[56]\t3GPP\u00a0TS\u00a033.503: \"Security Aspects of Proximity based Services (ProSe) in the 5G System (5GS)\".\n[57]\t3GPP\u00a0TS\u00a033.246: \"Security of Multimedia Broadcast/Multicast Service (MBMS)\".\n[58]\t3GPP\u00a0TS\u00a038.321: \"NR; Medium Access Control (MAC); Protocol specification\".\n[59]\tIEEE\u00a0Std\u00a0802.11\u2122-2020: \"Information Technology- Telecommunications and information exchange between systems-Local and metropolitan area networks-Specific requirements-Part\u00a011: Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".\n[60]\t3GPP\u00a0TS\u00a024.577: \"Aircraft-to-Everything (A2X) services in 5G System (5GS) protocol aspects; Stage 3\".\n[61]\t3GPP\u00a0TS\u00a024.578: \"Aircraft-to-Everything (A2X) services in 5G System (5GS); UE policies\".\n[62]\t3GPP\u00a0TS\u00a024.514: \"Ranging based services and sidelink positioning in 5G system (5GS); Stage 3\".\n[63]\t3GPP\u00a0TS\u00a023.586: \"Architectural Enhancements to support Ranging based services and Sidelink Positioning\".\n[64]\t3GPP\u00a0TS\u00a024.572: \"User Plane Location Services (LCS) Protocols And Procedures; Stage 3\".\n[65]\t3GPP\u00a0TS\u00a024.575: \"5G System; Multicast/Broadcast UE pre-configuration Management Object (MO)\".\n[66]\tIETF\u00a0RFC\u00a04291:\" IP Version 6 Addressing Architecture\".\n[67]\t3GPP\u00a0TS\u00a038.305: \"Stage 2 functional specification of User Equipment (UE) positioning in NG-RAN\".\n[68]\t3GPP\u00a0TS\u00a023.271: \"Functional stage 2 description of Location Services (LCS)\".\n[69]\t3GPP\u00a0TS\u00a026.522: \"5G Real-time Media Transport Protocol Configurations\".\n3\tDefinitions and abbreviations\n3.1\tDefinitions\nFor the purposes of the present document, the terms and definitions given in 3GPP\u00a0TR\u00a021.905\u00a0[1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP\u00a0TR\u00a021.905\u00a0[1].\n5GMM-IDLE mode: In this specification, if the term is used standalone, a UE in 5GMM-IDLE mode means the UE can be either in 5GMM-IDLE mode over 3GPP access or in 5GMM-IDLE mode over non-3GPP access.\n5GMM-CONNECTED mode: In this specification, if the term is used standalone, a UE in 5GMM-CONNECTED mode means the UE can be either in 5GMM-CONNECTED mode over 3GPP access or in 5GMM-CONNECTED mode over non-3GPP access.\n5GMM-IDLE mode over 3GPP access: A UE is in 5GMM-IDLE mode over 3GPP access when no N1 NAS signalling connection between the UE and network over 3GPP access exists. The term 5GMM-IDLE mode over 3GPP access used in the present document corresponds to the term CM-IDLE state for 3GPP access used in 3GPP\u00a0TS\u00a023.501\u00a0[8].\n5GMM-CONNECTED mode over 3GPP access: A UE is in 5GMM-CONNECTED mode over 3GPP access when an N1 NAS signalling connection between the UE and network over 3GPP access exists. The term 5GMM-CONNECTED mode over 3GPP access used in the present document corresponds to the term CM-CONNECTED state for 3GPP access used in 3GPP\u00a0TS\u00a023.501\u00a0[8].\n5GMM-IDLE mode over non-3GPP access: A UE is in 5GMM-IDLE mode over non-3GPP access when no N1 NAS signalling connection between the UE and network over non-3GPP access exists. The term 5GMM-IDLE mode over non-3GPP access used in the present document corresponds to the term CM-IDLE state for non-3GPP access used in 3GPP\u00a0TS\u00a023.501\u00a0[8].\n5GMM-CONNECTED mode over non-3GPP access: A UE is in 5GMM-CONNECTED mode over non-3GPP access when an N1 NAS signalling connection between the UE and network over non-3GPP access exists. The term 5GMM-CONNECTED mode over non-3GPP access used in the present document corresponds to the term CM-CONNECTED state for non-3GPP access used in 3GPP\u00a0TS\u00a023.501\u00a0[8].\n5GS services: Services provided by PS domain. Within the context of this specification, 5GS services is used as a synonym for EPS services.\n5G-EA: 5GS encryption algorithms. The term 5G-EA, 5G-EA0, 128-5G-EA1, 128-5G-EA2, 128-5G-EA3, 5G-EA4, 5G-EA5, 5G-EA6 and 5G-EA7 used in the present document corresponds to the term NEA, NEA0, 128-NEA1, 128-NEA2, 128-NEA3, NEA4, NEA5, NEA6 and NEA7 defined in 3GPP\u00a0TS\u00a033.501\u00a0[24].\n5G-IA: 5GS integrity algorithms. The term 5G-IA, 5G-IA0, 128-5G-IA1, 128-5G-IA2, 128-5G-IA3, 5G-IA4, 5G-IA5, 5G-IA6 and 5G-IA7 used in the present document corresponds to the term NIA, NIA0, 128-NIA1, 128-NIA2, 128-NIA3, NIA4, NIA5, NIA6 and NIA7 defined in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nAccess stratum connection: A peer to peer access stratum connection:\n-\tbetween the UE and the NG-RAN for 3GPP access;\n-\tbetween the UE and the N3IWF for untrusted non-3GPP access;\n-\tbetween the UE and the TNGF for trusted non-3GPP access used by the UE;\n-\twithin the TWIF acting on behalf of the N5CW device for trusted non-3GPP access used by the N5CW device;\n-\tbetween the 5G-RG and the W-AGF for wireline access used by the 5G-RG;\n-\twithin the W-AGF acting on behalf of the FN-RG for wireline access used by the FN-RG; or\n-\twithin the W-AGF acting on behalf of the N5GC device for wireline access used by the N5GC device.\nThe access stratum connection for 3GPP access corresponds to an RRC connection via the Uu reference point. The creation of the access stratum connection for untrusted non-3GPP access corresponds to the completion of the IKE_SA_INIT exchange (see IETF\u00a0RFC\u00a07296\u00a0[41]) via the NWu reference point. The creation of the access stratum connection for trusted non-3GPP access used by the UE corresponds to the UE reception of an EAP-request/5G-start via NWt reference point (see 3GPP\u00a0TS\u00a023.502\u00a0[9]). The creation of the access stratum connection for trusted non-3GPP access used by the N5CW device corresponds to the TWIF's start of acting on behalf of the N5CW device. The creation of the access stratum connection for wireline access used by the 5G-RG corresponds to establishment of signalling connection using W-CP protocol stack via the Y4 reference point (see 3GPP\u00a0TS\u00a023.316\u00a0[6D]). The creation of the access stratum connection for wireline access used by the FN-RG corresponds to the W-AGF's start of acting on behalf of the FN-RG. The creation of the access stratum connection for wireline access used by the N5GC device corresponds to the W-AGF's start of acting on behalf of the N5GC device.\nAccess to SNPN services via a PLMN/To access SNPN services via a PLMN: A UE is accessing SNPN services via a PLMN when the UE is connecting to the 5GCN of the SNPN using the 3GPP access of the PLMN.\nAggregate maximum bit rate: The maximum bit rate that limits the aggregate bit rate of a set of non-GBR bearers of a UE. Definition derived from 3GPP\u00a0TS\u00a023.501\u00a0[8].\nAlternative NSSAI: A list of mapping information between the S-NSSAI to be replaced and the alternative S-NSSAI.\nAlways-on PDU session: A PDU session for which user-plane resources have to be established during every transition from 5GMM-IDLE mode to 5GMM-CONNECTED mode. A UE requests a PDU session to be established as an always-on PDU session based on indication from upper layers and the network decides whether a PDU session is established as an always-on PDU session.\nNOTE\u00a01:\tHow the upper layers in the UE are configured to provide an indication is outside the scope of the present document.\nApplicable UE radio capability ID for the current UE radio configuration in the selected network: The UE has an applicable UE radio capability ID for the current UE radio configuration in the selected network if:\na)\tthe UE supports RACS; and\nb)\tthe UE has:\n1)\ta stored network-assigned UE radio capability ID which is associated with the PLMN ID or SNPN identity of the serving network and which maps to the set of radio capabilities currently enabled at the UE; or\n2)\ta manufacturer-assigned UE radio capability ID which maps to the set of radio capabilities currently enabled at the UE.\nCAG cell: A cell in which only members of the CAG can get normal service. Depending on local regulation, the CAG cell can provide emergency services and emergency services fallback also to subscribers who are not members of the CAG.\nCAG-ID: A CAG-ID is a unique identifier within the scope of one PLMN defined in 3GPP\u00a0TS\u00a023.003\u00a0[4] which identifies a Closed Access Group (CAG) in the PLMN associated with a cell or group of cells to which access is restricted to members of the CAG.\nCAG restrictions: Restrictions applied to a UE in accessing a PLMN's 5GCN via:\na)\ta non-CAG cell if the entry for the PLMN in the UE's \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\"; or\nb)\ta CAG cell if none of the CAG-ID(s) supported by the CAG cell is authorized based on the \"allowed CAG list\" for the PLMN in the UE's \"CAG information list\".\nThe CAG restrictions are not applied in a PLMN when a UE accesses the PLMN due to emergency services or emergency services fallback.\nCleartext IEs: Information elements that can be sent without confidentiality protection in initial NAS messages as specified in subclause\u00a04.4.6.\nConfiguration of SNPN subscription parameters in PLMN via the user plane: Configuration of a UE in a PLMN with one or more entries of the \"list of subscriber data\u201d via the user plane.\nControl plane CIoT 5GS optimization: Signalling optimizations to enable efficient transport of user data (IP, Ethernet, Unstructured or SMS) over control plane via the AMF including optional header compression of IP data and Ethernet data.\nCurrent TAI: A TAI of a selected PLMN broadcast in the cell on which the UE is camping. If the cell is a satellite NG-RAN cell broadcasting multiple TACs of the selected PLMN, the UE NAS layer selects the current TAI from these multiple TACs of the selected PLMN as specified in subclause\u00a04.23.5.\nNOTE\u00a02:\tFor the purpose of this definition, the selected PLMN can either be the registered PLMN or a PLMN selected according to PLMN selection rules as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5].\nDNN determined by the AMF: If no DNN requested by the UE is provided, a DNN determined by the AMF based subscription information or local policy. Otherwise DNN determined by the AMF is the DNN requested by the UE.\nDNN requested by the UE: A DNN explicitly requested by the UE and included in a NAS request message.\nDNN selected by the network: If DNN replacement applies, a DNN selected and indicated to the AMF by PCF. Otherwise DNN selected by the network is the DNN determined by the AMF.\nDefault S-NSSAI: An S-NSSAI in the subscribed S-NSSAIs marked as default.\nGlobally-unique SNPN identity: An SNPN identity with an NID whose assignment mode is not set to 1 (see 3GPP\u00a0TS\u00a023.003\u00a0[4]).\nHPLMN S-NSSAI: An S-NSSAI applicable in the HPLMN without any further mapping by the network. If the UE has an EHPLMN list which is not empty, then the HPLMN S-NSSAIs are applicable without any further mapping in the PLMN whose PLMN code is derived from the IMSI, regardless of whether or not this PLMN is included in the EHPLMN list.\nThe UE considers as HPLMN S-NSSAIs at least the following S-NSSAIs:\na)\tany S-NSSAI included in the configured NSSAI or allowed NSSAI for a PLMN or SNPN if it is provided by\n1)\tthe HPLMN, if the EHPLMN list is not present or is empty;\n2)\tthe PLMN whose PLMN code is derived from the IMSI, if the EHPLMN list is available and not empty, regardless of whether or not the PLMN code derived from the IMSI is included in the EHPLMN list; or\n3)\tthe subscribed SNPN;\nb)\tany S-NSSAI provided as mapped S-NSSAI for the configured NSSAI or allowed NSSAI or partially allowed NSSAI for a PLMN or SNPN;\nc)\tany S-NSSAI associated with a PDU session if there is no mapped S-NSSAI associated with the PDU session and the UE is\n1)\tin the HPLMN, if the EHPLMN list is not present or is empty;\n2)\tthe PLMN whose PLMN code is derived from the IMSI, if the EHPLMN list is available and not empty, regardless of whether or not the PLMN code derived from the IMSI is included in the EHPLMN list; or\n3)\tin the subscribed SNPN; and\nd)\tany mapped S-NSSAI associated with a PDU session.\nNOTE\u00a03:\tThe above list is not intended to be complete. E.g., also in case of PLMN the S-NSSAIs included in URSP rules or in the signalling messages for network slice-specific authentication and authorization are HPLMN S-NSSAIs.\nUser plane CIoT 5GS optimization: Signalling optimizations to enable efficient transport of user data (IP, Ethernet or Unstructured) over the user plane.\nUE supporting CIoT 5GS optimizations: A UE that supports control plane CIoT 5GS optimization or user plane CIoT 5GS optimization and one or more other CIoT 5GS optimizations when the UE is in N1 mode.\nRegistered for 5GS services with control plane CIoT 5GS optimization: A UE supporting CIoT 5GS optimizations is registered for 5GS services, and control plane CIoT 5GS optimization along with one or more other CIoT 5GS optimizations have been accepted by the network.\nRegistered for 5GS services with user plane CIoT 5GS optimization: A UE supporting CIoT 5GS optimizations is registered for 5GS services, and user plane CIoT 5GS optimization along with one or more other CIoT 5GS optimizations have been accepted by the network.\nRegistered for 5GS services with CIoT 5GS optimization: A UE is registered for 5GS services with control plane CIoT 5GS optimization or registered for 5GS services with user plane CIoT 5GS optimization.\nDNN based congestion control: Type of congestion control at session management level that is applied to reject session management requests from UEs or release PDU sessions when the associated DNN is congested. DNN based congestion control can be activated at the SMF over session management level and also activated at the AMF over mobility management level.\nEmergency PDU session: A PDU session established with the request type \"initial emergency request\" or \"existing emergency PDU session\".\nGeneral NAS level congestion control: Type of congestion control at mobility management level that is applied at a general overload or congestion situation in the network, e.g. lack of processing resources.\nInitial NAS message: A NAS message is considered as an initial NAS message, if this NAS message can trigger the establishment of an N1 NAS signalling connection. For instance, the REGISTRATION REQUEST message is an initial NAS message.\nInitial registration for emergency services: A registration performed with 5GS registration type \"emergency registration\" in the REGISTRATION REQUEST message.\nInitial registration for onboarding services in SNPN: A registration performed with 5GS registration type \"SNPN onboarding registration\" in the REGISTRATION REQUEST message.\nInitial registration for disaster roaming services: A registration performed with 5GS registration type \"disaster roaming initial registration\" in the REGISTRATION REQUEST message.\nLast visited registered TAI: A TAI which is contained in the registration area that the UE registered to the network and which identifies the tracking area last visited by the UE. If the cell is a satellite NG-RAN cell broadcasting multiple TAIs, a TAI which is contained in the registration area that the UE registered to the network and last selected by the UE as the current TAI.\nMapped 5G-GUTI: A 5G-GUTI which is mapped from a 4G-GUTI previously allocated by an MME. Mapping rules are defined in 3GPP\u00a0TS\u00a023.003\u00a0[4].\nMapped S-NSSAI: An S-NSSAI in the subscribed S-NSSAIs for the HPLMN or the subscribed SNPN, to which an S-NSSAI of the registered PLMN (in case of a roaming scenario) or the registered non-subscribed SNPN is mapped.\nMBSR-UE: a UE that is operating as a MBSR and supporting UE NAS functionalities specified in this specification.\nMobility registration for disaster roaming services: A registration performed with 5GS registration type \"disaster roaming mobility registration updating\" in the REGISTRATION REQUEST message.\nMUSIM UE: A UE with multiple valid USIMs, capable of initiating and maintaining simultaneous separate registration states over 3GPP access with PLMN(s) using identities and credentials associated with those USIMs and supporting one or more of the N1 NAS signalling connection release, the paging indication for voice services, the reject paging request, the paging restriction and the paging timing collision control (see 3GPP\u00a0TS\u00a023.501\u00a0[8]).\nN1 mode: A mode of a UE allowing access to the 5G core network via the 5G access network.\nNative 5G-GUTI: A 5G-GUTI previously allocated by an AMF.\nNon 5G capable over WLAN (N5CW) device: A device that is not capable to operate as a UE supporting NAS signalling with the 5GCN over a WLAN access network. However, this device may be capable to operate as a UE supporting NAS signalling with 5GCN using the N1 reference point as specified in this specification over 3GPP access. An N5CW device may be allowed to access the 5GCN via trusted WLAN access network (TWAN) that supports a trusted WLAN interworking function (TWIF) as specified in 3GPP\u00a0TS\u00a024.502\u00a0[18].\nNon-CAG Cell: An NR cell which does not broadcast any Closed Access Group identity or an E-UTRA cell connected to 5GCN.\nNon-equivalent PLMN: A PLMN which is not an equivalent PLMN.\nNon-equivalent SNPN: An SNPN which is not an equivalent SNPN.\nNon-globally-unique SNPN identity: An SNPN identity with an NID whose assignment mode is set to 1 (see 3GPP\u00a0TS\u00a023.003\u00a0[4]).\nIn NB-N1 mode: Indicates this paragraph applies only to a system which operates in NB-N1 mode. For a multi-access system this case applies if the current serving radio access network provides access to network services via E-UTRA connected to 5GCN by NB-IoT (see 3GPP\u00a0TS\u00a036.300\u00a0[25B], 3GPP\u00a0TS\u00a036.331\u00a0[25A], 3GPP\u00a0TS\u00a036.306\u00a0[25D]).\nIn WB-N1 mode: Indicates this paragraph applies only to a system which operates in WB-N1 mode. For a multi-access system this case applies if the system operates in N1 mode with E-UTRA connected to 5GCN, but not in NB-N1 mode.\nIn WB-N1/CE mode: Indicates this paragraph applies only when a UE, which is a CE mode B capable UE (see 3GPP\u00a0TS\u00a036.306\u00a0[25D]), is operating in CE mode A or B in WB-N1 mode.\nInitial small data rate control parameters: Parameters that, if received by the UE during the establishment of a PDU session, are used as initial parameters to limit the allowed data for the PDU session according to small data rate control after establishment of a PDU session as described in subclause\u00a06.2.13. At expiry of the associated validity period, the initial small data rate control parameters are no longer valid and the small data rate control parameters apply.\nInitial small data rate control parameters for exception data: Parameters corresponding to initial small data rate control parameters for small data rate control of exception data.\nN1 NAS signalling connection: A peer to peer N1 mode connection between UE and AMF. An N1 NAS signalling connection is either the concatenation of an RRC connection via the Uu reference point and an NG connection via the N2 reference point for 3GPP access, or the concatenation of an IPsec tunnel via the NWu reference point and an NG connection via the N2 reference point for non-3GPP access.\nN5CW device supporting 3GPP access: An N5CW device which supports acting as a UE in 3GPP access (i.e. which supports NAS over 3GPP access).\nN6 PDU session: A PDU session established between the UE and the User Plane Function (UPF) for transmitting the UE's IP data, Ethernet data or Unstructured data related to a specific application.\nNEF PDU session: A PDU session established between the UE and the Network Exposure Function (NEF) for transmitting the UE's Unstructured data related to a specific application.\nNetwork slicing information: information stored at the UE consisting of one or more of the following:\na)\tdefault configured NSSAI for PLMN or SNPN;\nb)\tconfigured NSSAI for a PLMN or an SNPN;\nb1)\tNSSRG information for the configured NSSAI for a PLMN or an SNPN;\nb2)\tS-NSSAI location validity information for the configured NSSAI for a PLMN or an SNPN;\nb3)\tS-NSSAI time validity information for the configured NSSAI for a PLMN or an SNPN;\nc)\tmapped S-NSSAI(s) for the configured NSSAI for a PLMN or an SNPN;\nd)\tpending NSSAI for a PLMN or an SNPN;\ne)\tmapped S-NSSAI(s) for the pending NSSAI for a PLMN or an SNPN;\nf)\trejected NSSAI for the current PLMN or SNPN;\ng)\tmapped S-NSSAI(s) for the rejected NSSAI for the current PLMN or an SNPN;\nh)\trejected NSSAI for the failed or revoked NSSAA;\ni)\tfor each access type:\n1)\tallowed NSSAI for a PLMN or an SNPN;\n2)\tmapped S-NSSAI(s) for the allowed NSSAI for a PLMN;\n3)\trejected NSSAI for the current registration area;\n4)\tmapped S-NSSAI(s) for the rejected NSSAI for the current registration area;\n5)\trejected NSSAI for the maximum number of UEs reached;\n6)\tmapped S-NSSAI(s) for the rejected NSSAI for the maximum number of UEs reached;\n7)\talternative NSSAI for a PLMN or an SNPN; and\n8)\ton-demand NSSAI for a PLMN or an SNPN; and\nj)\tfor 3GPP access type:\n1)\tNSAG information for the configured NSSAI for a PLMN or an SNPN;\n2)\tpartially allowed NSSAI for a PLMN or an SNPN;\n3)\tmapped S-NSSAI(s) for the partially allowed NSSAI for a PLMN or an SNPN;\n4)\tpartially rejected NSSAI for a PLMN or an SNPN; and\n5)\tmapped S-NSSAI(s) for the partially rejected NSSAI for a PLMN or an SNPN;\nNG-RAN cell: A cell with NG-RAN access technology or satellite NG-RAN access technology.\nNITZ information: Network Identity and Time Zone (NITZ) information includes full name for network, short name for network, local time zone, universal time and local time zone, network daylight saving time.\nNon-cleartext IEs: Information elements that are not cleartext IEs.\nNon-emergency PDU session: Any PDU session which is not an emergency PDU session.\nNon-satellite NG-RAN cell: A cell with NG-RAN access technology.\nOnboarding SUCI: SUCI derived from onboarding SUPI.\nOnboarding SUPI: SUPI with the SUPI format \"network specific identifier\" containing a network specific identifier or with the SUPI format \"IMSI\" containing an IMSI, derived by a UE in SNPN access operation mode, from default UE credentials for primary authentication and used to identify the UE during initial registration for onboarding services in SNPN and while registered for onboarding services in SNPN.\nOn-demand S-NSSAI: An S-NSSAI that the UE is allowed to be registered with the network only when this S-NSSAI is used by the UE to establish a PDU session for user data transmission.\nPartially rejected NSSAI: Indicating the S-NSSAI(s) is rejected by the network in some TA(s) but not all TAs of the registration area. Each S-NSSAI in the partially rejected NSSAI is associated with a list of TAs where the S-NSSAI is rejected.\nPDU address: An IP address assigned to the UE by the packet data network.\nPDU session for LADN: A PDU session with a DNN associated with an LADN or a PDU session with a DNN and an S-NSSAI associated with an LADN.\nPDU session with suspended user-plane resources: A PDU session for which user-plane resources were established or re-established, and for which data radio bearers were suspended when transition to 5GMM-CONNECTED mode with RRC inactive indication.\nPersistent PDU session: Either a non-emergency PDU session contains a GBR QoS flow with QoS equivalent to QoS of teleservice 11 and where there is a radio bearer associated with that PDU session over 3GPP access, or an emergency PDU session where there is a radio bearer associated with that PDU session over 3GPP access.\nNOTE\u00a04:\tAn example of a persistent PDU session is a non-emergency PDU session with 5QI\u00a0=\u00a01 where there is a radio bearer associated with that context.\nProcedure transaction identity: An identity which is dynamically allocated by the UE for the UE-requested 5GSM procedures or allocated by the UE or the PCF for the UE policy delivery procedures. The procedure transaction identity is released when the procedure is completed but it should not be released immediately.\nRAT frequency selection priority index: A parameter provided by the AMF to the NG-RAN via the N2 reference point. The AMF selects an RFSP index for a particular UE based on the subscribed RFSP index, the locally configured operator's policies, the allowed NSSAI, the partially allowed NSSAI, the partially rejected NSSAI, the rejected NSSAI for the current registration area, the pending NSSAI and the UE context information, including the UE's usage setting, if received during the registration procedure. Definition derived from 3GPP\u00a0TS\u00a023.501\u00a0[8].\nRegistered for disaster roaming services: A UE is considered as \"registered for disaster roaming services\" when it has successfully completed initial registration or mobility registration for disaster roaming services.\nRegistered for emergency services: A UE is considered as \"registered for emergency services\" when it has successfully completed initial registration for emergency services.\nRegistered for onboarding services in SNPN: A UE is considered as \"registered for onboarding services in SNPN\" when it has successfully completed initial registration for onboarding services in SNPN. While registered for onboarding services in SNPN, services other than the onboarding services are not available.\nRegistered PLMN: The PLMN on which the UE performed the last successful registration. The identity of the registered PLMN (MCC and MNC) is provided to the UE within the GUAMI field of the 5G-GUTI.\nRejected NSSAI: Rejected NSSAI for the current PLMN or SNPN, rejected NSSAI for the current registration area, rejected NSSAI for the failed or revoked NSSAA or rejected NSSAI for the maximum number of UEs reached.\nNOTE\u00a05:\tRejected NSSAI for the current PLMN or SNPN, rejected NSSAI for the current registration area or rejected NSSAI for the maximum number of UEs reached contains a set of S-NSSAI(s) associated with a PLMN identity or SNPN identity for the current PLMN or SNPN and in roaming scenarios also contains a set of mapped S-NSSAI(s) if available. Rejected NSSAI for the failed or revoked NSSAA only contains a set of S-NSSAI(s) associated with a PLMN identity or SNPN identity for the HPLMN or RSNPN.\nRejected NSSAI for the current PLMN or SNPN: A set of S-NSSAI(s) which was included in the requested NSSAI by the UE and is sent by the AMF with the rejection cause \"S-NSSAI not available in the current PLMN or SNPN\".\nRejected NSSAI for the current registration area: A set of S-NSSAI(s) which was included in the requested NSSAI by the UE and is sent by the AMF with the rejection cause \"S-NSSAI not available in the current registration area\".\nRejected NSSAI for the failed or revoked NSSAA: A set of S-NSSAI(s) which is sent by the AMF with the rejection cause \"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\".\nRejected NSSAI for the maximum number of UEs reached: A set of S-NSSAI(s) which was included in the requested NSSAI by the UE and is sent by the AMF with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\".\nLocal release: Release of a PDU session without peer-to-peer signalling between the network and the UE.\nNOTE\u00a06:\tLocal release can include communication among network entities.\nRemoval of eCall only mode restriction: All the limitations as described in 3GPP\u00a0TS\u00a022.101\u00a0[2] for the eCall only mode do not apply any more.\nSatellite NG-RAN cell: A cell with satellite NG-RAN access technology.\nSNPN access operation mode: A UE operating in SNPN access operation mode only selects SNPNs. This includes the case when the UE is accessing an SNPN over 3GPP access, the case when the UE is accessing an SNPN over non-3GPP access and the case where the UE is accessing SNPN services via a PLMN\nNOTE\u00a07:\tIn this release of specification, the term \"SNPN access operation mode\" is the same as the term \"SNPN access mode\" used in 3GPP\u00a0TS\u00a023.501\u00a0[8].\nS-NSSAI based congestion control: Type of congestion control at session management level that is applied to reject session management requests from UEs or release PDU sessions when the associated S-NSSAI and optionally the associated DNN are congested. S-NSSAI based congestion control can be activated at the SMF over session management level and also activated at the AMF over mobility management level.\nSatellite NG-RAN RAT type: In case of satellite NG-RAN access, RAT types are used to distinguish different types of satellite NG-RAN access, as defined in 3GPP\u00a0TS\u00a038.413\u00a0[31]. In this version of the specification, the defined satellite NG-RAN RAT types are \"NR(LEO)\", \"NR(MEO)\" and \"NR(GEO)\".\nSelected core network type information: A type of core network (EPC or 5GCN) selected by the UE NAS layer in case of an E-UTRA cell connected to both EPC and 5GCN.\nUE supporting UAS services: A UE which supports an aerial vehicle, such as a drone, with an onboard or built-in USIM and is able to perform UE NAS functionalities specified in this specification. Upper layers of the UE supporting UAS services are responsible for UAS related procedures, such as UUAA and C2 authorization, for which the NAS layer of the UE supporting UAS services performs the necessary NAS procedures.\nUE configured for high priority access in selected PLMN: A UE configured with one or more access identities equal to 1, 2, or 11-15 applicable in the selected PLMN as specified in subclause\u00a04.5.2. Definition derived from 3GPP\u00a0TS\u00a022.261\u00a0[3].\nUE operating in single-registration mode in a network supporting N26 interface: A UE, supporting both N1 mode and S1 mode. During the last attach, tracking area update (see 3GPP\u00a0TS\u00a024.301\u00a0[15]) or registration procedures, the UE has received either a 5GS network feature support IE with IWK N26 bit set to \"interworking without N26 interface not supported\" or an EPS network feature support IE with IWK N26 bit set to \"interworking without N26 interface not supported\".\nUE using 5GS services with control plane CIoT 5GS optimization: A UE that is registered for 5GS services with the control plane CIOT 5GS optimization accepted by the network.\nUser Plane Positioning Connection Management Information (UPP-CMI): The messages defined in clause\u00a06 of 3GPP\u00a0TS\u00a024.572\u00a0[64] that is utilized to manage the user plane connection between the UE and the LMF for LCS-UPP.\nUser-plane resources: Resources established between the UE and the UPF. The user-plane resources consist of one of the following:\n-\tuser plane radio bearers via the Uu reference point, a tunnel via the N3 reference point and a tunnel via the N9 reference point (if any) for 3GPP access;\n-\tIPsec tunnels via the NWu reference point, a tunnel via the N3 reference point and a tunnel via the N9 reference point (if any) for untrusted non-3GPP access;\n-\tIPsec tunnels via the NWt reference point, a tunnel via the N3 reference point and a tunnel via the N9 reference point (if any) for trusted non-3GPP access used by the UE;\n-\ta layer-2 connection via the Yt reference point, a layer-2 or layer-3 connection via the Yw reference point, a tunnel via the N3 reference point and a tunnel via the N9 reference point (if any) for trusted non-3GPP access used by the N5CW device;\n-\tW-UP resources via Y4 reference point, a tunnel via the N3 reference point and a tunnel via the N9 reference point (if any) for wireline access used by the 5G-RG; and\n-\tL-W-UP resources via Y5 reference point, a tunnel via the N3 reference point and a tunnel via the N9 reference point (if any) for wireline access used by the FN-RG.\nW-AGF acting on behalf of the N5GC device: A W-AGF that enables an N5GC device behind a 5G-CRG or an FN-CRG to connect to the 5G Core.\nUE configured for high priority access in selected SNPN: A UE configured with one or more access identities equal to 1, 2, or 11-15 applicable in the selected SNPN as specified in subclause\u00a04.5.2A.\nUE policy section identifier: A UE policy section identifier (UPSI) is an identifier of a UE policy section, which is composed of the MCC and MNC of:\n-\tthe PLMN ID of a PLMN of the PCF which provides the UE policy section, and a UE policy section code (UPSC), assigned by the PCF in that PLMN; or\n-\tthe PLMN ID part of an SNPN of the PCF which provides the UE policy section, and a UPSC, assigned by the PCF in that SNPN.\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 22.261\u00a0[3] apply:\nNon-public network\nDisaster Roaming\nsatellite NG-RAN\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a023.003\u00a0[4] apply:\n5G-GUTI\n5G-S-TMSI\n5G-TMSI\nGlobal Line Identifier (GLI)\nGlobal Cable Identifier (GCI)\nGUAMI\nIMEI\nIMEISV\nIMSI\nPEI\nSUPI\nSUCI\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a023.122\u00a0[5] apply:\nAccess Technology\nCAG selection\nCAG-ID authorized based on \"Allowed CAG list\"\nCountry\nEHPLMN\nHPLMN\nOnboarding services in SNPN\nRegistered SNPN\nSelected PLMN\nSelected SNPN\nShared network\nSNPN identity\nSteering of roaming SNPN selection information (SOR-SNPN-SI)\nSteering of roaming SNPN selection information for localized services in SNPN (SOR-SNPN-SI-LS)\nSteering of Roaming (SOR)\nSteering of roaming connected mode control information (SOR-CMCI)\nSteering of Roaming information\nSubscribed SNPN\nSuitable cell\nVPLMN\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a023.167\u00a0[6] apply:\neCall over IMS\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a023.216\u00a0[6A] apply:\nSRVCC\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a023.401\u00a0[7] apply:\neCall only mode\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a023.501\u00a0[8] apply:\n5G access network\n5G core network\n5G QoS flow\n5G QoS identifier\n5G-RG\n5G-BRG\n5G-CRG\n5G System\n5G VN Group\nAllowed area\nAllowed NSSAI\nAlternative S-NSSAI\nAMF region\nAMF set\nClosed access group\nConfigured NSSAI\nCredentials Holder (CH)\nDefault Credentials Server (DCS)\nGroup ID for Network Selection (GIN)\nIAB-node\nLocal area data network\nMobile Base Station Relay\nN3QAI\nNetwork identifier (NID)\nNetwork slice\nNetwork slice area of service\nNG-RAN\nNon-allowed area\nOnboarding Standalone Non-Public Network\nPartially allowed NSSAI\nPDU connectivity service\nPDU session\nPDU session type\nPDU set\nPEGC\nPEMC\nPending NSSAI\nPIN\nPIN direct communication\nPIN indirect communication\nPIN-DN communication\nPINE\nRequested NSSAI\nRouting Indicator\nService data flow\nService Gap Control\nServing PLMN rate control\nSmall data rate control status\nSNPN-enabled UE\nStand-alone Non-Public Network\nTime Sensitive Communication\nTime Sensitive Communication and Time Synchronization Function\nUE-DS-TT residence time\nUE-Slice-MBR\nUE presence in LADN service area\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a023.503\u00a0[10] apply:\nUE local configuration\nVPLMN specific (VPS) URSP\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a024.008\u00a0[12] apply:\nGMM\nMM\nA/Gb mode\nIu mode\nGPRS\nNon-GPRS\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a024.301\u00a0[15] apply:\nCIoT EPS optimization\nControl plane CIoT EPS optimization\nEENLV\nEMM\nEMM-DEREGISTERED\nEMM-DEREGISTERED-INITIATED\nEMM-IDLE mode\nEMM-NULL\nEMM-REGISTERED\nEMM-REGISTERED-INITIATED\nEMM-SERVICE-REQUEST-INITIATED\nEMM-TRACKING-AREA-UPDATING-INITIATED\nEPS\nEPS security context\nEPS services\nLower layer failure\nMegabit\nMessage header\nNAS signalling connection recovery\nNative GUTI\nNB-S1 mode\nNon-EPS services\nS1 mode\nUser plane CIoT EPS optimization\nWB-S1 mode\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a033.501\u00a0[24] apply:\n5G security context\n5G NAS security context\nABBA\nCurrent 5G NAS security context\nDefault UE credentials for primary authentication\nDefault UE credentials for secondary authentication\nFull native 5G NAS security context\nK'AME\nKAMF\nKASME\nMapped 5G NAS security context\nMapped security context\nNative 5G NAS security context\nNCC\nNon-current 5G NAS security context\nPartial native 5G NAS security context\nRES*\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a038.413\u00a0[31] apply:\nNG connection\nUser Location Information\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a024.587\u00a0[19B] apply:\nE-UTRA-PC5\nNR-PC5\nV2X\nFor the purposes of the present document, the following terms and its definitions given in 3GPP\u00a0TS\u00a023.256\u00a0[6AB] apply:\n3GPP UAV ID\nCAA (Civil Aviation Administration)-Level UAV Identity\nCommand and Control (C2) Communication\nUAV controller (UAV-C)\nUAS Services\nUAS Service Supplier (USS)\nUncrewed Aerial System (UAS)\nUSS communication\nUUAA\nUUAA-MM\nUUAA-SM\nDirect C2 communication\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a024.554\u00a0[19E] apply:\n5G ProSe\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a023.548\u00a0[10A] apply:\nEdge Application Server\nEdge DNS Client\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a024.526\u00a0[19] apply:\nPLMN generic (PG) URSP\nNon-subscribed SNPN signalled URSP\nVPLMN specific (VPS) URSP of the RPLMN\nVPLMN specific (VPS) URSP of the equivalent PLMN of the RPLMN\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a024.577\u00a0[60] apply:\nA2X\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a024.514\u00a0[62] apply:\nRSLPP\nA2XP\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a023.316\u00a0[6D] apply:\nAuthenticable Non-3GPP device (AUN3)\nNon-Authenticable Non-3GPP device (NAUN3)\n\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a023.586\u00a0[63] apply:\nSL Positioning Server UE\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a038.300\u00a0[27] apply:\nNCR-MT\nFor the purposes of the present document, the following terms and definitions given in 3GPP\u00a0TS\u00a024.572\u00a0[64] apply:\nLCS-UPP\nUPP-CM\n3.2\tAbbreviations\nFor the purposes of the present document, the abbreviations given in 3GPP\u00a0TR\u00a021.905\u00a0[1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR\u00a021.905\u00a0[1].\n4G-GUTI\t4G-Globally Unique Temporary Identifier\n5GCN\t5G Core Network\n5G-GUTI\t5G-Globally Unique Temporary Identifier\n5GMM\t5GS Mobility Management\n5G-RG\t5G Residential Gateway\n5G-BRG\t5G Broadband Residential Gateway\n5G-CRG\t5G Cable Residential Gateway\n5GS\t5G System\n5GSM\t5GS Session Management\n5G-S-TMSI\t5G S-Temporary Mobile Subscription Identifier\n5G-TMSI\t5G Temporary Mobile Subscription Identifier\n5QI\t5G QoS Identifier\nACS\tAuto-Configuration Server\nAKA\tAuthentication and Key Agreement\nAKMA\tAuthentication and Key Management for Applications\nA-KID\tAKMA Key Identifier\nA-TID\tAKMA Temporary Identifier\nAMBR\tAggregate Maximum Bit Rate\nAMF\tAccess and Mobility Management Function\nANDSP\tAccess Network Discovery and Selection Policy\nAPN\tAccess Point Name\nAS\tAccess stratum\nATSSS\tAccess Traffic Steering, Switching and Splitting\nAUSF\tAuthentication Server Function\nCAG\tClosed access group\nCGI\tCell Global Identity\nCHAP\tChallenge Handshake Authentication Protocol\nDDX\tDownlink Data Expected\nDL\tDownlink\nDN\tData Network\nDNN\tData Network Name\nDNS\tDomain Name System\nDS-TT\tDevice-Side TSN Translator\neDRX\tExtended DRX cycle\nePDG\tEvolved Packet Data Gateway\nEUI\tExtended Unique Identifier\nE-UTRAN\tEvolved Universal Terrestrial Radio Access Network\nEAC\tEarly Admission Control\nEAP-AKA'\tImproved Extensible Authentication Protocol method for 3rd generation Authentication and Key Agreement\nEAS\tEdge Application Server\nEASDF\tEdge Application Server Discovery Function\nECIES\tElliptic Curve Integrated Encryption Scheme\nECS\tEdge Configuration Server\nECSP\tEdge Computing Service Provider\nEDC\tEdge DNS Client\nEEC\tEdge Enabler Client\nEPD\tExtended Protocol Discriminator\nEMM\tEPS Mobility Management\nEPC\tEvolved Packet Core Network\nEPS\tEvolved Packet System\nEPS-UPIP\tUser-plane integrity protection in EPS\nESM\tEPS Session Management\nFN-RG\tFixed Network RG\nFN-BRG\tFixed Network Broadband RG\nFN-CRG\tFixed Network Cable RG\nFQDN\tFully Qualified Domain Name\nGbps\tGigabits per second\nGEO\tGeostationary Orbit\nGFBR\tGuaranteed Flow Bit Rate\nGUAMI\tGlobally Unique AMF Identifier\nIAB\tIntegrated access and backhaul\nIMEI\tInternational Mobile station Equipment Identity\nIMEISV\tInternational Mobile station Equipment Identity and Software Version number\nIMSI\tInternational Mobile Subscriber Identity\nIP-CAN\tIP-Connectivity Access Network\nKSI\tKey Set Identifier\nLADN\tLocal Area Data Network\nLCS\tLoCation Services\nLCS-UPP\tLocation Services User Plane Protocol\nLEO\tLow Earth Orbit\nLMF\tLocation Management Function\nLPP\tLTE Positioning Protocol\nMAC\tMessage Authentication Code\nMA PDU\tMulti-Access PDU\nMBS\tMulticast/Broadcast Services\nMBSR\tMobile Base Station Relay\nMbps\tMegabits per second\nMCS\tMission Critical Service\nMEO\tMedium Earth Orbit\nMFBR\tMaximum Flow Bit Rate\nMICO\tMobile Initiated Connection Only\nMINT\tMinimization of Service Interruption\nMPS\tMultimedia Priority Service\nMSK\tMBS Service Key\nMTK\tMBS Traffic Key\nMUSIM\tMulti-USIM\nN3IWF\tNon-3GPP Inter-Working Function\nN3QAI\tNon-3GPP QoS Assistance Information\nN5CW\tNon-5G-Capable over WLAN\nN5GC\tNon-5G Capable\nNAI\tNetwork Access Identifier\nNITZ\tNetwork Identity and Time Zone\nngKSI\tKey Set Identifier for Next Generation Radio Access Network\nNPN\tNon-public network\nNR\tNew Radio\nNSAC\tNetwork Slice Admission Control\nNSACF\tNetwork Slice Admission Control Function\nNSAG\tNetwork slice AS group\nNS-AoS\tNetwork slice area of service\nNSSAA\tNetwork slice-specific authentication and authorization\nNSSAAF\tNetwork Slice-Specific and SNPN authentication and authorization Function\nNSSAI\tNetwork Slice Selection Assistance Information\nNSSRG\tNetwork Slice Simultaneous Registration Group\nON-SNPN\tOnboarding Standalone Non-Public Network\nOS\tOperating System\nOS Id\tOS Identity\nPAP\tPassword Authentication Protocol\nPCO\tProtocol Configuration Option\nPEI\tPermanent Equipment Identifier\nPEIPS\tPaging Early Indication with Paging Subgrouping\nPEGC\tPIN Element with Gateway Capability\nPEMC\tPIN Element with Management Capability\nPIN\tPersonal IoT Network\nPINE\tPIN Element\nPNI-NPN\tPublic Network Integrated Non-Public Network\nProSe\tProximity based Services\nProSeP\t5G ProSe policy\nPG\tPLMN Generic\nPTI\tProcedure Transaction Identity\nPTP\tPrecision Time Protocol\nPVS\tProvisioning Server\nQFI\tQoS Flow Identifier\nQoS\tQuality of Service\nQRI\tQoS Rule Identifier\nRACS\tRadio Capability Signalling Optimisation\n(R)AN\t(Radio) Access Network\nRFSP\tRAT Frequency Selection Priority\nRG\tResidential Gateway\nRPLMN\tRegistered PLMN\nRQA\tReflective QoS Attribute\nRQI\tReflective QoS Indication\nRSC\tRelay Service Code\nRSN\tRedundancy Sequence Number\nRSNPN\tRegistered SNPN\nS-NSSAI\tSingle NSSAI\nSA\tSecurity Association\nSDF\tService Data Flow\nSDNAEPC\tSecondary DN authentication and authorization over EPC\nSDT\tSmall Data Transmission\nSMF\tSession Management Function\nSGC\tService Gap Control\nSLPP\tSideLink Positioning Protocol\nSNN\tServing Network Name\nSNPN\tStand-alone Non-Public Network\nSOR\tSteering of Roaming\nSOR-CMCI\tSteering of Roaming Connected Mode Control Information\nSUCI\tSubscription Concealed Identifier\nSUPI\tSubscription Permanent Identifier\nTA\tTracking Area\nTAC\tTracking Area Code\nTAI\tTracking Area Identity\nTbps\tTerabits per second\nTMGI\tTemporary Mobile Group Identity\nTNAN\tTrusted Non-3GPP Access Network\nTNGF\tTrusted Non-3GPP Gateway Function\nTSC\tTime Sensitive Communication\nTSCTSF\tTime Sensitive Communication and Time Synchronization Function\nTWIF\tTrusted WLAN Interworking Function\nTSN\tTime-Sensitive Networking\nUAS\tUncrewed Aerial System\nUAV\tUncrewed Aerial Vehicle\nUAV-C\tUncrewed Aerial Vehicle-Controller\nUDM\tUnified Data Management\nUL\tUplink\nUPDS\tUE policy delivery service\nUPF\tUser Plane Function\nUP-PRUK\tUser Plane ProSe Remote User Key\nUPP-CM\tUser Plane Positioning Connection Management\nUPSC\tUE Policy Section Code\nUPSI\tUE Policy Section Identifier\nURN\tUniform Resource Name\nURSP\tUE Route Selection Policy\nUSS\tUAS Service Supplier\nUUAA\tUSS UAV Authorization/Authentication\nV2X\tVehicle-to-Everything\nV2XP\tV2X policy\nVPS\tVPLMN Specific\nW-AGF\tWireline Access Gateway Function\nWLAN\tWireless Local Area Network\nWUS\tWake-up signal\n4\tGeneral\n4.1\tOverview\nThe non-access stratum (NAS) described in the present document forms the highest stratum of the control plane between UE and AMF (reference point \"N1\" see 3GPP\u00a0TS\u00a023.501\u00a0[8]) for both 3GPP and non-3GPP access.\nMain functions of the protocols that are part of the NAS are:\n-\tsupport of mobility of the user equipment (UE) including also common procedures such as authentication, identification, generic UE configuration update and security mode control procedures;\n-\tsupport of session management procedures to establish and maintain data connectivity between the UE and the data network; and\n-\tNAS transport procedure to provide a transport of SMS, LPP, SLPP, LCS, UPP-CMI container, UE policy container, SOR transparent container and UE parameters update information payload.\nPrinciples for the handing of 5GS security contexts and for the activation of ciphering and integrity protection, when a NAS signalling connection is established, are provided in subclause\u00a04.4.\nFor the support of the above functions, the following procedures are supplied within this specification:\n-\telementary procedures for 5GS mobility management in clause\u00a05; and\n-\telementary procedures for 5GS session management in clause\u00a06.\nSignalling procedures for the control of NAS security are described as part of the 5GMM common procedures in subclause\u00a05.4.\nComplete NAS transactions consist of specific sequences of elementary procedures. Examples of such specific sequences can be found in 3GPP\u00a0TS\u00a023.502\u00a0[9].\nThe NAS for 5GS follows the protocol architecture model for layer\u00a03 as described in 3GPP\u00a0TS\u00a024.007\u00a0[11].\n4.2\tCoordination between the protocols for 5GS mobility management and 5GS session management\nA 5GS session management (5GSM) message is piggybacked in specific 5GS mobility management (5GMM) transport messages. To this purpose, the 5GSM messages can be transmitted in an information element in the 5GMM transport messages. In this case, the UE, the AMF and the SMF execute the 5GMM procedure and the 5GSM procedure in parallel. The success of the 5GMM procedure is not dependent on the success of the piggybacked 5GSM procedure.\nThe UE can only initiate the 5GSM procedure when there is a 5GMM context established at the UE.\nDuring 5GMM procedures, the UE and the AMF shall suspend the transmission of 5GSM messages, except when:\na)\tthe 5GMM procedure is piggybacking 5GSM messages; or\nb)\tthe UE is in 5GMM-CONNECTED mode and a service request procedure for re-establishing user-plane resources of PDU session(s) is initiated without including PDU session status IE or Allowed PDU session status IE. In this case, the UE and the AMF need not suspend the transmission of 5GSM messages related to other PDU session(s) than the one(s) for which the user- plane resources re-establishment is requested.\nIf the UE determines to locally release the N1 NAS signalling connection upon receiving an SOR transparent container during a registration procedure as specified in 3GPP TS 23.122 [5] Annex C.2, the UE shall suspend the transmission of 5GSM messages after sending the REGISTRATION COMPLETE message and until the N1 NAS signalling connection is released to obtain service on a higher priority PLMN, with the exception of the case when the UE has an emergency PDU session.\nA 5GMM message piggybacking a 5GSM message for a PDU session shall be delivered via the access associated with the PDU session, if any, with the following exceptions:\na)\tthe AMF shall send, via 3GPP access, a DL NAS TRANSPORT message piggybacking a downlink 5GSM message of a network-requested 5GSM procedure for a PDU session associated with non-3GPP access if the conditions specified in subclause\u00a05.5.1.3.4 or subclause\u00a05.6.1.4 are met;\nb)\tthe UE shall send an UL NAS TRANSPORT message piggybacking a response message to the 5GSM message described in a) via either:\n1)\t3GPP access; or\n2)\tnon-3GPP access if the UE is in 5GMM-CONNECTED mode over non-3GPP access; and\nNOTE:\tThe interaction between the 5GMM sublayer and the 5GSM sublayer to enable the UE to send the UL NAS TRANSPORT message containing the response message via 3GPP access is required. This is achieved via UE implementation.\nc)\tthe UE shall send, via the target access, an UL NAS TRANSPORT message piggybacking a 5GSM message associated with a request type set to \"existing PDU session\" or \"existing emergency PDU session\" for handover of an existing PDU session between 3GPP access and non-3GPP access.\nA 5GMM message piggybacking a 5GSM message as a response message to a request message associated with an MA PDU session, shall be delivered via the same access that the initial message was received.\n4.3\tUE domain selection\n4.3.1\tUE's usage setting\nThe UE's usage setting defined in 3GPP\u00a0TS\u00a024.301\u00a0[15] applies to voice capable UEs in 5GS and indicates whether the UE has preference for voice services over data services or vice-versa, where:\na)\tvoice services include IMS voice; and\nb)\tdata services include any kind of user data transfer without a voice media component.\nThe UE's usage setting can be set to:\na)\t\"voice centric\"; or\nb)\t\"data centric\".\n If the UE is capable of S1 mode, there is a single UE's usage setting at the UE which applies to both 5GS and EPS.\n4.3.2\tDomain selection for UE originating sessions / calls\nThe behaviour of the UE for domain selection is determined by:\na)\tthe UE usage setting;\nb)\tthe availability of IMS voice; and\nc)\twhether the UE operates in single-registration mode or dual-registration mode (see 3GPP\u00a0TS\u00a023.501\u00a0[8]).\nIn the present document the condition \"the UE supports IMS voice over 3GPP access\" evaluates to \"true\" if at least one of the following is fulfilled:\n1)\tthe UE supports IMS voice over NR connected to 5GCN;\n2)\tthe UE supports IMS voice over E-UTRA connected to 5GCN; or\n3)\tthe UE supports IMS voice in EPS.\nIn the present document the condition \"the UE does not support IMS voice over 3GPP access\" evaluates to \"true\" if the condition \"the UE supports IMS voice over 3GPP access\" evaluates to \"false\".\nIn the present document the condition \"the UE supports IMS voice over non-3GPP access\" evaluates to \"true\" if the UE supports IMS voice over non-3GPP access connected to 5GCN.\nIn the present document the condition \"the UE does not support IMS voice over non-3GPP access\" evaluates to \"true\" if the condition \"the UE supports IMS voice over non-3GPP access\" evaluates to \"false\".\nIn the present document, \"IMS voice not available\" is determined per access type independently, i.e. 3GPP access or non-3GPP access.\nIn the present document, \"IMS voice not available\" refers to one of the following conditions:\na)\tthe UE does not support IMS voice;\nb)\tthe UE supports IMS voice, but the network indicates in the REGISTRATION ACCEPT message that IMS voice over PS sessions are not supported; or\nc)\tthe UE supports IMS voice, the network indicates in the REGISTRATION ACCEPT message that IMS voice over PS sessions are supported, but the upper layers:\n1)\tprovide no indication that the UE is available for voice call in the IMS within a manufacturer determined period of time; or\n2)\tindicate that the UE is not available for voice calls in the IMS.\nNOTE\u00a01:\tIf conditions\u00a0a and b evaluate to false, the upper layers need time to attempt IMS registration. In the event an indication from the upper layers that the UE is available for voice calls in the IMS takes longer than the manufacturer determined period of time (e.g. due to delay when attempting IMS registration or due to delay in obtaining a QoS flow for SIP signalling), the NAS layer assumes the UE is not available for voice calls in the IMS.\nOther conditions may exist but these are implementation specific.\nIn the present document, \"IMS voice available\" applies when \"IMS voice not available\" does not apply.\nWhen IMS voice is not available over 3GPP access, if the UE's usage setting is \"voice centric\", the UE operates in single-registration mode, and the UE:\na)\tdoes not have a persistent PDU session, and:\n1)\tif the UE is only registered over 3GPP access, or if the UE is registered over both 3GPP access and non-3GPP access and IMS voice is not available over non-3GPP access, the UE shall disable the N1 mode capability for 3GPP access and proceed as specified in subclause\u00a04.9.2 with modifications described below; or\n2)\tif the UE is registered over both 3GPP access and non-3GPP access and IMS voice is available over non-3GPP access, the UE may disable the N1 mode capability for 3GPP access and proceed as specified in subclause\u00a04.9.2 with modifications described below; or\nb)\thas a persistent PDU session, then the UE waits until the radio bearer associated with the persistent PDU session has been released. When the radio bearer associated with the persistent PDU session has been released, then:\n1)\tif the UE is only registered over 3GPP access, or if the UE is registered over both 3GPP access and non-3GPP access and IMS voice is not available over non-3GPP access,the UE shall disable the N1 mode capability for 3GPP access and proceed as specified in subclause\u00a04.9.2 with modifications described below; or\n2)\tIf the UE is registered over both 3GPP access and non-3GPP access and IMS voice is available over non-3GPP access, the UE may disable the N1 mode capability for 3GPP access and proceed as specified in subclause\u00a04.9.2 with modifications described below.\nThe following modifications are applied to the procedure in subclause\u00a04.9.2 for disabling the N1 mode capability for 3GPP access, if the UE's usage setting is \"voice centric\" and the UE operates in single-registration mode:\na)\tin item\u00a0a) of subclause\u00a04.9.2, the UE shall attempt to select an E-UTRA cell connected to EPC. If such a cell is found, the UE shall then perform voice domain selection procedures as defined in 3GPP\u00a0TS\u00a024.301\u00a0[15]; and\nb)\tin item\u00a0b) of subclause\u00a04.9.2, if an E-UTRA cell connected to EPC cannot be found, the UE shall attempt to select another supported radio access technology which supports voice services.\nWhen IMS voice is not available over non-3GPP access, if the UE's usage setting is \"voice centric\" and the UE operates in single-registration mode, then:\na)\tif the UE is only registered over non-3GPP access, the UE shall disable the N1 mode capability for non-3GPP access (see subclause\u00a04.9.3); or\nb)\tif the UE is registered over both 3GPP access and non-3GPP access and IMS voice is not available also over 3GPP access, the UE may disable the N1 mode capability for non-3GPP access (see subclause\u00a04.9.3).\nNOTE\u00a02: \tThe UE can register over 3GPP access in another mode, e.g., S1 mode, for voice service, and in this case the UE can keep the N1 mode capability for non-3GPP access enabled.\n4.3.3\tChange of UE's usage setting\nIf the UE operates in single-registration mode, whenever the UE's usage setting changes, the UE shall execute procedures according to table\u00a04.3.3.1:\nTable\u00a04.3.3.1: Change of UE's usage setting for a UE in single-registration mode\n\n4.3.4\tChange or determination of IMS voice availability\nIf the UE operates in single-registration mode, whenever the IMS voice availability is determined or changes, the UE shall execute procedures according to table\u00a04.3.4.1:\nTable\u00a04.3.4.1: Change of IMS voice availability for a UE in single-registration mode\n\n4.4\tNAS security\n4.4.1\tGeneral\nThis clause describes the principles for the handling of 5G NAS security contexts in the UE and in the AMF, the procedures used for the security protection of NAS messages between the UE and the AMF, and the procedures used for the protection of NAS IEs between the UE and the UDM. Security protection involves integrity protection and ciphering of the 5GMM messages. 5GSM messages are security protected indirectly by being piggybacked by the security protected 5GMM messages (i.e. UL NAS TRANSPORT message and the DL NAS TRANSPORT message).\nThe signalling procedures for the control of NAS security are part of the 5GMM protocol and are described in detail in clause\u00a05.\nNOTE:\tThe use of ciphering in a network is an operator option. In this subclause, for the ease of description, it is assumed that ciphering is used, unless explicitly indicated otherwise. Operation of a network without ciphering is achieved by configuring the AMF so that it always selects the \"null ciphering algorithm\", 5G-EA0.\n4.4.2\tHandling of 5G NAS security contexts\n4.4.2.1\tGeneral\n4.4.2.1.1\tEstablishment of 5G NAS security context\nThe security parameters for authentication, integrity protection and ciphering are tied together in a 5G NAS security context and identified by a key set identifier (ngKSI). The relationship between the security parameters is defined in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nBefore security can be activated, the AMF and the UE need to establish a 5G NAS security context. Usually, the 5G NAS security context is created as the result of a primary authentication and key agreement procedure between the AMF and the UE. A new 5G NAS security context may also be created during an N1 mode to N1 mode handover. Alternatively, during inter-system change from S1 mode to N1 mode, the AMF not supporting interworking without N26 and the UE operating in single-registration mode may derive a mapped 5G NAS security context from an EPS security context that has been established while the UE was in S1 mode.\nThe 5G NAS security context is taken into use by the UE and the AMF, when the AMF initiates a security mode control procedure, during an N1 mode to N1 mode handover, or during the inter-system change procedure from S1 mode to N1 mode. The 5G NAS security context which has been taken into use by the network most recently is called current 5G NAS security context. This current 5G NAS security context can be of type native or mapped, i.e. originating from a native 5G NAS security context or mapped 5G NAS security context.\nThe key set identifier ngKSI is assigned by the AMF either during the primary authentication and key agreement procedure or, for the mapped 5G NAS security context, during the inter-system change. The ngKSI consists of a value and a type of security context parameter indicating whether a 5G NAS security context is a native 5G NAS security context or a mapped 5G NAS security context. When the 5G NAS security context is a native 5G NAS security context, the ngKSI has the value of KSIAMF, and when the current 5G NAS security context is of type mapped, the ngKSI has the value of KSIASME.\nThe 5G NAS security context which is indicated by an ngKSI can be taken into use to establish the secure exchange of NAS messages when a new N1 NAS signalling connection is established without executing a new primary authentication and key agreement procedure (see subclause\u00a05.4.1) or when the AMF initiates a security mode control procedure. For this purpose, the initial NAS messages (i.e. REGISTRATION REQUEST, DEREGISTRATION REQUEST, SERVICE REQUEST and CONTROL PLANE SERVICE REQUEST) and the SECURITY MODE COMMAND message contain an ngKSI in the ngKSI IE indicating the current 5G NAS security context used to integrity protect the NAS message.\nIn the present document, when the UE is required to delete an ngKSI, the UE shall set the ngKSI to the value \"no key is available\" and consider also the associated keys KAMF or K'AMF, 5G NAS ciphering key and 5G NAS integrity key invalid (i.e. the 5G NAS security context associated with the ngKSI as no longer valid). In the initial registration procedure, when the key KAUSF, is invalid, the UE shall delete the ngKSI.\nNOTE:\tIn some specifications the term ciphering key sequence number might be used instead of the term key set identifier (KSI).\nAs described in subclause\u00a04.8 in order to interwork with E-UTRAN connected to EPC, the UE supporting both S1 mode and N1 mode can operate in either single-registration mode or dual-registration mode. A UE operating in dual-registration mode shall independently maintain and use both EPS security context (see 3GPP\u00a0TS\u00a024.301\u00a0[15]) and 5G NAS security context. When the UE operating in dual-registration mode performs an EPS attach procedure, it shall take into use an EPS security context and follow the handling of this security context as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15]. However, when the UE operating in dual-registration mode performs an initial registration procedure, it shall take into use a 5G NAS security context and follow the handling of this security context as described in the present specification.\nThe UE and the AMF need to be able to maintain two 5G NAS security contexts simultaneously, i.e. a current 5G NAS security context and a non-current 5G NAS security context, since:\na)\tafter a 5G re-authentication, the UE and the AMF can have both a current 5G NAS security context and a non-current 5G NAS security context which has not yet been taken into use (i.e. a partial native 5G NAS security context); and\nb)\tafter an inter-system change from S1 mode to N1 mode, the UE and the AMF can have both a mapped 5G NAS security context, which is the current 5G NAS security context, and a non-current native 5G NAS security context that was created during a previous access in N1 mode.\nThe number of 5G NAS security contexts that need to be maintained simultaneously by the UE and the AMF is limited by the following requirements:\na)\tafter a successful 5G (re-)authentication, which creates a new partial native 5G NAS security context, the AMF and the UE shall delete the non-current 5G NAS security context, if any;\nb)\twhen a partial native 5G NAS security context is taken into use through a security mode control procedure, the AMF shall delete the previously current 5G NAS security context. If the UE does not support multiple records of NAS security context storage for multiple registration (see 3GPP\u00a0TS\u00a031.102\u00a0[22]), the UE shall delete the previously current 5G NAS security context. If the UE supports multiple records of NAS security context storage for multiple registration, the UE shall:\n1)\treplace the previously current 5G NAS security context stored in the first 5G security context of that access (see 3GPP\u00a0TS\u00a031.102\u00a0[22]) with the new 5G security context (taken into use through a security mode control procedure), when the UE activates the new 5G security context for the same PLMN and access;\n1a)\treplace the previously current 5G NAS security context stored in the first 5G security context of that access (see 3GPP\u00a0TS\u00a031.102\u00a0[22]) with the new 5G security context (taken into use through a security mode control procedure), when the UE activates the new 5G security context for a different PLMN over that access but the previously current 5G NAS security context is not associated with the 5G-GUTI of the other access; or\n2)\tstore the previously current 5G NAS security context in the second 5G security context of that access (see 3GPP\u00a0TS\u00a031.102\u00a0[22]) and store the new 5G security context (taken into use through a security mode control procedure) in the first 5G security context, when the UE activates the new 5G security context for a different PLMN over that access but the previously current 5G NAS security context is associated with the 5G-GUTI of the other access;\nc)\twhen the AMF and the UE create a 5G NAS security context using \"null integrity protection algorithm\" and \"null ciphering algorithm\" during an initial registration procedure for emergency services, or a registration procedure for mobility and periodic registration update for a UE that has an emergency PDU session (see subclause\u00a05.4.2.2), the AMF and the UE shall delete the previous current 5G NAS security context. The UE shall not update the USIM and non-volatile ME memory with the current 5G NAS security context and shall delete the current 5G NAS security context when the UE is deregistered from emergency services (e.g. before registering for normal service);\nd)\twhen a new mapped 5G NAS security context or 5G NAS security context created using \"null integrity protection algorithm\" and \"null ciphering algorithm\" is taken into use during the inter-system change from S1 mode to N1 mode, the AMF and the UE shall not delete the previously current native 5G NAS security context, if any. Instead, the previously current native 5G NAS security context shall become a non-current native 5G NAS security context, and the AMF and the UE shall delete any partial native 5G NAS security context;\n\tIf no previously current native 5G NAS security context exists, the AMF and the UE shall not delete the partial native 5G NAS security context, if any;\ne)\twhen the AMF and the UE derive a new mapped 5G NAS security context during inter-system change from S1 mode to N1 mode, the AMF and the UE shall delete any existing current mapped 5G NAS security context;\nf)\twhen a non-current full native 5G NAS security context is taken into use by a security mode control procedure, then the AMF and the UE shall delete the previously current mapped 5G NAS security context;\ng)\twhen the UE or the AMF moves from 5GMM-REGISTERED to 5GMM-DEREGISTERED state, if the current 5G NAS security context is a mapped 5G NAS security context and a non-current full native 5G NAS security context exists, then the non-current 5G NAS security context shall become the current 5G NAS security context. Furthermore, the UE and the AMF shall delete any mapped 5G NAS security context or partial native 5G NAS security context.\nh)\twhen the UE operating in single-registration mode in a network supporting N26 interface performs an inter-system change from N1 mode to S1 mode:\n1)\tif the UE has a mapped 5G NAS security context and the inter-system change is performed in:\ni)\t5GMM-IDLE mode, the UE shall delete the mapped 5G NAS security context after the successful completion of the tracking area update procedure or attach procedure (see 3GPP\u00a0TS\u00a024.301\u00a0[15]); or\nii)\t5GMM-CONNECTED mode, the UE shall delete the mapped 5G NAS security context after the completion of the inter-system change.\n\tAfter deletion of the mapped 5G NAS security context, if the UE has a non-current full native 5G NAS security context, then the non-current full native 5G NAS security context shall become the current full native 5G NAS security context; and\ni)\twhen the UE operating in single-registration mode in a network supporting N26 interface performs an inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, if the UE has a non-current full native 5G NAS security context, then the UE shall make the non-current full native 5G NAS security context as the current native 5G NAS security context. The UE shall delete the mapped 5G NAS security context, if any.\n4.4.2.1.2\tUE leaving state 5GMM-DEREGISTERED\nIf the UE is capable of registration over a single access only, the UE shall mark the 5G NAS security context on the USIM or in the non-volatile memory as invalid when the UE initiates an initial registration procedure as described in subclause\u00a05.5.1.2 or when the UE leaves state 5GMM-DEREGISTERED for any other state except 5GMM-NULL.\nIf the UE is capable of registration over both 3GPP access and non-3GPP access and was last registered on the same PLMN over both 3GPP access and the non-3GPP access, the UE in the state 5GMM-DEREGISTERED over both 3GPP access and non-3GPP access shall mark the 5G NAS security contexts in record 1 of the 3GPP access and the non-3GPP access on the USIM or in the non-volatile memory as invalid when the UE initiates an initial registration procedure over either 3GPP access or non-3GPP access as described in subclause\u00a05.5.1.2 or when the UE leaves state 5GMM-DEREGISTERED for any other state except 5GMM-NULL over either 3GPP access or non-3GPP access. \n4.4.2.1.3\tUE entering state 5GMM-DEREGISTERED\nIf the UE is capable of registration over a single access only, the UE shall store the current native 5G NAS security context on the USIM or in the non-volatile memory and mark it as valid only when the UE enters state 5GMM-DEREGISTERED from any other state except 5GMM-NULL or when the UE aborts the initial registration procedure without having left 5GMM-DEREGISTERED.\nIf the UE is capable of registration over both 3GPP access and non-3GPP access and is registered on the same PLMN over both 3GPP access and the non-3GPP access, the UE shall store the current native 5G NAS security contexts of the 3GPP access and the non-3GPP access as specified in annex\u00a0C and mark them as valid only when the UE enters state 5GMM-DEREGISTERED from any other state except 5GMM-NULL over both the 3GPP access and non-3GPP access or only when the UE aborts the initial registration procedure without having left 5GMM-DEREGISTERED over both the 3GPP access and non-3GPP access. \n4.4.2.2\tEstablishment of a mapped 5G NAS security context during inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode\nIn order for the UE operating in single-registration mode in a network supporting N26 interface to derive a mapped 5G NAS security context for an inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode, the AMF shall construct a mapped 5G NAS security context from the EPS security context received from the source MME as indicated in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The AMF shall select the 5G NAS security algorithms and derive the 5G NAS keys (i.e. KNASenc and KNASint). The AMF shall define an ngKSI for the newly derived K'AMF key such that the value field is taken from the eKSI of the KASME key and the type field is set to indicate a mapped security context and associate this ngKSI with the newly created mapped 5G NAS security context. The AMF shall then include the message authentication code, selected NAS algorithms, NCC and generated ngKSI in the S1 mode to N1 mode NAS transparent container IE (see subclause\u00a09.11.2.9).\nWhen the UE operating in single-registration mode in a network supporting N26 interface receives the command to perform inter-system change to N1 mode in 5GMM-CONNECTED mode, the UE shall derive a mapped K'AMF, as indicated in 3GPP\u00a0TS\u00a033.501\u00a0[24], using the KASME from the EPS security context. Furthermore, the UE shall also derive the 5G NAS keys from the mapped K'AMF using the selected NAS algorithm identifiers included in the S1 mode to N1 mode NAS transparent container IE and associate this mapped 5G NAS security context with the ngKSI value received. The UE shall then verify the received NAS MAC. In case the received NAS MAC is not verified successfully (see subclause 4.4.3.3) the UE shall discard the content of the received S1 mode to N1 mode NAS transparent container IE and inform the lower layers that the received S1 mode to N1 mode NAS transparent container is invalid.\nWhen the UE operating in single-registration mode in a network supporting N26 interface has a PDN connection for emergency bearer services and has no current EPS security context, the AMF shall set 5G-IA0 and 5G-EA0 as the selected 5G NAS security algorithms in the S1 mode to N1 mode NAS transparent container IE. The AMF shall create a locally generated K'AMF. The AMF shall set the ngKSI value of the associated security context to \"000\" and the type of security context flag to \"mapped security context\" in the S1 mode to N1 mode NAS transparent container IE.\nWhen the UE operating in single-registration mode in a network supporting N26 interface receives the command to perform inter-system change to N1 mode in 5GMM-CONNECTED mode (see 3GPP\u00a0TS\u00a038.331\u00a0[30]) and has a PDN connection for emergency bearer services, if 5G-IA0 and 5G-EA0 as the selected 5G NAS security algorithms are included in the S1 mode to N1 mode NAS transparent container IE, the UE shall create a locally generated K'AMF. Furthermore, the UE shall set the ngKSI value of the associated security context to the KSI value received.\nAfter the new mapped 5G NAS security context is taken into use for the 3GPP access following a successful inter system change from S1 mode to N1 mode in 5GMM-CONNECTED mode and the UE is registered with the same PLMN over the 3GPP access and non-3GPP access:\na)\tif a native 5G NAS security context is used on the non-3GPP access and:\n1)\tthe UE is in 5GMM-IDLE mode over non-3GPP access, then the AMF and the UE shall activate and take into use the new mapped 5G NAS security context on the 3GPP access for the non-3GPP access as described in 3GPP\u00a0TS\u00a033.501\u00a0[24] after the AMF sends or the UE receives the REGISTRATION ACCEPT message respectively. The UE and AMF shall keep the native 5G NAS security context which was used on the non-3GPP access and make it a non-current native 5G NAS security context. The non-current native 5G NAS security context may be re-activated later using the security mode control procedure; or\n2)\tthe UE is in 5GMM-CONNECTED mode over non-3GPP access, in order to activate the native 5G NAS security context over the 3GPP access that is active on the non-3GPP access the AMF shall send the SECURITY MODE COMMAND message over the 3GPP access as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The SECURITY MODE COMMAND message shall include the same ngKSI to identify the native 5G NAS security context that is used on the non-3GPP access; or\nb)\tif a mapped 5G NAS security context is used on the non-3GPP access and:\n1)\tthe UE is in 5GMM-IDLE mode over non-3GPP access, the AMF and the UE shall activate and take into use the new mapped 5G NAS security context active on the 3GPP access for the non-3GPP access as described in 3GPP\u00a0TS\u00a033.501\u00a0[24] after the AMF sends or the UE receives the REGISTRATION ACCEPT message respectively; or\n2)\tthe UE is in 5GMM-CONNECTED mode over non-3GPP access, in order to activate the same mapped 5G NAS security context over one access that is used on the other access the AMF shall send the SECURITY MODE COMMAND message over one-access as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The SECURITY MODE COMMAND message shall include the same ngKSI to identify the mapped 5G NAS security context that is used over the other access.\nIf the inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode is not completed successfully, the AMF and the UE operating in single-registration mode in a network supporting N26 interface shall delete the new mapped 5G NAS security context.\n4.4.2.3\tEstablishment of a 5G NAS security context during N1 mode to N1 mode handover\nDuring an N1 mode to N1 mode handover, the target AMF may derive a new 5G NAS security context for which the target AMF creates a new 5G NAS security context as indicated in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nWhen a new 5G NAS security context is derived using the same KAMF, the target AMF includes the 8 least significant bits of the downlink NAS COUNT in the Intra N1 mode NAS transparent container IE, and indicates that a new KAMF shall not be derived (see subclause\u00a09.11.2.6). The AMF shall increment the downlink NAS COUNT by one after creating the Intra N1 mode NAS transparent container IE.\nWhen a new 5G NAS security context is created from a new KAMF, the target AMF includes the 8 least significant bits of the downlink NAS COUNT in the Intra N1 mode NAS transparent container IE and indicates that a new KAMF shall be derived (see subclause\u00a09.11.2.6). The AMF shall then set both the uplink and downlink NAS COUNT counters of this 5G NAS security context to zero. The AMF shall increment the downlink NAS COUNT by one after creating the Intra N1 mode NAS transparent container IE.\nThe target AMF also includes the ngKSI with the same value as the ngKSI currently being used with the UE, the message authentication code, and the selected NAS algorithms in the Intra N1 mode NAS transparent container IE.\nWhen the UE receives a command to perform handover to NG-RAN including an Intra N1 mode NAS transparent container IE (see subclause\u00a09.11.2.6), the UE derives a new 5G NAS security context as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]. When the Intra N1 mode NAS transparent container IE indicates that a new KAMF needs to be derived, the UE shall set both the downlink NAS COUNT and uplink NAS COUNT to zero after creating the new 5G NAS security context.\nIf the received Intra N1 mode NAS transparent container IE does not have a valid NAS COUNT (see subclause\u00a04.4.3.2) or the received NAS MAC is not verified successfully (see subclause\u00a04.4.3.3) the UE shall discard the content of the received Intra N1 mode NAS transparent container IE, continue to use the current 5G NAS security context, and inform the lower layers that the received Intra N1 mode NAS transparent container is invalid.\nNOTE\u00a01:\tDuring N1 mode to N1 mode handover, the Intra N1 mode NAS transparent container IE (see subclause\u00a09.11.2.6) is equivalent to sending a SECURITY MODE COMMAND message to the UE in order to derive and use a new 5G NAS security context, optionally created with a new KAMF. The UE maintains the Selected EPS NAS security algorithms until the UE receives a new Selected EPS NAS security algorithms.\nAfter the new 5G NAS security context is taken into use for 3GPP access following a successful N1 mode to N1 mode handover and the UE is registered with the same PLMN over the 3GPP access and non-3GPP access:\na)\tthe UE is in 5GMM-IDLE mode over non-3GPP access, the AMF and the UE shall activate and take into use the new 5G NAS security context over the non-3GPP access as described in 3GPP\u00a0TS\u00a033.501\u00a0[24] after the AMF sends or the UE receives the REGISTRATION ACCEPT message respectively. If the new 5G NAS security context is created from a new KAMF, the AMF and the UE shall set the downlink NAS COUNT and uplink NAS COUNT to zero also for the non-3GPP access, otherwise the downlink NAS COUNT and uplink NAS COUNT for the non-3GPP access are not changed; or\nb)\tthe UE is in 5GMM-CONNECTED mode over non-3GPP access, in order to activate the new 5G NAS security context over the non-3GPP access that has been activated for the 3GPP access the AMF shall send the SECURITY MODE COMMAND message over the non-3GPP access as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The SECURITY MODE COMMAND message shall include the same ngKSI to identify the new 5G NAS security context that was activated over the 3GPP access and shall include the horizontal derivation parameter indicating \"KAMF derivation is not required\". Otherwise, if the new 5G NAS security context is created from a new KAMF, the AMF and the UE shall set the downlink NAS COUNT and uplink NAS COUNT to zero for the non-3GPP access.\nNOTE\u00a02:\tExplicit indication \"KAMF derivation is not required\" for the non-3GPP access is to align security contexts within the UE without a subsequent derivation of a new KAMF in the non-3GPP access.\n4.4.2.4\tEstablishment of an EPS security context during inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode\nIn order for the UE operating in single-registration mode in a network supporting N26 interface to derive a mapped EPS security context for an inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode, the AMF shall prepare a mapped EPS security context for the target MME as indicated in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nThe AMF shall derive a K'ASME using the KAMF key and the downlink NAS COUNT of the current 5G NAS security context, include the corresponding NAS sequence number in the N1 mode to S1 mode NAS transparent container IE (see subclause\u00a09.11.2.7) and then increments its stored downlink NAS COUNT value by one.\nNOTE:\tThe creation of the N1 mode to S1 mode NAS transparent container and the increment of the stored downlink NAS COUNT value by one are performed in prior to transferring the mapped EPS security context to the MME.\nThe AMF shall select the NAS algorithms identifiers to be used in the target MME after the inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode, for encryption and integrity protection. The uplink and downlink NAS COUNT associated with the newly derived K'ASME key are set to the uplink and downlink NAS COUNT value of the current 5G NAS security context, respectively. The eKSI for the newly derived K'ASME key shall be defined such as the value field is taken from the ngKSI and the type field is set to indicate a mapped security context.\nWhen the UE operating in single-registration mode in a network supporting N26 interface receives a command to perform inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode, the UE shall derive the mapped EPS security context, i.e. derive K'ASME from KAMF using a downlink NAS COUNT based on the NAS sequence number received in the N1 mode to S1 mode NAS transparent container IE (see subclause\u00a09.11.2.7) as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The UE shall set the uplink and downlink NAS COUNT values associated with the newly derived K'ASME key to the uplink and downlink NAS COUNT values of the current 5G NAS security context respectively. The eKSI for the newly derived K'ASME key is defined such that the value field is taken from the ngKSI and the type field is set to indicate a mapped security context. The UE shall also derive the NAS keys as specified in 3GPP\u00a0TS\u00a033.401\u00a0[23A] using the EPS NAS security algorithms identifiers that are stored in the UE's 5G NAS security context.\nIf the received N1 mode to S1 mode NAS transparent container IE does not have a valid NAS COUNT (see subclause\u00a04.4.3.2) the UE shall discard the content of the received N1 mode to S1 mode NAS transparent container IE and inform the lower layers that the received N1 mode to S1 mode NAS transparent container is invalid.\nIf the inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode is not completed successfully, the AMF and the UE shall delete the new mapped EPS security context.\n4.4.2.5\tEstablishment of secure exchange of NAS messages\nSecure exchange of NAS messages via a NAS signalling connection is usually established by the AMF during the registration procedure by initiating a security mode control procedure. After successful completion of the security mode control procedure, all NAS messages exchanged between the UE and the AMF are sent integrity protected using the current 5G security algorithms, and except for the messages specified in subclause\u00a04.4.5, all NAS messages exchanged between the UE and the AMF are sent ciphered using the current 5G security algorithms.\nDuring inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode, secure exchange of NAS messages is established between the AMF and the UE by:\na)\tthe transmission of NAS security related parameters encapsulated in the AS signalling from the AMF to the UE triggering the inter-system change in 5GMM-CONNECTED mode (see 3GPP\u00a0TS\u00a033.501\u00a0[24]). The UE uses these parameters to generate the mapped 5G NAS security context (see subclause\u00a08.6.2 of 3GPP\u00a0TS\u00a033.501\u00a0[24]); and\nb)\tafter the inter-system change in 5GMM-CONNECTED mode, the transmission of a REGISTRATION REQUEST message from the UE to the AMF. The UE shall send this message integrity protected using the mapped 5G NAS security context and further protect this message as specified in subclause\u00a04.4.6 and subclause\u00a05.5.1.3.2. After the AMF receives the REGISTRATION REQUEST message:\n1)\tif the AMF decides to take the native 5G NAS security context into use, the security mode control procedure is performed. From this time onward, all NAS messages exchanged between the UE and the AMF are sent integrity protected using the native 5G NAS security context, and except for the messages specified in subclause\u00a04.4.5, all NAS messages exchanged between the UE and the AMF are sent ciphered using the native 5G NAS security context; or\n2)\tif the AMF decides to take the mapped 5G NAS security context into use, from this time onward, all NAS messages exchanged between the UE and the AMF are sent integrity protected using the mapped 5G NAS security context, and except for the messages specified in subclause\u00a04.4.5, all NAS messages exchanged between the UE and the AMF are sent ciphered using the mapped 5G NAS security context.\nDuring inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, if the UE is operating in single-registration mode and:\na)\tif the UE has a valid native 5G NAS security context, the UE shall transmit a REGISTRATION REQUEST message integrity protected with the native 5G NAS security context. The UE shall include the ngKSI indicating the native 5G NAS security context value in the REGISTRATION REQUEST message.\n\tAfter receiving the REGISTRATION REQUEST message including the ngKSI indicating a native 5G NAS security context value, the AMF shall check whether the ngKSI included in the REGISTRATION REQUEST message belongs to a 5G NAS security context available in the AMF, and shall verify the MAC of the REGISTRATION REQUEST message. If the verification is successful, the AMF deletes the EPS security context received from the source MME if any, and the AMF re-establishes the secure exchange of NAS messages by either:\n1)\treplying with a REGISTRATION ACCEPT message that is integrity protected and ciphered using the native 5G NAS security context. From this time onward, all NAS messages exchanged between the UE and the AMF are sent integrity protected and except for the messages specified in subclause\u00a04.4.5, all NAS messages exchanged between the UE and the AMF are sent ciphered; or\n2)\tinitiating a security mode control procedure. This can be used by the AMF to take a non-current 5G NAS security context into use or to modify the current 5G NAS security context by selecting new NAS security algorithms.\nb)\tif the UE has no valid native 5G NAS security context, the UE shall send the REGISTRATION REQUEST message without integrity protection and encryption.\n\tAfter receiving the REGISTRATION REQUEST message without integrity protection and encryption:\n1)\tif N26 interface is supported:\ni)\tif an EPS security context received from the source MME does not include the NAS security algorithms set to EIA0 and EEA0, the AMF shall either create a fresh mapped 5G NAS security context (see subclause\u00a08.6.2 of 3GPP\u00a0TS\u00a033.501\u00a0[24]) or trigger a primary authentication and key agreement procedure to create a fresh native 5G NAS security context; or\nii)\tif an EPS security context received from the source MME includes the NAS security algorithms set to EIA0 and EEA0, the AMF shall trigger a primary authentication and key agreement procedure to create a fresh native 5G NAS security context; or\n2)\tif N26 interface is not supported, the AMF shall trigger a primary authentication and key agreement procedure.\n\tThe newly created 5G NAS security context is taken into use by initiating a security mode control procedure and this context becomes the current 5G NAS security context in both the UE and the AMF. This re-establishes the secure exchange of NAS messages.\nDuring an N1 mode to N1 mode handover, secure exchange of NAS messages is established between the AMF and the UE by:\n-\tthe transmission of NAS security related parameters encapsulated in the AS signalling from the target AMF to the UE triggering the N1 mode to N1 mode handover (see 3GPP\u00a0TS\u00a033.501\u00a0[24]). The UE uses these parameters to create a new 5G NAS security context.\nThe secure exchange of NAS messages shall be continued after N1 mode to N1 mode handover. It is terminated after inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode or when the NAS signalling connection is released.\nWhen a UE in 5GMM-IDLE mode establishes a new NAS signalling connection and has a valid current 5G NAS security context, the UE shall transmit the initial NAS message integrity protected with the current 5G NAS security context and further protect this message as specified in subclause\u00a04.4.6. The UE shall include the ngKSI indicating the current 5G NAS security context value in the initial NAS message. The AMF shall check whether the ngKSI included in the initial NAS message belongs to a 5G NAS security context available in the AMF, and shall verify the MAC of the NAS message. If the verification is successful, the AMF may re-establish the secure exchange of NAS messages:\na)\tby replying with a NAS message that is integrity protected and ciphered using the current 5G NAS security context. From this time onward, all NAS messages exchanged between the UE and the AMF are sent integrity protected and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the AMF are sent ciphered; or\nb)\tby initiating a security mode control procedure. This can be used by the AMF to take a non-current 5G NAS security context into use or to modify the current 5G NAS security context by selecting new NAS security algorithms.\nWhen a UE attempts multiple registrations in the same or different serving network, both the AMF and the UE shall follow the behavior specified in subclause\u00a06.3.2 of 3GPP\u00a0TS\u00a033.501\u00a0[24]. The UE may support multiple records of NAS security context storage for multiple registration (see 3GPP\u00a0TS\u00a031.102\u00a0[22]). If the UE supports multiple records of NAS security context storage for multiple registration, the UE can select the appropriate one among the stored 5G security contexts to protect the initial NAS message (see 3GPP\u00a0TS\u00a033.501\u00a0[24]).\nNOTE:\tFor the case when the UE has two records of NAS security context stored and is attempting registration to the PLMN associated with the 5G-GUTI (or an equivalent PLMN) for that access, the UE uses the first NAS security context of that access to protect the initial NAS message. For the case when the UE has two records of NAS security context stored and is attempting registration to the PLMN associated with the second record (or an equivalent PLMN) of that access, the UE uses the second NAS security context of that access to protect the initial NAS message. For other cases when the UE has two records of NAS security context stored and is attempting registration to a PLMN which is not associated with any NAS security context record, the UE uses either record of the NAS security context of that access to protect the initial NAS message.\n4.4.2.6\tChange of security keys\nWhen the AMF initiates a re-authentication to create a new 5G NAS security context, the messages exchanged during the authentication procedure are integrity protected and ciphered using the current 5G NAS security context, if any.\nBoth UE and AMF shall continue to use the current 5G NAS security context, until the AMF initiates a security mode control procedure. The SECURITY MODE COMMAND message sent by the AMF includes the ngKSI of the new 5G NAS security context to be used. The AMF shall send the SECURITY MODE COMMAND message integrity protected with the new 5G NAS security context, but unciphered. When the UE responds with a SECURITY MODE COMPLETE message, it shall send the message integrity protected and ciphered with the new 5G NAS security context.\nThe AMF can also modify the current 5G NAS security context or take the non-current native 5G NAS security context, if any, into use, by sending a SECURITY MODE COMMAND message including the ngKSI of the 5G NAS security context to be modified and including a new set of selected NAS security algorithms. In this case the AMF shall send the SECURITY MODE COMMAND message integrity protected with the modified 5G NAS security context, but unciphered. When the UE replies with a SECURITY MODE COMPLETE message, it shall send the message integrity protected and ciphered with the modified 5G NAS security context.\n4.4.3\tHandling of NAS COUNT and NAS sequence number\n4.4.3.1\tGeneral\nEach 5G NAS security context shall be associated with two separate counters NAS COUNT per access type in the same PLMN: one related to uplink NAS messages and one related to downlink NAS messages. If the 5G NAS security context is used for access via both 3GPP and non-3GPP access in the same PLMN, there are two NAS COUNT counter pairs associated with the 5G NAS security context. The NAS COUNT counters use 24-bit internal representation and are independently maintained by UE and AMF. The NAS COUNT shall be constructed as a NAS sequence number (8 least significant bits) concatenated with a NAS overflow counter (16 most significant bits).\nWhen NAS COUNT is input to NAS ciphering or NAS integrity algorithms it shall be considered to be a 32-bit entity which shall be constructed by padding the 24-bit internal representation with 8 zeros in the most significant bits.\nThe value of the uplink NAS COUNT that is stored or read out of the USIM or non-volatile memory as described in annex\u00a0C, is the value that shall be used in the next NAS message.\nThe value of the downlink NAS COUNT that is stored or read out of the USIM or non-volatile memory as described in annex\u00a0C, is the largest downlink NAS COUNT used in a successfully integrity checked NAS message.\nThe value of the uplink NAS COUNT stored in the AMF is the largest uplink NAS COUNT used in a successfully integrity checked NAS message.\nThe value of the downlink NAS COUNT stored in the AMF is the value that shall be used in the next NAS message.\nThe NAS sequence number part of the NAS COUNT shall be exchanged between the UE and the AMF as part of the NAS signalling. After each new or retransmitted outbound SECURITY PROTECTED 5GS NAS MESSAGE message, the sender shall increase the NAS COUNT number by one, except for the initial NAS messages if the lower layers indicated the failure to establish the RRC connection (see 3GPP\u00a0TS\u00a038.331\u00a0[30]). Specifically, on the sender side, the NAS sequence number shall be increased by one, and if the result is zero (due to wrap around), the stored NAS overflow counter shall also be incremented by one (see subclause\u00a04.4.3.5). If, through implementation-dependent means, the receiver determines that the NAS message is a replay of an earlier NAS message, then the receiver handles the received NAS message as described in subclause\u00a04.4.3.2. Otherwise, in order to determine the estimated NAS COUNT value to be used for integrity verification of a received NAS message:\n-\tThe sequence number part of the estimated NAS COUNT value shall be equal to the sequence number in the received NAS message; and\n-\tIf the receiver can guarantee that this NAS message was not previously accepted, then the receiver may select the estimated NAS overflow counter so that the estimated NAS COUNT value is lower than the stored NAS COUNT value; otherwise, the receiver selects the estimated NAS overflow counter so that the estimated NAS COUNT value is higher than the stored NAS COUNT value.\nDuring the inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode, when a mapped 5G NAS security context is derived and taken into use, the AMF shall set both the uplink and downlink NAS COUNT counters of this 5G NAS security context to zero. The UE shall set both the uplink and downlink NAS COUNT counters of this 5G NAS security context to zero.\nDuring the inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode, the AMF shall increment the downlink NAS COUNT by one after it has created an S1 mode to N1 mode NAS transparent container (see subclause\u00a09.11.2.9).\nDuring the inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode, the AMF shall increment the downlink NAS COUNT by one after it has created an N1 mode to S1 mode NAS transparent container (see subclause\u00a09.11.2.7).\nDuring N1 mode to N1 mode handover:\na)\tif the new 5G NAS security context is created with the same KAMF, the AMF shall signal the 8 least significant bits of the current downlink NAS COUNT value in an Intra N1 mode NAS transparent container (see subclause\u00a09.11.2.6). The AMF shall then increment the downlink NAS COUNT by one; or\nb)\tif the new 5G NAS security context is created with a new KAMF, the AMF shall signal the 8 least significant bits of the current downlink NAS COUNT value in an Intra N1 mode NAS transparent container (see subclause\u00a09.11.2.6) and shall then set both the uplink and downlink NAS COUNT counters of this 5G NAS security context to zero. The AMF shall then increment the downlink NAS COUNT by one. The UE shall also set both the uplink and downlink NAS COUNT counters to zero.\nNOTE:\tDuring the inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode, the S1 mode to N1 mode NAS transparent container (see subclause\u00a09.11.2.9) is treated as an implicit SECURITY MODE COMMAND message for the UE and the AMF, and therefore the AMF regards the sending of the S1 mode to N1 mode NAS transparent container as the sending of an initial SECURITY MODE COMMAND message in order to derive and take into use a mapped 5G NAS security context for the purpose of the NAS COUNT handling.\n4.4.3.2\tReplay protection\nReplay protection shall be supported for received NAS messages both in the AMF and the UE. However, since the realization of replay protection does not affect the interoperability between nodes, no specific mechanism is required for implementation.\nReplay protection assures that one and the same NAS message is not accepted twice by the receiver. Specifically, for a given 5G NAS security context, a given NAS COUNT value shall be accepted at most one time and only if message integrity verifies correctly.\nReplay protection is not applicable when 5G-IA0 is used.\n4.4.3.3\tIntegrity protection and verification\nThe sender shall use its locally stored NAS COUNT as input to the integrity protection algorithm.\nThe receiver shall use the NAS sequence number included in the received message and an estimate for the NAS overflow counter as defined in subclause\u00a04.4.3.1 to form the NAS COUNT input to the integrity verification algorithm.\nThe algorithm to calculate the integrity protection information is specified in 3GPP\u00a0TS\u00a033.501\u00a0[24], and in case of the:\na)\tSECURITY PROTECTED 5GS NAS MESSAGE message, the integrity protection shall include octet 7 to n, i.e. the Sequence number IE and the NAS message IE.\nb)\tIntra N1 mode NAS transparent container IE and S1 mode to N1 mode NAS transparent container IE, the integrity protection shall include all octets of the value part of the IE starting from octet 7.\nNOTE:\tTo ensure backward compatibility, the UE uses all octets starting from octet 7 in the received NAS transparent container for the purpose of integrity check of the NAS transparent container irrespective of the release/version it supports. After a successful integrity check, the UE can ignore the octets which are not specified in the release/version which the UE supports.\nIn addition to the data that is to be integrity protected, the BEARER ID, DIRECTION bit, NAS COUNT and 5G NAS integrity key are input to the integrity protection algorithm. These parameters are described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nAfter successful integrity protection validation, the receiver shall update its corresponding locally stored NAS COUNT with the value of the estimated NAS COUNT for this NAS message.\nIntegrity verification is not applicable when 5G-IA0 is used.\n4.4.3.4\tCiphering and deciphering\nThe sender shall use its locally stored NAS COUNT as input to the ciphering algorithm.\nThe receiver shall use the NAS sequence number included in the received message and an estimate for the NAS overflow counter as defined in subclause\u00a04.4.3.1 to form the NAS COUNT input to the deciphering algorithm.\nThe input parameters to the NAS ciphering algorithm are the BEARER ID, DIRECTION bit, NAS COUNT, NAS encryption key and the length of the key stream to be generated by the encryption algorithm.\nWhen applying initial NAS message protection to the REGISTRATION REQUEST, DEREGISTRATION REQUEST or SERVICE REQUEST message as described in subclause\u00a04.4.6, the length of the key stream is set to the length of the entire plain NAS message that is included in the NAS message container IE, i.e. the value part of the NAS message container IE, that is to be ciphered.\nWhen applying initial NAS message protection to the CONTROL PLANE SERVICE REQUEST message as described in subclause\u00a04.4.6, the length of the key stream is set to the length of:\na)\tthe value part of the CIoT small data container IE that is to be ciphered; or\nb)\tthe value part of the NAS message container IE that is to be ciphered.\n4.4.3.5\tNAS COUNT wrap around\nIf, when increasing the NAS COUNT as specified above, the AMF detects that either its downlink NAS COUNT or the UE's uplink NAS COUNT is \"close\" to wrap around, (close to 224), the AMF shall take the following actions:\n-\tIf there is no non-current native 5G NAS security context with sufficiently low NAS COUNT values, the AMF shall initiate a new primary authentication and key agreement procedure with the UE, leading to a new established 5G NAS security context and the NAS COUNT being reset to 0 in both the UE and the AMF when the new 5G NAS security context is activated;\n-\tOtherwise, the AMF can activate a non-current native 5G NAS security context with sufficiently low NAS COUNT values or initiate a new primary authentication and key agreement procedure as specified above.\nIf for some reason a new KAMF has not been established using primary authentication and key agreement procedure before the NAS COUNT wraps around, the node (AMF or UE) in need of sending a NAS message shall instead release the NAS signalling connection. Prior to sending the next uplink NAS message, the UE shall delete the ngKSI indicating the current 5G NAS security context.\nWhen the 5G-IA0 is used as the NAS integrity algorithm, the UE and the AMF shall allow NAS COUNT wrap around. If NAS COUNT wrap around occurs, the following requirements apply:\na)\tthe UE and the AMF shall continue to use the current 5G NAS security context;\nb)\tthe AMF shall not initiate the primary authentication and key agreement procedure;\nc)\tthe AMF shall not release the NAS signalling connection; and\nd)\tthe UE shall not perform a local release of the NAS signalling connection.\n4.4.4\tIntegrity protection of NAS signalling messages\n4.4.4.1\tGeneral\nFor the UE, integrity protected signalling is mandatory for the 5GMM NAS messages once a valid 5G NAS security context exists and has been taken into use. For the network, integrity protected signalling is mandatory for the 5GMM NAS messages once a secure exchange of 5GS NAS messages has been established for the NAS signalling connection. Integrity protection of all NAS signalling messages is the responsibility of the NAS. It is the network which activates integrity protection.\nThe use of \"null integrity protection algorithm\" 5G-IA0 (see subclause\u00a09.11.3.34) in the current 5G NAS security context is only allowed:\na)\tfor an unauthenticated UE for which establishment of emergency services is allowed;\nb)\tfor a W-AGF acting on behalf of an FN-RG;\nc)\tfor a W-AGF acting on behalf of an N5GC device; and\nd)\tfor a 5G-RG acting on behalf of an AUN3 device.\nFor setting the security header type in outbound NAS messages, the UE and the AMF shall apply the same rules irrespective of whether the \"null integrity protection algorithm\" or any other integrity protection algorithm is indicated in the 5G NAS security context.\nIf the \"null integrity protection algorithm\"5G-IA0 has been selected as an integrity protection algorithm, the receiver shall regard the NAS messages with the security header indicating integrity protection as integrity protected.\nDetails of the integrity protection and verification of NAS signalling messages are specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nWhen a NAS message needs to be sent both ciphered and integrity protected, the NAS message is first ciphered and then the ciphered NAS message and the NAS sequence number are integrity protected by calculating the MAC.\nNOTE:\tNAS messages that are ciphered with the \"null ciphering algorithm\" 5G-EA0 are regarded as ciphered (see subclause\u00a04.4.5).\nWhen a NAS message needs to be sent only integrity protected and unciphered, the unciphered NAS message and the NAS sequence number are integrity protected by calculating the MAC.\nWhen a 5GSM message is piggybacked in a 5GMM message, there is only one Sequence number IE and one Message authentication code IE for the 5GMM message piggybacking the 5GSM message.\n4.4.4.2\tIntegrity checking of NAS signalling messages in the UE\nExcept the messages listed below, no NAS signalling messages shall be processed by the receiving 5GMM entity in the UE or forwarded to the 5GSM entity, unless the network has established secure exchange of 5GS NAS messages for the NAS signalling connection:\na)\tIDENTITY REQUEST (if requested identification parameter is SUCI);\nb)\tAUTHENTICATION REQUEST;\nc)\tAUTHENTICATION RESULT;\nd)\tAUTHENTICATION REJECT;\ne)\tREGISTRATION REJECT (if the 5GMM cause is not #76, #78, #81 or #82);\nf)\tDEREGISTRATION ACCEPT (for non switch off); and\ng)\tSERVICE REJECT (if the 5GMM cause is not #76 or #78).\nNOTE:\tThese messages are accepted by the UE without integrity protection, as in certain situations they are sent by the network before security can be activated.\nIntegrity protection is never applied directly to 5GSM messages, but to the 5GMM message in which the 5GSM message is included.\nOnce the secure exchange of NAS messages has been established, the receiving 5GMM entity in the UE shall not process any NAS signalling messages unless they have been successfully integrity checked by the NAS. If NAS signalling messages, having not successfully passed the integrity check, are received, then the NAS in the UE shall discard that message. The processing of the SECURITY MODE COMMAND message that has not successfully passed the integrity check is specified in subclause\u00a05.4.2.5. If any NAS signalling message is received as not integrity protected even though the secure exchange of NAS messages has been established by the network, then the NAS shall discard this message.\n4.4.4.3\tIntegrity checking of NAS signalling messages in the AMF\nExcept the messages listed below, no NAS signalling messages shall be processed by the receiving 5GMM entity in the AMF or forwarded to the 5GSM entity, unless the secure exchange of NAS messages has been established for the NAS signalling connection:\na)\tREGISTRATION REQUEST;\nb)\tIDENTITY RESPONSE (if requested identification parameter is SUCI);\nc)\tAUTHENTICATION RESPONSE;\nd)\tAUTHENTICATION FAILURE;\ne)\tSECURITY MODE REJECT;\nf)\tDEREGISTRATION REQUEST; and\ng)\tDEREGISTRATION ACCEPT;\nNOTE\u00a01:\tThe REGISTRATION REQUEST message is sent by the UE without integrity protection, if the registration procedure is initiated due to an inter-system change in 5GMM-IDLE mode and no current 5G NAS security context is available in the UE. The other messages are accepted by the AMF without integrity protection, as in certain situations they are sent by the UE before security can be activated.\nNOTE\u00a02:\tThe DEREGISTRATION REQUEST message can be sent by the UE without integrity protection, e.g. if the UE is registered for emergency services and there is no valid 5G NAS security context available, or if due to user interaction a registration procedure is cancelled before the secure exchange of NAS messages has been established. For these cases the network can attempt to use additional criteria (e.g. whether the UE is subsequently still performing periodic registration update or still responding to paging) before marking the UE as 5GMM-DEREGISTERED.\nIntegrity protection is never applied directly to 5GSM messages, but to the 5GMM message in which the 5GSM message is included.\nOnce a current 5G NAS security context exists, until the secure exchange of NAS messages has been established for the NAS signalling connection, the receiving 5GMM entity in the AMF shall process the following NAS signalling messages, even if the MAC included in the message fails the integrity check or cannot be verified, as the 5G NAS security context is not available in the network:\na)\tREGISTRATION REQUEST;\nb)\tIDENTITY RESPONSE (if requested identification parameter is SUCI);\nc)\tAUTHENTICATION RESPONSE;\nd)\tAUTHENTICATION FAILURE;\ne)\tSECURITY MODE REJECT;\nf)\tDEREGISTRATION REQUEST;\ng)\tDEREGISTRATION ACCEPT;\nh)\tSERVICE REQUEST; and\ni)\tCONTROL PLANE SERVICE REQUEST;\nNOTE\u00a03:\tThese messages are processed by the AMF even when the MAC that fails the integrity check or cannot be verified, as in certain situations they can be sent by the UE protected with a 5G NAS security context that is no longer available in the network.\nIf a REGISTRATION REQUEST message for initial registration fails the integrity check and it is not a registration request for emergency services, the AMF shall authenticate the subscriber before processing the registration request any further. Additionally, the AMF shall initiate a security mode control procedure, and include the Additional 5G security information IE with the RINMR bit set to \"Retransmission of the initial NAS message requested\" in the SECURITY MODE COMMAND message as specified in subclause\u00a05.4.2.2. If authentication procedure is not successful the AMF shall maintain, if any, the 5GMM-context and 5G NAS security context unchanged.For the case when the registration procedure is for emergency services see subclause\u00a05.5.1.2.3 and subclause\u00a05.4.1.3.5.\nIf a REGISTRATION REQUEST message for mobility and periodic registration update fails the integrity check and the UE provided EPS NAS message container IE which was successfully verified by the source MME, the AMF may create a mapped 5G NAS security context and initiate a security mode control procedure to take the new mapped 5G NAS security context into use; otherwise if the UE has only a non-emergency PDU session established, the AMF shall initiate a primary authentication and key agreement procedure to create a new native 5G NAS security context. Additionally, the AMF shall initiate a security mode control procedure, and include the Additional 5G security information IE with the RINMR bit set to \"Retransmission of the initial NAS message requested\" in the SECURITY MODE COMMAND message as specified in subclause\u00a05.4.2.2. If authentication procedure is not successful the AMF shall maintain, if any, the 5GMM-context and 5G NAS security context unchanged. For the case when the UE has an emergency PDU session see subclause\u00a05.5.1.3.3 and subclause\u00a05.4.1.3.5.\nIf a DEREGISTRATION REQUEST message fails the integrity check, the AMF shall proceed as follows:\n-\tIf it is not a deregistration request due to switch off, and the AMF can initiate an authentication procedure, the AMF should authenticate the subscriber before processing the deregistration request any further.\n-\tIf it is a deregistration request due to switch off, or the AMF does not initiate an authentication procedure for any other reason, the AMF may ignore the deregistration request and remain in state 5GMM-REGISTERED.\nNOTE\u00a04:\tThe network can attempt to use additional criteria (e.g. whether the UE is subsequently still performing periodic registration update or still responding to paging) before marking the UE as 5GMM-DEREGISTERED.\nIf a SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message fails the integrity check and the UE has only non-emergency PDU sessions established, the AMF shall send the SERVICE REJECT message with 5GMM cause #9 \"UE identity cannot be derived by the network\" and keep the 5GMM-context and 5G NAS security context unchanged. For the case when the UE has an emergency PDU session and integrity check fails, the AMF may skip the authentication procedure even if no 5G NAS security context is available and proceed directly to the execution of the security mode control procedure as specified in subclause 5.4.2. Additionally, the AMF shall include the Additional 5G security information IE with the RINMR bit set to \"Retransmission of the initial NAS message requested\" in the SECURITY MODE COMMAND message as specified in subclause\u00a05.4.2.2. After successful completion of the service request procedure, the network shall perform a local release of all non-emergency PDU sessions. The emergency PDU session shall not be released.\nOnce the secure exchange of NAS messages has been established for the NAS signalling connection, the receiving 5GMM entity in the AMF shall not process any NAS signalling messages unless they have been successfully integrity checked by the NAS. If any NAS signalling message, having not successfully passed the integrity check, is received, then the NAS in the AMF shall discard that message. If any NAS signalling message is received, as not integrity protected even though the secure exchange of NAS messages has been established, then the NAS shall discard this message.\n4.4.5\tCiphering of NAS signalling messages\nThe use of ciphering in a network is an operator option subject to AMF configuration. When operation of the network without ciphering is configured, the AMF shall indicate the use of \"null ciphering algorithm\" 5G-EA0 (see subclause\u00a09.11.3.34) in the current 5G NAS security context for all UEs. For setting the security header type in outbound NAS messages, the UE and the AMF shall apply the same rules irrespective of whether the \"null ciphering algorithm\" or any other ciphering algorithm is indicated in the 5G NAS security context.\nWhen the UE establishes a new N1 NAS signalling connection, it shall apply security protection to the initial NAS message as described in subclause\u00a04.4.6.\nThe UE shall start the ciphering and deciphering of NAS messages when the secure exchange of NAS messages has been established for an N1 NAS signalling connection. From this time onward, unless explicitly defined, the UE shall send all NAS messages ciphered until the N1 NAS signalling connection is released, or the UE performs inter-system change to S1 mode.\nThe AMF shall start ciphering and deciphering of NAS messages as described in subclause\u00a04.4.2.5. From this time onward, except for the SECURITY MODE COMMAND message, the AMF shall send all NAS messages ciphered until the N1 NAS signalling connection is released, or the UE performs inter-system change to S1 mode.\nCiphering is never applied directly to 5GSM messages, but to the 5GMM message in which the 5GSM message is included.\nOnce the encryption of NAS messages has been started between the AMF and the UE, the receiver shall discard the unciphered NAS messages which shall have been ciphered according to the rules described in this specification.\nIf the \"null ciphering algorithm\" 5G-EA0 has been selected as a ciphering algorithm, the NAS messages with the security header indicating ciphering are regarded as ciphered.\nDetails of ciphering and deciphering of NAS signalling messages are specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\n4.4.6\tProtection of initial NAS signalling messages\nThe 5GS supports protection of initial NAS messages as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The protection of initial NAS messages applies to the REGISTRATION REQUEST, DEREGISTRATION REQUEST, SERVICE REQUEST and CONTROL PLANE SERVICE REQUEST message, and is achieved as follows:\na)\tIf the UE does not have a valid 5G NAS security context, the UE sends a REGISTRATION REQUEST message including cleartext IEs only. After activating a 5G NAS security context resulting from a security mode control procedure:\n1)\tif the UE needs to send non-cleartext IEs, the UE shall include the entire REGISTRATION REQUEST message (i.e. containing both cleartext IEs and non-cleartext IEs) in the NAS message container IE and shall include the NAS message container IE in the SECURITY MODE COMPLETE message; or\n2)\tif the UE does not need to send non-cleartext IEs, the UE shall include the entire REGISTRATION REQUEST message (i.e. containing cleartext IEs only) in the NAS message container IE and shall include the NAS message container IE in the SECURITY MODE COMPLETE message.\nb)\tIf the UE has a valid 5G NAS security context and:\n1)\tthe UE needs to send non-cleartext IEs in a REGISTRATION REQUEST, DEREGISTRATION REQUEST, or SERVICE REQUEST message, the UE includes the entire REGISTRATION REQUEST, DEREGISTRATION REQUEST or SERVICE REQUEST message (i.e. containing both cleartext IEs and non-cleartext IEs) in the NAS message container IE and shall cipher the value part of the NAS message container IE. The UE shall then send a REGISTRATION REQUEST, DEREGISTRATION REQUEST, or SERVICE REQUEST message containing the cleartext IEs and the NAS message container IE;\n2)\tthe UE needs to send non-cleartext IEs in a CONTROL PLANE SERVICE REQUEST message:\ni)\tif CIoT small data container IE is the only non-cleartext IE to be sent, the UE shall cipher the value part of the CIoT small data container IE. The UE shall then send a CONTROL PLANE SERVICE REQUEST message containing the cleartext IEs and the CIoT small data container IE;\nii)\totherwise, the UE includes non-cleartext IEs in the NAS message container IE and shall cipher the value part of the NAS message container IE. The UE shall then send a CONTROL PLANE SERVICE REQUEST message containing the cleartext IEs and the NAS message container IE;\n3)\tthe UE does not need to send non-cleartext IEs in a REGISTRATION REQUEST, DEREGISTRATION REQUEST, or SERVICE REQUEST message, the UE sends the REGISTRATION REQUEST, DEREGISTRATION REQUEST, or SERVICE REQUEST message without including the NAS message container IE; or\n4)\tthe UE does not need to send non-cleartext IEs in a CONTROL PLANE SERVICE REQUEST message, the UE sends the CONTROL PLANE SERVICE REQUEST message without including the NAS message container IE and the CIoT small data container IE.\nWhen the initial NAS message is a REGISTRATION REQUEST message, the cleartext IEs are:\n-\tExtended protocol discriminator;\n-\tSecurity header type;\n-\tSpare half octet;\n-\tRegistration request message identity;\n-\t5GS registration type;\n-\tngKSI;\n-\t5GS mobile identity;\n-\tUE security capability;\n-\tAdditional GUTI;\n-\tUE status;\n-\tEPS NAS message container;\n-\tNID; and\n-\tPLMN with disaster condition.\nWhen the initial NAS message is a DEREGISTRATION REQUEST message, the cleartext IEs are:\n-\tExtended protocol discriminator;\n-\tSecurity header type;\n-\tSpare half octet;\n-\tDe-registration request message identity;\n-\tDe-registration type;\n-\tngKSI; and\n-\t5GS mobile identity.\nWhen the initial NAS message is a SERVICE REQUEST message, the cleartext IEs are:\n-\tExtended protocol discriminator;\n-\tSecurity header type;\n-\tSpare half octet;\n-\tngKSI;\n-\tService request message identity;\n-\tService type; and\n-\t5G-S-TMSI.\nWhen the initial NAS message is a CONTROL PLANE SERVICE REQUEST message, the cleartext IEs are:\n-\tExtended protocol discriminator;\n-\tSecurity header type;\n-\tSpare half octet;\n-\tngKSI;\n-\tControl plane service request message identity; and\n-\tControl plane service type.\nWhen the UE sends a REGISTRATION REQUEST, DEREGISTRATION REQUEST, SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message that includes a NAS message container IE, the UE shall set the security header type of the initial NAS message to \"integrity protected\".\nWhen the AMF receives an integrity protected initial NAS message which includes a NAS message container IE, the AMF shall decipher the value part of the NAS message container IE. If the received initial NAS message is a REGISTRATION REQUEST, DEREGISTRATION REQUEST, or a SERVICE REQUEST message, the AMF shall consider the NAS message that is obtained from the NAS message container IE as the initial NAS message that triggered the procedure.\nWhen the AMF receives a CONTROL PLANE SERVICE REQUEST message which includes a CIoT small data container IE, the AMF shall decipher the value part of the CIoT small data container IE and handle the message as specified in subclause\u00a05.6.1.4.2.\nIf the UE:\na)\thas 5G-EA0 as a selected 5G NAS security algorithm; and\nb)\tselects a PLMN other than Registered PLMN and EPLMN over one access;\nthe UE shall send an initial NAS message including cleartext IEs only via the access type associated with the newly selected PLMN as described in this subclause for the case when the UE does not have a valid 5G NAS security context.\nIf the UE:\na)\thas 5G-EA0 as a selected 5G NAS security algorithm; and\nb)\tselects a PLMN other than Registered PLMN and EPLMN over one access, and the Registered PLMN or EPLMN is not registering or registered over other access;\nthe UE shall delete the 5G NAS security context.\nNOTE:\tUE deletes the 5G NAS security context only if the UE is not in the connected mode.\n4.4.7\tProtection of NAS IEs\nThe network can provide the SOR transparent container IE during the registration procedure to the UE in the REGISTRATION ACCEPT message. The SOR transparent container IE is integrity protected by the HPLMN or subscribed SNPN as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nThe UE can provide the SOR transparent container IE during the registration procedure to the network in the REGISTRATION COMPLETE message. The SoR-MAC-IUE in the SOR transparent container IE is generated by the UE as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nThe network can provide the Payload container IE during the Network-initiated NAS transport procedure to the UE in DL NAS TRANSPORT message. If the Payload container type IE is set to \"SOR transparent container\" or \"UE parameters update transparent container\", the Payload container IE is integrity protected by the HPLMN or subscribed SNPN as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24]. If the Payload container type IE is set to \"Multiple payloads\" and the payload container type field of the payload container entry is set to \"SOR transparent container\" or \"UE parameters update transparent container\", the payload container entry contents field of the payload container entry is integrity protected correspondingly.\nThe UE can provide the Payload container IE during the UE-initiated NAS transport procedure to the network in UL NAS TRANSPORT message. If the Payload container type IE is set to \"SOR transparent container\" or \"UE parameters update transparent container\", the SoR-MAC-IUE or UPU-MAC-IUE in the Payload container IE is generated by the UE as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24]. If the Payload container type IE is set to \"Multiple payloads\" and the payload container type field of the payload container entry is set to \"SOR transparent container\" or \"UE parameters update transparent container\", the SoR-MAC-IUE or UPU-MAC-IUE in the payload container entry contents field of the payload container entry is generated by the UE correspondingly.\n4.5\tUnified access control\n4.5.1\tGeneral\nWhen the UE needs to access the 5GS, the UE not operating as an IAB-node (see 3GPP\u00a0TS\u00a023.501\u00a0[8]), not acting as a 5G ProSe layer-2 UE-to-network relay UE (see 3GPP\u00a0TS\u00a023.304\u00a0[6E]) whose access attempt is triggered by a 5G ProSe layer-2 remote UE, and not acting as an NCR-MT node (see 3GPP\u00a0TS\u00a038.300\u00a0[27]), first performs access control checks to determine if the access is allowed. Access control checks shall be performed for the access attempts defined by the following list of events:\nNOTE\u00a01:\tAlthough the UE operating as an IAB-node or as an NCR-MT node skips the access control checks, the UE operating as an IAB-node or as an NCR-MT node determines an access category and one or more access identities for each access attempt in order to derive an RRC establishment cause. In this case the NAS provides the RRC establishment cause but does not provide the access category and the one or more access identities to the lower layers.\nNOTE\u00a01A:\tAlthough the UE acting as a 5G ProSe layer-2 UE-to-network relay UE skips the access control checks, the UE determines an access category and one or more access identities for each access attempt in order to derive an RRC establishment cause. \na)\tthe UE is in 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication over 3GPP access and an event that requires a transition to 5GMM-CONNECTED mode occurs; and\nb)\tthe UE is in 5GMM-CONNECTED mode over 3GPP access or 5GMM-CONNECTED mode with RRC inactive indication and one of the following events occurs:\n1)\t5GMM receives an MO-IMS-registration-related-signalling-started indication, an MO-MMTEL-voice-call-started indication, an MO-MMTEL-video-call-started indication or an MO-SMSoIP-attempt-started indication from upper layers;\n2)\t5GMM receives a request from upper layers to send a mobile originated SMS over NAS unless the request triggered a service request procedure to transition the UE from 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication to 5GMM-CONNECTED mode;\n3)\t5GMM receives a request from upper layers to send an UL NAS TRANSPORT message for the purpose of PDU session establishment unless the request triggered a service request procedure to transition the UE from 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication to 5GMM-CONNECTED mode;\n4)\t5GMM receives a request from upper layers to send an UL NAS TRANSPORT message for the purpose of UE-requested PDU session modification procedure unless the request triggered a service request procedure to transition the UE from 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication to 5GMM-CONNECTED mode;\n5)\t5GMM receives a request to re-establish the user-plane resources for an existing PDU session;\n6)\t5GMM is notified that an uplink user data packet is to be sent for a PDU session with suspended user-plane resources;\n7)\t5GMM receives a request from upper layers to send a mobile originated location request unless the request triggered a service request procedure to transition the UE from 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication to 5GMM-CONNECTED mode; \n8)\t5GMM receives a request from upper layers to send a mobile originated signalling transaction towards the PCF by sending an UL NAS TRANSPORT message including a UE policy container (see 3GPP\u00a0TS\u00a024.587\u00a0[19B] and 3GPP\u00a0TS\u00a024.554\u00a0[19E]) unless the request triggered a service request procedure to transition the UE from 5GMM-IDLE mode to 5GMM-CONNECTED mode; and\n9)\t5GMM receives an indication from lower layers of the RAN timing synchronization status change, and decides to transition the UE from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-CONNECTED mode as specified in subclause\u00a05.3.1.4.\nNOTE\u00a02:\t5GMM specific procedures initiated by NAS in 5GMM-CONNECTED mode or 5GMM-CONNECTED mode with RRC inactive indication are not subject to access control, e.g. a registration procedure after PS handover will not be prevented by access control (see subclause\u00a05.5).\nNOTE\u00a03:\tLPP messages, SLPP messages, or location event report messages transported in the UL NAS TRANSPORT message sent in response to a mobile terminating or network induced location request, and the corresponding access attempts are handled as MT access.\nNOTE\u00a04:\tInitiating a mobile originated signalling transaction towards the UDM by sending an UL NAS TRANSPORT message including an SOR transparent container is not supported. Therefore, access control for these cases has not been specified.\nWhen the NAS detects one of the above events, the NAS needs to perform the mapping of the kind of request to one or more access identities and one access category and lower layers will perform access barring checks for that request based on the determined access identities and access category.\nNOTE\u00a05:\tThe NAS is aware of the above events through indications provided by upper layers or through determining the need to start 5GMM procedures through normal NAS behaviour, or both.\nTo determine the access identities and the access category for a request, the NAS checks the reason for access, types of service requested and profile of the UE including UE configurations, against a set of access identities and access categories defined in 3GPP\u00a0TS\u00a022.261\u00a0[3], namely:\na)\ta set of standardized access identities;\nb)\ta set of standardized access categories; and\nc)\ta set of operator-defined access categories, if available.\nFor the purpose of determining the applicable access identities from the set of standardized access identities defined in 3GPP\u00a0TS\u00a022.261\u00a0[3], the NAS shall follow the requirements set out in:\na)\tsubclause\u00a04.5.2 and the rules and actions defined in table\u00a04.5.2.1, if the UE is not operating in SNPN access operation mode over 3GPP access; or\nb)\tsubclause\u00a04.5.2A and the rules and actions defined in table\u00a04.5.2A.1, if the UE is operating in SNPN access operation mode over 3GPP access.\nIn order to enable access barring checks for access attempts identified by lower layers in 5GMM-CONNECTED mode with RRC inactive indication, the UE provides the applicable access identities to lower layers.\nNOTE\u00a06:\tWhen and how the NAS provides the applicable access identities to lower layers is UE implementation specific.\nNOTE\u00a07:\tAlthough the UE operating as an IAB-node or as an NCR-MT node skips the access control checks, the UE provides the applicable access identities to lower layers for access attempts identified by lower layers in 5GMM-CONNECTED mode with RRC inactive indication.\nFor the purpose of determining the applicable access category from the set of standardized access categories and operator-defined access categories defined in 3GPP\u00a0TS\u00a022.261\u00a0[3], the NAS shall follow the requirements set out in:\na)\tsubclause\u00a04.5.2 and the rules and actions defined in table\u00a04.5.2.2, if the UE is not operating in SNPN access operation mode over 3GPP access; or\nb)\tsubclause\u00a04.5.2A and the rules and actions defined in table\u00a04.5.2A.2, if the UE is operating in SNPN access operation mode over 3GPP access.\n4.5.2\tDetermination of the access identities and access category associated with a request for access for UEs not operating in SNPN access operation mode over 3GPP access\nWhen the UE needs to initiate an access attempt in one of the events listed in subclause\u00a04.5.1, the UE shall determine one or more access identities from the set of standardized access identities, and one access category from the set of standardized access categories and operator-defined access categories, to be associated with that access attempt.\nThe set of the access identities applicable for the request is determined by the UE in the following way:\na)\tfor each of the access identities 1, 2, 3, 11, 12, 13, 14 and 15 in table\u00a04.5.2.1, the UE shall check whether the access identity is applicable in the selected PLMN, if a new PLMN is selected, or otherwise if it is applicable in the RPLMN or equivalent PLMN; and\nb)\tif none of the above access identities is applicable, then access identity 0 is applicable.\nTable\u00a04.5.2.1: Access identities\n\nThe UE uses the MPS indicator bit of the 5GS network feature support IE or the Priority indicator IE to determine if access identity 1 is valid. Processing of the MPS indicator bit of the 5GS network feature support IE in the REGISTRATION ACCEPT message is described in subclause\u00a05.5.1.2.4 and subclause\u00a05.5.1.3.4. Processing of the MPS indicator bit of the Priority indicator IE in the CONFIGURATION UPDATE COMMAND message is described in subclause\u00a05.4.4.3. \nWhen the UE is neither in the HPLMN (if the EHPLMN list is not present or is empty) nor in an EHPLMN (if the EHPLMN list is present) nor in a visited PLMN of the home country, and the USIM file EFUAC_AIC indicates the UE is configured for access identity 1, then the UE shall not consider access identity 1 to be valid, until the UE receives the MPS indicator bit of the 5GS network feature support IE in the REGISTRATION ACCEPT message or of the Priority indicator IE in the CONFIGURATION UPDATE COMMAND message being set to \"Access identity 1 valid\" from the RPLMN or from an equivalent PLMN.\nWhen the UE is in the HPLMN (if the EHPLMN list is not present or is empty) or in an EHPLMN (if the EHPLMN list is present) or in a visited PLMN of the home country, the contents of the USIM file EFUAC_AIC as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22] and the rules specified in table\u00a04.5.2.1 are used to determine the applicability of access identity 1. When the UE is in the HPLMN (if the EHPLMN list is not present or is empty) or in an EHPLMN (if the EHPLMN list is present) or in a visited PLMN of the home country, and the USIM file EFUAC_AIC does not indicate the UE is configured for access identity 1, the UE uses the MPS indicator bit of the 5GS network feature support IE in the REGISTRATION ACCEPT message or of the Priority indicator IE in the CONFIGURATION UPDATE COMMAND message to determine if access identity 1 is valid. When the UE is in the HPLMN (if the EHPLMN list is not present or is empty) or in an EHPLMN (if the EHPLMN list is present) or in a visited PLMN of the home country, and the USIM file EFUAC_AIC indicates the UE is configured for access identity 1, the MPS indicator bit of the 5GS network feature support IE and the Priority indicator IE are not applicable. When the UE is not in the HPLMN (if the EHPLMN list is not present or is empty) or in an EHPLMN (if the EHPLMN list is present) or in a visited PLMN of the home country, the contents of the USIM file EFUAC_AIC are not applicable.\nThe UE uses the MCS indicator bit of the 5GS network feature support IE or of the Priority indicator IE to determine if access identity 2 is valid. Processing of the MCS indicator bit of the 5GS network feature support IE in the REGISTRATION ACCEPT message is described in subclause\u00a05.5.1.2.4 and subclause\u00a05.5.1.3.4. Processing of the MCS indicator bit of the Priority indicator IE in the CONFIGURATION UPDATE COMMAND message is described in subclause\u00a05.4.4.3. When the UE is neither in the HPLMN (if the EHPLMN list is not present or is empty) nor in an EHPLMN (if the EHPLMN list is present) nor in a visited PLMN of the home country, and the USIM file EFUAC_AIC indicates the UE is configured for access identity 2, the UE shall not consider access identity 2 to be valid , until the UE receives the MCS indicator bit of the 5GS network feature support IE in the REGISTRATION ACCEPT message or of the Priority indicator IE in the CONFIGURATION UPDATE COMMAND message being set to \"Access identity 2 valid\" from the RPLMN or from an equivalent PLMN.\nWhen the UE is in the HPLMN (if the EHPLMN list is not present or is empty) or in an EHPLMN (if the EHPLMN list is present) or in a visited PLMN of the home country, the contents of the USIM file EFUAC_AIC as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22] and the rules specified in table\u00a04.5.2.1 are used to determine the applicability of access identity 2. When the UE is in the HPLMN (if the EHPLMN list is not present or is empty) or in an EHPLMN (if the EHPLMN list is present) or in a visited PLMN of the home country, and the USIM file EFUAC_AIC does not indicate the UE is configured for access identity 2, the UE uses the MCS indicator bit of the 5GS network feature support IE in the REGISTRATION ACCEPT message or of the Priority indicator IE in the CONFIGURATION UPDATE COMMAND message to determine if access identity 2 is valid. When the UE is in the HPLMN (if the EHPLMN list is not present or is empty) or in an EHPLMN (if the EHPLMN list is present) or in a visited PLMN of the home country, and the USIM file EFUAC_AIC indicates the UE is configured for access identity 2, the MCS indicator bit of the 5GS network feature support IE and the Priority indicator IE is not applicable. When the UE is not in the HPLMN (if the EHPLMN list is not present or is empty) or in an EHPLMN (if the EHPLMN list is present) or in a visited PLMN of the home country, the contents of the USIM file EFUAC_AIC are not applicable.\nThe UE checks the conditions specified in subclause\u00a04.4.3.1.1 of 3GPP\u00a0TS\u00a023.122\u00a0[5] to determine if access identity 3 is valid, and the applicability of access identity 3.\nWhen the UE is in its HPLMN (if the EHPLMN list is not present or is empty) or in an EHPLMN (if the EHPLMN list is present), the contents of the USIM file EFACC as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22] and the rules specified in table\u00a04.5.2.1 are used to determine the applicability of access classes 11 and 15. When the UE is not in its HPLMN (if the EHPLMN list is not present or is empty) or in an EHPLMN (if the EHPLMN list is present), access classes 11 and 15 are not applicable.\nWhen the UE is in the HPLMN or in a visited PLMN of the home country, the contents of the USIM file EFACC as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22] and the rules specified in table\u00a04.5.2.1 are used to determine the applicability of access classes 12 - 14. When the UE is neither in the HPLMN nor in a visited PLMN of the home country, access classes 12-14 are not applicable.\nIn order to determine the access category applicable for the access attempt, the NAS shall check the rules in table\u00a04.5.2.2, and use the access category for which there is a match for barring check. If the access attempt matches more than one rule, the access category of the lowest rule number shall be selected. If the access attempt matches more than one operator-defined access category definition, the UE shall select the access category from the operator-defined access category definition with the lowest precedence value (see subclause\u00a04.5.3).\nNOTE:\tThe case when an access attempt matches more than one rule includes the case when multiple events trigger an access attempt at the same time. When multiple events trigger an access attempt at\u00a0the same time, how the access attempt is checked for multiple events is up to UE implementation.\nTable\u00a04.5.2.2: Mapping table for access categories\n4.5.2A\tDetermination of the access identities and access category associated with a request for access for UEs operating in SNPN access operation mode over 3GPP access\nWhen the UE needs to initiate an access attempt in one of the events listed in subclause\u00a04.5.1, the UE shall determine one or more access identities from the set of standardized access identities, and one access category from the set of standardized access categories and operator-defined access categories, to be associated with that access attempt.\nThe set of the access identities applicable for the request is determined by the UE in the following way:\na)\tfor each of the access identities 1, 2, 11, 12, 13, 14 and 15 in table\u00a04.5.2A.1, the UE shall check whether the access identity is applicable in the selected SNPN, if a new SNPN is selected, or otherwise if it is applicable in the RSNPN or equivalent SNPN; and\nb)\tif none of the above access identities is applicable, then access identity 0 is applicable.\nTable\u00a04.5.2A.1: Access identities\n\nThe contents of the unified access control configuration in the \"list of subscriber data\" stored in the ME (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), if an entry of \"list of subscriber data\" is selected, or in the USIM (see 3GPP\u00a0TS\u00a031.102\u00a0[22]), if the PLMN subscription is selected, and the rules specified in table\u00a04.5.2A.1 are used to determine the applicability of access identity 1 in the SNPN. When the contents of the unified access control configuration in the \"list of subscriber data\" stored in the ME (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), if an entry of \"list of subscriber data\" is selected, or in the USIM (see 3GPP\u00a0TS\u00a031.102\u00a0[22]), if the PLMN subscription is selected, do not indicate the UE is configured for access identity 1 for the SNPN, the UE uses the MPS indicator bit of the 5GS network feature support IE in the REGISTRATION ACCEPT message and the MPS indicator bit of the Priority indicator IE in the CONFIGURATION UPDATE COMMAND message to determine if access identity 1 is valid.\nThe contents of the unified access control configuration in the \"list of subscriber data\" stored in the ME (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), if an entry of \"list of subscriber data\" is selected, or in the USIM (see 3GPP\u00a0TS\u00a031.102\u00a0[22]), if the PLMN subscription is selected, and the rules specified in table\u00a04.5.2A.1 are used to determine the applicability of access identity 2 in the SNPN. When the contents of the unified access control configuration in the \"list of subscriber data\" stored in the ME (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), if an entry of \"list of subscriber data\" is selected, or in the USIM (see 3GPP\u00a0TS\u00a031.102\u00a0[22]), if the PLMN subscription is selected, do not indicate the UE is configured for access identity 2 for the SNPN, the UE uses the MCS indicator bit of the 5GS network feature support IE in the REGISTRATION ACCEPT message to determine if access identity 2 is valid.\nThe contents of the unified access control configuration in the \"list of subscriber data\" stored in the ME (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), if an entry of \"list of subscriber data\" is selected, or in the USIM (see 3GPP\u00a0TS\u00a031.102\u00a0[22]), if the PLMN subscription is selected, and the rules specified in table\u00a04.5.2A.1 are used to determine the applicability of access classes 11 to 15 in the SNPN.\nIn order to determine the access category applicable for the access attempt, the NAS shall check the rules in table\u00a04.5.2A.2, and use the access category for which there is a match for barring check. If the access attempt matches more than one rule, the access category of the lowest rule number shall be selected. If the access attempt matches more than one operator-defined access category definition, the UE shall select the access category from the operator-defined access category definition with the lowest precedence value (see subclause\u00a04.5.3).\nNOTE:\tThe case when an access attempt matches more than one rule includes the case when multiple events trigger an access attempt at the same time. When multiple events trigger an access attempt at\u00a0the same time, how the access attempt is checked for multiple events is up to UE implementation.\nTable\u00a04.5.2A.2: Mapping table for access categories\n\n4.5.3\tOperator-defined access categories\nOperator-defined access category definitions can be signalled to the UE using NAS signalling. Each operator-defined access category definition consists of the following parameters:\na)\ta precedence value which indicates in which order the UE shall evaluate the operator-defined category definition for a match;\nb)\tan operator-defined access category number, i.e. access category number in the 32-63 range that uniquely identifies the access category in the PLMN or SNPN in which the access categories are being sent to the UE;\nc)\tcriteria consisting of one or more access category criteria type and associated access category criteria type values. The access category criteria type can be set to one of the following:\n1)\tDNN;\n2)\tVoid;\n3)\tOS Id + OS App Id of application triggering the access attempt; or\n4)\tS-NSSAI; and\nNOTE\u00a01:\tAn access category criteria type can be associated with more than one access category criteria values.\nd)\toptionally, a standardized access category. This standardized access category is used in combination with the access identities of the UE to determine the RRC establishment cause as specified in subclause\u00a04.5.6.\nIf the access attempt is to establish a new PDU session i.e. it is triggered by:\n-\ta request from upper layers to send an UL NAS TRANSPORT message for the purpose of PDU session establishment unless the request triggered a service request procedure (or a registration procedure if the UE is in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE) to transition the UE from 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication to 5GMM-CONNECTED mode; or\n-\ta service request procedure (or a registration procedure if the UE is in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE) to transition the UE from 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication to 5GMM-CONNECTED mode triggered by a request from upper layers to send an UL NAS TRANSPORT message for the purpose of PDU session establishment,\nthen:\n-\tthe access attempt matches access category criteria type DNN if the DNN requested by the UE during the PDU session establishment procedure matches any of the access criteria type values associated with the access criteria type DNN; and\n-\tthe access attempt matches access category criteria type S-NSSAI if the S-NSSAI requested by the UE during the PDU session establishment procedure matches any of the access criteria type values associated with the access criteria type S-NSSAI.\nIf the access attempt is for an existing PDU session i.e. it is triggered by:\n-\ta request from upper layers to send an UL NAS TRANSPORT message for the purpose of PDU session modification unless the request triggered a service request procedure (or a registration procedure if the UE is in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE) to transition the UE from 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication to 5GMM-CONNECTED mode;\n-\ta service request procedure (or a registration procedure if the UE is in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE) to transition the UE from 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication to 5GMM-CONNECTED mode triggered by a request from upper layers to send an UL NAS TRANSPORT message for the purpose of PDU session modification;\n-\ta service request procedure (or a registration procedure if the UE is in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE) to transition the UE from 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication to 5GMM-CONNECTED mode triggered by a request from upper layers to send an UL NAS TRANSPORT message for the purpose of PDU session release;\n-\ta service request procedure (or a registration procedure if the UE is in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE) requesting user-plane resources for a PDU session; or\n-\tan uplink user data packet is to be sent for a PDU session with suspended user-plane resources,\nthen:\n-\tthe access attempt matches access category criteria type DNN if the DNN provided by the network in the PDU SESSION ESTABLISHMENT ACCEPT message matches any of the access criteria type values associated with the access criteria type DNN; and\n-\tthe access attempt matches access category criteria type S-NSSAI if the S-NSSAI associated with the PDU session matches any of the access criteria type values associated with the access criteria type S-NSSAI.\nNOTE\u00a02:\tIn order to avoid having access attempts for non-always-on PDU sessions blocked due to access barring of always-on PDU sessions, it is recommended that the network assigns the highest precedence values to operator-defined access category definition which can be matched by always-on PDU sessions.\nAn access attempt matches the criteria of an operator-defined access category definition, if the access attempt matches all access category criteria types included in the criteria with any of the associated access criteria type values.\nEach operator-defined access category definition has a different precedence value.\nSeveral operator-defined access category definitions can have the same operator-defined access category number.\nIf:\n-\tan access category in bullet d) is not provided;\n-\tan access category in bullet d) is provided and is not a standardized access category; or\n-\tan access category in bullet d) is provided, is a standardized access category and is not recognized by the UE;\nthe UE shall use instead access category 7 (MO_data) in combination with the access identities of the UE to determine the RRC establishment cause as specified in subclause\u00a04.5.6.\nThe operator-defined access category definitions are valid in the PLMN which provided them and in a PLMN equivalent to the PLMN which provided them, or in the SNPN which provided them and in an SNPN equivalent to the SNPN which provided them, as specified in annex\u00a0C.\nIf the UE stores operator-defined access category definitions valid in the selected PLMN or the RPLMN, or valid in the selected SNPN or RSNPN, then access control in 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication will only be performed for the event a) defined in subclause\u00a04.5.1. If the transition from 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication over 3GPP access to 5GMM-CONNECTED mode is due to a UE NAS initiated 5GMM specific procedure, then this access attempt shall be mapped to one of the standardized access categories in the range < 32, see subclause\u00a04.5.2. I.e. for this case the UE shall skip the checking of operator-defined access category definitions.\nIf the UE stores operator-defined access category definitions valid in the selected PLMN or the RPLMN, or valid in the selected SNPN or RSNPN, then access control in 5GMM-CONNECTED mode and in 5GMM-CONNECTED mode with RRC inactive indication will only be performed for the events 1) to 8) defined in subclause\u00a04.5.1.\nThe UE shall handle the operator-defined access category definitions stored for the RPLMN or RSNPN as specified in subclause\u00a05.4.4.3, subclause\u00a05.5.1.2.4, and subclause\u00a05.5.1.3.4.\nWhen the UE is switched off, the UE shall keep the operator-defined access category definitions so that the operator-defined access category definitions can be used after switch on.\nWhen the UE selects a new PLMN which is not equivalent to the previously selected PLMN, or selects a new SNPN which is not equivalent to the previously selected SNPN, the UE shall stop using the operator-defined access category definitions stored for the previously selected PLMN or SNPN and should keep the operator-defined access category definitions stored for the previously selected PLMN or SNPN.\nNOTE\u00a03:\tWhen the UE selects a new PLMN which is not equivalent to the previously selected PLMN, or selects a new SNPN which is not equivalent to the previously selected SNPN, the UE can delete the operator-defined access category definitions stored for the previously selected PLMN or SNPN e.g. if there is no storage space in the UE.\n4.5.4\tAccess control and checking\n4.5.4.1\tAccess control and checking in 5GMM-IDLE mode and in 5GMM-IDLE mode with suspend indication\nWhen the UE is in 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication, upon receiving a request from the upper layers for an access attempt, the NAS shall categorize the access attempt into access identities and an access category following:\na)\tsubclause\u00a04.5.2, table\u00a04.5.2.1 and table\u00a04.5.2.2, and subclause\u00a04.5.3, if the UE is not operating in SNPN access operation mode over 3GPP access ; or\nb)\tsubclause\u00a04.5.2A, table\u00a04.5.2A.1 and table\u00a04.5.2A.2, and subclause\u00a04.5.3, if the UE is operating in SNPN access operation mode over 3GPP access ,\nand provide the applicable access identities and the access category to the lower layers for the purpose of access control checking. In this request to the lower layer the NAS can also provide to the lower layer the RRC establishment cause determined as specified in subclause\u00a04.5.6 of this specification.\nNOTE\u00a01:\tThe access barring check is performed by the lower layers.\nNOTE\u00a02:\tAs an implementation option, the NAS can provide the RRC establishment cause to the lower layers after being informed by the lower layers that the access attempt is allowed.\nIf the UE has uplink user data pending for one or more PDU sessions when it builds a REGISTRATION REQUEST or SERVICE REQUEST message as initial NAS message, the UE shall indicate the respective PDU sessions in the Uplink data status IE as specified in subclause\u00a05.5.1.3.2 and 5.6.1.2.1, regardless of the access category for which the access barring check is performed.\nIf the UE is registered for 5GS services with control plane CIoT 5GS optimization has uplink user data pending for one or more PDU sessions when it builds a CONTROL PLANE SERVICE REQUEST message as initial NAS message, the UE shall indicate the respective PDU sessions as specified in subclause\u00a05.6.1.2.2, regardless of the access category for which the access barring check is performed.\nNOTE\u00a03:\tThe UE indicates pending user data for all the respective PDU sessions, even if barring timers are running for some of the corresponding access categories.\nIf the lower layers indicate that the access attempt is allowed, the NAS shall initiate the procedure to send the initial NAS message for the access attempt.\nIf the lower layers indicate that the access attempt is barred, the NAS shall not initiate the procedure to send the initial NAS message for the access attempt. Additionally:\na)\tif the event which triggered the access attempt was an MO-MMTEL-voice-call-started indication or an MO-MMTEL-video-call-started indication:\n1)\tif the UE is operating in the single-registration mode, the UE's usage setting is \"voice centric\" and the UE has not disabled its E-UTRA capability as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15], the UE may attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC, it then proceeds with the appropriate EMM specific procedures and, if necessary, ESM procedures to make a PDN connection providing access to IMS available; see subclause\u00a04.8.2 and 3GPP\u00a0TS\u00a024.301\u00a0[15];\n2)\tif the UE is operating in the dual-registration mode, the UE may proceed in S1 mode with the appropriate EMM specific procedures and ESM procedures to make a PDN connection providing access to IMS available; see subclause\u00a04.8.3 and 3GPP\u00a0TS\u00a024.301\u00a0[15]; or\n3)\totherwise, the NAS shall notify the upper layers that the access attempt is barred. In this case, upon receiving an indication from the lower layers that the barring is alleviated for the access category with which the access attempt was associated, the NAS shall notify the upper layers that the barring is alleviated for the access category and may initiate the procedure to send the initial NAS message, if still needed;\nb)\tif the event which triggered the access attempt was an MO-SMSoIP-attempt-started indication or an MO-IMS-registration-related-signalling-started indication:\n1)\tif the UE is operating in the single-registration mode, the UE may attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC, it then proceeds with the appropriate EMM specific procedures and, if necessary, ESM procedures to make a PDN connection providing access to IMS available; see subclause\u00a04.8.2 and 3GPP\u00a0TS\u00a024.301\u00a0[15];\n2)\tif the UE is operating in the dual-registration mode, the UE may proceed in S1 mode with the appropriate EMM specific procedures and ESM procedures to make a PDN connection providing access to IMS available; see subclause\u00a04.8.3 and 3GPP\u00a0TS\u00a024.301\u00a0[15]; or\n3)\totherwise, the NAS shall notify the upper layers that the access attempt is barred. In this case, upon receiving an indication from the lower layers that the barring is alleviated for the access category with which the access attempt was associated, the NAS shall notify the upper layers that the barring is alleviated for the access category and may initiate the procedure to send the initial NAS message, if still needed; and\nc)\tif the access attempt is for emergency:\n1)\tthe NAS shall notify the upper layers that the access attempt is barred. In this case, upon receiving an indication from the lower layers that the barring is alleviated for the access category with which the access attempt was associated, the NAS shall notify the upper layers of that the barring is alleviated for the access category and may initiate the procedure to send the initial NAS message, if still needed.\nNOTE\u00a04:\tThis can result in the upper layers requesting another emergency call attempt using domain selection as specified in 3GPP\u00a0TS\u00a023.167\u00a0[6] and 3GPP\u00a0TS\u00a024.229\u00a0[14].\nNOTE\u00a05:\tBarring timers, on a per access category basis, are run by the lower layers. At expiry of barring timers, the indication of alleviation of access barring is indicated to the NAS on a per access category basis.\n4.5.4.2\tAccess control and checking in 5GMM-CONNECTED mode and in 5GMM-CONNECTED mode with RRC inactive indication\nWhen the UE is in 5GMM-CONNECTED mode or 5GMM-CONNECTED mode with RRC inactive indication, upon detecting one of events 1) through 8) listed in subclause\u00a04.5.1, the NAS shall categorize the corresponding access attempt into access identities and an access category following:\na)\tsubclause\u00a04.5.2, table\u00a04.5.2.1 and table\u00a04.5.2.2, and subclause\u00a04.5.3, if the UE is not operating in SNPN access operation mode over 3GPP access ; or\nb)\tsubclause\u00a04.5.2A, table\u00a04.5.2A.1 and table\u00a04.5.2A.2, and subclause\u00a04.5.3, if the UE is operating in SNPN access operation mode over 3GPP access ,\nand provide the access identities and the access category to the lower layers for the purpose of access control checking. In this request to the lower layer the NAS can also provide to the lower layer the RRC establishment cause determined as specified in subclause\u00a04.5.6 of this specification.\nNOTE\u00a01:\tAs an implementation option, the NAS can provide the RRC establishment cause to the lower layers after being informed by the lower layers that the access attempt is allowed.\nIf the UE has uplink user data pending for one or more PDU sessions when it builds a REGISTRATION REQUEST or SERVICE REQUEST message for the access attempt, the UE shall indicate the respective PDU sessions in the Uplink data status IE as specified in subclause\u00a05.5.1.3.2 and 5.6.1.2, regardless of the access category for which the access barring check is performed.\nNOTE\u00a02:\tThe UE indicates pending user data for all the respective PDU sessions, even if barring timers are running for some of the corresponding access categories.\nIf the lower layers indicate that the access attempt is allowed, the NAS shall take the following action depending on the event which triggered the access attempt:\na)\tif the event which triggered the access attempt was an MO-MMTEL-voice-call-started indication, an MO-MMTEL-video-call-started indication, an MO-SMSoIP-attempt-started indication, or an MO-IMS-registration-related-signalling-started indication, the NAS shall notify the upper layers that the access attempt is allowed;\nb)\tif the event which triggered the access attempt was a request from upper layers to send a mobile originated SMS over NAS, 5GMM shall initiate the NAS transport procedure as specified in subclause\u00a05.4.5 to send the SMS in an UL NAS TRANSPORT message;\nc)\tif the event which triggered the access attempt was a request from upper layers to establish a new PDU session, 5GMM shall initiate the NAS transport procedure as specified in subclause\u00a05.4.5 to send the PDU SESSION ESTABLISHMENT REQUEST message;\nd)\tif the event which triggered the access attempt was a request from upper layers to modify an existing PDU session, 5GMM shall initiate the NAS transport procedure as specified in subclause\u00a05.4.5 to send the PDU SESSION MODIFICATION REQUEST message;\ne)\tif the event which triggered the access attempt was a request to re-establish the user-plane resources for an existing PDU session, 5GMM shall initiate the service request procedure as specified in subclause\u00a05.6.1;\nf)\tif the event which triggered the access attempt was an uplink user data packet to be sent for a PDU session with suspended user-plane resources, 5GMM shall consider that the uplink user data packet is allowed to be sent;\ng)\tif the event which triggered the access attempt was a request from upper layers to send a mobile originated location request, 5GMM shall initiate the NAS transport procedure as specified in subclause\u00a05.4.5 to send an LCS message in an UL NAS TRANSPORT message; and\nh)\tif the event which triggered the access attempt was a request from upper layers to send a mobile originated signalling transaction towards the PCF by sending an UL NAS TRANSPORT message including a UE policy container (see 3GPP\u00a0TS\u00a024.587\u00a0[19B] and 3GPP\u00a0TS\u00a024.554\u00a0[19E]), 5GMM shall initiate the NAS transport procedure as specified in subclause\u00a05.4.5 to send the signalling transaction via an UL NAS TRANSPORT message.\nIf the lower layers indicate that the access attempt is barred, the NAS shall take the following action depending on the event which triggered the access attempt:\na)\tif the event which triggered the access attempt was an MO-MMTEL-voice-call-started indication, an MO-MMTEL-video-call-started indication or an MO-SMSoIP-attempt-started indication, or an MO-IMS-registration-related-signalling-started indication:\n1)\tif the UE is operating in the dual-registration mode, the UE may proceed in S1 mode with the appropriate EMM specific procedures and ESM procedures to make a PDN connection providing access to IMS available; see subclause\u00a04.8.3 and 3GPP\u00a0TS\u00a024.301\u00a0[15];\n2)\totherwise, the NAS shall notify the upper layers that the access attempt is barred. In this case, upon receiving an indication from the lower layers that the barring is alleviated for the access category with which the access attempt was associated, the NAS shall notify the upper layers that the barring is alleviated for the access category;\nNOTE\u00a03:\tIn this case prohibiting the initiation of the MMTEL voice session, MMTEL video session or prohibiting sending of the SMS over IP or the IMS registration related signalling is performed by the upper layers.\nb)\tif the event which triggered the access attempt was a request from upper layers to send a mobile originated SMS over NAS, 5GMM shall not initiate the NAS transport procedure as specified in subclause\u00a05.4.5 to send the SMS in an UL NAS TRANSPORT message. Upon receiving an indication from the lower layers that the barring is alleviated for the access category with which the access attempt was associated, 5GMM may initiate the NAS transport procedure as specified in subclause\u00a05.4.5 to send the SMS in an UL NAS TRANSPORT message, if still needed;\nc)\tif the event which triggered the access attempt was a request from upper layers to establish a new PDU session, 5GMM shall not initiate the NAS transport procedure to send the PDU SESSION ESTABLISHMENT REQUEST message. Upon receiving an indication from the lower layers that the barring is alleviated for the access category with which the access attempt was associated, the NAS may initiate the NAS transport procedure as specified in subclause\u00a05.4.5, if still needed;\nd)\tif the event which triggered the access attempt was a request from upper layers to modify an existing PDU session modification, 5GMM shall not initiate the NAS transport procedure to send the PDU SESSION MODIFICATION REQUEST message. Upon receiving an indication from the lower layers that the barring is alleviated for the access category with which the access attempt was associated, the NAS may initiate the NAS transport procedure as specified in subclause\u00a05.4.5, if still needed;\ne)\tif the event which triggered the access attempt was a request to re-establish the user-plane resources for an existing PDU session, the NAS shall not initiate the service request procedure as specified in subclause\u00a05.6.1. Upon receiving an indication from the lower layers that the barring is alleviated for the access category with which the access attempt was associated, the NAS may initiate the service request procedure as specified in subclause\u00a05.6.1, if still needed;\nf)\tif the event which triggered the access attempt was an uplink user data packet to be sent for a PDU session with suspended user-plane resources, 5GMM shall consider that the uplink user data packet is not allowed to be sent. Upon receiving an indication from the lower layers that the barring is alleviated for the access category with which the access attempt was associated, the NAS shall consider that the barring is alleviated for the access category;\ng)\tif the event which triggered the access attempt was a request from upper layers to send a mobile originated location request, 5GMM shall not initiate the NAS transport procedure as specified in subclause\u00a05.4.5 to send an LCS message in an UL NAS TRANSPORT message. Upon receiving an indication from the lower layers that the barring is alleviated for the access category with which the access attempt was associated, 5GMM may initiate the NAS transport procedure as specified in subclause\u00a05.4.5 to send the LCS message in an UL NAS TRANSPORT message, if still needed; and\nh)\tif the event which triggered the access attempt was a request from upper layers to send a mobile originated signalling transaction towards the PCF by sending an UL NAS TRANSPORT message including a UE policy container (see 3GPP\u00a0TS\u00a024.587\u00a0[19B] and 3GPP\u00a0TS\u00a024.554\u00a0[19E]), 5GMM shall not initiate the NAS transport procedure as specified in subclause\u00a05.4.5 to send the mobile originated signalling transaction via an UL NAS TRANSPORT message. Upon receiving an indication from the lower layers that the barring is alleviated for the access category with which the access attempt was associated, 5GMM may initiate the NAS transport procedure as specified in subclause\u00a05.4.5 to send the mobile originated signalling transaction via an UL NAS TRANSPORT message, if still needed.\n4.5.5\tException handling and avoiding double barring\nAccess attempts are allowed to proceed without further access control checking in order to avoid double barring for any service request or registration procedure initiated for the purpose of NAS signalling connection recovery or following a fallback indication from the lower layers (see subclauses\u00a05.3.1.2 and 5.3.1.4).\nNOTE\u00a01:\tThe case of NAS signalling connection recovery also includes the cases where the UE was in S1 mode when the RRC connection failure occurred.\nFor any service request or registration procedure of this kind the UE determines an access category as specified in subclause\u00a04.5.1 and 4.5.2 or 4.5.2A, unless a different access category is specified in the rest of the present subclause.\nNOTE\u00a02:\tAlthough the access control checking is skipped, the access category is determined for the specific access attempt in order to derive an RRC establishment cause.\nThere are several services or an MO IMS registration related signalling for which the NAS needs to be informed when the service starts and stops,\n-\tbecause, while the service is ongoing or the MO IMS registration related signalling is ongoing, the mapping of other access attempts to a specific access category can be affected; and\n-\tin order to avoid double barring at the start of these services or at the start of the MO IMS registration related signalling.\nThese services are:\na)\temergency service;\nb)\tMMTEL voice;\nc)\tMMTEL video;\nd)\tSMSoIP;\ne)\tSMS over NAS;\nf)\t5GC-MO-LR procedure;\ng)\tUE-requested policy provisioning procedure for V2XP, ProSeP or both; and\nh)\tCIoT user data transfer over the control plane.\nThe UE considers an emergency service a) as started when 5GMM receives a request from upper layers to register for emergency services or to establish a PDU session with request type = \"initial emergency request\" or \"existing emergency PDU session\". It considers the emergency service as stopped when this PDU session is released.\nIn addition, the UE considers an emergency service a) as started when the 5GMM receives a request from the upper layers to perform emergency services fallback and performs emergency services fallback as specified in subclause\u00a04.13.4.2 of 3GPP\u00a0TS\u00a023.502\u00a0[9]. In this case, the UE considers the emergency service as stopped when:\n-\tthe emergency PDU session established during the emergency services fallback is released if the UE has moved to an E-UTRA cell connected to 5GCN; or\n-\tthe service request procedure involved in the emergency services fallback is completed otherwise.\nWhile an emergency service a) is ongoing, any access attempt triggered by the initiation of a registration, de-registration or service request procedure or by an uplink user data packet to be sent for an emergency PDU session with suspended user-plane resources is mapped to access category 2 = emergency.\nOnce the emergency service has successfully passed access control, then as long as the service is ongoing, the following access attempts are allowed to proceed without further access control checking in order to avoid double barring:\n-\tany service request procedure related to the PDU session associated with request type = \"initial emergency request\" or \"existing emergency PDU session\"; and\n-\tany uplink user data packet to be sent for a PDU session with suspended user-plane resources associated with request type = \"initial emergency request\" or \"existing emergency PDU session\".\nNOTE\u00a03:\tAlthough the access control checking is skipped, the mapping is performed in order to derive an RRC establishment cause.\nFor services b) to h) the 5GMM receives explicit start and stop indications from the upper layers.\nFor the case of handover of ongoing services b) to d) from non-3GPP access, the 5GMM receives an additional explicit handover of ongoing service from non-3GPP access indication from the upper layers. \nThe 5GMM may receive an additional explicit \"call-pull-initiated\" indication from the upper layers (see 3GPP\u00a0TS\u00a024.174\u00a0[13D]).\nOnce the service has successfully passed access control, then as long as the service is ongoing, the following access attempts are allowed to proceed without further access control checking in order to avoid double barring:\n-\tfor services b), c) and d):\n1)\tany service request procedure related to the PDU session established for DNN = \"IMS\" except between receiving from the lower layers an indication that access barring is applicable for all access categories except categories 0 and 2, or access barring is applicable for all access categories except category 0, and receiving from the lower layers an indication that the barring is alleviated for the access category determined for the access attempt;\n2)\tany uplink user data packet to be sent for a PDU session with suspended user-plane resources established for DNN = \"IMS\" except between receiving from the lower layers an indication that access barring is applicable for all access categories except categories 0 and 2, or access barring is applicable for all access categories except category 0, and receiving from the lower layers an indication that the barring is alleviated for the access category determined for the access attempt; and\n3)\tany start of the MO IMS registration related signalling;\n-\tfor service d), if the upper layers have indicated a DNN used for SMSoIP and the indicated DNN used for SMSoIP is different from \"IMS\":\n1)\tany service request procedure related to the PDU session established for the DNN used for SMSoIP except between receiving from the lower layers an indication that access barring is applicable for all access categories except categories 0 and 2, or access barring is applicable for all access categories except category 0, and receiving from the lower layers an indication that the barring is alleviated for access category 6; and\n2)\tany uplink user data packet to be sent for a PDU session with suspended user-plane resources established for the DNN used for SMSoIP except between receiving from the lower layers an indication that access barring is applicable for all access categories except categories 0 and 2, or access barring is applicable for all access category except category 0, and receiving from the lower layers an indication that the barring is alleviated for access category 6.\nFor the MO IMS registration related signalling, the 5GMM receives explicit start and stop indications from the upper layers.\nOnce the MO IMS registration related signalling has successfully passed access control, then as long as the MO IMS registration related signalling is ongoing, the following access attempts are allowed to proceed without further access control checking in order to avoid double barring:\n1)\tany service request procedure related to the PDU session established for DNN = \"IMS\" and for the DNN used for SMSoIP, if the upper layers have indicated a DNN used for SMSoIP and the indicated DNN used for SMSoIP is different from \"IMS\", except between receiving from the lower layers an indication that access barring is applicable for all access categories except categories 0 and 2, or access barring is applicable for all access categories except category 0 and receiving from the lower layers an indication that the barring is alleviated for the access category determined for the access attempt; and\n2)\tany uplink user data packet to be sent for a PDU session with suspended user-plane resources established for DNN = \"IMS\" and for the DNN used for SMSoIP except between receiving from the lower layers an indication that access barring is applicable for all access categories except categories 0 and 2, or access barring is applicable for all access categories except category 0 and receiving from the lower layers an indication that the barring is alleviated for the access category determined for the access attempt;\nWhile an MMTEL voice call is ongoing:\n-\tany service request procedure related to the PDU session established for DNN = \"IMS\" is mapped to access category 4;\n-\tany uplink user data packet to be sent for a PDU session with suspended user-plane resources established for DNN = \"IMS\" is mapped to access category 4; and\n-\tany:\n1)\tservice request procedure; or\n2)\tregistration procedure;\n\tinitiated in 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication for the purpose of NAS signalling connection recovery or following a fallback indication from the lower layers (see subclause\u00a05.3.1.2 and\u00a05.3.1.4) is mapped to access category 4.\nWhile an MMTEL video call is ongoing and no MMTEL voice call is ongoing:\n-\tany service request procedure related to the PDU session established for DNN = \"IMS\" is mapped to access category 5;\n-\tany uplink user data packet to be sent for a PDU session with suspended user-plane resources established for DNN = \"IMS\" is mapped to access category 5; and\n-\tany:\n1)\tservice request procedure; or\n2)\tregistration procedure;\n\tinitiated in 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication for the purpose of NAS signalling connection recovery or following a fallback indication from the lower layers (see subclause\u00a05.3.1.2 and\u00a05.3.1.4) is mapped to access category 5.\nWhile an SMSoIP is ongoing, no MMTEL video call is ongoing and no MMTEL voice call is ongoing:\n-\tany service request procedure related to the PDU session established:\n1)\tfor DNN = \"IMS\"; or\n2)\tfor the DNN used for SMSoIP, if the upper layers have indicated a DNN used for SMSoIP and the indicated DNN used for SMSoIP is different from \"IMS\";\n\tis mapped to access category 6; and\n-\tany uplink user data packet to be sent for a PDU session with suspended user-plane resources established:\n1)\tfor DNN = \"IMS\"; or\n2)\tfor the DNN used for SMSoIP, if the upper layers have indicated a DNN used for SMSoIP and the indicated DNN used for SMSoIP is different from \"IMS\";\n\tis mapped to access category 6; and\n-\tany:\n1)\tservice request procedure; or\n2)\tregistration procedure;\n\tinitiated in 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication for the purpose of NAS signalling connection recovery or following a fallback indication from the lower layers (see subclause\u00a05.3.1.2 and\u00a05.3.1.4) is mapped to access category 6.\nWhile an SMS over NAS is ongoing, no SMSoIP is ongoing, no MMTEL video call is ongoing and no MMTEL voice call is ongoing:\n-\tany:\n1)\tservice request procedure; or\n2)\tregistration procedure;\n\tinitiated in 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication for the purpose of NAS signalling connection recovery or following a fallback indication from the lower layers (see subclause\u00a05.3.1.2 and\u00a05.3.1.4) is mapped to access category 6.\nWhile an MO IMS registration related signalling is ongoing, no SMSoIP is ongoing, no MMTEL video call is ongoing and no MMTEL voice call is ongoing:\n-\tany service request procedure related to the PDU session established:\n1)\tfor DNN = \"IMS\"; and\n2)\tfor the DNN used for SMSoIP, if the upper layers have indicated a DNN used for SMSoIP and the indicated DNN used for SMSoIP is different from \"IMS\";\n\tis mapped to access category 9; and\n-\tany uplink user data packet to be sent for a PDU session with suspended user-plane resources established:\n1)\tfor DNN = \"IMS\"; and\n2)\tfor the DNN used for SMSoIP, if the upper layers have indicated a DNN used for SMSoIP and the indicated DNN used for SMSoIP is different from \"IMS\";\n\tis mapped to access category 9; and\n-\tif no SMS over NAS is ongoing, any:\n1)\tservice request procedure; or\n2)\tregistration procedure;\n\tinitiated in 5GMM-IDLE mode for the purpose of NAS signalling connection recovery or following a fallback indication from the lower layers (see subclause\u00a05.3.1.2 and\u00a05.3.1.4) is mapped to access category 9.\nWhile a 5GC-MO-LR procedure is ongoing, no SMS over NAS is ongoing, no SMSoIP is ongoing, no MO IMS registration related signalling is ongoing, no MMTEL video call is ongoing, and no MMTEL voice call is ongoing:\n-\tany:\n1)\tservice request procedure; or\n2)\tregistration procedure;\n\tinitiated in 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication for the purpose of NAS signalling connection recovery or following a fallback indication from the lower layers (see subclauses\u00a05.3.1.2 and\u00a05.3.1.4) is mapped to access category 3.\nWhile a UE-requested policy provisioning procedure for V2XP, ProSeP or both (see 3GPP\u00a0TS\u00a024.587\u00a0[19B] and 3GPP\u00a0TS\u00a024.554\u00a0[19E]), no 5GC-MO-LR procedure is ongoing, no SMS over NAS is ongoing, no SMSoIP is ongoing, no MMTEL video call is ongoing, and no MMTEL voice call is ongoing:\n-\tany:\n1)\tservice request procedure; or\n2)\tregistration procedure;\n\tinitiated in 5GMM-IDLE mode for the purpose of NAS signalling connection recovery or following a fallback indication from the lower layers (see subclauses\u00a05.3.1.2 and\u00a05.3.1.4) is mapped to access category 3.\nWhile CIoT user data transfer over the control plane is ongoing, no 5GC-MO-LR procedure is ongoing, no SMS over NAS is ongoing, no SMSoIP is ongoing, no MMTEL video call is ongoing, and no MMTEL voice call is ongoing, any service request procedure initiated in 5GMM-IDLE mode following a fallback indication from the lower layers (see subclause\u00a05.3.1.4) is mapped to access category 7.\nNOTE\u00a03:\tAlthough the access control checking is skipped, the mapping is performed in order to derive an RRC establishment cause.\nIf an access category is determined and the access control checking is skipped, the NAS shall determine the RRC establishment cause from one or more determined access identities and the access category as specified in subclause\u00a04.5.6, the NAS shall initiate the procedure to send the initial NAS message for the access attempt and shall provide the RRC establishment cause to lower layers.\nIf the UE receives from the lower layers an indication that access barring is applicable for all access categories except categories 0 and 2, or access barring is applicable for all access categories except category 0:\na)\tif an MMTEL voice call or MMTEL video call is ongoing:\n1)\tif the UE is operating in the single-registration mode and the UE's usage setting is \"voice centric\", the UE may attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC, it then proceeds with the appropriate EMM specific procedures and, if necessary, ESM procedures to make a PDN connection providing access to IMS available; see subclause\u00a04.8.2 and 3GPP\u00a0TS\u00a024.301\u00a0[15]; and\n2)\tif the UE is operating in the dual-registration mode, the UE may proceed in S1 mode with the appropriate EMM specific procedures and ESM procedures to make a PDN connection providing access to IMS available; see subclause\u00a04.8.3 and 3GPP\u00a0TS\u00a024.301\u00a0[15]; and\nb)\tif SMSoIP is ongoing or an MO IMS registration related signalling is ongoing:\n1)\tif the UE is operating in the single-registration mode, the UE may attempt to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC, it then proceeds with the appropriate EMM specific procedures and, if necessary, ESM procedures to make a PDN connection providing access to IMS available; see subclause\u00a04.8.2 and 3GPP\u00a0TS\u00a024.301\u00a0[15]; and\n2)\tif the UE is operating in the dual-registration mode, the UE may proceed in S1 mode with the appropriate EMM specific procedures and ESM procedures to make a PDN connection providing access to IMS available; see subclause\u00a04.8.3 and 3GPP\u00a0TS\u00a024.301\u00a0[15].\n4.5.6\tMapping between access categories/access identities and RRC establishment cause\nWhen 5GMM requests the establishment of a NAS-signalling connection, the RRC establishment cause used by the UE shall be selected according to one or more access identities (see subclauses\u00a04.5.2 and 4.5.2A) and the determined access category by checking the rules specified in table\u00a04.5.6.1 and table\u00a04.5.6.2. If the access attempt matches more than one rule, the RRC establishment cause of the lowest rule number shall be used. If the determined access category is an operator-defined access category, then the RRC establishment cause used by the UE shall be selected according to table\u00a04.5.6.1 and table\u00a04.5.6.2 based on one or more access identities (see subclauses\u00a04.5.2 and 4.5.2A) and the standardized access category determined for the operator-defined access category as described in subclause\u00a04.5.3.\nNOTE\u00a01:\tFollowing an RRC release with redirection, the lower layers can set the RRC establishment cause or the resume cause to \"mps-PriorityAccess\" in the case of redirection to an NR cell connected to 5GCN (see 3GPP\u00a0TS\u00a038.331\u00a0[30]) or to \"highPriorityAccess\" in the case of redirection to an E-UTRA cell connected to 5GCN (see 3GPP\u00a0TS\u00a036.331\u00a0[25A]), if the network indicates to the UE during RRC connection release with redirection that the UE has an active MPS session.\nNOTE\u00a02:\tWhen the UE is acting as a 5G ProSe layer-2 UE-to-network relay UE, it is possible for the lower layer to decide an applicable RRC establishment cause according to the request from the 5G ProSe layer-2 remote UE or according to the indication from upper layers, including the case when the request from the 5G ProSe layer-2 remote UE is for emergency services, as specified in 3GPP\u00a0TS\u00a038.331\u00a0[30].\nTable\u00a04.5.6.1: Mapping table for access identities/access categories and RRC establishment cause when establishing N1 NAS signalling connection via NR connected to 5GCN\n\nTable\u00a04.5.6.2: Mapping table for access identities/access categories and RRC establishment cause when establishing N1 NAS signalling connection via E-UTRA connected to 5GCN\n\n4.6\tNetwork slicing\n4.6.1\tGeneral\nThe 5GS supports network slicing as described in 3GPP\u00a0TS\u00a023.501\u00a0[8]. Within a PLMN or SNPN, a network slice is identified by an S-NSSAI, which is comprised of a slice/service type (SST) and a slice differentiator (SD). Inclusion of an SD in an S-NSSAI is optional. A set of one or more S-NSSAIs is called the NSSAI. The following S-NSSAIs and NSSAIs are defined in 3GPP\u00a0TS\u00a023.501\u00a0[8]:\na)\tconfigured NSSAI;\nb)\trequested NSSAI;\nc)\tallowed NSSAI;\nd)\tsubscribed S-NSSAIs;\ne)\tpending NSSAI;\nf)\talternative S-NSSAIs; and\ng)\tpartially allowed NSSAI.\nThe following NSSAIs are defined in the present document:\na)\trejected NSSAI for the current PLMN or SNPN;\nb)\trejected NSSAI for the current registration area;\nc)\trejected NSSAI for the failed or revoked NSSAA;\nd)\trejected NSSAI for the maximum number of UEs reached;\ne)\talternative NSSAI; and\nf)\tpartially rejected NSSAI.\nIn roaming scenarios, rejected NSSAI for the current PLMN or SNPN, rejected NSSAI for the current registration area, rejected NSSAI for the maximum number of UEs reached, or partially rejected NSSAI includes one or more S-NSSAIs for the current PLMN and also contains a set of mapped S-NSSAI(s). An S-NSSAI included in the rejected NSSAI for the failed or revoked NSSAA is an HPLMN S-NSSAI.\nIn case of a PLMN, a serving PLMN may configure a UE with:\na)\tthe configured NSSAI per PLMN;\nb)\tNSSRG information if the UE has indicated that it supports the subscription-based restrictions to simultaneous registration of network slices feature;\nc)\ton-demand NSSAI if the UE has indicated it supports the network slice usage control feature;\nd)\tS-NSSAI time validity information if the UE has indicated that it supports S-NSSAI time validity information; and\ne)\tS-NSSAI location validity information if the UE has indicated that it supports S-NSSAI location validity information.\nIn addition, the HPLMN may configure a UE with a single default configured NSSAI and consider the default configured NSSAI as valid in a PLMN for which the UE has neither a configured NSSAI nor an allowed NSSAI. The support for NSSRG information by the UE and the network, respectively, is optional.\nNOTE\u00a00:\tIn this version of the specification, the network slice usage control feature is not supported in roaming scenarios.\nNOTE\u00a01:\tThe value(s) used in the default configured NSSAI are expected to be commonly decided by all roaming partners, e.g., values standardized by 3GPP or other bodies.\nIn case of an SNPN, the SNPN may configure a UE which is neither registering nor registered for onboarding services in SNPN with:\na)\ta configured NSSAI applicable to the SNPN;\nb)\tNSSRG information if the UE has indicated that it supports the subscription-based restrictions to simultaneous registration of network slices feature;\nc)\tS-NSSAI time validity information if the UE has indicated that it supports S-NSSAI time validity information;\nd)\ton-demand NSSAI if the UE has indicated it supports the network slice usage control feature; and\ne)\tS-NSSAI location validity information if the UE has indicated that it supports S-NSSAI location validity information.\nIn addition, the credential holder may configure a single default configured NSSAI associated with the selected entry of the \"list of subscriber data\" or the PLMN subscription and consider the default configured NSSAI as valid in a SNPN for which the UE has neither a configured NSSAI nor an allowed NSSAI. If the UE is registering or registered for onboarding services in SNPN, the serving SNPN shall not provide a configured NSSAI to the UE. The support for NSSRG information by the UE and the network, respectively, is optional.\nThe allowed NSSAI and the rejected NSSAI for the current registration area are managed per access type independently, i.e. 3GPP access or non-3GPP access, and is applicable for the registration area. If the UE does not have a valid registration area, the rejected NSSAI for the current registration area is applicable to the tracking area on which it was received. If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, the allowed NSSAI, the rejected NSSAI for the current registration area, rejected NSSAI for the failed or revoked NSSAA and rejected NSSAI for the maximum number of UEs reached are applicable to these PLMNs in this registration area.\nThe allowed NSSAI that is associated with a registration area containing TAIs belonging to different PLMNs, which are equivalent PLMNs, can be used to form the requested NSSAI for any of the equivalent PLMNs when the UE is outside of the registration area where the allowed NSSAI was received.\nWhen the network slice-specific authentication and authorization procedure is to be initiated for one or more S-NSSAIs in the requested NSSAI or the network slice-specific authentication and authorization procedure is ongoing for one or more S-NSSAIs, these S-NSSAI(s) will be included in the pending NSSAI. When the network slice-specific authentication and authorization procedure is completed for an NSSAI that has been in the pending NSSAI, the S-NSSAI will be moved to the allowed NSSAI or rejected NSSAI depending on the outcome of the procedure. The AMF sends the updated allowed NSSAI to the UE over the same access of the requested S-NSSAI. The AMF sends the updated partially allowed NSSAI to the UE only over the 3GPP access. The AMF sends the updated rejected NSSAI over either 3GPP access or non-3GPP access. The pending NSSAI is managed regardless of access type i.e. the pending NSSAI is applicable to both 3GPP access and non-3GPP access for the current PLMN even if sent over only one of the accesses. If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, the pending NSSAI is applicable to these PLMNs in this registration area.\nThe rejected NSSAI for the current PLMN or SNPN is applicable for the whole registered PLMN or SNPN regardless of the access type. The AMF shall only send a rejected NSSAI for the current PLMN when the registration area consists of TAIs that only belong to the registered PLMN. If the UE receives a rejected NSSAI for the current PLMN, and the registration area also contains TAIs belonging to different PLMNs, the UE shall treat the received rejected NSSAI for the current PLMN as applicable to the whole registered PLMN.\nThe rejected NSSAI for the failed or revoked NSSAA includes one or more S-NSSAIs that have failed the network slice-specific authentication and authorization or for which the authorization have been revoked, and are applicable for the whole registered PLMN or SNPN regardless of the access type.\nThe rejected NSSAI for the maximum number of UEs reached is applicable for the whole registered PLMN or SNPN, and the access type over which the rejected NSSAI was sent. The AMF shall send a rejected NSSAI including S-NSSAI(s) with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\", when one or more S-NSSAIs are indicated that the maximum number of UEs has been reached. If the timer T3526 associated with the S-NSSAI(s) was started upon reception of the rejected NSSAI for the maximum number of UEs reached, the UE may remove the S-NSSAI(s) from the rejected NSSAI including S-NSSAI(s) with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\", if the timer T3526 associated with the S-NSSAI(s) expires. If one or more S-NSSAIs are removed from the rejected NSSAI for the maximum number of UEs reached, the timer T3526 associated with the removed S-NSSAI(s) shall be stopped, if running. The UE shall not stop the timer T3526 if the UE selects an E-UTRA cell connected to EPC.\nIf the UE receives a rejected NSSAI for the maximum number of UEs reached, the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, the UE shall treat the received rejected NSSAI for the maximum number of UEs reached as applicable to these equivalent PLMNs when the UE is in this registration area.\nIf the UE has indicated that the UE supports network slice replacement feature and the AMF determines to provide the mapping information between the S-NSSAI to be replaced and the alternative S-NSSAI to the UE, the network shall provide the UE with the alternative NSSAI. The alternative NSSAI is managed per access type independently, i.e. 3GPP access or non-3GPP access, and is applicable for the registration area.\nIf the UE has indicated that the UE supports the partial network slice feature and includes the S-NSSAI(s) in the requested NSSAI, the AMF determines the S-NSSAI(s) to be included in the partially allowed NSSAI or the partially rejected NSSAI as specified in subclause\u00a04.6.2.11. When the AMF provides both the partially allowed NSSAI and the partially rejected NSSAI to the UE, each S-NSSAI shall be either in the partially allowed NSSAI or in the partially rejected NSSAI but not both. The number of S-NSSAIs included in the partially allowed NSSAI or the partially rejected NSSAI shall not exceed 7. The number of S-NSSAI stored in the partially allowed NSSAI and the allowed NSSAI shall not exceed 8. The partially allowed NSSAI is only applicable to 3GPP access and is applicable for the registration area. The partially rejected NSSAI is only applicable to 3GPP access and is applicable for the registration area.\nNOTE\u00a02:\tBased on local policies, the UE can remove an S-NSSAI from the rejected NSSAI for the failed or revoked NSSAA when the UE wants to register to the slice identified by this S-NSSAI.\nNOTE\u00a03:\tBased on network local policy, network slice-specific authentication and authorization procedure can be initiated by the AMF for an S-NSSAI in rejected NSSAI for the failed or revoked NSSAA when the S-NSSAI is requested by the UE based on its local policy.\nNOTE\u00a04: At least one S-NSSAI in the default configured NSSAI or at least one default S-NSSAI is recommended as not subject to network slice-specific authentication and authorization, in order to ensure that at least one PDU session can be established to access service, even when Network Slice-specific Authentication and Authorization fails.\nNOTE\u00a05:\tAt least one S-NSSAI in the default configured NSSAI or at least one default S-NSSAI is recommended as not subject to network slice admission control, in order to ensure that at least one PDU session can be established to access service.\nNOTE\u00a06:\tThe rejected NSSAI can be provided by the network via either Rejected NSSAI IE or the Extended rejected NSSAI IE.\n4.6.2\tMobility management aspects\n4.6.2.1\tGeneral\nUpon registration to a PLMN or SNPN (except for the registration procedure for periodic registration update, the initial registration for onboarding services in SNPN, and the registration procedure for mobility registration update when registered for onboarding services in SNPN), the UE shall send to the AMF the requested NSSAI which includes one or more S-NSSAIs of the allowed NSSAI for the PLMN or SNPN or the configured NSSAI for the PLMN or SNPN and corresponds to the network slice(s) to which the UE intends to register with, if:\na)\tthe UE has a configured NSSAI for the current PLMN or SNPN;\nb)\tthe UE has an allowed NSSAI for the current PLMN or SNPN; or\nc)\tthe UE has neither allowed NSSAI for the current PLMN or SNPN nor configured NSSAI for the current PLMN or SNPN and has a default configured NSSAI. In this case the UE indicates to the AMF that the requested NSSAI is created from the default configured NSSAI.\nIn roaming scenarios, if the mapped S-NSSAI(s) associated to the allowed NSSAI or the configured NSSAI are missing, the UE shall locally set the mapped S-NSSAI to the same value as the received S-NSSAI. Additionally, if the UE receives a Rejected NSSAI IE or an Extended rejected NSSAI IE without associated mapped S-NSSAI(s), and the rejected NSSAI is different from the rejected NSSAI for the failed or revoked NSSAA, the UE shall locally set the mapped S-NSSAI(s) to the same value as the received S-NSSAI.\nNOTE\u00a01:\tThe above occurs only when the UE is roaming and the AMF compliant with earlier versions of the specification omits providing to the UE a mapped S-NSSAI for one or more S-NSSAIs in, e.g., the allowed NSSAI or configured NSSAI.\nOther than S-NSSAIs contained in the NSSAIs described above, the requested NSSAI can be formed based on the S-NSSAI(s) available in the UE (see subclause\u00a05.5.1.3.2 for further details). In roaming scenarios, the UE shall also provide the mapped S-NSSAI(s) for the requested NSSAI.\nNOTE\u00a02:\tIf the UE did not receive a mapped S-NSSAI for one or more S-NSSAIs in the allowed NSSAI or configured NSSAI, the UE still uses the S-NSSAI as received from the serving network (i.e., without the locally set mapped S-NSSAI) in any NAS message. \nThe AMF verifies if the requested NSSAI is permitted based on the subscribed S-NSSAIs in the UE subscription and, in roaming scenarios the mapped S-NSSAI(s) provided by the UE, and if so then the AMF shall provide the UE with the allowed NSSAI for the PLMN or SNPN, and shall also provide the UE with the mapped S-NSSAI(s) for the allowed NSSAI for the PLMN or SNPN. Additionally, if the AMF allows one or more subscribed S-NSSAIs for the UE, the AMF may include the allowed subscribed S-NSSAI(s) in the allowed NSSAI in the REGISTRATION ACCEPT message. The AMF shall ensure that there are not two or more S-NSSAIs of the allowed NSSAI which are mapped to the same S-NSSAI of the HPLMN or the subscribed SNPN. If\na)\tall the S-NSSAIs included in the requested NSSAI are rejected, or the requested NSSAI was not included by the UE;\nb)\tall default S-NSSAIs are not allowed; and\nc)\tthe UE is neither registering nor registered for onboarding services in SNPN and the UE is neither registering nor registered for emergency services;\nthen the AMF may reject the registration request (see subclauses\u00a05.5.1.2.5 and 5.5.1.3.5 for further details).\nIn roaming scenarios, if the mapped S-NSSAI(s) associated to requested NSSAI are missing, the AMF shall locally set the mapped S-NSSAI to the same value as the received S-NSSAI.\nNOTE\u00a03:\tIn roaming scenarios, when the UE is compliant with earlier versions of the specification or when the serving network does not provide a mapped S-NSSAI for one or more S-NSSAIs in the allowed NSSAI or configured NSSAI, the UE can omit a mapped S-NSSAI for one or more S-NSSAIs in requested NSSAI.\nThe set of network slice(s) for a UE can be changed at any time while the UE is registered to a PLMN or SNPN, and the change may be initiated by the network or the UE. In this case, the allowed NSSAI and associated registration area may be changed during the registration procedure or the generic UE configuration update procedure. The configured NSSAI and the rejected NSSAI may be changed during the registration procedure or the generic UE configuration update procedure. The default configured NSSAI may be changed by sending a UE parameters update transparent container to the UE during the NAS transport procedure. The pending NSSAI may be changed during the registration procedure. In addition, using the generic UE configuration update procedure, the network may trigger the registration procedure in order to update the allowed NSSAI.\nThe UE in NB-N1 mode does not include the requested NSSAI during the registration procedure if the 5GS registration type IE indicates \"mobility registration updating\", procedure is not initiated to change the slice(s) that the UE is currently registered to, and the UE is still in the current registration area.\nThe AMF does not include the allowed NSSAI during a registration procedure with the 5GS registration type IE indicating \"mobility registration updating\" for the UE in NB-N1 mode, except if the allowed NSSAI has changed for the UE.\nThe UE does not include the requested NSSAI during the registration procedure if the 5GS registration type IE indicates \"SNPN onboarding registration\" or the UE is registered for onboarding services in SNPN. The AMF does not include the allowed NSSAI during a registration procedure with the 5GS registration type IE indicating \"SNPN onboarding registration\" or during a registration procedure when the UE is registered for onboarding services in SNPN.\nThe UE considers the last received allowed NSSAI as valid until the UE receives a new allowed NSSAI.\n4.6.2.2\tNSSAI storage\nIf available, the configured NSSAI(s) shall be stored in a non-volatile memory in the ME as specified in annex\u00a0C. For a configured NSSAI, if there is:\na)\tassociated NSSRG information, the NSSRG information shall also be stored in a non-volatile memory in the ME as specified in annex\u00a0C;\nb)\tassociated NSAG information, the NSAG information shall be stored in the ME;\nc)\tassociated S-NSSAI time validity information, the S-NSSAI time validity information shall also be stored in a non-volatile memory in the ME as specified in annex\u00a0C;\nd)\tassociated S-NSSAI location validity information, the S-NSSAI location validity information shall also be stored in a non-volatile memory in the ME as specified in annex\u00a0C; and\ne)\tassociated on-demand NSSAI, the on-demand NSSAI shall also be stored in a non-volatile memory in the ME as specified in annex\u00a0C.\nEach of the configured NSSAI stored in the UE, including the default configured NSSAI, is a set composed of at most 16 S-NSSAIs. Each of the configured NSSAI, except the default configured NSSAI, is associated with a PLMN identity or SNPN identity and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription.\nThe allowed NSSAI(s) should be stored in a non-volatile memory in the ME as specified in annex\u00a0C. The partially allowed NSSAI(s) should be stored in a non-volatile memory in the ME as specified in annex\u00a0C. For an allowed NSSAI, if there is associated alternative NSSAI, the alternative NSSAI should also be stored in a non-volatile memory in the ME as specified in annex\u00a0C.\nEach of the allowed NSSAI stored in the UE is a set composed of at most 8 S-NSSAIs and is associated with a PLMN identity or SNPN identity, an access type and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. Each of the alternative NSSAI stored in the UE is a set composed of at most 8 pairs of S-NSSAI to be replaced and alternative S-NSSAI, and is associated with a PLMN identity or SNPN identity, an access type and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. Each of the partially allowed NSSAI stored in the UE is a set composed of at most 7 S-NSSAIs and a list of TAs for which S-NSSAI is supported, and is associated with a PLMN identity or SNPN identity, 3GPP access type and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. The number of S-NSSAI stored in the partially allowed NSSAI and the allowed NSSAI shall not exceed 8.\nEach of the pending NSSAI stored in the UE is a set composed of at most 16 S-NSSAIs and is associated with a PLMN identity or SNPN identity and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription.\nEach of the rejected NSSAI is associated with a PLMN identity or SNPN identity and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. The S-NSSAI(s) in the rejected NSSAI for the current registration area are further associated with one or more tracking areas where the rejected S-NSSAI(s) is not available. The S-NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached are further associated with the access type over which the rejected NSSAI was received. The S-NSSAI(s) in the partially rejected NSSAI are further associated with 3GPP access.\nThere shall be no duplicated PLMN identities or SNPN identities associated with each of the list of configured NSSAI(s), pending NSSAI(s), rejected NSSAI(s) for the current PLMN or SNPN, rejected NSSAI(s) for the current registration area, rejected NSSAI(s) for the failed or revoked NSSAA, and rejected NSSAI for the maximum number of UEs reached.\nThe UE stores NSSAIs as follows:\na)\tThe configured NSSAI shall be stored until a new configured NSSAI is received for a given PLMN or SNPN. The network may provide to the UE the mapped S-NSSAI(s) for the new configured NSSAI which shall also be stored in the UE. When the UE is provisioned with a new configured NSSAI for a PLMN or SNPN, the UE shall:\n1)\treplace any stored configured NSSAI for this PLMN or SNPN with the new configured NSSAI for this PLMN or SNPN;\n2)\tdelete any stored mapped S-NSSAI(s) for the configured NSSAI and, if available, store the mapped S-NSSAI(s) for the new configured NSSAI;\n3)\tdelete any stored allowed NSSAI for this PLMN or SNPN and, if available, the stored mapped S-NSSAI(s) for the allowed NSSAI, if the UE received the new configured NSSAI for this PLMN or SNPN and the Configuration update indication IE with the Registration requested bit set to \"registration requested\", in the same CONFIGURATION UPDATE COMMAND message but without any new allowed NSSAI for this PLMN or SNPN included;\n4)\tdelete any stored rejected NSSAI and partially rejected NSSAI, and stop any timer T3526 associated with a deleted S-NSSAI in the rejected NSSAI for the maximum number of UEs reached if running;\n4A)\tdelete any stored mapped S-NSSAI(s) for the rejected NSSAI; and\n5)\tdelete any S-NSSAI(s) stored in the pending NSSAI that are not included in the new configured NSSAI for the current PLMN or SNPN or any mapped S-NSSAI(s), if any, stored in the pending NSSAI that are not included in the mapped S-NSSAI(s) for the configured NSSAI (if the UE is roaming or is in a non-subscribed SNPN);\n\tIf the UE having a stored configured NSSAI for a PLMN ID, receives an S-NSSAI associated with a PLMN ID from the network during the PDN connection establishment procedure in EPS as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] or via ePDG as specified in 3GPP\u00a0TS\u00a024.302\u00a0[16], the UE may store the received S-NSSAI in the configured NSSAI for the PLMN identified by the PLMN ID associated with the S-NSSAI, if not already included in the configured NSSAI and if the number of S-NSSAIs in the configured NSSAI is less than\u00a016;\n\tThe UE may continue storing a received configured NSSAI for a PLMN and associated mapped S-NSSAI(s), if available, when the UE registers in another PLMN.\nNOTE\u00a01:\tThe maximum number of configured NSSAIs and associated mapped S-NSSAIs for PLMNs other than the HPLMN that need to be stored in the UE, and how to handle the stored entries, are up to UE implementation.\naa)\tThe NSAG information shall be stored until:\n1)\ta new NSAG information for the registered PLMN or the registered SNPN is received over 3GPP access; or\n2)\ta new configured NSSAI without any associated NSAG information for the registered PLMN or the registered SNPN is received over 3GPP access.\n\tThe UE shall remove any S-NSSAI from the NSAG information which is not part of the configured NSSAI, if any.\nNOTE\u00a01A:\tIf the UE is roaming or the current SNPN is a non-subscribed SNPN, the UE uses the S-NSSAI(s) in the configured NSSAI to compare against any S-NSSAI from the NSAG information.\n\tWhen a new NSAG information for the registered PLMN or the registered SNPN is received over 3GPP access, the UE shall replace any stored NSAG information for the registered PLMN and its equivalent PLMN(s) or the registered SNPN and its equivalent SNPN(s) with the new NSAG information for the registered PLMN or the registered SNPN.\n\tWhen a new configured NSSAI without any associated NSAG information for the registered PLMN or the registered SNPN is received over 3GPP access, the UE shall delete any stored NSAG information for the registered PLMN and its equivalent PLMN(s) or the registered SNPN and its equivalent SNPN(s).\n\tThe UE shall be able to store 32 NSAG entries in the NSAG information stored for the registered PLMN or the registered SNPN.\n\tThe UE shall be able to store TAI lists for up to 4 NSAG entries in the NSAG information stored for the registered PLMN or the registered SNPN.\n\tThe UE needs not to store the NSAG information when the UE is switched off or when the UE is deregistered from the registered PLMN or the registered SNPN.\nNOTE\u00a01B:\tThe UE stores the NSAG information associated with the configured NSSAI for at least the registered PLMN and its equivalent PLMN(s) or the registered SNPN and its equivalent PLMN(s).\nb)\tThe allowed NSSAI shall be stored and the mapped S-NSSAI(s) for the allowed NSSAI (if available) shall be stored for a given PLMN and its equivalent PLMN(s) in the registration area or SNPN until:\n1)\ta new allowed NSSAI for the same access type (i.e. 3GPP access or non-3GPP access) is received for a given PLMN or SNPN;\n2)\tthe CONFIGURATION UPDATE COMMAND message with the Registration requested bit of the Configuration update indication IE set to \"registration requested\" is received and contains no other parameters (see subclauses\u00a05.4.4.2 and 5.4.4.3);\n3)\tthe REGISTRATION ACCEPT message is received with the \"NSSAA to be performed\" indicator of the 5GS registration result IE set to \"Network slice-specific authentication and authorization is to be performed\", and the REGISTRATION ACCEPT message contains a pending NSSAI and no new allowed NSSAI as described in subclause\u00a05.5.1.2.4 and subclause\u00a05.5.1.3.4; or\n4)\ta new partially allowed NSSAI via 3GPP access is received for a given PLMN or SNPN.\n\tThe network may provide to the UE the mapped S-NSSAI(s) for the new allowed NSSAI (see subclauses\u00a05.5.1.2 and 5.5.1.3) which shall also be stored in the UE. When a new allowed NSSAI for a PLMN or SNPN is received, the UE shall:\n1)\treplace any stored allowed NSSAI for this PLMN and its equivalent PLMN(s) in the registration area or this SNPN for the same access type with the new allowed NSSAI for this PLMN or SNPN;\n2)\tdelete any stored mapped S-NSSAI(s) for the allowed NSSAI for this PLMN and its equivalent PLMN(s) in the registration area or this SNPN for the same access type and, if available, store the mapped S-NSSAI(s) for the new allowed NSSAI;\n3)\tremove from the stored rejected NSSAI for the current PLMN or SNPN, the rejected NSSAI for the current registration area, rejected NSSAI for the maximum number of UEs reached and the partially rejected NSSAI, the S-NSSAI(s), if any, included in the new allowed NSSAI for the current PLMN or SNPN, unless the S-NSSAI in the rejected NSSAI or the partially rejected NSSAI is associated with one or more S-NSSAI(s) in the stored mapped rejected NSSAI or the stored mapped partially rejected NSSAI, and at least one of these mapped S-NSSAI(s) is not included in the mapped S-NSSAI(s) for the new allowed NSSAI, and stop any timer T3526 associated with a deleted S-NSSAI in the rejected NSSAI for the maximum number of UEs reached if running;\n4)\tremove from the stored rejected NSSAI for the failed or revoked NSSAA, the S-NSSAI(s), if any, included in the new allowed NSSAI for the current PLMN (if the UE is not roaming) or the current SNPN (if the SNPN is the subscribed SNPN) or the mapped S-NSSAI(s) for the new allowed NSSAI for the current PLMN (if the UE is roaming) or the current SNPN (if the SNPN is a non-subscribed SNPN);\n5)\tremove from the stored mapped S-NSSAI(s) for the rejected NSSAI for the current PLMN or SNPN, the stored mapped S-NSSAI(s) for the rejected NSSAI for the current registration area, the stored mapped S-NSSAI(s) for the partially rejected NSSAI and the mapped S-NSSAI(s) for the rejected NSSAI for the maximum number of UEs reached, the S-NSSAI(s), if any, included in the mapped S-NSSAI(s) for the new allowed NSSAI for the current PLMN (if the UE is roaming) or the current SNPN (if the SNPN is a non-subscribed SNPN), and stop any timer T3526 associated with a deleted S-NSSAI in the rejected NSSAI for the maximum number of UEs reached if running; and\n6)\tremove from the stored pending NSSAI for this PLMN and its equivalent PLMN(s) in the registration area or this SNPN, one or more S-NSSAIs, if any, included in the new allowed NSSAI for the current PLMN and these equivalent PLMN(s) (if the UE is not roaming) or the current SNPN (if the SNPN is the subscribed SNPN) or the mapped S-NSSAI(s) for the new allowed NSSAI for the current PLMN and these equivalent PLMN(s) (if the UE is roaming) or the current SNPN (if the SNPN is a non-subscribed SNPN).\nNOTE\u00a02:\tWhether the UE stores the allowed NSSAI and the mapped S-NSSAI(s) for the allowed NSSAI also when the UE is switched off is implementation specific.\nThe network may provide to the UE the partially allowed NSSAI. When a new partially allowed NSSAI for a PLMN or SNPN is received and the new partially allowed NSSAI includes one or more S-NSSAI(s), the UE shall replace any stored partially allowed NSSAI for this PLMN and its equivalent PLMN(s) in the registration area or this SNPN via the 3GPP access with the new partially allowed NSSAI for this PLMN or SNPN. When a new partially allowed NSSAI for a PLMN or SNPN is received and the new partially allowed NSSAI does not include any S-NSSAI(s), the UE shall delete any stored partially allowed NSSAI for this PLMN and its equivalent PLMN(s) in the registration area or this SNPN via the 3GPP access.\nba)\tThe alternative NSSAI and the mapped S-NSSAI(s) for the alternative NSSAI (if the UE is roaming) shall be stored for a given PLMN and its equivalent PLMN(s) or SNPN until a new alternative NSSAI for the same access type (i.e. 3GPP access or non-3GPP access) is received for a given PLMN or SNPN.\n\tWhen a new alternative NSSAI for a given PLMN or SNPN is received and the new alternative NSSAI includes a list of mapping information between the S-NSSAI to be replaced and the alternative S-NSSAI, the UE shall:\n1)\treplace any stored alternative NSSAI for this PLMN and its equivalent PLMN(s) or this SNPN for the same access type with the new alternative NSSAI for this PLMN or SNPN; and\n2)\tdelete any stored mapped S-NSSAI(s) for the alternative NSSAI for this PLMN and its equivalent PLMN(s) or this SNPN for the same access type and, if available, store the mapped S-NSSAI(s) for the new alternative NSSAI.\n\tWhen a new alternative NSSAI for a given PLMN or SNPN is received and the new alternative NSSAI does not include any mapping information between the S-NSSAI to be replaced and the alternative S-NSSAI, the UE shall delete any stored alternative NSSAI for this PLMN and its equivalent PLMN(s) or this SNPN for the same access type.\nNOTE\u00a03:\tWhether the UE stores the alternative NSSAI and the mapped S-NSSAI(s) for the alternative NSSAI also when the UE is switched off is implementation specific.\nc)\tWhen the UE receives the S-NSSAI(s) included in the rejected NSSAI in the REGISTRATION ACCEPT message, the REGISTRATION REJECT message, the DEREGISTRATION REQUEST message or in the CONFIGURATION UPDATE COMMAND message, or the partially rejected NSSAI in the REGISTRATION ACCEPT message or the CONFIGURATION UPDATE COMMAND message, the UE shall:\n1)\tstore the S-NSSAI(s) into the rejected NSSAI and the mapped S-NSSAI(s) for the rejected NSSAI based on the associated rejection cause(s);\n2)\tif the UE receives the S-NSSAI(s) included in the Rejected NSSAI IE, or if the UE receives the S-NSSAI(s) included in the Extended rejected NSSAI IE, or if the UE receives the S-NSSAI(s) included in the Partially rejected NSSAI IE in non-roaming case when not in SNPN access operation mode or in the subscribed SNPN, remove from the stored allowed NSSAI or partially allowed NSSAI for the current PLMN and its equivalent PLMN(s) in the registration area or the current SNPN, the S-NSSAI(s), if any, included in the:\ni)\trejected NSSAI for the failed or revoked NSSAA, for each and every access type;\nii)\trejected NSSAI for the current PLMN or SNPN, for each and every access type;\niii)\trejected NSSAI for the current registration area, associated with the same access type;\niv)\trejected NSSAI for the maximum number of UEs reached, associated with the same access type; or\nv)\tpartially rejected NSSAI, associated with 3GPP access;\n3)\tif the UE receives the S-NSSAI(s) included in the Extended rejected NSSAI IE or if the UE receives the S-NSSAI(s) included in the Partially rejected NSSAI IE in roaming case or in a non-subscribed SNPN, remove from the stored allowed NSSAI or partially allowed NSSAI for the current PLMN and its equivalent PLMN(s) in the registration area or the current SNPN, the S-NSSAI(s), if any, included in the:\ni)\trejected NSSAI for the current PLMN or SNPN, for each and every access type;\nii)\trejected NSSAI for the current registration area, associated with the same access type;\niii)\trejected NSSAI for the maximum number of UEs reached, associated with the same access type; or\niv)\tpartially rejected NSSAI, associated with 3GPP access;\n\tif the mapped S-NSSAI(s) for the S-NSSAI in the stored allowed NSSAI or partially allowed NSSAI for the current PLMN or SNPN are stored in the UE, and all of the mapped S-NSSAI(s) are included in the Extended rejected NSSAI IE or Partially rejected NSSAI IE;\n4)\tremove from the stored mapped S-NSSAI(s) for the allowed NSSAI or partially allowed NSSAI (if available and if the UE is roaming or is a non-subscribed SNPN), the S-NSSAI(s), if any, included in the:\ni)\trejected NSSAI for the failed or revoked NSSAA, for each and every access type;\nii)\tmapped S-NSSAI(s) for the rejected NSSAI for the current PLMN or SNPN, for each and every access type;\niii)\tmapped S-NSSAI(s) for the rejected NSSAI for the current registration area, associated with the same access type; \niv)\tmapped S-NSSAI(s) for the rejected NSSAI for the maximum number of UEs reached, associated with the same access type; or\nv)\tpartially rejected NSSAI, associated with 3GPP access;\n5)\tif the UE receives the S-NSSAI(s) included in the Rejected NSSAI IE, or if the UE receives the S-NSSAI(s) included in the Extended rejected NSSAI IE in non-roaming case when not in SNPN access operation mode or in the subscribed SNPN, remove from the stored pending NSSAI for the current PLMN and its equivalent PLMN(s) in the registration area or the current SNPN, the S-NSSAI(s), if any, included in the:\ni)\trejected NSSAI for the failed or revoked NSSAA, for each and every access type;\nii)\trejected NSSAI for the current PLMN or SNPN, for each and every access type;\niii)\trejected NSSAI for the current registration area, associated with the same access type; or\niv)\trejected NSSAI for the maximum number of UEs reached, associated with the same access type;\n6)\tif the UE receives the S-NSSAI(s) included in the Extended rejected NSSAI IE in roaming case or in a non-subscribed SNPN, remove from the stored pending NSSAI for the current PLMN and its equivalent PLMN(s) in the registration area or the current SNPN, the S-NSSAI(s), if any, included in the:\ni)\trejected NSSAI for the current PLMN or SNPN, for each and every access type;\nii)\trejected NSSAI for the current registration area, associated with the same access type; or\niii)\trejected NSSAI for the maximum number of UEs reached, associated with the same access type,\n\tif the mapped S-NSSAI(s) for the S-NSSAI in the stored pending NSSAI are stored in the UE, and all of the mapped S-NSSAI(s) are included in the Extended rejected NSSAI IE; and\n7)\tremove from the stored mapped S-NSSAI(s) for the pending NSSAI (if available and if the UE is roaming or is in a non-subscribed SNPN), the S-NSSAI(s), if any, included in the:\ni)\trejected NSSAI for the failed or revoked NSSAA, for each and every access type;\nii)\tmapped S-NSSAI(s) for the rejected NSSAI for the current PLMN or SNPN, for each and every access type;\niii)\tmapped S-NSSAI(s) for the rejected NSSAI for the current registration area, associated with the same access type; or\niv)\tmapped S-NSSAI(s) for the rejected NSSAI for the maximum number of UEs reached, associated with the same access type;\nIf the UE receives the CONFIGURATION UPDATE COMMAND message with the Registration requested bit of the Configuration update indication IE set to \u201cregistration requested\u201d and contains no other parameters (see subclauses\u00a05.4.4.2 and 5.4.4.3), the UE shall delete any stored rejected NSSAI.\n\tWhen the UE:\n1)\tenters state 5GMM-DEREGISTERED following an unsuccessful registration for 5GMM causes other than #62 \u201cNo network slices available\u201d for the current PLMN or SNPN;\n2)\tsuccessfully registers with a new PLMN or a new SNPN;\n3)\tenters state 5GMM-DEREGISTERED following an unsuccessful registration with a new PLMN or a new SNPN; or\n4)\tperforms inter-system change from N1 mode to S1 mode and the UE successfully completes tracking area update procedure;\n\tand the UE is not registered with the PLMN or SNPN, which provided the rejected NSSAI, over another access, the rejected NSSAI for the current PLMN or SNPN and the rejected NSSAI for the failed or revoked NSSAA shall be deleted.\n\tWhen the UE receives ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message provided with S-NSSAI and the PLMN ID in the Protocol configuration options IE or Extended protocol configuration options IE (see subclause\u00a06.5.1.3 of 3GPP\u00a0TS\u00a024.301\u00a0[15]), the UE shall remove the S-NSSAI associated with the PLMN ID from the rejected NSSAI for the current PLMN. When the UE receives ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message provided with S-NSSAI and the PLMN ID in the Protocol configuration options IE or Extended protocol configuration options IE (see subclause\u00a06.5.1.3 of 3GPP\u00a0TS\u00a024.301\u00a0[15]), the UE may remove the S-NSSAI from the rejected NSSAI for the maximum number of UEs reached for each and every access type, if any, and stop the timer T3526 associated with the S-NSSAI if running.\n\tWhen the UE:\n1)\tderegisters over an access type;\n2)\tsuccessfully registers in a new registration area over an access type;\n3)\tenters state 5GMM-DEREGISTERED or 5GMM-REGISTERED following an unsuccessful registration in a new registration area over an access type; or\n4)\tperforms inter-system change from N1 mode to S1 mode and the UE successfully completes tracking area update procedure;\n\tthe rejected NSSAI for the current registration area corresponding to the access type and the partially rejected NSSAI shall be deleted. When a new partially rejected NSSAI is received without any S-NSSAI(s), the UE shall delete any stored partially rejected NSSAI for the current registration area;\nd)\tWhen the UE receives the pending NSSAI in the REGISTRATION ACCEPT message, the UE shall replace any stored pending NSSAI for this PLMN or SNPN with the new pending NSSAI received in the REGISTRATION ACCEPT message for this PLMN or SNPN. If the UE does not receive the pending NSSAI in the REGISTRATION ACCEPT message and the \u201cNSSAA to be performed\u201d indicator is not set to \u201cNetwork slice-specific authentication and authorization is to be performed\u201d in the 5GS registration result IE of the REGISTRATION ACCEPT message, the UE shall delete the stored pending NSSAI, if any, for this PLMN and its equivalent PLMN(s) in the registration area or this SNPN.\n\tIf the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, then for each of the equivalent PLMNs, the UE shall replace any stored pending NSSAI with the pending NSSAI received in the registered PLMN.\n\tWhen the UE:\n1)\tderegisters with the current PLMN or SNPN using explicit signalling or enters state 5GMM-DEREGISTERED for the current PLMN or SNPN;\n2)\tsuccessfully registers with a new PLMN not in the list of equivalent PLMNs or a new SNPN;\n3)\tenters state 5GMM-DEREGISTERED following an unsuccessful registration with a new PLMN or SNPN; or\n4)\tsuccessfully initiates an attach or tracking area update procedure in S1 mode and the UE is operating in single-registration mode;\n\tand the UE is not registered with the PLMN or SNPN, which provided pending NSSAI, over another access, the pending NSSAI for the current PLMN and its equivalent PLMN(s) in the registration area or the current SNPN shall be deleted;\ne)\tWhen the UE receives the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\" in the REGISTRATION ACCEPT message or in the CONFIGURATION UPDATE COMMAND message, the UE shall delete the network slicing information for each of the PLMNs or SNPNs that the UE has slicing information stored for (excluding the current PLMN or SNPN). The UE shall delete any stored rejected NSSAI and stop any timer T3526 associated with a deleted S-NSSAI in the rejected NSSAI for the maximum number of UEs reached if running. The UE shall not delete the default configured NSSAI. Additionally, the UE shall update the network slicing information for the current PLMN or SNPN (if received) as specified above in bullets a), b), c) and d);\nf)\tWhen the UE receives the new default configured NSSAI included in the default configured NSSAI update data in the Payload container IE of DL NAS TRANSPORT message, the UE shall replace any stored default configured NSSAI with the new default configured NSSAI. In case of SNPN, the UE shall replace the stored default configured NSSAI associated with the selected entry of the \"list of subscriber data\" or the PLMN subscription with the new default configured NSSAI; and\ng)\tWhen the UE receives the on-demand NSSAI in the REGISTRATION ACCEPT message or CONFIGURATION UPDATE COMMAND message, the UE shall replace any stored on-demand NSSAI for the serving PLMN with the new on-demand NSSAI.\n4.6.2.3\tProvision of NSSAI to lower layers in 5GMM-IDLE mode\nThe UE NAS layer may provide the lower layers with an NSSAI (either requested NSSAI or allowed NSSAI) when the UE in 5GMM-IDLE mode sends an initial NAS message.\nThe AMF may indicate, via the NSSAI inclusion mode IE of a REGISTRATION ACCEPT message, an NSSAI inclusion mode in which the UE shall operate over the current access within the current PLMN or SNPN, if any (see subclauses\u00a05.5.1.2.4 and 5.5.1.3.4), where the NSSAI inclusion mode is chosen among the following NSSAI inclusion modes described in table\u00a04.6.2.3.1.\nTable\u00a04.6.2.3.1: NSSAI inclusion modes and NSSAI which shall be provided to the lower layers\n\nThe UE shall store the NSSAI inclusion mode:\na)\tindicated by the AMF, if the AMF included the NSSAI inclusion mode IE in the REGISTRATION ACCEPT message; or\nb)\tif the AMF did not include the NSSAI inclusion mode IE in the REGISTRATION ACCEPT message:\n1)\tif the UE is pre-configured by operator to operate by default to according to mode\u00a0C in the HPLMN (see the DefaultNSSAIInclusionMode leaf of the NAS configuration MO in 3GPP\u00a0TS\u00a024.368\u00a0[17] or the USIM file EFNASCONFIG in 3GPP\u00a0TS\u00a031.102\u00a0[22]), then mode\u00a0C;\n2)\totherwise:\ni)\tmode\u00a0D for 3GPP access and trusted non-3GPP access; or\nii)\tmode\u00a0B for untrusted non-3GPP access and wireline access.\ntogether with the identity of the current PLMN or SNPN and access type in a non-volatile memory in the ME as specified in annex\u00a0C.\nThe UE shall apply the NSSAI inclusion mode received in the REGISTRATION ACCEPT message over the current access within the current PLMN and its equivalent PLMN(s), if any, or the current SNPN in the current registration area.\nWhen a UE performs a registration procedure to a PLMN which is not a PLMN in the current registration area or an SNPN, if the UE has no NSSAI inclusion mode for the PLMN or the SNPN stored in a non-volatile memory in the ME, the UE shall provide the lower layers with:\na)\tno NSSAI if the UE is performing the registration procedure over 3GPP access; or\nb)\trequested NSSAI if the UE is performing the registration procedure over non-3GPP access.\nWhen a UE performs a registration procedure after an inter-system change from S1 mode to N1 mode, if the UE has no NSSAI inclusion mode for the PLMN stored in a non-volatile memory in the ME and the registration procedure is performed over 3GPP access, the UE shall not provide the lower layers with any NSSAI over the 3GPP access.\n4.6.2.4\tNetwork slice-specific authentication and authorization\nThe UE and network may support network slice-specific authentication and authorization.\nA serving PLMN or SNPN shall perform network slice-specific authentication and authorization for the S-NSSAI(s) of the HPLMN or the subscribed SNPN which are subject to it based on subscription information. The UE shall indicate whether it supports network slice-specific authentication and authorization in the 5GMM Capability IE in the REGISTRATION REQUEST message as specified in subclauses\u00a05.5.1.2.2\u00a0and\u00a05.5.1.3.2.\nThe upper layer stores an association between each S-NSSAI and its corresponding credentials for the network slice-specific authentication and authorization.\nNOTE\u00a01:\tThe credentials for network slice-specific authentication and authorization and how to provision them in the upper layer are out of the scope of 3GPP.\nThe network slice-specific authentication and authorization procedure shall not be performed unless the primary authentication and key agreement procedure as specified in the subclause\u00a05.4.1 has successfully been completed.\nThe AMF informs the UE about S-NSSAI(s) for which network slice-specific authentication and authorization (except for re-NSSAA) will be performed or is ongoing in the pending NSSAI. The AMF informs the UE about S-NSSAI(s) for which NSSAA procedure is completed as success in the allowed NSSAI or in the partially allowed NSSAI. The AMF informs the UE about S-NSSAI(s) for which NSSAA procedure is completed as failure in the rejected NSSAI for the failed or revoked NSSAA. The AMF stores and handles allowed NSSAI, partially allowed NSSAI, pending NSSAI, rejected NSSAI, and 5GS registration result in the REGISTRATION ACCEPT message according to subclauses\u00a05.5.1.2.4 and 5.5.1.3.4.\nNOTE\u00a02:\tThe AMF maintains the NSSAA procedure status for each S-NSSAI, as specified in 3GPP\u00a0TS\u00a029.518\u00a0[20B] and the NSSAA procedure status for each S-NSSAI is not impacted by NSAC as specified in subclauses\u00a04.6.2.5 and 4.6.3.1.\nNOTE\u00a03: Upon completion of NSSAA procedures, it can happen that the total number of S-NSSAIs which need to be included in the allowed NSSAI exceeds eight. In this case, it is up to the AMF implementation on how to pick up the S-NSSAIs included in the allowed NSSAI.\nNOTE\u00a04:\tIt can happen that one or more S-NSSAIs included in the received allowed NSSAI, are not the S-NSSAIs that the UE intends to register to. In this case, it is up to the UE implementation on how to use these S-NSSAIs.\nTo perform network slice-specific authentication and authorization for an S-NSSAI, the AMF invokes an EAP-based network slice-specific authentication and authorization procedure for the S-NSSAI, see subclause\u00a05.4.7 and 3GPP\u00a0TS\u00a023.502\u00a0[9] using the EAP framework as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nThe AMF updates the allowed NSSAI, the partially allowed NSSAI and the rejected NSSAI using the generic UE configuration update procedure as specified in the subclause\u00a05.4.4 after the network slice-specific authentication and authorization procedure is completed.\nThe AMF shall send the pending NSSAI containing all S-NSSAIs for which the network slice-specific authentication and authorization procedure (except for re-NSSAA) will be performed or is ongoing in the REGISTRATION ACCEPT message. The AMF shall also include in the REGISTRATION ACCEPT message the allowed NSSAI containing one or more S-NSSAIs from the requested NSSAI which are allowed by the AMF and for which network slice-specific authentication and authorization is not required, if any. The AMF shall also include in the REGISTRATION ACCEPT message the partially allowed NSSAI containing one or more S-NSSAIs from the requested NSSAI which are allowed by the AMF in a list of TAs within the current registration area and for which network slice-specific authentication and authorization is not required, if any.\nThe network slice-specific re-authentication and re-authorization procedure or the network slice-specific authorization revocation procedure can be invoked by the network for a UE supporting NSSAA at any time. After the network performs the network slice-specific re-authentication and re-authorization procedure or network slice-specific authorization revocation procedure:\na)\tif network slice-specific re-authentication and re-authorization fails or network slice-specific authorization is revoked for some but not all S-NSSAIs in the allowed NSSAI or the partially allowed NSSAI,, the AMF updates the allowed NSSAI or the partially allowed NSSAI and the rejected NSSAI accordingly using the generic UE configuration update procedure as specified in the subclause\u00a05.4.4 and inform the SMF to release all PDU sessions associated with the S-NSSAI for which network slice-specific re-authentication and re-authorization fails or network slice-specific authorization is revoked;\nb)\tif network slice-specific re-authentication and re-authorization fails or network slice-specific authorization is revoked for all S-NSSAIs in the allowed NSSAI or the partially allowed NSSAI but there are one or more default S-NSSAIs which are not subject to network slice-specific authentication and authorization or for which the network slice-specific authentication and authorization has been successfully performed, the AMF updates the allowed NSSAI or the partially allowed NSSAI containing these default S-NSSAIs and the rejected NSSAI accordingly using the generic UE configuration update procedure as specified in the subclause\u00a05.4.4. The AMF shall also inform the SMF to release all PDU sessions associated with the S-NSSAI for which network slice-specific re-authentication and re-authorization fails or network slice-specific authorization is revoked; or\nc)\tif network slice-specific re-authentication and re-authorization fails or network slice-specific authorization is revoked for all S-NSSAIs in the allowed NSSAI or the partially allowed NSSAI and all default S-NSSAIs are subject to network slice-specific authentication and authorization, and the network slice-specific authentication and authorization has not been successfully performed for any of these default S-NSSAIs, then AMF performs the network-initiated de-registration procedure and includes the rejected NSSAI in the DEREGISTRATION REQUEST message as specified in the subclause\u00a05.5.2.3 except when the UE has an emergency PDU session established or the UE is establishing an emergency PDU session. In this case the AMF shall send the CONFIGURATION UPDATE COMMAND message containing rejected NSSAI and inform the SMF to release all PDU sessions associated with the S-NSSAI for which network slice-specific re-authentication and re-authorization fails or network slice-specific authorization is revoked. After the emergency PDU session is released, the AMF performs the network-initiated de-registration procedure as specified in the subclause\u00a05.5.2.3.\nThe UE does not include in the requested NSSAI any of the S-NSSAIs from the pending NSSAI that the UE stores, regardless of the access type. When the UE storing a pending NSSAI intends to register to one or more additional S-NSSAIs not included in the pending NSSAI, the UE initiates the registration procedure with a requested NSSAI containing these S-NSSAIs as described in subclause\u00a05.5.1.3.2. In this case, the requested NSSAI shall also include one or more S-NSSAIs from the allowed NSSAI or the partially allowed NSSAI, if the UE still wants to use the S-NSSAI(s) from the allowed NSSAI or the partially allowed NSSAI.\nDuring the registration procedure, when the AMF receives a requested NSSAI from a UE over an access type, for which there is a pending NSSAI including one or more S-NSSAIs that were previously requested over the same access type, the AMF considers S-NSSAIs included in the requested NSSAI and S-NSSAIs in the pending NSSAI that were previously requested over the same access type as requested S-NSSAIs by the UE. The AMF handles the requested S-NSSAIs as described in subclause\u00a05.5.1.3.4.\nWhen performing the network slice-specific re-authentication and re-authorization procedure if the S-NSSAI is included in the allowed NSSAI for both 3GPP and non-3GPP accesses, and the UE is registered to both 3GPP and non-3GPP accesses in the same PLMN, then the AMF selects an access type to perform network slice-specific re-authentication and re-authorization based upon operator policy.\nIf network slice-specific authorization is revoked for an S-NSSAI that is in the current allowed NSSAI for an access type or for an S-NSSAI that is in the current partially allowed NSSAI for 3GPP access type, the AMF shall:\na)\tprovide a new allowed NSSAI or a new partially allowed NSSAI, excluding the S-NSSAI for which the network slice-specific authorization is revoked; and\nb)\tprovide a new rejected NSSAI for the failed or revoked NSSAA, including the S-NSSAI for which the network slice-specific authorization is revoked, with the rejection cause \"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\",\nto the UE using the generic UE configuration update procedure as specified in the subclause\u00a05.4.4 and inform the SMF to release all PDU sessions associated with the S-NSSAI for which the network slice-specific authorization is revoked for this access type.\nIf the UE requests the establishment of a new PDU session or the modification of a PDU session for an S-NSSAI for which the AMF is performing network slice-specific re-authentication and re-authorization procedure, the AMF may determine to not forward the 5GSM message to the SMF as described in subclause\u00a05.4.5.2.4.\nNOTE\u00a05:\tIf the AMF receives the HTTP code set to \"4xx\" or \"5xx\" as specified in 3GPP\u00a0TS\u00a029.500\u00a0[20AA] or the AMF detects that the NSSAAF failure as specified in 3GPP\u00a0TS\u00a029.526\u00a0[21A] during the NSSAA procedure for an S-NSSAI, then the AMF considers the NSSAA procedure has failed for this S-NSSAI.\n4.6.2.5\tMobility management based network slice admission control\nA serving PLMN or SNPN can perform network slice admission control for the S-NSSAI(s) subject to NSAC to monitor and control the number of registered UEs per network slice. The timing of the network slice admission control is managed by the EAC mode per network slice, which can be either activated or deactivated for the network performing network slice admission control. The EAC mode is activated when the number of UEs associated with the S-NSSAI reaches a certain threshold (see 3GPP\u00a0TS\u00a023.502\u00a0[9])\nIf the EAC mode is activated for an S-NSSAI, the AMF performs network slice admission control before the S-NSSAI subject to NSAC is included in the allowed NSSAI or the partially allowed NSSAI sent to the UE. During a registration procedure (including initial registration or mobility registration updating from another AMF), if the AMF determines that the maximum number of UEs has been reached for:\na)\tone or more S-NSSAIs but not all S-NSSAIs in the requested NSSAI, then the AMF includes the allowed NSSAI or the partially allowed NSSAI and the rejected NSSAI accordingly in the REGISTRATION ACCEPT message as specified in the subclauses\u00a05.5.1.2.4 and 5.5.1.3.4;\nb)\tall S-NSSAIs in the requested NSSAI but there are one or more default S-NSSAIs which can be allowed to the UE, then the AMF includes the allowed NSSAI or the partially allowed NSSAI containing these default S-NSSAIs and the rejected NSSAI accordingly in the REGISTRATION ACCEPT message as specified in the subclauses\u00a05.5.1.2.4 and 5.5.1.3.4; or\nc)\tall S-NSSAIs in the requested NSSAI and there are no default S-NSSAIs which can be allowed to the UE, then the AMF includes the rejected NSSAI accordingly in the REGISTRATION REJECT message as specified in the subclauses\u00a05.5.1.2.5 and 5.5.1.3.5.\nIf the EAC mode is deactivated for an S-NSSAI, the AMF performs network slice admission control after the S-NSSAI subject to NSAC is included in the allowed NSSAI or the partially allowed NSSAI sent to the UE. While the AMF is waiting for response from the NSACF for the S-NSSAI, the AMF processes the NAS signalling message related to the S-NSSAI as usual i.e. like S-NSSAI in the allowed NSSAI or the partially allowed NSSAI. After the network performs the network slice admission control, if the AMF determines that the maximum number of UEs has been reached for:\na)\tone or more S-NSSAIs but not all S-NSSAIs in the allowed NSSAI or the partially allowed NSSAI, then the AMF updates the allowed NSSAI or the partially allowed NSSAI and the rejected NSSAI accordingly using the generic UE configuration update procedure as specified in the subclause\u00a05.4.4;\nb)\tfor all S-NSSAIs in the allowed NSSAI or the partially allowed NSSAI but there are one or more default S-NSSAIs which can be allowed to the UE, then the AMF updates the allowed NSSAI or the partially allowed NSSAI containing these default S-NSSAIs and the rejected NSSAI accordingly using the generic UE configuration update procedure as specified in the subclause\u00a05.4.4; or\nc)\tfor all S-NSSAIs in the allowed NSSAI or the partially allowed NSSAI and there are no default S-NSSAIs which can be allowed to the UE, then the AMF performs the network-initiated de-registration procedure and includes the rejected NSSAI in the DEREGISTRATION REQUEST message as specified in the subclause\u00a05.5.2.3 except when the UE has an emergency PDU session established or the UE is establishing an emergency PDU session.\n\tWhen the UE has an emergency PDU session established or the UE is establishing an emergency PDU session, the AMF updates the rejected NSSAI using the generic UE configuration update procedure as specified in the subclause\u00a05.4.4 and informs the SMF to release all PDU sessions associated with the S-NSSAI. During the generic UE configuration update procedure, the AMF includes the 5GS registration result IE in the CONFIGURATION UPDATE COMMAND message and sets the Emergency registered bit of the 5GS registration result IE to \"Registered for emergency services\". After the emergency PDU session is released, the AMF performs the network-initiated de-registration procedure as specified in the subclause\u00a05.5.2.3.\nBased on operator policy, the mobility management based network slice admission control is not applicable for the S-NSSAI used for emergency services, or the mobility management based network slice admission control result is ignored for the S-NSSAI used for emergency services.\nBased on operator policy, the mobility management based network slice admission control is not applicable for the UEs configured for priority services, or the mobility management based network slice admission control result is ignored for the UEs configured for priority services.\nNOTE:\tA UE configured for priority services can be identified based on the RRC establishment cause received from the NG-RAN or based on the MPS priority information in the user's subscription context obtained from the UDM.\nThe mobility management based network slice admission control is not applicable to a UE that is registering or registered for onboarding services in SNPN.\n4.6.2.6\tProvision of NSAG information to lower layers\nThe support for NSAG information by the UE and the network, respectively, is optional. The NSAG information provided by the network and stored in the UE includes a list of NSAGs each of which contains:\na)\tan NSAG ID;\nb)\ta list of S-NSSAI(s), which are associated with the NSAG and shall be part of the configured NSSAI;\nNOTE\u00a00:\tAn alternative S-NSSAI is added to the configured NSSAI if not included yet.\nc)\ta priority value that is associated with the NSAG; and\nNOTE\u00a01:\tThe AMF can take local configuration, UE 5GMM capabilities, subscribed S-NSSAIs, the mapping information between the S-NSSAI to be replaced and the alternative S-NSSAI, HPLMN, etc. to determine the NSAG priority information for the associated NSAG to a UE.\nd)\toptionally a list of TAIs in which the NSAG is valid. If it is not provided by the network, the NSAG is valid in the PLMN or SNPN which has sent the NSAG information and its equivalent PLMN(s).\nNOTE\u00a02:\tIf the NSAG for the PLMN and its equivalent PLMN(s) have different associations with S-NSSAIs, then the AMF includes a list of TAIs in the NSAG information.\nThe UE NAS layer shall provide the lower layers with:\na)\tthe most recent NSAG information stored in the UE (see subclause\u00a04.6.2.2);\nb)\tthe allowed NSSAI and the partially allowed NSSAI (if any) or the requested NSSAI for the purpose of network slice-based cell reselection (see 3GPP\u00a0TS\u00a023.501\u00a0[8]); and\nc)\tzero or more S-NSSAIs related to an access attempt for the purpose of network slice-based random access, when the access attempt is made by the UE in 5GMM-IDLE mode or 5GMM-CONNECTED mode with RRC inactive indication, determined as follows:\ni) \t requested NSSAI (if any), if an access attempt occurred due to the REGISTRATION REQUEST message;\nii)\tNSSAI(s) associated with all the PDU sessions included in the Uplink data status IE (if any), PDU session status IE (if any), or Allowed PDU session status IE (if any), if an access attempt occurred due to the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message;\niii)\tthe S-NSSAI associated with the PDU session, if an access attempt occurred due to:\n -\tan uplink user data packet to be sent for a PDU session with suspended user-plane resources; \n-\tan UL NAS TRANSPORT which carries a 5GSM message for a PDU session associated with an S-NSSAI (if any); or\n-\tCIoT user data to be sent in a CONTROL PLANE SERVICE REQUEST message or an UL NAS TRANSPORT message;\niv)\tno S-NSSAI, if an access attempt occurred due to:\n-\tthe deregistration procedure;\n-\ta PDU session establishment request not associated with an S-NSSAI;\n-\tthe service request procedure for the UE-initiated NAS transport procedure for sending SMS, LPP message, UPP-CMI container, SLPP message, SOR transparent container, UE policy container, UE parameters update transparent container, or a location services message; or\n-\temergency services; or\nv)\tthe allowed NSSAI (if any) and the partially allowed NSSAI (if any), if an access attempt occurred for other reason than those specified in bullets i) - iv).\n4.6.2.7\tMobility management based network slice replacement\nThe support for network slice replacement by a UE or network is optional. If the UE and network support network slice replacement, and the AMF determines that an S-NSSAI included in the allowed NSSAI needs to be replaced with an alternative S-NSSAI, the AMF provides:\na)\tthe alternative S-NSSAI in the allowed NSSAI, if not included yet;\nb)\tthe alternative S-NSSAI in the configured NSSAI, if not included yet;\nc)\tthe alternative S-NSSAI in the NSAG information, if not included yet and the UE supports NSAG; and\nd)\tthe alternative NSSAI including the mapping information between the S-NSSAI to be replaced and the corresponding alternative S-NSSAI,\nto the UE, during the generic UE configuration update procedure or during the registration procedure as follows:\na)\tfor non-roaming UE, the AMF provides the mapping information between the S-NSSAI included in the allowed NSSAI and the alternative S-NSSAI to the UE; or\nNOTE\u00a01:\tIn non-roaming scenarios, the alternative S-NSSAI does not have to be part of the subscribed S-NSSAI(s) in the UE subscription.\nb)\tfor roaming UE:\n1)\tif the S-NSSAI included in the allowed NSSAI needs to be replaced (i.e., the S-NSSAI to be replaced is part of the VPLMN S-NSSAIs), the AMF provides the mapping information between the S-NSSAI included in the allowed NSSAI and the alternative S-NSSAI to the UE; and\n2)\tif the S-NSSAI included in the mapped S-NSSAI(s) for the allowed NSSAI needs to be replaced (i.e., the S-NSSAI to be replaced is part of the HPLMN S-NSSAIs), the AMF provides the mapping information between the S-NSSAI to be replaced and the alternative S-NSSAI to the UE.\nNOTE\u00a01A:\tIn roaming scenarios, the alternative S-NSSAI, being part of the HPLMN S-NSSAIs does not have to be part of the subscribed S-NSSAI(s) in the UE subscription.\nNOTE\u00a02:\tIt is up to AMF local policy to determine when to provide the mapping information between the S-NSSAI to be replaced and the alternative S-NSSAI to the UE, which can be either when the alternative S-NSSAI is available and there is no established PDU session associated with the S-NSSAI to be replaced, or when the UE has established the first PDU session associated with the S-NSSAI to be replaced.\nIf the requested NSSAI contains alternative S-NSSAI(s) that are not subscribed S-NSSAI(s), the AMF shall verify the alternative S-NSSAI(s) based on the stored alternative NSSAI.\nIf the alternative S-NSSAI is subject to NSSAA, the alternative S-NSSAI provided by AMF shall be part of the subscribed S-NSSAI(s) in the UE subscription. The AMF shall perform NSSAA procedure for such alternative S-NSSAI and perform network slice replacement as specified above after the NSSAA procedure for the alternative S-NSSAI is completed as success.\nIf re-NSSAA procedure is ongoing for the S-NSSAI to be replaced, the AMF shall continue with the re-NSSAA procedure and perform network slice replacement as specified above after the re-NSSAA procedure for the S-NSSAI to be replaced is completed as success.\nNOTE\u00a02A:\tWhen configuring the alternative S-NSSAI, the maximum number of S-NSSAIs defined for the allowed NSSAI and configured NSSAI in subclause\u00a04.6.2.2 are applicable.\nIf the AMF determines that the S-NSSAI which has been replaced is available again, the AMF provides the updated alternative NSSAI excluding the S-NSSAI which has been replaced and the corresponding alternative S-NSSAI to the UE during the UE configuration update procedure or during the registration procedure.\nIf all the S-NSSAI(s) that were replaced in alternative NSSAI are available again, the AMF provides the alternative NSSAI with Length of Alternative NSSAI contents set to 0 in the UE configuration update procedure or registration procedure. The AMF also provides the updated allowed NSSAI and configured NSSAI to the UE.\nNOTE\u00a03:\tIf there is S-NSSAI location validity information for both the S-NSSAI to be replaced and the alternative S-NSSAI, the NS-AoS of the alternative S-NSSAI is the same as or larger than the NS-AoS of the S-NSSAI to be replaced.\nIf the UE is in a cell outside the NS-AoS of the replaced S-NSSAI but within the NS-AoS of the alternative S-NSSAI, the AMF provides the updated allowed NSSAI and partially allowed NSSAI excluding the replaced S-NSSAI, if included, in the allowed NSSAI or partially allowed NSSAI during the UE configuration update procedure or during the registration procedure.\n4.6.2.8\tMobility management for optimised handling of temporarily available network slices\nThe UE and the network may support optimised handling of temporarily available network slices. The support for S-NSSAI time validity information by the UE and the network, respectively, is optional.\nIf the UE has indicated that it supports S-NSSAI time validity information, then the AMF may include the S-NSSAI time validity information for one or more S-NSSAIs included in the configured NSSAI in the Registration Accept message or the CONFIGURATION UPDATE COMMAND message. If the AMF determines that the S-NSSAI time validity information for an S-NSSAI in the configured NSSAI is changed, the AMF may provide the UE with a new S-NSSAI time validity information for that S-NSSAI via the CONFIGURATION UPDATE COMMAND message.\nIf the UE supporting S-NSSAI time validity information, is configured with S-NSSAI time validity information for an S-NSSAI and:\na)\tthe S-NSSAI time validity information indicates that the S-NSSAI is available, then the UE may request the S-NSSAI in the requested NSSAI in the Registration Request message;\nb)\tthe S-NSSAI time validity information indicates that the S-NSSAI is not available, then:\ni)\tthe UE shall not include the S-NSSAI in the requested NSSAI in the Registration Request message;\nii)\tthe UE shall remove the S-NSSAI from the stored allowed NSSAI (if any) and the stored partially allowed NSSAI (if any) in the non-volatile memory in the ME, as specified in annex\u00a0C; and\niii)\tthe S-NSSAI time validity information indicates that the S-NSSAI will not become available again, then the UE shall remove the S-NSSAI from the stored configured NSSAI in the non-volatile memory in the ME, as specified in annex\u00a0C.\nNOTE\u00a01:\tIf the S-NSSAI to be removed is the only S-NSSAI in the allowed NSSAI and partially allowed NSSAI, if applicable, the UE can before the time validity expiry initiate the registration procedure for mobility and periodic registration update and include a different S-NSSAI from the configured NSSAI in the Requested NSSAI IE of the REGISTRATION REQUEST message.\nWhen the S-NSSAI time validity information of an S-NSSAI indicates that the S-NSSAI is not available, then:\na)\tif the AMF receives a requested NSSAI in the REGISTRATION REQUEST message with the S-NSSAI identifying the network slice, the AMF shall:\ni)\tto a UE which has indicated that it supports S-NSSAI time validity information, provide:\n1)\ta configured NSSAI including the S-NSSAI together with the S-NSSAI time validity information in the Registration Accept message if the S-NSSAI will become available again; or\n2)\ta configured NSSAI not including the S-NSSAI in the Registration Accept message if the S-NSSAI will not become available again; or\nii)\tto a UE which has not indicated that it supports S-NSSAI time validity information, reject the S-NSSAI for the current PLMN or SNPN. If the registration request is accepted, the AMF shall include a configured NSSAI not including the S-NSSAI;\nb)\tif the AMF detects that the S-NSSAI is included in the allowed NSSAI or the partially allowed NSSAI of a UE which has:\ni)\tindicated that it supports S-NSSAI time validity information, the AMF shall locally remove the S-NSSAI from the allowed NSSAI (if any) and the partially allowed NSSAI (if any); or\nii)\tnot indicated that it supports S-NSSAI time validity information, the AMF shall remove the S-NSSAI from the stored configured NSSAI (if any), allowed NSSAI (if any), and partially allowed NSSAI (if any) by sending the CONFIGURATION UPDATE COMMAND message.\nWhen the S-NSSAI time validity information of an S-NSSAI indicates that the S-NSSAI becomes available again, the AMF shall update the configured NSSAI including the S-NSSAI to a UE which has not indicated that it supports S-NSSAI time validity information by sending CONFIGURATION UPDATE COMMAND message if the UE is subscribed to the S-NSSAI.\nThe S-NSSAI time validity information is applicable for the current PLMN or SNPN regardless of the access type.\n4.6.2.9\tMobility management based network slice usage control\nIf the UE and the network support network slice usage control, the AMF monitors network slice usage by running a slice deregistration inactivity timer per S-NSSAI and access type. The AMF may also provide on-demand NSSAI to the UE in the REGISTRATION ACCEPT message or in the CONFIGURATION UPDATE COMMAND message. The on-demand NSSAI consists of one or more on-demand S-NSSAIs and, optionally, the slice deregistration inactivity timer per on-demand S-NSSAI.\nThe slice deregistration inactivity timer is:\na)\tstarted using the stored slice deregistration inactivity timer value when there is no established PDU session, including any MA PDU session, associated with the S-NSSAI over the corresponding access type; and\nb)\tstopped and reset when at least a PDU session, including any MA PDU session, associated with the S-NSSAI is successfully established over the corresponding access type(s) or the S-NSSAI is removed from the allowed NSSAI.\nIf the slice deregistration inactivity timer value is updated, the AMF updates the stored timer value and may provide the updated timer value to the UE in the REGISTRATION ACCEPT message, in a current or the next registration procedure for mobility and periodic registration update, or the CONFIGURATION UPDATE COMMAND message.\nWhen the UE receives an updated slice deregistration inactivity timer value in the REGISTRATION ACCEPT message or the CONFIGURATION UPDATE COMMAND message from the AMF, the UE shall update the stored timer value.\nUpon expiry of the slice deregistration inactivity timer, the AMF shall locally remove the S-NSSAI from the allowed NSSAI over the corresponding access type. In addition, the AMF may send the CONFIGURATION UPDATE COMMAND message to the UEs with the new allowed NSSAI.\nThe UE includes the on-demand S-NSSAI which the UE requests in the requested NSSAI during the registration procedure. Upon expiry of the slice deregistration inactivity timer, the UE shall locally remove the S-NSSAI from the allowed NSSAI over the corresponding access type.\nNOTE\u00a00:\tIf the UE determines the on-demand S-NSSAI for a PDU session establishment as specified in subclause\u00a04.2.2 of 3GPP\u00a0TS\u00a024.526\u00a0[19], the UE includes the on-demand S-NSSAI in the requested NSSAI during the registration procedure.\nIf the UE supports network slice usage control, the AMF provides on-demand NSSAI in the Configured NSSAI to the UE in the REGISTRATION ACCEPT message or in the CONFIGURATION UPDATE COMMAND message. The on-demand NSSAI consists of one or more configured S-NSSAIs.\nOn-demand NSSAI is associated with the configured NSSAI. The on-demand S-NSSAI(s) is deleted by the UE from the stored on-demand NSSAI, when the associated configured S-NSSAI(s) is deleted by the UE from the stored configured NSSAI.\nBased on operator policy, the AMF shall not apply the network slice usage control for the S-NSSAI used for emergency services.\nNOTE\u00a01:\tIn this version of the specification, the network slice usage control feature is not supported in roaming scenarios.\n4.6.2.10\tMobility management aspects of handling network slices with NS-AoS not matching deployed tracking areas\nAn operator can choose to let the NS-AoS of an S-NSSAI not match the existing tracking area boundaries (see subclause\u00a05.15.18 of 3GPP\u00a0TS\u00a023.501\u00a0[8]). In order to support this deployment option, the operator has to ensure that an AMF covering the NS-AoS operates as described below.\nThe support for S-NSSAI location validity information by the UE and the network, respectively, is optional. If a UE supports S-NSSAI location validity information, the UE indicates that it supports S-NSSAI location validity information during the registration procedure (see subclause\u00a05.5.1). The AMF can provide a UE which has indicated that it supports S-NSSAI location validity information with S-NSSAI location validity information (see subclauses\u00a05.4.4 and 5.5.1). The S-NSSAI location validity information consists of, for each of the applicable S-NSSAI(s) in the configured NSSAI:\na)\tan S-NSSAI; and\nb)\ta list of cell identities of TA(s) belonging to the registration area where the related S-NSSAI(s) is available in some cells but not all cells of one or more TAs, which represents the NS-AoS of the S-NSSAI.\nThe UE shall consider itself to be inside the NS-AoS if the cell identity of the current serving cell matches any of the identities in the S-NSSAI location validity information. Otherwise, the UE shall consider itself to be outside the NS-AoS.\nNOTE\u00a01:\tThe cell identity of the current serving cell is received from the lower layers.\nFor an S-NSSAI in the S-NSSAI location validity information, even if the S-NSSAI is included in the rejected NSSAI with a rejection cause value set to \"S-NSSAI not available in the current registration area\" or is included in the partially rejected NSSAI, the UE is allowed to request the S-NSSAI if the UE determines that it is inside the NS-AoS of the S-NSSAI.\nFor an S-NSSAI limited by NS-AoS, if the UE in 5GMM-CONNECTED mode does not support S-NSSAI location validity information and the AMF determines that:\na)\tthe UE is not in the NS-AoS, then the AMF may:\n1)\tprovide the UE with an allowed NSSAI or a partially allowed NSSAI excluding the S-NSSAI, and optionally a configured NSSAI excluding the S-NSSAI; and\nNOTE\u00a02:\tIf excluding the S-NSSAI limited by NS-AoS results in an empty allowed NSSAI or partially allowed NSSAI, the AMF includes one or more default S-NSSAIs in the provided allowed NSSAI or partially allowed NSSAI.\n2)\tindicate to the SMF to release all PDU sessions associated with the S-NSSAI; or\nb)\tthe UE is in the NS-AoS, then the AMF may update the configured NSSAI to include the S-NSSAI in the configured NSSAI.\nIf the UE that does not support S-NSSAI location validity information requests a PDU session establishment for an S-NSSAI limited by NS-AoS and the AMF determines that the UE is not in the NS-AoS, the AMF may perform S-NSSAI based congestion control for the S-NSSAI as specified in subclauses\u00a05.3.11 and\u00a05.4.5.\nThe S-NSSAI location validity information is only applicable to 3GPP access.\n4.6.2.11\tMobility management for partial network slice\nA serving PLMN or SNPN can indicate the S-NSSAI(s) is allowed or rejected in some TA(s) but not all TAs of the registration area to the UE during the registration procedure as specified in subclause\u00a05.5.1 and the generic UE configuration update procedure as specified in subclause\u00a05.4.4. The support for the partial network slice by a UE or an AMF is optional.\nIf the UE supports the partial network slice and includes the S-NSSAI(s) in the requested NSSAI and:\na)\tif the S-NSSAI(s) is allowed in the current TA but not all TAs of the registration area, and\n1)\tif the S-NSSAI(s) is subject to NSAC for the maximum number of UEs, the AMF should include the S-NSSAI(s) in the allowed NSSAI to the UE and limit the registration area so that the S-NSSAI(s) is allowed in all the TAs of the registration area;\n2)\tif the S-NSSAI(s) is subject to NSSAA, the AMF shall include the S-NSSAI(s) in:\ni)\tthe pending NSSAI to the UE when the AMF is going to perform the network slice-specific authentication and authorization for the S-NSSAI(s); or \nii)\tthe partially allowed NSSAI to the UE after the network slice-specific authentication and authorization for the S-NSSAI(s) has been successfully performed; and\n3)\totherwise, the AMF shall include the S-NSSAI(s) in the partially allowed NSSAI to the UE; or\nb)\tif the S-NSSAI(s) is rejected in the current TA but not all TAs of the registration area; and\n1)\tif the S-NSSAI is subject to NSAC for the maximum number of UEs, the AMF should include the S-NSSAI(s) in the partially rejected NSSAI to the UE;\n2)\tif the S-NSSAI(s) is subject to NSSAA, the AMF shall include the S-NSSAI(s) in:\ni)\tthe partially rejected NSSAI to the UE when the AMF determines not to perform the network slice-specific authentication and authorization for the S-NSSAI(s);\nii)\tthe pending NSSAI to the UE when the AMF is going to perform the network slice-specific authentication and authorization for the S-NSSAI(s); or \niii)\teither the partially allowed NSSAI or the partially rejected NSSAI to the UE after the network slice-specific authentication and authorization for the S-NSSAI(s) has been successfully performed;\nNOTE\u00a01:\tThe AMF determines whether to perform the network slice-specific authentication and authorization procedure for the partial network slice based on its own local policy.\n3)\tif the S-NSSAI(s) is associated with a slice deregistration inactivity timer on the AMF side as specified in subclause\u00a04.6.2.9, the AMF shall include the S-NSSAI(s) in the partially rejected NSSAI to the UE; and\n4)\totherwise, the AMF shall include the S-NSSAI(s) in either the partially allowed NSSAI or the partially rejected NSSAI to the UE; or\nc)\tif the partially allowed NSSAI, the partially rejected NSSAI, or both are changed, the AMF shall provide the new partially allowed NSSAI, the new partially rejected NSSAI, or both to the UE.\nUpon receiving the partially allowed NSSAI, the UE shall regard the S-NSSAI(s) included in partially allowed NSSAI, if any, as the allowed S-NSSAI(s) for the current registration area and store the received partially allowed NSSAI as specified in subclause\u00a04.6.2.2.\nUpon receiving the partially rejected NSSAI, the UE shall store the received partially rejected NSSAI as specified in subclause\u00a04.6.2.2. The UE shall not attempt to include the S-NSSAI, if any, in the requested NSSAI if the current TAI is in the list of TAs for which S-NSSAI is rejected.\nThe AMF shall ensure that there is also at least one S-NSSAI in the allowed NSSAI allocated to the UE as specified in subclause\u00a05.15.2.1 of 3GPP\u00a0TS\u00a023.501\u00a0[8].\nThe mobility management for partial network slice is only applicable to 3GPP access.\nThe mobility management for partial network slice is not applicable to a UE that is registering or registered for onboarding services in SNPN.\n4.6.3\tSession management aspects\n4.6.3.0\tGeneral\nIn order to enable PDU transmission in a network slice, the UE may request establishment of a PDU session in a network slice towards a data network (DN) which is associated with an S-NSSAI and a data network name (DNN) if there is no established PDU session adequate for the PDU transmission. The S-NSSAI included is part of allowed NSSAI of the serving PLMN or SNPN, which is an S-NSSAI value valid in the serving PLMN or SNPN, and in roaming scenarios the mapped S-NSSAI is also included for the PDU session if available. See subclause\u00a06.4.1 for further details. The UE determines whether to establish a new PDU session or use one of the established PDU session(s) based on the URSP rules which include S-NSSAIs, if any (see subclause\u00a06.2.9), or based on UE local configuration, as described in subclause\u00a04.2.2 of 3GPP\u00a0TS\u00a024.526\u00a0[19].\n4.6.3.1\tSession management based network slice admission control\nA serving PLMN or the HPLMN, or SNPN can perform network slice admission control for the S-NSSAI(s) subject to NSAC to monitor and control the total number of established PDU sessions per network slice. The SMF performs network slice admission control on the S-NSSAI during the PDU session establishment procedure. If the maximum number of PDU sessions on a network slice associated with an S-NSSAI has been already reached, the SMF rejects the PDU session establishment request using S-NSSAI based congestion control as specifed in subclause\u00a06.2.8 and 6.4.1.4.2.\nThe SMF performs network slice admission control on the S-NSSAI for a PDU session that is associated with the non-3GPP access, when the UE requests to transfer a session from the non-3GPP access to the 3GPP access with the Allowed PDU session status IE as described in subclause\u00a05.6.1.4. If the maximum number of PDU sessions on a network slice associated with an S-NSSAI has been already reached, the SMF rejects the request to establish the user-plane resources (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]).\nBased on operator policy, the session management based network slice admission control is not applicable for the PDU session for emergency services, or the session management based network slice admission control result is ignored for the PDU session for emergency services.\nBased on operator policy, the session management based network slice admission control is not applicable for the PDU session for priority services, or the session management based network slice admission control result is ignored for the PDU session for priority services.\nNOTE\u00a01:\tThe SMF can use the Sbi-Message-Priority field, as defined in TS\u00a029.500 [20AA], to determine whether the PDU session is for priority services.\nThe session management based network slice admission control is not applicable to PDU session established for onboarding services in SNPN.\nNOTE\u00a02:\tFor the MA PDU session during the PDU session establishment procedure, the SMF performs network slice admission control only when it is newly established over the associated access type.\nNOTE\u00a03:\tFor a set of redundant PDU sessions, the SMF performs network slice admission control for each PDU session independently.\n4.6.3.2\tSupport of network slice admission control and interworking with EPC\nIf EPS counting is required for a network slice, the network performs network slice admission control for the S-NSSAI(s) subject to NSAC to monitor and control the number of UEs per network slice and number of PDU sessions per network slice during the PDN connection establishment procedure. If the maximum number of UEs on a network slice associated with an S-NSSAI or the maximum number of PDU sessions on a network slice associated with an S-NSSAI have already been reached, the network rejects the PDN connectivity request using ESM cause #26 \"insufficient resources\" as specifed in 3GPP\u00a0TS\u00a024.301\u00a0[15].\nNOTE:\tIf there are more than one S-NSSAI associated with the APN used in the PDN connectivity request and some of but not all associated S-NSSAIs are not available due to either maximum number of UEs reached or maximum number of PDU sessions reached, the network can use the associated S-NSSAI for which maximum number of UEs and maximum number of PDU sessions have not reached to avoid PDN connectivity request rejection.\n4.6.3.3\tSession management based network slice data rate limitation control\nA serving PLMN or the HPLMN can perform network slice data rate limitation control for the S-NSSAI(s) subject to network slice data rate limitation control to monitor and control the total data rate of established PDU sessions per network slice as specified in 3GPP\u00a0TS\u00a023.503\u00a0[10]. If the maximum data rate of PDU sessions on a network slice associated with an S-NSSAI has been exceeded during the PDU session establishment procedure, the SMF may reject the PDU session establishment request using S-NSSAI based congestion control as specified in subclause\u00a06.2.8 and 6.4.1.4.2.\nA serving PLMN or the HPLMN can perform management of Slice-Maximum Bit Rate per UE (UE-Slice-MBR) as specified in 3GPP\u00a0TS\u00a023.503\u00a0[10]. When the UE-Slice-MBR for the UE and S-NSSAI to which the PDU session is allocated is exceeded during the PDU session establishment procedure, the SMF may reject the PDU session establishment request using S-NSSAI based congestion control as specified in subclause\u00a06.2.8 and 6.4.1.4.2.\nNOTE\u00a01:\tBased on operator policy, the network slice data rate limitation control can be not applicable for the S-NSSAI(s) used for emergency services or priority services.\nNOTE\u00a02:\tThe network slice data rate limitation control and UE-Slice-MBR management are performed by the PCF.\n4.6.3.4\tSession management based network slice replacement\nIf:\na)\tthe UE and network support network slice replacement;\nb)\tthe UE is provided with the mapping information between the S-NSSAI to be replaced and the alternative S-NSSAI; and\nc)\tthe UE decides to establish a new PDU session with the S-NSSAI to be replaced,\nthe UE provides both the S-NSSAI to be replaced and the alternative S-NSSAI during PDU session establishment procedure. If the timer T3584 or timer T3585 is running for the S-NSSAI to be replaced, the UE should not stop the timer during PDU session establishment procedure. If the SMF receives both the S-NSSAI to be replaced and the alternative S-NSSAI during PDU session establishment procedure, the SMF proceeds with the PDU session establishment procedure with the alternative S-NSSAI. If the PDU session establishment request is accepted, the SMF includes the alternative S-NSSAI in the PDU session establishment accept message. The S-NSSAI for the established PDU session is the S-NSSAI to be replaced and the alternative S-NSSAI on the UE side.\nIf the UE is provided with the mapping of the VPLMN S-NSSAI to a VPLMN alternative S-NSSAI, the UE provides both the VPLMN alternative S-NSSAI and the VPLMN S-NSSAI in the PDU SESSION ESTABLISHMENT REQUEST message. If the UE is provided with the mapping of the HPLMN S-NSSAI to a HPLMN Alternative S-NSSAI, the UE provides both the HPLMN alternative S-NSSAI and the HPLMN S-NSSAI in the PDU SESSION ESTABLISHMENT REQUEST message. The AMF sends both HPLMN alternative S-NSSAI and HPLMN S-NSSAI to the SMF.\nIf the SMF receives from the AMF an alternative S-NSSAI for existing PDU session and:\na)\tif the SMF decides to retain the existing PDU session (i.e. the SMF can serve both the alternative S-NSSAI and the S-NSSAI to be replaced with), the SMF sends the alternative S-NSSAI to the UE during network-requested PDU session modification procedure; or\nb)\tif the SMF decides to re-activate the existing PDU session and:\n1)\tif the SSC mode of the PDU session is SSC mode 3, the SMF initiates PDU session modification procedure to trigger PDU session reactivation by the UE; or\n2)\tif the SSC mode of the PDU session is SSC mode 1 or SSC mode 2, the SMF initiates PDU session release procedure to trigger PDU session reactivation by the UE, and the UE provides both the S-NSSAI to be replaced and the alternative S-NSSAI during PDU session establishment procedure.\nWhen the S-NSSAI which has been replaced becomes available again, if the SMF receives from the AMF the S-NSSAI which has been replaced for the existing PDU session and:\na)\tif the SMF decides to retain the existing PDU session (i.e. the SMF can serve the S-NSSAI which has been replaced), the SMF sends the S-NSSAI which has been replaced to the UE during network-requested PDU session modification procedure; or\nb)\tif the SMF decides to re-activate the existing PDU session and:\n1)\tif the SSC mode of PDU session is SSC mode 3, the SMF sends the S-NSSAI which has been replaced to the UE during PDU session modification procedure to trigger PDU session reactivation by the UE; or\n2)\tif the SSC mode of the PDU session is SSC mode 1 or SSC mode 2, the SMF sends the S-NSSAI which has been replaced to the UE during PDU session release procedure to trigger PDU session reactivation by the UE; and the UE provides the S-NSSAI which has been replaced during PDU establishment procedure. \nIf the timer T3584 or timer T3585 is running for the S-NSSAI that was replaced and the S-NSSAI that was replaced in alternative NSSAI is available and the AMF provides the updated allowed NSSAI and configured NSSAI to the UE, the UE should stop the timer.\n4.6.3.5\tSession management for optimized handling of temporarily available network slices\nA network slice can be available temporarily. Subclause\u00a04.6.2.8 addresses how the allowed NSSAI and partially allowed NSSAI are managed based on the S-NSSAI time validity information. \nIf the S-NSSAI time validity information indicates that the S-NSSAI is available, the UE may initiate a UE-requested PDU session establishment procedure to establish a PDU session associated with the S-NSSAI.\nIf the S-NSSAI time validity information indicates that the S-NSSAI is not available, then the UE shall: \na)\tinitiate UE-requested PDU session release procedure to release any PDU session associated with the S-NSSAI, if the UE is in 5GMM-CONNECTED mode or in 5GMM-CONNECTED mode with RRC inactive indication; or\nb)\tlocally release any PDU session associated with the S-NSSAI, if the UE is in 5GMM-IDLE mode.\nWhen the S-NSSAI time validity information in the AMF indicates that the S-NSSAI is not available, independent of whether the UE is in 5GMM-CONNECTED mode, 5GMM-CONNECTED mode with RRC inactive indication or in 5GMM-IDLE mode, the AMF shall request the SMF to release any PDU session associated with the S-NSSAI.\n4.6.3.6\tSession management for partial network slice\nIf the S-NSSAI is included in the partially allowed NSSAI and:\na)\tif the current TAI is in the list of TAs for which the S-NSSAI is allowed, the UE may initiate the UE-requested PDU session establishment procedure for the S-NSSAI; or\nb)\tif the current TAI is not in the list of TAs for which the S-NSSAI is allowed, the UE shall not initiate the UE-requested PDU session establishment procedure for the S-NSSAI.\nIf an existing PDU session is established for the S-NSSAI included in the partially allowed NSSAI and the current TAI is in the list of TAs for which the S-NSSAI is allowed:\na)\tthe UE:\n1)\tmay initiate the service request procedure to re-establish the user plane resources for the established PDU session; or\n2)\tmay initiate the UE-initiated NAS transport procedure carrying control plane user data; and\nb)\tthe SMF may initiate the network-initiated NAS transport procedure carrying control plane user data.\nIf an existing PDU session is established for the S-NSSAI included in the partially allowed NSSAI and the current TAI is not in the list of TAs for which the S-NSSAI is allowed:\na)\tthe UE;\n1)\tshall maintain the 5GSM contexts for the established PDU session;\n2) shall not initiate the UE-initiated NAS transport procedure carrying control plane user data; and\n3)\tmay initiate:\ni)\tthe UE-requested PDU session release procedure; or\nii)\tthe UE-requested PDU session modification procedure to set the 3GPP PS data off status to \"deactivated\" as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13]; and\nb)\tthe SMF:\n1)\tshall maintain the 5GSM contexts for the established PDU session;\n2)\tshall not initiate the network-initiated NAS transport procedure carrying control plane user data; and\n3)\tmay initiate the network-requested PDU session release procedure.\nIf the SMF cannot determine that the UE is located in a TA within the list of TAs associated with the S-NSSAI of an existing PDU session established for this S-NSSAI, the SMF may according to operator's policy:\na)\tattempt to establish the user plane resources for the PDU session; or\nb)\tsend control plane user data to the UE.\nNOTE:\tThe session management for partial network slice is not applicable to the PDU session established for onboarding services in SNPN.\n4.6.3.7\tSession management aspect of handling network slices with NS-AoS not matching deployed tracking areas\nIf a UE is outside the NS-AoS of an S-NSSAI (see subclause\u00a04.6.2.10), the UE shall not:\na)\tattempt to request the establishment of user plane resources of any PDU session associated with the S-NSSAI; and\nb)\tinitiate UL NAS TRANSPORT messages carrying control plane user data.\nIf a UE is outside the NS-AoS of an S-NSSAI (see subclause\u00a04.6.2.10), the SMF shall not:\na)\tattempt to establish user plane resources of any PDU session associated with the S-NSSAI; and\nb)\tsend control plane user data to the UE.\nIf a UE is outside the NS-AoS of an S-NSSAI (see subclause\u00a04.6.2.10), the UE may initiate the UE-initiated NAS transport procedure carrying the following 5GSM messages for the PDU session associated with the S-NSSAI:\na)\ta PDU SESSION RELEASE REQUEST message; or\nb)\ta PDU SESSION MODIFICATION REQUEST message to set the 3GPP PS data off status to \"deactivated\" as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13].\nNOTE:\tA PDU session associated with an S-NSSAI is not released solely because a UE is outside the NS-AoS of the S-NSSAI.\nIf the SMF cannot determine that the UE is located inside the NS-AoS of the S-NSSAI of an existing PDU session established for this S-NSSAI, the SMF may according to operator's policy:\na)\tattempt to establish the user plane resources for the PDU session; or\nb)\tsend control plane user data to the UE.\n4.7\tNAS over non-3GPP access\n4.7.1\tGeneral\nFrom the UE's NAS perspective, in general the procedures and messages defined for 5GMM and 5GSM are used over non-3GPP access as over 3GPP access. However, a number of aspects are different as described in the following subclauses.\n4.7.2\t5GS mobility management aspects\n4.7.2.1\tGeneral\nThe mobility management procedures defined over 3GPP access are re-used over non-3GPP access with the following exceptions:\na)\tthe registration status, and the 5GMM parameters of the UE's 3GPP access and non-3GPP access 5GMM state machine instances are independent in each of these accesses and can be different;\nb)\tsingle-registration mode and dual-registration mode do not apply for 5GMM over non-3GPP access;\nc)\tthe RPLMN over non-3GPP access can be different from the RPLMN over 3GPP access. The MCC of the RPLMN over 3GPP access and the MCC of the RPLMN over the non-3GPP access can also be different;\nd)\tthe registration for 3GPP access and for non-3GPP access are performed separately. Like for 3GPP access, an access stratum connection exists before the UE can perform the registration procedure for non-3GPP access. As at registration over non-3GPP access the UE is allocated a registration area, which is associated with a single TAI, list management of registration areas is not required, and registration updating due to registration area change with the registered PLMN is not performed. Furthermore, the periodic registration update procedure is also not performed. New registration at change of PLMN is required;\ne)\tthe 5GMM over non-3GPP access in the UE considers that the N1 NAS signalling connection is established when the lower layers indicate that the access stratum connection is established succcessfully;\nf)\tthe UE-initiated service request procedure via non-3GPP access is supported. Upon indication from the lower layers of non-3GPP access, that the access stratum connection is established between the UE and the network, the UE in 5GMM-REGISTERED state and in 5GMM-IDLE mode over non-3GPP access shall initiate the service request procedure via non-3GPP access. The UE may indicate with the service request message the PDU session(s) associated with non-3GPP access to re-establish user-plane resources for which the UE has pending user data to be sent;\ng)\tpaging procedure is not performed via non-3GPP access;\nh)\tservice area restrictions do not apply for non-3GPP access other than the wireline access;\ni)\tthe establishment cause for non-3GPP access is determined according to subclause\u00a04.7.2.2;\nj)\teCall inactivity procedure is not performed via non-3GPP access;\nk)\tlocal area data network (LADN) does not apply for non-3GPP access;\nl)\tthe Allowed PDU session IE shall not be included in the REGISTRATION REQUEST message or the SERVICE REQUEST message sent over non-3GPP access;\nm)\tDRX parameters do not apply for non-3GPP access;\nn)\tMobile initiated connection only mode (MICO) does not apply for non-3GPP access;\no)\tCIoT 5GS optimizations do not apply for non-3GPP access;\np)\tunified access control does not apply for non-3GPP access;\nq)\tUE radio capability signalling optimisation (RACS) does not apply for non-3GPP access;\nr)\tClosed access group (CAG) does not apply for non-3GPP access;\ns)\tthe N1 NAS signalling connection release, the paging indication for voice services and reject the paging request do not apply for non-3GPP access. The Paging restriction IE shall not be included in the REGISTRATION REQUEST message, the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message sent over non-3GPP access. The AMF shall not delete any stored paging restriction preferences for the UE and shall not stop restricting paging when receiving REGISTRATION REQUEST message, SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message over non-3GPP access;\nt)\tthe partially allowed NSSAI and the partially rejected NSSAI do not apply for non-3GPP access; and\nu)\tsupport for unavailability period (see subclause\u00a05.3.26) does not apply for non-3GPP access.\n4.7.2.2\tEstablishment cause for non-3GPP access\nWhen establishment of an N1 NAS signalling connection over non-3GPP access is initiated, the UE shall:\na)\tdetermine one or more access identities to be associated with the establishment of the N1 NAS signalling connection as specified in subclause\u00a04.5.2 and table\u00a04.5.2.1;\nb)\tselect the establishment cause for non-3GPP access from the determined one or more access identities and the event which triggered initiation of the N1 NAS signalling connection over non-3GPP access by checking the rules specified in table\u00a04.7.2.2.1; and\nc)\tprovide the selected establishment cause for non-3GPP access to the lower layers.\nWhile an MMTEL voice call is ongoing:\n-\tany:\n1)\tservice request procedure; or\n2)\tregistration procedure;\n\tinitiated in 5GMM-IDLE mode is mapped to \"MO MMTel voice call\" type access attempt.\nWhile an MMTEL video call is ongoing and no MMTEL voice call is ongoing:\n-\tany:\n1)\tservice request procedure; or\n2)\tregistration procedure;\n\tinitiated in 5GMM-IDLE mode is mapped to \"MO MMTel video call\" type access attempt.\nWhile an SMSoIP is ongoing, no MMTEL video call is ongoing and no MMTEL voice call is ongoing:\n-\tany:\n1)\tservice request procedure; or\n2)\tregistration procedure;\n\tinitiated in 5GMM-IDLE mode is mapped to \"MO SMS over IP\" type access attempt.\nIf the access attempt matches more than one rule, the establishment cause for non-3GPP access of the lowest rule number shall be used.\nTable\u00a04.7.2.2.1: Mapping table for determination of establishment cause for non-3GPP access\n\n4.7.3\t5GS session management aspects\nThe session management procedures defined over 3GPP access are re-used over non-3GPP access with the following exceptions:\na)\tServing PLMN rate control does not apply for non-3GPP access;\nb)\tSmall data rate control does not apply for non-3GPP access;\nc)\tHandling of 5GSM cause value #82 \"maximum data rate per UE for user-plane integrity protection is too low\" does not apply for non-3GPP access;\nd)\tMBS does not apply for non-3GPP access;\ne)\tSupport of redundant PDU sessions does not apply for non-3GPP access; and\nx)\tPDU set handling does not apply for non-3GPP access.\n4.7.4\tLimited service state over non-3GPP access\nThere are a number of situations in which the UE is unable to obtain normal service from a PLMN over non-3GPP access and the UE enters the limited service state over non-3GPP access. These include:\na)\tno USIM in the ME;\nb)\tan \"illegal UE\" or \"illegal ME\" is received when registration, network-initiated de-registration or service request is performed (any USIM in the ME is then considered \"invalid\");\nc)\ta \"5GS services not allowed\" is received when a registration, network-initiated de-registration or service request is performed;\nd)\ta \"PLMN not allowed\" is received when registration, network-initiated de-registration or service request is performed;\ne)\ta \"Tracking area not allowed\" is received when a registration, network-initiated de-registration or service request is performed;\nf)\ta \"Roaming not allowed in this tracking area\" is received when a registration, network-initiated de-registration or service request is performed;\ng)\tvoid; or\nh)\ta \"Serving network not authorized\" is received when a registration or service request is performed.\nIn limited service state with a valid USIM in the UE, the network selection is performed as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18].\nWith the exception of performing initial registration for emergency services, no registration requests are made until a valid USIM is present. For registration for emergency services, the PLMN of the current N3IWF or TNGF is considered as the selected PLMN for the duration the UE is registered for emergency services.\n4.7.5\tNAS signalling using trusted WLAN access network\nA trusted WLAN interworking function (TWIF) provides functionalities for a non-5G capable over WLAN (N5CW) device to access 5GCN, including:\na)\tNAS signalling over N1 NAS signalling connection with AMF; and\nb)\tPDU session establishment, modification and release on behalf of the N5CW device, over N2 connection with the AMF.\nThe TWIF registers on behalf of the N5CW device to an AMF according to subclause\u00a05.5.1 by populating the parameters for the registration by using implementation specific default values which are the same for N5CW devices.\nThe TWIF may request to establish a PDU session as specified in subclause\u00a06.4.1.2 on behalf of the N5CW device upon receipt of an IP configuration request from the N5CW device by populating either all the required parameters or part of the required parameters for the PDU session establishment by using implementation specific default values from the TWIF's configuration. Only one PDU session is supported when N5CW device accessing 5GC via the TWIF.\nNOTE\u00a01:\tIf part of the required parameters for the PDU session establishment is provided by the TWIF, the remaining of the required parameters are determined by the AMF or the SMF based on the N5CW device's subscription information.\nUpon loss of the IP address of the N5CW device, the TWIF acting on behalf of the N5CW device shall initiate the UE-requested PDU session release procedure as defined in subclause\u00a06.4.3.\nNOTE\u00a02:\tThe established PDU session on behalf of the N5CW device can be modified by the TWIF or the network.\n4.8\tInterworking with E-UTRAN connected to EPC\n4.8.1\tGeneral\nIn order to interwork with E-UTRAN connected to EPC, the UE supporting both S1 mode and N1 mode can operate in single-registration mode or dual-registration mode (see 3GPP\u00a0TS\u00a023.501\u00a0[8]). Support of single-registration mode is mandatory for UEs supporting both S1 mode and N1 mode.\nDuring the EPS attach procedure (see 3GPP\u00a0TS\u00a024.301\u00a0[15]) or initial registration procedure (see subclause\u00a05.5.1.2), the mode for interworking is selected if the UE supports both S1 mode and N1 mode, and the network supports interworking. The mode for interworking may also be selected during the EPS tracking area updating procedure (see 3GPP\u00a0TS\u00a024.301\u00a0[15]) or registration procedure for mobility and periodic registration update (see subclause\u00a05.5.1.3).\nFor interworking between E-UTRAN connected to EPC and TNGF or N3IWF connected to 5GCN, the UE shall operate as specified in either subclause\u00a04.8.2.3 or subclause\u00a04.8.3. Which subclause the UE follows is chosen by the UE irrespective of the interworking without N26 interface indicator.\n4.8.2\tSingle-registration mode\n4.8.2.1\tGeneral\nIf the UE receives the indication that \"interworking without N26 interface not supported\" (see 3GPP\u00a0TS\u00a024.301\u00a0[15]), the UE operates as described in subclause\u00a04.8.2.2.\nIf the UE receives the indication that \"interworking without N26 interface supported\" and\na)\tthe UE does not support dual-registration mode; or\nb)\tthe UE supporting dual-registration mode determines to operate in single-registration mode,\nthe UE operates as described in subclause\u00a04.8.2.3.\n4.8.2.2\tSingle-registration mode with N26 interface\nSee subclause\u00a05.1.4.2 for coordination between 5GMM and EMM and subclause\u00a06.1.4.1 for coordination between 5GSM and ESM.\n4.8.2.3\tSingle-registration mode without N26 interface\n4.8.2.3.1\tInterworking between NG-RAN and E-UTRAN\nAt inter-system change from N1 mode to S1 mode in EMM-IDLE mode when:\na)\tthe UE supports non-IP PDN type and at least one PDU session of Unstructured PDU session type is active;\nb)\tthe UE supports IPv4 PDN type and at least one PDU session of IPv4 PDU session type is active;\nc)\tthe UE supports IPv6 PDN type and at least one PDU session of IPv6 PDU session type is active;\nd)\tthe UE supports IPv4v6 PDN type and at least one PDU session of IPv4v6 PDU session type is active; or\ne)\tat least one PDU session of Ethernet PDU session type is active and:\n1)\tthe UE supports non-IP PDN type; or\n2)\tthe UE and the network support Ethernet PDN type in S1 mode;\nthe UE shall proceed as follows:\na)\tif the UE supports sending an ATTACH REQUEST message containing a PDN CONNECTIVITY REQUEST message with request type set to \"handover\" or \"handover of emergency bearer services\" to transfer a PDU session from N1 mode to S1 mode and the UE has received an \"interworking without N26 interface supported\" indication from the network, the UE shall:\n1)\tenter substates EMM-DEREGISTERED.NORMAL-SERVICE and 5GMM- DEREGISTERED.NO-CELL-AVAILABLE for 3GPP access;\nNOTE:\u00a0\tSince MM context transfer is not possible between MME and AMF in a network that indicates \"Interworking without N26 supported\", it is up to the UE implementation as to how to keep the 5GMM and EMM states in the UE in sync. \n2)\tmap the PDU session(s) which the UE intends to transfer to EPS to the default EPS bearer context of the corresponding PDN connection(s) as specified in subclause\u00a06.1.4.2; and\n3)\tinitiate an EPS attach procedure and include in the ATTACH REQUEST message a PDN CONNECTIVITY REQUEST message with:\n-\tthe request type set to \"handover of emergency bearer services\" to activate a default EPS bearer context for an active emergency PDU session, if the session to be transferred is an emergency PDU session; or\n-\tthe request type set to \"handover\" message to activate a default EPS bearer context for an active non-emergency PDU session, if the session to be transferred is a non-emergency PDU session. If the selected PDU session is an MA PDU session established over 3GPP access, the UE shall include the ATSSS request parameter in the Protocol configuration options IE or the Extended protocol configuration options IE of the ESM INFORMATION RESPONSE message.\n\tAfter successful completion of the EPS attach procedure, the UE shall reset the registration attempt counter for 3GPP access and the attach attempt counter (see 3GPP\u00a0TS\u00a024.301\u00a0[15]), enter substates EMM-REGISTERED.NORMAL-SERVICE and 5GMM-REGISTERED.NO-CELL-AVAILABLE for 3GPP access and attempt to activate each of the other default EPS bearer contexts, if any, by initiating a stand-alone PDN connectivity procedure with request type set to \"handover\" for non-emergency PDU session or \"handover of emergency bearer services\" for emergency PDU session in the PDN CONNECTIVITY REQUEST message. If the EPS attach procedure is unsuccessful the UE shall enter substates EMM-DEREGISTERED.NORMAL-SERVICE and 5GMM-DEREGISTERED.NO-CELL-AVAILABLE for 3GPP access; and\nb)\totherwise, enter substates EMM-REGISTERED.NORMAL-SERVICE and 5GMM-REGISTERED.NO-CELL-AVAILABLE for 3GPP access and initiate a tracking area update procedure (see 3GPP\u00a0TS\u00a024.301\u00a0[15]).\nAt inter-system change from N1 mode to S1 mode in EMM-IDLE mode when:\na)\tthe UE does not support non-IP PDN type or no PDU session of Unstructured PDU session type is active;\nb)\tthe UE does not support IPv4 PDN type or no PDU session of IPv4 PDU session type is active;\nc)\tthe UE does not support IPv6 PDN type or no PDU session of IPv6 PDU session type is active;\nd)\tthe UE does not support IPv4v6 PDN type or no PDU session of IPv4v6 PDU session type is active; and\ne)\tno PDU session of Ethernet PDU session type is active or:\n1)\tthe UE does not support non-IP PDN type; and\n2)\tthe UE, the network or both do not support Ethernet PDN type in S1 mode;\nthe UE shall enter substates EMM-DEREGISTERED.NORMAL-SERVICE and 5GMM-DEREGISTERED.NO-CELL-AVAILABLE for 3GPP access, and initiate an attach procedure.\nAt inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, the UE shall:\na)\tenter substate 5GMM-REGISTERED.NORMAL-SERVICE for 3GPP access and substate EMM-REGISTERED.NO-CELL-AVAILABLE;\nb)\tmap the default EPS bearer context(s) of the PDN connection(s) which the UE intends to transfer to 5GS, if any, to the corresponding PDU session(s) as specified in subclause\u00a06.1.4.2; and\nc)\tinitiate the registration procedure for mobility and periodic registration update over 3GPP access indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message (see subclause\u00a05.5.1.3).\nAfter having successfully registered in N1 mode over 3GPP access, the UE shall reset the registration attempt counter for 3GPP access, and the attach attempt counter or tracking area updating attempt counter (see 3GPP\u00a0TS\u00a024.301\u00a0[15]) and:\na)\tif the UE supports the PDU session establishment procedure with request type set to \"existing PDU session\" or \"existing emergency PDU session\" to transfer a PDN connection from S1 mode to N1 mode and the UE has received an \"interworking without N26 interface supported\" indication from the network, attempt to transfer the PDN connection(s) which the UE intends to transfer to 5GS, if any, from S1 mode to N1 mode by:\n-\tif the PDN connection which the UE intends to transfer is a PDN connection for emergency bearer services, initiating the PDU session establishment procedure with request type set to \"existing emergency PDU session\" to transfer the PDN connection for emergency bearer services; and\n-\tif the PDN connection which the UE intends to transfer is a non-emergency PDN connection, initiating the PDU session establishment procedure with request type set to:\n1)\t\"MA PDU request\", if the PDN connection to be transferred is a user-plane resource of an MA PDU session; or\n2)\t\"existing PDU session\" to transfer the non-emergency PDN connection; and\nb)\totherwise, establish PDU session(s) corresponding to the PDN connection(s) which the UE intends to transfer to 5GS, if any, by initiating the PDU session establishment procedure with request type set to \"initial request\".\nSee subclause\u00a05.1.4.3 for coordination between 5GMM and EMM and subclause\u00a06.1.4.2 for coordination between 5GSM and ESM.\n4.8.2.3.2\tInterworking between TNGF or N3IWF connected to 5GCN and E-UTRAN\nIf:\na)\tthe UE has registered in neither N1 mode over 3GPP access nor S1 mode yet; and\nb)\tthe UE has at least one active PDU session associated with non-3GPP access which the UE intends to transfer to EPS,\nthe UE shall initiate an EPS attach procedure and include a PDN CONNECTIVITY REQUEST message with a request type in the ATTACH REQUEST message to activate a default EPS bearer context for one of the active PDU sessions which the UE intends to transfer to EPS (see 3GPP\u00a0TS\u00a024.301\u00a0[15]). The request type is set as follows:\n-\tif the PDU session which the UE intends to transfer is a non-emergency PDU session, the request type is set to \"handover\"; and\n-\tif the PDU session which the UE intends to transfer is an emergency PDU session, the request type is set to \"handover of emergency bearer services\" and the default bearer to be activated is the default EPS bearer context for the emergency PDU session.\nNOTE\u00a01:\tIt is necessary for the UE to support sending an ATTACH REQUEST message containing a PDN CONNECTIVITY REQUEST message with request type set to \"handover\" or \"handover of emergency bearer services\" to transfer a PDU session from N1 mode to S1 mode for interworking between TNGF or N3IWF connected to 5GCN and E-UTRAN.\nNOTE\u00a02:\tThe order of PDU sessions to be tranferred to EPS is up to UE implementation.\nAfter successful completion of the EPS attach procedure where the activated default EPS bearer context is not for emergency service, the UE shall initiate a UE requested PDN connectivity procedure with request type set to \"handover\" for non-emergency PDU session or \"handover of emergency bearer services\" for emergency PDU session in the PDN CONNECTIVITY REQUEST message to transfer each of the other PDU sessions which the UE intends to transfer to EPS, if any.\nIf:\na)\tthe UE has not registered in N1 mode over non-3GPP access yet; and\nb)\tthe UE has at least one active PDN connection which the UE intends to transfer to TNGF or N3IWF connected to 5GCN,\nthe UE shall initiate an initial registration procedure over non-3GPP access (see subclause\u00a05.5.1.2).\nAfter successful completion of the 5GS initial registration in N1 mode over non-3GPP access, the UE shall initiate a UE-requested PDU session establishment procedure with a request type to transfer each of the PDN connections which the UE intends to transfer to TNGF or N3IWF connected to 5GCN, if any. The request type is set as follows:\n-\tif the PDN connection which the UE intends to transfer is a PDN connection for emergency bearer services, the request type is set to \"existing emergency PDU session\" to transfer the PDN connection for emergency bearer services; and\n-\tif the PDN connection which the UE intends to transfer is a non-emergency PDN connection, the request type is set to \"existing PDU session\" to transfer the non-emergency PDN connection.\nNOTE\u00a03:\tIf the UE has no active PDU session associated with non-3GPP access which the UE in N1 mode intends to transfer to EPS or no active PDN connection associated with 3GPP access which the UE in S1 mode intends to transfer to TNGF or N3IWF connected to 5GCN, the interworking between TNGF or N3IWF connected to 5GCN and E-UTRAN is not supported.\nSee subclause\u00a06.1.4.2 for coordination between 5GSM and ESM.\n4.8.3\tDual-registration mode\nIf both 5GMM and EMM are enabled, a UE, operating in the dual-registration mode shall maintain independent contexts for 5GMM and EMM and this includes independent lists of equivalent PLMNs. Coordination between 5GMM and EMM is not needed, except as specified in the present subclause, subclause\u00a05.1.5 and 5.3.13A.\nFor dual-registration mode the following applies:\na)\ta UE operating in the dual-registration mode may register to N1 mode only, S1 mode only, or to both N1 mode and S1 mode;\nb)\twhen the UE decides to operate in dual-registration mode (see subclause\u00a05.5.1.2.4), NAS informs the lower layers about this;\nc)\tif a UE is registered in N1 mode only, then for registration in S1 mode the UE shall use:\n1)\tthe same PLMN to which it is registered in N1 mode; or\n2)\tan equivalent PLMN; and\nd)\tif a UE is registered in S1 mode only, then for registration in N1 mode the UE shall use:\n1)\tthe same PLMN to which it is registered in S1 mode; or\n2)\tan equivalent PLMN.\nNOTE\u00a01:\tIt is up to UE implementation how to handle the case when the UE is registered in both N1 mode and S1 mode and the PLMNs to which the UE is registered, are not equivalent, e.g. search for a PLMN which is the same or equivalent to any of the registered ones.\nWhen no PDU session is active and the UE has not registered to S1 mode yet, the UE may initiate the EPS attach procedure with PDN connection establishment if EMM-REGISTERED without PDN connection is not supported by the MME. If EMM-REGISTERED without PDN connection is supported by the MME, the UE may initiate either the EPS attach procedure without PDN connection establishment or the attach procedure with PDN connection establishment.\nWhen at least one PDU session is active and the UE has not registered to S1 mode yet, the UE may initiate the EPS attach procedure. If necessary, the UE may transfer an active PDU session from N1 mode to S1 mode by initiating the EPS attach procedure with request type set to \"handover\" in the PDN CONNECTIVITY REQUEST message. After successfully attached in S1 mode, if necessary, the UE may transfer other active PDU sessions from N1 mode to S1 mode by initiating the PDN connectivity procedure with request type set to \"handover\" in the PDN CONNECTIVITY REQUEST message.\nNOTE\u00a02:\tIt is up to UE implementation to determine which active PDU session is transferred from N1 mode to S1 mode.\nWhen the UE has not registered to N1 mode, the UE may initiate the initial registration procedure. After successfully registered in N1 mode, if necessary, the UE may transfer one or more active PDN connections from S1 mode to N1 mode by initiating the PDU session establishment procedure with request type set to \"existing PDU session\".\nNOTE\u00a03:\tIt is up to UE implementation to determine which active PDN connection is transferred from S1 mode to N1 mode.\nIf the MME supports EMM-REGISTERED without PDN connection, the UE that transferred all PDN connections to the 5GS, may stay in state EMM-REGISTERED. Otherwise, the UE shall enter state EMM-DEREGISTERED upon transferring all PDN connection to the 5GS.\nNOTE\u00a04:\tWhen the UE has registered in both N1 mode and S1 mode, it is up to UE implementation to maintain the registration update to date in both N1 mode and S1 mode.\nSee subclause\u00a06.1.4 for coordination between 5GSM and ESM.\nSee subclause\u00a04.8.2.3.2 for interworking between TNGF or N3IWF connected to 5GCN and E-UTRAN.\n4.8.4\tCore Network selection for UEs not using CIoT 5GS optimizations\nIf the UE is capable of both N1 mode and S1 mode, when the UE needs to use one or more functionalities not supported in 5GS but supported in EPS and the UE is in 5GMM-IDLE mode, the UE may disable the N1 mode capability for 3GPP access (see subclause\u00a04.9.2).\nIf the UE is capable of both N1 mode and S1 mode and lower layers provide an indication that the current E-UTRA cell is connected to both EPC and 5GCN without also providing an indication that a target core network type was received from the NG-RAN, the UE shall select a core network type (EPC or 5GCN) based on the PLMN selection procedures as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] and provide the selected core network type information to the lower layer during the initial registration procedure.\nIf the UE is capable of both N1 mode and S1 mode and the lower layers have provided an indication that the current E-UTRA cell is connected to both EPC and 5GCN and an indication of whether the network supports IMS emergency services via either EPC or 5GCN or both (see 3GPP\u00a0TS\u00a036.331\u00a0[25A]), the UE selects a core network type (EPC or 5GCN) as specified in 3GPP\u00a0TS\u00a023.167\u00a0[6] annex\u00a0H.2 for initiating emergency calls when in the state 5GMM-DEREGISTERED.LIMITED-SERVICE or EMM-DEREGISTERED.LIMITED-SERVICE.\nNOTE\u00a01:\tIf the PLMN selection information provisioned in the USIM does not contain any prioritization between E-UTRAN and NG-RAN for a PLMN, which core network type to select for that PLMN is up to UE implementation.\nIf the UE is capable of both N1 mode and S1 mode and lower layers provide an indication that the current E-UTRA cell is connected to both EPC and 5GCN with:\n1)\tan indication that target core network type EPC was received from the NG-RAN, the UE shall select the EPC and proceed with the appropriate EMM procedure as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15]; or\n2)\tan indication that target core network type 5GCN was received from the NG-RAN, the UE shall select the 5GCN and proceed with the appropriate 5GMM procedure.\nNOTE\u00a02:\tThe NG-RAN can provide a target core network type to the UE during RRC connection release with redirection (see 3GPP\u00a0TS\u00a036.331\u00a0[25A] and 3GPP\u00a0TS\u00a038.331\u00a0[30]).\n4.8.4A\tCore Network selection and redirection for UEs using CIoT optimizations\n4.8.4A.1\tCore network selection\nA UE that supports CIoT optimizations performs core network selection (i.e. it selects EPC or 5GCN) if the lower layers have provided an indication that the current E-UTRA cell is connected to both EPC and 5GCN as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8].\nWhen selecting a PLMN as described in 3GPP\u00a0TS\u00a023.122\u00a0[5], the UE shall select a core network type (EPC or 5GCN) based on:\na)\tindication from the lower layers about the CIoT EPS optimizations supported in EPC;\nb)\tindication from the lower layers about the CIoT 5GS optimizations supported in 5GCN;\nc)\tthe CIoT EPS optimizations supported by the UE;\nd)\tthe CIoT 5GS optimizations supported by the UE;\ne)\tthe UE's preferred CIoT network behaviour for EPC; and\nf)\tthe UE's preferred CIoT network behaviour for 5GCN.\nThe UE shall provide the selected core network type information to the lower layer during the initial registration procedure.\n4.8.4A.2\tRedirection of the UE by the core network\nThe network that supports CIoT optimizations can redirect a UE between EPC and 5GCN as specified in subclause\u00a05.31.3 of 3GPP\u00a0TS\u00a023.501\u00a0[8]. The network can take into account the UE's N1 mode capability or S1 mode capability, the CIoT network behaviour supported and preferred by the UE or the CIoT network behaviour supported by the network to determine the redirection.\nNOTE:\tIt is assumed that the network would avoid redirecting the UE back and forth between EPC and 5GCN.\nThe network redirects the UE to EPC by rejecting the registration request or service request with the 5GMM cause #31 \"Redirection to EPC required\" as specified in subclause\u00a05.5.1.2.5,\u00a05.5.1.3.5 and\u00a05.6.1.5. Upon receipt of reject message, the UE disables the N1 mode capability for 3GPP access as specified in subclause\u00a04.9.2 and enables the E-UTRA capability if it was disabled in order to move to EPC.\nWhen there is no ongoing registration procedure or service request procedure for a UE in 5GMM-CONNECTED mode, if the AMF determines to redirect the UE to EPC, the AMF shall initiate the generic UE configuration update procedure to indicate registration requested and release of the N1 NAS signalling connection not requested as described in subclause\u00a05.4.4. The network then redirects the UE to EPC by rejecting the registration request as specified in subclause\u00a05.5.1.3.5.\nThe network that supports CIoT optimizations can also redirect a UE from EPC to 5GCN as specified in subclause\u00a05.3.19.2 of 3GPP\u00a0TS\u00a024.301\u00a0[15].\n4.9\tDisabling and re-enabling of UE's N1 mode capability\n4.9.1\tGeneral\nThe UE shall re-enable the N1 mode capability when the UE powers off and powers on again, the USIM is removed or an entry of the \"list of subscriber data\" with the SNPN identity of the SNPN is updated.\n4.9.2\tDisabling and re-enabling of UE's N1 mode capability for 3GPP access\nThe UE shall only disable the N1 mode capability for 3GPP access when in 5GMM-IDLE mode.\nWhen the UE is disabling the N1 mode capability for 3GPP access for a PLMN not due to redirection to EPC, it should proceed as follows:\na)\tselect an E-UTRA cell connected to EPC, or for the UE which supports CIoT EPS optimization select a satellite E-UTRA cell connected to EPC via \"WB-E-UTRAN(LEO)\", \"WB-E-UTRAN(MEO)\", or \"WB-E-UTRAN(GEO)\", of the registered PLMN or a PLMN from the list of equivalent PLMNs, if the UE supports S1 mode and the UE has not disabled its E-UTRA capability as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15];\nb)\tif an E-UTRA cell connected to EPC, or for the UE which supports CIoT EPS optimization if a satellite E-UTRA cell connected to EPC via \"WB-E-UTRAN(LEO)\", \"WB-E-UTRAN(MEO)\", or \"WB-E-UTRAN(GEO)\", of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, the UE does not support S1 mode or the UE has disabled its E-UTRA capability as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15], the UE may select another RAT of the registered PLMN or a PLMN from the list of equivalent PLMNs that the UE supports;\nc)\tif another RAT of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, then enter the state 5GMM-REGISTERED.PLMN-SEARCH or 5GMM-DEREGISTERED.PLMN-SEARCH, or the UE does not have a registered PLMN, then enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and perform PLMN selection as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5]. If disabling of the N1 mode capability for 3GPP access was not due to a UE-initiated de-registration procedure for 5GS services over 3GPP access not due to switch-off, the UE may re-enable the N1 capability for this PLMN selection. As an implementation option, if the UE does not have a registered PLMN, instead of performing PLMN selection, the UE may select another RAT of the selected PLMN if the UE has chosen a PLMN and the RAT is supported by the UE; or\nd)\tif no other allowed PLMN and RAT combinations are available, then the UE may re-enable the N1 mode capability for 3GPP access and indicate to lower layers to remain camped in NG-RAN of the registered PLMN, and may periodically scan for another PLMN and RAT combination which can provide EPS services or non-EPS services (if the UE supports EPS services or non-EPS services). How this periodic scanning is done, is UE implementation dependent.\nWhen the UE is disabling the N1 mode capability for 3GPP access for an SNPN, it should proceed as follows:\na)\tenter the state 5GMM-REGISTERED.PLMN-SEARCH or 5GMM-DEREGISTERED.PLMN-SEARCH and perform SNPN selection as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5]. If disabling of the N1 mode capability for 3GPP access was not due to a UE-initiated de-registration procedure for 5GS services over 3GPP access not due to switch-off, the UE may re-enable the N1 capability for this SNPN selection; or\nb)\tif no other SNPN is available, then the UE may re-enable the N1 mode capability for 3GPP access and indicate to lower layers to remain camped in NG-RAN of the registered SNPN.\nWhen the UE is disabling the N1 mode capability upon receiving cause value #31 \"Redirection to EPC required\" as specified in subclauses\u00a05.5.1.2.5, 5.5.1.3.5 and 5.6.1.5, it should proceed as follows:\na)\tIf the UE is in NB-N1 mode:\n1)\tif lower layers do not provide an indication that the current E-UTRA cell is connected to EPC or lower layers do not provide an indication that the current E-UTRA cell supports CIoT EPS optimizations that are supported by the UE, search for a suitable NB-IoT cell connected to EPC according to 3GPP\u00a0TS\u00a036.304\u00a0[25C];\n2)\tif lower layers provide an indication that the current E-UTRA cell is connected to EPC and the current E-UTRA cell supports CIoT EPS optimizations that are supported by the UE, perform a core network selection to select EPC as specified in subclause\u00a04.8.4A.1; or\n3)\tif lower layers cannot find a suitable NB-IoT cell connected to EPC or there is no suitable NB-IoT cell connected to EPC which supports CIoT EPS optimizations that are supported by the UE, the UE, as an implementation option, may indicate to lower layers to remain camped in E-UTRA cell connected to 5GCN, may then start an implementation-specific timer and enter the state 5GMM-REGISTERED.LIMITED-SERVICE. The UE may may re-enable the N1 mode capability for 3GPP access at expiry of the implementation-specific timer, if the timer had been started, and may then proceed with the appropriate 5GMM procedure.\nb)\tIf the UE is in WB-N1 mode:\n1)\tif lower layers do not provide an indication that the current E-UTRA cell is connected to EPC or lower layers do not provide an indication that the current E-UTRA cell supports CIoT EPS optimizations that are supported by the UE, search for a suitable E-UTRA cell connected to EPC, or for the UE which supports CIoT EPS optimization select a satellite E-UTRA cell connected to EPC via \"WB-E-UTRAN(LEO)\", \"WB-E-UTRAN(MEO)\", or \"WB-E-UTRAN(GEO)\", according to 3GPP\u00a0TS\u00a036.304\u00a0[25C];\n2)\tif lower layers provide an indication that the current E-UTRA cell is connected to EPC and the current E-UTRA cell supports CIoT EPS optimizations that are supported by the UE, then perform a core network selection to select EPC as specified in subclause\u00a04.8.4A.1; or\n3)\tif lower layers cannot find a suitable E-UTRA cell connected to EPC, or if the lower layers cannot find a suitable satellite E-UTRA cell via \"WB-E-UTRAN(LEO)\", \"WB-E-UTRAN(MEO)\", or \"WB-E-UTRAN(GEO)\", or there is no suitable E-UTRA cell connected to EPC, or there is no suitable satellite E-UTRA cell connected to EPC via \"WB-E-UTRAN(LEO)\", \"WB-E-UTRAN(MEO)\", or \"WB-E-UTRAN(GEO)\", which supports CIoT EPS optimizations that are supported by the UE, the UE, as an implementation option, may indicate to lower layers to remain camped in E-UTRA cell connected to 5GCN, may then start an implementation-specific timer and enter the state 5GMM-REGISTERED.LIMITED-SERVICE. The UE may re-enable the N1 mode capability for 3GPP access at expiry of the implementation-specific timer, if the timer had been started, and may then proceed with the appropriate 5GMM procedure.\nWhen the UE supporting both N1 mode and S1 mode needs to stay in E-UTRA connected to EPC (e.g. due to the domain selection for UE originating sessions as specified in subclause\u00a04.3.2), in order to prevent unintentional handover or cell reselection from E-UTRA connected to EPC to NG-RAN connected to 5GCN, the UE operating in single-registration mode shall disable the N1 mode capability for 3GPP access and:\na)\tshall set the N1mode bit to \"N1 mode for 3GPP access not supported\" in the UE network capability IE (see 3GPP\u00a0TS\u00a024.301\u00a0[15]) of the ATTACH REQUEST message and the TRACKING AREA UPDATE REQUEST message in EPC; and\nb)\tthe UE NAS layer shall indicate the access stratum layer(s) of disabling of the N1 mode capability for 3GPP access.\nIf the UE is required to disable the N1 mode capability for 3GPP access and select E-UTRA or another RAT, and the UE is in the 5GMM-CONNECTED mode,\n-\tif the UE has a persistent PDU session, then the UE waits until the radio bearer associated with the persistent PDU session has been released;\n-\totherwise the UE shall locally release the established NAS signalling connection;\nand enter the 5GMM-IDLE mode before selecting E-UTRA or another RAT.\nIf the UE is disabling its N1 mode capability for 3GPP access before selecting E-UTRA or another RAT, the UE shall not perform the UE-initiated de-registration procedure of subclause\u00a05.5.2.2.\nThe UE shall re-enable the N1 mode capability for 3GPP access when the UE performs PLMN selection, SNPN selection or SNPN selection for onboarding services over 3GPP access, unless\n-\tdisabling of the N1 mode capability for 3GPP access was due to a UE-initiated de-registration procedure for 5GS services over 3GPP access not due to switch-off; or\n-\tthe UE has already re-enabled the N1 mode capability for 3GPP access when performing items c) or d) above ; or\n-\tthe UE disables the N1 mode capability for 3GPP access for cases described in subclauses\u00a05.5.1.2.7 and 5.5.1.3.7.\nIf the disabling of N1 mode capability for 3GPP access was due to IMS voice is not available over 3GPP access and the UE's usage setting is \"voice centric\", the UE shall re-enable the N1 mode capability for 3GPP access when the UE's usage setting is changed from \"voice centric\" to \"data centric\", as specified in subclauses\u00a04.3.3.\nThe UE should memorize the identity of the PLMN or SNPN where N1 mode capability for 3GPP access was disabled and should use that stored information in subsequent PLMN or SNPN selections as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5].\nIf the disabling of N1 mode capability for 3GPP access was due to successful completion of an emergency services fallback, the criteria to enable the N1 mode capability again are UE implementation specific.\nThe UE shall disable the N1 mode capability for 3GPP access if requested by the upper layers (e.g. see subclause\u00a0U.2.2.6.4 in 3GPP\u00a0TS\u00a024.229\u00a0[14]). If the UE disabled the N1 mode capability for 3GPP access based on the request from the upper layers (e.g. see subclause\u00a0U.2.2.6.4 in 3GPP\u00a0TS\u00a024.229\u00a0[14]), the criteria to re-enable the N1 mode capability for 3GPP access after the completion of an emergency service are UE implementation specific.\nIf the N1 mode capability for 3GPP access was disabled due to the UE initiated de-registration procedure for 3GPP access or for 3GPP access and non-3GPP access and the UE is operating in single-registration mode (see subclause\u00a05.5.2.2.3), upon request of the upper layers to re-register for 5GS services over 3GPP access or the UE needs to come out of unavailability period and resume normal services, the UE shall enable the N1 mode capability for 3GPP access again.\nAs an implementation option, the UE may start a timer for enabling the N1 mode capability for 3GPP access when the UE's registration attempt counter reaches 5 and the UE disables the N1 mode capability for 3GPP access for cases described in subclauses\u00a05.5.1.2.7 and 5.5.1.3.7. The UE should memorize the identity of the PLMNs or SNPNs where N1 mode capability for 3GPP access was disabled. On expiry of this timer:\n-\tif the UE is in Iu mode or A/Gb mode and is in idle mode as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13], the UE should enable the N1 mode capability for 3GPP access;\n-\tif the UE is in Iu mode and a PS signalling connection exists, but no RR connection exists, the UE may abort the PS signalling connection before enabling the N1 mode capability for 3GPP access; or\n-\tif the UE is in S1 mode and is in EMM-IDLE mode as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15], the UE should enable the N1 mode capability for 3GPP access; and\n-\tif the UE is in Iu mode or A/Gb mode and an RR connection exists, the UE should delay enabling the N1 mode capability for 3GPP access until the RR connection is released. If the UE is in S1 mode and is in EMM-CONNECTED mode as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15], the UE should delay enabling the N1 mode capability for 3GPP access until the NAS signalling connection in S1 mode is released.\nWhen the UE enables the N1 mode capability for 3GPP access, the UE shall remove the PLMN or SNPN from the memorized identity of the PLMNs or SNPNs where N1 mode capability for 3GPP access was disabled.\nNOTE\u00a01:\tAs described in 3GPP TS 23.122 [5], if the UE is in automatic PLMN selection mode or automatic SNPN selection mode, the UE does not consider the memorized PLMNs as PLMN selection candidates for NG-RAN access technology or the memorized SNPN as SNPN selection candidates till the timer expires.\nThe UE may disable the N1 mode capability for currently camped PLMN or SNPN over 3GPP access (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) if no network slice is available for the camped PLMN or SNPN (see subclauses\u00a05.5.1.2.5 and 5.5.1.3.5). If the disabling of N1 mode capability for 3GPP access was due to no network slices available, the UE should memorize the identity of the PLMN or SNPN where N1 mode is disabled due to no available network slices or the list of SNPNs where N1 mode is disabled due to no available network slices, respectively. As an implementation option, the UE may start a timer TNSU for enabling the N1 mode capability that was disabled due to no available network slices for the 3GPP access. The value of timer TNSU is UE implementation specific. The UE should remove the memorized identity of the PLMNs or SNPNs where N1 mode is disabled due to no available network slice upon:\n-\tthe expiry of the timer TNSU; or\n-\treceiving REGISTRATION ACCEPT message containing the Network slicing indication IE with the Network slicing subscription change indication set to \u201cNetwork slicing subscription changed\u201d. \nIf the UE receives ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message provided with S-NSSAI and the PLMN ID in the Protocol configuration options IE or Extended protocol configuration options IE (see subclause\u00a06.5.1.3 of 3GPP\u00a0TS\u00a024.301\u00a0[15]), the UE may remove the PLMN ID from the memorized identity of the PLMNs where N1 mode is disabled due to no available network slices.\nIf the UE attempts to establish an emergency PDU session in a PLMN where N1 mode capability was disabled due to the UE's registration attempt counter have reached\u00a05, the UE may enable N1 mode capability for that PLMN memorized by the UE.\nNOTE\u00a02:\tIf N1 mode capability is disabled due to the UE's registration attempt counter reaches\u00a05, the value of the timer for re-enabling N1 mode capability is recommended to be the same as the value of T3502 which follows the handling specified in subclause\u00a05.3.8. If the value of T3502 is indicated as zero by the network, an implementation specific non-zero value can be used for the timer for re-enabling N1 mode capability.\nIf the UE supports access to an SNPN providing access for localized services in SNPN and access for localized services in SNPN is enabled, then:\n-\tthe UE may re-enable the N1 mode capability for 3GPP access if disabled for that SNPN when:\n1)\tthe validity information of the SNPN contained in the \"credentials holder controlled prioritized list of preferred SNPNs for access for localized services in SNPN\" changes from not met to met; or\n2)\tthe validity information of a GIN broadcasted by an SNPN contained in the \"credentials holder controlled prioritized list of preferred GINs for access for localized services in SNPN\" changes from not met to met; and\n-\tthe UE need not re-enable N1 mode capability for 3GPP access for that SNPN if the N1 mode capability for 3GPP access for that SNPN was disabled due to 5GMM cause value #27 (N1 mode not allowed).\nNOTE\u00a03:\tIf the UE receives a reject message with a 5GMM cause value and the N1 mode capability is disabled again for the SNPN, it is up to UE implementation whether to re-enable N1 mode capability for the SNPN if the validity information of the SNPN is still met.\n4.9.3\tDisabling and re-enabling of UE's N1 mode capability for non-3GPP access\nWhen the UE disables the N1 mode capability for non-3GPP access, the UE NAS layer shall not initiate any 5GS NAS procedures towards the network over non-3GPP access.\nWhen the UE supporting both N1 mode and S1 mode needs to stay in non-3GPP access connected to EPC (e.g. due to the domain selection for UE originating sessions as specified in subclause\u00a04.3.2), in order to prevent unintentional selection of a non-3GPP access network connected to 5GCN, the UE operating in single-registration mode shall not transfer any PDN connection to a non-3GPP access network connected to the 5GCN.\nIf the disabling of N1 mode capability for non-3GPP access was due to IMS voice is not available over non-3GPP access in 5GS and the UE's usage setting is \"voice centric\", the UE shall re-enable the N1 mode capability for non-3GPP access when the UE's usage setting is changed from \"voice centric\" to \"data centric\" as specified in subclauses\u00a04.3.3.\nThe UE shall re-enable the N1 mode capability for non-3GPP access when a new PLMN or SNPN is selected over non-3GPP access.\nThe UE may disable the N1 mode capability for the currently camped PLMN or SNPN over non-3GPP access if no network slice is available for the camped PLMN or SNPN.\nAs an implementation option, the UE may start a timer for re-enabling the N1 mode capability for non-3GPP access, after the N1 mode capability for non-3GPP access was disabled. On the expiry of this timer, the UE should re-enable the N1 mode capability for non-3GPP access.\n4.10\tInterworking with ePDG connected to EPC\nIn order to interwork with ePDG connected to EPC, the UE shall operate as specified in either subclause\u00a04.8.2.3 or subclause\u00a04.8.3. Which subclause the UE follows is chosen by the UE irrespective of the interworking without N26 interface indicator.\nThe UE shall not attempt to transfer PDU sessions with PDU session type \"Ethernet\" or \"Unstructured\" to an ePDG connected to EPC.\nNOTE\u00a01:\tPDU sessions with PDU session type \"Ethernet\" or \"Unstructured\" cannot be transferred to an ePDG connected to EPC because PDN connections with PDN type \"non-IP\" or PDN type \"Ethernet\" are not supported over ePDG connected to EPC.\n\n4.11\tUE configuration parameter updates\nThe 5GS in a PLMN supports updating UE parameters via NAS signalling. The feature enables the HPLMN to securely and dynamically re-configure the UE configuration parameters stored on the USIM and the ME.\n-\tIn this release of the specification, updates of the following USIM configuration parameters are supported:\n-\trouting indicator.\n-\tIn this release of specification, updates of the following ME configuration parameters are supported:\n-\tdefault configured NSSAI.\n-\tdisaster roaming information.\nThe 5GS in an SNPN supports updating UE parameters via NAS signalling. The feature enables the SNPN to securely and dynamically re-configure the UE configuration parameter stored on the USIM if the UE used the USIM for registration to the SNPN.\n-\tIn this release of the specification, updates of the following USIM configuration parameters are supported:\n-\trouting indicator.\n-\tIn this release of specification, updates of the following ME configuration parameters are supported:\n-\trouting indicator.\n-\tdefault configured NSSAI.\nThe update of UE configuration parameters is initiated by the network using the network-initiated downlink NAS transport procedure as described in subclause\u00a05.4.5.3. The ME acknowledgement of successful reception of the updated UE configuration parameter information is sent back to the network using the UE-initiated uplink NAS transport procedure as described in subclause\u00a05.4.5.2.\n4.12\tAccess traffic steering, switching and splitting (ATSSS)\nThe ATSSS feature is an optional feature that may be supported by the UE and the 5GCN.\nThe ATSSS feature enables a multi-access PDU connectivity service, which can exchange PDUs between the UE and a data network by simultaneously using one 3GPP access network and one non-3GPP access network. The multi-access PDU connectivity service is realized by establishing a multi-access PDU session, i.e. a PDU session that can have user-plane resources on two access networks.\nNOTE\u00a01:\tMA PDU session is not applicable for CIoT 5GS optimization in this release of specification.\nThe UE can request an MA PDU session when the UE is registered via both 3GPP and non-3GPP accesses, or when the UE is registered via one access only. The MA PDU session management is performed based on the PDU session management procedures.\nThe detailed description of the procedures for ATSSS between the UE and the network across one 3GPP access network and one non-3GPP access network are specified in 3GPP\u00a0TS\u00a024.193\u00a0[13B].\nNOTE\u00a02:\tIn this version of the specification, PDU set handling is not supported in an MA PDU session.\n4.13\tSupport of NAS signalling using wireline access network\nA 5G-RG, a W-AGF acting on behalf of an FN-RG or a W-AGF acting on behalf of an N5GC device can use wireline access network to access the 5GCN by using NAS signalling procedures as described in 3GPP\u00a0TS\u00a023.501\u00a0[8], 3GPP\u00a0TS\u00a023.502\u00a0[9] and 3GPP\u00a0TS\u00a023.316\u00a0[6D].\nWireline access is a type of non-3GPP access.\nA 5G-RG simultaneously connected to the same 5GCN of a PLMN over a 3GPP access and a wireline access is connected to a single AMF.\n5G-RG maintains the N1 NAS signalling connection with the AMF over the wireline access network after all the PDU sessions for the 5G-RG over that access have been released or handed over to 3GPP access.\nThe 5G-RG connected to 5GCN via NG-RAN is specified in 3GPP\u00a0TS\u00a023.316\u00a0[6D].\nWhen accessing the 5GCN over 3GPP access, in addition to requirements specified for the 5G-RG in the present document, the 5G-RG shall also perform requirements specified in the present document for a UE accessing 5GCN over 3GPP access. When accessing the 5GCN over wireline access, in addition to requirements specified for the 5G-RG in the present document, the 5G-RG shall also perform requirements specified in the present document for a UE accessing 5GCN over non-3GPP access. If a requirement specified for the 5G-RG in the present document contradicts a requirement specified for the UE in the present document, the 5G-RG shall perform the requirement specified in the present document for the 5G-RG.\nFor the scenario of FN-RG, which does not support N1 mode, the W-AGF acting on behalf of the FN-RG exchanges NAS signalling messages with an AMF.\nFor the scenario of N5GC device, which does not support N1 mode, the W-AGF acting on behalf of the N5GC device exchanges NAS signalling messages with an AMF.\nFor the scenario of AUN3 device, which does not support N1 mode, the 5G-RG acting on behalf of the AUN3 device exchanges NAS signalling messages with an AMF. If the 5G-RG is not registered and connected to the 5GCN over wireline access, the 5G-RG acting on behalf of an AUN3 device shall not initiate the initial registration procedure on behalf of the AUN3 device.\nNOTE\u00a01:\tThe 5G-RG acting on behalf of an AUN3 device maintains a 5GMM context for each AUN3 device behind it. The AMF maintains a 5GMM context for each AUN3 device. The AMF is not aware of any association between the 5GMM context of the 5G-RG and the 5GMM context of the AUN3 device.\nWhen the 5G-RG acting on behalf of an AUN3 device initiates the initial registration procedure on behalf of the AUN3 device, the 5G-RG shall not include the requested NSSAI in the REGISTRATION REQUEST message.\nFor the scenario of NAUN3 device, which does not support N1 mode, the 5G-RG acting on behalf of a connectivity group consisting of one or more NAUN3 devices exchanges NAS signalling messages with an AMF.\nNOTE\u00a02:\tIt is also possible for 5G-RG that is connected to 5GCN via NG-RAN to act on behalf of a connectivity group consisting of one or more NAUN3 devices as specified in 3GPP\u00a0TS\u00a023.316\u00a0[6D].\nIn addition to requirements specified for the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) in the present document, the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) shall also perform requirements specified in the present document for a UE accessing 5GCN over non-3GPP access. If a requirement specified for the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) in the present document contradicts a requirement specified for the UE in the present document, the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) shall perform requirement specified in the present document for the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device).\nThe PDU session authentication and authorization procedure is not supported in a PDU session established by the W-AGF acting on behalf of the FN-RG or on behalf of the N5GC device.\nThe W-AGF acting on behalf of the N5GC device requests the establishment of a PDU Session on behalf of the N5GC device upon registration. Only one PDU session per N5GC device is supported.\nThe 5G-RG acting on behalf of an AUN3 device requests the establishment of a PDU Session on behalf of the AUN3 device upon registration. Only one PDU session per AUN3 is supported.\nThe 5G-RG acting on behalf of a connectivity group consisting of one or more NAUN3 devices requests the establishment of a PDU Session on behalf of the connectivity group. Only one PDU session per the connectivity group is supported, where all the NAUN3 devices in the connectivity group share the same PDU session.\nA 5G-RG or an FN-RG provide a non-3GPP access network to UEs. A UE connected to a non-3GPP access network provided by the 5G-RG or the FN-RG can access to the 5GCN via the N3IWF or via the TNGF as described in 3GPP\u00a0TS\u00a023.316\u00a0[6D].\nThe 5G-RG or the W-AGF acting on behalf of the FN-RG shall indicate \"ANDSP not supported by the UE\" in the UE policy classmark IE during the UE-initiated UE state indication procedure as specified in subclause\u00a0D.2.2.\nThe 5G-RG or the W-AGF acting on behalf of the FN-RG shall indicate \"Reporting URSP rule enforcement not supported by the UE\" in the UE policy classmark IE during the UE-initiated UE state indication procedure as specified in subclause\u00a0D.2.2.\nThe Non-3GPP QoS Assistance Information (N3QAI) is introduced to enable a 5G-RG to perform the QoS differentiation for the UE behind the 5G-RG, the AUN3 device behind the 5G-RG or the NAUN3 device behind the 5G-RG. The network may provide the N3QAI associated with the QoS flow during the PDU session establishment procedure as defined in subclause\u00a06.4.1 or during the PDU session modification procedure as defined in subclause\u00a06.4.2.\nNOTE\u00a03:\tHow the 5G-RG applies N3QAI is outside the scope of the present document.\nIf the AMF receives an indication from the W-AGF that there is no 5G-RG connected to the same wireline for an AUN3 device as specified in 3GPP\u00a0TS\u00a023.316\u00a0[6D], the AMF shall locally de-register the AUN3 device.\n4.14\tNon-public network (NPN)\n4.14.1\tGeneral\nTwo types of NPN can be deployed using 5GS: SNPN (see subclause\u00a04.14.2) and PNI-NPN (see subclause\u00a04.14.3).\n4.14.2\tStand-alone non-public network (SNPN)\nIf the UE is not SNPN enabled, the UE is always considered to be not operating in SNPN access operation mode. If the UE is SNPN enabled, the UE can operate in SNPN access operation mode. Details of activation and deactivation of SNPN access operation mode at the SNPN-enabled UE are up to UE implementation.\nThe functions and procedures of NAS described in the present document are applicable to an SNPN and an SNPN-enabled UE unless indicated otherwise. The key differences brought by the SNPN to the NAS layer are as follows:\na)\tinstead of the PLMN selection process, the SNPN selection process is performed by a UE operating in SNPN access operation mode (see 3GPP\u00a0TS\u00a023.122\u00a0[5] and 3GPP\u00a0TS\u00a024.502\u00a0[18] for further details on the SNPN selection);\nb)\ta \"permanently forbidden SNPNs\" list and a \"temporarily forbidden SNPNs\" list are managed per access type independently (i.e. 3GPP access or non-3GPP access) and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, per entry of the \"list of subscriber data\" or, if the UE supports access to an SNPN using credentials from a credentials holder, per the PLMN subscription, by a UE operating in SNPN access operation mode instead of forbidden PLMN lists. If the UE supports onboarding services in SNPN, an additional \"permanently forbidden SNPNs\" list for onboarding services and an additional \"temporarily forbidden SNPNs\" list for onboarding services are managed. If the UE supports access to an SNPN providing access for localized services in SNPN, an additional \"permanently forbidden SNPNs for access for localized services in SNPN\" list and an additional \"temporarily forbidden SNPNs for access for localized services in SNPN\" list per entry of the \"list of subscriber data\" and per the PLMN subscription are managed for 3GPP access only. These lists shall be maintained across activation and deactivation of SNPN access operation mode;\nNOTE\u00a00:\tOn timer T3245 expiry when the UE supports access to an SNPN using credentials from a credentials holder using PLMN subscription, and the UE is not operating in SNPN access operation mode, as an implementation option the UE can delete the list of \"temporarily forbidden SNPNs\" and \"permanently forbidden SNPNs\" and additionally the list of \"permanently forbidden SNPNs for access for localized services in SNPN\" and list of \"temporarily forbidden SNPNs for access for localized services in SNPN\" if the UE supports access to an SNPN providing access for localized services in SNPN.\nc)\tinter-system change to and from S1 mode is not supported;\nd)\tvoid;\ne)\tCAG is not supported in SNPN access operation mode;\nf)\twith respect to the 5GMM cause values:\n1)\t5GMM cause values #74 \"Temporarily not authorized for this SNPN\" and #75 \"Permanently not authorized for this SNPN\" are supported whereas these 5GMM cause values cannot be used in a PLMN; and\n2)\t5GMM cause values #11 \"PLMN not allowed\", #31 \"Redirection to EPC required\", #73 \"Serving network not authorized\", and #76 \"Not authorized for this CAG or authorized for CAG cells only\" are not supported whereas these 5GMM cause values can be used in a PLMN;\ng)\ta list of \"5GS forbidden tracking areas for roaming\" and a list of \"5GS forbidden tracking areas for regional provision of service\" are managed per SNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, entry of the \"list of subscriber data\" or, if the UE supports access to an SNPN using credentials from a credentials holder,PLMN subscription (see 3GPP\u00a0TS\u00a023.122\u00a0[5]);\nh)\twhen accessing SNPN services via a PLMN using 3GPP access, access to 5GCN of the SNPN is performed using 5GMM procedures for non-3GPP access, 5GMM parameters for non-3GPP access, the UE is performing access to SNPN over non-3GPP access and the UE is not operating in SNPN access operation mode over 3GPP access. When accessing PLMN services via a SNPN using 3GPP access, access to 5GCN of the PLMN is performed using 5GMM procedures for non-3GPP access, 5GMM parameters for non-3GPP access, the UE is not performing access to SNPN over non-3GPP access, and the UE is operating in SNPN access operation mode over 3GPP access. From the UE's NAS perspective, accessing PLMN services via an SNPN and accessing SNPN services via a PLMN are treated as untrusted non-3GPP access. If the UE is accessing the PLMN using non-3GPP access, the access to 5GCN of the SNPN via PLMN is not specified in this release of the specification .\n\tEmergency services are not supported in an SNPN when a UE accesses SNPN services via a PLMN;\ni)\twhen registered to an SNPN, the UE shall use only the UE policies provided by the registered SNPN;\nj)\tinclusion of a TAI of an SNPN other than the registered SNPN, into the registration area is not supported. The AMF of an SNPN shall only include into the registration area one or more TAIs of the registered SNPN;\nj1)\tinclusion of a TAI of an SNPN other than the registered SNPN, into the LADN service area is not supported. The AMF of an SNPN shall only include one or more TAIs of the registered SNPN into the LADN service area;\nj2)\tinclusion of a TAI of an SNPN other than the registered SNPN, into the allowed area or the non-allowed area, of the 3GPP access service area restrictions is not supported. The AMF of an SNPN shall include only one or more TAIs of the registered SNPN into the allowed area or the non-allowed area, of the 3GPP access service area restrictions;\nk)\tvoid;\nl)\tvoid;\nm)\tUE mobility between SNPNs in 5GMM-CONNECTED mode is supported when the SNPNs are equivalent SNPNs for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. UE mobility between SNPNs in 5GMM-IDLE mode is supported when the UE supports access to an SNPN using credentials from a credentials holder or when the SNPNs are equivalent SNPNs or both for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. UE mobility between an SNPN and a PLMN is not supported;\nn)\tCIoT 5GS optimizations are not supported;\no)\tvoid;\np)\twhen registering or registered to an SNPN, the UE shall handle the 5GS mobile identity as described in subclause\u00a05.5.1.2.2;\nq)\twhen registering or registered to an SNPN, the UE shall only consider:\n1)\ta last visited registered TAI visited in the same SNPN as an available last visited registered TAI; or\n2)\ta last visited registered TAI visited using the same entry of the \"list of subscriber data\" or the same PLMN subscription as an available last visited registered TAI, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both;\nNOTE\u00a01:\tIf the last visited registered TAI is assigned by an SNPN other than the current SNPN, the serving AMF can determine the SNPN assigning the last visited registered TAI using the NID provided by the UE.\nr)\temergency service fallback is not supported;\ns)\twhen registering or registered for onboarding services in SNPN, the UE shall not provide the requested NSSAI to the network;\ns1)\twhen performing initial registration for onboarding services in SNPN, the UE shall set the 5GS registration type value to \"SNPN onboarding registration\";\nt)\twhen registering or registered for onboarding services in SNPN, the AMF shall not provide the configured NSSAI, the allowed NSSAI or the rejected NSSAI to the UE, shall use the S-NSSAI included in the AMF onboarding configuration data for onboarding services in SNPN and shall not perform NSSAA procedure for S-NSSAI used for onboarding services in SNPN;\nu)\tthe UE can access an SNPN indicating that onboarding is allowed using default UE credentials for primary authentication in order for the UE to be configured with one or more entries of the \"list of subscriber data\";\nx)\teCall over IMS is not supported in SNPN access operation mode and the UE ignores any USIM configuration for eCall only mode;\ny)\twhen registering or registered for onboarding services in SNPN, the AMF shall store in the 5GMM context of the UE an indication that the UE is registered for onboarding services in SNPN;\nz)\ta UE with multiple valid entries of \"list of subscriber data\", or one or more valid USIMs and one or more valid entries of \"list of subscriber data\", capable of initiating and maintaining simultaneous separate registration states over 3GPP access with PLMN(s) or SNPN(s), using identities and credentials associated with those entries of \"list of subscriber data\", or USIMs and entries of \"list of subscriber data\", and supporting one or more of the N1 NAS signalling connection release, the paging indication for voice services, the reject paging request, the paging restriction and the paging timing collision control may use procedures defined for MUSIM UE, even if the UE does not include multiple valid USIMs;\nza)\twhen the UE is registering or registered for onboarding services in SNPN, the network slice admission control is not performed; \nNOTE\u00a02:\tIf the network determines that the UE cannot register to the onboarding SNPN due to lack of resources for the network slice used for onboarding, the AMF can reject the UE with 5GMM cause #22 \"congestion\".\nzb)\twhen the UE is registered for onboarding services in SNPN (as specified in subclause\u00a03.1), the UE determines that the number dialled is an emergency number, and emergency services are not supported in the SNPN, the UE shall perform a local de-registration and utilize the procedures specified in 3GPP\u00a0TS\u00a023.167\u00a0[45] and 3GPP\u00a0TS\u00a024.229\u00a0[13D] to select a domain for the emergency session attempt; and\nNOTE\u00a04:\tThe UE can select PS domain for emergency session attempt.\nv)\tproximity based services (5G ProSe as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E]) are not supported.\n4.14.3\tPublic network integrated non-public network (PNI-NPN)\nA PNI-NPN is made available by means of e.g. dedicated DNNs or by one or more S-NSSAIs allocated for it. A CAG can be optionally used in order to prevent UEs not allowed to access a PNI-NPN from accessing the PNI-NPN. The key enablers for the CAG in the NAS layer are as follows:\na)\tCAG selection (see 3GPP\u00a0TS\u00a023.122\u00a0[5]); and\nb)\tprovisioning of a \"CAG information list\" as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5], from network to UE via the generic UE configuration update procedure, the registration procedure, the service request procedure, and the network-initiated de-registration procedure.\nThe \"CAG information list\" provisioned by the network, if available, is stored in the non-volatile memory in the ME as specified in annex\u00a0C. The \"CAG information list\" stored in the ME is kept when the UE enters 5GMM-DEREGISTERED state. Annex\u00a0C specifies condition under which the \"CAG information list\" stored in the ME is deleted. Additionally, when a USIM is inserted, if:\n-\tno \"CAG information list\" is stored in the non-volatile memory of the ME; or\n-\tthe SUPI from the USIM does not match the SUPI stored together with the \"CAG information list\" in the non-volatile memory of the ME;\nand the UE has a \"CAG information list\" stored in the USIM (see 3GPP\u00a0TS\u00a031.102\u00a0[22]), the UE shall store the \"CAG information list\" from the USIM into the ME, as specified in annex\u00a0C. The \"Allowed CAG list\" included in the entry for the HPLMN or EHPLMN in \"CAG information list\" stored in the USIM can contain a range of CAG-IDs.\nThe UE supporting CAG may perform the initial registration for emergency services via a non-CAG cell in a PLMN for which the UE has an \"indication that the UE is only allowed to access 5GS via CAG cells\" or via a CAG cell for which none of CAG-ID(s) is authorized based on the \"Allowed CAG list\" (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) for the selected PLMN. If a UE supporting CAG having an emergency PDU session is camping on:\na)\ta CAG cell and none of the CAG-ID(s) of the CAG cell is authorized based on the \"Allowed CAG list\" for the current PLMN in the UE's subscription; or\nb)\ta non-CAG cell in a PLMN for which the UE's subscription contains an \"indication that the UE is only allowed to access 5GS via CAG cells\";\nthe AMF shall behave as specified in subclause\u00a05.4.4.2, 5.5.1.3.4 or 5.6.1.4.1.\nNOTE:\tThe emergency services in a PLMN for which the UE's subscription contains an \"indication that the UE is only allowed to access 5GS via CAG cells\" can be subject to local regulation.\nProximity based services (5G ProSe as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E]) are not supported in this release of the specification when a UE is camping on a CAG cell.\nIf a UE supporting enhanced CAG information is in a CAG cell with a CAG-ID which:\na)\twas authorized based on the \"Allowed CAG list\" associated with the current PLMN in the \"CAG information list\" stored in the ME; and\nb)\tbecomes not authorized based on the \"Allowed CAG list\" (e.g., time validity information no longer matches UE's current time); and\nnone of the CAG-ID(s) supported by the current CAG cell is currently authorized based on the \"Allowed CAG list\" of the entry for the current PLMN in the stored \"CAG information list\", and:\na)\tthe entry for the current PLMN in the \"CAG information list\" does not include an \"indication that the UE is only allowed to access 5GS via CAG cells\", then the UE shall abort ongoing UE initialted 5GMM procedures, if any, locally release the NAS signalling connection, if any, enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the stored \"CAG information list\"; or\nb)\tthe entry for the current PLMN in the stored \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and:\n1)\tone or more CAG-ID(s) are authorized based on the \"Allowed CAG list\" of the entry for the current PLMN in the stored \"CAG information list\", the UE shall abort ongoing UE initialted 5GMM procedures, if any, locally release the NAS signalling connection, if any, enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the stored \"CAG information list\"; or\n2)\tno CAG-ID is authorized based on the \"Allowed CAG list\" of the entry for the current PLMN in the stored \"CAG information list\" and:\ni)\tthe UE does not have an emergency PDU session, then the UE shall abort ongoing UE initialted 5GMM procedures, if any, locally release the NAS signalling connection, if any, enter the state 5GMM-REGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP\u00a0TS\u00a023.122\u00a0[5] with the stored \"CAG information list\"; or\nii)\tthe UE has an emergency PDU session, then the UE shall perform a local release of all PDU sessions associated with 3GPP access except for the emergency PDU session and enter the state 5GMM-REGISTERED.LIMITED-SERVICE;\n4.15\tTime synchronization and time sensitive communication\n4.15.1\tGeneral\nA 5GS can support time synchronization and TSC (see 3GPP\u00a0TS\u00a023.501\u00a0[8], 3GPP\u00a0TS\u00a023.502\u00a0[9], and 3GPP\u00a0TS\u00a023.503\u00a0[10]). This subclause describes NAS-specific aspects of the 5GS features to support time synchronization and TSC. Interworking with EPS is not supported for a PDU session for time synchronization or TSC.\n4.15.2\tVoid\n4.15.2.1\tVoid\n4.15.2.2\tVoid\n4.15.2.3\tVoid\n\n4.15.3\tTime synchronization\nTwo types of synchronization processes are supported by the 5GS: 5GS synchronization and (g)PTP domain synchronization (see 3GPP\u00a0TS\u00a023.501\u00a0[8]).\nFor 5GS synchronization, the lower layers provide the 5G internal system clock signalled via the NG-RAN (see 3GPP\u00a0TS\u00a038.331\u00a0[30]) and the UE forwards the 5G internal system clock to the DS-TT(s).\nFor (g)PTP domain synchronization, the UE supports forwarding (g)PTP messages (see 3GPP\u00a0TS\u00a023.501\u00a0[8], 3GPP\u00a0TS\u00a023.502\u00a0[9], and 3GPP\u00a0TS\u00a024.535\u00a0[19A]). For all (g)PTP domains associated with a PDU session:\na)\tif the UE receives (g)PTP message via the PDU session, the UE forwards the (g)PTP messages to the DS-TT associated with the PDU session; or\nb)\tif the UE receives (g)PTP messages from the DS-TT associated with the PDU session, the UE forwards the (g)PTP messages via the PDU session.\nDepending on the 5G access stratum-based time distribution or (g)PTP-based time distribution, the network timing synchronization status of the nodes involved in the operation (e.g., NG-RAN nodes, NW-TTs) may change. Using the 5GMM protocol, the network can request a supporting UE to reconnect to the network upon receiving an indication of a change in the RAN timing synchronization status.\n4.15.4\tUser plane node management\nA 5G system (5GS) can act as a user plane node of an external network (e.g. IEEE TSN bridge) or a 5GS can be independently used to enable TSC. For these purposes, information available at a UE is provided to the network and port management information containers are exchanged between a DS-TT and a TSN AF or a TSCTSF (see 3GPP\u00a0TS\u00a024.539\u00a0[19BA]).\nDuring a UE-requested PDU session establishment procedure, if the UE supports transfer of port management information containers, then the UE indicates that transfer of port management information container is supported and the UE provides a DS-TT Ethernet port MAC address (if the PDU session type is Ethernet), port management information container, and a UE-DS-TT residence time (if available) to the network (see subclause\u00a06.4.1.2).\nOnce the UE has successfully established a PDU session and the UE has indicated that transfer of port management information container is supported during the UE-requested PDU session establishment procedure (see subclause\u00a06.4.1.2), then port management information containers are exchanged via a UE-requested PDU session modification procedure and a network-requested PDU session modification procedure (see subclauses\u00a06.3.2 and\u00a06.4.2). The UE receiving a port management information container from the network shall forward the port management information container to the DS-TT. The SMF receiving a port management information container from the UE shall operate as described in 3GPP\u00a0TS\u00a023.502\u00a0[9].\n4.16\tUE radio capability signalling optimisation\nUE radio capability signalling optimisation (RACS) is a feature that is optional at both the UE and the network and which aims to optimise the transmission of UE radio capability over the radio interface (see 3GPP\u00a0TS\u00a023.501\u00a0[8]). RACS works by assigning an identifier to represent a set of UE radio capabilities. This identifier is called the UE radio capability ID. A UE radio capability ID can be either manufacturer-assigned or network-assigned. The UE radio capability ID is an alternative to the signalling of the radio capabilities container over the radio interface.\nIn this release of the specification, RACS is applicable to neither NB-N1 mode nor non-3GPP access.\nIf the UE supports RACS:\na)\tthe UE shall indicate support for RACS by setting the RACS bit to \"RACS supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message;\nb)\tif the UE performs a registration procedure for initial registration and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected network, the UE shall include the UE radio capability ID in the UE radio capability ID IE as a non-cleartext IE in the REGISTRATION REQUEST message. If both a network-assigned UE radio capability ID and a manufacturer-assigned UE Radio Capability ID are applicable, the UE shall include the network-assigned UE radio capability ID in the REGISTRATION REQUEST message;\nc)\tif the radio configuration at the UE changes (for instance because the UE has disabled a specific radio capability) then:\n1)\tif the UE has an applicable UE radio capability ID for the new UE radio configuration, the UE shall initiate a registration procedure for mobility and periodic registration update. The UE shall include the applicable UE radio capability ID in the UE radio capability ID IE of the REGISTRATION REQUEST message and shall include the 5GS update type IE in the REGISTRATION REQUEST message with the NG-RAN-RCU bit set to \"UE radio capability update needed\". If both a network-assigned UE radio capability ID and a manufacturer-assigned UE Radio Capability ID are applicable, the UE shall include the network-assigned UE radio capability ID in the REGISTRATION REQUEST message; and\n2)\tif the UE does not have an applicable UE radio capability ID for the new UE radio configuration, the UE shall initiate a registration procedure for mobility and periodic registration update and include the 5GS update type IE in the REGISTRATION REQUEST message with the NG-RAN-RCU bit set to \"UE radio capability update needed\";\nNOTE:\tPerforming the registration procedure for mobility and periodic registration update and including the 5GS update type IE in the REGISTRATION REQUEST message with the NG-RAN-RCU bit set to \"UE radio capability update needed\" without a UE radio capability ID included in the REGISTRATION REQUEST message can trigger the network to assign a new UE radio capability ID to the UE.\nd)\tupon receiving a network-assigned UE radio capability ID in the REGISTRATION ACCEPT message or the CONFIGURATION UPDATE COMMAND message, the UE shall store the network-assigned UE radio capability ID and the PLMN ID or SNPN identity of the serving network and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription along with a mapping to the current UE radio configuration in its non-volatile memory as specified in annex\u00a0C. The UE shall be able to store at least the last 16 received network-assigned UE radio capability IDs with the associated PLMN ID or SNPN identity and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription and the mapping to the corresponding UE radio configuration;\ne)\tthe UE shall not use a network-assigned UE radio capability ID assigned by a PLMN in PLMNs equivalent to the PLMN which assigned it or by an SNPN in SNPNs equivalent to the SNPN which assigned it;\nf)\tupon receiving a UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\" in the REGISTRATION ACCEPT message or the CONFIGURATION UPDATE COMMAND message, the UE shall delete all network-assigned UE radio capability IDs stored at the UE for the serving network, initiate a registration procedure for mobility and periodic registration update and include an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration, if available at the UE, in the UE radio capability ID IE of the REGISTRATION REQUEST message; and\ng)\tif the UE performs a registration procedure for mobility and periodic registration update due to entering a tracking area that is not in the list of tracking areas that the UE previously registered in the AMF and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected network, the UE shall include the UE radio capability ID in the UE radio capability ID IE as a non-cleartext IE in the REGISTRATION REQUEST message. If both a network-assigned UE radio capability ID and a manufacturer-assigned UE Radio Capability ID are applicable, the UE shall include the network-assigned UE radio capability ID in the REGISTRATION REQUEST message.\nIf the network supports RACS:\na)\tthe network may assign a network-assigned UE radio capability ID to a UE which supports RACS by including a UE radio capability ID IE in the REGISTRATION ACCEPT message or in the CONFIGURATION UPDATE COMMAND message;\nb)\tthe network may trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving network by including a UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\" in the REGISTRATION ACCEPT message or in the CONFIGURATION UPDATE COMMAND message; and\nc)\tthe network may send an IDENTITY REQUEST message to the UE that supports RACS to retrieve the PEI, if not available in the network.\n4.17\t5GS mobility management in NB-N1 mode\nA UE in NB-N1 mode (see 3GPP\u00a0TS\u00a036.331\u00a0[25A]) shall calculate the value of the applicable NAS timer indicated in table\u00a010.2.1 plus 240s.\nThe timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not re-calculate the use of the NAS timer value until the NAS procedure is completed, restarted or aborted.\nWhen an AMF that supports NB-N1 mode performs NAS signalling with a UE, which is using NB-N1 mode, the AMF shall calculate the value of the applicable NAS timer indicated in table\u00a010.2.2 plus 240s.\nThe timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not re-calculate the use of the NAS timer value until the NAS procedure is completed, restarted or aborted.\n4.18\t5GS session management in NB-N1 mode\nA UE in NB-N1 mode (see 3GPP\u00a0TS\u00a036.331\u00a0[25A]) shall calculate the value of the applicable NAS timer indicated in table\u00a010.3.1 plus 180s.\nThe timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not re-calculate the use of the NAS timer value until the NAS procedure is completed, restarted or aborted.\nWhen an SMF that supports NB-N1 mode performs NAS signalling with a UE, which is using NB-N1 mode, the SMF shall calculate the value of the applicable NAS timer indicated in table\u00a010.3.2 plus 180s.\nThe timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not re-calculate the use of the NAS timer value until the NAS procedure is completed, restarted or aborted.\n4.19\t5GS mobility management in WB-N1 mode for IoT\nIn WB-N1 mode, a UE operating in category CE can operate in either CE mode A or CE mode B (see 3GPP\u00a0TS\u00a036.306\u00a0[25D]). If a UE that supports CE mode B and operates in WB-N1 mode, the UE's usage setting is not set to \"voice centric\" (see 3GPP\u00a0TS\u00a023.501\u00a0[8]), and:\na)\tthe use of enhanced coverage is not restricted by the network; or\nb)\tCE mode B is not restricted by the network (see 3GPP\u00a0TS\u00a023.501\u00a0[8]);\nthe UE shall apply the value of the applicable NAS timer indicated in table\u00a010.2.1 for WB-N1/CE mode.\nA UE that supports CE mode B and operates in WB-N1 mode shall not apply the value of the applicable NAS timer indicated in table\u00a010.2.1 for WB-N1/CE mode before receiving an indication from the network that the use of enhanced coverage is not restricted, or CE mode B is not restricted, as described in this subclause.\nThe NAS timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure, and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.\nThe support of CE mode B by a UE is indicated to the AMF by lower layers and shall be stored by the AMF. When an AMF that supports WB-N1 mode performs NAS signalling with a UE, which supports CE mode B and operates in WB-N1 mode, the UE's usage setting is not set to \"voice centric\" (see 3GPP\u00a0TS\u00a023.501\u00a0[8]) and the AMF determines that:\na)\tthe use of enhanced coverage is not restricted for the UE; or\nb)\tCE mode B is not restricted for the UE (see 3GPP\u00a0TS\u00a023.501\u00a0[8]);\nthe AMF shall calculate the value of the applicable NAS timer indicated in table\u00a010.2.2 for WB-N1/CE mode.\nThe NAS timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.\n4.20\t5GS session management in WB-N1 mode for IoT\nIn WB-N1 mode, a UE operating in category CE can operate in either CE mode A or CE mode B (see 3GPP\u00a0TS\u00a036.306\u00a0[25D]). If a UE that supports CE mode B and operates in WB-N1 mode and the UE's usage setting is not set to \"voice centric\" (see 3GPP\u00a0TS\u00a023.501\u00a0[8]), and:\na)\tthe use of enhanced coverage is not restricted by the network; or\nb)\tCE mode B is not restricted by the network (see 3GPP\u00a0TS\u00a023.501\u00a0[8]);\nthe UE shall apply the value of the applicable NAS timer indicated in table\u00a010.3.1 for WB-N1/CE mode.\nA UE that supports CE mode B and operates in WB-N1 mode shall not apply the value of the applicable NAS timer indicated in table\u00a010.3.1 for WB-N1/CE mode before receiving an indication from the network that the use of enhanced coverage is not restricted, or CE mode B is not restricted, as described in this subclause.\nThe NAS timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure, and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.\nIf the use of extended NAS timer is indicated by the AMF (see 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a023.502\u00a0[9]), the SMF shall calculate the value of the applicable NAS timer indicated in table\u00a010.3.2 for WB-N1/CE mode.\nThe NAS timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.\n4.21\tAuthentication and Key Management for Applications (AKMA)\nThe UE may support AKMA.\nThe purpose of AKMA is to provide authentication and key management to applications based on 3GPP credentials used for 5GS access as specified in 3GPP\u00a0TS\u00a033.535\u00a0[24A], which allows the UE to securely exchange data with an AKMA application function.\nUpon receiving a request from the upper layers to obtain AKMA Anchor Key (KAKMA) and AKMA Key Identifier (A-KID), the UE supporting AKMA shall derive the KAKMA and the AKMA Temporary Identifier (A-TID) from the valid KAUSF if available as specified in 3GPP\u00a0TS\u00a033.535\u00a0[24A], shall further derive the A-KID from the A-TID as specified in 3GPP\u00a0TS\u00a033.535\u00a0[24A] and shall provide KAKMA and A-KID to the upper layers.\nThe UE supporting AKMA shall notify the upper layers whenever there is a change of the KAUSF upon reception of an EAP-success message in subclauses\u00a05.4.1.2.2.8, 5.4.1.2.3.1 and 5.4.1.2.3A.1 or upon reception of SECURITY MODE COMMAND message in subclauses\u00a05.4.2.3.\nDuring an ongoing primary authentication and key agreement procedure (see subclause\u00a05.4.1), if the UE receives a request from upper layers to obtain KAKMA and A-KID, the UE shall derive the KAKMA and A-TID after the completion of the ongoing primary authentication and key agreement procedure, shall further derive the A-KID from the A-TID as specified in 3GPP\u00a0TS\u00a033.535\u00a0[24A] and shall provide KAKMA and A-KID to the upper layers.\nNOTE\u00a01:\tThe upper layers derive the AKMA Application Key (KAF) from KAKMA as specified in 3GPP\u00a0TS\u00a033.535\u00a0[24A].\nNOTE\u00a02:\tThe knowledge of whether a certain application needs to use AKMA or not is application specific and is out of the scope of 3GPP.\nNOTE\u00a03:\tThe exact method of securing the data exchange at the upper layers using KAF is application specific and is out of the scope of 3GPP.\nNOTE\u00a04:\tThe upper layers request the UE NAS layer to provide KAKMA and A-KID before the upper layers initiate communication with an AKMA application function.\nNOTE\u00a05:\tUpon receiving a request from the upper layers to obtain KAKMA and A-KID, if there is no KAUSF available, the UE NAS layer cannot derive the KAKMA and A-KID and provides an indication to the upper layers that KAKMA and A-KID cannot be generated.\n4.22\tUncrewed aerial vehicle identification, authentication, and authorization\n4.22.1\tGeneral\nA 5GS can support UAV identification, authentication, and authorization (see 3GPP\u00a0TS\u00a023.256\u00a0[6AB]). This subclause describes NAS-specific aspects of the 5GS features to support UAV identification, authentication, authorization and C2 communication authorization.\nBefore accessing 5GS for UAS services, the UE supporting UAS services must have an assigned CAA-level\u00a0UAV\u00a0ID. The UE can be registered to 5GS for UAS services if there is a valid aerial subscription in the UE's subscription.\n4.22.2\tAuthentication and authorization of UAV\nThe 5GS supports the USS UAV Authorization and Authentication (UUAA) procedure for a UE supporting UAS services. Depending on operator policy or regulatory requirements, the UUAA-MM procedure can be performed by the UE and the AMF at a registration procedure as specified in subclause\u00a05.5.1.2, the UUAA-SM procedure can be performed by the UE and the SMF at a PDU session establishment procedure\u00a0as specified in subclause\u00a06.4.1.2, or both can be performed. The UE shall support UUAA-MM and UUAA-SM, and the network shall support UUAA-SM and may optionally support UUAA-MM. The UUAA procedure needs to be performed by 5GS with USS successfully before the connectivity for UAS services is established.\nDuring the registration procedure as described in subclause\u00a05.5.1.2, the UE supporting UAS services provides CAA-level\u00a0UAV\u00a0ID to the AMF, and the AMF may trigger the UUAA-MM procedure. If the UE supporting UAS services does not provide CAA-level UAV ID to the AMF and the network is configured to perform UUAA-MM at registration procedure, the AMF may accept the registration request and shall mark in the UE's 5GMM context that the UE is not allowed to request UAS services. If the UE wants to use the UAS services by providing the CAA-Level UAV ID later on, the UE shall perform the registration procedure for mobility and periodic registration update.\nWhen a UE supporting UAS services requests to establish a PDU session as described in subclause\u00a06.4.1.2 for USS communication, the UE provides CAA-level\u00a0UAV\u00a0ID to the network, and the SMF may trigger the UUAA-SM procedure based on the DNN and S-NSSAI combination for aerial services according to the user's subscription data and the CAA-level\u00a0UAV\u00a0ID provided by the UE.\nIf the UE does not provide CAA-level UAV ID and the user\u2019s subscription data for the UE requires the UUAA-SM, the network rejects the UE-requested PDU session establishment procedure for the UAS services.\nThe UE supporting UAS services shall not provide CAA-level UAV ID to the network over non-3GPP access, and the network shall not perform UUAA procedure for non-3GPP access and shall ensure that the UE is not allowed to access any aerial services in non-3GPP access.\nIf provided by the upper layers, the UE supporting UAS services provides to the network the USS address during the registration procedure or PDU session establishment procedure so that the network uses the information to discover the USS.\nNOTE:\tThe parameters (e.g., CAA-level UAV ID or USS address) sent by a UE supporting UAS services to the network for UAS services are included in the Service-level-AA container IE which is a non-cleartext IE.\nAfter successful UUAA procedure, either the AMF or the SMF may initiate re-authentication of the UAV when required by the USS. If UUAA-MM fails during a re-authentication and there are PDU sessions established using UAS services, the AMF shall request the SMF to perform the release of these PDU sessions and may trigger a network-initiated de-registration procedure based on operator policy. If UUAA-SM fails during a re-authentication, the SMF shall release the PDU session related to re-authentication.\nIf the UUAA is revoked, the PDU session related to the UAS services shall be released by the SMF. Based on operator policy, the AMF may decide to keep the UE registered or trigger a de-registration procedure.\n4.22.3\tAuthorization of C2 communication\nThe 5GS supports USS authorization of C2 communication for pairing of UAV and UAV-C. The pairing of UAV and UAV-C needs to be authorized by USS successfully before the user plane connectivity for C2 communication (over Uu or over NR-PC5) is enabled. For C2 authorization procedure, the UE supporting UAS services provides to the network with CAA-level UAV ID.\nThe USS authorization of UAV flight can also be performed during the C2 authorization procedure. The UE supporting UAS services provides the UAV flight authorization information to the network if provided by upper layers.\nNOTE\u00a01:\tThe C2 authorization payload in the service-level-AA payload can include one, some or all of the pairing information for C2 communication, an indication of the request for direct C2 communication, pairing information for direct C2 communication, and the UAV flight authorization information (see subclauses\u00a06.4.1.2 and 6.4.2.2).\nThe UE supporting UAS services can establish a PDU session for the C2 communication by providing the CAA-level\u00a0UAV\u00a0ID and the C2 authorization payload. The SMF upon reception of the UE's request for the PDU session establishment, determines that authorization is required based on the DNN and S-NSSAI combination of the PDU session is for aerial services according to user's subscription data and the CAA-level\u00a0UAV\u00a0ID included in the request.\nIf a UE supporting UAS services uses a common PDU session for both USS communication and C2 communication, the C2 communication can be authorized using UUAA-SM procedure during the PDU session establishment procedure or during the PDU session modification procedure. If the pairing of UAV and UAV-C is revoked, the network shall disable C2 communication for the PDU session. The SMF upon reception of the UE's request for the PDU session establishment, determines that authorization is required based on the DNN and S-NSSAI combination of the PDU session is for aerial services according to user's subscription data and the CAA-level\u00a0UAV\u00a0ID included in the request.\nNOTE\u00a02:\tThe network can disable C2 communication for the PDU session e.g., by removing the QoS flow for C2 communication during PDU session modification procedure as decribed in subclauses\u00a06.3.2.2.\nIf a UE supporting UAS services uses separate PDU sessions for, respectively, USS communication and C2 communication, the C2 communication is authorized using UUAA-SM during the PDU session establishment procedure. If the pairing of UAV and UAV-C is revoked, the PDU session for C2 communication shall be released by the SMF.\nDuring the registration procedure for UAS services, direct C2 communication can be authorized as described in subclause 5.5.1.2. A UE supporting A2X over NR-PC5 can perform registration procedure for UAS services including a request for authorization of direct C2 communication by providing CAA-level\u00a0UAV\u00a0ID and C2 authorization payload.\n4.22.4\tVoid\n4.23\tNAS over Non-Terrestrial Network\n4.23.1\tGeneral\nA 5GS can support 3GPP satellite NG-RAN access technology (see 3GPP\u00a0TS\u00a023.501\u00a0[8]). This subclause describes NAS-specific aspects of the 5GS features to support 3GPP satellite NG-RAN access technology.\n4.23.2\tList of \"PLMNs not allowed to operate at the present UE location\"\nFor 3GPP satellite NG-RAN the UE shall store a list of \"PLMNs not allowed to operate at the present UE location\". Each entry consists of:\na)\tthe PLMN identity of the PLMN which sent a message including 5GMM cause value #78 \"PLMN not allowed to operate at the present UE location\" via satellite NG-RAN access technology; and\nb)\tthe geographical location, if known by the UE, where 5GMM cause value #78 was received on satellite NG-RAN access technology; and\nc)\tif the geographical location exists, a UE implementation specific distance value.\nBefore storing a new entry in the list, the UE shall delete any existing entry with the same PLMN identity. Upon storing a new entry, the UE starts a timer instance associated with the entry with an implementation specific value that shall not be set to a value smaller than the timer value indicated by the network in the Lower bound timer value IE, if any. If the Lower bound timer value IE was not provided by the network, the value of the timer shall be set based on the UE implementation.\nThe UE is allowed to attempt to access a PLMN via satellite NG-RAN access technology which is part of the list of \"PLMNs not allowed to operate at the present UE location\" only if:\na)\tthe current UE location is known, a geographical location is stored for the entry of this PLMN, and the distance to the current UE location is larger than a UE implementation specific value; or\nb)\tthe access is for emergency services (see 3GPP\u00a0TS\u00a023.122\u00a0[5] for further details).\nNOTE:\tWhen the UE is accessing network for emergency services, it is up to operator and regulatory policies whether the network needs to determine if the UE is in a location where network is not allowed to operate.\nThe list shall accommodate three or more entries. The maximum number of entries is an implementation decision. When the list is full and a new entry has to be inserted, the oldest entry shall be deleted.\nEach entry shall be removed if for the entry:\na)\tthe UE successfully registers via satellite NG-RAN access technology to the PLMN stored in the entry except when the UE registers for emergency services; or\nb)\tthe timer instance associated with the entry expires.\nThe UE may delete the entry in the list, if the current UE location is known, a geographical location is stored for the entry of this PLMN, and the distance to the current UE location is larger than a UE implementation specific value. \nIf the UE is in 5GMM-DEREGISTERED.LIMITED-SERVICE state and an entry from the list of \"PLMNs not allowed to operate at the present UE location\" is removed, the UE shall perform PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\nWhen the UE is switched off, the UE shall keep the list of \"PLMNs not allowed to operate at the present UE location\" in its non-volatile memory. The UE shall delete the list of \"PLMNs not allowed to operate at the present UE location\" if the USIM is removed.\nIf the UE is switched off when the timer instance associated with the entry in the list is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:\n\tlet t1 be the time remaining for timer instance associated with the entry in the list to timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1\u00a0\u2013\u00a0t. If t1 is equal to or less than t, then the timer need not be restarted and considered expired. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\n4.23.3\t5GS mobility management via a satellite NG-RAN cell\nFor 5GS mobility management via a satellite NG-RAN cell the UE shall apply the value of the applicable NAS timer indicated in table\u00a010.2.1 for access via a satellite NG-RAN cell.\nNOTE\u00a01:\tThe applied NAS timer values are based on the current satellite NG-RAN access RAT type determined based on information from lower layers.\nThe NAS timer value obtained by the UE is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure, and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.\nThe access via a satellite NG-RAN cell by a UE is indicated to the AMF by lower layers and shall be stored by the AMF. When an AMF that supports access via satellite NG-RAN cells performs NAS signalling with a UE via satellite NG-RAN cells, the AMF shall calculate the value of the applicable NAS timer indicated in table\u00a010.2.2 for access via a satellite NG-RAN cell.\nNOTE\u00a02:\tThe applied NAS timer values are based on the current satellite NG-RAN access RAT type determined based on information from lower layers.\nThe NAS timer value obtained by the network is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.\n4.23.4\t5GS session management via a satellite NG-RAN cell\nFor 5GS session management via a satellite NG-RAN cell the UE shall apply the value of the applicable NAS timer indicated in table\u00a010.3.1 for access via a satellite NG-RAN cell.\nNOTE\u00a01:\tThe applied NAS timer values are based on the current satellite NG-RAN access RAT type determined based on information from lower layers.\nThe NAS timer value obtained by the UE is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure, and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.\nIf the use of extended NAS timer for access via a satellite NG-RAN cell is indicated by the AMF (see 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a023.502\u00a0[9]), the SMF shall calculate the value of the applicable NAS timer indicated in table\u00a010.3.2 for access via a satellite NG-RAN cell.\nThe NAS timer value obtained by the network is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.\n4.23.5\tHandling multiple tracking area codes from the lower layers\nWhen a UE camps on a satellite NG-RAN cell, the UE may receive multiple TACs from the lower layers. The UE shall construct TAIs from the multiple TACs (i.e. concatenate the identity of the current PLMN and each of the TACs) and select a TAI as follows:\na)\tif at least one TAI belongs to the current registration area of the UE, the UE shall select a TAI which belongs to the current registration area of the UE according to the followings.\n\tIf there are multiple TAIs which belong to the current registration area of the UE, the UE shall select a TAI as follows:\n1)\tif there is a TAI which belongs to the list of \"allowed tracking area\" (if any) and does not belong to the list of \"non-allowed tracking areas\" (if any), the UE shall select a TAI which belongs to the list of \"allowed tracking area\" (if any) and does not belong to the list of \"non-allowed tracking areas\" (if any). In this case, if there are multiple TAIs which belong to the list of \"allowed tracking area\" (if any) and does not belong to the list of \"non-allowed tracking areas\" (if any), then the UE shall consider each of these TAIs equal and select a TAI in an implementation-specific way (e.g. taking into account LADN service area information). If these multiple TAIs contain the previous current TAI, the current TAI can be left unchanged.\n2)\tif there is no TAI which belongs to the list of \"allowed tracking area\" (if any) and does not belong to the list of \"non-allowed tracking areas\" (if any) or neither the list of \"allowed tracking area\" nor the list of \"non-allowed tracking areas\" is available, then the UE shall consider each of these TAIs equal and select a TAI in an implementation-specific way (e.g. taking into account LADN service area information). If these multiple TAIs contain the previous current TAI, the current TAI can be left unchanged.\nb)\tif the current registration area is not available in the UE or no TAI belongs to the current registration area of the UE and:\n1)\tthere is a TAI which belongs to neither the list of \"5GS forbidden tracking areas for roaming\" nor the list of \"5GS forbidden tracking areas for regional provision of service\", the UE shall select a TAI which belongs to neither the list of \"5GS forbidden tracking areas for roaming\" nor the list of \"5GS forbidden tracking areas for regional provision of service\". In this case, if there are multiple TAIs which belong to neither the list of \"5GS forbidden tracking areas for roaming\" nor the list of \"5GS forbidden tracking areas for regional provision of service\", then the UE shall consider each of these TAIs equal and select a TAI in an implementation-specific way.\n2)\tall TAIs belong to the list of \"5GS forbidden tracking areas for roaming\" or the list of \"5GS forbidden tracking areas for regional provision of service\", then the UE shall consider each of these TAIs equal and select a TAI in an implementation-specific way.\nThe UE shall consider the selected TAI as the current TAI. The UE shall select a TAI when:\na)\tthe UE receives multiple TACs from the lower layers; or\nb)\tthe UE has received multiple TACs from the lower layers upon starting to camping on the current cell and the registration area, the list of \"allowed tracking areas\", the list of \"non-allowed tracking areas\", the list of \"5GS forbidden tracking areas for roaming\", or the list of \"5GS forbidden tracking areas for regional provision of service\" is updated.\nHandling of the list of \"5GS forbidden tracking areas for roaming\" and the list of \"5GS forbidden tracking areas for regional provision of service\" is specified in subclause\u00a05.3.13.\n4.24\tMinimization of service interruption\nThe UE and the network may support Minimization of service interruption (MINT). MINT aims to enable a UE to obtain service from a PLMN offering disaster roaming services when a disaster condition applies to the UE's determined PLMN with disaster condition.\nIf the UE supports MINT, the indication of whether disaster roaming is enabled in the UE, the indication of 'applicability of \"lists of PLMN(s) to be used in disaster condition\" provided by a VPLMN', the one or more \"list of PLMN(s) to be used in disaster condition\", disaster roaming wait range and disaster return wait range provisioned by the network, if available, are stored in the non-volatile memory in the ME as specified in annex\u00a0C and are kept when the UE enters 5GMM-DEREGISTERED state. Annex\u00a0C specifies condition under which the indication of whether disaster roaming is enabled in the UE, the indication of 'applicability of \"lists of PLMN(s) to be used in disaster condition\" provided by a VPLMN', the one or more \"lists of PLMN(s) to be used in disaster condition\", disaster roaming wait range and disaster return wait range stored in the ME are deleted.\nUpon selecting a PLMN for disaster roaming as specified in 3GPP\u00a0TS\u00a023.122\u00a0[6]:\na)\tif the UE does not have a stored disaster roaming wait range, the UE shall perform a registration procedure for disaster roaming services on the selected PLMN as described in subclause\u00a05.5.1; and\nb)\tif the UE has a stored disaster roaming wait range, the UE shall generate a random number within the disaster roaming wait range and start a timer with the generated random number. While the timer is running, the UE shall not initiate registration on the selected PLMN except if the UE needs to request an emergency PDU session, in which case the UE shall initiate the registration procedure, set the 5GS registration type IE to \"emergency registration\" in the REGISTRATION REQUEST message and keep the timer running. Upon expiration of the timer, if the UE does not have an emergency PDU session, the UE shall perform a registration procedure for disaster roaming services as described in subclause\u00a05.5.1 if still camped on the selected PLMN. If the UE has an emergency PDU session when the timer expires, the registration procedure for disaster roaming services as described in subclause\u00a05.5.1 shall be performed after the release of the emergency PDU session, if the UE is still camped on the selected PLMN.\nThe timer started with a generated random number within the disaster roaming wait range is stopped and the UE shall perform a PLMN selection as described in 3GPP\u00a0TS\u00a023.122\u00a0[5], if:\na)\tthe UE has successfully registered over non-3GPP access on another PLMN; \nb)\tthe UE has successfully registered with an allowable PLMN; or\nc)\tan NG-RAN cell selected for camping of the selected PLMN broadcasts neither the disaster related indication nor a \"list of one or more PLMN(s) with disaster condition for which disaster roaming services is offered by the available PLMN\" including the determined PLMN with Disaster Condition (see 3GPP\u00a0TS\u00a023.122\u00a0[5]).\nUpon determining that a disaster condition has ended and that the UE shall perform PLMN selection as specified in 3GPP\u00a0TS\u00a023.122\u00a0[6]:\na)\tif the UE does not have a stored disaster return wait range, the UE shall perform a registration procedure on the selected PLMN; and\nb)\tif the UE has a stored disaster return wait range, the UE shall generate a random number within the disaster return wait range, start a timer with the generated random number value and enter 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION state or 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE state, if registered. While the timer is running, the UE shall not initiate registration on the selected PLMN except if the UE needs to request an emergency PDU session, in which case the UE shall initiate the registration procedure, set the 5GS registration type IE to \"emergency registration\" in the REGISTRATION REQUEST message and keep the timer running. Upon expiration of the timer, if the UE does not have an emergency PDU session, the UE shall perform a registration procedure if still camped on the selected PLMN. If the UE has an emergency PDU session when the timer expires, the registration procedure as described in subclause\u00a05.5.1 shall be performed after the release of the emergency PDU session, if the UE is still camped on the selected PLMN.\nWhen the AMF assigns a registration area to the UE registered for disaster roaming services, the AMF shall only include TAIs covering the area with the disaster condition.\nWhen the AMF determines that the disaster condition has ended and the UE which is registered for disaster roaming services has an emergency PDU session, the AMF shall initiate the generic UE configuration update procedure to indicate that the UE is registered for emergency services as described in subclause\u00a05.4.4.2.\nInterworking with EPS is not supported for UEs that are registered for disaster roaming services. When registering for disaster roaming services, the UE indicates to the network that S1 mode is not supported as described in subclause\u00a05.5.1.2.2. While registered for disaster roaming services and upon a need to establish an emergency PDU session or perform emergency services fallback, the UE initiates the registration procedure for mobility and periodic registration update and indicates that S1 mode is supported as described in subclause\u00a05.5.1.3.2.\nIf the UE is registered for disaster roaming services and the registered PLMN is removed from forbidden PLMN lists due to reasons specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] subclause\u00a04.4.6 or in 3GPP\u00a0TS\u00a023.122\u00a0[5] Annex\u00a0C, then UE shall initiate the de-registration procedure and perform PLMN selection as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5].\n4.25\tSupport of MUSIM features\nA network and a MUSIM UE may support one or more of the MUSIM features (i.e. the N1 NAS signalling connection release, the paging indication for voice services, the reject paging request, the paging restriction and the paging timing collision control).\nIf MUSIM UE supports one or more MUSIM features, the UE indicates support of one or more MUSIM features (except for the paging timing collision control) during the registration procedure. If the UE has indicated support of the N1 NAS signalling connection release or the reject paging request or both and the UE supports the paging restriction, the UE indicates support of the paging restriction.\nIf the UE indicates support of one or more MUSIM features and the network decides to accept one or more MUSIM features, the network indicates the support of one or more MUSIM features during the registration procedure. The network only indicates the support of the paging restriction together with the support of either N1 NAS signalling connection release or the reject paging request.\nThe network does not indicate support for any MUSIM feature to the UE during the registration for emergency services.\nIf the UE is not currently registered for emergency service and the UE receives the CONFIGURATION UPDATE COMMAND message with the 5GS registration result IE value set to \"Registered for emergency services\", then UE shall behave as if the network did not indicate support for any MUSIM feature in the last registration procedure. If the network has sent CONFIGURATION UPDATE COMMAND message with the 5GS registration result IE value set to \"Registered for emergency services\", then network shall behave as if it did not indicate support for any MUSIM feature in the last registration procedure. \nIf a UE stops fulfilling the condition to be considered a MUSIM UE as defined in subclause\u00a03.1, and the UE has negotiated support of one or more MUSIM features, then the UE shall initiate a registration procedure for mobility and periodic registration update to indicate that all the MUSIM features are not supported (except for the paging timing collision control) as specified in subclause\u00a05.5.1.3.\nA MUSIM UE operating in NB-N1 mode or in WB-N1 mode CE mode B does not indicate the support for paging indication for voice services during the registration procedure towards the network.\n4.26\tSupport for Personal IoT Network service\nThe 5GS can support the Personal IoT Network (PIN) service (see 3GPP\u00a0TS\u00a023.501\u00a0[8]).\nThe PIN enables the Personal IoT Network Elements (PINEs) to communicate with each other via PIN direct communication, PIN indirect communication or PIN-DN communication. For the PIN indirect communication and PIN-DN communication, a UE acting as a PIN Element with Gateway Capability (PEGC) enables the PINEs behind the PEGC to connect to the network and to communicate with other PINEs within the PIN or with the DN via the PDU session established for PIN. A PEGC may serve one or more PINs. The PEGC establishes only one PDU session for each PIN. The PEGC establishes different PDU sessions for different PINs based on different DNNs and S-NSSAIs. The PEGC may establish only one PDU session for multiple PINs if traffic differentiation for multiple PINs is not required in 5GS.\nNOTE\u00a01:\tThe PIN direct communication is out of the scope of 3GPP.\nThe PIN, PEGC, and PINEs are managed by PIN Element with Management Capability (PEMC) and optionally the corresponding application function. Each PIN contains at least one PEGC and at least one PEMC. The PIN architecture is captured in 3GPP\u00a0TS\u00a023.501\u00a0[8].\nThe 5GS supports the delivery of URSP rules which include the PIN ID to a PEGC registered to 5GS (see 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a023.503\u00a0[10]). The 5GS is enhanced to support the PDU session management for PIN to ensure the end-to-end QoS requirement.\nThe end-to-end QoS requirement for each PINE over PIN indirect communication and over PIN-DN communication includes:\na)\tthe QoS requirement in the 3GPP access network; and\nb)\tthe QoS requirement in the non-3GPP access network.\nThe N3QAI is introduced to enable a PEGC to perform the QoS differentiation for the PINEs in the non-3GPP access network. If the UE supports receiving the N3QAI, the network may provide the N3QAI associated with the QoS flow during the PDU session establishment procedure as defined in subclause\u00a06.4.1 or during the PDU session modification procedure as defined in subclause\u00a06.4.2.\nNOTE\u00a02:\tHow the PEGC applies N3QAI is outside the scope of the present document.\nThe non-3GPP delay budget refers to the delay budget between the PEGC and the PINE in the non-3GPP access network. If the UE supports providing the non-3GPP delay budget, the UE may provide the network with the non-3GPP delay budget for the one or more QoS flows associated with the PDU sessions for a PIN during the PDU session modification procedure as defined in subclause\u00a06.4.2. The network takes into account the received non-3GPP delay budget to ensure the end-to-end QoS requirement of a PINE.\nNOTE\u00a03:\tThe support of a 5G-RG or a FN-RG acting as a PEGC is not specified in this release of specification.\nNOTE\u00a04:\tThe support of redundant PDU sessions does not apply for PIN.\n4.27\tMobile base station relay support\nA 5GS can support a MBSR-UE and a UE accessing to MBSR (see subclause\u00a05.35A of 3GPP\u00a0TS 23.501\u00a0[8]). This subclause describes NAS-specific aspects of the 5GS features to support the authorization of the MBSR-UE, and the control of the UE access via MBSR.\nThe AMF authorizes the UE's request to act as a MBSR based on the subscription information. The AMF can indicate to the MBSR-UE that it is allowed or not allowed to operate as MBSR during registration procedure as specified in subclause\u00a05.5.1.2.\nEnhanced CAG information can be used for the control of UE's access via MBSR. CAG identifier is used to control the access of UE via MBSR. 5GC supports the UE access control based on the PLMND ID and CAG identifier broadcast by the MBSR and the CAG-ID authorized based on \"Allowed CAG list\" in the PLMN's entry of \"CAG information list\" stored in the UE. Time validity information can be provided to the UE together with the CAG identifier for accessing to MBSR in order to control that UE not accessing the MBSR cell outside of the time validity information. For the UE not supporting CAG functionality, 5GC can control the access of the UE with managing the forbidden tracking area. \n5\tElementary procedures for 5GS mobility management\n5.1\tOverview\n5.1.1\tGeneral\nThe main function of the 5GS mobility management (5GMM) sublayer is to support the identification, security, mobility of a UE as well as generic message transport.\nA further function of the 5GMM sublayer is to provide connection management services to the other sublayer(s).\nNOTE:\tIn a satellite NG-RAN access, a GNSS fix time in lower layers can delay transmission of an initial UL NAS message by up to 100 seconds (GNSS cold state).\n5.1.2\tTypes of 5GMM procedures\nDepending on how they can be initiated, three types of 5GMM procedures can be distinguished:\na)\t5GMM common procedures:\n\t5GMM common procedure can always be initiated when the UE is in 5GMM-CONNECTED mode. The procedures belonging to this type are:\n1)\tInitiated by the network:\ni)\tnetwork-initiated NAS transport;\nii)\tprimary authentication and key agreement;\niii)\tsecurity mode control;\niv)\tgeneric UE configuration update;\nv)\tidentification; and\nvi)\tnetwork slice-specific authentication and authorization;\n2)\tInitiated by the UE:\n\tUE-initiated NAS transport.\n3)\tInitiated by the UE or the network and used to report certain error conditions detected upon receipt of 5GMM protocol data:\n\t5GMM status.\nb)\t5GMM specific procedures:\n\tAt any time only one UE initiated 5GMM specific procedure can be running for each of the access network(s) that the UE is camping in. The procedures belonging to this type are:\n1)\tInitiated by the UE and used e.g. to register to the network for 5GS services and establish a 5GMM context, to update the location/parameter(s) of the UE:\n\tregistration.\n2)\tInitiated by the UE or the network and used to deregister from the network for 5GS services and to release a 5GMM context:\n\tde-registration.\n3)\tInitiated by the UE and used to deregister from the network for 5GS services and to release a 5GMM context:\n\teCall inactivity procedure.\nc)\t5GMM connection management procedures:\n1)\tInitiated by the UE and used to establish a secure connection to the network or to request the resource reservation for sending data, or both:\n\tservice request.\n\tThe service request procedure can only be initiated if no UE initiated 5GMM specific procedure is ongoing for each of the access network(s) that the UE is camping in.\n2)\tInitiated by the network and used to request the establishment of an N1 NAS signalling connection or to request re-establishment of user-plane resources for the PDU session(s) associated with 3GPP access or to request re-establishment of user-plane resources of the PDU session(s) associated with non-3GPP access over 3GPP access; not applicable for the non-3GPP access network:\n\tpaging.\n3)\tInitiated by the network and used to request re-establishment of user-plane resources of the PDU session(s) associated with non-3GPP access over 3GPP access or to deliver 5GSM downlink signalling messages associated with non-3GPP access over 3GPP access, when the UE is in 5GMM-CONNECTED mode over 3GPP access and in 5GMM-IDLE mode over non-3GPP access; or\n\tInitiated by the network and used to request re-establishment of user-plane resources of the PDU session(s) associated with 3GPP access over 3GPP access or to deliver downlink signalling associated with 3GPP access over 3GPP access, when the UE is in 5GMM-CONNECTED mode over non-3GPP access, and when the UE is in 5GMM-IDLE mode over 3GPP access and not in MICO mode:\n\tnotification.\nNOTE\u00a01:\tIn NB-N1 mode, the UE NAS using 5GS services with control plane CIoT 5GS optimization can wait for the lower layers to complete the transmission of the previous UL NAS TRANSPORT messages carrying control plane user data before providing subsequent NAS messages. Other implementations are possible.\nNOTE\u00a02:\tWhen providing NAS messages to the lower layers for transmission, the UE NAS using 5GS services with control plane CIoT 5GS optimization can prioritize sending NAS signalling messages over the UL NAS TRANSPORT messages carrying control plane user data. How the UE performs this prioritization is implementation specific.\n5.1.3\t5GMM sublayer states\n5.1.3.1\tGeneral\nIn the following subclauses, the 5GS mobility management (5GMM) sublayer of the UE and the network is described by means of different state machines. The 5GMM sublayer states is managed per access type independently, i.e. 3GPP access or non-3GPP access. In subclause\u00a05.1.3.2, the states of the 5GMM sublayer are introduced.\n5.1.3.2\t5GMM sublayer states\n5.1.3.2.1\t5GMM sublayer states in the UE\n5.1.3.2.1.1\tGeneral\nIn the following subclauses, the possible 5GMM sublayer states of the UE are described and shown in Figure\u00a05.1.3.2.1.1.1.\n\nNOTE:\tNot all possible transitions are shown in this figure.\nFigure\u00a05.1.3.2.1.1.1: 5GMM main states in the UE\n5.1.3.2.1.2\tMain states\n5.1.3.2.1.2.1\t5GMM-NULL\n5GS services are disabled in the UE. No 5GS mobility management function shall be performed in this state.\n5.1.3.2.1.2.2\t5GMM-DEREGISTERED\nIn the state 5GMM-DEREGISTERED, no 5GMM context has been established and the UE location is unknown to the network and hence it is unreachable by a network. In order to establish a 5GMM context, the UE shall start the initial registration procedure.\n5.1.3.2.1.2.3\t5GMM-REGISTERED-INITIATED\nA UE enters the state 5GMM-REGISTERED-INITIATED after it has started the initial registration procedure or the registration procedure for mobility and periodic registration update, and is waiting for a response from the network.\n5.1.3.2.1.2.4\t5GMM-REGISTERED\nIn the state 5GMM-REGISTERED, a 5GMM context has been established. Additionally, one or more PDU session(s) may be established at the UE. The UE may initiate the non-initial registration procedure for mobility and periodic registration update and the service request procedure. The UE in the state 5GMM-REGISTERED over non-3GPP access shall not initiate the periodic registration update procedure.\n5.1.3.2.1.2.5\t5GMM-DEREGISTERED-INITIATED\nA UE enters the state 5GMM-DEREGISTERED-INITIATED after it has requested release of the 5GMM context by starting the de-registration procedure and is waiting for a response from the network.\n5.1.3.2.1.2.6\t5GMM-SERVICE-REQUEST-INITIATED\nA UE enters the state 5GMM-SERVICE-REQUEST-INITIATED after it has started the service request procedure and is waiting for a response from the network.\n5.1.3.2.1.3\tSubstates of state 5GMM-DEREGISTERED\n5.1.3.2.1.3.1\tGeneral\nThe state 5GMM-DEREGISTERED is subdivided into a number of substates as described in this subclause. The following substates are not applicable to non-3GPP access:\na)\t5GMM-DEREGISTERED.PLMN-SEARCH:\nb)\t5GMM-DEREGISTERED.NO-CELL-AVAILABLE; and\nc)\t5GMM-DEREGISTERED.eCALL-INACTIVE.\nValid subscriber data are available for the UE before it enters the substates, except for the substate 5GMM-DEREGISTERED.NO-SUPI.\n5.1.3.2.1.3.2\t5GMM-DEREGISTERED.NORMAL-SERVICE\nThe substate 5GMM-DEREGISTERED.NORMAL-SERVICE is chosen in the UE when a suitable cell has been found and the PLMN, SNPN, or tracking area is not in the forbidden list.\n5.1.3.2.1.3.3\t5GMM-DEREGISTERED.LIMITED-SERVICE\nThe substate 5GMM-DEREGISTERED.LIMITED-SERVICE is chosen in the UE, when it is known that a selected cell for 3GPP access or TA for non-3GPP access is unable to provide normal service (e.g. the selected cell over 3GPP access is in a forbidden PLMN or SNPN or is in a forbidden tracking area or TA for non-3GPP access is forbidden) or the selected cell is a CAG cell for which none of CAG-ID(s) is authorized based on the \"Allowed CAG list\" in the entry of the \"CAG information list\" for the PLMN, or the selected cell is a non-CAG cell in a PLMN for which there exists an \"indication that the UE is only allowed to access 5GS via CAG cells\" in the entry of the \"CAG information list\" for the PLMN, or the selected cell is a CAG cell belonging to a PLMN and the \"CAG information list\" does not contain an entry for the PLMN.\n5.1.3.2.1.3.4\t5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION\nThe substate 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION is chosen in the UE if the initial registration procedure failed due to a missing response from the network or due to the circumstances described in subclauses\u00a05.2.2.3.7, 5.5.1.2.4, 5.5.1.2.5, 5.5.1.2.7, 5.5.1.3.4, 5.5.2.3.2 and 5.5.2.3.4.\n5.1.3.2.1.3.5\t5GMM-DEREGISTERED.PLMN-SEARCH\nThe substate 5GMM-DEREGISTERED.PLMN-SEARCH is chosen in the UE, if the UE is searching for PLMNs or SNPNs. This substate is left either when a cell has been selected (the new substate is NORMAL-SERVICE or LIMITED-SERVICE) or when it has been concluded that no cell is available at the moment (the new substate is NO-CELL-AVAILABLE).\nThis substate is not applicable to non-3GPP access.\n5.1.3.2.1.3.6\t5GMM-DEREGISTERED.NO-SUPI\nThe substate 5GMM-DEREGISTERED.NO-SUPI is chosen in the UE, if the N1 mode is enabled and the UE has no valid subscriber data available (USIM not available, the USIM is considered invalid by the UE or an entry of the \"list of subscriber data\" with the SNPN identity of the SNPN is considered invalid by the UE).\n5.1.3.2.1.3.7\t5GMM-DEREGISTERED.NO-CELL-AVAILABLE\nNo 5G cell can be selected. This substate is entered either after a first intensive search failed when in substate 5GMM-DEREGISTERED.PLMN-SEARCH or unavailability period is activated for 3GPP access. Cells are searched for at a low rhythm. No 5GS services are offered.\nThis substate is not applicable to non-3GPP access.\n5.1.3.2.1.3.8\t5GMM-DEREGISTERED.eCALL-INACTIVE\nThe substate 5GMM-DEREGISTERED.eCALL-INACTIVE is chosen in the UE when:\na)\tthe UE is configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22];\nb)\ttimer T3444 and timer T3445 have expired or are not running;\nc)\ta PLMN has been selected as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5];\nd)\tthe UE does not need to perform an eCall over IMS; and\ne)\tthe UE does not need to perform a call to a non-emergency MSISDN or URI for test or terminal reconfiguration service.\nIn this substate, the UE shall not initiate any signalling towards the network, except to originate an eCall over IMS, or a call to a non-emergency MSISDN or URI for test or terminal reconfiguration service.\nThis substate is not applicable to non-3GPP access.\n5.1.3.2.1.3.9\t5GMM-DEREGISTERED.INITIAL-REGISTRATION-NEEDED\nValid subscriber data are available for the UE and for some reason a registration procedure for initial registration has to be performed as soon as possible. This substate can be entered if the access is barred due to unified access control, (see subclause\u00a04.5.4) or if the network rejects the N1 NAS signalling connection establishment.\n5.1.3.2.1.4\tSubstates of state 5GMM-REGISTERED\n5.1.3.2.1.4.1\tGeneral\nThe state 5GMM-REGISTERED is subdivided into a number of substates as described in this subclause. The following substates are not applicable to non-3GPP access:\na)\t5GMM-REGISTERED.PLMN-SEARCH:\nb)\t5GMM-REGISTERED.NON-ALLOWED-SERVICE; and\nc)\t5GMM-REGISTERED.NO-CELL-AVAILABLE.\n5.1.3.2.1.4.2\t5GMM-REGISTERED.NORMAL-SERVICE\nThe substate 5GMM-REGISTERED.NORMAL-SERVICE is chosen by the UE as the primary substate when the UE enters the state 5GMM-REGISTERED, and:\n-\tfor 3GPP access, the cell the UE selected is known to be in an allowed area (see subclause\u00a05.3.5.2); or\n-\tfor wireline access, the wireline access service area restrictions are not enforced.\n5.1.3.2.1.4.3\t5GMM-REGISTERED.NON-ALLOWED-SERVICE\nThe substate 5GMM-REGISTERED.NON-ALLOWED-SERVICE is chosen in the UE, if:\n-\tfor 3GPP access, the cell the UE selected is known to be in a non-allowed area (see subclause\u00a05.3.5.2); or\n-\tfor wireline access, the wireline access service area restrictions are enforced.\nThis substate is applicable only to 3GPP access and to wireline access.\n5.1.3.2.1.4.4\t5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE\nThe substate 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE is chosen by the UE if the registration procedure for mobility and periodic registration update failed due to a missing response from the network, or due to the circumstances described in subclauses\u00a05.3.9, 5.5.1.3.5 and 5.5.1.3.7. No 5GMM procedure except registration procedure for mobility and periodic registration update (i.e. the 5GS registration type IE set to \"mobility registration updating\" or \"periodic registration updating\" in the REGISTRATION REQUEST message) and de-registration procedure, shall be initiated by the UE in this substate. No data shall be sent or received.\nNOTE\u00a01:\tThe registration procedure for mobility and periodic registration update over non-3GPP access can be triggered by, e.g. the change of S1 UE network capability or renegotiating some parameters.\nNOTE\u00a02:\tThis substate is entered irrespective whether: \n-\tthe UE is camped on a cell which is in the registered PLMN, a PLMN from the list of equivalent PLMNs, or the registered SNPN, and the current TAI is not in the list of \"allowed tracking areas\"; or \n-\tthe current TAI is in the list of \"non-allowed tracking areas\".\n5.1.3.2.1.4.5\t5GMM-REGISTERED.LIMITED-SERVICE\nThe substate 5GMM-REGISTERED.LIMITED-SERVICE is chosen in the UE, if the cell the UE selected is known not to be able to provide normal service.\nNOTE:\tWhen the UE is registered to the network via CAG cell and none of the CAG-ID(s) supported by the current CAG cell is authorized based on the \"Allowed CAG list\" of the entry for the registered PLMN in the received \"CAG information list\", then the cell the UE selected is not able to provide normal service.\n5.1.3.2.1.4.6\t5GMM-REGISTERED.PLMN-SEARCH\nThe substate 5GMM-REGISTERED.PLMN-SEARCH is chosen in the UE, while the UE is searching for PLMNs or SNPNs.\nThis substate is not applicable to non-3GPP access.\n5.1.3.2.1.4.7\t5GMM-REGISTERED.NO-CELL-AVAILABLE\n5G coverage has been lost, MICO mode is active in the UE or unavailability period is activated for 3GPP access. If MICO mode is active, the UE can deactivate MICO mode at any time by activating the AS layer when the UE needs to send mobile originated signalling or user data. Otherwise, the UE shall not initiate any 5GMM procedure except for cell and PLMN reselection.\nThis substate is not applicable to non-3GPP access.\n5.1.3.2.1.4.8\t5GMM-REGISTERED.UPDATE-NEEDED\nThis state can be entered if the UE has to perform a registration procedure for mobility and periodic registration update but:\na)\tthe access is barred due to unified access control when in 3GPP access;\nb)\tthe network rejects the N1 NAS signalling connection establishment when in 3GPP access or in non-3GPP access; or\nc)\tthe UE in 5GMM-CONNECTED mode with RRC inactive indication receives an indication from the lower layers that the resumption of the RRC connection has failed and for access is barred for all categories except categories '0' and '2' as specified in subclause\u00a05.3.1.4.\nNo 5GMM procedure except:\na)\tregistration procedure for mobility and periodic registration update;\nb)\tservice request procedure as a response to paging or notification; and\nc)\tde-registration procedure\nshall be initiated by the UE in this substate.\nNOTE:\tThis substate is entered irrespective whether:\n-\tthe UE is camped on a cell which is in the registered PLMN, a PLMN from the list of equivalent PLMNs, or the registered SNPN, and the current TAI is not in the list of \"allowed tracking areas\"; or\n-\tthe current TAI is in the list of \"non-allowed tracking areas\".\n5.1.3.2.2\t5GS update status in the UE\nIn order to describe the detailed UE behaviour, the 5GS update (5U) status pertaining to a specific subscriber is defined.\nIf the UE is not operating in SNPN access operation mode (see 3GPP\u00a0TS\u00a023.501\u00a0[8]), the 5GS update status is stored in a non-volatile memory in the USIM if the corresponding file is present in the USIM, else in the non-volatile memory in the ME, as described in annex\u00a0C.\nIf the UE is operating in SNPN access operation mode, the 5GS update status for each SNPN whose SNPN identity is included in the \"list of subscriber data\" configured in the ME (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) is stored in the non-volatile memory in the ME as described in annex\u00a0C.\nThe 5GS update status value is changed only after the execution of a registration, network-initiated de-registration, 5GS based primary authentication and key agreement, service request, paging procedure or due to change in the current TAI which does not belong to the current registration area while T3346 is running.\n5U1: UPDATED\n\tThe last registration attempt was successful.\n5U2: NOT UPDATED\n\tThe last registration or service request attempt failed procedurally, e.g. no response or reject message was received from the AMF.\n5U3: ROAMING NOT ALLOWED\n\tThe last registration, service request, or registration for mobility or periodic registration update attempt was correctly performed, but the answer from the AMF was negative (because of roaming or subscription restrictions).\n5.1.3.2.3\t5GMM sublayer states in the network side\n5.1.3.2.3.1\tGeneral\nIn the following subclauses, the possible 5GMM sublayer states of the network are described and shown in Figure\u00a05.1.3.2.3.1.1.\n\nNOTE:\tNot all possible transitions are shown in this figure.\nFigure\u00a05.1.3.2.3.1.1: 5GMM main states in the network\n5.1.3.2.3.2\t5GMM-DEREGISTERED\nIn the state 5GMM-DEREGISTERED, no 5GMM context has been established or the 5GMM context is marked as deregistered. The UE is deregistered. The network may answer to an initial registration procedure initiated by the UE. The network may also answer to a de-registration procedure initiated by the UE.\n5.1.3.2.3.3\t5GMM-COMMON-PROCEDURE-INITIATED\nThe network enters the state 5GMM-COMMON-PROCEDURE-INITIATED, after it has started a common 5GMM procedure and is waiting for a response from the UE.\n5.1.3.2.3.4\t5GMM-REGISTERED\nIn the state 5GMM-REGISTERED, a 5GMM context has been established. Additionally, one or more PDU session(s) may be established at the network.\n5.1.3.2.3.5\t5GMM-DEREGISTERED-INITIATED\nThe network enters the state 5GMM-DEREGISTERED-INITIATED after it has started a de-registration procedure and is waiting for a response from the UE.\n5.1.4\tCoordination between 5GMM and EMM\n5.1.4.1\tGeneral\nIf both 5GMM and EMM are enabled, a UE, operating in single-registration mode, shall maintain one common registration for 5GMM for 3GPP access and EMM.\nCoordination between 5GMM for 3GPP access and EMM for a UE, which is capable of N1 mode and S1 mode and operates in dual-registration mode, is not needed, except as specified in subclause\u00a04.8.3.\nThe coordination between 5GMM for 3GPP access and EMM in subclauses\u00a05.1.4.2 and\u00a05.1.4.3 only applies to the UEs operating in single-registration mode.\nRegarding the coordination of \"SIM/USIM considered invalid\" and \"USIM considered invalid for 5GS services\" between the various mobility management entities see subclause\u00a05.1.5.\n5.1.4.2\tCoordination between 5GMM for 3GPP access and EMM with N26 interface\nA UE that is not registered shall be in state EMM-DEREGISTERED and state 5GMM-DEREGISTERED for 3GPP access.\nIn N1 mode, upon successful completion of a registration procedure over 3GPP access, the UE operating in single-registration mode shall enter substates 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE as described in subclause\u00a05.3.5.2 for 3GPP access and EMM-REGISTERED.NO-CELL-AVAILABLE. The UE shall reset the registration attempt counter for 3GPP access and the attach attempt counter (see 3GPP\u00a0TS\u00a024.301\u00a0[15]).\nAt inter-system change from S1 mode to N1 mode, the UE shall enter substates 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE as described in subclause\u00a05.3.5.2 for 3GPP accessand EMM-REGISTERED.NO-CELL-AVAILABLE and initiate a registration procedure for mobility and periodic registration update over 3GPP access indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message (see subclause\u00a05.5.1.3).\nIn S1 mode, upon successful completion of an attach or tracking area updating procedure, the UE operating in single-registration mode shall enter substates 5GMM-REGISTERED.NO-CELL-AVAILABLE for 3GPP access and EMM-REGISTERED.NORMAL-SERVICE. The UE shall reset the registration attempt counter for 3GPP access and the attach attempt counter or tracking area updating attempt counter (see 3GPP\u00a0TS\u00a024.301\u00a0[15]).\nAt inter-system change from N1 mode to S1 mode when there is no active PDU session for which interworking with EPS is supported as specified in subclause\u00a06.1.4.1, and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall enter state 5GMM-DEREGISTERED for 3GPP access and state EMM-DEREGISTERED and then initiate the EPS attach procedure. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall enter substates EMM-REGISTERED.NORMAL-SERVICE and 5GMM-REGISTERED.NO-CELL-AVAILABLE for 3GPP access and initiate a tracking area updating procedure.\nAt inter-system change from N1 mode to S1 mode when there is at least one active PDU session for which interworking with EPS is supported as specified in subclause\u00a06.1.4.1, the UE shall enter substates EMM-REGISTERED.NORMAL-SERVICE and 5GMM-REGISTERED.NO-CELL-AVAILABLE for 3GPP access and initiate a tracking area updating procedure (see 3GPP\u00a0TS\u00a024.301\u00a0[15]).\n5.1.4.3\tCoordination between 5GMM for 3GPP access and EMM without N26 interface\nA UE operating in the single-registration mode that is not registered over 3GPP access shall be in state EMM-DEREGISTERED and in state 5GMM-DEREGISTERED for 3GPP access.\nIn N1 mode, upon successful completion of a registration procedure over 3GPP access, the UE operating in the single-registration mode shall enter substates 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE as described in subclause\u00a05.3.5.2 for 3GPP access and EMM-REGISTERED.NO-CELL-AVAILABLE.\nAt inter-system change from N1 mode to S1 mode in 5GMM-IDLE mode, the UE shall behave as specified in subclause\u00a04.8.2.3.\nIn S1 mode, upon successful completion of an attach or tracking area updating procedure, the UE operating in the single-registration mode shall enter substates 5GMM-REGISTERED.NO-CELL-AVAILABLE for 3GPP access and EMM-REGISTERED.NORMAL-SERVICE.\nAt inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, the UE operating in the single-registration mode:\na)\tif the UE is registered for normal service in S1 mode, the UE shall enter substates EMM-REGISTERED.NO-CELL-AVAILABLE and 5GMM- REGISTERED.NORMAL-SERVICE for 3GPP access and then initiate the registration procedure for mobility and periodic registration update over 3GPP access indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message (see subclause\u00a05.5.1.3); or\nb)\tif the UE is registered for emergency bearer services in S1 mode, the UE shall initiate the registration procedure for emergency services.\n5.1.5\tCoordination between 5GMM and GMM\nCoordination between 5GMM and GMM states is not required.\nRegardless whether the UE is operating in single-registration mode or dual-registration mode,\na)\tif the UE considers the SIM/USIM invalid for any of: 3GPP access in N1 mode, S1 mode, A/Gb mode or Iu mode, then it considers the SIM/USIM invalid for all of them; and\nb)\tif the UE considers the USIM invalid for 5GS services for any of: 3GPP access in N1 mode, S1 mode, A/Gb mode or Iu mode, then it considers the USIM invalid for 5GS services for all of them.\n5.2\tBehaviour of the UE in state 5GMM-DEREGISTERED and state 5GMM-REGISTERED\n5.2.1\tGeneral\nIn this subclause, the detailed behaviour of the UE in the states 5GMM-DEREGISTERED and 5GMM-REGISTERED is described.\n5.2.2\tUE behaviour in state 5GMM-DEREGISTERED\n5.2.2.1\tGeneral\nThe state 5GMM-DEREGISTERED is entered in the UE, when:\na)\tthe de-registration is performed either by the UE or by the network (see subclause\u00a05.5.2);\nb)\tthe registration request is rejected by the AMF (see subclause\u00a05.5.1.2.5 and 5.5.1.3.5);\nc)\tthe service request is rejected by the AMF (see subclause\u00a05.6.1);\nd)\tthe UE is switched on; or\ne)\tthe UE registered for emergency services is in 5GMM-IDLE mode and its periodic registration update timer expires (see subclause\u00a05.3.7).\nIn state 5GMM-DEREGISTERED, the UE shall behave according to the substate as explained in subclause\u00a05.2.2.3.\n5.2.2.2\tPrimary substate selection\n5.2.2.2.1\tSelection of the substate after power on\nFor a UE configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], timers T3444 and T3445 are considered to have expired at power on. When the UE is switched on, the substate shall be PLMN-SEARCH if the USIM is available and valid or there are valid entries in the \"list of subscriber data\". See 3GPP\u00a0TS\u00a023.122\u00a0[5] for further details.\nThe substate chosen after PLMN-SEARCH, following power on is:\na)\tif no cell can be selected, the substate shall be NO-CELL-AVAILABLE;\nb)\tif the UE is not operating in SNPN access operation mode, and no USIM is present, or the USIM is considered invalid by the UE, the substate shall be NO-SUPI;\nc)\tif the UE is operating in SNPN access operation mode, and:\n1)\tthe selected entry in the \"list of subscriber data\" does not contain subscription identifier, and no USIM is present, or the USIM is considered invalid by the UE; or\n2)\tno valid entry in the \"list of subscriber data\" exists;\nthe substate shall be NO-SUPI;\nd)\tif a suitable cell has been found:\n1)\tthe PLMN identity of the cell is not in one of the forbidden PLMN lists;\n2)\tif the SNPN is not an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), the SNPN identity of the cell is not in one of the \"permanently forbidden SNPNs\" list or the \"temporarily forbidden SNPNs\" list which are, if the MS supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription ; or\n3)\tif the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), the SNPN identity of the cell is not in one of the \"permanently forbidden SNPNs for access for localized services in SNPN\" list or \"temporarily forbidden SNPNs for access for localized services in SNPN\" list, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription;\nand the tracking area is not in one of the lists of 5GS forbidden tracking areas, then the substate shall be NORMAL-SERVICE;\ne)\tif the selected cell is known not to be able to provide normal service, then the UE shall enter the substate LIMITED-SERVICE;\nf)\tif the UE is in manual network selection mode and no cell of the selected PLMN or SNPN has been found, the UE shall enter the substate NO-CELL-AVAILABLE; and\ng)\tif the UE is configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], the substate shall be eCALL-INACTIVE.\n5.2.2.3\tDetailed description of UE behaviour in state 5GMM-DEREGISTERED\n5.2.2.3.1\tNORMAL-SERVICE\nThe UE shall initiate an initial registration procedure if the timer T3346 is not running. If timer T3346 is running, the UE shall initiate an initial registration procedure on the expiry of timer T3346.\nThe UE may initiate an initial registration procedure for emergency services or for a UE configured for high priority access in selected PLMN or SNPN, even if timer T3346 is running.\n5.2.2.3.2\tLIMITED-SERVICE\nThe UE shall initiate an initial registration procedure when entering a cell which provides normal service.\nThe UE may initiate initial registration for emergency services.\n5.2.2.3.3\tATTEMPTING-REGISTRATION\nThe UE in 3GPP access:\na)\tshall initiate an initial registration procedure on the expiry of timers T3502, T3511 or T3346;\nb)\tmay initiate an initial registration procedure for emergency services even if timers T3502, T3511 or T3346 are running;\nb1)\tmay initiate an initial registration procedure even if timer T3502, T3346 or T3447 is running, if the UE is a UE configured for high priority access in selected PLMN;\nb2)\tmay initiate an initial registration procedure even if timer T3502, T3346 is running, if the UE is a UE configured for high priority access in selected SNPN;\nc)\tshall initiate an initial registration procedure when entering a new PLMN or SNPN, except\ni)\tif timer T3346 is running and the new PLMN or SNPN is equivalent to the PLMN or SNPN where the UE started timer T3346;\nii)\tif the PLMN identity of the new cell is in the forbidden PLMN lists;\niii)\tif the SNPN is not an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), the SNPN identity of the new cell is in the \"permanently forbidden SNPNs\" list or the \"temporarily forbidden SNPNs\" list which are, if the MS supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription;\niv)\tif the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), the SNPN identity of the new cell is in the \"permanently forbidden SNPNs for access for localized services in SNPN\" list or the \"temporarily forbidden SNPNs for access for localized services in SNPN\" list, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription; or\nv)\tif the current TAI is in one of the lists of 5GS forbidden tracking areas;\nd)\tshall initiate an initial registration procedure when the current TAI has changed, if timer T3346 is not running, the PLMN identity of the new cell is not in one of the forbidden PLMN lists or the SNPN identity of the new cell is in neither the \"permanently forbidden SNPNs\" list nor the \"temporarily forbidden SNPNs\" list which are, if the MS supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, and the current TAI is not in one of the lists of 5GS forbidden tracking areas;\ne)\tshall initiate an initial registration procedure if the 5GS update status is set to 5U2 NOT UPDATED, and timers T3511, T3502 and T3346 are not running;\nf)\tmay initiate an initial registration procedure for UE in NB-N1 mode upon receiving a request from upper layers to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP\u00a0TS\u00a024.368\u00a0[17]) or the USIM file EFNASCONFIG in 3GPP\u00a0TS\u00a031.102\u00a0[22]) if timer T3346 is not already running for \"MO exception data\" and even if timer T3502 or timer T3511 is running; and\ng)\tmay initiate an initial registration procedure with 5GS registration type IE set to \"initial registration\" for initiating of an emergency PDU session, upon request of the upper layers to establish the emergency PDU session.\nThe UE in non-3GPP access:\na)\tshall initiate an initial registration procedure on the expiry of timers T3502, T3511 or T3346;\nb)\tmay initiate an initial registration procedure for emergency services even if timers T3502, T3511 or T3346 are running;\nb1)\tmay initiate an initial registration procedure even if timer T3502 or T3346 is running if the UE is a UE configured for high priority access in selected PLMN;\nc)\tshall initiate an initial registration procedure when entering a new PLMN or SNPN, except if timer T3346 is running and the new PLMN or SNPN is equivalent to the PLMN or SNPN where the UE started timer T3346;\nd)\tshall initiate an initial registration procedure if the 5GS update status is set to 5U2 NOT UPDATED, and timers T3511, T3502 and T3346 are not running; and\ne)\tmay initiate an initial registration procedure with 5GS registration type IE set to \"initial registration\" for initiating of an emergency PDU session, upon request of the upper layers to establish the emergency PDU session.\n5.2.2.3.4\tPLMN-SEARCH\nThe UE shall perform PLMN selection or SNPN selection. If a new PLMN or SNPN is selected, the UE shall reset the registration attempt counter and initiate the registration procedure for initial registration (see subclause\u00a05.5.1.2.2).\nIf the selected cell in the new PLMN is known not to be able to provide normal service, the UE may initiate the registration procedure for initial registration for emergency services.\n5.2.2.3.5\tNO-SUPI\nThe UE may initiate the registration procedure for initial registration for emergency services.\n5.2.2.3.6\tNO-CELL-AVAILABLE\nThe UE shall perform cell selection and choose an appropriate substate when a cell is found.\n5.2.2.3.7\teCALL-INACTIVE\nThe UE camps on a suitable cell or an acceptable cell in a PLMN selected as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] but initiates no 5GMM signalling with the network and ignores any paging requests.\nThe UE shall leave substate 5GMM-DEREGISTERED.eCALL-INACTIVE state only when one of the following events occur:\na)\tif the USIM is removed, the UE enters substate 5GMM-DEREGISTERED.NO-SUPI;\nb)\tif coverage is lost, the UE enters substate 5GMM-DEREGISTERED.PLMN-SEARCH;\nc)\tif the UE is deactivated (e.g. powered off) by the user, the UE enters state 5GMM-NULL;\nd)\tif the UE receives a request from upper layers to establish an eCall over IMS, the UE enters state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION. The UE then uses the relevant 5GMM and 5GSM procedures to establish the eCall over IMS at the earliest opportunity; or\ne)\tif the UE receives a request from upper layers to establish a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service, the UE enters state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION. Once the registration procedure is completed, the UE uses the relevant 5GMM and 5GSM procedures to establish the non-emergency call.\n5.2.2.3.8\tINITIAL-REGISTRATION-NEEDED\nThe UE shall initiate the initial registration procedure, if still needed, as soon as the access is allowed in the selected cell for the UE.\nThe UE may initiate registration procedure for emergency services.\n5.2.2.4\tSubstate when back to state 5GMM-DEREGISTERED from another 5GMM state\nWhen returning to state 5GMM-DEREGISTERED, the UE shall select a cell as specified in 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C].\nThe substate depends on the result of the cell selection procedure, the outcome of the previously performed 5GMM specific procedures, on the 5GS update status of the UE, on the tracking area data stored in the UE, on the presence of the USIM, on the UE configuration and on the reason for moving to 5GMM-DEREGISTERED:\na)\tIf no cell has been found, the substate is NO-CELL-AVAILABLE, until a cell is found;\nb)\tIf no USIM is present or if the inserted USIM is considered invalid by the UE, the substate shall be NO-SUPI;\nc)\tIf a suitable cell has been found and the PLMN or tracking area is not in one of the forbidden lists, the substate shall be NORMAL-SERVICE;\nd)\tIf an initial registration shall be performed (e.g. network-requested re-registration), the substate shall be ATTEMPTING-REGISTRATION;\ne)\tIf a PLMN reselection or SNPN reselection (according to 3GPP\u00a0TS\u00a023.122\u00a0[5]) is needed, the substate shall be PLMN-SEARCH;\nf)\tIf the selected cell is known not to be able to provide normal service, the substate shall be LIMITED-SERVICE; and\ng)\tIf the UE is configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], T3444 and T3445 have expired or are not running, and substate PLMN-SEARCH is not required, the substate shall be eCALL-INACTIVE.\n5.2.3\tUE behaviour in state 5GMM-REGISTERED\n5.2.3.1\tGeneral\nThe state 5GMM-REGISTERED is entered at the UE, when the initial registration procedure is performed by the UE (see subclause\u00a05.5.1.2.2).\nIn state 5GMM-REGISTERED, the UE shall behave according to the substate as explained in subclause\u00a05.2.3.2.\n5.2.3.2\tDetailed description of UE behaviour in state 5GMM-REGISTERED\n5.2.3.2.1\tNORMAL-SERVICE\nThe UE:\na)\tshall initiate the mobility or the periodic registration update procedure (according to conditions given in subclause\u00a05.5.1.3.2), except that the periodic registration update procedure shall not be initiated over non-3GPP access;\nb)\tshall initiate the service request procedure (according to conditions given in subclause\u00a05.6.1);\nc)\tshall respond to paging;\nNOTE\u00a01:\tPaging is not supported over non-3GPP access.\nNOTE\u00a02:\tAs an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.\nd)\tif configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], shall perform the eCall inactivity procedure at expiry of timer T3444 or timer T3445 (see subclause\u00a05.5.3); and\ne)\tshall initiate a registration procedure for mobility and periodic registration update on the expiry of timer T3511; and\nf)\tif acting as a 5G ProSe UE-to-network relay UE as specified in 3GPP\u00a024.554\u00a0[19E], shall initiate the authentication and key agreement procedure (according to the conditions given in subclause\u00a05.5.4).\n5.2.3.2.2\tNON-ALLOWED-SERVICE\nThe UE shall behave as specified in subclause\u00a05.3.5.\nThe UE in 5GMM-REGISTERED.NON-ALLOWED-SERVICE substate, if configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], shall perform the eCall inactivity procedure at expiry of timer T3444 or timer T3445 (see subclause\u00a05.5.3).\n5.2.3.2.3\tATTEMPTING-REGISTRATION-UPDATE\nThe UE in 3GPP access:\na)\tshall not send any user data;\nb)\tshall initiate a registration procedure for mobility and periodic registration update on the expiry of timers T3502, T3511, T3346 or discontinuous coverage maximum time offset timer;\nc)\tshall initiate a registration procedure for mobility and periodic registration update when entering a new PLMN or SNPN, if timer T3346 is running and the new PLMN or SNPN is not equivalent to the PLMN or SNPN where the UE started timer T3346, the PLMN identity of the new cell is not in the forbidden PLMN lists, and the current TAI is not in one of the lists of 5GS forbidden tracking areas;\nd)\tshall initiate a registration procedure for mobility and periodic registration update when the current TAI has changed, if timer T3346 is not running:\ni)\tthe PLMN identity of the new cell is not in one of the forbidden PLMN lists;\nii)\tif the SNPN is not an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), the SNPN identity of the new cell is in neither the \"permanently forbidden SNPNs\" list nor the \"temporarily forbidden SNPNs\" list which are, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription or\niii)\tif the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), the SNPN identity of the new cell is in neither the \"permanently forbidden SNPNs for access for localized services in SNPN\" list nor the \"temporarily forbidden SNPNs for access for localized services in SNPN\" list, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription;\nand the current TAI is not in one of the lists of 5GS forbidden tracking areas;\ne)\tmay initiate a registration procedure for mobility and periodic registration update upon request of the upper layers to establish an emergency PDU session or perform emergency service fallback;\ne1)\tmay initiate a registration procedure for mobility and periodic registration update upon request of the upper layers to establish a PDU session, even if timer T3502, T3346 or T3447 is running, if the UE is a UE configured for high priority access in the selected PLMN;\ne2)\tmay initiate a registration procedure for mobility and periodic registration update upon request of the upper layers to establish a PDU session, even if timer T3502, T3346 is running, if the UE is a UE configured for high priority access in selected SNPN;\nf)\tmay perform de-registration locally and initiate a registration procedure for initial registration for emergency services even if timer T3346 is running;\ng)\tshall initiate registration procedure for mobility and periodic registration update upon reception of paging, or upon reception of NOTIFICATION message with access type indicating 3GPP access;\nNOTE:\tAs an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.\nh)\tmay initiate a registration procedure for mobility and periodic registration update upon request for an MMTEL voice call, MMTEL video call, or an MO IMS registration related signalling from the upper layers, and none of the following conditions is met:\n1)\ttimer T3346 is running;\n2)\tthe UE has stored a list of \"non-allowed tracking areas\" and the current TAI is in the list of \"non-allowed tracking areas\"; or\n3)\tthe UE has stored a list of \"allowed tracking areas\", the UE is camped on a cell which is in the registered PLMN, a PLMN from the list of equivalent PLMNs, or the registered SNPN, and the current TAI is not in the list of \"allowed tracking areas\";\ni)\tshall initiate a registration procedure for mobility and periodic registration update if the 5GS update status is set to 5U2 NOT UPDATED, and timers T3511, T3502 and T3346 are not running;\nj)\tif configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], shall perform the eCall inactivity procedure at expiry of timer T3444 or timer T3445 (see subclause\u00a05.5.3);\nk)\tmay initiate a registration procedure for mobility and periodic registration update for UE in NB-N1 mode upon receiving a request from upper layers to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP\u00a0TS\u00a024.368\u00a0[17]) or the USIM file EFNASCONFIG in 3GPP\u00a0TS\u00a031.102\u00a0[22]) if timer T3346 is not already running for \"MO exception data\" and even if timer T3502 or timer T3511 is running; \nl)\tshall not initiate the de-registration signalling procedure with de-registration type \"normal de-registration\" unless the current TAI is part of the TAI list; and\nm)\tshall initiate a registration procedure for mobility and periodic registration update if the UE supports the reconnection to the network due to RAN timing synchronization status change and receives an indication of a change in the RAN timing synchronization status, even if timer T3502 is running.\nThe UE in non-3GPP access:\na)\tshall not send any user data;\nb)\tshall initiate the registration procedure for mobility and periodic registration update on the expiry of timers T3502, T3511 or T3346;\nc)\tmay initiate a registration procedure for mobility registration update upon request of the upper layers to establish an emergency PDU session;\nc1)\tmay initiate a registration procedure for mobility and periodic registration update upon request of the upper layers to establish a PDU session, if the UE is a UE configured for high priority access in selected PLMN even if timer T3346 or T3502 is running;\nd)\tmay perform de-registration locally and initiate a registration procedure for initial registration for emergency services even if timer T3346 is running;\ne)\tmay initiate a registration procedure for mobility and periodic registration update upon request for an MMTEL voice call, MMTEL video call, or an MO IMS registration related signalling from the upper layers, if timer T3346 is not running;\nf)\tshall initiate a registration procedure for mobility and periodic registration update if the 5GS update status is set to 5U2 NOT UPDATED, and timers T3511, T3502 and T3346 are not running; and\ng)\tshall not initiate the de-registration signalling procedure unless timer T3346 is running.\n5.2.3.2.4\tLIMITED-SERVICE\nThe UE:\na)\tshall perform cell selection/reselection;\nb)\tmay perform de-registration locally and initiate an initial registration for emergency services; and\nc)\tif configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], shall perform the eCall inactivity procedure at expiry of timer T3444 or timer T3445 (see subclause\u00a05.5.3).\n5.2.3.2.5\tPLMN-SEARCH\nThe UE shall perform PLMN selection or SNPN selection. If a new PLMN is selected, the UE shall reset the registration attempt counter and initiate a registration procedure for mobility and periodic registration update (see subclause\u00a05.5.1.3). If a new SNPN is selected, the UE shall reset the registration attempt counter and initiate a mobility registration update if the UE supports access to an SNPN using credentials from a credentials holder or when the SNPNs are equivalent SNPNs or both (see subclause\u00a04.14.2) and the last registered SNPN and the newly selected SNPN are both identified by globally-unique SNPN identities. Otherwise the UE, may perform de-registration locally and shall initiate a registration procedure for initial registration (see subclause\u00a05.5.1.2.2).If the selected cell in the new PLMN is known not to be able to provide normal service, the UE may perform de-registration locally and initiate an initial registration for emergency services.\n5.2.3.2.6\tNO-CELL-AVAILABLE\nThe UE shall perform cell selection and choose an appropriate substate when a cell is found.\n5.2.3.2.7\tUPDATE-NEEDED\nThe UE:\na)\tshall not send any user data;\nb)\tshall not send signalling information, unless it is a service request as a response to paging or to initiate signalling for emergency services or emergency services fallback;\nc)\tshall perform cell selection/reselection;\nd)\tshall enter the appropriate new substate as soon as the lower layers indicate that the barring is alleviated for the access category with which the access attempt for the registration procedure for mobility and periodic registration update was associated and, if still needed, start the registration procedure for mobility and periodic registration update or de-registration procedure (see subclauses\u00a05.5.1.3.7, item\u00a0l, and 5.5.2.2.6, item\u00a0b); and\ne)\tif configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause\u00a05.5.3).\n5.3\tGeneral on elementary 5GMM procedures\n5.3.1\t5GMM modes and N1 NAS signalling connection\n5.3.1.1\tEstablishment of the N1 NAS signalling connection\nWhen the UE is in 5GMM-IDLE mode over 3GPP access and needs to transmit an initial NAS message, the UE shall request the lower layer to establish an RRC connection. Upon indication from the lower layers that the RRC connection has been established, the UE shall consider that the N1 NAS signalling connection over 3GPP access is established and enter 5GMM-CONNECTED mode over 3GPP access.\nWhen the UE is in 5GMM-IDLE mode over non-3GPP access, and the UE receives an indication from the lower layers of non-3GPP access, that the access stratum connection is established between the UE and the network, the UE shall send an initial NAS message, consider the N1 NAS signalling connection is established and enter 5GMM-CONNECTED mode over non-3GPP access.\nInitial NAS messages are:\na)\tREGISTRATION REQUEST message;\nb)\tDEREGISTRATION REQUEST message;\nc)\tSERVICE REQUEST message; and\nd)\tCONTROL PLANE SERVICE REQUEST.\nIf the UE is capable of both N1 mode and S1 mode and lower layers provide an indication that the current E-UTRA cell is connected to both EPC and 5GCN, for the routing of the REGISTRATION REQUEST message during the initial registration procedure to the appropriate core network (EPC or 5GCN), the UE NAS provides the lower layers with the selected core network type information.\nFor the routing of the initial NAS message to the appropriate AMF, if the UE holds a 5G-GUTI or 4G-GUTI, the UE NAS provides the lower layers with the UE identity according to the following rules:\na)\tif the registration procedure for mobility and periodic registration update was triggered due to the last CONFIGURATION UPDATE COMMAND message containing the Configuration update indication IE with the Registration bit set to \"registration requested\" and including:\n1)\tno other parameters;\n2)\tone or both of the Allowed NSSAI IE and the Configured NSSAI IE; or\n3)\tthe Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\";\n\tthe UE NAS shall not provide the lower layers with the 5G-S-TMSI or the registered GUAMI;\nb)\tif the service request procedure was initiated over non-3GPP access, the UE NAS shall provide the lower layers with the registered GUAMI, but shall not provide the lower layers with the 5G-S-TMSI;\nc)\tif the initial NAS message other than the SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message was initiated over untrusted non-3GPP access, the UE NAS shall provide the lower layers with the GUAMI of the 5G-GUTI that the UE NAS has selected as specified in the subclause\u00a05.5.1.2.2 and 5.5.1.3.2, but shall not provide the lower layers with the 5G-S-TMSI;\n\tif the initial NAS message other than the SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message was initiated over trusted non-3GPP access, the UE NAS shall provide the lower layers with the 5G-GUTI, if available, otherwise shall provide the lower layers with the SUCI;\n\tif the UE is the 5G-RG and the initial NAS message other than the SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message was initiated over wireline access, the UE NAS shall provide the lower layers with the GUAMI of the 5G-GUTI that the UE NAS has selected as specified in the subclause\u00a05.5.1.2.2 and 5.5.1.3.2, if available, otherwise shall not provide the lower layers with any UE identity;\nd)\tif the UE does not hold a 5G-GUTI that was previously assigned by the same PLMN with which the UE is performing the registration procedure and if:\n1)\tthe UE operating in the single-registration mode performs a registration procedure for mobility and periodic registration update indicating \"mobility registration updating\" following an inter-system change from S1 mode to N1 mode; or\n2)\tthe UE which was previously registered in S1 mode before entering state EMM-DEREGISTERED, performs an initial registration procedure, the UE has received the interworking without N26 interface indicator set to \"interworking without N26 interface not supported\" from the network, and the UE holds a 4G-GUTI;\n\tthen the UE NAS provides the lower layers with a GUAMI part of the 5G-GUTI mapped from 4G-GUTI as specified in 3GPP\u00a0TS\u00a023.003\u00a0[4] with an indication that the GUAMI is mapped from EPS; or\ne)\totherwise:\n1)\tif the tracking area of the current cell is in the registration area, the UE NAS shall provide the lower layers with the 5G-S-TMSI, but shall not provide the registered GUAMI to the lower layers; or\n2)\tif the tracking area of the current cell is not in the registration area, the UE NAS shall provide the lower layers with the GUAMI of the 5G-GUTI that the UE NAS has selected as specified in the subclauses\u00a05.5.1.2.2 and 5.5.1.3.2, but shall not provide the lower layers with the 5G-S-TMSI.\nFor 3GPP access, if: \na)\tthe UE is operating in single-registration mode, the UE does not hold a 5G-GUTI and the UE does not hold a 4G-GUTI; or\nb)\tthe UE is operating in dual-registration mode and the UE does not hold a 5G-GUTI;\nthe UE NAS does not provide the lower layers with the 5G-S-TMSI or the registered GUAMI.\nFor untrusted non-3GPP access, if the UE does not hold a 5G-GUTI and the UE does not hold a 4G-GUTI, the UE NAS does not provide the lower layers with the 5G-S-TMSI or the registered GUAMI. For trusted non-3GPP access, if the UE does not hold a 5G-GUTI and the UE does not hold a 4G-GUTI, the UE NAS provides the lower layers with the SUCI.\nFor 3GPP access, if a UE operating as an IAB-node performs a registration procedure or service request procedure (see 3GPP\u00a0TS\u00a023.501\u00a0[8]), the UE NAS shall indicate to the lower layers that the establishment of the NAS signalling connection is for a UE operating as an IAB-node.\nThe UE NAS also provides the lower layers with the identity of the selected PLMN (see 3GPP\u00a0TS\u00a038.331\u00a0[30]) if the UE is not operating in SNPN access operation mode. If the UE is operating in SNPN access operation mode, the UE NAS provides the lower layers with the SNPN identity of the selected SNPN. In a shared network, the UE shall choose one of the PLMN identity(ies) or SNPN identity(ies) as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] and 3GPP\u00a0TS\u00a024.502\u00a0[18].\nThe UE NAS layer may provide the lower layers with an NSSAI as specified in subclause\u00a04.6.2.3.\nIf the UE performs initial registration for onboarding services in SNPN or is registered for onboarding services in SNPN, the UE NAS layer shall provide the lower layers with an indication that the connection is for onboarding.\n5.3.1.2\tRe-establishment of the N1 NAS signalling connection\nWhen the UE in 5GMM-CONNECTED mode over 3GPP access receives a fallback indication from lower layers, and the UE has no pending NAS procedure and no pending uplink user data for PDU session(s) with user-plane resources already established, the UE shall:\na)\tenter 5GMM-IDLE mode; and\nb)\tinitiate the registration procedure for mobility and periodic registration update and include the Uplink data status IE in the REGISTRATION REQUEST message indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any (see subclause\u00a05.5.1.3 for further details).\nWhen the UE in 5GMM-CONNECTED mode over 3GPP access receives a fallback indication from lower layers, and the UE has pending uplink user data for PDU session(s) with user-plane resources already established but no pending NAS procedure, the UE shall:\na)\tenter 5GMM-IDLE mode; and\nb)\tinitiate the service request procedure and include the Uplink data status IE in the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication (see subclause\u00a05.6.1 for further details).\nWhen the UE in 5GMM-CONNECTED mode over 3GPP access receives a fallback indication from lower layers, and the UE has a pending registration procedure, a service request procedure, or a de-registration procedure, the UE shall:\na)\tenter 5GMM-IDLE mode;\nb)\tproceed with the pending procedure; and\nc)\tif the pending procedure is a service request or registration procedure and the SERVICE REQUEST message, the CONTROL PLANE SERVICE REQUEST message or the REGISTRATION REQUEST message does not include UE request type IE with Request type value set to \"NAS signalling connection release\", the UE shall include the Uplink data status IE in the SERVICE REQUEST message, the CONTROL PLANE SERVICE REQUEST message, or in the REGISTRATION REQUEST message, indicating the PDU session(s) for which user-plane resources were not active prior to receiving a fallback indication from the lower layers and the UE has pending user data to be sent over 3GPP access, if any, and the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any (see subclauses\u00a05.5.1.3 and 5.6.1 for further details).\nWhen the UE in 5GMM-CONNECTED mode over 3GPP access receives a fallback indication from lower layers, and the UE has a pending NAS procedure other than a registration procedure, a service request procedure, or a de-registration procedure, the UE shall:\na)\tenter 5GMM-IDLE mode;\nb)\tinitiate the service request procedure and include the Uplink data status IE in the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any (see subclause\u00a05.6.1 for further details); and\nc)\tupon successful service request procedure completion, proceed with any pending procedure.\nWhen the UE in 5GMM-CONNECTED mode over 3GPP access receives a fallback indication from lower layers, and the UE has no pending NAS procedure and no pending uplink user data for PDU session(s) with user-plane resources already established, and the UE was using network resources for 5G ProSe direct discovery over PC5 or 5G ProSe direct communication over PC5 (see 3GPP\u00a0TS\u00a023.304\u00a0[6E]), the UE shall:\na)\tenter 5GMM-IDLE mode; and\nb)\tinitiate the service request procedure and include the Uplink data status IE in the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any (see subclause\u00a05.6.1 for further details).\nThe UE which supports S-NSSAI location validity information, and which has received S-NSSAI location validity information from the AMF, shall include the Uplink data status IE in the REGISTRATION REQUEST message, the SERVICE REQUEST message, or the CONTROL PLANE SERVICE REQUEST message, to indicate the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, as described above, only if the UE is inside the NS-AoS with respect to the S-NSSAI which is associated with a PDU session.\nThe cases above apply when the UE is in an allowed area or when the UE is not in a non-allowed area.\nWhen the UE:\na)\tis in a non-allowed area or is not in an allowed area;\nb)\tis in 5GMM-CONNECTED mode over 3GPP access;\nc)\treceives a fallback indication from lower layers; and\nd)\tdoes not have signalling pending,\nthe UE shall:\na)\tenter 5GMM-IDLE mode; and\nb)\tinitiate the registration procedure for mobility and periodic registration update. The UE shall not include the Uplink data status IE in the REGISTRATION REQUEST message except if the PDU session for which user-plane resources were active is an emergency PDU session, or if the UE is configured for high priority access in selected PLMN or SNPN.\nIn the above cases when the UE receives a fallback indication from lower layers, if the UE is in non-allowed area or not in allowed area, the UE shall behave as specified in subclause\u00a05.3.5.\n5.3.1.3\tRelease of the N1 NAS signalling connection\nThe signalling procedure for the release of the N1 NAS signalling connection is initiated by the network.\nIn N1 mode, upon indication from lower layers that the access stratum connection has been released, the UE shall enter 5GMM-IDLE mode and consider the N1 NAS signalling connection released.\nIf the UE in 3GPP access is configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22] then:\n-\tif the N1 NAS signalling connection that was released had been established for eCall over IMS was released, the UE shall start timer T3444; and\n-\tif the N1 NAS signalling connection that was released had been established for a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service was released, the UE shall start timer T3445.\nThe UE shall start the timer T3447 if not already running when the N1 NAS signalling connection is released as specified in subclause\u00a05.3.17.\nTo allow the network to release the N1 NAS signalling connection, the UE:\na)\tshall start the timer T3540 if the UE receives any of the 5GMM cause values #7, #11, #12, #13, #15, #27, #31, #62, #72, #73, #74, #75, #76, #78and the UE does not consider the received 5GMM cause value as abnormal case as specified in subclauses\u00a05.5.1.2.7,\u00a05.5.1.3.7 and\u00a05.5.2.3.4;\na1)\tshall start the timer T3540 if the UE receives a SERVICE REJECT, case i) in subclause\u00a05.6.1.7 is applicable and the procedure was started from 5GMM-IDLE mode;\nb)\tshall start the timer T3540 for a UE in 3GPP access if:\n1)\tthe UE receives a REGISTRATION ACCEPT message which does not include a Pending NSSAI IE or UE radio capability ID deletion indication IE;\n2)\tthe UE has set the Follow-on request indicator to \"No follow-on request pending\" in the REGISTRATION REQUEST message;\n3)\tthe UE has not included the Uplink data status IE in the REGISTRATION REQUEST message, or the UE has included the Uplink data status IE in the REGISTRATION REQUEST message but the REGISTRATION ACCEPT message indicates that no user-plane resources of any PDU sessions are to be re-established;\n4)\tthe UE has not included the Allowed PDU session status IE or has included the Allowed PDU session status IE indicating there is no PDU session(s) for which the UE allowed the user-plane resource to be re-established over 3GPP access in the REGISTRATION REQUEST message, or the UE has included the Allowed PDU session status IE in the REGISTRATION REQUEST message but the REGISTRATION ACCEPT message does not indicate that any user-plane resources of any PDU sessions are to be re-established;\n5)\tthe registration procedure has been initiated in 5GMM-IDLE mode, or the UE has set Request type to \"NAS signalling connection release\" in the UE request type IE in the REGISTRATION REQUEST message and the N1 NAS signalling connection release bit is set to \"N1 NAS signalling connection release supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message;\n6)\tthe user-plane resources for PDU sessions have not been set up, except for the case the UE has set Request type to \"NAS signalling connection release\" in the UE request type IE in the REGISTRATION REQUEST message and the N1 NAS signalling connection release bit is set to \"N1 NAS signalling connection release supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message;\n7)\tthe UE need not request resources for V2X communication over PC5 reference point (see 3GPP\u00a0TS\u00a023.287\u00a0[6C]);\n8)\tthe UE has included unavailability information and has not included the start of unavailability period in the REGISTRATION REQUEST message;\n9)\tthe UE need not request resources for 5G ProSe direct discovery over PC5 or 5G ProSe direct communication over PC5 (see 3GPP\u00a0TS\u00a023.304\u00a0[6E]); and\n10)\tthe UE need not request resources for A2X communication over PC5 reference point (see 3GPP\u00a0TS\u00a023.256\u00a0[6AB]);\nNOTE\u00a01:\tThe lower layers indicate when the user-plane resources for PDU sessions are successfully established or released.\nc)\tshall start the timer T3540 if the UE receives a REGISTRATION REJECT message indicating:\n\tthe 5GMM cause value #9 or #10;\nd)\tshall start the timer T3540 if the UE receives a SERVICE REJECT message indicating:\n\tthe 5GMM cause value #9, #10; or \n\tthe 5GMM cause value #28 and with no emergency PDU session has been established;\ne)\tshall start the timer T3540 if:\n1)\tthe UE receives a CONFIGURATION UPDATE COMMAND message containing the Configuration update indication IE with the Registration bit set to \"registration requested\" and with:\ni)\teither new allowed NSSAI information or new configured NSSAI information or both included;\nii)\tthe network slicing subscription change indication; or\niii)\tno other parameters; and\n2)\tthe user-plane resources for PDU sessions have not been set up;\nf)\tshall start the timer T3540 for a UE in 3GPP access if:\n1)\tthe UE receives a SERVICE ACCEPT message;\n2)\tfor the case that the UE sent the:\ni)\tSERVICE REQUEST message, the UE did not set the Service type IE to \"signalling\" or \"high priority access\", the UE has not included the Uplink data status IE in the SERVICE REQUEST message, or the UE has included the Uplink data status IE in the SERVICE REQUEST message but the SERVICE ACCEPT message indicates that no user-plane resources of any PDU sessions are to be re-established; or\nii)\tCONTROL PLANE SERVICE REQUEST message, the UE did not set the Control plane service type IE to \"emergency services fallback\", the UE has not included the Uplink data status IE in the CONTROL PLANE SERVICE REQUEST message, or the UE has included the Uplink data status IE in the CONTROL PLANE SERVICE REQUEST message but the SERVICE ACCEPT message indicates that no user-plane resources of any PDU sessions are to be re-established;\n3)\tthe UE has not included the Allowed PDU session status IE or has included the Allowed PDU session status IE indicating there is no PDU session(s) for which the UE allowed the user-plane resource to be re-established over 3GPP access in the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message, or the UE has included the Allowed PDU session status IE in the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message but the SERVICE ACCEPT message does not indicate that any user-plane resources of any PDU sessions are to be re-established;\n4)\tthe service request procedure has been initiated in 5GMM-IDLE mode;\n5)\tthe user-plane resources for PDU sessions have not been set up;\n6)\tthe UE need not request resources for V2X communication over PC5 reference point (see 3GPP\u00a0TS\u00a023.287\u00a0[6C]); \n7)\tthe UE need not request resources for 5G ProSe direct discovery over PC5 or 5G ProSe direct communication over PC5 (see 3GPP\u00a0TS\u00a023.304\u00a0[6E]); and\n8)\tthe UE need not request resources for A2X communication over PC5 reference point (see 3GPP\u00a0TS\u00a023.256\u00a0[6AB]);\nNOTE\u00a02:\tThe lower layers indicate when the user-plane resources for PDU sessions are successfully established or released.\ng)\tmay start the timer T3540 if the UE receives any of the 5GMM cause values #3 or #6 or if it receives an AUTHENTICATION REJECT message;\nh)\tshall start the timer T3540 for a UE in 3GPP access upon completion of the configuration update procedure or the registration procedure if the UE does not have an emergency PDU session and:\n1)\tthe UE received a CONFIGURATION UPDATE COMMAND message or a REGISTRATION ACCEPT message while camping on a CAG cell and none of the CAG-ID(s) supported by the current CAG cell is authorized based on \"Allowed CAG list\" of the entry for the current PLMN in the received \"CAG information list\";\n2)\tthe UE received a CONFIGURATION UPDATE COMMAND message or a REGISTRATION ACCEPT message while camping on a non-CAG cell and the entry for the current PLMN in the received \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\"; or\n3)\tthe UE received a CONFIGURATION UPDATE COMMAND message while camping on a CAG cell and the entry for the current PLMN in not included in the received \"CAG information list\"; or\ni)\tshall start the timer T3540 for a UE in 3GPP access if:\n1)\tthe UE receives a SERVICE ACCEPT message; and\n2)\tthe UE:\n-\thas set Request type to \"NAS signalling connection release\" in the UE request type IE in the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message; or\n-\thas set Request type to \"Rejection of paging\" in the UE request type IE in the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message and the UE receives a CONFIGURATION UPDATE COMMAND message;\nj)\tshall start the timer T3540 if:\n1) the UE receives the 5GMM cause value #22 along with a T3346 value in the SERVICE REJECT message, the value indicates that the timer T3346 is neither zero nor deactivated and the service request procedure has been initiated in 5GMM-IDLE mode; or\n2)\tthe UE receives the 5GMM cause value #22 along with a T3346 value in the message different from the SERVICE REJECT message, and the value indicates that the timer T3346 is neither zero nor deactivated; or\nk)\tshall start the timer T3540 if the UE receives a DEREGISTRATION ACCEPT message.\nl)\tshall start the timer T3540 after the completion of the de-registration procedure, if the UE receives a DEREGISTRATION REQUEST message and the de-registration type indicates \"re-registration required\".\nUpon expiry of T3540,\n-\tin cases a), a1), b), f), g), h), i), j) and k) the UE shall locally release the established N1 NAS signalling connection;\n-\tin cases c) and d) the UE shall locally release the established N1 NAS signalling connection and the UE shall initiate the registration procedure as described in subclause\u00a05.5.1.3 or\u00a05.6.1.5; or\n-\tin case e), the UE shall locally release the established N1 NAS signalling connection and perform a new registration procedure as specified in subclause\u00a05.5.1.3.2.\n-\tin case l), the UE shall locally release the established N1 NAS signalling connection and initiate the registration procedure as specified in subclause\u00a05.5.1.2.2.\nIn case a),\n-\tupon receiving a request from the upper layers to perform emergency services fallback only for a UE in 3GPP access or establishing an emergency PDU session, the UE shall stop timer T3540 and shall locally release the N1 NAS signalling connection, before proceeding as specified in subclause\u00a05.5.1.\nIn case b) and f),\n-\tupon an indication from the lower layers that the user-plane resources for PDU sessions are set up, the UE shall stop timer T3540 and may send uplink signalling via the existing N1 NAS signalling connection or user data via user plane. If the uplink signalling is associated with emergency services fallback only for a UE in 3GPP access or establishing an emergency PDU session, the UE shall stop timer T3540 and send the uplink signalling via the existing N1 NAS signalling connection;\nIn case b), f) and i),\n-\tupon receipt of a DEREGISTRATION REQUEST message, the UE shall stop timer T3540 and respond to the network-initiated de-registration request via the existing N1 NAS signalling connection as specified in subclause\u00a05.5.2.3;\n-\tupon receipt of a message of a network-initiated 5GMM common procedure , the UE shall stop timer T3540 and respond to the network-initiated 5GMM common procedure via the existing N1 NAS signalling connection as specified in subclause\u00a05.4;\n-\tif there is no user-plane resources established for PDU sessions, upon receiving a request from the upper layers to perform emergency services fallback only for a UE in 3GPP access or establishing an emergency PDU session, the UE shall stop timer T3540 and shall locally release the N1 NAS signalling connection, before proceeding as specified in subclause\u00a05.6.1;\n-\tif there is no user-plane resources established for PDU sessions, upon receiving a request from the upper layers to perform services other than emergency services fallback only for a UE in 3GPP access or establishing an emergency PDU session, the UE shall wait for the local release of the established N1 NAS signalling connection upon expiry of timer T3540 or wait for timer T3540 being stopped, before initiating NAS signalling;\n-\tupon receipt of a DL NAS TRANSPORT message, the UE shall stop timer T3540 and may send uplink signalling via the existing N1 NAS signalling connection;\n-\tupon reception of NOTIFICATION message as specified in subclause\u00a05.6.3.1 case a), the UE shall stop timer T3540 and send uplink signalling via the existing N1 NAS signalling connection; or\n-\tupon initiation of registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.2.7 for cases h), i), j), subclause\u00a05.5.1.3.7 for cases j), k) or subclause\u00a05.5.1.3.2 for case a), the UE shall stop timer T3540.\nIn case c) and d),\n-\tupon an indication from the lower layers that the access stratum connection has been released, the UE shall stop timer T3540 and perform a new registration procedure as specified in subclause\u00a05.5.1.3.5 or 5.6.1.5.\n-\tupon receiving a request from the upper layers to perform emergency services fallback only for a UE in 3GPP access or establishing an emergency PDU session, the UE shall stop timer T3540 and shall locally release the N1 NAS signalling connection, before proceeding as specified in subclause\u00a05.5.1.\nIn case e),\n-\tupon an indication from the lower layers that the access stratum connection has been released, the UE shall stop timer T3540 and perform a new registration procedure as specified in subclause\u00a05.5.1.3.2.\n-\tupon an indication from the lower layers that the user-plane resources for PDU sessions are set up, the UE shall stop timer T3540 and may send user data via user plane.\nNOTE\u00a03:\tIn this case, the new registration procedure is performed when the UE moves to the 5GMM-IDLE mode.\n-\tupon receiving a request from the upper layers to perform emergency services fallback only for a UE in 3GPP access or establishing an emergency PDU session, the UE shall stop timer T3540 and shall locally release the N1 NAS signalling connection, before proceeding as specified in subclause\u00a05.5.1.\nIf the UE had set the Follow-on request indicator to \"Follow-on request pending\" in the REGISTRATION REQUEST message due to pending uplink signalling but cannot send the pending signalling due to new service area restrictions received or due to network not supporting the feature as indicated in the REGISTRATION ACCEPT message (for example UE set the \"Follow-on request pending\" to send SMS over NAS but AMF notified \"SMS over NAS not allowed\") and if there is no further pending data or signalling and user plane resources have not been set up, the UE may locally release the established N1 NAS signalling connection upon completion of the registration procedure.\nNOTE\u00a04: the UE is allowed to inform the lower layers that there is no 5GMM or 5GSM messages need to be sent over non-3GPP access if the UE receives a REGISTRATION REJECT message over non-3GPP access or a SERVICE REJECT message over non-3GPP access.\nIf the timer T3540 is not running when the UE enters state 5GMM-DEREGISTERED.PLMN-SEARCH or 5GMM-REGISTERED.PLMN-SEARCH, the UE may locally release the N1 NAS signalling connection.\n5.3.1.4\t5GMM-CONNECTED mode with RRC inactive indication\nThis subclause is only applicable for UE's 5GMM mode over 3GPP access. The 5GMM-CONNECTED mode with RRC inactive indication is not supported when the UE is in NB-N1 mode.\nThe UE is in 5GMM-CONNECTED mode with RRC inactive indication when the UE is in:\na)\t5GMM-CONNECTED mode over 3GPP access at the NAS layer; and\nb)\tRRC_INACTIVE state at the AS layer (see 3GPP\u00a0TS\u00a038.300\u00a0[27]).\nUnless stated otherwise, the UE behaviour in 5GMM-CONNECTED mode with RRC inactive indication follows the UE behaviour in 5GMM-CONNECTED over 3GPP access, except that:\na)\tthe UE shall apply the mobility restrictions; and\nb)\tthe UE shall perform the PLMN selection procedures\nas in 5GMM-IDLE mode over 3GPP access.\nThe UE shall transition from 5GMM-CONNECTED mode over 3GPP access to 5GMM-CONNECTED mode with RRC inactive indication upon receiving an indication from the lower layers that the RRC connection has been suspended.\nNOTE\u00a01:\tAny pending procedure or uplink data packet when receiving an indication from the lower layers that the RRC connection has been suspended, triggers a request to the lower layers to transition to RRC_CONNECTED state. This is also the case when the pending procedure or uplink data packet triggered a previous request to the lower layers to transition to RRC_CONNECTED state.\nIf the UE in 3GPP access is configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22] then:\n-\tif the UE with the N1 NAS signalling connection established for eCall over IMS moved to 5GMM-CONNECTED mode with RRC inactive indication, the UE shall start timer T3444; and\n-\tif the UE with the N1 NAS signalling connection established for a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service moved to 5GMM-CONNECTED mode with RRC inactive indication, the UE shall start timer T3445.\nUpon:\na)\ta trigger of a procedure which requires sending of a NAS message different from a REGISTRATION REQUEST message with the NG-RAN-RCU bit of the 5GS update type IE set to \"UE radio capability update needed\";\nb)\tan uplink user data packet to be sent for a PDU session with suspended user-plane resources;\nc)\ta trigger to request resources for 5G ProSe direct discovery over PC5 or 5G ProSe direct communication over PC5; \nd)\ta trigger to request resources for V2X communication over PC5 (see 3GPP\u00a0TS\u00a023.287\u00a0[6C]); or\ne)\ta trigger to request resources for A2X communication over PC5 (see 3GPP\u00a0TS\u00a023.256\u00a0[6AB]);\nthe UE in 5GMM-CONNECTED mode with RRC inactive indication over 3GPP access shall request the lower layers to transition to RRC_CONNECTED state (see 3GPP\u00a0TS\u00a038.300\u00a0[27]).\nFor case b) above, the UE which supports S-NSSAI location validity information, and which has received S-NSSAI location validity information from the AMF, shall request the lower layers to transition to RRC_CONNECTED state only if the UE is inside the NS-AoS with respect to the S-NSSAI which is associated with the PDU session with suspended user-plane resources.\nNOTE\u00a02:\tIf the UE supports Small Data Transmission (SDT) (see 3GPP\u00a0TS\u00a038.300\u00a0[27]), the following applies:\na)\tif the UE due to pending uplink NAS messages or user data packets is requesting the lower layers to transition to RRC_CONNECTED state, but has not received a response from the lower layers, the UE can send the pending NAS messages or user data packets to the lower layers, and can receive multiple downlink NAS messages or multiple downlink user data packets from the lower layers while the UE remains in 5GMM-CONNECTED mode with RRC inactive indication over 3GPP access (i.e., without transitioning to 5GMM-CONNECTED mode). When the NAS layer triggers the transmission of pending uplink NAS messages or user data packets, and if the SDT is ongoing, the NAS layer will receive the response from the lower layers only after the SDT session has completed or failed; \nb)\tthe NAS layer is not aware of the classification of NAS messages or the user data packets as belonging to the SDT session at the lower layers; and\nc)\tthe setting of access category and the RRC establishment cause indicated to the lower layers when sending the pending uplink user data packets while the UE remains in 5GMM-CONNECTED mode with RRC inactive indication, is left to implementation.\nUpon a trigger to send a REGISTRATION REQUEST message with the NG-RAN-RCU bit of the 5GS update type IE set to \"UE radio capability update needed\", the UE in 5GMM-CONNECTED mode with RRC inactive indication shall move to 5GMM-IDLE mode over 3GPP access and proceed with the registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3.2.\nThe UE shall transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-CONNECTED mode over 3GPP access upon receiving an indication from the lower layers that the UE has transitioned to RRC_CONNECTED state (see 3GPP\u00a0TS\u00a038.300\u00a0[27]).\nNOTE\u00a03:\tThe AMF can be aware of the transition between 5GMM-CONNECTED mode and 5GMM-CONNECTED mode with RRC inactive indication for a UE (see 3GPP\u00a0TS\u00a023.502\u00a0[9]).\nThe UE shall trigger a transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-IDLE mode upon selection of a PLMN or SNPN that is not an equivalent PLMN or SNPN to the registered PLMN or SNPN. The UE shall not trigger a transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-IDLE mode upon entering a new PLMN or SNPN which is in the list of equivalent PLMNs or SNPNs.\nThe UE shall trigger a transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-IDLE mode upon receiving REFRESH command from the UICC as specified in subclause\u00a05.4.5.3.3.\nIf the UE in 5GMM-CONNECTED mode with RRC inactive indication receives an indication from the lower layers that the RRC connection has been suspended, the UE shall stay in 5GMM-CONNECTED mode with RRC inactive indication. The UE shall re-initiate any pending procedure that had triggered the request to the lower layers to transition to RRC_CONNECTED state, if still needed.\nWhen the UE in 5GMM-CONNECTED mode with RRC inactive indication receives a fallback indication from lower layers, and the UE has no pending NAS procedure and no pending uplink user data for PDU session(s) with user-plane resources already established, the UE shall:\na)\tenter 5GMM-IDLE mode; and\nb)\tinitiate the registration procedure for mobility and periodic registration update as specified for case o) in subclause\u00a05.5.1.3.2.\nIf the UE requests the lower layers to transition to RRC_CONNECTED state at initiation of a registration procedure, a service request procedure or a de-registration procedure, upon fallback indication from lower layers, the UE shall:\n-\tenter 5GMM-IDLE mode;\n-\tproceed with the pending procedure; and\n-\tif the pending procedure is a service request or registration request procedure and the SERVICE REQUEST message, the CONTROL PLANE SERVICE REQUEST message or the REGISTRATION REQUEST message does not include UE request type IE with Request type value set to \"NAS signalling connection release\", the UE shall include the Uplink data status IE in the SERVICE REQUEST message, the CONTROL PLANE SERVICE REQUEST message or in the REGISTRATION REQUEST message, indicating the PDU session(s) without active user-plane resources for which the UE has pending user data to be sent, if any, and the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any (see subclauses\u00a05.5.1.3 and 5.6.1 for further details).\nIf the UE requests the lower layers to transition to RRC_CONNECTED state for other reason than initiation of a registration procedure, or for other reason than a service request procedure, or for other reason than a de-registration procedure, upon fallback indication from lower layers, the UE shall:\n1)\tenter 5GMM-IDLE mode;\n2)\tinitiate the service request procedure and include the Uplink data status IE in the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any (see subclause\u00a05.6.1 for further details). If the procedure that triggered the request to the lower layers to transition to RRC_CONNECTED state is the UE-initiated NAS transport procedure and the UE had SMS, location services message, or CIoT user data to send, the UE shall also include the SMS, location services message, or CIoT user data in the CONTROL PLANE SERVICE REQUEST message as described in subclause\u00a05.6.1.2.2; and\n3)\tupon successful service request procedure completion, proceed with any pending procedure.\nIf the UE in 5GMM-CONNECTED mode with RRC inactive indication receives a fallback indication from lower layers, and the UE has pending uplink user data for PDU session(s) with user-plane resources already established but no pending NAS procedure, the UE shall:\n1)\tenter 5GMM-IDLE mode; and\n2)\tinitiate the service request procedure and include the Uplink data status IE in the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication (see subclause\u00a05.6.1 for further details).\nIn the above cases when the UE receives a fallback indication from lower layers, if the UE is in non-allowed area or not in allowed area, the UE shall behave as specified in subclause\u00a05.3.5.\nIf the UE in 5GMM-CONNECTED mode with RRC inactive indication receives an indication from the lower layers that the resumption of the RRC connection has failed, and:\na)\tif the lower layers indicate that access barring is applicable for all access categories except categories 0 and 2, or access barring is applicable for all access categories except category 0, the UE shall:\n1)\tstay in 5GMM-CONNECTED mode with RRC inactive indication;\nb)\telse, the UE shall:\n1)\tenter 5GMM-IDLE mode; and\n2)\tif the UE \n-\tdoes not have pending uplink user data for PDU session(s) with user-plane resources already established, initiate the registration procedure for mobility and periodic registration update used for mobility (i.e. the 5GS registration type IE set to \"mobility registration updating\" in the REGISTRATION REQUEST message) for N1 NAS signalling connection recovery as specified for case f) in subclause\u00a05.5.1.3.2; or\n-\thas pending uplink user data for PDU session(s) with user-plane resources already established or has pending NAS procedure other than a registration, service request, or de-registration procedure, then initiate the service request procedure for N1 NAS signalling connection recovery as specified for case i) or j) in subclause\u00a05.6.1.1.\nNOTE\u00a04:\tAn indication from the lower layer that the RRC connection has been released with cause \"RRC resume failure\" can be considered as an indication that the resumption of the RRC connection has failed.\nThe UE shall transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-IDLE mode over 3GPP access upon receiving from the lower layers:\na)\tindication of transition from RRC_INACTIVE state to RRC_IDLE state; or\nb)\tindication of cell selection to E-UTRAN or another RAT that the UE supports.\nIf the UE in 5GMM-CONNECTED mode with RRC inactive indication receives an indication from the lower layers about the cell (re-)selection to different RAT that the UE supports, the UE shall initiate the registration procedure for mobility or periodic registration update used for mobility (i.e. the 5GS registration type IE set to \"mobility registration updating\" in the REGISTRATION REQUEST message) as specified in subclause\u00a05.5.1.3.2.\nIf the UE in 5GMM-CONNECTED mode with RRC inactive indication receives an indication from the lower layers of a transition from RRC_INACTIVE state to RRC_IDLE state and 5GMM-REGISTERED.LIMITED-SERVICE is entered, the UE shall subsequently upon entering state 5GMM-REGISTERED.NORMAL-SERVICE and if there is no uplink user data or signalling pending, initiate the registration procedure for mobility and periodic registration update used for mobility (i.e. the 5GS registration type IE set to \"mobility registration updating\" in the REGISTRATION REQUEST message) for N1 NAS signalling connection recovery as specified in subclause\u00a05.5.1.3.2.\nIf the UE in 5GMM-CONNECTED mode with RRC inactive indication receives an indication from the lower layers about RAN paging and the MUSIM UE decides not to initiate the service request procedure with service type set to \"mobile terminated services\" or control plane service type set to \"mobile terminating request\" to respond to the RAN paging, the UE may initiate the service request procedure and set request type to \"NAS signalling connection release\" in the UE request type IE and service type to \"signalling\" in the SERVICE REQUEST message or set request type to \"NAS signalling connection release\" in the UE request type IE and control plane service type set to \"mobile originating request\" in the CONTROL PLANE SERVICE REQUEST message to reject the RAN paging as specified in subclause\u00a05.6.1.2 for case o of subclause\u00a05.6.1.1. The UE may include its paging restriction preferences in the Paging restriction IE in the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message as specified in subclause\u00a05.6.1.2 for case o of subclause\u00a05.6.1.1.\nNOTE\u00a05:\tThe interworking between the NAS layer and the AS layer triggered by RAN paging is up to UE implementation.\nNOTE 6: As an implementation option, the MUSIM UE is allowed to not respond to RAN paging based on the information available in the paging message, e.g. voice service indication.\nUpon receiving AMF paging indication from the lower layers, the UE shall transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-IDLE mode over 3GPP access and handle the AMF paging same as the paging request received in the 5GMM-IDLE mode over 3GPP access as specified in subclause\u00a05.6.1.\nIf the UE supporting the reconnection to the network due to RAN timing synchronization status change has been requested to reconnect to the network upon receiving an indication of a change in the RAN timing synchronization status (see subclauses\u00a05.4.4.2, 5.5.1.2.4, and 5.5.1.3.4) and the UE receives an indication of a change in the RAN timing synchronization status, the UE in 5GMM-CONNECTED mode with RRC inactive indication shall request the lower layers to transition to RRC_CONNECTED state.\n5.3.1.5\tSuspend and resume of the N1 NAS signalling connection\nSuspend of the N1 NAS signalling connection can be initiated by the network in 5GMM-CONNECTED mode when user plane CIoT 5GS optimization is used. Resume of the suspended N1 NAS signalling connection is initiated by the UE.\nIn the UE, when user plane CIoT 5GS optimization is used:\n-\tUpon idle suspend indication from the lower layers, the UE shall enter 5GMM-IDLE mode with suspend indication, shall not consider the N1 NAS signalling connection released and shall not consider the secure exchange of NAS messages terminated (see subclause\u00a04.4.2.5 and 4.4.5).\n-\tUpon trigger of a procedure using an initial NAS message when in 5GMM-IDLE mode with suspend indication, the UE shall:\ni)\tif the initial NAS message is a REGISTRATION REQUEST message with the NG-RAN-RCU bit of the 5GS update type IE set to \"UE radio capability update needed\", enter 5GMM-IDLE mode without suspend indication and proceed with the registration procedure; or\nii)\totherwise, request the lower layer to resume the RRC connection.\nNOTE\u00a01:\tIn NB-N1 mode, in the request to the lower layer the data volume information of the initial NAS message is provided to the lower layers. Interactions between the NAS and the lower layers in order to obtain the data volume information of the initial NAS message (see 3GPP\u00a0TS\u00a036.321\u00a0[25E], 3GPP TS 36.331 [25A]) is left to implementations.\n-\tUpon indication from the lower layers that the RRC connection has been resumed when in 5GMM-IDLE mode with suspend indication, the UE shall enter 5GMM-CONNECTED mode. If the pending NAS message is:\ni)\ta SERVICE REQUEST message, the service type IE is not set to \"emergency services fallback\", and the UE did not include the NAS message container IE in the SERVICE REQUEST message; or\nii)\ta CONTROL PLANE SERVICE REQUEST message, and the UE did not include the CIoT small data container IE or the NAS message container IE in the CONTROL PLANE SERVICE REQUEST message,\nthe message shall not be sent. Otherwise the UE shall cipher the message as specified in subclause\u00a04.4.5 and send the pending initial NAS message upon entering 5GMM-CONNECTED mode;\nNOTE\u00a02:\tIf a NAS message is discarded and not sent to the network, the uplink NAS COUNT value corresponding to that message is reused for the next uplink NAS message to be sent.\n-\tUpon fallback indication from the lower layers at RRC connection resume when in 5GMM-IDLE mode with suspend indication, the UE shall enter 5GMM-IDLE mode without suspend indication, send any pending initial NAS message and proceed as if RRC connection establishment had been requested;\n-\tUpon indication from the lower layers that the RRC connection resume has failed and indication from the lower layers that the RRC connection is suspended, the UE shall enter 5GMM-IDLE mode with suspend indication and restart the ongoing NAS procedure if required; and\n-\tUpon indication from the lower layers that the RRC connection resume has failed and indication from the lower layers that the RRC connection is not idle suspended, the UE shall enter 5GMM-IDLE mode without suspend indication and restart the ongoing NAS procedure if required.\nIn the network, when user plane CIoT 5GS optimization is used:\n-\tUpon idle suspend indication from the lower layers, the network shall enter 5GMM-IDLE mode with suspend indication, shall not consider the N1 NAS signalling connection released and shall not consider the secure exchange of NAS messages terminated; and\n-\tUpon indication from the lower layers that it has received the NGAP UE context resume request message as specified in 3GPP\u00a0TS\u00a038.413\u00a0[31] when in 5GMM-IDLE mode with suspend indication, the network shall enter 5GMM-CONNECTED mode.\n5.3.2\tPermanent identifiers\nA globally unique permanent identity, the 5G subscription permanent identifier (SUPI), is allocated to each subscriber for 5GS-based services. The IMSI, the network specific identifier, the GCI and the GLI are valid SUPI types. When the SUPI contains a network specific identifier, a GCI or a GLI, it shall take the form of a network access identifier (NAI). When the UE performs initial registration for onboarding services in SNPN or is registered for onboarding services in SNPN, the SUPI contains the onboarding SUPI derived from the default UE credentials for primary authentication. The UE derives the onboarding SUPI before or during the initial registration for onboarding services in SNPN and uses the derived onboarding SUPI in the initial registration for onboarding services in SNPN and while registered for onboarding services in SNPN.\nThe structure of the SUPI and its derivatives are specified in 3GPP\u00a0TS\u00a023.003\u00a0[4].\nThe UE provides the SUPI to the network in concealed form. The SUCI is a privacy preserving identifier containing the concealed SUPI. When the SUPI contains a network specific identifier, a GCI or a GLI, the SUCI shall take the form of a NAI as specified in 3GPP\u00a0TS\u00a023.003\u00a0[4].\nA UE supporting N1 mode includes a SUCI:\na)\tin the REGISTRATION REQUEST message when the UE is attempting initial registration procedure and a valid 5G-GUTI is not available;\nb)\tin the IDENTITY RESPONSE message, if the SUCI is requested by the network during the identification procedure; and\nc)\tin the DEREGISTRATION REQUEST message when the UE initiates a de-registration procedure and a valid 5G-GUTI is not available.\nIf the UE uses the \"null-scheme\" as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] to generate a SUCI, the SUCI contains the unconcealed SUPI.\nWhen:\n-\tnot operating in SNPN access operation mode; or\n-\toperating in SNPN access operation mode but not performing initial registration for onboarding services and not registered for onboarding services;\nthe UE shall use the \"null-scheme\" if:\na)\tthe home network has not provisioned the public key needed to generate a SUCI;\nb)\tthe home network has configured \"null-scheme\" to be used for the UE;\nc)\tthe UE needs to perform a registration procedure for emergency services and the USIM is still considered as valid after the failure of authentication procedure or after reception of a REGISTRATION REJECT message with the 5GMM cause #3 \"Illegal UE\", #6 \"Illegal ME\" or #7 \"5GS services not allowed\", or to initiate a de-registration procedure before the registration procedure for emergency services was completed successfully, and the UE does not have a valid 5G-GUTI for the selected PLMN; or\nd)\tthe UE receives an identity request for SUCI during a registration procedure for emergency services or during a de-registration procedure that was initiated before the registration procedure for emergency services was completed successfully.\nWhen operating in SNPN access operation mode and:\n-\tperforming initial registration for onboarding services; or\n-\tregistered for onboarding services;\nthe UE shall use the \"null-scheme\" if:\na)\tthe public key needed to generate a SUCI is not configured as part of the default UE credentials for primary authentication; or\nb)\t\"null-scheme\" usage is configured as part of the default UE credentials for primary authentication.\nIf:\na)\tthe UE uses the \"null-scheme\" as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] to generate a SUCI;\nb)\tthe UE operates in SNPN access operation mode and:\n1)\tan indication to use anonymous SUCI which is associated with the selected entry of the \"list of subscriber data\", is configured in the ME, if the UE is not registering or registered for onboarding services in SNPN; or\n2)\tan indication to use anonymous SUCI which is associated with the default UE credentials for primary authentication, is configured in the ME, if the UE is registering or registered for onboarding services in SNPN;\nNOTE\u00a01:\tThe ME can be configured with an indication to use anonymous SUCI associated with an entry of \"list of subscriber data\" when the EAP method associated with the credentials of the entry supports SUPI privacy at the EAP layer, or can be configured with an indication to use anonymous SUCI associated with the default UE credentials for primary authentication when the EAP method associated with the default UE credentials for primary authentication supports SUPI privacy at the EAP layer, or both.\nc)\tthe UE does not need to perform a registration procedure for emergency services, or to initiate a de-registration procedure before the registration procedure for emergency services was completed successfully; and\nd)\tthe UE does not receive an identity request for SUCI during a registration procedure for emergency services or during a de-registration procedure that was initiated before the registration procedure for emergency services was completed successfully;\nthen the UE shall use anonymous SUCI as specified in 3GPP\u00a0TS\u00a023.003\u00a0[4].\nA W-AGF acting on behalf of an FN-RG shall use the \"null-scheme\" as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] to generate a SUCI.\nA W-AGF acting on behalf of an N5GC device shall use the \"null-scheme\" as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] to generate a SUCI.\nIf the 5G-RG acting on behalf of the AUN3 device has not obtained a SUCI from the AUN3 device, the 5G-RG acting on behalf of the AUN3 device shall use the \"null-scheme\" as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] to generate a SUCI for the AUN3 device.\nIf a UE is a MUSIM UE, the UE shall use a separate permanent equipment identifier (PEI) for each USIM, if any, and each entry of \"list of subscriber data\", if any, the UE operates for accessing 5GS-based services; otherwise, a UE contains and uses a permanent equipment identifier (PEI) for accessing 5GS-based services. When the UE is registered with a network by using a USIM or an entry of \"list of subscriber data\", and has provided a PEI, then until the UE is de-registered from the network using the USIM or the entry of \"list of subscriber data\", the UE shall keep using that PEI in the registration using the USIM or the entry of \"list of subscriber data\" and shall not provide that PEI in registration using another USIM or another entry of \"list of subscriber data\".\nIn this release of the specification, the IMEI, the IMEISV, the MAC address together with the MAC address usage restriction indication and the EUI-64 are the only PEI formats supported by 5GS. The structure of the PEI and its formats are specified in 3GPP\u00a0TS\u00a023.003\u00a0[4].\nEach UE supporting at least one 3GPP access technology (i.e. satellite NG-RAN, NG-RAN, satellite E-UTRAN, E-UTRAN, UTRAN or GERAN) contains a PEI in the IMEI format and shall be able to provide an IMEI and an IMEISV upon request from the network.\nEach UE not supporting any 3GPP access technologies and supporting NAS over untrusted or trusted non-3GPP access shall have a PEI in the form of the Extended Unique Identifier EUI-64\u00a0[48] of the access technology the UE uses to connect to the 5GC.\nA UE supporting N1 mode includes a PEI:\na)\twhen neither SUPI nor valid 5G-GUTI is available to use for emergency services in the REGISTRATION REQUEST message with 5GS registration type IE set to \"emergency registration\";\nb)\twhen the network requests the PEI by using the identification procedure, in the IDENTITY RESPONSE message; and\nc)\twhen the network requests the IMEISV by using the security mode control procedure, in the SECURITY MODE COMPLETE message.\nEach 5G-RG supporting only wireline access and each FN-RG shall have a permanent MAC address configured by the manufacturer. For 5G-CRG, the permanent MAC address configured by the manufacturer shall be a cable modem MAC address.\nWhen the 5G-RG contains neither an IMEI nor an IMEISV, the 5G-RG shall use as a PEI the 5G-RG's permanent MAC address configured by the manufacturer and the MAC address usage restriction indication set to \"no restrictions\".\nThe W-AGF acting on behalf of the FN-RG shall use as a PEI the MAC address provided by the FN-RG and if the MAC address provided by the FN-RG is not unique or does not correspond to the FN-RG's permanent MAC address according to W-AGF's configuration, the MAC address usage restriction indication set to \"MAC address is not usable as an equipment identifier\" otherwise the MAC address usage restriction indication set to \"no restrictions\".\nThe 5G-RG, when acting on behalf of an AUN3 device, shall use the MAC address provided by the AUN3 device as a PEI.\nThe 5G-RG containing neither an IMEI nor an IMEISV or the 5G-RG acting on behalf of the AUN3 device shall include the PEI containing the MAC address together with the MAC address usage restriction indication:\na)\twhen neither SUPI nor valid 5G-GUTI is available to use for emergency services in the REGISTRATION REQUEST message with 5GS registration type IE set to \"emergency registration\";\nb)\twhen the network requests the PEI by using the identification procedure, in the IDENTIFICATION RESPONSE message; and\nc)\twhen the network requests the IMEISV by using the security mode control procedure, in the SECURITY MODE COMPLETE message.\nNOTE\u00a02:\tIn case c) above, the MAC address is provided even though AMF requests the IMEISV.\nThe W-AGF acting on behalf of the FN-RG shall include the PEI containing the MAC address together with the MAC address usage restriction indication:\na)\twhen the network requests the PEI by using the identification procedure, in the IDENTIFICATION RESPONSE message; and\nb)\twhen the network requests the IMEISV by using the security mode control procedure, in the SECURITY MODE COMPLETE message.\nNOTE\u00a03:\tIn case b) above, the MAC address is provided even though AMF requests the IMEISV.\nThe W-AGF acting on behalf of the N5GC device shall use as a PEI the MAC address provided by the N5GC device and the MAC address usage restriction indication set to \"no restrictions\". Based on operator policy, the W-AGF acting on behalf of the N5GC device may encode the MAC address of the N5GC device using the EUI-64 format as specified in [48] and use as a PEI the derived EUI-64.\nNOTE\u00a04:\tThe MAC address of an N5GC device is universally/globally unique.\nThe AMF can request the PEI at any time by using the identification procedure.\nIf the TWIF acting on behalf of the N5CW device receives the decorated NAI for N5CW device as defined in subclause\u00a028.7.7.1 or 28.7.7.2 of 3GPP\u00a0TS\u00a023.003\u00a0[4] from the N5CW device, the TWIF shall first convert the decorated NAI into an NAI as specified in TS\u00a023.502\u00a0[9], i.e., for decorated NAI taking the form \"homerealm!username@otherrealm\":\na)\treplace the 'otherrealm' part with the 'homerealm' part; and\nb)\tremove 'homerealm!'.\nAs a result of specified above, the converted NAI takes the form \"username@homerealm\". The TWIF shall include the converted NAI as a SUPI with SUPI format \"network specific identifier\" in the REGISTRATION REQUEST message.\n5.3.3\tTemporary identities\nA temporary user identity for 5GS-based services, the 5G globally unique temporary identity (5G-GUTI), is used for identification within the signalling procedures. In case of PLMN the 5G-GUTI is globally unique and in case of SNPN the 5G-GUTI is unique within an SNPN. When the UE is registered to the same PLMN or SNPN over 3GPP and non-3GPP access, the UE and the AMF maintain one 5G-GUTI that is common to both 3GPP and non-3GPP access. When the UE is required to delete the 5G-GUTI according to a NAS procedure, the UE shall delete the 5G-GUTI only if it is not registered to the same PLMN or SNPN through other access. When the UE is registered to different PLMNs or SNPNs over 3GPP access and non-3GPP access, the UE maintains two 5G-GUTIs, a 5G-GUTI for the registration with a PLMN or SNPN over the 3GPP access and another 5G-GUTI for the registration with another PLMN or SNPN over the non-3GPP access. In the paging and service request procedures, a shortened form of the 5G-GUTI, the 5G S-temporary mobile subscriber identity (5G-S-TMSI), is used to enable more efficient radio signalling. The purpose of the 5G-GUTI and 5G-S-TMSI is to provide identity confidentiality, i.e., to protect a user from being identified and located by an intruder. The structure of the 5G-GUTI and its derivatives are specified in 3GPP\u00a0TS\u00a023.003\u00a0[4]. The 5G-GUTI has two main components (see 3GPP\u00a0TS\u00a023.501\u00a0[8]):\na)\tthe GUAMI; and\nb)\tthe 5G-TMSI that provides an unambiguous identity of the UE within the AMF(s) identified by the GUAMI.\nThe 5G-S-TMSI has three main components:\na)\tthe AMF set ID that uniquely identifies the AMF set within the AMF region;\nb)\tthe AMF pointer that identifies one or more AMFs within the AMF set; and\nc)\tthe 5G-TMSI.\nA UE supporting N1 mode includes a valid 5G-GUTI, if any is available, in the REGISTRATION REQUEST and DEREGISTRATION REQUEST messages. In the SERVICE REQUEST message, the UE includes a valid 5G-S-TMSI as user identity. The AMF shall assign a new 5G-GUTI for a particular UE:\na)\tduring a successful initial registration procedure;\nb)\tduring a successful registration procedure for mobility registration update;\nc)\tafter a successful service request procedure invoked as a response to a paging request from the network and before the:\n1)\trelease of the N1 NAS signalling connection; or\n2)\tsuspension of the N1 NAS signalling connection due to user plane CIoT 5GS optimization i.e. before the UE and the AMF enter 5GMM-IDLE mode with suspend indication;\n\tas specified in subclause\u00a05.4.4.1; and\nd)\tafter the AMF receives an indication from the lower layers that it has received the NGAP UE context resume request message as specified in 3GPP\u00a0TS\u00a038.413\u00a0[31] for a UE in 5GMM-IDLE mode with suspend indication and this resumption is a response to a paging request from the network, and before the:\n1)\trelease of the N1 NAS signalling connection; or\n2)\tsuspension of the N1 NAS signalling connection due to user plane CIoT 5GS optimization i.e. before the UE and the AMF enter 5GMM-IDLE mode with suspend indication;\n\tas specified in subclause\u00a05.4.4.1.\nThe AMF should assign a new 5G-GUTI for a particular UE during a successful registration procedure for periodic registration update. The AMF may assign a new 5G-GUTI at any time for a particular UE by performing the generic UE configuration update procedure.\nIf a new 5G-GUTI is assigned by the AMF, the UE and the AMF handle the 5G-GUTI as follows:\na)\tUpon receipt of a 5GMM message containing a new 5G-GUTI, the UE considers the new 5G-GUTI as valid and the old 5G-GUTI as invalid, stops timer T3519 if running, and deletes any stored SUCI. The new 5G-GUTI is stored in a non-volatile memory in the USIM if the corresponding file is present in the USIM, else in the non-volatile memory in the ME, as described in annex\u00a0C.\nb)\tThe AMF considers the old 5G-GUTI as invalid as soon as an acknowledgement for a registration or generic UE configuration update procedure is received.\n5.3.4\tRegistration areas\nWithin the 5GS, the registration area is managed independently per access type, i.e., 3GPP access or non-3GPP access. The AMF assigns a registration area to the UE during the registration procedure. A registration area is defined as a set of tracking areas and each of these tracking areas consists of one or more cells that cover a geographical area. Within the 5GS, the concept of \"registration to multiple tracking areas\" applies:\na)\tA tracking area is identified by a TAI which is broadcast in the cells of the tracking area. The TAI is constructed from a TAC and a PLMN identity. In case of a shared network:\n1)\tone or more TACs; and\n2)\tany of the following:\ni)\tmultiple PLMN identities;\nii)\tmultiple SNPN identities; or\niii)\tone or more PLMN identities and one or more SNPN identities;\n\tare broadcast.\nb)\tIn order to reduce the tracking area update signalling within the 5GS, the AMF can assign several tracking areas to the UE. These tracking areas construct a list of tracking areas which is identified by a TAI list. When generating the TAI list, the AMF shall include only TAIs that are applicable on the access where the TAI list is sent. The AMF shall be able to allocate a TAI list over different NG-RAN access technologies. The AMF shall not allocate a TAI list containing both tracking areas in NB-N1 mode and tracking areas not in NB-N1 mode.\nc)\tThe UE considers itself registered to a list of tracking areas and does not need to trigger the registration procedure for mobility and periodic registration update used for mobility (i.e. the 5GS registration type IE set to \"mobility registration updating\" in the REGISTRATION REQUEST message) as long as the UE stays in one of the tracking areas of the list of tracking areas received from the AMF.\nd)\tThe UE will consider the TAI list stored in the UE as valid, until it receives a new TAI list in the next registration procedure for mobility and periodic registration update or generic UE configuration update procedure, or the UE is commanded by the network to delete the TAI list by a reject message or it is deregistered from the 5GS. If the registration request is accepted or the TAI list is reallocated by the AMF, the AMF shall provide at least one entry in the TAI list. If the new and the old TAI list are identical, the AMF does not need to provide the new TAI list to the UE during mobility registration update or periodic registration update.\ne)\tThe TAI list can be reallocated by the AMF.\nf)-\tWhen the UE is deregistered from the 5GS, the UE shall delete the TAI list stored in the UE.\ng)\tThe UE includes the last visited registered TAI, if available, to the AMF. The last visited registered TAI is stored in a non-volatile memory in the USIM if the corresponding file is present in the USIM, else in the non-volatile memory in the ME, as described in annex\u00a0C.\n5.3.5\tService area restrictions\n5.3.5.1\tGeneral\nService area restrictions are applicable only to 3GPP access and to wireline access.\nSubclause\u00a05.3.5.2 applies when the UE accesses 5GCN over 3GPP access.\nSubclause\u00a05.3.5.3 applies when the 5G-RG or the W-AGF acting on behalf of an FN-CRG (or on behalf of the N5GC device) access 5GCN over wireline access.\nNOTE:\tService area restrictions are not applicable for the W-AGF acting on behalf of the FN-BRG.\n5.3.5.2\t3GPP access service area restrictions\nThe service area restrictions consist of tracking areas forming either an allowed area, or a non-allowed area. The tracking areas belong to the registered PLMN, its equivalent PLMNs in the registration area, or the registered SNPN. The allowed area can contain up to 16 tracking areas or include all tracking areas in the registered PLMN and its equivalent PLMN(s) in the registration area, or in the registered SNPN. The non-allowed area can contain up to 16 tracking areas. The network conveys the service area restrictions to the UE by including either an allowed area, or a non-allowed area, but not both, in the Service area list IE of a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message.\nIf the network does not convey the service area restrictions to the UE in the Service area list IE of a REGISTRATION ACCEPT message, the UE shall treat all tracking areas in the registered PLMN, its equivalent PLMN(s) in the registration area, or in the registered SNPN, as allowed area and delete the stored list of \"allowed tracking areas\" or the stored list of \"non-allowed tracking areas\".\nWhen the UE receives a Service area list IE with an allowed area indication during a registration procedure or a generic UE configuration update procedure:\na)\tif the \"Type of list\" included in the Service area list IE does not indicate \"all TAIs belonging to the PLMNs in the registration area are allowed area\", the UE shall delete the old list of \"allowed tracking areas\" and store the tracking areas in the allowed area as the list of \"allowed tracking areas\". If the UE has a stored list of \"non-allowed tracking areas\", the UE shall delete that list; or\nb)\tif the \"Type of list\" included in the Service area list IE indicates \"all TAIs belonging to the PLMNs in the registration area are allowed area\", the UE shall treat all tracking areas in the registered PLMN and its equivalent PLMN(s), or in the registered SNPN, as allowed area and delete the stored list of \"allowed tracking areas\" or the stored list of \"non-allowed tracking areas\".\nWhen the UE receives a Service area list IE with a non-allowed area indication during a registration procedure or a generic UE configuration update procedure, the UE shall delete the old list of \"non-allowed tracking areas\" and store the tracking areas in the non-allowed area as the list of \"non-allowed tracking areas\". If the UE has a stored list of \"allowed tracking areas\", the UE shall delete that list.\nIf the UE is successfully registered to a PLMN or SNPN and has a stored list of \"allowed tracking areas\":\na)\twhile the current TAI is in the list of \"allowed tracking areas\", the UE shall stay in, or enter, the state 5GMM-REGISTERED.NORMAL-SERVICE and is allowed to initiate any 5GMM and 5GSM procedures; and\nb)\twhile the UE is camped on a cell which is in the registered PLMN, a PLMN from the list of equivalent PLMNs, or the registered SNPN, and the current TAI is not in the list of \"allowed tracking areas\", the UE shall enter the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE, and:\n1)\tif the UE is in 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication over 3GPP access, the UE:\ni)\tshall not include the Uplink data status IE in the registration procedure for mobility and periodic registration update except for emergency services or for high priority access;\nii)\tshall not perform the registration procedure for mobility and periodic registration update with Follow-on request indicator set to \"Follow-on request pending\", except for:\n-\temergency services;\n-\thigh priority access;\n-\tindicating a change of 3GPP PS data off UE status;\n-\tsending an SOR transparent container;\n-\tsending a UE policy container; or\n-\tsending a UE parameters update transparent container;\niii)\tshall not initiate a service request procedure or request the lower layers to resume a suspended connection, except for:\n-\temergency services;\n-\temergency services fallback;\n-\thigh priority access;\n-\tresponding to paging;\n-\tresponding to notification received over non-3GPP access;\n-\tindicating a change of 3GPP PS data off UE status;\n-\tsending an SOR transparent container;\n-\tsending a UE policy container; or\n-\tsending a UE parameters update transparent container.\n\tThe UE shall not include the Uplink data status IE in the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message except for emergency services or for high priority access. In case of emergency services, the UE shall indicate that uplink data is pending only for the PDU session for emergency services;\niv)\tif the UE responds to a paging which includes an indication for non-3GPP access type, the UE shall include the Allowed PDU session status IE in the SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or REGISTRATION REQUEST message and indicate for each PDU session in the information element that re-establishment of the user-plane resources via 3GPP access is not allowed; and\n2)\tif the UE is in 5GMM-CONNECTED mode or 5GMM-CONNECTED mode with RRC inactive indication over 3GPP access, the UE:\ni)\tshall not perform the registration procedure for mobility and periodic registration update with Uplink data status IE except for emergency services or for high priority access;\nii)\tshall not initiate a service request procedure except for:\n-\temergency services;\n-\temergency services fallback;\n-\thigh priority access;\n-\tresponding to paging or responding to a notification.\n\tThe UE shall not include the Uplink data status IE in the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message except for emergency services or for high priority access. In case of emergency services, the UE shall indicate that uplink data is pending only for the PDU session for emergency services;\niii)\tshall not initiate a 5GSM procedure except for:\n-\temergency services;\n-\thigh priority access; or\n-\tindicating a change of 3GPP PS data off UE status;\niv)\tshall not perform the NAS transport procedure except for the sending:\n-\t5GSM messages for UE-requested 5GSM procedures allowed in iii) above;\n-\t5GSM messages for network-requested 5GSM procedures;\n-\tSMS;\n-\tan LPP message;\n-\ta UPP-CMI container;\n-\tan SLPP message;\n-\ta location services message;\n-\tan SOR transparent container;\n-\ta UE policy container;\n-\ta UE parameters update transparent container; or\n-\ta CIoT user data container; and\nNOTE\u00a01:\tThe contents of CIoT user data container can be data that is not for exception reports, or data that is for exception reports if allowed for the UE (see subclause\u00a06.2.13).\nv)\tif the UE responds to a notification which includes an indication for non-3GPP access type, the UE shall include the Allowed PDU session status IE in the SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or REGISTRATION REQUEST message and indicate for each PDU session in the information element that re-establishment of the user-plane resources via 3GPP access is not allowed.\nIf the UE is successfully registered to a PLMN or an SNPN and has a stored list of \"non-allowed tracking areas\":\na)\twhile the UE is camped on a cell which is in the registered PLMN,a PLMN from the list of equivalent PLMNs, or the registered SNPN, and the current TAI is not in the list of \"non-allowed tracking areas\", the UE shall stay in, or enter, the state 5GMM-REGISTERED.NORMAL-SERVICE and is allowed to initiate any 5GMM and 5GSM procedures; and\nb)\twhile the current TAI is in the list of \"non-allowed tracking areas\", the UE shall enter the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE, and:\n1)\tif the UE is in 5GMM-IDLE mode or 5GMM-IDLE mode with suspend indication over 3GPP access, the UE:\ni)\tshall not include the Uplink data status IE in the registration procedure for mobility and periodic registration update except for emergency services or for high priority access;\nii)\tshall not perform the registration procedure for mobility and periodic registration update with Follow-on request indicator set to \"Follow-on request pending\", except for:\n-\temergency services;\n-\thigh priority access;\n-\tindicating a change of 3GPP PS data off UE status;\n-\tsending an SOR transparent container;\n-\tsending a UE policy container; or\n-\tsending a UE parameters update transparent container; and\niii)\tshall not initiate a service request procedure or request the lower layers to resume a suspended connection, except for:\n-\temergency services;\n-\temergency services fallback;\n-\thigh priority access;\n-\tresponding to paging;\n-\tresponding to notification received over non-3GPP access;\n-\tindicating a change of 3GPP PS data off UE status;\n-\tsending an SOR transparent container;\n-\tsending a UE policy container; or\n-\tsending a UE parameters update transparent container.\n\tThe UE shall not include the Uplink data status IE in the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message except for emergency services or for high priority access. In case of emergency services, the UE shall indicate that uplink data is pending only for the PDU session for emergency services;\niv)\tif the UE responds to a paging which includes an indication for non-3GPP access type, the UE shall include the Allowed PDU session status IE in the SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or REGISTRATION REQUEST message and indicate for each PDU session in the information element that re-establishment of the user-plane resources via 3GPP access is not allowed; and\n2)\tif the UE is in 5GMM-CONNECTED mode or 5GMM-CONNECTED mode with RRC inactive indication over 3GPP access, the UE:\ni)\tshall not perform the registration procedure for mobility and periodic registration update with the Uplink data status IE except for emergency services or for high priority access;\nii)\tshall not initiate a service request procedure or request the lower layers to resume a suspended connection, except for:\n-\temergency services;\n-\temergency services fallback;\n-\thigh priority access; or\n-\tresponding to paging or responding to a notification.\n\tThe UE shall not include the Uplink data status IE in the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message except for emergency services or for high priority access. In case of emergency services, the UE shall indicate that uplink data is pending only for the PDU session for emergency services;\niii)\tshall not initiate a 5GSM procedure except for:\n-\temergency services;\n-\thigh priority access; or\n-\tindicating a change of 3GPP PS data off UE status;\niv)\tshall not perform the NAS transport procedure except for the sending:\n-\t5GSM messages for UE-requested 5GSM procedures allowed in iii) above;\n-\t5GSM messages for network-requested 5GSM procedures;\n-\tSMS;\n-\tan LPP message;\n-\ta UPP-CMI container;\n-\tan SLPP message;\n-\ta location services message;\n-\tan SOR transparent container;\n-\ta UE policy container;\n-\ta UE parameters update transparent container; or\n-\ta CIoT user data container; and\nNOTE\u00a02:\tThe contents of CIoT user data container can be data that is not for exception reports, or data that is for exception reports if allowed for the UE (see subclause\u00a06.2.13).\nv)\tif the UE responds to a notification which includes an indication for non-3GPP access type, the UE shall include the Allowed PDU session status IE in the SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or REGISTRATION REQUEST message and indicate for each PDU session in the information element that re-establishment of the user-plane resources via 3GPP access is not allowed.\nThe list of \"allowed tracking areas\", as well as the list of \"non-allowed tracking areas\" shall be erased when:\na)\tthe UE is switched off; and\nb)\tthe UICC containing the USIM is removed or an entry of the \"list of subscriber data\" with the SNPN identity of the SNPN is updated.\nWhen a tracking area is added to the list of \"5GS forbidden tracking areas for roaming\" or to the list of \"5GS forbidden tracking areas for regional provision of service\" as specified in the subclauses\u00a05.5.1.2.5 or 5.5.1.3.5, the tracking area shall be removed from the list of \"allowed tracking areas\" if the tracking area is already present in the list of \"allowed tracking areas\" and from the list of \"non-allowed tracking areas\" if the tracking area is already present in the list of \"non-allowed tracking areas\".\n5.3.5.3\tWireline access service area restrictions\nIf:\na)\ta SERVICE REJECT message with the 5GMM cause #28 \"Restricted service area\";\nb)\ta DL NAS TRANSPORT message with the Payload container type IE set to \"N1 SM information\" and the 5GMM cause #28 \"Restricted service area\"; or\nc)\ta REGISTRATION ACCEPT message includes the PDU session reactivation result error cause IE with the 5GMM cause #28 \"Restricted service area\";\nis received over wireline access then the 5G-RG or the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device) shall start enforcing the wireline access service area restrictions and shall enter the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE.\nWhile in the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE, the 5G-RG or the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device) shall:\na)\tif in 5GMM-IDLE mode over wireline access:\n1)\tshall not perform the registration procedure for mobility and periodic registration update with Uplink data status IE except for emergency services or for high priority access; and\n2)\tshall not initiate a service request procedure except for:\n-\temergency services,\n-\temergency services fallback; or\n-\thigh priority access; and\nb)\tif in 5GMM-CONNECTED mode over wireline access:\n1)\tshall not perform the registration procedure for mobility and periodic registration update with Uplink data status IE except for:\n-\temergency services;\n-\temergency services fallback; or\n-\thigh priority access;\n2)\tshall not initiate a service request procedure except for emergency services, or high priority access; and\n3)\tshall not initiate a 5GSM procedure except for emergency services or high priority access;\nover the wireline access.\nWhen the 5G-RG is switched off, the UICC containing the USIM is removed or the 5G-RG starts using another wireline access network, the 5G-RG shall stop enforcing the wireline access service area restrictions, if enforced.\nNOTE:\tWhen the 5G-RG acting on behalf of the AUN3 device determines that the AUN3 device is switched off or the UICC containing the USIM of AUN3 device is removed, the 5G-RG acting on behalf of the AUN3 device stops enforcing the wireline access service area restrictions, if enforced.\nWhen the W-AGF acting on behalf of the FN-CRG determines that the FN-CRG is switched off, the W-AGF acting on behalf of the FN-CRG stops enforcing the wireline access service area restrictions, if enforced.\nWhen the W-AGF acting on behalf of the N5GC device determines that the FN-CRG serving the N5GC device is switched off, the W-AGF acting on behalf of the N5GC device stops enforcing the wireline access service area restrictions, if enforced.\n5.3.6\tMobile initiated connection only mode\nThe UE can request the use of mobile initiated connection only (MICO) mode during the registration procedure (see 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a023.502\u00a0[9]). The UE shall not request use of MICO mode over non-3GPP access. Furthermore, the UE in 3GPP access shall not request the use of MICO mode during:\na)\ta registration procedure for initial registration for emergency services (see subclause\u00a05.5.1.2);\nb)\ta registration procedure for initial registration for initiating an emergency PDU session (see subclause\u00a05.5.1.2);\nc)\ta registration procedure for mobility and periodic registration update (see subclause\u00a05.5.1.3) for initiating an emergency PDU session if the UE is in the state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE; or\nd)\ta registration procedure for mobility and periodic registration update (see subclause\u00a05.5.1.3) when the UE has an emergency PDU session established.\nIf the UE requests the use of MICO mode, the network can accept the use of MICO mode by providing a MICO indication when accepting the registration procedure. The UE may use MICO mode only if the network has provided the MICO indication IE during the last registration procedure. The UE may also request an active time value together with the MICO mode indication during the registration procedure. If the UE requests an active time by including an active time value, the UE may also include the Requested T3512 value IE to request a particular T3512 value to be allocated.\nIf the network accepts the use of MICO mode and does not include an active time value in T3324 IE to the UE, the AMF may include an \"all PLMN registration area allocated\" indication in the MICO indication IE to the UE. If the UE indicated the support for strictly periodic registration timer in the MICO indication IE to the network, the network may include a \"strictly periodic registration timer supported\" indication in the MICO indication IE to the UE.\nIf the UE requested the use of active time by including an active time value and the network accepts the use of MICO mode and the use of active time, the AMF shall include an active time value in the T3324 IE to the UE. If the AMF indicates active time value to the UE, AMF should not indicate \"all PLMN registration area allocated\" indication in the MICO indication IE to the UE. Upon entering 5GMM-IDLE mode, AMF shall start the active timer with the active time value indicated to the UE and shall consider the UE is reachable for paging as long as the timer is running. If the UE enters 5GMM-CONNECTED mode over 3GPP access when the active timer is running, the AMF shall stop the active timer.\nNOTE\u00a01:\tThe active time value assigned by AMF can be different from the active time value requested by the UE. AMF assigns the active time value based on several factors, e.g. local configuration, expected UE behaviour, UE requested active time value, UE subscription information, network policies etc.\nIf the UE requested an active time and a requested T3512 value and the network accepts the use of MICO mode, the AMF shall take the UE requested T3512 value into consideration when assigning a value of timer T3512 to the UE.\nIf the network accepts the use of MICO mode, the UE may deactivate the AS layer and activate MICO mode by entering the state 5GMM-REGISTERED.NO-CELL-AVAILABLE if:\na)\tthe UE is in 5GMM-IDLE mode over3GPP access;\nb)\tthe UE is in the 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE (as described in subclause\u00a05.3.5.2) state for 3GPP access; and\nc)\tno T3324 value is received from the network.\nIf the network accepts the use of MICO mode and indicates an active time value to the UE in a successful registration procedure, the UE shall start the timer T3324 with the value received from the network after entering 5GMM-IDLE mode over 3GPP access. At the expiry of the timer T3324, the UE may activate MICO mode by entering the state 5GMM-REGISTERED.NO-CELL-AVAILABLE if the UE is in the 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE (as described in subclause\u00a05.3.5.2) state for 3GPP access. If the UE enters 5GMM-CONNECTED mode over 3GPP access when the timer T3324 is running, the UE shall stop the timer T3324.\nWhen MICO mode is activated, all NAS timers are stopped and associated procedures aborted except for timers T3512, T3346, T3447, T3448, T3396, T3526, T3584, T3585, T3587 any back-off timers, T3245, T3247, and the timer T controlling the periodic search for HPLMN or EHPLMN or higher prioritized PLMNs (see 3GPP\u00a0TS\u00a023.122\u00a0[5]).\nNOTE\u00a02:\tWhen MICO mode is activated and if the UE is also registered over the non-3GPP access, the AMF will not send a NOTIFICATION message with access type indicating 3GPP access over the non-3GPP access for PDU sessions associated with 3GPP access.\nThe UE may deactivate MICO mode and activate the AS layer at any time. Upon deactivating MICO mode, the UE may initiate 5GMM procedures (e.g., for the transfer of mobile originated signalling or user data).\nWhen an emergency PDU session is successfully established after the MICO mode was enabled, the UE and the AMF shall locally disable MICO mode. The UE and the AMF shall not enable MICO mode until the AMF accepts the use of MICO mode in the next registration procedure. To enable an emergency call back, the UE should wait for a UE implementation-specific duration of time before requesting the use of MICO mode after the completion of the emergency services.\nIf the AMF accepts the use of MICO mode and does not indicate \"strictly periodic registration timer supported\" in the MICO indication IE to the UE, the AMF starts the implicit de-registration timer for 3GPP access when entering 5GMM-IDLE mode for 3GPP access. If AMF accepts the use of MICO mode and indicates \"strictly periodic registration timer supported\" in the MICO indication IE to the UE, AMF shall start the strictly periodic monitoring timer with T3512 value indicated in the T3512 value IE after the registration procedure is completed. The AMF shall neither stop nor reset the strictly periodic monitoring timer when the NAS signalling connection is established or released for the UE. If the strictly periodic monitoring timer expires when NAS signalling connection is established for the UE, AMF shall restart the strictly periodic monitoring timer with the T3512 value, otherwise AMF shall start the implicit de-registration timer.\nWhen an emergency PDU session is successfully established and the MICO mode is disabled, the UE shall stop timer T3512 if running and the AMF shall stop strictly periodic monitoring timer if running. The UE and the AMF shall behave as if no \"strictly periodic registration timer supported\" indication was given to the UE in the last registration attempt.\nUpon successful completion of an attach procedure or tracking area updating procedure after inter-system change from N1 mode to S1 mode (see 3GPP\u00a0TS\u00a024.301\u00a0[15]), the UE operating in single-registration mode shall locally disable MICO mode. After inter-system change from S1 mode to N1 mode, the UE operating in single-registration mode may re-negotiate MICO mode with the network during the registration procedure for mobility and periodic registration update.\nWhen MICO mode is activated for a UE that has joined one or more multicast MBS sessions, the UE may deactivate MICO mode and activate the AS layer at the MBS start time and at any of the scheduled activation times of a multicast MBS session, if any of those times are available as specified in 3GPP\u00a0TS\u00a023.247\u00a0[53].\nWhen MICO mode is activated for a UE, the UE may deactivate MICO mode and activate the AS layer at the broadcast start time and at any of the scheduled broadcast activation times of a broadcast MBS session if any of those times are available as specified in 3GPP\u00a0TS\u00a023.247\u00a0[53].\nNOTE\u00a03:\tThe UE can obtain via the service announcement an MBS start time, a sequence of scheduled activation times (e.g. a first time and a periodicity) or both, of a multicast MBS session as described in 3GPP\u00a0TS\u00a023.247\u00a0[53], or both, which is out of scope of this specification. Similarly, the UE can obtain via the service announcement a broadcast start time, a sequence of scheduled broadcast activation times (e.g. a first time and a periodicity) or both, of a broadcast MBS session as described in 3GPP\u00a0TS\u00a023.247\u00a0[53], which is out of scope of this specification.\nNOTE\u00a04:\tDeactivating MICO mode and activating the AS layer at the MBS start time and the scheduled multicast activation times of a multicast MBS session allows the UE to listen to paging for a multicast MBS session which the has UE joined and to respond to it if received. How long the UE needs to listen to paging is up to UE implementation. Similarly, deactivating MICO mode and activating the AS layer at the broadcast start time and the scheduled broadcast activation times of a broadcast MBS session allows the UE to acquire the traffic of the broadcast MBS session. If the UE fails to receive paging or data for a multicast MBS session which the UE has joined or data for a broadast MBS session, the UE can as an implementation option initiate 5GMM procedures (e.g. for the transfer of mobile originated signalling or user data) to enter 5GMM-CONNECTED mode over 3GPP access and obtain via the service announcement a new start time, a sequence of scheduled activation times or both.\nWhen MICO mode is activated, the UE is allowed to join one or more multicast MBS sessions. In that case, the UE can deactivate MICO mode and activate the AS layer at the MBS start time and at any of the scheduled activation times of a multicast MBS session if any of those times are available as specified in 3GPP\u00a0TS\u00a023.247\u00a0[53], and the UE joins one or more multicast MBS sessions by using the UE-requested PDU session establishment procedure or the UE-requested PDU session modification procedure (see subclauses\u00a06.4.1.2 and\u00a06.4.2.2).\nNOTE\u00a05:\tIt is up to UE implementation whether to leave one or more multicast MBS sessions after each deactivation of each multicast MBS session and to re-join again at the next activation time or to keep a multicast MBS session that the UE has joined for the whole period of the session, as described in 3GPP\u00a0TS\u00a023.247\u00a0[53].\n5.3.7\tHandling of the periodic registration update timer and mobile reachable timer\nThe periodic registration update procedure is used over 3GPP access to periodically notify the availability of the UE to the network. The procedure is controlled in the UE by the periodic registration update timer, T3512.\nIf the UE is registered over the 3GPP access, the AMF maintains an implicit de-registration timer to control when the UE is considered implicitly de-registered over the 3GPP access. If the UE is registered over the non-3GPP access, the AMF also maintains a non-3GPP implicit de-registration timer to control when the UE is considered implicitly de-registered over the non-3GPP access. The UE registered over the non-3GPP access maintains a non-3GPP de-registration timer to control when the UE is considered implicitly de-registered for the non-3GPP access.\nThe AMF shall start a non-3GPP implicit de-registration timer for the UE registered over non-3GPP access when the N1 NAS signalling connection over non-3GPP access is released.\nThe UE registered over non-3GPP access shall reset and start a non-3GPP de-registration timer when the N1 NAS signalling connection over non-3GPP access is released. The non-3GPP de-registration timer is stopped when the UE enters 5GMM-CONNECTED mode over non-3GPP access or the 5GMM-DEREGISTERED state over non-3GPP access.\nThe non-3GPP implicit de-registration timer shall be longer than the non-3GPP de-registration timer.\nThe value of timer T3512 is sent by the network to the UE in the REGISTRATION ACCEPT message. The UE shall apply this value in all tracking areas of the list of tracking areas assigned to the UE until a new value is received. The periodic registration update timer only applies to the UE registered to the 5GS services over 3GPP access.\nIf timer T3512 received by the UE in a REGISTRATION ACCEPT message contains an indication that the timer is deactivated or the timer value is zero, then timer T3512 is deactivated and the UE shall not perform the periodic registration update procedure.\nNOTE\u00a01:\tThe UE does not perform the periodic registration update procedure for non-3GPP access.\nIf during the registration procedure, the AMF does not indicate \"strictly periodic registration timer supported\" in the MICO indication IE to the UE, timer T3512 is reset and started with its initial value, when the UE changes from 5GMM-CONNECTED over 3GPP access to 5GMM-IDLE mode over 3GPP access. Timer T3512 is stopped when the UE enters 5GMM-CONNECTED mode over 3GPP access or the 5GMM-DEREGISTERED state over 3GPP access.\nIf during the registration procedure, the AMF indicates \"strictly periodic registration timer supported\" in the MICO indication IE to the UE, timer T3512 is started with its initial value after the completion of the registration procedure. The UE shall neither stop nor reset the timer T3512 when the UE enters 5GMM-CONNECTED or when changing from 5GMM-CONNECTED mode to 5GMM-IDLE mode. If the timer T3512 expires,\na)\tthe UE in 5GMM-CONNECTED mode over 3GPP access shall reset and start the timer T3512 with its initial value; or\nb)\tthe UE in 5GMM-IDLE mode over 3GPP access shall perform the periodic registration procedure.\nIf the UE is registered for emergency services, and timer T3512 expires, the UE shall not initiate a periodic registration update procedure, but shall locally de-register from the network. When the UE is camping on a suitable cell, it may re-register to regain normal service.\nWhen a UE is not registered for emergency services, and timer T3512 expires when the UE is in 5GMM-IDLE mode, the periodic registration update procedure shall be started.\nIf the UE is not registered for emergency services, and is in a state other than 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE over 3GPP access when timer T3512 expires, the periodic registration update procedure is delayed until the UE returns to 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE over 3GPP access.\nNOTE\u00a02:\tWhen the UE returns to 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE and it needs to initiate other 5GMM procedure than the periodic registration update procedure then, based on UE implementation, the 5GMM procedure can take precedence.\nThe network supervises the periodic registration update procedure of the UE by means of the mobile reachable timer.\nIf the UE is not registered for emergency services, the mobile reachable timer shall be longer than the value of timer T3512. In this case, by default, the mobile reachable timer is 4 minutes greater than the value of timer T3512.\nThe network behaviour upon expiry of the mobile reachable timer is network dependent, but typically the network stops sending paging messages to the UE on the first expiry, and may take other appropriate actions.\nIf the UE is registered for emergency services, the AMF shall set the mobile reachable timer with a value equal to timer T3512. When the mobile reachable timer expires, the AMF shall locally de-register the UE.\nThe mobile reachable timer shall be reset and started with the value as indicated above, when the AMF releases the NAS signalling connection for the UE. The mobile reachable timer shall be stopped when a NAS signalling connection is established for the UE.\nUpon expiry of the mobile reachable timer the network shall start the implicit de-registration timer over 3GPP access. The value of the implicit de-registration timer over 3GPP access is network dependent. If MICO mode is activated, the network shall start the implicit de-registration timer over 3GPP access when the UE enters 5GMM-IDLE mode at the AMF over 3GPP access. The default value of the implicit de-registration timer over 3GPP access is 4 minutes greater than the value of timer T3512.\nIf the implicit de-registration timer expires before the UE contacts the network, the network shall implicitly de-register the UE. The implicit de-registration timer shall be stopped when a NAS signalling connection is established for the UE.\nIf the non-3GPP implicit de-registration timer expires before the UE contacts the network over the non-3GPP access, the network shall implicitly de-register the UE and enter the state 5GMM-DEREGISTERED over non-3GPP access for the UE. The non-3GPP implicit de-registration timer shall be stopped when a NAS signalling connection over non-3GPP access is established for the UE.\nIf the non-3GPP de-registration timer expires before the UE contacts the network over the non-3GPP access, the UE shall enter the state 5GMM-DEREGISTERED over non-3GPP access. The non-3GPP de-registration timer shall be stopped when a NAS signalling connection over non-3GPP access is established for the UE.\nIf the AMF provides T3346 value IE in the DEREGISTRATION REQUEST message with Access type set to \"Non-3GPP access\" in Deregistration type IE, REGISTRATION REJECT message during a registration procedure for mobility and periodic registration update or SERVICE REJECT message and the value of timer T3346 is greater than the value of timer T3512, the AMF sets the mobile reachable timer and the implicit de-registration timer such that the sum of the timer values is greater than the value of timer T3346.\nIf the AMF provides T3346 value IE in the DEREGISTRATION REQUEST message with Access type set to \"3GPP access\" in Deregistration type IE, REGISTRATION REJECT message during a registration procedure for mobility and periodic registration update or SERVICE REJECT message and the value of timer T3346 is greater than the value of the non-3GPP de-registration timer, the AMF sets the non-3GPP implicit de-registration timer value to be 8 minutes greater than the value of timer T3346.\nIf the UE receives T3346 value IE in the DEREGISTRATION REQUEST message with Access type set to \"3GPP access\" in Deregistration type IE, REGISTRATION REJECT message during a registration procedure for mobility and periodic registration update or SERVICE REJECT message and the value of timer T3346 is greater than the value of the non-3GPP de-registration timer, the UE sets the non-3GPP de-registration timer value to be 4 minutes greater than the value of timer T3346.\n5.3.8\tHandling of timer T3502\nThe value of timer T3502 can be sent by the network to the UE in the REGISTRATION ACCEPT message. The UE shall apply this value in all tracking areas of the registration area assigned to the UE, until a new value is received.\nThe value of timer T3502 can be sent by the network to the UE in the REGISTRATION REJECT message during the initial registration. If a REGISTRATION REJECT message including timer T3502 value was received integrity protected, the UE shall apply this value until a new value is received with integrity protection or a new PLMN or SNPN is selected. Otherwise, the default value of this timer is used.\nThe default value of this timer is also used by the UE in the following cases:\na)\tREGISTRATION ACCEPT message is received without a value specified, and the 5GS registration type IE in the REGISTRATION REQUEST message is not set to \"periodic registration updating\u201d;\nb)\tthe UE does not have a stored value for this timer;\nc)\ta new PLMN which is not in the list of equivalent PLMNs or a new SNPN has been entered, the initial registration procedure fails, the registration attempt counter is equal to 5 and no REGISTRATION REJECT message was received from the new PLMN or SNPN;\nd)\tthe network indicates that the timer is \"deactivated\"; or\ne)\ta new PLMN which is not in the list of equivalent PLMNs or a new SNPN has been entered, the registration procedure for mobility and periodic registration update fails and the registration attempt counter is equal to 5.\n5.3.9\tHandling of NAS level mobility management congestion control\nThe AMF may detect 5GMM signalling congestion and perform general NAS level congestion control. Under the 5GMM signalling congestion conditions the AMF may reject 5GMM signalling requests from UEs as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8]. The AMF should not reject the following:\na)\trequests for emergency services;\nb)\trequests for emergency services fallback;\nc)\trequests from UEs configured for high priority access in selected PLMN or SNPN;\nd)\tDEREGISTRATION REQUEST message;\ne)\trequests for mobile terminated services, triggered by paging or a notification procedure;\nf)\trequests for initial registration or mobility and periodic registration update, when emergency is indicated by lower layers; and\ng)\trequests for mobility registration update when the UE is reporting unavailability information due to discontinuous coverage.\nWhen general NAS level congestion control is active, the AMF may include a value for the mobility management back-off timer T3346 in the reject messages. The UE starts the timer T3346 with the value received in the 5GMM reject messages. To avoid that large numbers of UEs simultaneously initiate deferred requests, the AMF should select the value for the timer T3346 for the rejected UEs so that timeouts are not synchronised.\nWhen general NAS level congestion control is active, if the current SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), the AMF may include an appropriate cause value other than 5GMM cause #22 \"congestion\" (e.g., #74 \"Temporarily not authorized for this SNPN\") in the reject messages without including timer T3346 value, to allow the UE to enter state 5GMM-REGISTERED.PLMN-SEARCH or 5GMM-DEREGISTERED.PLMN-SEARCH and perform SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\nIf the UE is registered in the same PLMN over the 3GPP access and non-3GPP access, and the UE receives the timer T3346 from the AMF, the timer T3346 shall apply to both 3GPP access and non-3GPP access.\nIf the UE receives the paging message or NOTIFICATION message when timer T3346 is running and the UE is registered to the same PLMN over 3GPP access and non-3GPP access, the UE shall stop the timer T3346 for both accesses and respond to the paging message or NOTIFICATION message as specified in subclause\u00a05.6.2 and subclause\u00a05.6.3.\nNOTE\u00a01:\tAs an implementation option, MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.\nIf the timer T3346 is running when the UE enters state 5GMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then the timer T3346 is kept running until it expires or it is stopped.\nIf the UE is switched off when the timer T3346 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:\n\tlet t1 be the time remaining for T3346 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1\u00a0\u2013\u00a0t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\nIf the UE enters a new PLMN or SNPN while timer T3346 is running, and the new PLMN or SNPN is not equivalent to the PLMN or SNPN where the UE started timer T3346, the UE shall stop timer T3346 when initiating 5GMM procedures in the new PLMN or SNPN.\nAfter a change in registration area, if the timer T3346 is running and 5GS update status is 5U1 UPDATED then the UE shall set the 5GS update status to 5U2 NOT UPDATED and enter state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE.\nIf timer T3346 is running or is deactivated, and:\na)\tthe UE is a UE configured for high priority access in selected PLMN or SNPN; \nb)\tthe UE needs to initiate signalling for emergency services or emergency services fallback; or\nc)\tthe UE needs to report unavailability information due to discontinuous coverage,\nthen the UE is allowed to initiate 5GMM procedures.\nNOTE\u00a02:\tUE can, based on implementation, restrict lower layers of non-3GPP access from establishing access stratum connection on a registered PLMN when timer T3346 is running for the same PLMN.\n5.3.10\tHandling of DNN based congestion control\nThe AMF may detect and start performing DNN based congestion control when one or more DNN congestion criteria as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8] are met. If the UE does not provide a DNN for a non-emergency PDU session, then the AMF uses the selected DNN or the DNN associated with the PDU session corresponding to the 5GSM procedure.\nWhen DNN based congestion control is activated at the AMF, the AMF performs the congestion control as specified in subclause\u00a05.4.5 and the UE performs the congestion control as specified in subclause\u00a05.4.5 and subclause\u00a06.2.7.\n5.3.11\tHandling of S-NSSAI based congestion control\nThe AMF may detect and start performing S-NSSAI based congestion control when one or more S-NSSAI congestion criteria as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8] are met. If the UE does not provide a DNN for a non-emergency PDU session, then the AMF uses the selected DNN or the DNN associated with the PDU session corresponding to the 5GSM procedure. If the UE does not provide an S-NSSAI for a non-emergency PDU session, then the AMF uses the selected S-NSSAI or the S-NSSAI associated with the PDU session corresponding to the 5GSM procedure.\nThe AMF may detect and start performing S-NSSAI based congestion control when the UE that does not support S-NSSAI location validity information requests a PDU session establishment for an S-NSSAI limited by NS-AoS and the UE is not in the NS-AoS.\nWhen S-NSSAI based congestion control is activated at the AMF, the AMF performs the congestion control as specified in subclause\u00a05.4.5 and the UE performs the congestion control as specified in subclause\u00a05.4.5 and subclause\u00a06.2.8.\n5.3.12\tHandling of local emergency numbers\nThe additional requirements in subclause\u00a05.3.12A apply to a UE supporting registration or attach procedures via 3GPP access and registration procedures via non-3GPP access.\nIn case of PLMN, the network may send a local emergency numbers list or an extended local emergency numbers list or both, in the REGISTRATION ACCEPT message, by including the Emergency number list IE and the Extended emergency number list IE, respectively. The Local emergency numbers list can be updated as described in 3GPP\u00a0TS\u00a024.301\u00a0[15], subclause\u00a05.3.7.\nIn case of SNPN, the network may send an extended local emergency numbers list, in the REGISTRATION ACCEPT message, by including the Extended emergency number list IE. The network shall set the Extended Emergency Number List Validity (EENLV) field within the Extended emergency number list IE to \"Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received\". The UE shall consider the emergency number(s) received in the Extended emergency number list IE valid only in the SNPN from which this IE is received regardless of the received value of the EENLV field within the Extended emergency number list IE.\nThe UE shall store the local emergency numbers list and the extended local emergency numbers list, as provided by the network. The local emergency numbers list stored in the UE shall be replaced on each receipt of the Emergency number list IE. The extended local emergency numbers list stored in the UE shall be replaced on each receipt of the Extended emergency number list IE. The received local emergency numbers list or the received extended local emergency numbers list or both shall be provided to the upper layers.\nThe emergency number(s) received in the Emergency number list IE are valid only in PLMNs in the same country as the PLMN from which this IE is received. If no Emergency number list IE is contained in the REGISTRATION ACCEPT message, then the stored local emergency numbers list in the UE shall be kept, except if the UE has successfully registered to a PLMN in a country different from that of the PLMN that sent the list.\nThe emergency number(s) received in the Extended emergency number list IE are valid only in:\n-\tPLMNs in the same country as the PLMN from which this IE is received, if the Extended Emergency Number List Validity (EENLV) field within the Extended emergency number list IE indicates \"Extended Local Emergency Numbers List is valid in the country of the PLMN from which this IE is received\"; and\n-\tthe PLMN from which this IE is received, if the EENLV field within the Extended emergency number list IE indicates \"Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received\"; and\n-\tthe SNPN from which this IE is received, regardless of the value of the EENLV field within the Extended emergency number list IE.\nIf no Extended Local Emergency Numbers List is contained in the REGISTRATION ACCEPT message, and the registered PLMN or the registered SNPN has not changed, then the stored Extended Local Emergency Numbers List in the UE shall be kept. If no Extended Local Emergency Numbers List is contained in the REGISTRATION ACCEPT message, but the registered PLMN or the registered SNPN has changed, then:\n-\tif the last received indication in the EENLV field within the Extended emergency number list IE indicates \"Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received\", the stored Extended Local Emergency Numbers List in the UE shall be deleted; and\n-\tif the last received indication in the EENLV field within the Extended emergency number list IE indicates \"Extended Local Emergency Numbers List is valid in the country of the PLMN from which this IE is received\" the list shall be kept except if the UE has successfully registered to a PLMN in a country different from that of the PLMN that sent the stored list.\nNOTE:\tTo prevent the misrouting of emergency calls, all operators within a country need to follow the regulation or agree on the setting of the Extended emergency number list IE in accordance to national agreement \u2013 either to indicate validity within a country or to indicate validity only within the PLMN.\nThe local emergency numbers list and the extended local emergency numbers list shall be deleted at switch off or removal of the USIM. The UE shall be able to store up to ten entries in the local emergency numbers list and up to twenty entries in the Extended local emergency numbers list, received from the network.\nFor the use of the local emergency numbers list and the extended local emergency numbers list by the UE see 3GPP\u00a0TS\u00a024.301\u00a0[15], subclause\u00a05.3.7.\n5.3.12A\tHandling of local emergency numbers received via 3GPP access and non-3GPP access\n5.3.12A.1\tGeneral\nThe requirements in subclause\u00a05.3.12 with the clarifications and additional conditions in subclause\u00a05.3.12A apply to a UE supporting:\n-\tattach procedures (see 3GPP\u00a0TS\u00a024.301\u00a0[15]) or registration procedures via 3GPP access; and\n-\tregistration procedures via non-3GPP access.\nThe UE shall ignore the presence or absence of local emergency numbers list, extended local emergency numbers list or both, in a REGISTRATION ACCEPT message received via non-3GPP access and keep the stored local emergency numbers list and the extended local emergency numbers list, if available, unless conditions in subclause\u00a05.3.12A.2 are met.\nFor the purposes of subclause\u00a05.3.12A, the UE is considered neither registered nor attached over 3GPP access if:\n1)\tthe UE supports 3GPP access to EPC, the UE does not support 3GPP access to 5GC, and:\na)\tthe EMM sublayer is in the EMM-NULL state, EMM-DEREGISTERED state or EMM-DEREGISTERED-INITIATED state; or\n2)\tthe UE supports 3GPP access to 5GC, the UE does not support 3GPP access to EPC, and:\na)\tthe 5GMM sublayer is in the 5GMM-NULL state, 5GMM-DEREGISTERED state or 5GMM-DEREGISTERED-INITIATED state; or\n3)\tsupports both 3GPP access to EPC and 3GPP access to 5GC, and:\na)\tthe EMM sublayer is in the EMM-NULL state, EMM-DEREGISTERED state or EMM-DEREGISTERED-INITIATED state; and\na)\tthe 5GMM sublayer is in the 5GMM-NULL state, 5GMM-DEREGISTERED state or 5GMM-DEREGISTERED-INITIATED state.\n5.3.12A.2\tReceiving a REGISTRATION ACCEPT message via non-3GPP access\nIf the UE can determine the current country and after switch on or after removal of the USIM, has not been registered or has not been attached via 3GPP access in the current country, then the UE shall store the local emergency numbers list or the extended local emergency numbers list or both, as provided by the network with an MCC matching the current country via non-3GPP access.\nNOTE:\tThe UE determines, as the current country, the country in which it is located in accordance with 3GPP\u00a0TS\u00a024.502\u00a0[18].\nThe UE shall replace a previously stored local emergency numbers list or a previously stored extended local emergency numbers list or both with a local emergency numbers list or an extended local emergency numbers list or both received in a REGISTRATION ACCEPT message via non-3GPP access, if the previously stored local emergency numbers list was also received via non-3GPP access or the previously stored extended local emergency numbers list was also received via non-3GPP access.\nThe UE shall replace a previously stored extended local emergency numbers list with an extended local emergency numbers list received in a REGISTRATION ACCEPT message via non-3GPP access, if:\n-\tthe UE is neither registered nor attached over 3GPP access;\n-\tthe REGISTRATION ACCEPT message is received from a PLMN different from which the stored list was received; and\n-\tthe stored indication in the EENLV field within the Extended emergency number list IE indicates \"Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received\".\nIf no extended local emergency numbers list is contained in a REGISTRATION ACCEPT message received via non-3GPP access and the UE is neither registered nor attached over 3GPP access, the stored extended local emergency numbers list in the UE shall be discarded if:\n-\tthe UE can determine the current country and the UE has successfully registered to a PLMN in the country and that country is different from that of the PLMN that sent the stored list; or\n-\tthe REGISTRATION ACCEPT message is received from a PLMN different from which the stored list was received, and the stored indication in the EENLV field within the Extended emergency number list IE indicates \"Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received\".\n5.3.13\tLists of 5GS forbidden tracking areas\nIf the UE is not operating in SNPN access operation mode, the UE shall store a list of \"5GS forbidden tracking areas for roaming\", as well as a list of \"5GS forbidden tracking areas for regional provision of service\". Otherwise the UE shall store a list of \"5GS forbidden tracking areas for roaming\":\n-\tper SNPN; and\n-\tif the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, per entry of the \"list of subscriber data\" or, if the UE supports access to an SNPN using credentials from a credentials holder, PLMN subscription;\nand store a list of \"5GS forbidden tracking areas for regional provision of service\":\n-\tper SNPN; and\n-\tif the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, per entry of the \"list of subscriber data\" or, if the UE supports access to an SNPN using credentials from a credentials holder, PLMN subscription.\nWithin the 5GS, these lists are managed independently per access type, i.e., 3GPP access or wireline access. These lists shall be erased when:\na)\tthe UE is switched off, the UICC containing the USIM is removed, an entry of the \"list of subscriber data\" with the subscribed SNPN identity identifying the current SNPN is updated or, if the UE supports access to an SNPN using credentials from a credentials holder, the entry of the \"list of subscriber data\" associated with the lists is updated; and\nb)\tperiodically (with a period in the range 12 to 24 hours).\nOver 3GPP access, when the lists are erased, the UE performs cell selection according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C]. If the UE is not operating in SNPN access operation mode a tracking area shall be removed from the list of \"5GS forbidden tracking areas for roaming\", as well as the list of \"5GS forbidden tracking areas for regional provision of service\", if the UE receives the tracking area in the TAI list or the Service area list of \"allowed tracking areas\" in REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message. \nThe UE operating in SNPN access operation mode shall remove a tracking area from the list of \"5GS forbidden tracking areas for roaming\" as well as the list of \"5GS forbidden tracking areas for regional provision of service\" for:\n-\tthe selected SNPN; and\n-\twhen the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, for the selected entry of the \"list of subscriber data\" or, when the UE supports access to an SNPN using credentials from a credentials holder, the selected PLMN subscription;\nif the UE receives the tracking area in the TAI list or the Service area list of \"allowed tracking areas\" in REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message.\nThe UE shall not remove the tracking area from \"5GS forbidden tracking areas for roaming\" or \"5GS forbidden tracking areas for regional provision of service\" if the UE is registered for emergency services.\nIn N1 mode over 3GPP access, the UE shall update the suitable list whenever a REGISTRATION REJECT, SERVICE REJECT or DEREGISTRATION REQUEST message is received with the 5GMM cause #12 \"tracking area not allowed\", #13 \"roaming not allowed in this tracking area\", #15 \"no suitable cells in tracking area\", or #62 \"no network slices available\".\nIn N1 mode over 3GPP access, if the UE receives the \"5GS forbidden tracking areas for roaming\" IE or the \"5GS forbidden tracking areas for regional provision of service\" IE in the REGISTRATION REJECT, SERVICE REJECT, DEREGISTRATION REQUEST, REGISTRATION ACCEPT or SERVICE ACCEPT message, the UE update the suitable list with the received TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE.\nIf the UE receives ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message provided with S-NSSAI and the PLMN ID in the Protocol configuration options IE or Extended protocol configuration options IE (see subclause\u00a06.5.1.3 of 3GPP\u00a0TS\u00a024.301\u00a0[15]), the UE may remove the corresponding tracking area from the \"5GS forbidden tracking areas for roaming\".\nOver wireline access, the 5G-RG, the W-AGF acting on behalf of an FN-RG or the W-AGF acting on behalf of an N5GC device shall update the suitable list whenever a REGISTRATION REJECT, SERVICE REJECT or DEREGISTRATION REQUEST message is received with the 5GMM cause #12 \"tracking area not allowed\" or #13 \"roaming not allowed in this tracking area\".\nNOTE:\tIn this release of the specification, for untrusted non-3GPP access and trusted non-3GPP access, neither the list of \"5GS forbidden tracking areas for roaming\" nor the list of \"5GS forbidden tracking areas for regional provision of service\" is maintained by the UE since the UE is not able to determine the corresponding TAI.\nEach list shall accommodate 40 or more TAIs. When the list is full and a new entry has to be inserted, the oldest entry shall be deleted.\n5.3.13A\tForbidden PLMN lists\nIn N1 mode, two lists of forbidden PLMN are managed independently per access type, i.e., 3GPP access or non-3GPP access:\n-\tthe list of \"forbidden PLMNs\" as defined in 3GPP\u00a0TS\u00a023.122\u00a0[5] is applicable for 3GPP access in N1 mode. The same list is used by 5GMM for 3GPP access, EMM, GMM and MM (see 3GPP\u00a0TS\u00a024.301\u00a0[15] and 3GPP\u00a0TS\u00a024.008\u00a0[12]), regardless whether the UE is operating in single-registration mode or dual-registration mode.\n-\tthe list of \"forbidden PLMNs for non-3GPP access to 5GCN\" as defined in 3GPP TS 24.502\u00a0[18] is applicable for 5GMM for non-3GPP access.\nThe list of \"forbidden PLMNs for GPRS service\" as defined in 3GPP\u00a0TS\u00a023.122\u00a0[5] and 3GPP\u00a0TS\u00a024.008\u00a0[12] is applicable for 3GPP access in N1 mode. The same list is used by 5GMM for 3GPP access, EMM and GMM (see 3GPP\u00a0TS\u00a024.301\u00a0[15] and 3GPP\u00a0TS\u00a024.008\u00a0[12]), regardless whether the UE is operating in single-registration mode or dual-registration mode.\nThe forbidden PLMN lists shall be maintained across activation and deactivation of SNPN access operation mode.\nNOTE:\tOn timer T3245 expiry when the UE supports access to an SNPN using credentials from a credentials holder using PLMN subscription, and the UE is operating in SNPN access operation mode, as an implementation option the UE can delete the list of \"forbidden PLMNs\", \"forbidden PLMNs for non-3GPP access to 5GCN\" and \"forbidden PLMNs for GPRS service\".\n5.3.14\tList of equivalent PLMNs\nThe UE shall store a list of equivalent PLMNs. These PLMNs shall be regarded by the UE as equivalent to each other for PLMN selection and cell selection/re-selection. The same list is used by 5GMM, EMM, GMM and MM (see 3GPP\u00a0TS\u00a024.301\u00a0[15] and 3GPP\u00a0TS\u00a024.008\u00a0[12]) except for the case when the UE operates in dual-registration mode (see subclause\u00a04.8.3).\nThe UE shall update or delete this list at the end of each registration procedure. The stored list consists of a list of equivalent PLMNs as downloaded by the network plus the PLMN code of the registered PLMN that downloaded the list. When the UE is switched off, the UE shall keep the stored list so that it can be used for PLMN selection after switch on. The UE shall delete the stored list if the USIM is removed or when the UE registered for emergency services enters the state 5GMM-DEREGISTERED. The maximum number of possible entries in the stored list is 16.\nIf the UE registers to different PLMNs over 3GPP and non-3GPP accesses, the UE shall store an additional list of equivalent PLMNs associated with non-3GPP access. The UE manages the two lists of equivalent PLMNs per access type independently.\n5.3.14A\tList of equivalent SNPNs\nThe UE may support equivalent SNPNs.\nIf the UE supports equivalent SNPNs, the ME shall store a list of equivalent SNPNs:\n-\tper entry of \"list of subscriber data\"; or\n-\tper the PLMN subscription, if the UE supports access to an SNPN using credentials from a credentials holder.\nSNPNs in the list of equivalent SNPNs associated with the selected entry of \"list of subscriber data\" or the selected PLMN subscription shall be regarded by the UE as equivalent to each other for SNPN selection, cell selection and cell re-selection.\nThe list of equivalent SNPNs associated with the selected entry of \"list of subscriber data\" or the selected PLMN subscription is created, replaced or deleted at the end of each registration procedure. The stored list consists of a list of equivalent SNPNs as provided by the network plus the SNPN identity of the registered SNPN that provided the list.\nWhen the UE is switched off, the UE shall keep the stored list(s) so that they can be used for SNPN selection after switch on.\nThe UE shall delete the stored list associated with an entry of \"list of subscriber data\" or the PLMN subscription, when the USIM is removed, the associated entry of \"list of subscriber data\" is updated, or the UE registered for emergency services enters the state 5GMM-DEREGISTERED.\nThe maximum number of possible entries in each stored list is 16.\nNOTE\u00a01:\tTo enable UE mobility between the registered SNPN and an equivalent SNPN, the SNPN identity of the registered SNPN providing a list of equivalent SNPNs and the SNPN identity(ies) in the list of equivalent SNPNs are assumed to be globally-unique SNPN identities.\nNOTE\u00a02:\tThe MS can provide the list of equivalent SNPNs associated with the selected entry of \"list of subscriber data\" or the selected PLMN subscription to the lower layers.\nIf the UE supports equivalent SNPNs and registers to different SNPNs over 3GPP and non-3GPP accesses, the UE shall store an additional list of equivalent SNPNs associated with non-3GPP access. The UE manages the two lists of equivalent SNPNs per access type independently.\n5.3.15\tTransmission failure abnormal case in the UE\nThe abnormal case 5GMM uplink message transmission failure indication by lower layers can be identified for 5GMM procedures:\n\tWhen it is specified in the relevant procedure that it is up to the UE implementation to re-run the ongoing procedure that triggered that procedure, the procedure can typically be re-initiated using a retransmission mechanism of the uplink message (i.e. the one that has previously failed to be transmitted) with new sequence number and message authentication code information thus avoiding to re-start the whole procedure.\nNOTE:\tThe transmission failure can happen due to TAI change. The lower layer might take some time to read the system information and determine if the current TAI is changed. Therefore, the information of TAI change can be sent to the NAS layer a little after receiving the transmission failure indication from the lower layer. How to handle the retransmission procedure caused by the possible delayed TAI change information is up to UE implementation.\n5.3.16\tExtended DRX cycle for UEs in 5GMM-IDLE and 5GMM-CONNECTED mode with RRC inactive indication\nExtended DRX (eDRX) cycle is supported for a UE in N1 mode. When eDRX is requested by the UE and accepted by the network:\n-\tif the UE is not in NB-N1 mode, eDRX is used when the UE is in 5GMM-IDLE mode or in 5GMM-CONNECTED mode with RRC inactive indication; or\n-\tif the UE is in NB-N1 mode, eDRX is used when the UE is in 5GMM-IDLE mode.\nThe UE may request the use of eDRX cycle during a registration procedure by including the Requested extended DRX parameters IE (see 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a023.502\u00a0[9]). The UE shall not request the use of eDRX during a registration procedure for emergency services. The UE may use the extended idle mode DRX cycle length stored in the USIM (see 3GPP\u00a0TS\u00a031.102\u00a0[22]) when requesting the use of eDRX.\nThe UE and the network may negotiate eDRX parameters during a registration procedure when the UE has an emergency PDU session.\nThe network accepts the request to use the eDRX by providing the Negotiated extended DRX parameters IE when accepting the registration procedure. The UE shall use eDRX only if it received the Negotiated extended DRX parameters IE during the last registration procedure and the UE does not have an emergency PDU session.\nNOTE\u00a01:\tIf the UE wants to keep using eDRX, the UE includes the Extended DRX parameters IE in each registration procedure.\nIf the UE received the Negotiated extended DRX parameters IE during the last registration procedure, upon successful completion of the PDU session release procedure of the emergency PDU session, the UE shall resume eDRX.\nIf the network has provided the Negotiated extended DRX parameters IE during the last registration procedure, upon successful completion of the PDU session release procedure of the emergency PDU session, the network shall resume eDRX.\nIf the UE or the network locally releases an emergency PDU session, the UE or the network shall not use eDRX until the UE receives eDRX parameters during a registration procedure with PDU session context synchronization or upon successful completion of a service request procedure with PDU session context synchronization.\nIf the UE did not receive the Negotiated extended DRX parameters IE, or if the UE has an emergency PDU session, the UE shall use the stored UE specific DRX parameter, if available.\nIf the network did not accept the request to use eDRX, or if the UE has an emergency PDU session, the network shall use the stored UE specific DRX parameter, if available.\nIf the network provided the Negotiated extended DRX parameters IE and also assigned a new 5G-GUTI for the UE as described in subclause\u00a05.5.1.3.4 during the last registration procedure, the network shall use the stored UE specific DRX parameter, if available, with the old 5G-GUTI and use the eDRX provided by the network with the new 5G-GUTI until the old 5G-GUTI can be considered as invalid by the network (see subclauses\u00a05.4.4.4 and\u00a05.5.1.3.4).\nNOTE\u00a02:\tIf the UE using eDRX has joined one or more multicast MBS sessions or wants to receive the traffic of broadcast MBS sessions, the upper layers of the UE provide the lower layers with the MBS start time and the scheduled activation times of the respective MBS session if any of those times are obtained via the service announcement as specified in 3GPP\u00a0TS\u00a023.247\u00a0[53]. This interaction between the upper layers and the lower layers is out of scope of the present document. If the UE fails to receive paging or data for a multicast MBS session which the UE has joined or data for a broadast MBS session, the UE can as an implementation option initiate 5GMM procedures (e.g. for the transfer of mobile originated signalling or user data) to enter 5GMM-CONNECTED mode over 3GPP access and obtain via the service announcement a new start time, a sequence of scheduled activation times or both.\n5.3.17\tService Gap Control\nService gap control (SGC) only applies to 3GPP access.\nThe network may control the frequency with which UEs can transition from 5GMM-IDLE mode to 5GMM-CONNECTED mode via the SGC as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a023.502\u00a0[9]. If the network supports SGC and the service gap time value i.e. T3447 value is available in the 5GMM context of the UE, the AMF shall consider SGC as active for the UE.\nThe UE and the network negotiate usage of SGC during the registration procedure for initial registration and registration procedure for mobility and periodic registration update:\n-\tthe UE supporting SGC indicates its support in the REGISTRATION REQUEST message. If the UE supports SGC and the SGC is active for the UE, the AMF includes T3447 value IE in the REGISTRATION ACCEPT message (see subclause\u00a05.5.1.2 and subclause\u00a05.5.1.3). The UE stores the T3447 value; and\n-\tfor UEs that do not support SGC when the network rejects mobility management signalling requests because SGC is active in the network, the mechanism for general NAS level mobility management congestion control as specified in subclause\u00a05.3.9 applies.\nThe network can provide a new T3447 value to the UE to be used next time it is started or stop timer T3447 in the UE if running with the Generic UE configuration update procedure as specified in subclause\u00a05.4.4.\nThe UE shall start timer T3447 when the N1 NAS signalling connection is released and if:\n-\tthe UE supports SGC, and the T3447 value is available in the UE and does not indicate zero; and\n-\tthe N1 NAS signalling connection released was not established for:\n-\tpaging;\n-\tregistration procedure for initial registration with Follow-on request indicator set to \"No follow-on request pending\";\n-\tregistration procedure for mobility and periodic registration update with Follow-on request indicator set to \"No follow-on request pending\" and without Uplink data status IE included;\n-\trequests for emergency services; or\n-\trequests for exception data reporting.\nIf the SGC is active in the network, after the UE transitions from 5GMM-CONNECTED mode to 5GMM-IDLE mode except when the UE was in 5GMM-CONNECTED mode due to:\n-\tpaging;\n-\tregistration procedure for initial registration with Follow-on request indicator set to \"No follow-on request pending\";\n-\tregistration procedure for mobility and periodic registration update with Follow-on request indicator set to \"No follow-on request pending\" and without Uplink data status IE included,\n-\trequests for emergency services; or\n-\trequests for exception data reporting,\nthe network shall start timer T3447 if not already running:\n-\twith the T3447 value available in the 5GMM context minus 4 minutes, if the UE supports SGC and the T3447 value has been sent to the UE with a non-zero value; or\n-\twith the T3447 value available in the 5GMM context if the UE does not support SGC.\nWhen timer T3447 is running, the network allows:\n-\trequests for emergency service;\n-\trequests for emergency services fallback;\n-\trequests for high priority access;\n-\trequests for exception data reporting;\n-\tregistration procedure for initial registration with Follow-on request indicator set to \"No follow-on request pending\";\n-\tregistration procedure for mobility and periodic registration update without Uplink data status IE included and with Follow-on request indicator set to \"No follow-on request pending\"; or\n-\tservice request procedure or registration procedure for mobility and periodic registration update triggered by paging and subsequent MO signalling or MO data, if any, until the UE enters 5GMM-IDLE mode.\nThe UE or the network with a running T3447 timer keeps the timer running when the UE transits from 5GMM-IDLE mode to 5GMM-CONNECTED mode.\nNOTE:\tIf the UE transitions from 5GMM-IDLE mode to 5GMM-CONNECTED mode due to registration procedure for initial registration with Follow-on request indicator set to \"No follow-on request pending\" or mobility and periodic registration update request without Uplink data status IE and with Follow-on request indicator set to \"No follow-on request pending\", the UE initiates no further MO signalling except for mobility and periodic registration update requests without Uplink data status and with Follow-on request indicator set to \"No follow-on request pending\" until the UE receives mobile terminated signalling (e.g. DL NAS TRANSPORT message for MT SMS) or MT data over user plane, or after the UE has moved to 5GMM-IDLE state and the service gap timer is not running.\nIf timer T3447 is running when the UE changes PLMN or enters state 5GMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3447 is kept running until it expires.\nIf the AMF determines that the UE operating in single-registration mode has performed an inter-system change from N1 mode to S1 mode and the timer T3447 is running in the AMF, the AMF stops the T3447.\nUpon inter-system change from S1 mode to N1 mode, if the UE supports service gap control, T3447 is running in the UE, and the T3447 value IE is included in the REGISTRATION ACCEPT message received from the AMF (see subclause\u00a05.5.1.2 and subclause\u00a05.5.1.3), the UE shall keep T3447 running. Additionally, the UE shall store and replace the currently stored service gap time value with the received T3447 value. Upon expiry of the running T3447 timer, the UE shall use the new value when starting T3447 again.\nIf the UE is switched off when the timer T3447 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:\n-\tlet t1 be the time remaining for timer T3447 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than\u00a0t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\n5.3.18\tRestriction on use of enhanced coverage\nIn order to deal with use of extensive resources from the network, the operator may prevent specific subscribers from using enhanced coverage (see 3GPP\u00a0TS\u00a023.501\u00a0[8]). When in NB-N1 mode, the UE shall indicate support for restriction on use of enhanced coverage. When in WB-N1 mode, the UE supporting either CE mode A or CE mode B shall indicate support for restriction on use of enhanced coverage. The UE supporting restriction on use of enhanced coverage indicates its support for restriction on use of enhanced coverage in the REGISTRATION REQUEST message. If the UE supports restriction on use of enhanced coverage, the AMF indicates in the REGISTRATION ACCEPT message (see subclause\u00a05.5.1.2 and subclause\u00a05.5.1.3) that:\na)\twhen in WB-N1 mode, whether CE mode B is restricted for the UE, or both CE mode A and CE mode B are restricted for the UE, or both CE mode A and CE mode B are not restricted for the UE; or\nb)\twhen in NB-N1 mode, whether the use of enhanced coverage is restricted or not for the UE.\nIf:\na)\tthe use of enhanced coverage is restricted;\nb)\tthe use of CE mode B is restricted; or\nc)\tthe use of CE mode A and CE mode B is restricted,\nthe UE shall not use enhanced coverage in the registered PLMN and in any PLMN which is in the list of equivalent PLMNs.\nIf the UE supports CE mode B and the network determines that\na)\tthe use of enhanced coverage is not restricted for the UE; or\nb)\tCE mode B is not restricted for the UE,\nthe applicable NAS timer values shall be calculated by the network as described in subclause\u00a04.19 and subclause\u00a04.20.\nFor a UE that supports restriction on use of enhanced coverage or CE mode B, if:\na)\tthe AMF determines to enforce a change in restriction on the use of enhanced coverage or a change in the restriction on the use of CE mode B as described in 3GPP\u00a0TS\u00a023.501\u00a0[8]; and\nb)\tthe UE is in 5GMM-CONNECTED mode and there is no ongoing registration procedure,\nthe AMF shall initiate the generic UE configuration update procedure to indicate registration requested and release of the N1 NAS signalling connection not requested as described in subclause\u00a05.4.4. After the successful completion of the registration procedure for mobility registration update including change of the restriction on the use of enhanced coverage, for any SMF with which the UE has an established PDU session, the AMF updates the SMF with the indication on the use of extended NAS timer setting as described in 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a023.502\u00a0[9].\n5.3.19\tHandling of congestion control for transport of user data via the control plane\nThe network may activate congestion control for transport of user data via the control plane, as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8].\nIf the UE has indicated support for the control plane CIoT 5GS optimizations and the network decides to activate the congestion control for transport of user data via the control plane, the network may include a value for the control plane data back-off timer T3448 in REGISTRATION ACCEPT, SERVICE ACCEPT or SERVICE REJECT message, and shall store an control plane data back-off time on a per UE basis. The UE starts the timer T3448 with the value informed in the message. To avoid that large numbers of UEs simultaneously initiate deferred requests, the network should select the value for the timer T3448 for the informed UEs so that timeouts are not synchronised.\nThe network sends REGISTRATION ACCEPT message or SERVICE ACCEPT message without T3448 value IE to stop the timer T3448 running in the UE as specified in subclause\u00a05.5.1.3.4 and subclause\u00a05.6.1.4.\nBased on the stored control plane data back-off time for the UE, the network may reject the transfer of user data via the control plane initiated by the UE.\nWhile the timer T3448 is running, the UE in 5GMM-IDLE mode does not initiate the transport of user data via the control plane procedure, except if the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP\u00a0TS\u00a024.368\u00a0[17] or the USIM file EFNASCONFIG in 3GPP\u00a0TS\u00a031.102\u00a0[22]) and the user data is related to an exceptional event.\nThe UE is allowed:\na)\tto respond to paging with CONTROL PLANE SERVICE REQUEST message without uplink data; or\nb)\tto send a CONTROL PLANE SERVICE REQUEST message for emergency services or for emergency services fallback;\neven if the timer T3448 is running.\nUpon entering the state 5GMM-DEREGISTERED or a new PLMN which is not equivalent to the PLMN where the UE started the timer T3448, or upon being switched off while the timer T3448 is running, the UE stops the timer T3448.\n5.3.19A\tSpecific requirements for UE configured to use timer T3245\n5.3.19A.1\tUE not operating in SNPN access operation mode\nThe following requirements apply for a UE that is configured to use timer T3245 (see 3GPP\u00a0TS\u00a024.368\u00a0[17] or 3GPP\u00a0TS\u00a031.102\u00a0[22]).\nWhen the UE adds a PLMN identity to the \"forbidden PLMN list\" or sets the USIM as invalid for 5GS services for 3GPP access or non-3GPP access, and timer T3245 (see 3GPP\u00a0TS\u00a024.008\u00a0[12]) is not running, the UE shall start timer T3245 as specified in 3GPP\u00a0TS\u00a024.008\u00a0[12], subclause\u00a04.1.1.6.\nUpon expiry of the timer T3245, the UE shall erase the \"forbidden PLMN list\" and \"forbidden PLMNs for GPRS service\" list and set the USIM to valid for 5GS services for 3GPP access and non-3GPP access. When the lists are erased, the UE performs cell selection according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C].\nIf the UE is switched off when the timer T3245 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:\n-\tlet t1 be the time remaining for T3245 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the UE will follow the behaviour as defined in the paragraph above upon expiry of the timer T3245. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\n5.3.19A.2\tUE operating in SNPN access operation mode\nThe following requirements apply for a UE that is configured to use timer T3245 (see 3GPP\u00a0TS\u00a024.368\u00a0[17]).\nWhen the UE adds an SNPN to the \"permanently forbidden SNPNs\" list or \"temporarily forbidden SNPNs\" list which are, if the MS supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, or sets the selected entry of the \"list of subscriber data\" or the selected PLMN subscription as invalid for 3GPP access or non-3GPP access, and timer T3245 (see 3GPP\u00a0TS\u00a024.008\u00a0[12]) is not running, the UE shall start timer T3245 with a random value, uniformly drawn from the range between 12h and 24h.\nWhen the UE adds an SNPN to the \"permanently forbidden SNPNs for access for localized services in SNPN\" list or \"temporarily forbidden SNPNs for access for localized services in SNPN\" list which are associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription for 3GPP access or non-3GPP access, and timer T3245 is not running:\na)\tif there is no next valid time period for the SNPN, the UE shall start timer T3245 with a random value, uniformly drawn from the range between 12h and 24h; or\nb)\tif there is next valid time period for the SNPN, the UE shall start timer T3245 with a random value uniformly drawn from the range between the start time point and the end time point of the next valid time period for localized services in SNPN.\nNOTE\u00a01:\tThe random value to calculate the value of timer T3245 can be UE implementation-specific value for the UE to perform SNPN selection for localized services in SNPN and receive localized services in the SNPN before the valid time of localized services ends.\nUpon expiry of the timer T3245, the UE shall erase the \"permanently forbidden SNPNs\" list(s) and \"temporarily forbidden SNPNs\" list(s) and set the selected entry of the \"list of subscriber data\" or the selected PLMN subscription to valid for 3GPP access and non-3GPP access. When the lists are erased, the UE performs cell selection according to 3GPP\u00a0TS\u00a038.304\u00a0[28].\nIf the UE is switched off when the timer T3245 is running, the UE shall behave as follows when the UE is switched on and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription remain the same:\n-\tlet t1 be the time remaining for T3245 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the UE will follow the behaviour as defined in the paragraph above upon expiry of the timer T3245. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\n5.3.20\tSpecific requirements for UE when receiving non-integrity protected reject messages\n5.3.20.1\tGeneral\nThis subclause specifies the requirements for a UE that is not configured to use timer T3245 (see 3GPP\u00a0TS\u00a024.368\u00a0[17] or 3GPP\u00a0TS\u00a031.102\u00a0[22]) and receives a REGISTRATION REJECT or SERVICE REJECT message without integrity protection with specific 5GMM causes.\nNOTE:\tAdditional UE requirements for this case, requirements for other 5GMM causes, and requirements for the case when the UE receives an integrity protected reject message are specified in subclauses\u00a05.5.1 and 5.6.1.\n5.3.20.2\tRequirements for UE in a PLMN\nThe UE shall maintain:\n-\ta list of PLMN-specific attempt counters (see 3GPP\u00a0TS\u00a024.301\u00a0[15]). The maximum number of possible entries in the list is implementation dependent. This list is applicable to access attempts via 3GPP access only;\n-\ta list of PLMN-specific attempt counters for non-3GPP access, if the UE supports non-3GPP access. The maximum number of possible entries in the list is implementation dependent. This list is applicable to access attempts via non-3GPP access only;\n-\ta list of PLMN-specific N1 mode attempt counters for 3GPP access. The maximum number of possible entries in the list is implementation dependent. This list is applicable to access attempts via 3GPP access only;\n-\ta list of PLMN-specific N1 mode attempt counters for non-3GPP access, if the UE supports non-3GPP access. The maximum number of possible entries in the list is implementation dependent. This list is applicable to access attempts via non-3GPP access only;\n-\tone counter for \"SIM/USIM considered invalid for GPRS services\" events (see 3GPP TS 24. 008 [12]);\n-\tone counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events, if the UE supports non-3GPP access; and\n-\ta list of PLMN-specific attempt counters for the determined PLMN with disaster condition, if the UE supports MINT. The maximum number of possible entries in the list is implementation dependent. This list is applicable to access attempts via 3GPP access only.\nA UE supporting non-EPS services shall maintain one counter for \"SIM/USIM considered invalid for non-GPRS services\" events (see 3GPP TS 24.008 [12]).\nThe UE shall store the above lists of attempt counters and the event counters in its non-volatile memory. The UE shall erase the lists and reset the event counters to zero when the UICC containing the USIM is removed. The counter values shall not be affected by the activation or deactivation of MICO mode or power saving mode (see 3GPP\u00a0TS\u00a024.301\u00a0[15]).\nThe UE implementation-specific maximum value for any of the above counters shall not be greater than 10.\nNOTE\u00a01:\tDifferent counters can use different UE implementation-specific maximum values.\nIf the UE receives a REGISTRATION REJECT or SERVICE REJECT message without integrity protection with 5GMM cause value #3, #6, #7, #11, #12, #13, #15, #27, #31, #62, #72, #73 or #80 before the network has established secure exchange of NAS messages for the N1 NAS signalling connection, the UE shall stop timer T3510 or T3517 if running, and start timer T3247 (see 3GPP\u00a0TS\u00a024.008\u00a0[12]) with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running, and take the following actions:\n1)\tif the 5GMM cause value received is #3, #6 or #7, and:\na)\tif the 5GMM cause value is received over 3GPP access, the UE shall:\ni)\tif the UE is already registered over another access:\n-\tstore the current TAI in the list of \"5GS forbidden tracking areas for roaming\", memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for non-integrity protected NAS reject message and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; and\n-\tsearch for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C]; or\nii)\totherwise, if the counter for \"SIM/USIM considered invalid for GPRS services\" events has a value less than a UE implementation-specific maximum value,\n-\tset the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI for 3GPP access;\n-\tif the 5GMM cause value received is #3 or #6, delete the list of equivalent PLMNs if any;\n-\tincrement the counter for \"SIM/USIM considered invalid for GPRS services\" events;\n-\tif the 5GMM cause value received is #3 or #6, and if the counter for \"SIM/USIM considered invalid for non-GPRS services\" events has a value less than a UE implementation-specific maximum value, increment the counter;\n-\tif a registration procedure was performed, reset the registration attempt counter and if a service request procedure was performed, reset the service request attempt counter;\n-\tif the UE is operating in single-registration mode, handle the EMM parameters EMM state, EPS update status, EPS attach attempt counter, tracking area updating attempt counter or service request attempt counter, 4G-GUTI, TAI list, eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the EPS attach, tracking area updating procedure or service request procedure is rejected with the EMM cause of the same value in a NAS message without integrity protection;\n-\tstore the current TAI in the list of \"5GS forbidden tracking areas for roaming\", memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for non-integrity protected NAS reject message and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; and\n-\tsearch for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C]; and as a UE implementation option, the UE may perform registration attempt over the non-3GPP access, if non-3GPP access is available, and the USIM is not considered invalid for 5GS services over non-3GPP access; and\niii)\totherwise proceed as specified in subclauses\u00a05.5.1 and 5.6.1;\nb)\tif the 5GMM cause value is received over non-3GPP access, the UE shall:\ni)\tif the UE is already registered over another access:\n-\tenter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; and\n-\tmay perform registration attempt over the non-3GPP access if another access point for non-3GPP access is available; or\nii)\totherwise, if the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events has a value less than a UE implementation-specific maximum value,\n-\tset the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) and shall delete the 5G-GUTI, last visited registered TAI, TAI list and ngKSI for non-3GPP access;\n-\tenter the state 5GMM-DEREGISTERED.LIMITED-SERVICE;\n-\tincrement the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events; and as a UE implementation option, the UE may either perform registration attempt over the non-3GPP access if another access point for non-3GPP access is available, or if 3GPP access is available, and the USIM is not considered invalid for 5GS services over 3GPP access, perform registration attempt over the 3GPP access; and\nNOTE\u00a02: How to select another access point for non-3GPP access is implementation specific.\niii)\totherwise proceed as specified in subclauses\u00a05.5.1 and 5.6.1;\n2)\tif the 5GMM cause value received is #12, #13 or #15, the UE shall proceed as specified in subclauses\u00a05.5.1 and 5.6.1. Additionally, the UE may:\na)\tif the 5GMM cause value is received over 3GPP access, non-3GPP access is available, the UE is not registered over non-3GPP access yet, and the USIM is not considered invalid for 5GS services over non-3GPP access, perform registration attempt over the non-3GPP access; or\nb)\tif the 5GMM cause value is received over non-3GPP access, 3GPP access is available, the UE is not registered over 3GPP access yet, and the USIM is not considered invalid for 5GS services over 3GPP access, perform registration attempt over the 3GPP access;\n3)\tif the 5GMM cause value received is #11 or #73 and the UE is in its HPLMN or EHPLMN:\na)\tif the 5GMM cause value is received over 3GPP access, the UE shall:\n-\tset the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete, the 5G-GUTI, last visited registered TAI, TAI list, ngKSI for 3GPP access and the list of equivalent PLMNs. Additionally, if a registration procedure was performed, the UE shall reset the registration attempt counter and if a service request procedure was performed, reset the service request attempt counter;\n-\tif the 5GMM cause value received is #11 and the UE is operating in single-registration mode, handle the EMM parameters EMM state, EPS update status, EPS attach attempt counter, tracking area updating attempt counter or service request attempt counter, 4G-GUTI, TAI list, eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the EPS attach, tracking area updating procedure or service request procedure is rejected with the EMM cause of the same value in a NAS message without integrity protection;\n-\tif the 5GMM cause value received is #73 and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED and shall delete any 4G-GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter or tracking area updating attempt counter, and enter the state EMM-DEREGISTERED;\n-\tstore the current TAI in the list of \"5GS forbidden tracking areas for roaming\", memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for non-integrity protected NAS reject message and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; and\n-\tsearch for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C]; and as a UE implementation option, the UE may perform registration attempt over the non-3GPP access, if non-3GPP access is available, the UE is not registered over non-3GPP access yet, and the USIM is not considered invalid for 5GS services over non-3GPP access;\nb)\tif the 5GMM cause value is received over non-3GPP access, the UE shall:\n-\tset the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete the 5G-GUTI, last visited registered TAI, TAI list and ngKSI for non-3GPP access. Additionally, if a registration procedure was performed, the UE shall reset the registration attempt counter and if a service request procedure was performed, reset the service request attempt counter; and\n-\tenter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. As a UE implementation option, the UE may perform registration attempt over the non-3GPP access if another access point for non-3GPP access is available, or if 3GPP access is available, the UE is not registered over 3GPP access yet, and the USIM is not considered invalid for 5GS services over 3GPP access, perform registration attempt over the 3GPP access;\n4)\tif the 5GMM cause value received is #11 or #73 and the UE is not in its HPLMN or EHPLMN, in addition to the UE requirements specified in subclause\u00a05.5.1 and 5.6.1:\n-\tif the message was received via 3GPP access and if the PLMN-specific attempt counter for the PLMN sending the reject message has a value less than a UE implementation-specific maximum value, the UE shall increment the PLMN-specific attempt counter for the PLMN; or\n-\tif the message was received via non-3GPP access and if the PLMN-specific attempt counter for non-3GPP access for the PLMN sending the reject message has a value less than a UE implementation-specific maximum value, the UE shall increment the PLMN-specific attempt counter for non-3GPP access for the PLMN;\n5)\tif the 5GMM cause value received is #27, the UE shall proceed as specified in subclauses\u00a05.5.1 and 5.6.1. Additionally, if the PLMN-specific N1 mode attempt counter for the respective access type and for the PLMN sending the reject message has a value less than a UE implementation-specific maximum value, the UE shall increment this counter for the PLMN;\n6)\tif the 5GMM cause value received is #72, the UE shall proceed as specified in subclauses\u00a05.5.1 and 5.6.1. Additionally, if the PLMN-specific N1 mode attempt counter for non-3GPP access for the PLMN sending the reject message has a value less than a UE implementation-specific maximum value, the UE shall increment this counter for the PLMN;\n7)\tif the 5GMM cause value received is #31 for a UE that has indicated support for CIoT optimizations, the UE may discard the message or alternatively the UE should:\n-\tset the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2);\n-\tstore the current TAI in the list of \"5GS forbidden tracking areas for roaming\", memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for non-integrity protected NAS reject message; and\n-\tsearch for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C]; and\n8)\tif the 5GMM cause value received is #62, the UE may discard the message or alternatively the UE should:\n-\tset the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2);\n-\tstore the current TAI in the list of \"5GS forbidden tracking areas for roaming\", memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for non-integrity protected NAS reject message; and\n-\tsearch for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C].\n9)\tif the 5GMM cause value received is #80, the UE shall proceed as specified in subclauses\u00a05.5.1. If the PLMN-specific attempt counter of the PLMN which sent the reject message for the determined PLMN with disaster condition has a value less than a UE implementation-specific maximum value, the UE shall increment the PLMN-specific attempt counter of the PLMN which sent the reject message for the determined PLMN with disaster condition.\nUpon expiry of timer T3247, the UE shall:\n-\tremove all tracking areas from the list of \"5GS forbidden tracking areas for regional provision of service\" and the list of \"5GS forbidden tracking areas for roaming\", which were stored in these lists for non-integrity protected NAS reject message;\n-\tset the USIM to valid for 5GS services for 3GPP access, if:\n-\tthe counter for \"SIM/USIM considered invalid for GPRS services\" events has a value less than a UE implementation-specific maximum value;\n-\tset the USIM to valid for 5GS services for non-3GPP access, if:\n-\tthe counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events has a value less than a UE implementation-specific maximum value;\n-\tset the USIM to valid for non-EPS services, if:\n-\tthe counter for \"SIM/USIM considered invalid for non-GPRS services\" events has a value less than a UE implementation-specific maximum value;\n-\tfor each PLMN-specific attempt counter that has a value greater than zero and less than a UE implementation-specific maximum value, remove the respective PLMN from the extension of the \"forbidden PLMNs\" list;\n-\tfor each PLMN-specific attempt counter for non-3GPP access that has a value greater than zero and less than a UE implementation-specific maximum value, remove the respective PLMN from the list of \"forbidden PLMNs for non-3GPP access to 5GCN\";\n-\tre-enable the N1 mode capability for 3GPP access and, for each PLMN-specific N1 mode attempt counter for 3GPP access that has a value greater than zero and less than a UE implementation-specific maximum value, remove the respective PLMN from the list of PLMNs where N1 mode is not allowed for 3GPP access (see 3GPP\u00a0TS\u00a023.122\u00a0[5]);\n-\tre-enable the N1 mode capability for non-3GPP access and, for each PLMN-specific N1 mode attempt counter for non-3GPP access that has a value greater than zero and less than a UE implementation-specific maximum value, remove the respective PLMN from the list of PLMNs where N1 mode is not allowed for non-3GPP access;\n-\tif the UE is supporting A/Gb mode or Iu mode, perform the actions as specified in 3GPP\u00a0TS\u00a024.008\u00a0[12] for the case when timer T3247 expires;\n-\tif the UE is supporting S1 mode, perform the actions as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when timer T3247 expires;\n-\tinitiate a registration procedure, if still needed, dependent on 5GMM state and 5GS update status, or perform PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5]; and\n-\tfor each PLMN-specific attempt counter of the PLMN which sent the reject message for the determined PLMN with disaster condition that has a value greater than zero and less than a UE implementation-specific maximum value, consider the PLMN which sent the reject message is available for disaster roaming service for the respective determined PLMN with disaster condition.\nWhen the UE is switched off, the UE shall, for each PLMN-specific attempt counter that has a value greater than zero and less than the UE implementation-specific maximum value, remove the respective PLMN from the list of \"forbidden PLMNs\". When the USIM is removed, the UE should perform this action.\nWhen the UE is switched off, the UE shall, for each PLMN-specific attempt counter for non-3GPP access that has a value greater than zero and less than the UE implementation-specific maximum value, remove the respective PLMN from the list of \"forbidden PLMNs for non-3GPP access to 5GCN\". When the USIM is removed, the UE should perform this action.\nWhen the UE is switched off, the UE shall, for each PLMN-specific attempt counter of the PLMN which sent the reject message for the determined PLMN with disaster condition that has a value greater than zero and less than the UE implementation-specific maximum value, consider the PLMN is available for disaster roaming service for the respective determined PLMN with disaster condition. When the USIM is removed, the UE should perform this action.\nNOTE\u00a03:\tIf the respective PLMN was stored in the extension of the \"forbidden PLMNs\" list, then according to 3GPP\u00a0TS\u00a023.122\u00a0[5] the UE will delete the contents of this extension when the UE is switched off or the USIM is removed.\n5.3.20.3\tRequirements for UE in an SNPN\nIf the UE is operating in SNPN access operation mode, the UE shall maintain, for each of the entries in the \"list of subscriber data\":\n-\tone SNPN-specific attempt counter for 3GPP access. The counter is applicable to access attempts via 3GPP access only;\n-\tone SNPN-specific attempt counter for non-3GPP access, if the UE supports access to SNPN over non-3GPP access. The counter is applicable in case of access to SNPN over non-3GPP access only;\nNOTE\u00a01:\tIf the UE accesses to SNPN service directly over non-3GPP access or if the UE accesses to SNPN services via a PLMN, the SNPN-specific attempt counter for non-3GPP access is used.\n-\tone counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events; and\n-\tone counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events, if the UE supports access to SNPN over non-3GPP access. The counter is applicable in case of access to SNPN over non-3GPP access only.\nNOTE\u00a02:\tIf the UE accesses to SNPN service directly over non-3GPP access or if the UE accesses to SNPN services via a PLMN, the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events is used.The UE shall store the above counters in its non-volatile memory. The UE shall erase the attempt counters and reset the event counters to zero when the selected entry of the \"list of subscriber data\" is updated or USIM is removed for the selected PLMN subscription. The counter values shall not be affected by the activation or deactivation of MICO mode or power saving mode (see 3GPP\u00a0TS\u00a024.301\u00a0[15]).\nThe UE implementation-specific maximum value for any of the above counters shall not be greater than 10.\nNOTE\u00a03:\tDifferent counters can use different UE implementation-specific maximum values.\nIf the UE receives a REGISTRATION REJECT or SERVICE REJECT message without integrity protection with 5GMM cause value #3, #6, #7, #12, #13, #15, #27, #72, #74, or #75 before the network has established secure exchange of NAS messages for the N1 NAS signalling connection, the UE shall stop timer T3510 or T3517, if running. If the SNPN sending the message is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) and there is next valid time period(s) for the SNPN, the UE shall start timer T3247 (see 3GPP\u00a0TS\u00a024.008\u00a0[12]) with a random value uniformly drawn from the range between the start time point of the next valid time period for localized services in SNPN and:\na)\tfor 5GMM cause value #74:\n1)\t30 minutes after the start time point of the next valid time period for localized services in SNPN, if the next valid time period is longer than 30 minutes; or\n2)\tthe end time point of the next valid time period for localized services in SNPN, if the next valid time period is not longer than 30 minutes; or\nb)\tfor other 5GMM cause values:\n1)\t60 minutes after the start time point of the next valid time period for localized services in SNPN, if the next valid time period is longer than 60 minutes; or\n2)\tthe end time point of the next valid time period for localized services in SNPN, if the next valid time period is not longer than 60 minutes;\notherwise between:\na)\t15 minutes and 30 minutes for 5GMM cause value #74; or\nb)\t30 minutes and 60 minutes for other 5GMM cause values;\nif the timer is not running, and take the following actions:\na)\tif the 5GMM cause value received is #3, #6, or #7 and the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN:\n1)\tif the 5GMM cause value is received over 3GPP access:\ni)\tif the UE is already registered over another access, the UE shall:\nA)\tstore the current TAI in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, for non-integrity protected NAS reject message and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; and\nB)\tsearch for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28]; or\nii)\totherwise if the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events has a value less than a UE implementation-specific maximum value, the UE shall:\nA)\tset the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete 5G-GUTI, last visited registered TAI, TAI list, and ngKSI for 3GPP access;\nA1)\tif the 5GMM cause value received is #3 or #6, delete the list of equivalent SNPNs, if any;\nB)\tincrement the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events;\nC)\treset the registration attempt counter in case of a REGISTRATION REJECT message or reset the service request attempt counter in case of a SERVICE REJECT message;\nD)\tstore the current TAI in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, for non-integrity protected NAS reject message, and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; and\nE)\tsearch for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28]. As a UE implementation option, if access to SNPN over non-3GPP access is available and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription is not considered invalid for non-3GPP access, then the UE may perform registration attempt over non-3GPP access; or\niii)\totherwise, the UE shall proceed as specified in subclauses\u00a05.5.1 and 5.6.1;\n2)\tif the 5GMM cause value is received over non-3GPP access:\ni)\tif the UE is already registered over another access, the UE shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; or\nii)\totherwise if the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events has a value less than a UE implementation-specific maximum value, the UE shall:\nA)\tset the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete the 5G-GUTI, last visited registered TAI, TAI list, and ngKSI for non-3GPP access;\nB)\tenter the state 5GMM-DEREGISTERED.LIMITED-SERVICE; and\nC)\tincrement the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events. As a UE implementation option, if 3GPP access is available and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription is not considered invalid for 3GPP access, then the UE may make a registration attempt over 3GPP access; or\niii)\totherwise, the UE shall proceed as specified in subclauses\u00a05.5.1 and 5.6.1;\nb)\tif the 5GMM cause value received is #12, #13, or #15, the UE shall proceed as specified in subclauses\u00a05.5.1 and 5.6.1. Additionally:\n1)\tif the 5GMM cause value is received over 3GPP access, access to SNPN over non-3GPP access is available, the UE is not registered over non-3GPP access yet, and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription is not considered invalid for non-3GPP access, the UE may perform registration attempt over non-3GPP access; or\n2)\tif the 5GMM cause value is received over non-3GPP access, 3GPP access is available, the UE is not registered to the current SNPN over 3GPP access yet, and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription is not considered invalid for 3GPP access, the UE may make a registration attempt over 3GPP access;\nc)\tif the 5GMM cause value received is #27, the UE shall proceed as specified in subclauses\u00a05.5.1 and 5.6.1. Additionally, if the SNPN-specific attempt counter for the respective access type and for the current SNPN has a value less than a UE implementation-specific maximum value, the UE shall increment this counter for the SNPN;\nc1)\tif the 5GMM cause value received is #72, the UE shall proceed as specified in subclauses\u00a05.5.1 and 5.6.1. Additionally, if the SNPN-specific attempt counter for non-3GPP access for the current SNPN has a value less than a UE implementation-specific maximum value, the UE shall increment this counter for the SNPN; and\nd)\tif: \n1)\tthe 5GMM cause value received is #74 or #75; or\n2)\tthe 5GMM cause value received is #3, #6, or #7 and the UE is registered for onboarding services in SNPN or performing initial registration for onboarding services in SNPN;\n\tin addition to the UE requirements specified in subclauses\u00a05.5.1 and 5.6.1:\n1)\tif the message was received via 3GPP access and if the SNPN-specific attempt counter for 3GPP access for the SNPN sending the reject message has a value less than a UE implementation-specific maximum value, the UE shall increment the SNPN-specific attempt counter for 3GPP access for the SNPN; or\n2)\tif the message was received via non-3GPP access and if the SNPN-specific attempt counter for non-3GPP access for the SNPN sending the reject message has a value less than a UE implementation-specific maximum value, the UE shall increment the SNPN-specific attempt counter for non-3GPP access for the SNPN.\nUpon expiry of timer T3247, the UE shall:\n-\tremove, for each SNPN, all tracking areas from the list of \"5GS forbidden tracking areas for regional provision of service\" and the list of \"5GS forbidden tracking areas for roaming\" for the SNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, which were stored in these lists for non-integrity protected NAS reject message;\n-\tset each entry of the \"list of subscriber data\" or the PLMN subscription to valid for 3GPP access, if the corresponding counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events has a value less than a UE implementation-specific maximum value;\n-\tset each entry of the \"list of subscriber data\" or the PLMN subscription to valid for non-3GPP access, if the corresponding counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events has a value less than a UE implementation-specific maximum value;\n-\tremove each SNPN identity from the \"permanently forbidden SNPNs\" list for 3GPP access, \"temporarily forbidden SNPNs\" list, \"permanently forbidden SNPNs for access for localized services in SNPN\" list or \"temporarily forbidden SNPNs for access for localized services in SNPN\" list for 3GPP access which are, if the MS supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if the corresponding SNPN-specific attempt counter for 3GPP access has a value greater than zero and less than a UE implementation-specific maximum value and the SNPN identity is included in any of the \"permanently forbidden SNPNs\" list for 3GPP access, \"temporarily forbidden SNPNs\" list, \"permanently forbidden SNPNs for access for localized services in SNPN\" list or \"temporarily forbidden SNPNs for access for localized services in SNPN\" list for 3GPP access;\n-\tremove each SNPN identity from the \"permanently forbidden SNPNs\" list for non-3GPP access or \"temporarily forbidden SNPNs\" list for non-3GPP access which are, if the MS supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if the corresponding SNPN-specific attempt counter for non-3GPP access has a value greater than zero and less than a UE implementation-specific maximum value and the SNPN identity is included in any of the \"permanently forbidden SNPNs\" list for non-3GPP access or \"temporarily forbidden SNPNs\" list for non-3GPP access;\n-\tre-enable the N1 mode capability for 3GPP access and, for each SNPN-specific attempt counter for 3GPP access that has a value greater than zero and less than a UE implementation-specific maximum value, remove the respective SNPN from the list of SNPNs for which the N1 mode capability was disabled due to receipt of a reject from the network with 5GMM cause #27 \"N1 mode not allowed\" (see 3GPP\u00a0TS\u00a023.122\u00a0[5]);\n-\tre-enable the N1 mode capability for non-3GPP access and, for each SNPN-specific attempt counter for non-3GPP access that has a value greater than zero and less than a UE implementation-specific maximum value, remove the respective SNPN from the list of SNPNs for which N1 mode capability was disabled for non-3GPP access due to receipt of a reject from the network with 5GMM cause #27 \"N1 mode not allowed\" or 5GMM cause #72 \"non-3GPP access to 5GCN not allowed\"; and\n-\tinitiate a registration procedure, if still needed, dependent on 5GMM state and 5GS update status, or perform SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\nWhen the UE is switched off or a UICC containing the USIM is removed:\n-\tfor each SNPN-specific attempt counter for 3GPP access having a value greater than zero and less than the UE implementation-specific maximum value, the UE shall remove the respective SNPN identity from the \"permanently forbidden SNPNs\" list(s), \"temporarily forbidden SNPNs\" list(s), \"permanently forbidden SNPNs for access for localized services in SNPN\" list(s) or \"temporarily forbidden SNPNs for access for localized services in SNPN\" list(s) for 3GPP access, if available; and\n-\tfor each SNPN-specific attempt counter for non-3GPP access having a value greater than zero and less than the UE implementation-specific maximum value, the UE shall remove the respective SNPN identity from the \"permanently forbidden SNPNs\" list(s) for non-3GPP access or \"temporarily forbidden SNPNs\" list(s) for non-3GPP access, if available.\nWhen an entry of the \"list of subscriber data\" is updated:\n-\tif the UE does not support access to an SNPN using credentials from a credentials holder and equivalent SNPNs, and the SNPN-specific attempt counter for 3GPP access for the SNPN corresponding to the entry has a value greater than zero and less than the UE implementation-specific maximum value, the UE shall remove the SNPN identity corresponding to the entry from the \"permanently forbidden SNPNs\" list for 3GPP access or \"temporarily forbidden SNPNs\" list for 3GPP access, if available;\n-\tif the UE does not support access to an SNPN using credentials from a credentials holder and equivalent SNPNs, and the SNPN-specific attempt counter for non-3GPP access for the SNPN corresponding to the entry has a value greater than zero and less than the UE implementation-specific maximum value, the UE shall remove the SNPN identity corresponding to the entry from the \"permanently forbidden SNPNs\" list for non-3GPP access or \"temporarily forbidden SNPNs\" list for non-3GPP access, if available;\n-\tif the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, and the SNPN-specific attempt counter for 3GPP access for an SNPN in the \"permanently forbidden SNPNs\" list for 3GPP access or \"temporarily forbidden SNPNs\" list for 3GPP access, associated with the entry, has a value greater than zero and less than the UE implementation-specific maximum value, the UE shall remove the SNPN identity corresponding to the SNPN from the \"permanently forbidden SNPNs\" list for 3GPP access or \"temporarily forbidden SNPNs\" list for 3GPP access, associated with the entry;\n-\tif the UE supports access to an SNPN providing access for localized services in SNPN, and the SNPN-specific attempt counter for 3GPP access for an SNPN in the \"permanently forbidden SNPNs for access for localized services in SNPN\" list or \"temporarily forbidden SNPNs for access for localized services in SNPN\" list, associated with the entry, has a value greater than zero and less than the UE implementation-specific maximum value, the UE shall remove the SNPN identity corresponding to the SNPN from the \"permanently forbidden SNPNs for access for localized services in SNPN\" list or \"temporarily forbidden SNPNs for access for localized services in SNPN\" list for 3GPP access, associated with the entry; and\n-\tif the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, and the SNPN-specific attempt counter for non-3GPP access for an SNPN in the \"permanently forbidden SNPNs\" list for non-3GPP access or \"temporarily forbidden SNPNs\" list for non-3GPP access associated with the entry, has a value greater than zero and less than the UE implementation-specific maximum value, the UE shall remove the SNPN identity corresponding to the SNPN from the \"permanently forbidden SNPNs\" list for non-3GPP access or \"temporarily forbidden SNPNs\" list for non-3GPP access, associated with the entry.\n5.3.21\tCIoT 5GS optimizations\nCIoT 5GS optimizations provide improved support of small data and SMS transfer. A UE supporting CIoT 5GS optimizations can indicate the 5GS CIoT network behaviour the UE can support and prefers to use during the registration procedure (see 3GPP\u00a0TS\u00a023.502\u00a0[9]). The UE may indicate the support for control plane CIoT 5GS optimization, user plane CIoT 5GS optimization, N3 data transfer and header compression (see subclause\u00a09.11.3.1). Furthermore, the UE may, separately from the indication of support, indicate preference for control plane CIoT 5GS optimization or user plane CIoT 5GS optimization (see subclause\u00a09.11.3.9A). The indication of preference is also considered as the request to use. A UE supporting CIoT EPS optimizations can also indicate the EPS CIoT network behaviour the UE can support during the registration procedure. Furthermore, the UE may, separately from the indication of support, indicate preference for control plane CIoT EPS optimization or user plane CIoT EPS optimization.\nNOTE\u00a01:\tCIoT 5GS optimizations are not supported by NR connected to 5GCN.\nNOTE\u00a02:\tIf the UE does not support user plane CIoT 5GS optimization, it does not indicate preference for user plane CIoT 5GS optimization.\nThe UE can be in NB-N1 mode or WB-N1 mode when requesting the use of CIoT 5GS optimizations during the registration procedure. A UE in NB-N1 mode always indicates support for control plane CIoT 5GS optimization.\nIn NB-N1 mode, the UE, when requesting the use of CIoT 5GS optimizations, does not:\n-\trequest an initial registration for emergency services;\n-\trequest a PDU session establishment for emergency PDU session; or\n-\tindicate UE's usage setting during the registration procedure.\nThe network does not indicate to the UE support of emergency services when the UE is in NB-N1 mode (see subclause\u00a05.5.1.2.4 and 5.5.1.3.4).\nThe control plane CIoT 5GS optimization enables support of efficient transport of user data (IP, Ethernet and Unstructured) or SMS messages over control plane via the AMF without triggering user-plane resources establishment. The support of control plane CIoT 5GS optimization is mandatory for the network in NB-N1 mode and optional in WB-N1 mode. Optional header compression of IP data and Ethernet data can be applied to PDU sessions with IP PDU session type and Ethernet PDU session type that are configured to support header compression. For IP header compression, Robust Header Compression (ROHC) protocol specified in IETF\u00a0RFC\u00a05795\u00a0[39B] is used. For Ethernet header compression, Ethernet Header Compression (EHC) protocol specified in 3GPP TS 38.323 [29] is used.\nFor a UE that supports Location Services (LCS) notification mechanisms in N1 mode, the control plane CIoT 5GS optimization also enables the transport of location services messages from 5GMM-IDLE mode using the CONTROL PLANE SERVICE REQUEST message when location services are requested (see subclause\u00a06.7.1 in 3GPP\u00a0TS\u00a023.273\u00a0[6B]).\nThe user plane CIoT 5GS optimization enables support for change from 5GMM-IDLE mode over 3GPP access to 5GMM-CONNECTED mode over 3GPP access without the need for using the service request procedure (see subclause\u00a05.3.1.5).\nIf the UE supports user plane CIoT 5GS optimization, it shall also support N3 data transfer.\nIf the UE indicates support of one or more CIoT 5GS optimizations and the network supports one or more CIoT 5GS optimizations and decides to accept the registration request, the network indicates the supported CIoT 5GS optimizations to the UE per registration area when accepting the UE request. Network indication of support is interpreted by the UE as the acceptance to use the respective feature. After completion of the registration procedure, the UE and the network can then use the accepted CIoT 5GS optimizations for the transfer of user data (IP, Ethernet, Unstructured and SMS).\nA UE in NB-N1 mode or WB-N1 mode can request the use of SMS over NAS by setting the SMS requested bit of the 5GS update type IE in the REGISTRATION REQUEST message as specified in subclauses 5.5.1.2.2 and 5.5.1.3.2.\nThe AMF indicates whether it allows the use of SMS over NAS for a UE in NB-N1 mode or WB-N1 mode by setting the SMS allowed bit of the 5GS registration result IE in the REGISTRATION ACCEPT message as specified in subclauses\u00a05.5.1.2.4 and 5.5.1.3.4.\nIf the UE and the network support both the control plane CIoT 5GS optimization and N3 data transfer, then when receiving the UE's request for a PDU session establishment, the AMF decides whether the PDU session should be NEF PDU session or N6 PDU session as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8] and then:\na)\tif NEF PDU session is to be established for unstructured data type, the AMF includes control plane only indication for the requested PDU session to the SMF;\nb)\tif N6 PDU session is to be established and the DNN or S-NSSAI of the newly requested N6 PDU session supports interworking with EPS as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9]:\n1)\tif there are existing N6 PDU sessions supporting interworking with EPS for this UE that were established with the control plane only indication, the AMF includes the control plane only indication for the newly requested N6 PDU session to the SMF; or\n2)\tif there are existing N6 PDU sessions supporting interworking with EPS for this UE that were established without the control plane only indication, the AMF does not include the control plane only indication for the newly requested N6 PDU session to the SMF;\n3)\tif there is no existing N6 PDU session supporting interworking with EPS for this UE, the AMF determines whether to include the control plane only indication for the newly requested N6 PDU session to the SMF based on local policies, the UE's preferred CIoT network behaviour and the supported CIoT network behaviour; and\nc)\tif N6 PDU session is to be established and the DNN or S-NSSAI of the N6 PDU session does not support interworking with EPS as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9], the AMF determines whether to include the control plane only indication for the newly requested N6 PDU session to the SMF based on local policies, the UE's preferred CIoT network behaviour and the supported CIoT network behaviour.\nIn NB-N1 mode, if the UE or the network does not support N3 data transfer, then when receiving the UE's request for a PDU session establishment, the AMF decides whether the PDU session should be NEF PDU session or N6 PDU session as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8] and then includes the control plane only indication for the requested PDU session to the SMF.\nIf the network supports user plane CIoT 5GS optimization, it shall also support N3 data transfer.\nBroadcast system information may provide information about support of CIoT 5GS optimizations (see 3GPP\u00a0TS\u00a036.331\u00a0[25A]). At reception of new broadcast system information, the lower layers deliver it to the 5GMM layer in the UE. The information provided by lower layers is per PLMN and used by the UE to determine whether certain CIoT 5GS optimizations are supported in the cell.\nThe UE shall not attempt to use CIoT 5GS optimizations which are indicated as not supported.\nIn NB-N1 mode, at any given time, there cannot be user-plane resources established for a number of PDU sessions that exceeds the UE' s maximum number of supported user-plane resources. The UE in NB-N1 mode shall not:\na)\trequest the establishment of user-plane resources for a number of PDU sessions that exceeds the UE' s maximum number of supported user-plane resources; or\nb)\tinitiate the establishment of a new PDU session, or request the transfer of a PDU session from the non-3GPP access to the 3GPP access, if:\n1)\tthe UE has indicated preference for user plane CIoT 5GS optimization;\n2)\tthe network accepted the use of user plane CIoT 5GS optimization; and\n3)\tthe UE currently has user-plane resources established fora number of PDU sessions that is equal to the UE' s maximum number of supported user-plane resources.\nThe AMF enforces a limit on the number of PDU sessions with active user-plane resources for a UE in NB-N1 mode based on the UE's maximum number of supported user-plane resources as follows:\na)\tthere can be a maximum of one PDU session with active user-plane resources when the Multiple user-plane resources support bit is set to \"Multiple user-plane resources not supported\", or\nb)\tthere can be a maximum of two PDU sessions with active user-plane resources when the Multiple user-plane resources support bit is set to \"Multiple user-plane resources supported\".\nA PDU session for a UE in NB-N1 mode shall only have one QoS rule and that is the default QoS rule. Reflective QoS is not supported in NB-N1 mode. Reflective QoS is not applicable for a PDU session with control plane only indication.\nIn NB-N1 mode, when the UE requests the lower layer to establish a RRC connection and the UE requests the use of user plane CIoT 5GS optimization, the UE shall pass an indication of the requested CIoT 5GS optimizations to the lower layers. If the UE requests the use of N3 data transfer without user plane CIoT 5GS optimization, then the UE shall also pass an indication of user plane CIoT 5GS optimization to lower layers.\nIn WB-N1 mode, when the UE requests the lower layer to establish a RRC connection and the UE requests the use of control plane CIoT 5GS optimization or user plane CIoT 5GS optimization, the UE shall pass an indication of the requested CIoT 5GS optimizations to the lower layers.\n5.3.22\tInteraction between MICO mode with active time and extended idle mode DRX cycle\nThe UE can request the use of both MICO mode with active time and eDRX during a registration procedure but it is up to the network to decide to enable none, one of them or both (see 3GPP\u00a0TS\u00a023.501\u00a0[8]).\nIf the network accepts the use of both MICO mode with active time (see subclause\u00a05.3.6) and eDRX (see subclause\u00a05.3.16), the extended DRX parameters provided to the UE should allow for multiple paging occasions before the active timer expires.\n5.3.23\tForbidden wireline access area\nThe AMF shall send a REGISTRATION REJECT, SERVICE REJECT or DEREGISTRATION REQUEST message over a wireline access network with the 5GMM cause #77 \"wireline access area not allowed\", if conditions specified in 3GPP\u00a0TS\u00a023.316\u00a0[6D] for AMF's enforcement of forbidden area are fulfilled.\nIf a REGISTRATION REJECT, SERVICE REJECT or DEREGISTRATION REQUEST message is received over a wireline access network with the 5GMM cause #77 \"wireline access area not allowed\":\na)\tthe 5G-RG shall not access 5GCN over the wireline access network until the 5G-RG is switched off, the UICC containing the USIM is removed, or the 5G-RG starts using another wireline access network;\nNOTE:\tWhen the 5G-RG acting on behalf of the AUN3 device receives a REGISTRATION REJECT, SERVICE REJECT or DEREGISTRATION REQUEST message over a wireline access network with the 5GMM cause #77 \"wireline access area not allowed\", the 5G-RG acting on behalf of the AUN3 device can prevent reattempt of the same procedure until the AUN3 device is switched off or the UICC containing the USIM of the AUN3 device is removed.\nb)\tthe W-AGF acting on behalf of the FN-CRG shall not access 5GCN until the W-AGF acting on behalf of the FN-CRG determines that the FN-CRG is switched off; and\nc)\tthe W-AGF acting on behalf of the N5GC device shall not access 5GCN until the W-AGF acting on behalf of the FN-CRG determines that the FN-CRG serving the N5GC device is switched off.\n5.3.24\tWUS assistance\nA UE supporting reception of WUS assistance information indicates its capability for reception of WUS assistance information during registration procedure (see 3GPP\u00a0TS\u00a023.501\u00a0[8]). The UE supporting WUS assistance information may include its UE paging probability information in the Requested WUS assistance information IE in the REGISTRATION REQUEST message (see 3GPP\u00a0TS\u00a023.501\u00a0[8]). The UE shall not include its UE paging probability information during:\na)\ta registration procedure for initial registration for emergency services (see subclause\u00a05.5.1.2);\nb)\ta registration procedure for initial registration for initiating an emergency PDU session (see subclause\u00a05.5.1.2);\nc)\ta registration procedure for mobility and periodic registration update (see subclause\u00a05.5.1.3) for initiating an emergency PDU session if the UE is in the state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE; or\nd)\ta registration procedure for mobility and periodic registration update (see subclause\u00a05.5.1.3) when the UE has an emergency PDU session established.\nThe UE and the network may negotiate the UE paging probability information during a registration procedure when the UE does not have an emergency PDU session. The UE paging probability information is an assistance information used to determine the WUS group for paging UE (see 3GPP\u00a0TS\u00a023.501\u00a0[8], 3GPP\u00a0TS\u00a036.300\u00a0[25B]).\nNOTE\u00a01:\tThe determination of UE paging probability information is up to UE implementation.\nIf a UE supporting WUS assistance information did not receive the Negotiated WUS assistance information IE during the last registration procedure due to an active emergency PDU session over 3GPP access, the UE shall initiate a registration procedure for mobility and periodic registration update to request WUS assistance information after the emergency PDU session is released over 3GPP access.\nIf the UE does not have an emergency PDU session and the network accepts the use of the WUS assistance information for the UE, the network determines the negotiated UE paging probability information for the UE based on the requested UE paging probability information, if any, local configuration or previous statistical information for the UE, and then indicates the negotiated UE paging probability information in the Negotiated WUS assistance information IE to the UE in the REGISTRATION ACCEPT message. The network shall store the negotiated UE paging probability information in the 5GMM context of the UE for paging.\nThe UE shall use WUS assistance information only if the UE received the Negotiated WUS assistance information IE during the last registration procedure. If the UE did not receive the Negotiated WUS assistance information IE during the last registration procedure, the UE shall delete any existing WUS assistance information received from the network.\nIf the network did not accept the request to use WUS assistance information, the network shall delete the stored negotiated UE paging probability information for the UE, if available.\nWhen an emergency PDU session is successfully established after the UE received the Negotiated WUS assistance information IE during the last registration procedure, the UE and the AMF shall not use WUS assistance information until:\n-\tthe successful completion of the PDU session release procedure of the emergency PDU session;\n-\tthe UE receives WUS assistance information during a registration procedure with PDU session status IE or upon successful completion of a service request procedure, if the UE or the network locally releases the emergency PDU session; or\n-\tthe successful completion of the handover of the emergency PDU session to non-3GPP access.\nNOTE\u00a02:\tWUS assistance is not supported by NR connected to 5GCN.\n5.3.25\tPaging Early Indication with Paging Subgrouping Assistance\nA UE may indicate its capability to support NR paging subgrouping during registration procedure when the UE:\n-\tinitiates a registration procedure with 5GS registration type IE not set to \"emergency registration\"; and\n-\tdoes not have an active emergency PDU session.\nNOTE:\tThe requirements for UE-ID based PEI are specified in 3GPP\u00a0TS\u00a038.300\u00a0[27].\nIf a UE supporting NR paging subgrouping did not indicate its capability to support NR paging subgrouping during the last registration procedure due to an active emergency PDU session over 3GPP access, the UE shall initiate a registration procedure for mobility and periodic registration update procedure to indicate its capability to support NR paging subgrouping after the emergency PDU session is released over 3GPP access.\nIf the UE indicates support of NR paging subgrouping the UE may include its paging probability information in the Requested PEIPS assistance information IE in the REGISTRATION REQUEST message. If the UE indicates support of NR paging subgrouping and the network supports and accepts the use of the PEIPS assistance information for the UE, the network provides to the UE the Negotiated PEIPS assistance information, including the Paging subgroup ID, in the REGISTRATION ACCEPT message or the CONFIGURATION UPDATE COMMAND message. The Paging subgroup ID is used to determine the NR paging subgroup for paging the UE. The UE NAS layer shall indicate the Paging subgroup ID to the access stratum layer. The network shall store the Paging subgroup ID in the 5GMM context of the UE.\nThe UE shall use PEIPS assistance information only if the UE received the Negotiated PEIPS assistance information IE during the last registration procedure. If the UE did not receive the Negotiated PEIPS assistance information IE during the last registration procedure, the UE shall delete any existing PEIPS assistance information received from the network.\nIf the network did not accept the request to use PEIPS assistance information during the registration procedure, the network shall delete the stored PEIPS assistance information for the UE, if available.\nIf the UE supports the use of the PEIPS assistance information and the network supports and accepts the use of the PEIPS assistance information, the network may provide the PEIPS assistance information to the UE by including the Updated PEIPS assistance information IE in the CONFIGURATION UPDATE COMMAND message. \nWhen an emergency PDU session is successfully established over 3GPP access after the UE received the Negotiated PEIPS assistance information IE during the last registration procedure, the UE and the AMF shall not use PEIPS assistance information until:\n-\tthe successful completion of the PDU session release procedure of the emergency PDU;\n-\tthe UE receives PEIPS assistance information during a registration procedure with PDU session status IE or upon successful completion of a service request procedure, if the UE or the network locally releases the emergency PDU session;\n-\tthe successful completion of handover of emergency PDU session to non-3GPP access; or\n-\tthe successful transfer of the emergency PDU session in 5GS to the EPS or ePDG connected to EPC.\n5.3.26\tSupport for unavailability period\nIf the UE and network support unavailability period and an event is triggered in the UE making the UE unavailable for a certain period of time, the UE may store its 5GMM and 5GSM context in USIM or non-volatile memory in the ME to be able to reuse it after the unavailability period.\nNOTE\u00a01:\tHow and where the UE stores its contexts depends upon the UE implementation. The UE can store some or all of its contexts in the ME or USIM using existing ME or USIM functionality.\nTo activate the unavailability period, either the UE provides unavailability information, including a type of unavailability, an unavailability period duration if known, and the start of the unavailability period if known, during the registration procedure or the UE includes the type of unavailability and the unavailability period duration if known, during the de-registration procedure (see 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a023.502\u00a0[9]). The support for the unavailability period is negotiated in the registration procedure. If the UE is registered to a PLMN via a satellite NG-RAN cell, the AMF may provide the unavailability period duration of the UE or the start of the unavailability period or both to the UE during the registration procedure. The AMF may consider the unavailability period duration provided by the UE if available and determine the unavailability period duration of the UE as described in subclause\u00a05.5.1.2.4 and 5.5.1.3.4. The AMF may also consider the start of the unavailability period provided by the UE, if available, and determine the start of the unavailability period of the UE as described in subclause\u00a05.5.1.3.4.\nIf the UE provided unavailability information in the last registration procedure for mobility registration or the de-registration procedure, the AMF considers the UE unreachable until the UE registers for a normal service. If the UE did not include a start of the unavailability period, the AMF shall consider the start of the unavailability period to be the time at which AMF received the REGISTRATION REQUEST message or the DEREGISTRATION REQUEST message from the UE. During the registration procedure, the AMF may determine the values of the negotiated extended DRX parameters, the timer T3324, and the periodic registration update timer (T3512) to be provided to the UE based on the unavailability period duration and the start of the unavailability period based on their availability. The AMF should set the value of the mobile reachable timer and implicit de-registration timer based on the unavailability period duration and the start of the unavailability period. The AMF releases the N1 signalling connection after the completion of the registration procedure in which the UE provided unavailability information without providing the start of the unavailability period.\nNOTE\u00a02: \tIf the UE supports MUSIM and the UE and the networks the UE is registered with support the unavailability period, then the UE can indicate a different unavailability period to each registered network.\nIf for discontinuous coverage the UE has stored a discontinuous coverage maximum time offset as described in subclause\u00a05.4.4.3, 5.5.1.2.4, and 5.5.1.3.4, the UE shall set the discontinuous coverage maximum time offset value to a random value up to and including the stored discontinuous coverage maximum time offset for this PLMN and satellite NG-RAN RAT Type, determine a time point equal to the time when the UE is about to lose satellite coverage minus the discontinuous coverage maximum time offset value, and send the REGISTRATION REQUEST message for mobility and periodic registration update to the AMF indicating out of coverage at the determined time point.\nIf for discontinuous coverage the UE has stored a discontinuous coverage maximum time offset as described in subclause\u00a05.4.4.3, 5.5.1.2.4, and 5.5.1.3.4, upon returning in coverage of a TA in the current registration after being out of coverage due to discontinuous coverage, and in the last REGISTRATION ACCEPT message the end of unavailability period report was set to \"UE needs to report end of unavailability period\", the UE shall start the discontinuous coverage maximum time offset timer with a random value up to and including the stored maximum time offset value, if available, for this PLMN and NR satellite access, and starts the discontinuous coverage maximum time offset timer. The UE shall enter 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE state and shall not initiate any NAS signalling on that NR satellite access and PLMN while the discontinuous coverage maximum time offset timer is running. The UE shall stop the discontinuous coverage maximum time offset timer and initiate NAS signalling if the UE receives paging message receives a NOTIFICATION message over non-3GPP access as described in case\u00a0b) subclause\u00a05.6.3.1, has pending emergency services, is establishing an emergency PDU session or is performing emergency services fallback procedure or when the UE enters a TAI outside the registration area. At expiry of the discontinuous coverage maximum time offset timer the UE shall perform a registration procedure for mobility registration update.\nIf the AMF sets the End of unavailability report bit in Unavailability configuration IE value to \u201cUE does not need to report end of unavailability\u201d, then upon returning to a TA in the current registration area the UE shall choose an appropriate substate of 5GMM-REGISTERED and the UE is not required to trigger the registration procedure for mobility registration update when the unavailability period duration has ended. If the AMF does not provide the Unavailability configuration IE or the AMF sets the End of unavailability report bit in Unavailability configuration IE value to \u201cUE needs to report end of unavailability\u201d, the UE should trigger registration procedure for mobility registration update when the unavailability period duration has ended.\nWhen the unavailability period is activated, all NAS timers are stopped and associated procedures aborted except for timers T3512, T3346, T3447, T3448, T3396, T3526, T3584, T3585, T3587, any back-off timers, T3245, T3247, the timer T controlling the periodic search for HPLMN or EHPLMN or higher prioritized PLMNs, and the timer TSENSE controlling the periodic search for PLMNs satisfying the operator controlled signal level threshold (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), the UE shall reset the registration attempt counter and service request attempt counter.\nWhen the UE activates the unavailability period using registration procedure without providing the start of the unavailability period, then after successful completion of the procedure the UE shall enter the state 5GMM-REGISTERED.NO-CELL-AVAILABLE and may deactivate AS layer. Otherwise, if the UE provided the start of unavailability period in the registration procedure, the UE shall enter the state 5GMM-REGISTERED.NO-CELL-AVAILABLE and may deactivate AS layer only after the UE activates the unavailability period.\nWhen the UE activates the unavailability period using the de-registration procedure, then after successful completion of the procedure the UE shall enter the state 5GMM-DEREGISTERED.NO-CELL-AVAILABLE and deactivate the AS layer.\nWhen the UE comes out of the unavailability period the UE shall activate the AS layer if deactivated and perform registration procedure as described in subclause 5.5.1.2.2 and 5.5.1.3.2.\n5.4\t5GMM common procedures\n5.4.1\tPrimary authentication and key agreement procedure\n5.4.1.1\tGeneral\nThe purpose of the primary authentication and key agreement procedure is to enable mutual authentication between the UE and the network and to provide keying material that can be used between the UE and network in subsequent security procedures, as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nTwo methods are defined:\na)\tEAP based primary authentication and key agreement procedure.\nb)\t5G AKA based primary authentication and key agreement procedure.\nThe UE and the AMF shall support the EAP based primary authentication and key agreement procedure and the 5G AKA based primary authentication and key agreement procedure.\n5.4.1.2\tEAP based primary authentication and key agreement procedure\n5.4.1.2.1\tGeneral\nThe purpose of the EAP based primary authentication and key agreement procedure is to provide mutual authentication between the UE and the network and to agree on the keys KAUSF, KSEAF and KAMF (see 3GPP\u00a0TS\u00a033.501\u00a0[24]).\nExtensible authentication protocol (EAP) as specified in IETF\u00a0RFC\u00a03748\u00a0[34] enables authentication using various EAP methods.\nEAP defines four types of EAP messages:\na)\tan EAP-request message;\nb)\tan EAP-response message;\nc)\tan EAP-success message; and\nd)\tan EAP-failure message.\nSeveral rounds of exchanges of an EAP-request message and a related EAP-response message can be required to achieve the authentication (see example in figure\u00a05.4.1.2.1.1).\nThe EAP based primary authentication and key agreement procedure is always initiated and controlled by the network.\nThe EAP-request message, the ngKSI and the ABBA are transported from the network to the UE using the AUTHENTICATION REQUEST message of the EAP message reliable transport procedure.\nThe EAP-response message is transported from the UE to the network using the AUTHENTICATION RESPONSE message of the EAP message reliable transport procedure.\nIf the authentication of the UE completes successfully, the serving AMF intends to initiate a security mode control procedure after the EAP based primary authentication and key agreement procedure and the security mode control procedure intends to bring into use the partial native 5G NAS security context created by the EAP based primary authentication and key agreement procedure, then the EAP-success message and the ngKSI are transported from the network to the UE using the SECURITY MODE COMMAND message of the security mode control procedure (see subclause\u00a05.4.2).\nIf the authentication of the UE completes successfully and the serving AMF does not intend to initiate a security mode control procedure bringing into use the partial native 5G NAS security context created by the EAP based primary authentication and key agreement procedure, then the EAP-success message, and the ngKSI are transported from the network to the UE using the AUTHENTICATION RESULT message of the EAP result message transport procedure.\nNOTE\u00a01:\tThe serving AMF will not initiate a security mode control procedure after the EAP based primary authentication and key agreement procedure e.g. in case of AMF relocation during registration procedure.\nIf the authentication of the UE completes unsuccessfully, the EAP-failure message is transported from the network to the UE using the AUTHENTICATION RESULT message or the AUTHENTICATION REJECT message of the EAP result message transport procedure or in a response of the initial 5GMM procedure as part of which the EAP based primary authentication and key agreement procedure is performed.\nThe AMF shall set the authenticator retransmission timer specified in IETF\u00a0RFC\u00a03748\u00a0[34] subclause\u00a04.3 to infinite value.\nNOTE\u00a02:\tThe EAP message reliable transport procedure provides a reliable transport of EAP messages and therefore retransmissions at the EAP layer do not occur.\nThe AUSF and the AMF support exchange of EAP messages using N12.\nThe UE shall detect and handle any duplication of EAP message as specified in IETF\u00a0RFC\u00a03748\u00a0[34].\n\nFigure\u00a05.4.1.2.1.1: EAP based primary authentication and key agreement procedure\n5.4.1.2.2\tEAP-AKA' related procedures\n5.4.1.2.2.1\tGeneral\nThe UE shall support acting as EAP-AKA' peer as specified in IETF\u00a0RFC\u00a05448\u00a0[40]. The AUSF may support acting as EAP-AKA' server as specified in IETF\u00a0RFC\u00a05448\u00a0[40]. The AAA server of the Credentials Holder (CH) or the Default Credentials Server (DCS) may support acting as EAP-AKA' server as specified in IETF\u00a0RFC\u00a05448\u00a0[40].\nThe EAP-AKA' enables mutual authentication of the UE and the network.\nThe UE can reject the EAP-request/AKA'-challenge message sent by the network. The UE shall proceed with an EAP-request/AKA'-challenge message only if a USIM is present.\nDuring a successful EAP based primary authentication and key agreement procedure, the CK and IK are computed by the USIM. CK and IK are then used by the ME as key material to generate an EMSK or MSK.\n5.4.1.2.2.2\tInitiation\nIn order to initiate the EAP based primary authentication and key agreement procedure using EAP-AKA', the AUSF or the AAA server of the CH or the DCS shall send an EAP-request/AKA'-challenge message as specified in IETF\u00a0RFC\u00a05448\u00a0[40]. The AUSF or the AAA server of the CH or the DCS shall set the AT_KDF_INPUT attribute of the EAP-request/AKA'-challenge message to the SNN. The SNN is in format described in subclause\u00a09.12.1. The AUSF or the AAA server of the CH or the DCS may include AT_RESULT_IND attribute in the EAP-request/AKA'-challenge message.\nThe network shall select an ngKSI value. If an ngKSI is contained in an initial NAS message during a 5GMM procedure, the network shall select a different ngKSI value. The network shall send the selected ngKSI value to the UE along with each EAP message. The network shall send the ABBA value as described in subclause\u00a09.11.3.10 to the UE along with the EAP request message and EAP-success message.\nUpon receiving an EAP-request/AKA'-challenge message, the UE shall check whether the UE has a USIM, shall check the key derivation function indicated in AT_KDF attributes as specified in IETF\u00a0RFC\u00a05448\u00a0[40], and if the value of the Key derivation function field within the received AT_KDF attribute, is of value 1, shall check:\na)\twhether the network name field of the AT_KDF_INPUT attribute is the SNN constructed according to subclause\u00a09.12.1; and\nb)\twhether the network name field of the AT_KDF_INPUT attribute matches the PLMN identity or the SNPN identity of the selected SNPN saved in the UE.\nWhen not operating in SNPN access operation mode, the PLMN identity the UE uses for the above network name check is as follows:\na)\twhen the UE moves from 5GMM-IDLE mode to 5GMM-CONNECTED mode, until the first handover, the UE shall use the PLMN identity of the selected PLMN; and\nb)\tafter handover or inter-system change to N1 mode in 5GMM-CONNECTED mode:\n1)\tif the target cell is not a shared network cell, the UE shall use the PLMN identity received as part of the broadcast system information;\n2)\tif the target cell is a shared network cell and the UE has a valid 5G-GUTI, the UE shall use the PLMN identity that is part of the 5G-GUTI; and\n3)\tif the target cell is a shared network cell and the UE has a valid 4G-GUTI, but not a valid 5G-GUTI, the UE shall use the PLMN identity that is part of the 4G-GUTI.\nWhen operating in SNPN access operation mode, the SNPN identity the UE uses for the above network name check is the SNPN identity of the selected SNPN.\n5.4.1.2.2.3\tUE successfully authenticates network\nIf a USIM is present and the SNN check is successful, the UE shall handle the EAP-request/AKA'-challenge message as specified in IETF\u00a0RFC\u00a05448\u00a0[40]. The USIM shall derive CK and IK and compute the authentication response (RES) using the 5G authentication challenge data received from the ME, and pass RES to the ME. The ME shall derive CK' and IK' from CK and IK, and if the UE operates in SNPN access operation mode and the credentials in the USIM contain an indication to use MSK for derivation of KAUSF after success of primary authentication and key agreement procedure then derive MSK from CK' and IK' otherwise derive EMSK from CK' and IK'.\nNOTE\u00a01:\tWhen the UE is registering or registered for onboarding services in SNPN, credentials in the USIM do not contain an indication to use MSK for derivation of KAUSF after success of primary authentication and key agreement procedure.\nFurthermore, if the UE operates in SNPN access operation mode and the credentials in the USIM\ncontain an indication to use MSK for derivation of KAUSF after success of primary authentication and key agreement procedure then the ME may generate a new KAUSF from the MSK otherwise the ME may generate a new KAUSF from the EMSK.\nIf the ME generates a new KAUSF, the ME shall generate a new KSEAF from the new KAUSF, and the KAMF from the ABBA received together with the EAP-request/AKA'-challenge message, and the new KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24], and create a partial native 5G NAS security context identified by the ngKSI value received together with the EAP-request/AKA'-challenge message in subclause\u00a05.4.1.2.4.2 in the volatile memory of the ME. If the KAMF and the partial native 5G NAS security context are created, the ME shall store the KAMF in the created partial native 5G NAS security context, and shall send an EAP-response/AKA'-challenge message as specified in IETF\u00a0RFC\u00a05448\u00a0[40].\nNOTE\u00a02:\tGeneration of the new KAUSF and the new KSEAF does not result into deletion of the valid KAUSF and the valid KSEAF, if any.\nThe ME shall not use the new KAUSF in the verification of SOR transparent container and UE parameters update transparent container, if any are received, until receipt of an EAP-success message.\nIf the EAP-request/AKA'-challenge message contains AT_RESULT_IND attribute, the UE may include AT_RESULT_IND attribute in the EAP-response/AKA'-challenge message as specified in IETF\u00a0RFC\u00a05448\u00a0[40].\n5.4.1.2.2.4\tErrors when handling EAP-request/AKA'-challenge message\nIf a USIM is present, the SNN check fails or the UE does not accept AUTN during handling of the EAP-request/AKA'-challenge message as specified in IETF\u00a0RFC\u00a05448\u00a0[40], the UE shall send an EAP-response/AKA'-authentication-reject message as specified in IETF\u00a0RFC\u00a05448\u00a0[40].\nIf a USIM is present, the SNN check is successful but the UE detects that the sequence number in AUTN is not correct during handling of the EAP-request/AKA'-challenge message as specified in IETF\u00a0RFC\u00a05448\u00a0[40], the UE shall send an EAP-response/AKA'-synchronization-failure message as specified in IETF\u00a0RFC\u00a05448\u00a0[40].\nIf a USIM is present, the SNN check is successful, the sequence number in AUTN is correct and the UE detects another error during handling of the EAP-request/AKA'-challenge message as specified in IETF\u00a0RFC\u00a05448\u00a0[40], the UE shall send an EAP-response/AKA'-client-error message as specified in IETF\u00a0RFC\u00a05448\u00a0[40].\nIf a USIM is not present, the UE shall send an EAP-response/AKA'-client-error message as specified in IETF\u00a0RFC\u00a05448\u00a0[40].\nFor any of the above, the UE shall start timer T3520 when the AUTHENTICATION RESPONSE message containing the EAP-response message is sent. Furthermore, the UE shall stop any of the timers T3510, T3517 or T3521 (if they were running). Upon receiving an AUTHENTICATION REQUEST message with the EAP message IE containing an EAP-request/AKA'-challenge from the network, the UE shall stop timer T3520, if running, and then process the EAP-request/AKA'-challenge information as normal.\n5.4.1.2.2.5\tNetwork successfully authenticates UE\nUpon reception of the EAP-response/AKA'-challenge message, if procedures for handling an EAP-response/AKA'-challenge message as specified in IETF\u00a0RFC\u00a05448\u00a0[40] are successful and:\na)\tthe AUSF acts as the EAP-AKA' server, the AUSF shall generate EMSK, the KAUSF from the EMSK, and the KSEAF from the KAUSF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]; or\nb)\tthe AAA server of the CH or the DCS acts as the EAP-AKA' server, the AAA server of the CH or the DCS shall generate MSK as described in 3GPP\u00a0TS\u00a033.501\u00a0[24];\nand:\na)\tif the AUSF or the AAA server of the CH or the DCS included the AT_RESULT_IND attribute in the EAP-request/AKA'-challenge message and the AT_RESULT_IND attribute is included in the corresponding EAP-response/AKA'-challenge message, the AUSF or the AAA server of the CH or the DCS shall send an EAP-request/AKA'-notification message as specified in IETF\u00a0RFC\u00a05448\u00a0[40]; or\nb)\tif the AUSF or the AAA server of the CH or the DCS:\n1)\tincluded the AT_RESULT_IND attribute in the EAP-request/AKA'-challenge message and the AT_RESULT_IND attribute is not included in the EAP-response/AKA'-challenge message; or\n2)\tdid not include the AT_RESULT_IND attribute in the EAP-request/AKA'-challenge message;\n\tthen the AUSF or the AAA server of the CH or the DCS shall send an EAP-success message as specified in IETF\u00a0RFC\u00a05448\u00a0[40] and shall consider the procedure complete.\nNOTE\u00a01:\tWhen the AAA server of the CH or the DCS acts as the EAP-AKA' server, the AAA server of the CH or the DCS provides (via the NSSAAF) the MSK and the SUPI to the AUSF. Upon reception of the MSK, the AUSF generates the KAUSF from the MSK, and the KSEAF from the KAUSF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nNOTE\u00a02:\tThe AUSF provides the KSEAF and optionally the SUPI (unless the SEAF provided the AUSF with the SUPI before) to the SEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]. Upon reception of the KSEAF and optionally the SUPI, the SEAF generates the KAMF based on the ABBA, the KSEAF and the SUPI as described in 3GPP\u00a0TS\u00a033.501\u00a0[24] and provides ngKSI and the KAMF to the AMF. Upon reception of the ngKSI and the KAMF, the AMF creates a partial native 5G NAS security context identified by the ngKSI and stores the KAMF in the created partial native 5G NAS security context.\n5.4.1.2.2.6\tUE handling EAP-AKA' notification message\nUpon receiving an EAP-request/AKA'-notification message, the UE shall send an EAP-response/AKA'-notification message as specified in IETF\u00a0RFC\u00a05448\u00a0[40].\n5.4.1.2.2.6A\tEAP based Identification initiation by the network\nIf the AUSF or the AAA server of the CH or the DCS decides to initiate the EAP based identification procedure, the AUSF or the AAA server of the CH or the DCS shall send an EAP-Request/Identity or EAP-Request/AKA'-Identity message as specified in IETF\u00a0RFC\u00a05448\u00a0[40].\nThe AMF shall encapsulate the EAP-Request/Identity or EAP-Request/AKA'-Identity message in the AUTHENTICATION REQUEST message and send it to the UE.\n5.4.1.2.2.6B\tEAP based Identification response by the UE\nUpon receipt of the AUTHENTICATION REQUEST message with EAP-Request/Identity message the UE shall send an AUTHENTICATION RESPONSE message with EAP-Response/Identity to the network. In the EAP-Response/Identity message, the UE shall provide the requested identity according to 3GPP\u00a0TS\u00a033.501\u00a0[24] annex\u00a0F.2, in the UE identity in the EAP-Response/Identity message as specified in IETF\u00a0RFC\u00a05448\u00a0[40].\nUpon receipt of the AUTHENTICATION REQUEST message with EAP-Request/AKA'-Identity message the UE shall send an AUTHENTICATION RESPONSE message with EAP-Response/AKA'-Identity to the network. Based on the attribute received in the EAP-Request/AKA'-Identity, the UE shall provide the requested identity according to 3GPP\u00a0TS\u00a033.501\u00a0[24] annex\u00a0F.2, in the EAP-Response/AKA'-Identity message, as specified in IETF\u00a0RFC\u00a05448\u00a0[40].\nIf the EAP-Request/AKA'-Identity carries the AT_PERMANENT_REQ, the UE shall respond with EAP-Response/AKA'-Client-Error with the error code \"unable to process packet\".\n5.4.1.2.2.7\tNetwork sending EAP-success message\nUpon reception of the EAP-response/AKA'-notification message, if earlier procedures for handling an EAP-request/AKA'-challenge message as specified in IETF\u00a0RFC\u00a05448\u00a0[40] were successful, the AUSF or the AAA server of the CH or the DCS shall send an EAP-success message as specified in IETF\u00a0RFC\u00a05448\u00a0[40] and shall consider the procedure complete.\nNOTE:\tThe AUSF provides the KSEAF to the SEAF. Upon reception of the KSEAF, the SEAF generates the KAMF based on the ABBA and the KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24], and provides ngKSI and the KAMF to the AMF. Upon reception of the ngKSI and the KAMF, the AMF creates a partial native 5G NAS security context identified by the ngKSI, and stores the KAMF in the created partial native 5G NAS security context.\n5.4.1.2.2.8\tUE handling EAP-success message\nUpon receiving an EAP-success message, the ME shall:\na)\tdelete the valid KAUSF and the valid KSEAF, if any;\nb)\tif the ME has not generated a new KAUSF and a new KSEAF and has not created a partial native 5G NAS security context as described in subclause\u00a05.4.1.2.2.3:\n1)\tif the UE operates in SNPN access operation mode and the credentials in the USIM contain an indication to use MSK for derivation of KAUSF after success of primary authentication and key agreement procedure then generate a new KAUSF from the MSK otherwise generate a new KAUSF from the EMSK;\nNOTE:\tWhen the UE is registering or registered for onboarding services in SNPN, credentials in the USIM do not contain an indication to use MSK for derivation of KAUSF after success of primary authentication and key agreement procedure.\n2)\tgenerate a new KSEAF from the new KAUSF, and the KAMF from the ABBA that was received with the EAP-success message, and the new KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24];\n3)\tcreate a partial native 5G NAS security context identified by the ngKSI value in the volatile memory of the ME; and\n4)\tstore the KAMF in the created partial native 5G NAS security context; and\nc)\tconsider the new KAUSF to be the valid KAUSF, and the new KSEAF to be the valid KSEAF, reset the SOR counter and the UE parameter update counter to zero, and store the valid KAUSF, the valid KSEAF, the SOR counter and the UE parameter update counter as specified in annex\u00a0C, and use the valid KAUSF in the verification of SOR transparent container and UE parameters update transparent container, if any are received.\nThe UE shall consider the procedure complete.\n5.4.1.2.2.9\tNetwork not successfully authenticates UE\nUpon reception of the EAP-response/AKA'-challenge message, if procedures for handling an EAP-response/AKA'-challenge message as specified in IETF\u00a0RFC\u00a05448\u00a0[40] are not successful, the AUSF or the AAA server of the CH or the DCS shall send an EAP-request/AKA'-notification message that implies failure as specified in IETF\u00a0RFC\u00a05448\u00a0[40].\n5.4.1.2.2.10\tNetwork sending EAP-failure message\nUpon reception of the EAP-response/AKA'-notification message, if earlier procedures for handling an EAP-request/AKA'-challenge message as specified in IETF\u00a0RFC\u00a05448\u00a0[40] were not successful, the AUSF or the AAA server of the CH or the DCS shall send an EAP-failure message as specified in IETF\u00a0RFC\u00a05448\u00a0[40] and shall consider the procedure complete.\nIf the authentication response (RES) returned by the UE in the AT_RES attribute of the EAP-response/AKA'-challenge message is not valid, the network handling depends upon the type of identity used by the UE in the initial NAS message, that is:\n-\tif the 5G-GUTI was used; or\n-\tif the SUCI was used.\nIf the 5G-GUTI was used, the network should transport the EAP-failure message in the AUTHENTICATION RESULT message of the EAP result message transport procedure, initiate an identification procedure to retrieve SUCI from the UE and restart the EAP based primary authentication and key agreement procedure with the received SUCI.\nIf the SUCI was used for identification in the initial NAS message or in a restarted EAP based primary authentication and key agreement procedure, or the network decides not to initiate the identification procedure to retrieve SUCI from the UE after an unsuccessful EAP based primary authentication and key agreement procedure, the network should transport the EAP-failure message in an AUTHENTICATION REJECT message of the EAP result message transport procedure.\nDepending on local requirements or operator preference for emergency services, if the UE initiates a registration procedure with 5GS registration type IE set to \"emergency registration\" and the AMF is configured to allow emergency registration without user identity, the AMF needs not follow the procedures specified for transporting the EAP-failure message in the AUTHENTICATION REJECT message of the EAP result message transport procedure in the present subclause. The AMF may include the EAP-failure message in a response of the current 5GMM specific procedure or in the AUTHENTICATION RESULT of the EAP result message transport procedure.\n5.4.1.2.2.11\tUE handling EAP-failure message\nUpon receiving an EAP-failure message, the UE shall delete the partial native 5G NAS security context and shall delete the new KAUSF and the new KSEAF, if any were created as described in subclause\u00a05.4.1.2.2.3.\nThe UE shall consider the procedure complete.\nIf the EAP-failure message is received in an AUTHENTICATION REJECT message:\n1)\tif the AUTHENTICATION REJECT message has been successfully integrity checked by the NAS:\n-\tthe UE shall set the update status to 5U3 ROAMING NOT ALLOWED, delete the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI;\n\tIn case of PLMN, the USIM shall be considered invalid until switching off the UE or the UICC containing the USIM is removed.\n\tIn case of SNPN, if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN and the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN shall be considered invalid until the UE is switched off or the entry is updated. Additionally, the UE shall consider the USIM as invalid for the current SNPN until switching off or the UICC containing the USIM is removed.\n\tIn case of SNPN, if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN and the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid until the UE is switched off or the entry is updated. Additionally, the UE shall consider the USIM as invalid for the entry until switching off or the UICC containing the USIM is removed.\n\tIf the UE is registered for onboarding services in SNPN or is performing initial registration for onboarding services in SNPN, the UE shall store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5];\n-\tif the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN, the UE shall set:\ni)\tthe counter for \"SIM/USIM considered invalid for GPRS services\" events, the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events, and the counter for \"SIM/USIM considered invalid for non-GPRS services\" events if maintained by the UE, in case of PLMN; or\nii)\tthe counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events and the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events in case of SNPN;\n\tto UE implementation-specific maximum value.\n\tIf the UE is registered for onboarding services in SNPN or performing initial registration for onboarding services in SNPN, the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value; and\n-\tif the UE is operating in single-registration mode, the UE shall handle EMM parameters, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the authentication procedure is not accepted by the network. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed; and\n2)\tif the AUTHENTICATION REJECT message is received without integrity protection, the UE shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running (see subclause\u00a05.3.20). \n\tAdditionally, if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN, the UE shall:\na)\tif the AUTHENTICATION REJECT message is received over 3GPP access, and the counter for \"SIM/USIM considered invalid for GPRS services\" events in case of PLMN or the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events in case of SNPN has a value less than a UE implementation-specific maximum value, proceed as specified in subclause\u00a05.3.20, list item 1)-a) of subclause\u00a05.3.20.2 (if the UE is not operating in SNPN access operation mode) or list item a)-1) of subclause\u00a05.3.20.3 (if the UE is operating in SNPN access operation mode) for the case that the 5GMM cause value received is #3;\nb)\tif the AUTHENTICATION REJECT message is received over non-3GPP access, and the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events in case of PLMN or the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events in case of SNPN has a value less than a UE implementation-specific maximum value, proceed as specified in subclause\u00a05.3.20, list item 1)-b) of subclause\u00a05.3.20.2 (if the UE is not operating in SNPN access operation mode) or list item a)-2) of subclause\u00a05.3.20.3 (if the UE is operating in SNPN access operation mode) for the case that the 5GMM cause value received is #3;\nc)\totherwise:\ni)\tif the AUTHENTICATION REJECT message is received over 3GPP access:\n-\tThe UE shall set the update status for 3GPP access to 5U3 ROAMING NOT ALLOWED, delete for 3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI.\n-\tIn case of PLMN, the UE shall consider the USIM as invalid for 5GS services via 3GPP access and invalid for non-EPS service until switching off the UE or the UICC containing the USIM is removed.\n\tIn case of SNPN, if the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the UE shall consider the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN as invalid for 3GPP access until the UE is switched off or the entry is updated. Additionally, the UE shall consider the USIM as invalid for the current SNPN via 3GPP access until switching off or the UICC containing the USIM is removed.\n\tIn case of SNPN, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid for 3GPP access until the UE is switched off or the entry is updated. Additionally, the UE shall consider the USIM as invalid for the entry via 3GPP access until switching off or the UICC containing the USIM is removed.\n-\tThe UE shall set:\n-\tthe counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"SIM/USIM considered invalid for non-GPRS services\" events if maintained by the UE, in case of PLMN; or\n-\tthe counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events in case of SNPN;\n\tto UE implementation-specific maximum value.\n-\tIf the UE is operating in single-registration mode, the UE shall handle 4G-GUTI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the authentication procedure is not accepted by the network. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed; and\nii)\tif the AUTHENTICATION REJECT message is received over non-3GPP access:\n-\tthe UE shall set the update status for non-3GPP access to 5U3 ROAMING NOT ALLOWED, delete for non-3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI;\n-\tin case of PLMN, the UE shall consider the USIM as invalid for 5GS services via non-3GPP access until switching off the UE or the UICC containing the USIM is removed.\n\tIn case of SNPN, the UE shall consider the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN as invalid for non-3GPP access until the UE is switched off or the entry is updated. Additionally, the UE shall consider the USIM as invalid for the current SNPN and for non-3GPP access until switching off or the UICC containing the USIM is removed; and\n-\tthe UE shall set:\n-\tthe counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events to UE implementation-specific maximum value in case of PLMN; or\n-\tthe counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events to UE implementation-specific maximum value in case of SNPN.\n\tIf the UE is registered for onboarding services in SNPN or performing initial registration for onboarding services in SNPN, the UE shall:\na)\tif the SNPN-specific attempt counter for the SNPN sending the AUTHENTICATION REJECT message has a value less than a UE implementation-specific maximum value, increment the SNPN-specific attempt counter for the SNPN; or\nb)\totherwise, the UE shall set the update status to 5U3.ROAMING NOT ALLOWED, delete the stored 5G-GUTI, TAI list, last visited registered TAI, and ngKSI, store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\nIf the AUTHENTICATION REJECT message is received by the UE, the UE shall abort any 5GMM signalling procedure, stop any of the timers T3510, T3517, T3519 or T3521 (if they were running), enter state 5GMM-DEREGISTERED and delete any stored SUCI.\n5.4.1.2.2.12\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tEAP-request/AKA'-challenge message with the key derivation function indicated in AT_KDF attributes set to a value other than 1.\n\tThe UE shall act as specified in IETF\u00a0RFC\u00a05448\u00a0[40] subclause\u00a03.2 for the case when the AUTN had been incorrect.\n5.4.1.2.3\tEAP-TLS related procedures\n5.4.1.2.3.1\tGeneral\nThe UE may support acting as EAP-TLS peer as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The AUSF may support acting as EAP-TLS server as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The AAA server of the CH or the DCS may support acting as EAP server of such EAP method as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8].\nThe EAP-TLS enables mutual authentication of the UE and the network.\nWhen initiating an EAP based primary authentication and key agreement procedure using EAP-TLS, the network shall select an ngKSI value. If an ngKSI is contained in an initial NAS message during a 5GMM procedure, the network shall select a different ngKSI value. The network shall send the selected ngKSI value to the UE along with each EAP message. The network shall send the ABBA value as described in subclause\u00a09.11.3.10 to the UE along with the EAP-request message and EAP-success message.\nWhen the EAP based primary authentication and key agreement procedure uses EAP-TLS:\na)\tif the UE operates in SNPN access operation mode and:\n1)\tthe default UE credentials for primary authentication, if the UE is registering or registered for onboarding services in SNPN; or\n2)\tcredentials in the selected entry of the \"list of subscriber data\", if the UE is not registering or registered for onboarding services in SNPN;\n\tcontain an indication to use MSK for derivation of KAUSF after success of primary authentication and key agreement procedure then the ME shall generate MSK as described in 3GPP\u00a0TS\u00a033.501\u00a0[24] otherwise the ME shall generate EMSK as described in 3GPP\u00a0TS\u00a033.501\u00a0[24];\nb)\tif the AUSF acts as the EAP-TLS server, the AUSF shall generate EMSK as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]; and\nc)\tif the AAA server of the CH or the DCS acts as the EAP-TLS server, the AAA server of the CH or the DCS shall generate MSK as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nWhen handling of an EAP-request message results into generation of MSK or EMSK, if the UE operates in SNPN access operation mode and:\na)\tthe default UE credentials for primary authentication, if the UE is registering or registered for onboarding services in SNPN; or\nb)\tcredentials in the selected entry of the \"list of subscriber data\", if the UE is not registering or registered for onboarding services in SNPN;\ncontain an indication to use MSK for derivation of KAUSF after success of primary authentication and key agreement procedure, then the ME may generate a new KAUSF from the MSK otherwise the ME may generate a new KAUSF from the EMSK.\nIf the ME generates a new KAUSF, the ME shall generate a new KSEAF from the new KAUSF, and the KAMF from the ABBA received together with the EAP-request message, and the new KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24], and create a partial native 5G NAS security context identified by the ngKSI value received together with the EAP-request message in subclause\u00a05.4.1.2.4.2, in the volatile memory of the ME. If the KAMF and the partial native 5G NAS security context are created, the ME shall store the KAMF in the created partial native 5G NAS security context.\nNOTE\u00a01:\tGeneration of the new KAUSF and the new KSEAF does not result into deletion of the valid KAUSF and the valid KSEAF, if any.\nThe ME shall not use the new KAUSF in the verification of SOR transparent container and UE parameters update transparent container, if any are received, until receipt of an EAP-success message.\nWhen the AUSF acts as the EAP-TLS server and handling of an EAP response message results into generation of EMSK, the AUSF shall generate the KAUSF from the EMSK, and the KSEAF from the KAUSF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nNOTE\u00a02:\tWhen the AAA server of the CH or the DCS acts as the EAP-TLS server, the AAA server of the CH or the DCS provides (via the NSSAAF) the MSK and the SUPI to the AUSF. Upon reception of the MSK, the AUSF generates the KAUSF from the MSK, and the KSEAF from the KAUSF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nNOTE\u00a03:\tThe AUSF provides the KSEAF and optionally the SUPI (unless the SEAF provided the AUSF with the SUPI before) to the SEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]. Upon reception of the KSEAF and optionally the SUPI, the SEAF generates the KAMF based on the ABBA, the KSEAF and the SUPI as described in 3GPP\u00a0TS\u00a033.501\u00a0[24], and provides ngKSI and the KAMF to the AMF. Upon reception of the ngKSI and the KAMF, the AMF creates a partial native 5G NAS security context identified by the ngKSI, and stores the KAMF in the created partial native 5G NAS security context.\nIf the UE does not accept the server certificate of the network, the UE shall start timer T3520 when the AUTHENTICATION RESPONSE message containing the EAP-response message is sent. Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). Upon receiving an AUTHENTICATION REQUEST message with the EAP message IE containing an EAP-request message from the network, the UE shall stop timer T3520, if running, and then process the EAP-request message as normally.\nIf the network does not accept the client certificate of the UE, the network handling depends upon the type of identity used by the UE in the initial NAS message, that is:\n-\tif the 5G-GUTI was used; or\n-\tif the SUCI was used.\nIf the 5G-GUTI was used, the network should transport the EAP-failure message in the AUTHENTICATION RESULT message of the EAP result message transport procedure, initiate an identification procedure to retrieve SUCI from the UE and restart the EAP based primary authentication and key agreement procedure with the received SUCI.\nIf the SUCI was used for identification in the initial NAS message or in a restarted EAP based primary authentication and key agreement procedure, or the network decides not to initiate the identification procedure to retrieve SUCI from the UE after an unsuccessful the EAP based primary authentication and key agreement procedure, the network should transport the EAP-failure message in an AUTHENTICATION REJECT message of the EAP result message transport procedure.\nDepending on local requirements or operator preference for emergency services, if the UE initiates a registration procedure with 5GS registration type IE set to \"emergency registration\" and the AMF is configured to allow emergency registration without user identity, the AMF needs not follow the procedures specified for transporting the EAP-failure message in the AUTHENTICATION REJECT message of the EAP result message transport procedure in the present subclause. The AMF may include the EAP-failure message in a response of the current 5GMM specific procedure or in the AUTHENTICATION RESULT of the EAP result message transport procedure.\nIf the EAP-failure message is received in an AUTHENTICATION REJECT message:\na)\tif the AUTHENTICATION REJECT message has been successfully integrity checked by the NAS:\n1)\tthe UE shall set the update status to 5U3 ROAMING NOT ALLOWED, delete the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI.\n\tIn case of PLMN, the USIM shall be considered invalid until switching off the UE or the UICC containing the USIM is removed.\n\tIn case of SNPN, if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN and the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN shall be considered invalid until the UE is switched off or the entry is updated;\n\tIn case of SNPN, if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN and the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid until the UE is switched off or the entry is updated.\n\tIf the UE is registered for onboarding services in SNPN or is performing initial registration for onboarding services in SNPN, the UE shall store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5];\n2)\tif the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN, the UE shall set:\ni)\tthe counter for \"SIM/USIM considered invalid for GPRS services\" events, the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events, and the counter for \"SIM/USIM considered invalid for non-GPRS services\" events if maintained by the UE, in case of PLMN; or\nii)\tthe counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events and the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events in case of SNPN;\n.\n\tto UE implementation-specific maximum value.\n\tIf the UE is registered for onboarding services in SNPN or performing initial registration for onboarding services in SNPN, the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value; and\n3)\tif the UE is operating in single-registration mode, the UE shall handle EMM parameters, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the authentication procedure is not accepted by the network. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed; and\nb)\tif the AUTHENTICATION REJECT message is received without integrity protection, the UE shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running (see subclause\u00a05.3.20). \n\tAdditionally, if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN, the UE shall:\n1)\tif the AUTHENTICATION REJECT message is received over 3GPP access, and the counter for \"SIM/USIM considered invalid for GPRS services\" events in case of PLMN or the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events in case of SNPN has a value less than a UE implementation-specific maximum value, proceed as specified in subclause\u00a05.3.20, list item 1)-a) of subclause\u00a05.3.20.2 (if the UE is not SNPN enabled or is not operating in SNPN access operation mode) or list item a) 1) of subclause\u00a05.3.20.3 (if the UE is operating in SNPN access operation mode) for the case that the 5GMM cause value received is #3;\n2)\tif the AUTHENTICATION REJECT message is received over non-3GPP access, and the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events in case of PLMN or the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events in case of SNPN has a value less than a UE implementation-specific maximum value, proceed as specified in subclause\u00a05.3.20, list item 1)-b) of subclause\u00a05.3.20.2 (if the UE is not operating in SNPN access operation mode) or list item a)-2) of subclause\u00a05.3.20.3 (if the UE is operating in SNPN access operation mode) for the case that the 5GMM cause value received is #3; or\n3)\totherwise:\ni)\tif the AUTHENTICATION REJECT message is received over 3GPP access:\nA)\tthe UE shall set the update status for 3GPP access to 5U3 ROAMING NOT ALLOWED, delete for 3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI.\n\tIn case of PLMN, the UE shall consider the USIM as invalid for 5GS services via 3GPP access and invalid for non-EPS service until switching off the UE or the UICC containing the USIM is removed.\n\tIn case of SNPN, if the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the UE shall consider the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN as invalid for 3GPP access until the UE is switched off or the entry is updated;\n\tIn case of SNPN, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid for 3GPP access until the UE is switched off or the entry is updated;\nB)\tthe UE shall set:\n-\tthe counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"SIM/USIM considered invalid for non-GPRS services\" events if maintained by the UE, in case of PLMN; or\n-\tthe counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events in case of SNPN;\n\tto UE implementation-specific maximum value; and\nC)\tIf the UE is operating in single-registration mode, the UE shall handle 4G-GUTI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the authentication procedure is not accepted by the network. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed; and\nii)\tif the AUTHENTICATION REJECT message is received over non-3GPP access:\nA)\tthe UE shall set the update status for non-3GPP access to 5U3 ROAMING NOT ALLOWED, delete for non-3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. In case of PLMN, the USIM shall be considered invalid for 5GS services via non-3GPP access until switching off the UE or the UICC containing the USIM is removed. In case of SNPN, the UE shall consider the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN shall be considered invalid for non-3GPP access until the UE is switched off or the entry is updated; and\nB)\tthe UE shall set the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events in case of PLMN or the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events in case of SNPN to UE implementation-specific maximum value.\n\tIf the UE is registered for onboarding services in SNPN or performing initial registration for onboarding services in SNPN, the UE shall:\n1)\tif the SNPN-specific attempt counter for the SNPN sending the AUTHENTICATION REJECT message has a value less than a UE implementation-specific maximum value, increment the SNPN-specific attempt counter for the SNPN; or\n2)\totherwise, the UE shall set the update status to 5U3.ROAMING NOT ALLOWED, delete the stored 5G-GUTI, TAI list, last visited registered TAI, and ngKSI, store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\nIf the AUTHENTICATION REJECT message is received by the UE, the UE shall abort any 5GMM signalling procedure, stop any of the timers T3510, T3517, T3519 or T3521 (if they were running), enter state 5GMM-DEREGISTERED and delete any stored SUCI.\nUpon receiving an EAP-success message, the ME shall:\na)\tdelete the valid KAUSF and the valid KSEAF, if any;\nb)\tif the ME has not generated a new KAUSF and a new KSEAF and has not created a partial native 5G NAS security context when handling the EAP-request message which resulted into generation of EMSK or MSK as described above:\n1)\tif the UE operates in SNPN access operation mode and:\ni)\tthe default UE credentials for primary authentication, if the UE is registering or registered for onboarding services in SNPN; or\nii)\tcredentials in the selected entry of the \"list of subscriber data\", if the UE is not registering or registered for onboarding services in SNPN;\n\tcontain an indication to use MSK for derivation of KAUSF after success of primary authentication and key agreement procedure then generate a new KAUSF from the MSK otherwise generate a new KAUSF from the EMSK;\n2)\tgenerate a new KSEAF from the new KAUSF, and the KAMF from the ABBA that was received with the EAP-success message, and the new KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24];\n3)\tcreate a partial native 5G NAS security context identified by the ngKSI value in the volatile memory of the ME; and\n4)\tstore the KAMF in the created partial native 5G NAS security context; and\nc)\tconsider the new KAUSF to be the valid KAUSF, and the new KSEAF to be the valid KSEAF, reset the SOR counter and the UE parameter update counter to zero, store the valid KAUSF, the valid KSEAF, the SOR counter and the UE parameter update counter as specified in annex\u00a0C, and use the valid KAUSF in the verification of SOR transparent container and UE parameters update transparent container, if any are received.\nThe UE shall consider the procedure complete.\nUpon receiving an EAP-failure message, the UE shall delete the partial native 5G NAS security context and shall delete the new KAUSF and the new KSEAF, if any were created when handling the EAP-request message which resulted into generation of EMSK or MSK as described above.\nThe UE shall consider the procedure complete.\n5.4.1.2.3A\tProcedures related to EAP methods other than EAP-AKA' and EAP-TLS\n5.4.1.2.3A.1\tGeneral\nThis subclause applies when an EAP method:\na)\tsupporting mutual authentication;\nb)\tsupporting EMSK or MSK generation; and\nc)\tother than EAP-AKA' and EAP-TLS;\nis used for primary authentication and key agreement in an SNPN.\nThe UE may support acting as EAP peer of such EAP method as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The AUSF may support acting as EAP server of such EAP method as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The AAA server of the CH or the DCS may support acting as EAP server of such EAP method as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8].\nWhen initiating an EAP based primary authentication and key agreement procedure using such EAP method, the network shall select an ngKSI value. If an ngKSI is contained in an initial NAS message during a 5GMM procedure, the network shall select a different ngKSI value. The network shall send the selected ngKSI value to the UE along with each EAP message. The network shall send the ABBA value as described in subclause\u00a09.11.3.10 to the UE along with the EAP-request message and EAP-success message.\nWhen the EAP based primary authentication and key agreement procedure uses such EAP method:\na)\tif:\n1)\tthe default UE credentials for primary authentication, if the UE is registering or registered for onboarding services in SNPN; or\n2)\tcredentials in the selected entry of the \"list of subscriber data\", if the UE is not registering or registered for onboarding services in SNPN;\n\tcontain an indication to use MSK for derivation of KAUSF after success of primary authentication and key agreement procedure then the ME shall generate MSK as described in 3GPP\u00a0TS\u00a033.501\u00a0[24] otherwise the ME shall generate EMSK as described in 3GPP\u00a0TS\u00a033.501\u00a0[24];\nb)\tif the AUSF acts as the EAP server, the AUSF shall generate EMSK as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]; and\nc)\tif the AAA server of the CH or the DCS acts as the EAP server, the AAA server of the CH or the DCS shall generate MSK as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nWhen handling of an EAP-request message results into generation of MSK or EMSK, if:\na)\tthe default UE credentials for primary authentication, if the UE is registering or registered for onboarding services in SNPN; or\nb)\tcredentials in the selected entry of the \"list of subscriber data\", if the UE is not registering or registered for onboarding services in SNPN;\ncontain an indication to use MSK for derivation of KAUSF after success of primary authentication and key agreement procedure then the ME may generate a new KAUSF from the MSK otherwise the ME may generate a new KAUSF from the EMSK.\nIf the ME generates a new KAUSF, the ME shall generate a new KSEAF from the new KAUSF, and the KAMF from the ABBA received together with the EAP-request message, and the new KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24], and create a partial native 5G NAS security context identified by the ngKSI value received together with the EAP-request message in subclause\u00a05.4.1.2.4.2, in the volatile memory of the ME. If the KAMF and the partial native 5G NAS security context are created, the ME shall store the KAMF in the created partial native 5G NAS security context.\nNOTE\u00a01:\tGeneration of the new KAUSF and the new KSEAF does not result into deletion of the valid KAUSF and the valid KSEAF, if any.\nThe ME shall not use the new KAUSF in the verification of SOR transparent container and UE parameters update transparent container, if any are received, until receipt of an EAP-success message.\nWhen the AUSF acts as the EAP server and handling of an EAP response message results into generation of EMSK, the AUSF shall generate the KAUSF from the EMSK, and the KSEAF from the KAUSF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nNOTE\u00a02:\tWhen the AAA server of the CH or the DCS acts as the EAP server and handling of an EAP response message results into generation of MSK, the AAA server of the CH or the DCS provides (via the NSSAAF) the MSK and the SUPI to the AUSF. Upon reception of the MSK, the AUSF generates the KAUSF from the MSK, and the KSEAF from the KAUSF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nNOTE\u00a03:\tThe AUSF provides the KSEAF and optionally the SUPI (unless the SEAF provided the AUSF with the SUPI before) to the SEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]. Upon reception of the KSEAF and optionally the SUPI, the SEAF generates the KAMF based on the ABBA, the KSEAF and the SUPI as described in 3GPP\u00a0TS\u00a033.501\u00a0[24], and provides ngKSI and the KAMF to the AMF. Upon reception of the ngKSI and the KAMF, the AMF creates a partial native 5G NAS security context identified by the ngKSI, and stores the KAMF in the created partial native 5G NAS security context.\nIf the UE fails to authenticate the network, the UE shall start timer T3520 when the AUTHENTICATION RESPONSE message containing the EAP-response message is sent. Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). Upon receiving an AUTHENTICATION REQUEST message with the EAP message IE containing an EAP-request message from the network, the UE shall stop timer T3520, if running, and then process the EAP-request message as normally.\nIf the network fails to authenticate the UE, the network handling depends upon the type of identity used by the UE in the initial NAS message, that is:\n-\tif the 5G-GUTI was used; or\n-\tif the SUCI was used.\nIf the 5G-GUTI was used, the network should transport the EAP-failure message in the AUTHENTICATION RESULT message of the EAP result message transport procedure, initiate an identification procedure to retrieve SUCI from the UE and restart the EAP based primary authentication and key agreement procedure with the received SUCI.\nIf the SUCI was used for identification in the initial NAS message or in a restarted EAP based primary authentication and key agreement procedure, or the network decides not to initiate the identification procedure to retrieve SUCI from the UE after an unsuccessful the EAP based primary authentication and key agreement procedure, the network should transport the EAP-failure message in an AUTHENTICATION REJECT message of the EAP result message transport procedure.\nIf the EAP-failure message is received in an AUTHENTICATION REJECT message:\na)\tif the AUTHENTICATION REJECT message has been successfully integrity checked by the NAS:\n1)\tthe UE shall set the update status to 5U3 ROAMING NOT ALLOWED, delete the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI.\n\tIn case of SNPN, if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN and the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN shall be considered invalid until the UE is switched off or the entry is updated;\n\tIn case of SNPN, if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN and the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid until the UE is switched off or the entry is updated.\n\tIn case of SNPN, if the UE is registered for onboarding services in SNPN or is performing initial registration for onboarding services in SNPN, the UE shall store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5]; and\n2)\tif the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN, the UE shall set the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events and the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events in case of SNPN to UE implementation-specific maximum value.\n\n\tIf the UE is registered for onboarding services in SNPN or performing initial registration for onboarding services in SNPN, the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value; and\nb)\tif the AUTHENTICATION REJECT message is received without integrity protection, the UE shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running (see subclause\u00a05.3.20). \n\tAdditionally, if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN, the UE shall:\n1)\tif the AUTHENTICATION REJECT message is received over 3GPP access, and the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events has a value less than a UE implementation-specific maximum value, proceed as specified in list item a) 1) of subclause\u00a05.3.20.3 for the case that the 5GMM cause value received is #3;\n2)\tif the AUTHENTICATION REJECT message is received over non-3GPP access, and the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events has a value less than a UE implementation-specific maximum value, proceed as specified in list item a)-2) of subclause\u00a05.3.20.3 for the case that the 5GMM cause value received is #3; or\n3)\totherwise:\ni)\tif the AUTHENTICATION REJECT message is received over 3GPP access:\n-\tthe UE shall set the update status for 3GPP access to 5U3 ROAMING NOT ALLOWED, delete for 3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI;\n\tIn case of SNPN, if the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN shall be considered invalid for 3GPP access until the UE is switched off or the entry is updated;\n\tIn case of SNPN, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid until the UE is switched off or the entry is updated; and\n-\tthe UE shall set the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events to UE implementation-specific maximum value; and\nii)\tif the AUTHENTICATION REJECT message is received over non-3GPP access:\n-\tthe UE shall set the update status for non-3GPP access to 5U3 ROAMING NOT ALLOWED, delete for non-3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. The selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN shall be considered invalid for non-3GPP access until the UE is switched off or the entry is updated; and\n-\tthe UE shall set the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events to UE implementation-specific maximum value.\n\tIf the UE is registered for onboarding services in SNPN or performing initial registration for onboarding services in SNPN, the UE shall:\n1)\tif the SNPN-specific attempt counter for the SNPN sending the AUTHENTICATION REJECT message has a value less than a UE implementation-specific maximum value, increment the SNPN-specific attempt counter for the SNPN; or\n2)\totherwise, the UE shall set the update status to 5U3.ROAMING NOT ALLOWED, delete the stored 5G-GUTI, TAI list, last visited registered TAI, and ngKSI, store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\nIf the AUTHENTICATION REJECT message is received by the UE, the UE shall abort any 5GMM signalling procedure, stop any of the timers T3510, T3517, T3519 or T3521 (if they were running), enter state 5GMM-DEREGISTERED and delete any stored SUCI.\nUpon receiving an EAP-success message, the ME shall:\na)\tdelete the valid KAUSF and the valid KSEAF, if any;\nb)\tif the ME has not generated a new KAUSF and a new KSEAF and has not created a partial native 5G NAS security context when handling the EAP-request message which resulted into generation of EMSK as described above:\n1)\tif:\ni)\tthe default UE credentials for primary authentication, if the UE is registering or registered for onboarding services in SNPN; or\nii)\tcredentials in the selected entry of the \"list of subscriber data\", if the UE is not registering or registered for onboarding services in SNPN;\n\tcontain an indication to use MSK for derivation of KAUSF after success of primary authentication and key agreement procedure then generate a new KAUSF from the MSK otherwise generate a new KAUSF from the EMSK;\n2)\tgenerate a new KSEAF from the new KAUSF, and the KAMF from the ABBA that was received with the EAP-success message, and the KSEAF as described in 3GPP\u00a0TS\u00a033.501\u00a0[24];\n3)\tcreate a partial native 5G NAS security context identified by the ngKSI value in the volatile memory of the ME; and\n4)\tstore the KAMF in the created partial native 5G NAS security context; and\nc)\tconsider the new KAUSF to be the valid KAUSF, and the new KSEAF to be the valid KSEAF, reset the SOR counter and the UE parameter update counter to zero, store the valid KAUSF, the valid KSEAF, the SOR counter and the UE parameter update counter as specified in annex\u00a0C, and use the valid KAUSF in the verification of SOR transparent container and UE parameters update transparent container, if any are received.\nThe UE shall consider the procedure complete.\nUpon receiving an EAP-failure message, the UE shall delete the partial native 5G NAS security context and shall delete the new KAUSF and the new KSEAF, if any were created when handling the EAP-request message which resulted into generation of EMSK or MSK as described above.\nThe UE shall consider the procedure complete.\n5.4.1.2.3A.2\tEAP-TTLS with two phases of authentication\nThe UE may support acting as EAP peer of EAP-TTLS with two phases of authentication as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] and acting as peer of a legacy authentication protocol as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The AUSF may support acting as EAP server of EAP-TTLS with two phases of authentication as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The AAA server of the CH or the DCS may support acting a server of a legacy authentication protocol as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nWhen EAP-TTLS with two phases of authentication as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] is used for primary authentication and key agreement in an SNPN:\na)\trequirements in subclause\u00a05.4.1.2.3A.1 shall apply in addition to requirements specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] annex\u00a0U;\nb)\tindication to use MSK for derivation of KAUSF after success of primary authentication and key agreement procedure is not included in:\n1)\tthe default UE credentials for primary authentication, if the UE is registering or registered for onboarding services in SNPN; or\n2)\tcredentials in the selected entry of the \"list of subscriber data\", if the UE is not registering or registered for onboarding services in SNPN; and\nc)\tthe SUPI of the UE is in the form of a SUPI with the SUPI format \"network specific identifier\" containing a network-specific identifier.\nNOTE:\tSupport of EAP-TTLS with two phases of authentication is based on the informative requirements as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\n5.4.1.2.3B\tProcedures related to EAP methods used for primary authentication of an N5GC device\n5.4.1.2.3B.1\tGeneral\nThis subclause applies when an EAP method:\na)\tsupporting mutual authentication; and\nb)\tother than EAP-AKA',\nis used for primary authentication of an N5GC device, when an W-AGF supports acting on behalf of the N5GC device, the AMF supports serving the W-AGF acting on behalf of the N5GC device and the AUSF supports authentication of the N5GC device. EAP-TLS is an example of such EAP method.\nNOTE\u00a01:\tNeither the N5GC device nor the AUSF derive any 5G related keys during or after the primary authentication.\nThe AUSF supporting authentication of the N5GC device shall support acting as EAP server of at least one such EAP method as specified in annex\u00a0O of 3GPP\u00a0TS\u00a033.501\u00a0[24].\nNOTE\u00a02:\tThe N5GC device supports acting as EAP peer of at least one such EAP method as specified in annex\u00a0O of 3GPP\u00a0TS\u00a033.501\u00a0[24], which is also supported by the AUSF.\nThe W-AGF acting on behalf of the N5GC device provides to the N5GC device an EAP-request message, an EAP-success message or an EAP-failure message received from the network according to subclause\u00a05.4.1.2.1 and sends to the network according to subclause\u00a05.4.1.2.1 an EAP-response provided by the N5GC device. The N5GC device can inform the W-AGF acting on behalf of the N5GC device that the N5GC device fails to authenticate the network. Details of communication between the N5GC device and the W-AGF acting on behalf of the N5GC device are out of scope of this specification.\nWhen initiating an EAP based primary authentication and key agreement procedure using such EAP method, the network shall select an ngKSI value. The network shall send the selected ngKSI value to the W-AGF acting on behalf of the N5GC device along with each EAP message. The network shall send the ABBA value as described in subclause\u00a09.11.3.10 to the W-AGF acting on behalf of the N5GC device along with the EAP-request message and EAP-success message. The W-AGF acting on behalf of the N5GC device shall not forward the ngKSI value or the ABBA value to the N5GC device.\nNOTE\u00a03:\tThe network provides the ngKSI value and the ABBA value since the ngKSI IE and the ABBA IE are mandatory IEs in AUTHENTICATION REQUEST message. The W-AGF acting on behalf of the N5GC device does not use the ngKSI value or the ABBA value provided by the network.\nIf the N5GC device fails to authenticate the network, the W-AGF acting on behalf of the N5GC device shall start timer T3520 when the AUTHENTICATION RESPONSE message containing the EAP-response message is sent. Furthermore, the W-AGF acting on behalf of the N5GC device shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). Upon receiving an AUTHENTICATION REQUEST message with the EAP message IE containing an EAP-request message from the network, the W-AGF acting on behalf of the N5GC device shall stop timer T3520, if running, and then provides the EAP-request message to the N5GC device as normally.\nIf the network fails to authenticate the N5GC device, the network handling depends upon the type of identity used by the W-AGF acting on behalf of the N5GC device in the initial NAS message, that is:\na)\tif the 5G-GUTI was used; or\nb)\tif the SUCI was used.\nIf the 5G-GUTI was used, the network should transport the EAP-failure message in the AUTHENTICATION RESULT message of the EAP result message transport procedure, initiate an identification procedure to retrieve SUCI from the W-AGF acting on behalf of the N5GC device and restart the EAP based primary authentication and key agreement procedure with the received SUCI.\nIf the SUCI was used for identification in the initial NAS message or in a restarted EAP based primary authentication and key agreement procedure, or the network decides not to initiate the identification procedure to retrieve SUCI from the W-AGF acting on behalf of the N5GC device after an unsuccessful EAP based primary authentication and key agreement procedure, the network should transport the EAP-failure message in an AUTHENTICATION REJECT message of the EAP result message transport procedure.\nIf the EAP-failure message is received in an AUTHENTICATION REJECT message, the W-AGF acting on behalf of the N5GC device shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running (see subclause\u00a05.3.20). Additionally, the W-AGF acting on behalf of the N5GC device shall:\na)\tif the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events has a value less than a W-AGF implementation-specific maximum value, proceed as specified in list item 1)-b) of subclause\u00a05.3.20.2 for the case that the 5GMM cause value received is #3; or\nb)\totherwise, set the update status to 5U3 ROAMING NOT ALLOWED, delete the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. The USIM shall be considered invalid for 5GS services via non-3GPP access until switching off or the UICC containing the USIM is removed.\nIf the AUTHENTICATION REJECT message is received by the W-AGF acting on behalf of the N5GC device, the W-AGF acting on behalf of the N5GC device shall abort any 5GMM signalling procedure, stop any of the timers T3510, T3517, T3519 or T3521 (if they were running), enter state 5GMM-DEREGISTERED and delete any stored SUCI.\nUpon receiving an EAP-success message, the W-AGF acting on behalf of the N5GC device shall consider the procedure complete.\nUpon receiving an EAP-failure message, the W-AGF acting on behalf of the N5GC device shall consider the procedure complete.\n5.4.1.2.3C\tProcedures related to EAP methods used for primary authentication of an AUN3 device\n5.4.1.2.3C.1\tGeneral\nThis subclause applies when an EAP method is used for primary authentication of an AUN3 device, when a 5G-RG supports acting on behalf of the AUN3 device, the AMF supports serving the 5G-RG acting on behalf of the AUN3 device and the AUSF supports authentication of the AUN3 device. EAP-AKA' and EAP-TLS are examples of such EAP method.\nThe AUSF supporting authentication of the AUN3 device shall support acting as EAP server of at least one such EAP method as specified in annex\u00a0Z of 3GPP\u00a0TS\u00a033.501\u00a0[24].\nThe 5G-RG acting on behalf of the AUN3 device provides to the AUN3 device an EAP-request message, an EAP-success message or an EAP-failure message received from the network according to subclause\u00a05.4.1.2.1 and sends to the network according to subclause\u00a05.4.1.2.1 an EAP-response provided by the AUN3 device. Details of communication between the AUN3 device and the 5G-RG acting on behalf of the AUN3 device are out of scope of this specification.\nWhen initiating an EAP based primary authentication and key agreement procedure using such EAP method, the network shall select an ngKSI value. The network shall send the selected ngKSI value to the 5G-RG acting on behalf of the AUN3 device along with each EAP message. The network shall send the ABBA value as described in subclause\u00a09.11.3.10 to the 5G-RG acting on behalf of the AUN3 device along with the EAP-request message and EAP-success message. The 5G-RG acting on behalf of the AUN3 device shall not forward the ngKSI value or the ABBA value to the AUN3 device.\nNOTE\u00a01:\tThe network provides the ngKSI value and the ABBA value since the ngKSI IE and the ABBA IE are mandatory IEs in AUTHENTICATION REQUEST message. The 5G-RG acting on behalf of the AUN3 device does not use the ngKSI value or the ABBA value provided by the network.\nIf the 5G-RG acting on behalf of the AUN3 device is informed by AUN3 about failure to authenticate the network, the 5G-RG acting on behalf of the AUN3 device shall start timer T3520 when the AUTHENTICATION RESPONSE message containing the EAP-response message is sent. Furthermore, the 5G-RG acting on behalf of the AUN3 device shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). Upon receiving an AUTHENTICATION REQUEST message with the EAP message IE containing an EAP-request message from the network, the 5G-RG acting on behalf of the AUN3 device shall stop timer T3520, if running, and then provides the EAP-request message to the AUN3 device as normally.\nIf the network fails to authenticate the AUN3 device, the network handling depends upon the type of identity used by the 5G-RG acting on behalf of the AUN3 device in the initial NAS message, that is:\na)\tif the 5G-GUTI was used; or\nb)\tif the SUCI was used.\nIf the 5G-GUTI was used, the network should transport the EAP-failure message in the AUTHENTICATION RESULT message as specified in the EAP result message transport procedure, initiate an identification procedure to retrieve SUCI from the 5G-RG acting on behalf of the AUN3 device and restart the EAP based primary authentication and key agreement procedure with the received SUCI.\nIf the SUCI was used for identification in the initial NAS message or in a restarted EAP based primary authentication and key agreement procedure, or the network decides not to initiate the identification procedure to retrieve SUCI from the 5G-RG acting on behalf of the AUN3 device after an unsuccessful EAP based primary authentication and key agreement procedure, the network should transport the EAP-failure message in an AUTHENTICATION REJECT message as specified in the EAP result message transport procedure.\nIf the EAP-failure message is received in an AUTHENTICATION REJECT message, the 5G-RG acting on behalf of the AUN3 device shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running (see subclause\u00a05.3.20). Additionally, the 5G-RG acting on behalf of the AUN3 device shall:\na)\tif the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events has a value less than a 5G-RG implementation-specific maximum value, proceed as specified in list item 1)-b) of subclause\u00a05.3.20.2 for the case that the 5GMM cause value received is #3; or\nb)\totherwise, set the update status to 5U3 ROAMING NOT ALLOWED, delete the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. The USIM shall be considered invalid for 5GS services via non-3GPP access until switching off or the UICC containing the USIM is removed.\nIf the AUTHENTICATION REJECT message is received by the 5G-RG acting on behalf of the AUN3 device, the 5G-RG acting on behalf of the AUN3 device shall abort any 5GMM signalling procedure, stop any of the timers T3510, T3517, T3519 or T3521 (if they were running), enter state 5GMM-DEREGISTERED and delete any stored SUCI.\nUpon receiving an EAP-success message from the network, the 5G-RG acting on behalf of the AUN3 device shall consider the procedure complete. The network shall provide:\na)\tthe Master session key, if the AUN3 device does not support 5G key hierarchy; or\nb)\tthe KWAGF key, if the AUN3 device supports 5G key hierarchy;\nto the 5G-RG along with the EAP-success message as specified in subclauses\u00a05.4.1.2.5.2 and\u00a05.4.2.2. The 5G-RG acting on behalf of the AUN3 device shall derive the Pairwise master key from the Master session key or the KWAGF key as specified in subclause\u00a07B.7 of 3GPP\u00a0TS\u00a033.501\u00a0[24]. The 5G-RG acting on behalf of the AUN3 device provides the EAP-success message to the AUN3 device.\nNOTE\u00a02:\tThe network is aware from the AUN3 device subscription data in UDM whether the AUN3 device supports 5G key hierarchy or not as specified in subclause\u00a07B.7 of 3GPP\u00a0TS\u00a033.501\u00a0[24].\nUpon receiving an EAP-failure message from the network, the 5G-RG acting on behalf of the AUN3 device shall consider the procedure complete.\n5.4.1.2.4\tEAP message reliable transport procedure\n5.4.1.2.4.1\tGeneral\nThe purpose of the EAP message reliable transport procedure is to provide a reliable transport of an EAP-request message, the ngKSI and the ABBA from the network to the UE and of an EAP-response message from the UE to the network.\nThe EAP message reliable transport procedure is initiated by an AUTHENTICATION REQUEST message with the EAP message IE.\n5.4.1.2.4.2\tEAP message reliable transport procedure initiation by the network\nIn order to initiate the EAP message reliable transport procedure, the AMF shall create an AUTHENTICATION REQUEST message.\nThe AMF shall set the EAP message IE of the AUTHENTICATION REQUEST message to the EAP-request message to be sent to the UE. The AMF shall set the ngKSI IE of the AUTHENTICATION REQUEST message to the ngKSI value selected in subclause\u00a05.4.1.2.2.2, subclause\u00a05.4.1.2.3.1 or subclause\u00a05.4.1.2.3A.1. In this release of specification, the AMF shall set the ABBA IE of the AUTHENTICATION REQUEST message with the length of ABBA IE to 2 and the ABBA contents to be 2 octets in length with value 0000H as described in subclause\u00a09.11.3.10.\nThe AMF shall send the AUTHENTICATION REQUEST message to the UE, and the AMF shall start timer T3560 (see example in figure\u00a05.4.1.2.4.2.1).\n\nFigure\u00a05.4.1.2.4.2.1: EAP message reliable transport procedure\nUpon receipt of an AUTHENTICATION REQUEST message with the EAP message IE, the UE handles the EAP message received in the EAP message IE and the ABBA of the AUTHENTICATION REQUEST message.\n5.4.1.2.4.3\tEAP message reliable transport procedure accepted by the UE\nThe UE shall create an AUTHENTICATION RESPONSE message.\nIf the received EAP message is an EAP-request message, the UE shall set the EAP message IE of the AUTHENTICATION RESPONSE message to the EAP-response message responding to the received EAP-request message.\nThe UE shall send the AUTHENTICATION RESPONSE message to the AMF.\nUpon receipt of an AUTHENTICATION RESPONSE message, the AMF shall stop timer T3560. If the EAP message IE is included in the AUTHENTICATION RESPONSE message, the AMF handles the EAP message received in the EAP message IE of the AUTHENTICATION RESPONSE message.\n5.4.1.2.4.4\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3560.\n\tThe AMF shall, on the first expiry of the timer T3560, retransmit the AUTHENTICATION REQUEST message and shall reset and start timer T3560. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3560, the AMF shall abort the EAP based primary authentication and key agreement procedure and any ongoing 5GMM specific procedure, and release the N1 NAS signalling connection.\nb)\tLower layers indication of non-delivered NAS PDU due to handover.\n\tIf the AUTHENTICATION REQUEST message could not be delivered due to an intra AMF handover and the target TA is included in the TAI list, then upon successful completion of the intra AMF handover the AMF shall retransmit the AUTHENTICATION REQUEST message. If a failure of handover procedure is reported by the lower layer and the N1 NAS signalling connection exists, the AMF shall retransmit the AUTHENTICATION REQUEST message.\n5.4.1.2.4.5\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tAuthentication failure (5GMM cause #71 \"ngKSI already in use\").\n\tThe UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #71 \"ngKSI already in use\", to the network and start the timer T3520 (see example in figure 5.4.1.3.7.1). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with 5GMM cause #71 \"ngKSI already in use\", the network performs necessary actions to select a new ngKSI and send the same EAP-request message to the UE.\nNOTE 1:\tUpon receipt of an AUTHENTICATION FAILURE message from the UE with 5GMM cause #71 \"ngKSI already in use\", the network can also re-initiate the EAP based primary authentication and key agreement procedure (see subclause\u00a05.4.1.2.2.2).\n\tUpon receiving a new AUTHENTICATION REQUEST message with the EAP message IE containing an EAP-request message from the network, the UE shall stop timer T3520, if running, process the EAP-request message as normal.\n\tIf the network is validated successfully (an AUTHENTICATION REQUEST message that contains a valid ngKSI and EAP-request message is received), the UE shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3510, T3517 or T3521) if they were running and stopped when the UE received the first failed AUTHENTICATION REQUEST message.\nb)\tTransmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication from lower layers (if the EAP based primary authentication and key agreement procedure is triggered by a registration procedure).\n\tThe UE shall stop the timer T3520, if running, and re-initiate the registration procedure.\nc)\tTransmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication with change in the current TAI (if the EAP based primary authentication and key agreement procedure is triggered by a service request procedure).\n\tThe UE shall stop the timer T3520, if running.\n\tIf the current TAI is not in the TAI list, the EAP based primary authentication and key agreement procedure shall be aborted and a registration procedure for mobility and periodic registration update shall be initiated.\n\tIf the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure that triggered the EAP based primary authentication and key agreement procedure.\nd)\tTransmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication without change in the current TAI (if the authentication procedure is triggered by a service request procedure).\n\tThe UE shall stop the timer T3520, if running. It is up to the UE implementation how to re-run the ongoing procedure that triggered the EAP based primary authentication and key agreement procedure.\ne)\tNetwork failing the authentication check.\n\tIf the UE deems that the network has failed the authentication check, then it shall request RRC to locally release the RRC connection and treat the active cell as barred (see 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C]). The UE shall start any retransmission timers (e.g. T3510, T3517 or T3521), if they were running and stopped when the UE received the first AUTHENTICATION REQUEST message containing an ngKSI that was already in use.\nf)\tChange in the current TAI.\n\tIf that the current TAI is not in the TAI list before the AUTHENTICATION RESPONSE message is sent, the UE may discard sending the AUTHENTICATION RESPONSE message to the network and continue with the initiation of the registration procedure for mobility and periodic registration update as described in subclause\u00a05.5.1.3.2.\nFor item\u00a0e, if no emergency service is started or is ongoing:\n\tThe UE shall stop timer T3520, if the timer is running and the UE enters 5GMM-IDLE mode, e.g. upon detection of a lower layer failure, release of the N1 NAS signalling connection, or as the result of an inter-system change in 5GMM-CONNECTED mode from N1 mode to S1 mode.\n\tThe UE shall deem that the network has failed the authentication check or assume that the authentication is not genuine and proceed as described in item\u00a0e above if any of the following occurs:\n-\tthe timer T3520 expires;\n-\tthe UE detects any combination of the EAP-based authentication failures: transmission of AUTHENTICATION FAILURE message with 5GMM cause #71 \"ngKSI already in use\", transmission of AUTHENTICATION RESPONSE message with an EAP-response message after detecting an error as described in subclause\u00a05.4.1.2.2.4, with an EAP-response message after not accepting of the server certificate as described in subclause\u00a05.4.1.2.3.1 or with an EAP-response message after failing to authenticate the network as described in subclause\u00a05.4.1.2.3A.1, during three consecutive authentication challenges. The EAP-request/AKA'-challenge challenges shall be considered as consecutive only, if the EAP-request/AKA'-challenge challenges causing the second and third EAP-based authentication failure are received by the UE, while the timer T3520 started after the previous EAP-based authentication failure is running. Not accepting of the server certificate shall be considered as consecutive only, if the EAP-request messages causing the second and third not accepting of the server certificate are received by the UE, while the timer T3520 started after the previous EAP request message causing the previous not accepting of the server certificate is running.\nNOTE 2:\tReception of an EAP-failure message is not considered when determining the three consecutive authentication challenges or three consecutive not accepting of the server certificate.\nFor item e if there is an emergency service started or is ongoin:\n\tThe UE shall stop timer T3520, if the timer is running and the UE enters 5GMM-IDLE mode, e.g. upon detection of a lower layer failure, release of the N1 NAS signalling connection, or as the result of an inter-system change in 5GMM-CONNECTED mode from N1 mode to S1 mode.\n\tIf a UE has an emergency PDU session established or is establishing an emergency PDU session, and sends an AUTHENTICATION FAILURE message to the AMF with the 5GMM cause appropriate for this cases (i.e. #71) or an AUTHENTICATION RESPONSE message containing an EAP-response message as described in subclause\u00a05.4.1.2.2.4, containing an EAP-response message after not accepting of the server certificate as described in subclause\u00a05.4.1.2.3.1 or containing an EAP-response message after failing to authenticate the network as described in subclause\u00a05.4.1.2.3A.1, and receives the SECURITY MODE COMMAND message before the timeout of timer T3520, the UE shall deem that the network has passed the authentication check successfully, stop timer T3520, respectively, and execute the security mode control procedure.\n\tIf a UE has an emergency PDU session established or is establishing an emergency PDU session when timer T3520 expires, the UE shall not deem that the network has failed the authentication check and not behave as described in item e. Instead the UE shall continue using the current security context, if any, release all non-emergency PDU sessions, if any, by initiating UE-requested PDU session release procedure. If there is an ongoing PDU session establishment procedure, the UE shall release all non-emergency PDU sessions upon completion of the PDU session establishment procedure.\n\tThe UE shall start any retransmission timers (e.g. T3510, T3517 or T3521) if:\n-\tthey were running and stopped when the UE received the AUTHENTICATION REQUEST message and detected an authentication failure; and\n-\tthe procedures associated with these timers have not yet been completed.\n\tThe UE shall consider itself to be registered for emergency services.\n5.4.1.2.5\tEAP result message transport procedure\n5.4.1.2.5.1\tGeneral\nThe purpose of the EAP result message transport procedure is to provide an EAP-success message or an EAP-failure message, and ngKSI from the network to the UE, when the EAP message cannot be piggybacked by another NAS message.\nThe EAP result message transport procedure is initiated:\n-\tby an AUTHENTICATION RESULT message with the EAP message IE carrying the EAP-success message or the EAP-failure message; or\n-\tby an AUTHENTICATION REJECT message with the EAP message IE carrying the EAP-failure message.\n5.4.1.2.5.2\tEAP result message transport procedure initiation by the network\nIn order to initiate the EAP result message transport procedure, the AMF shall create an AUTHENTICATION RESULT message or an AUTHENTICATION REJECT message.\nThe AMF shall set the EAP message IE of the AUTHENTICATION RESULT message to an EAP-success message or an EAP-failure message to be sent to the UE. If the AUTHENTICATION RESULT message is provided to a 5G-RG that is acting on behalf of an AUN3 device and the EAP message IE is set to an EAP-success message, the AMF shall include the AUN3 device security key IE in the AUTHENTICATION RESULT message with its value set to:\na)\tthe Master session key, if the AUN3 device does not support 5G key hierarchy; or\nb)\tthe KWAGF key, if the AUN3 device supports 5G key hierarchy.\nNOTE:\tThe network is aware from the AUN3 device subscription data in UDM whether the AUN3 device supports 5G key hierarchy or not as specified in subclause\u00a07B.7 of 3GPP\u00a0TS\u00a033.501\u00a0[24].\nThe AMF shall set the EAP message IE of the AUTHENTICATION REJECT message to an EAP-failure message to be sent to the UE. The AMF shall set the ngKSI IE of the AUTHENTICATION RESULT message or the AUTHENTICATION REJECT message to the ngKSI value selected in subclause\u00a05.4.1.2.2.2, subclause\u00a05.4.1.2.3.1 or subclause\u00a05.4.1.2.3A.1.\nThe AMF shall send the AUTHENTICATION RESULT message or the AUTHENTICATION REJECT message to the UE (see example in figure\u00a05.4.1.2.5.2.1).\n\nFigure\u00a05.4.1.2.5.2.1: EAP result message transport procedure\nUpon receipt of an AUTHENTICATION RESULT message or an AUTHENTICATION REJECT message with the EAP message IE, the UE handles the EAP message received in the EAP message IE and the ABBA if received of the AUTHENTICATION RESULT message or in the AUTHENTICATION REJECT message, and the 5G-RG that is acting on behalf of an AUN3 device handles the AUN3 device security key IE if received in the AUTHENTICATION RESULT message.\n5.4.1.3\t5G AKA based primary authentication and key agreement procedure\n5.4.1.3.1\tGeneral\nThe purpose of the 5G AKA based primary authentication and key agreement procedure is to provide mutual authentication between the UE and the network and to agree on the keys KAUSF, KSEAF and KAMF (see 3GPP\u00a0TS\u00a033.501\u00a0[24]). The cases when the 5G AKA based primary authentication and key agreement procedure is used are defined in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nThe network initiates the 5G AKA based primary authentication and key agreement procedure by sending an AUTHENTICATION REQUEST message to the UE without the EAP message IE. The network shall include the ngKSI and the ABBA in AUTHENTICATION REQUEST message.\nThe 5G AKA based primary authentication and key agreement procedure is always initiated and controlled by the network. However, the UE can reject the 5G authentication challenge sent by the network.\nThe UE shall proceed with a 5G authentication challenge only if a USIM is present.\nA partial native 5G NAS security context is established in the UE and the network when a 5G authentication is successfully performed. During a successful 5G AKA based primary authentication and key agreement procedure, the CK and IK are computed by the USIM. CK and IK are then used by the ME as key material to compute new keys KAUSF, KSEAF and KAMF. KAMF is stored in the 5G NAS security contexts (see 3GPP\u00a0TS\u00a033.501\u00a0[24]) of both the network and in the volatile memory of the ME while registered to the network, and is the root for the 5GS integrity protection and ciphering key hierarchy.\nNOTE\u00a01:\tGeneration of the new KAUSF and the new KSEAF does not result into deletion of the valid KAUSF and the valid KSEAF, if any.\nUpon successful completion of the 5G AKA based primary authentication, the AMF shall initiate a security mode control procedure (see subclause\u00a05.4.2) to take the new partial native 5G NAS security context into use. \nNOTE\u00a02:\tThe AMF immediately initiates a security mode control procedure (see subclause\u00a05.4.2) after 5G AKA primary authentication is successful to avoid KAUSF key mismatch between the UE and the network.\n5.4.1.3.2\tAuthentication initiation by the network\nThe network may initiate a 5G AKA based primary authentication and key agreement procedure for a UE in 5GMM-CONNECTED mode at any time. For restrictions applicable after handover or inter-system change to N1 mode in 5GMM-CONNECTED mode, see subclause\u00a05.5.1.3.3.\nThe network initiates the 5G AKA based primary authentication and key agreement procedure by sending an AUTHENTICATION REQUEST message to the UE and starting the timer T3560 (see example in figure\u00a05.4.1.3.2.1). The AUTHENTICATION REQUEST message shall contain the parameters necessary to calculate the authentication response (see 3GPP\u00a0TS\u00a033.501\u00a0[24]). This message shall include the ngKSI that will be used by the UE and AMF to identify the KAMF and the partial native security context that is created if the authentication is successful. This message shall also include the ABBA parameter. In this release of specification, the network shall set the length of ABBA IE to 2 and the ABBA contents to be 2 octets in length with value 0000H as described in subclause\u00a09.11.3.10.\nIf an ngKSI is contained in an initial NAS message during a 5GMM procedure, the network shall include a different ngKSI value in the AUTHENTICATION REQUEST message when it initiates a 5G AKA based primary authentication and key agreement procedure.\n\nFigure\u00a05.4.1.3.2.1: 5G AKA based primary authentication and key agreement procedure\n5.4.1.3.3\tAuthentication response by the UE\nThe UE shall respond to an AUTHENTICATION REQUEST message. With the exception of the cases described in subclause\u00a05.4.1.3.6 and 5.4.1.3.7 case l, the UE shall process the 5G authentication challenge data and respond with an AUTHENTICATION RESPONSE message to the network.\nUpon a successful 5G authentication challenge, the UE shall determine the PLMN identity in case of PLMN or the SNPN identity in case of SNPN to be used for the calculation of the new KAMF from the 5G authentication challenge data according to the following rules:\na)\tWhen the UE moves from 5GMM-IDLE mode to 5GMM-CONNECTED mode, until the first handover, the UE shall use the PLMN identity of the selected PLMN or the SNPN identity of the selected SNPN; and\nb)\tAfter handover or inter-system change to N1 mode in 5GMM-CONNECTED mode,\n1)\tif the target cell is not a shared network cell, the UE shall use the PLMN identity in case of PLMN or the SNPN identity in case of SNPN received as part of the broadcast system information;\n2)\tif the target cell is a shared network cell and the UE has a valid 5G-GUTI, the UE shall use the PLMN identity in case of PLMN or the SNPN identity in case of SNPN that is part of the 5G-GUTI; and\n3)\tif the target cell is a shared network cell and the UE has a valid 4G-GUTI, but not a valid 5G-GUTI, the UE shall use the PLMN identity that is part of the 4G-GUTI.\nUpon a successful 5G authentication challenge, the new KAMF calculated from the 5G authentication challenge data shall be stored in a new 5G NAS security context in the volatile memory of the ME.\nThe USIM will compute the authentication response (RES) using the 5G authentication challenge data received from the ME, and pass RES to the ME. From the RES, RES* is then generated according to Annex A of 3GPP\u00a0TS\u00a033.501\u00a0[24].\nIn order to avoid a synchronisation failure, when the UE receives an AUTHENTICATION REQUEST message, the UE shall store the received RAND together with the RES*, in the volatile memory of the ME. When the UE receives a subsequent AUTHENTICATION REQUEST message, if the stored RAND value is equal to the new received value in the AUTHENTICATION REQUEST message, then the ME shall not pass the RAND to the USIM, but shall send the AUTHENTICATION RESPONSE message with the stored RES*. If there is no valid stored RAND in the ME or the stored RAND is different from the new received value in the AUTHENTICATION REQUEST message, the ME shall pass the RAND to the USIM, shall override any previously stored RAND and RES* with the new ones and start, or reset and restart timer T3516.\nThe RAND and RES* values stored in the ME shall be deleted and timer T3516, if running, shall be stopped:\na)\tupon receipt of a\n1)\tSECURITY MODE COMMAND message,\n2)\tSERVICE REJECT message,\n3)\tREGISTRATION REJECT message,\n4)\tREGISTRATION ACCEPT message,\n5)\tAUTHENTICATION REJECT message, or\n6)\tSERVICE ACCEPT message;\nb)\tupon expiry of timer T3516;\nc)\tif the UE enters the 5GMM state 5GMM-DEREGISTERED or 5GMM-NULL; or\nd)\tif the UE enters 5GMM-IDLE mode.\n5.4.1.3.4\tAuthentication completion by the network\nUpon receipt of an AUTHENTICATION RESPONSE message, the network stops the timer T3560 and checks the correctness of RES* (see 3GPP\u00a0TS\u00a033.501\u00a0[24]).\nIf the 5G AKA based primary authentication and key agreement procedure has been completed successfully and the related ngKSI is stored in the 5G NAS security context of the network, the network shall include a different ngKSI value in the AUTHENTICATION REQUEST message when it initiates a new 5G AKA based primary authentication and key agreement procedure.\nUpon receipt of an AUTHENTICATION FAILURE message, the network stops the timer T3560. In the case where the 5GMM cause #21 \"synch failure\" is received, the core network may renegotiate with the UDM/AUSF and provide the UE with new authentication parameters.\n5.4.1.3.5\tAuthentication not accepted by the network\nIf the authentication response (RES) returned by the UE is not valid, the network response depends upon the type of identity used by the UE in the initial NAS message, that is:\n-\tif the 5G-GUTI was used; or\n-\tif the SUCI was used.\nIf the 5G-GUTI was used, the network should initiate an identification procedure to retrieve SUCI from the UE and restart the 5G AKA based primary authentication and key agreement procedure with the received SUCI.\nIf the SUCI was used for identification in the initial NAS message or in a restarted 5G AKA based primary authentication and key agreement procedure, or the network decides not to initiate the identification procedure to retrieve SUCI from the UE after an unsuccessful 5G AKA based primary authentication and key agreement procedure, the network should send an AUTHENTICATION REJECT message to the UE. The network shall maintain, if any, the 5GMM-context and 5G NAS security context of the UE unchanged.\nUpon receipt of an AUTHENTICATION REJECT message,\n1)\tif the AUTHENTICATION REJECT message has been successfully integrity checked by the NAS:\n\tthe UE shall set the update status to 5U3 ROAMING NOT ALLOWED, delete the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI.\n\tIn case of PLMN, the USIM shall be considered invalid until switching off the UE or the UICC containing the USIM is removed.\n\tIn case of SNPN, if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN and the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN shall be considered invalid until the UE is switched off or the entry is updated. Additionally, the UE shall consider the USIM as invalid for the current SNPN until switching off or the UICC containing the USIM is removed.\n\tIn case of SNPN, if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN and the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid for 3GPP access until the UE is switched off or the entry is updated. Additionally, the UE shall consider the USIM as invalid for the entry until switching off or the UICC containing the USIM is removed.\n\tIn case of SNPN, if the UE is registered for onboarding services in SNPN or is performing initial registration for onboarding services in SNPN, the UE shall store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5]; and\n-\tif the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN, the UE shall set:\ni)\tthe counter for \"SIM/USIM considered invalid for GPRS services\" events, the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events, and the counter for \"SIM/USIM considered invalid for non-GPRS services\" events if maintained by the UE, in case of PLMN; or\nii)\tthe counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events and the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events in case of SNPN;\n\tto UE implementation-specific maximum value.\n\tIf the UE is registered for onboarding services in SNPN or performing initial registration for onboarding services in SNPN, the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value; and\n-\tif the UE is operating in single-registration mode, the UE shall handle EMM parameters, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the authentication procedure is not accepted by the network. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed; and\n2)\tif the AUTHENTICATION REJECT message is received without integrity protection and if timer T3516 or T3520 is running, the UE shall start timer T3247 with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running (see subclause\u00a05.3.20). \n\tAdditionally, if the UE is neither registered for onboarding services in SNPN nor performing initial registration for onboarding services in SNPN, the UE shall:\na)\tif the AUTHENTICATION REJECT message is received over 3GPP access, and the counter for \"SIM/USIM considered invalid for GPRS services\" events in case of PLMN or the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events in case of SNPN has a value less than a UE implementation-specific maximum value, proceed as specified in subclause\u00a05.3.20, list item 1)-a) of subclause\u00a05.3.20.2 (if the UE is not operating in SNPN access operation mode) or list item a)-1) of subclause\u00a05.3.20.3 (if the UE is operating in SNPN access operation mode) for the case that the 5GMM cause value received is #3;\nb)\tif the AUTHENTICATION REJECT message is received over non-3GPP access, and the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events in case of PLMN or the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events in case of SNPN has a value less than a UE implementation-specific maximum value, proceed as specified in subclause\u00a05.3.20, list item 1)-b) of subclause\u00a05.3.20.2 (if the UE is not operating in SNPN access operation mode) or list item a)-2) of subclause\u00a05.3.20.3 (if the UE is operating in SNPN access operation mode) for the case that the 5GMM cause value received is #3.\nc)\totherwise:\ni)\tif the AUTHENTICATION REJECT message is received over 3GPP access:\n-\tThe UE shall set the update status for 3GPP access to 5U3 ROAMING NOT ALLOWED, delete for 3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI.\n-\tIn case of PLMN, the UE shall consider the USIM as invalid for 5GS services via 3GPP access and non-EPS service until switching off the UE or the UICC containing the USIM is removed.\n\tIn case of SNPN, the UE shall consider the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN shall be considered invalid for 3GPP access until the UE is switched off or the entry is updated. Additionally, the UE shall consider the USIM as invalid for the current SNPN via 3GPP access until switching off or the UICC containing the USIM is removed.\n-\tThe UE shall set:\n-\tthe counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"SIM/USIM considered invalid for non-GPRS services\" events if maintained by the UE, in case of PLMN; or\n-\tthe counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events in case of SNPN;\n\tto UE implementation-specific maximum value.\n-\tIf the UE is operating in single-registration mode, the UE shall handle 4G-GUTI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the authentication procedure is not accepted by the network. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed; and\nii)\tif the AUTHENTICATION REJECT message is received over non-3GPP access:\n-\tthe UE shall set the update status for non-3GPP access to 5U3 ROAMING NOT ALLOWED, delete for non-3GPP access only the stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI;\n-\tin case of PLMN, the UE shall consider the USIM as invalid for 5GS services via non-3GPP access until switching off the UE or the UICC containing the USIM is removed.\n\tIn case of SNPN, the UE shall consider the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN as invalid for non-3GPP access until the UE is switched off or the entry is updated. Additionally, the UE shall consider the USIM as invalid for the current SNPN and for non-3GPP access until switching off or the UICC containing the USIM is removed; and\n-\tthe UE shall set:\n-\tthe counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events to UE implementation-specific maximum value in case of PLMN; or\n-\tthe counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events to UE implementation-specific maximum value in case of SNPN.\n\tIf the UE is registered for onboarding services in SNPN or performing initial registration for onboarding services in SNPN, the UE shall:\n1)\tif the SNPN-specific attempt counter for the SNPN sending the AUTHENTICATION REJECT message has a value less than a UE implementation-specific maximum value, increment the SNPN-specific attempt counter for the SNPN; or\n2)\totherwise, the UE shall set the update status to 5U3.ROAMING NOT ALLOWED, delete the stored 5G-GUTI, TAI list, last visited registered TAI, and ngKSI, store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\nIf the AUTHENTICATION REJECT message is received by the UE, the UE shall abort any 5GMM signalling procedure, stop any of the timers T3510, T3516, T3517, T3519, T3520 or T3521 (if they were running), enter state 5GMM-DEREGISTERED and delete any stored SUCI.\nDepending on local requirements or operator preference for emergency services, if the UE initiates a registration procedure with 5GS registration type IE set to \"emergency registration\" and the AMF is configured to allow emergency registration without user identity, the AMF needs not follow the procedures specified for the authentication failure in the present subclause. The AMF may continue a current 5GMM specific procedure.\n5.4.1.3.6\tAuthentication not accepted by the UE\nIn the 5G authentication challenge, the UE shall check the 5G authentication challenge data (RAND, AUTN and ngKSI) received in the AUTHENTICATION REQUEST message to verify authenticity of the 5G core network.\nThe ME shall check that ngKSI received in the AUTHENTICATION REQUEST message is not already in use. The ME shall forward the RAND and AUTN to the USIM to check.\nThe UE may reject the core network due to an incorrect AUTN or ngKSI parameter. If the UE has to reject the 5G authentication challenge, the UE shall return AUTHENTICATION FAILURE message to the network with a cause value indicating the reason for the failure (see 3GPP\u00a0TS\u00a033.501\u00a0[24]).\nIncorrect 5G authentication challenge data contains four possible causes for authentication failure:\na)\tMAC code failure:\n\tIf the UE finds the MAC code (supplied by the core network in the AUTN parameter) to be invalid, the UE shall send an AUTHENTICATION FAILURE message to the network, with the 5GMM cause #20 \"MAC failure\". The UE shall then follow the procedure described in subclause\u00a05.4.1.3.7, item c.\nb)\tNon-5G authentication unacceptable:\n\tIf the UE finds that the \"separation bit\" in the AMF field of AUTN supplied by the core network is set to 0, the UE shall send an AUTHENTICATION FAILURE message to the network, with the 5GMM cause #26 \"non-5G authentication unacceptable\" (see subclause\u00a06.1.3 in 3GPP\u00a0TS\u00a033.501\u00a0[24]). The UE shall then follow the procedure described in subclause\u00a05.4.1.3.7, item d.\nc)\tngKSI already in use:\n\tIf the UE detects that ngKSI received in the AUTHENTICATION REQUEST message is already in use in the UE shall send an AUTHENTICATION FAILURE message to the network, with the 5GMM cause #71 \"ngKSI already in use\". The UE shall then follow the procedure described in subclause\u00a05.4.1.3.7, item e.\nd)\tSQN failure:\n\tIf the UE finds the sequence number SQN (supplied by the core network in the AUTN parameter) to be out of range, the UE shall send an AUTHENTICATION FAILURE message to the network, with the 5GMM cause #21 \"synch failure\" and a re-synchronization token AUTS provided by the USIM (see 3GPP\u00a0TS\u00a033.102\u00a0[23]). The UE shall then follow the procedure described in subclause\u00a05.4.1.3.7, item f.\nIf the UE returns an AUTHENTICATION FAILURE message to the network, the UE shall delete any previously stored RAND and RES* and shall stop timer T3516, if running.\nIf the UE has an emergency PDU session established or is establishing such a PDU session, additional UE requirements are specified in subclause\u00a05.4.1.3.7, under \"for items c, d, e and f\".\n5.4.1.3.7\tAbnormal cases\na)\tLower layer failure.\n\tUpon detection of lower layer failure before the AUTHENTICATION RESPONSE message is received, the network shall abort the procedure.\nb)\tExpiry of timer T3560.\n\tThe network shall, on the first expiry of the timer T3560, retransmit the AUTHENTICATION REQUEST message and shall reset and start timer T3560. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3560, the network shall abort the 5G AKA based primary authentication and key agreement procedure and any ongoing 5GMM specific procedure and release the N1 NAS signalling connection.\nc)\tAuthentication failure (5GMM cause #20 \"MAC failure\").\n\tThe UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #20 \"MAC failure\" according to subclause\u00a05.4.1.3.6, to the network and start timer T3520 (see example in figure\u00a05.4.1.3.7.1). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with 5GMM cause #20 \"MAC failure\", the network may initiate the identification procedure described in subclause\u00a05.4.3. This is to allow the network to obtain the SUCI from the UE. The network may then check that the 5G-GUTI originally used in the 5G authentication challenge corresponded to the correct SUPI. Upon receipt of the IDENTITY REQUEST message from the network, the UE shall proceed as specified in subclause\u00a05.4.3.3.\nNOTE\u00a01:\tUpon receipt of an AUTHENTICATION FAILURE message from the UE with 5GMM cause #20 \"MAC failure\", the network may also terminate the 5G AKA based primary authentication and key agreement procedure (see subclause\u00a05.4.1.3.5).\n\tIf the mapping of 5G-GUTI to SUPI in the network was incorrect, the network should respond by sending a new AUTHENTICATION REQUEST message to the UE. Upon receiving the new AUTHENTICATION REQUEST message from the network, the UE shall stop the timer T3520, if running, and then process the 5G challenge information as normal. If the mapping of 5G-GUTI to SUPI in the network was correct, the network should terminate the 5G AKA based primary authentication and key agreement procedure by sending an AUTHENTICATION REJECT message (see subclause\u00a05.4.1.3.5).\n\tIf the network is validated successfully (an AUTHENTICATION REQUEST message that contains a valid SQN and MAC is received), the UE shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3510, T3517 or T3521) if they were running and stopped when the UE received the first failed AUTHENTICATION REQUEST message.\n\tIf the UE receives the second AUTHENTICATION REQUEST message, and the MAC value cannot be resolved, the UE shall follow the procedure specified in this subclause, item\u00a0c, starting again from the beginning, or if the message contains a UMTS authentication challenge, the UE shall follow the procedure specified in item\u00a0d. If the SQN is invalid, the UE shall proceed as specified in item\u00a0f.\n\nFigure\u00a05.4.1.3.7.1: Authentication failure during 5G AKA based primary authentication and key agreement procedure\nd)\tAuthentication failure (5GMM cause #26 \"non-5G authentication unacceptable\").\n\tThe UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #26 \"non-5G authentication unacceptable\", to the network and start the timer T3520 (see example in figure 5.4.1.3.7.1). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with 5GMM cause #26 \"non-5G authentication unacceptable\", the network may initiate the identification procedure described in subclause\u00a05.4.3. This is to allow the network to obtain the SUCI from the UE. The network may then check that the 5G-GUTI originally used in the 5G authentication challenge corresponded to the correct SUPI. Upon receipt of the IDENTITY REQUEST message from the network, the UE shall proceed as specified in subclause\u00a05.4.3.3.\nNOTE\u00a02:\tUpon receipt of an AUTHENTICATION FAILURE message from the UE with 5GMM cause #26 \"non-5G authentication unacceptable\", the network may also terminate the 5G AKA based primary authentication and key agreement procedure (see subclause\u00a05.4.1.3.5).\n\tIf the mapping of 5G-GUTI to SUPI in the network was incorrect, the network should respond by sending a new AUTHENTICATION REQUEST message to the UE. Upon receiving the new AUTHENTICATION REQUEST message from the network, the UE shall stop the timer T3520, if running, and then process the 5G challenge information as normal. If the mapping of 5G-GUTI to SUPI in the network was correct, the network should terminate the 5G AKA based primary authentication and key agreement authentication procedure by sending an AUTHENTICATION REJECT message (see subclause\u00a05.4.1.3.5).\n\tIf the network is validated successfully (an AUTHENTICATION REQUEST message that contains a valid 5G authentication challenge is received), the UE shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3510, T3517 or T3521) if they were running and stopped when the UE received the first failed AUTHENTICATION REQUEST message.\ne)\tAuthentication failure (5GMM cause #71 \"ngKSI already in use\").\n\tThe UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #71 \"ngKSI already in use\", to the network and start the timer T3520 (see example in figure 5.4.1.3.7.1). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with 5GMM cause #71 \"ngKSI already in use\", the network performs necessary actions to select a new ngKSI and send the same 5G authentication challenge to the UE.\nNOTE\u00a03:\tUpon receipt of an AUTHENTICATION FAILURE message from the UE with 5GMM cause #71 \"ngKSI already in use\", the network may also re-initiate the 5G AKA based primary authentication and key agreement procedure (see subclause\u00a05.4.1.3.2).\n\tUpon receiving the new AUTHENTICATION REQUEST message from the network, the UE shall stop the timer T3520, if running, and then process the 5G challenge information as normal.\n\tIf the network is validated successfully (an AUTHENTICATION REQUEST message that contains a valid ngKSI, SQN and MAC is received), the UE shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3510, T3517 or T3521) if they were running and stopped when the UE received the first failed AUTHENTICATION REQUEST message.\nf)\tAuthentication failure (5GMM cause #21 \"synch failure\").\n\tThe UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #21 \"synch failure\", to the network and start the timer T3520 (see example in figure\u00a05.4.1.3.7.1). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3510, T3517 or T3521). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with the 5GMM cause #21 \"synch failure\", the network shall use the returned AUTS parameter from the authentication failure parameter IE in the AUTHENTICATION FAILURE message, to re-synchronise. The re-synchronisation procedure requires the AMF to delete all unused authentication vectors for that SUPI and obtain new vectors from the UDM/AUSF. When re-synchronisation is complete, the network shall initiate the 5G AKA based primary authentication and key agreement procedure. Upon receipt of the AUTHENTICATION REQUEST message, the UE shall stop the timer T3520, if running.\nNOTE\u00a04:\tUpon receipt of two consecutive AUTHENTICATION FAILURE messages from the UE with 5GMM cause #21 \"synch failure\", the network may terminate the 5G AKA based primary authentication and key agreement procedure by sending an AUTHENTICATION REJECT message.\n\tIf the network is validated successfully (a new AUTHENTICATION REQUEST message is received which contains a valid SQN and MAC) while T3520 is running, the UE shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3510, T3517 or T3521), if they were running and stopped when the UE received the first failed AUTHENTICATION REQUEST message.\n\tUpon receipt of an AUTHENTICATION REJECT message, the UE shall perform the actions as specified in subclause\u00a05.4.1.3.5.\ng)\tNetwork failing the authentication check.\n\tIf the UE deems that the network has failed the authentication check, then it shall request RRC to locally release the RRC connection and treat the active cell as barred (see 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C]). The UE shall start any retransmission timers (e.g. T3510, T3517 or T3521), if they were running and stopped when the UE received the first AUTHENTICATION REQUEST message containing an incorrect authentication challenge data causing authentication failure.\nh)\tTransmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication from lower layers (if the 5G AKA based primary authentication and key agreement procedure is triggered by a registration procedure).\n\tThe UE shall stop the timer T3520, if running, and re-initiate the registration procedure.\ni)\tTransmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication with change in the current TAI (if the 5G AKA based primary authentication and key agreement procedure is triggered by a service request procedure).\n\tThe UE shall stop the timer T3520, if running.\n\tIf the current TAI is not in the TAI list, the 5G AKA based primary authentication and key agreement procedure shall be aborted and a registration procedure for mobility and periodic registration update shall be initiated.\n\tIf the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure that triggered the 5G AKA based primary authentication and key agreement procedure.\nj)\tTransmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication without change in the current TAI (if the authentication procedure is triggered by a service request procedure).\n\tThe UE shall stop the timer T3520, if running. It is up to the UE implementation how to re-run the ongoing procedure that triggered the 5G AKA based primary authentication and key agreement procedure.\nk)\tLower layers indication of non-delivered NAS PDU due to handover.\n\tIf the AUTHENTICATION REQUEST message could not be delivered due to an intra AMF handover and the target TA is included in the TAI list, then upon successful completion of the intra AMF handover the AMF shall retransmit the AUTHENTICATION REQUEST message. If a failure of handover procedure is reported by the lower layer and the N1 NAS signalling connection exists, the AMF shall retransmit the AUTHENTICATION REQUEST message.\nl)\tChange in the current TAI.\n\tIf the current TAI is not in the TAI list before the AUTHENTICATION RESPONSE message is sent, the UE may discard sending the AUTHENTICATION RESPONSE message to the network and continue with the initiation of the registration procedure for mobility and periodic registration update as described in subclause\u00a05.5.1.3.2.\nm)\tAUTHENTICATION REJECT message is received without integrity protection and neither timer T3516 nor T3520 is running.\n\tIf an AUTHENTICATION REJECT message is received without integrity protection and if neither timer T3516 nor T3520 is running, then the UE shall discard the AUTHENTICATION REJECT message. Additionally, the UE may request RRC to locally release the RRC connection and treat the active cell as barred (see 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C]).\nFor items\u00a0c, d, e, and f if no emergency service is started or is ongoing:\n\tThe UE shall stop timer T3520, if the timer is running and the UE enters 5GMM-IDLE mode, e.g. upon detection of a lower layer failure, release of the N1 NAS signalling connection, or as the result of an inter-system change in 5GMM-CONNECTED mode from N1 mode to S1 mode.\n\tThe UE shall deem that the network has failed the authentication check or assume that the authentication is not genuine and proceed as described in item\u00a0g above if any of the following occurs:\n-\tthe timer T3520 expires;\n-\tthe UE detects any combination of the 5G authentication failures: 5GMM causes #20 \"MAC failure\", #21 \"synch failure\", #26 \"non-5G authentication unacceptable\" or #71 \"ngKSI already in use\", during three consecutive authentication challenges. The 5G authentication challenges shall be considered as consecutive only, if the 5G authentication challenges causing the second and third 5G authentication failure are received by the UE, while the timer T3520 started after the previous 5G authentication failure is running.\nFor items\u00a0c, d, e, and f if there is an emergency service started or is ongoing:\n\tThe UE shall stop timer T3520, if the timer is running and the UE enters 5GMM-IDLE mode, e.g. upon detection of a lower layer failure, release of the N1 NAS signalling connection, or as the result of an inter-system change in 5GMM-CONNECTED mode from N1 mode to S1 mode.\n\tIf there is an ongoing:\n-\tservice request procedure for emergency services fallback the UE shall abort the service request procedure, stop timer T3517 and locally release any resources allocated for the service request procedure and enter state 5GMM-REGISTERED; or\n-\tregistration procedure for mobility and periodic registration update triggered upon a request from the upper layers to perform an emergency services fallback procedure the UE shall abort the registration procedure for mobility and periodic registration update, stop timer T3510 and locally release any resources allocated for the registration procedure for mobility and periodic registration update and enter the state 5GMM-REGISTERED; and\n\tthe UE shall attempt to select an E-UTRA cell connected to EPC or 5GCN according to the domain priority and selection rules specified in 3GPP\u00a0TS\u00a023.167\u00a0[6]. If the UE finds a suitable E-UTRA cell, it proceeds with the appropriate EMM or 5GMM procedures. If the UE operating in single-registration mode has changed to S1 mode, it shall disable the N1 mode capability for 3GPP access.\n\tDepending on local requirements or operator preference for emergency services, if the UE has an emergency PDU session established or is establishing an emergency PDU session, the AMF need not follow the procedures specified for the authentication failure specified in the present subclause. The AMF may respond to the AUTHENTICATION FAILURE message by initiating the security mode control procedure selecting the \"null integrity protection algorithm\" 5G-IA0, \"null ciphering algorithm\" 5G-EA0 or may abort the 5G AKA based primary authentication and key agreement procedure and continue using the current security context, if any. The AMF shall indicate to the SMF to perform the release of all non-emergency PDU sessions, if any. If there is an ongoing PDU session establishment procedure, the AMF shall indicate to the SMF to perform the release of all non-emergency PDU sessions upon completion of the PDU session establishment procedure. The network shall behave as if the UE is registered for emergency services.\n\tIf a UE has an emergency PDU session established or is establishing an emergency PDU session and sends an AUTHENTICATION FAILURE message to the AMF with the 5GMM cause appropriate for these cases (#20, #21, #26, or #71 respectively) and receives the SECURITY MODE COMMAND message before the timeout of timer T3520, the UE shall deem that the network has passed the authentication check successfully, stop timer T3520, respectively, and execute the security mode control procedure.\n\tIf a UE has an emergency PDU session established or is establishing an emergency PDU session when timer T3520 expires, the UE shall not deem that the network has failed the authentication check and not behave as described in item g. Instead the UE shall continue using the current security context, if any, release all non-emergency PDU sessions, if any, by initiating UE-requested PDU session release procedure. If there is an ongoing PDU session establishment procedure, the UE shall release all non-emergency PDU sessions upon completion of the PDU session establishment procedure.\n\tThe UE shall start any retransmission timers (e.g. T3510, T3517 or T3521) if:\n-\tthey were running and stopped when the UE received the AUTHENTICATION REQUEST message and detected an authentication failure; and\n-\tthe procedures associated with these timers have not yet been completed.\n\tThe UE shall behave as if the UE is registered for emergency services.\n5.4.2\tSecurity mode control procedure\n5.4.2.1\tGeneral\nThe purpose of the NAS security mode control procedure is to take a 5G NAS security context into use, and initialise and start NAS signalling security between the UE and the AMF with the corresponding 5G NAS keys and 5G NAS security algorithms.\nFurthermore, the network may also initiate the security mode control procedure in the following cases:\na)-\tin order to change the 5G NAS security algorithms for a current 5G NAS security context already in use;\nb)\tin order to change the value of uplink NAS COUNT used in the latest SECURITY MODE COMPLETE message as described in 3GPP\u00a0TS\u00a033.501\u00a0[24],\u00a0subclause\u00a06.9.4.4; and\nc)\tin order to provide the Selected EPS NAS security algorithms to the UE.\nFor restrictions concerning the concurrent running of a security mode control procedure with other security related procedures in the AS or inside the core network see 3GPP\u00a0TS\u00a033.501\u00a0[24], subclause\u00a06.9.5.\nIf the security mode control procedure is initiated after successful 5G AKA based primary authentication and key agreement procedure and the security mode control procedure intends to bring into use the partial native 5G NAS security context created by the 5G AKA based primary authentication and key agreement procedure and the UE accepts received security mode command (see subclause\u00a05.4.2.3), the ME shall:\na)\tdelete the valid KAUSF and the valid KSEAF, if any; and\nb)\tconsider the new KAUSF to be the valid KAUSF, and the new KSEAF to be the valid KSEAF, reset the SOR counter and the UE parameter update counter to zero, and store the valid KAUSF, the valid KSEAF, the SOR counter and the UE parameter update counter as specified in annex\u00a0C and use the valid KAUSF in the verification of SOR transparent container and UE parameters update transparent container, if any are received.\nNOTE:\tThe AMF does not perform a security mode control procedure when the 5G AKA based primary authentication procedure successfully authenticates a 5G ProSe layer-3 remote UE accessing the network via a 5G ProSe layer-3 UE-to-network relay UE served by the AMF.\n5.4.2.2\tNAS security mode control initiation by the network\nThe AMF initiates the NAS security mode control procedure by sending a SECURITY MODE COMMAND message to the UE and starting timer T3560 (see example in figure\u00a05.4.2.2).\nThe AMF shall reset the downlink NAS COUNT counter and use it to integrity protect the initial SECURITY MODE COMMAND message if the security mode control procedure is initiated:\na)\tto take into use the security context created after a successful execution of the 5G AKA based primary authentication and key agreement procedure or the EAP based primary authentication and key agreement procedure; or\nb)\tupon receipt of REGISTRATION REQUEST message, if the AMF needs to create a mapped 5G NAS security context (i.e. the type of security context flag is set to \"mapped security context\" in the ngKSI IE included in the SECURITY MODE COMMAND message).\nThe AMF shall send the SECURITY MODE COMMAND message unciphered, but shall integrity protect the message with the 5G NAS integrity key based on KAMF or mapped K'AMF indicated by the ngKSI included in the message. The AMF shall set the security header type of the message to \"integrity protected with new 5G NAS security context\".\nThe AMF shall create a locally generated KAMF and send the SECURITY MODE COMMAND message including an ngKSI value in the ngKSI IE set to \"000\" and 5G-IA0 and 5G-EA0 as the selected NAS security algorithms only when the security mode control procedure is initiated:\na)\tduring an initial registration procedure for emergency services if no valid 5G NAS security context is available;\nb)\tduring a registration procedure for mobility and periodic registration update for a UE that has an emergency PDU session if no valid 5G NAS security context is available;\nc)\tduring a service request procedure for a UE that has an emergency PDU session if no valid 5G NAS security context is available; or\nd)\tafter a failed primary authentication and key agreement procedure for a UE that has an emergency PDU session or is establishing an emergency PDU session, if continued usage of a valid 5G NAS security context is not possible.\nWhen the AMF sends the SECURITY MODE COMMAND message including an ngKSI value in the ngKSI IE set to \"000\" and 5G-IA0 and 5G-EA0 as the selected NAS security algorithms, if:\na)\tthe AMF supports N26 interface;\nb)\tthe UE set the S1 mode bit to \"S1 mode supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message; and\nc)\tthe security mode control procedure is initiated during an initial registration procedure for emergency services, during a registration procedure for mobility and periodic registration update for a UE that has an emergency PDU session, or during a service request procedure for a UE that has an emergency PDU session,\nthe SECURITY MODE COMMAND message shall also include the Selected EPS NAS security algorithms IE. The selected EPS NAS security algorithms shall be set to EIA0 and EEA0.\nThe UE shall process a SECURITY MODE COMMAND message including an ngKSI value in the ngKSI IE set to \"000\" and 5G-IA0 and 5G-EA0 as the selected NAS security algorithms and, if accepted, create a locally generated KAMF when the security mode control procedure is initiated:\na)\tduring an initial registration procedure for emergency services;\nb)\tduring a registration procedure for mobility and periodic registration update for a UE that has an emergency PDU session;\nc)\tduring a service request procedure for a UE that has an emergency PDU session; or\nd)\tafter a primary authentication and key agreement procedure for a UE that has an emergency PDU session or is establishing an emergency PDU session.\nNOTE\u00a01:\tThe process for creation of the locally generated KAMF by the AMF and the UE is implementation dependent. The KAMF is specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nUpon receipt of a REGISTRATION REQUEST message, if the AMF does not have the valid current 5G NAS security context indicated by the UE, the AMF shall either:\na)\tindicate the use of the new mapped 5G NAS security context to the UE by setting the type of security context flag in the ngKSI IE to \"mapped security context\" and the KSI value related to the security context of the source system; or\nb)\tset the ngKSI value to \"000\" in the ngKSI IE if the AMF sets 5G-IA0 and 5G-EA0 as the selected NAS security algorithms for a UE that has an emergency PDU session.\nUpon receipt of a REGISTRATION REQUEST message, if the AMF has the valid current 5G NAS security context indicated by the UE, the AMF supports N26 interface and the UE set the S1 mode bit to \"S1 mode supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and the UE is not registered for disaster roaming services, the AMF shall check whether the selected EPS NAS security algorithms was successfully provided to the UE. If not, the AMF shall initiate the NAS security mode control procedure by sending a SECURITY MODE COMMAND message with the Selected EPS NAS security algorithms IE to the UE.\nWhile having a current mapped 5G NAS security context with the UE, if the AMF needs to take the native 5G NAS security context into use, the AMF shall include the ngKSI that indicates the native 5G NAS security context in the SECURITY MODE COMMAND message.\nThe AMF shall include the replayed security capabilities of the UE (including the security capabilities with regard to NAS, RRC and UP (user plane) ciphering as well as NAS and RRC integrity, and other possible target network security capabilities, i.e. E-UTRAN if the UE included them in the message to network), the selected 5GS ciphering and integrity algorithms and the ngKSI.\nIf a UE is already registered over one access to a PLMN and the AMF decides to skip primary authentication and key agreement procedure when the UE attempts to register over the other access to the same PLMN, the AMF shall take into use the UE's current 5G NAS security context over the other access that the UE is registering. In this case, SECURITY MODE COMMAND message is not sent to the UE.\nIf the UE is registered to the same AMF and the same PLMN over both 3GPP access and non-3GPP access, and the UE is in 5GMM-CONNECTED mode over both the 3GPP and non-3GPP accesses, then at any time the primary authentication and key agreement procedure has successfully completed over:\na)\tthe 3GPP access, the AMF includes the ngKSI in the SECURITY MODE COMMAND message over the 3GPP access. When the AMF sends the SECURITY MODE COMMAND message to UE over the non-3GPP access to take into use the new 5G NAS security context, the AMF shall include the same ngKSI in the SECURITY MODE COMMAND message to identify the new 5G NAS security context; or\nb)\tthe non-3GPP access, the AMF includes the ngKSI in the SECURITY MODE COMMAND message over the non-3GPP access. When the AMF sends the SECURITY MODE COMMAND message to UE over the 3GPP access to take into use the new 5G NAS security context, the AMF shall include the same ngKSI in the SECURITY MODE COMMAND message to identify the new 5G NAS security context.\nThe AMF may initiate a SECURITY MODE COMMAND in order to change the 5G security algorithms for a current 5G NAS security context already in use. The AMF re-derives the 5G NAS keys from KAMF with the new 5G algorithm identities as input and provides the new 5GS algorithm identities within the SECURITY MODE COMMAND message. The AMF shall set the security header type of the message to \"integrity protected with new 5G NAS security context\".\nIf, during an ongoing registration procedure, the AMF is initiating a SECURITY MODE COMMAND (i.e. after receiving the REGISTRATION REQUEST message, but before sending a response to that message) and:\na)\tthe REGISTRATION REQUEST message does not successfully pass the integrity check at the AMF; or\nb)\tthe AMF can not decipher the value part of the NAS message container IE in the REGISTRATION REQUEST message;\nthe AMF shall include the Additional 5G security information IE with the RINMR bit set to \"Retransmission of the initial NAS message requested\" in the SECURITY MODE COMMAND message requesting the UE to send the entire REGISTRATION REQUEST message in the SECURITY MODE COMPLETE message as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nIf, during an ongoing deregistration procedure, the AMF is initiating a SECURITY MODE COMMAND (i.e. after receiving the DEREGISTRATION REQUEST message, but before sending a response to that message) and:\na)\tthe DEREGISTRATION REQUEST message does not successfully pass the integrity check at the AMF; or\nb)\tthe AMF can not decipher the value part of the NAS message container IE in the DEREGISTRATION REQUEST message;\nthe AMF shall include the Additional 5G security information IE with the RINMR bit set to \"Retransmission of the initial NAS message requested\" in the SECURITY MODE COMMAND message requesting the UE to send the entire DEREGISTRATION REQUEST message in the SECURITY MODE COMPLETE message as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nNOTE\u00a02:\tThe AMF uses the UE security capability which was provided by the UE.\nIf, during an ongoing service request procedure for a UE with an emergency PDU session, the AMF is initiating a SECURITY MODE COMMAND (i.e. after receiving the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message, but before sending a response to that message) and the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message does not successfully pass the integrity check at the AMF, the AMF shall include the Additional 5G security information IE with the RINMR bit set to \"Retransmission of the initial NAS message requested\" in the SECURITY MODE COMMAND message requesting the UE to send the entire:\na)\tSERVICE REQUEST message; or\nb)\tCONTROL PLANE SERVICE REQUEST message excluding non-cleartext IEs, except the Uplink data status IE if needed (see subclause\u00a05.4.2.3);\nin the SECURITY MODE COMPLETE message as described in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nAdditionally, the AMF may request the UE to include its IMEISV in the SECURITY MODE COMPLETE message.\nIf the AMF supports N26 interface and the UE set the S1 mode bit to \"S1 mode supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and the AMF needs to provide the selected EPS NAS security algorithms to the UE, the AMF shall select ciphering and integrity algorithms to be used in the EPS and indicate them to the UE via the Selected EPS NAS security algorithms IE in the SECURITY MODE COMMAND message.\nNOTE\u00a03:\tThe AS and NAS security capabilities are the same, i.e. if the UE supports one algorithm for NAS, the same algorithm is also supported for AS.\nIf the AMF performs horizontal key derivation e.g. during the mobility and periodic registration update or when the UE is already registered in the PLMN with another access type as described in 3GPP\u00a0TS\u00a033.501\u00a0[24], the AMF shall include horizontal derivation parameter in the SECURITY MODE COMMAND message.\nIf the security mode control procedure is initiated after successful EAP based primary authentication and key agreement procedure and the security mode control procedure intends to bring into use the partial native 5G NAS security context created by the EAP based primary authentication and key agreement procedure, the AMF shall set the EAP message IE of the SECURITY MODE COMMAND message to an EAP-success message to be sent to the UE. If the SECURITY MODE COMMAND message is provided to a 5G-RG that is acting on behalf of an AUN3 device and the EAP message IE is set to an EAP-success message, the AMF shall include the AUN3 device security key IE in the SECURITY MODE COMMAND message with its value set to:\na)\tthe Master session key, if the AUN3 device does not support 5G key hierarchy; or\nb)\tthe KWAGF key, if the AUN3 device supports 5G key hierarchy.\nNOTE\u00a04:\tThe network is aware from the AUN3 device subscription data in UDM whether the AUN3 device supports 5G key hierarchy or not as specified in subclause\u00a07B.7 of 3GPP\u00a0TS\u00a033.501\u00a0[24].\n\nFigure\u00a05.4.2.2: Security mode control procedure\n5.4.2.3\tNAS security mode command accepted by the UE\nUpon receipt of the SECURITY MODE COMMAND message, the UE shall check whether the security mode command can be accepted or not. This is done by performing the integrity check of the message, and by checking that the received Replayed UE security capabilities IE has not been altered compared to the latest values that the UE sent to the network.\nWhen the SECURITY MODE COMMAND message includes an EAP-success message the UE handles the EAP-success message and the ABBA as described in subclause\u00a05.4.1.2.2.8, 5.4.1.2.3.1, 5.4.1.2.3A.1, 5.4.1.2.3B.1 and 5.4.1.2.3C.1.\nIf:\na)\tthe UE is registered for emergency services, performing initial registration for emergency services, establishing an emergency PDU session or has an emergency PDU session established;\nb)\tthe W-AGF acts on behalf of the FN-RG;\nc)\tthe W-AGF acts on behalf of the N5GC device; or\nd)\tthe 5G-RG acts on behalf of the AUN3 device,\nand the SECURITY MODE COMMAND message is received with ngKSI value \"000\" and 5G-IA0 and 5G-EA0 as selected 5G NAS security algorithms, the UE shall locally derive and take in use 5G NAS security context. The UE shall delete existing current 5G NAS security context.\nThe UE shall accept a SECURITY MODE COMMAND message indicating the \"null integrity protection algorithm\" 5G-IA0 as the selected 5G NAS integrity algorithm only if the message is received when \na)\tthe UE is registered for emergency services, performing initial registration for emergency services, establishing an emergency PDU session or has an emergency PDU session established;\nb)\tthe W-AGF acts on behalf of the FN-RG;\nc)\tthe W-AGF acts on behalf of the N5GC device; or\nd)\tthe 5G-RG acts on behalf of the AUN3 device.\nIf the type of security context flag included in the SECURITY MODE COMMAND message is set to \"native security context\" and if the ngKSI matches a valid non-current native 5G NAS security context held in the UE while the UE has a mapped 5G NAS security context as the current 5G NAS security context, the UE shall take the non-current native 5G NAS security context into use which then becomes the current native 5G NAS security context and delete the mapped 5G NAS security context.\nThe UE shall ignore the Replayed S1 UE security capabilities IE if this IE is included in the SECURITY MODE COMMAND message.\nIf the SECURITY MODE COMMAND message can be accepted, the UE shall take the 5G NAS security context indicated in the message into use. The UE shall in addition reset the uplink NAS COUNT counter if:\na)\tthe SECURITY MODE COMMAND message is received in order to take a 5G NAS security context into use created after a successful execution of the 5G AKA based primary authentication and key agreement procedure or the EAP based primary authentication and key agreement procedure; or\nb)\tthe SECURITY MODE COMMAND message received includes the type of security context flag set to \"mapped security context\" in the NAS key set identifier IE the ngKSI does not match the current 5G NAS security context, if it is a mapped 5G NAS security context.\nIf the SECURITY MODE COMMAND message can be accepted and a new 5G NAS security context is taken into use and SECURITY MODE COMMAND message does not indicate the \"null integrity protection algorithm\" 5G-IA0 as the selected NAS integrity algorithm, the UE shall:\n-\tif the SECURITY MODE COMMAND message has been successfully integrity checked using an estimated downlink NAS COUNT equal to 0, then the UE shall set the downlink NAS COUNT of this new 5G NAS security context to 0;\n-\totherwise the UE shall set the downlink NAS COUNT of this new 5G NAS security context to the downlink NAS COUNT that has been used for the successful integrity checking of the SECURITY MODE COMMAND message.\nIf the SECURITY MODE COMMAND message includes the horizontal derivation parameter indicating \"KAMF derivation is required\", the UE shall derive a new K'AMF, as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] for KAMF to K'AMF derivation in mobility, and set both uplink and downlink NAS COUNTs to zero. When the new 5G NAS security context is taken into use for current access and the UE is registered with the same PLMN over the 3GPP access and the non-3GPP access:\na)\tthe UE is in 5GMM-IDLE mode over the non-current access, the AMF and the UE shall activate the new 5G NAS security context over the non-current access as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The AMF and the UE shall set the downlink NAS COUNT and uplink NAS COUNT to zero for the non-current access; or\nb)\tthe UE is in 5GMM-CONNECTED mode over the non-current access, the AMF shall send the SECURITY MODE COMMAND message over the non-current access to activate the new 5G NAS security context that was activated over the current access as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The AMF shall include the same ngKSI in the SECURITY MODE COMMAND message to identify the new 5G NAS security context.\nNOTE\u00a01:\tIf the UE was in 5GMM-CONNECTED mode over the non-current access when the new 5G NAS security context was taken into use for the current access and the UE enters 5GMM-IDLE mode over the non-current access before receiving a SECURITY MODE COMMAND message over the non-current access, the UE conforms to bullet\u00a0a).\nNOTE\u00a02:\tIf the UE was in 5GMM-CONNECTED mode over the non-current access when the new 5G NAS security context was taken into use and the N1 NAS signalling connection is lost over the non-current access before sending a SECURITY MODE COMMAND message over the non-current access, the AMF conforms to bullet\u00a0a).\nIf the SECURITY MODE COMMAND message includes the horizontal derivation parameter indicating \"KAMF derivation is not required\" or the Additional 5G security information IE is not included in the message, the UE is registered with the same PLMN over the 3GPP access and non-3GPP access, then after the completion of a security mode control procedure over the current access:\na)\tthe UE is in 5GMM-IDLE mode over the non-current access, the AMF and the UE shall activate the new 5G NAS security context for the non-current access. If a primary authentication and key agreement procedure was completed before the security mode control procedure, the AMF and the UE shall set the downlink NAS COUNT and uplink NAS COUNT to zero for the non-current access, otherwise the downlink NAS COUNT and uplink NAS COUNT for the non-3GPP access are not changed; or\nb)\tthe UE is in 5GMM-CONNECTED mode over the non-current access, the AMF shall send the SECURITY MODE COMMAND message over the non-current access to activate the new 5G NAS security context that was activated over the current access as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The AMF shall include the same ngKSI in the SECURITY MODE COMMAND message to identify the new 5G NAS security context.\nNOTE\u00a03:\tIf the UE was in 5GMM-CONNECTED mode over the non-current access when the new 5G NAS security context was taken into use for the current access and the UE enters 5GMM-IDLE mode over the non-current access before receiving a SECURITY MODE COMMAND message over the non-current access, the UE conforms to bullet\u00a0a).\nNOTE\u00a04:\tIf the UE was in 5GMM-CONNECTED mode over the non-current access when the new 5G NAS security context was taken into use and the N1 NAS signalling connection is lost over the non-current access before sending a SECURITY MODE COMMAND message over the non-current access, the AMF conforms to bullet\u00a0a).\nIf the SECURITY MODE COMMAND message can be accepted, the UE shall send a SECURITY MODE COMPLETE message integrity protected with the selected 5GS integrity algorithm and the 5G NAS integrity key based on the KAMF or mapped K'AMF if the type of security context flag is set to \"mapped security context\" indicated by the ngKSI. When the SECURITY MODE COMMAND message includes the type of security context flag set to \"mapped security context\" in the NAS key set identifier IE, then the UE shall check whether the SECURITY MODE COMMAND message indicates the ngKSI of the current 5GS security context, if it is a mapped 5G NAS security context, in order not to re-generate the K'AMF.\nFurthermore, if the SECURITY MODE COMMAND message can be accepted, the UE shall cipher the SECURITY MODE COMPLETE message with the selected 5GS ciphering algorithm and the 5GS NAS ciphering key based on the KAMF or mapped K'AMF indicated by the ngKSI. The UE shall set the security header type of the message to \"integrity protected and ciphered with new 5G NAS security context\".\nFrom this time onward the UE shall cipher and integrity protect all NAS signalling messages with the selected 5GS integrity and ciphering algorithms.\nIf the AMF indicated in the SECURITY MODE COMMAND message that the IMEISV is requested and:\na)\tif the UE:\n1)\tsupports at least one 3GPP access technology, the UE shall include its IMEISV in the IMEISV IE of the SECURITY MODE COMPLETE message; or\n2)\tdoes not support any 3GPP access technology (i.e. satellite NG-RAN, NG-RAN, satellite E-UTRAN, E-UTRAN, UTRAN or GERAN) and supports NAS over untrusted or trusted non-3GPP access, the UE shall include its EUI-64 in the non-IMEISV PEI IE of the SECURITY MODE COMPLETE message; or\nb)\tif:\n1)\tthe 5G-RG contains neither an IMEISV nor an IMEI or when the 5G-RG acts on behalf of the AUN3 device; or\n2)\twhen the W-AGF acts on behalf of the FN-RG (or on behalf of the N5GC device),\nthe 5G-RG or the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) shall include the MAC address and the MAC address usage restriction indication determined as specified in subclause\u00a05.3.2 in the non-IMEISV PEI IE in the SECURITY MODE COMPLETE message.\nIf during an ongoing registration procedure, deregistration procedure, or service request procedure, the UE receives a SECURITY MODE COMMAND message which includes the Additional 5G security information IE with the RINMR bit set to \"Retransmission of the initial NAS message requested\", the UE shall include the entire unciphered REGISTRATION REQUEST message, DEREGISTRATION REQUEST message, SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message, which the UE had previously included in the NAS message container IE of the initial NAS message (i.e. REGISTRATION REQUEST message, DEREGISTRATION REQUEST MESSAGE, SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message, respectively), in the NAS message container IE of the SECURITY MODE COMPLETE message. The retransmitted CONTROL PLANE SERVICE REQUEST message:\na)\tshall not include any non-cleartext IE, except the Uplink data status IE; and\nb)\tmay include the Uplink data status IE.\nIf, prior to receiving the SECURITY MODE COMMAND message, the UE without a valid 5G NAS security context had sent a REGISTRATION REQUEST message the UE shall include the entire REGISTRATION REQUEST message in the NAS message container IE of the SECURITY MODE COMPLETE message as described in subclause\u00a04.4.6.\nIf the UE operating in the single-registration mode receives the Selected EPS NAS security algorithms IE, the UE shall use the IE according to 3GPP\u00a0TS\u00a033.501\u00a0[24].\nFor a UE operating in single-registration mode in a network supporting N26 interface after an inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode, the UE shall set the value of the Selected EPS NAS security algorithms IE in the 5G NAS security context to the NAS security algorithms that were received from the source MME when the UE was in S1 mode.\n5.4.2.4\tNAS security mode control completion by the network\nThe AMF shall, upon receipt of the SECURITY MODE COMPLETE message, stop timer T3560. From this time onward the AMF shall integrity protect and encipher all signalling messages with the selected 5GS integrity and ciphering algorithms.\nIf the SECURITY MODE COMPLETE message contains a NAS message container IE with a REGISTRATION REQUEST message, the AMF shall complete the ongoing registration procedure by considering the REGISTRATION REQUEST message contained in the NAS message container IE as the message that triggered the procedure.\nIf the SECURITY MODE COMPLETE message contains a NAS message container IE with a DEREGISTRATION REQUEST message, the AMF shall complete the ongoing deregistration procedure by considering the DEREGISTRATION REQUEST message contained in the NAS message container IE as the message that triggered the procedure.\nIf the SECURITY MODE COMPLETE message contains a NAS message container IE with a REGISTRATION REQUEST message, the 5GMM capability IE included in the REGISTRATION REQUEST message indicates \"S1 mode supported\" and the AMF supports N26 interface, the AMF shall initiate another NAS security mode control procedure in order to provide the selected EPS NAS security algorithms to the UE as described in subclause\u00a05.4.2.2. This second NAS security mode control procedure should be initiated as part of 5GMM common procedures of the ongoing registration procedure.\nIf the SECURITY MODE COMPLETE message contains a NAS message container IE with a SERVICE REQUEST message, the AMF shall complete the ongoing service request procedure by considering the SERVICE REQUEST message contained in the NAS message container IE as the message that triggered the procedure.\nIf the SECURITY MODE COMPLETE message contains a NAS message container IE with a CONTROL PLANE SERVICE REQUEST message, the AMF shall complete the ongoing service request procedure by considering the CONTROL PLANE SERVICE REQUEST message contained in the NAS message container IE as the message that triggered the procedure.\n5.4.2.5\tNAS security mode command not accepted by the UE\nIf the security mode command cannot be accepted, the UE shall send a SECURITY MODE REJECT message. The SECURITY MODE REJECT message contains a 5GMM cause that typically indicates one of the following cause values:\n#23\tUE security capabilities mismatch.\n#24\tsecurity mode rejected, unspecified.\nIf the UE detects that the received Replayed UE security capabilities IE has been altered compared to the latest values that the UE sent to the network, the UE shall set the cause value to #23 \"UE security capabilities mismatch\".\nUpon receipt of the SECURITY MODE REJECT message, the AMF shall stop timer T3560. The AMF shall also abort the ongoing procedure that triggered the initiation of the NAS security mode control procedure.\nBoth the UE and the AMF shall apply the 5G NAS security context in use before the initiation of the security mode control procedure, if any, to protect the SECURITY MODE REJECT message and any other subsequent messages according to the rules in subclause\u00a04.4.4 and\u00a04.4.5.\n5.4.2.6\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tTransmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication from lower layers (if the security mode control procedure is triggered by a registration procedure).\n\tThe UE shall abort the security mode control procedure and re-initiate the registration procedure.\nb)\tTransmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication with change in the current TAI (if the security mode control procedure is triggered by a service request procedure).\n\tIf the current TAI is not in the TAI list, the security mode control procedure shall be aborted and a registration procedure shall be initiated.\n\tIf the current TAI is still part of the TAI list, the security mode control procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the security mode control procedure.\nc)\tTransmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication without change in the current TAI (if the security mode control procedure is triggered by a service request procedure).\n\tThe security mode control procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the security mode control procedure.\n5.4.2.7\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tLower layer failure before the SECURITY MODE COMPLETE or SECURITY MODE REJECT message is received.\n\tThe network shall abort the security mode control procedure.\nb)\tExpiry of timer T3560.\n\tThe network shall, on the first expiry of the timer T3560, retransmit the SECURITY MODE COMMAND message and shall reset and start timer T3560. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3560, the procedure shall be aborted.\nc)\tCollision between security mode control procedure and registration, service request or de-registration procedure not indicating switch off.\n\tThe network shall abort the security mode control procedure and proceed with the UE initiated procedure.\nd)\tCollision between security mode control procedure and other 5GMM procedures than in item\u00a0c.\n\tThe network shall progress both procedures.\ne)\tLower layers indication of non-delivered NAS PDU due to handover:\n\tIf the SECURITY MODE COMMAND message could not be delivered due to an intra AMF handover and the target TA is included in the TAI list, then upon successful completion of the intra AMF handover the AMF shall retransmit the SECURITY MODE COMMAND message. If a failure of the handover procedure is reported by the lower layer and the N1 signalling connection exists, the AMF shall retransmit the SECURITY MODE COMMAND message.\n5.4.3\tIdentification procedure\n5.4.3.1\tGeneral\nThe purpose of this procedure is to request a particular UE to provide specific identification parameters, e.g. the SUCI, the IMEI, the IMEISV, the EUI-64 or the MAC address. The SUCI is a privacy preserving identifier containing the concealed SUPI and the IMEI, the IMEISV, the EUI-64 and the MAC address are formats of PEI.\n5.4.3.2\tIdentification initiation by the network\nThe AMF initiates the identification procedure by sending an IDENTITY REQUEST message to the UE and starting timer T3570 (see example in figure\u00a05.4.3.2.1). The IDENTITY REQUEST message specifies the requested identification parameters in the Identity type information element.\n\nFigure\u00a05.4.3.2.1: Identification procedure\n5.4.3.3\tIdentification response by the UE\nA UE shall be ready to respond to an IDENTITY REQUEST message at any time whilst in 5GMM-CONNECTED mode.\nUpon receipt of the IDENTITY REQUEST message:\na)\tif the Identity type IE in the IDENTITY REQUEST message is not set to \"SUCI\", the UE shall send an IDENTITY RESPONSE message to the network. The IDENTITY RESPONSE message shall contain the identification parameters as requested by the network; and\nb)\tif the Identity type IE in the IDENTITY REQUEST message is set to \"SUCI\", the UE shall:\n1)\tif timer T3519 is not running, generate a fresh SUCI as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24], send an IDENTITY RESPONSE message with the SUCI, start timer T3519 and store the value of the SUCI sent in the IDENTITY RESPONSE message; and\n2)\tif timer T3519 is running, send an IDENTITY RESPONSE message with the stored SUCI.\n5.4.3.4\tIdentification completion by the network\nUpon receipt of the IDENTITY RESPONSE the network shall stop the timer T3570.\n5.4.3.5\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tTransmission failure of the IDENTITY RESPONSE message (if the identification procedure is triggered by a registration procedure).\n\tThe UE shall re-initiate the registration procedure.\nb)\tRequested identity is not available\n\tIf the UE cannot encode the requested identity in the IDENTITY RESPONSE message, e.g. because no valid USIM is available, then it shall encode the identity type as \"No identity\".\n5.4.3.6\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tLower layer failure.\n\tUpon detection of a lower layer failure before the IDENTITY RESPONSE is received, the network shall abort any ongoing 5GMM procedure.\nb)\tExpiry of timer T3570.\n\tThe network shall, on the first expiry of the timer T3570, retransmit the IDENTITY REQUEST message and reset and restart the timer T3570. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3570, the network shall abort the identification procedure and any ongoing 5GMM procedure.\nc)\tCollision of an identification procedure with a registration procedure for initial registration.\n\tIf the network receives a REGISTRATION REQUEST message indicating either \"initial registration\" or \"emergency registration\" in the 5GS registration type IE before the ongoing identification procedure has been completed and no registration procedure is pending on the network (i.e. no REGISTRATION ACCEPT/REJECT message has still to be sent as an answer to a REGISTRATION REQUEST message), the network shall proceed with the registration procedure for initial registration.\nd)\tCollision of an identification procedure with a registration procedure for initial registration when the identification procedure has been caused by a registration procedure for initial registration.\n\tIf the network receives a REGISTRATION REQUEST message indicating either \"initial registration\" or \"emergency registration\" in the 5GS registration type IE before the ongoing identification procedure has been completed and a registration procedure for initial registration is pending (i.e. a REGISTRATION ACCEPT/REJECT message has to be sent as an answer to an earlier REGISTRATION REQUEST message), then:\n-\tIf one or more of the information elements in the REGISTRATION REQUEST message differ from the ones received within the previous REGISTRATION REQUEST message, the network shall proceed with the new registration procedure for initial registration; or\n-\tIf the information elements do not differ, then the network shall not treat any further this new REGISTRATION REQUEST message.\ne)\tCollision of an identification procedure with a registration procedure for mobility and periodic registration update.\n\tIf the network receives a REGISTRATION REQUEST message indicating either \"mobility registration updating\" or \"periodic registration updating\" in the 5GS registration type IE before the ongoing identification procedure has been completed, the network shall progress both procedures.\nf)\tCollision of an identification procedure with a UE initiated de-registration procedure.\n\tIf the network receives a DEREGISTRATION REQUEST message with \"switch off\" indication in the De-registration type IE before the ongoing identification procedure has been completed, the network shall abort the identification procedure and shall progress the UE-initiated de-registration procedure;\n\tElse the network shall complete the identification procedure and shall respond to the UE-initiated de-registration procedure as described in subclause\u00a05.5.2.2.\n5.4.4\tGeneric UE configuration update procedure\n5.4.4.1\tGeneral\nThe purpose of this procedure is to:\na)\tallow the AMF to update the UE configuration for access and mobility management-related parameters decided and provided by the AMF by providing new parameter information within the command;\nb)\trequest the UE to perform a registration procedure for mobility and periodic registration update towards the network to update access and mobility management-related parameters decided and provided by the AMF (see subclause\u00a05.5.1.3);\nc)\tdeliver the UAV authorization information to the UE, as described in 3GPP\u00a0TS\u00a023.256\u00a0[6AB]; or\nd)\tupdate the PEIPS assistance information in the UE (see subclause\u00a05.3.25).\nThis procedure is initiated by the network and can only be used when the UE has an established 5GMM context, and the UE is in 5GMM-CONNECTED mode. When the UE is in 5GMM-IDLE mode, the AMF may use the paging or notification procedure to initiate the generic UE configuration update procedure. The AMF can request a confirmation response in order to ensure that the parameter has been updated by the UE.\nThis procedure shall be initiated by the network to assign a new 5G-GUTI to the UE after:\na)\ta successful service request procedure invoked as a response to a paging request from the network and before the:\n1)\trelease of the N1 NAS signalling connection; or\n2)\tsuspension of the N1 NAS signalling connection due to user plane CIoT 5GS optimization i.e. before the UE and the AMF enter 5GMM-IDLE mode with suspend indication; or\nb)\tthe AMF receives an indication from the lower layers that it has received the NGAP UE context resume request message as specified in 3GPP\u00a0TS\u00a038.413\u00a0[31] for a UE in 5GMM-IDLE mode with suspend indication and this resumption is a response to a paging request from the network, and before the:\n1)\trelease of the N1 NAS signalling connection; or\n2)\tsuspension of the N1 NAS signalling connection due to user plane CIoT 5GS optimization i.e. before the UE and the AMF enter 5GMM-IDLE mode with suspend indication.\nIf the service request procedure was triggered due to 5GSM downlink signalling pending, the procedure for assigning a new 5G-GUTI can be initiated by the network after the transport of the 5GSM downlink signalling.\nThe following parameters are supported by the generic UE configuration update procedure without the need to request the UE to perform the registration procedure for mobility and periodic registration update:\na)\t5G-GUTI;\nb)\tTAI list;\nc)\tService area list;\nd)\tNITZ information;\ne)\tLADN information;\ne1)\tExtended LADN information;\nf)\tRejected NSSAI;\nNOTE:\tA cause value associated with a rejected S-NSSAI can be included in the Rejected NSSAI IE or in the Extended rejected NSSAI IE and a back-off timer value associated with rejected S-NSSAI(s) can be included in the Extended rejected NSSAI IE.\ng)\tvoid;\nh)\tOperator-defined access category definitions;\ni)\tSMS indication;\nj)\t\"CAG information list\";\nk)\tUE radio capability ID;\nl)\t5GS registration result;\nm)\tTruncated 5G-S-TMSI configuration;\nn)\tT3447 value;\no)\t\"list of PLMN(s) to be used in disaster condition\";\np)\tdisaster roaming wait range;\nq)\tdisaster return wait range;\nr)\tPEIPS assistance information;\ns)\tPriority indicator; \nt)\tNSAG information;\nu)\tRAN timing synchronization;\nv)\tAlternative NSSAI; \nw)\tDiscontinuous coverage maximum time offset\nx)\tvoid;\ny)\tPartially rejected NSSAI; and\nz)\tOn-demand NSSAI.\nThe following parameters can be sent to the UE with or without a request to perform the registration procedure for mobility and periodic registration update:\na)\tAllowed NSSAI;\nb)\tConfigured NSSAI;\nc)\tNetwork slicing subscription change indication;\nd)\tNSSRG information;\ne)\tS-NSSAI location validity information;\ne1)\tS-NSSAI time validity information;\nf)\tfeature authorization indication; and\ng)\tPartially allowed NSSAI.\nThe following parameters are sent to the UE with a request to perform the registration procedure for mobility and periodic registration update:\na)\tMICO indication;\nb)\tUE radio capability ID deletion indication; and\nc)\tAdditional configuration indication.\nThe following parameters can be included in the Service-level-AA container IE to be sent to the UE without a request to perform the registration procedure for mobility and periodic registration update:\na)\tService-level device ID;\nb)\tService-level-AA payload type;\nc)\tService-level-AA payload;\nd)\tService-level-AA response; or\ne)\tService-level-AA service status indication.\nThe following parameters are sent over 3GPP access only:\na)\tLADN information;\na1)\tExtended LADN information;\nb)\tMICO indication;\nc)\tTAI list;\nd)\tService area list;\ne)\t\"CAG information list\";\nf)\tUE radio capability ID;\ng)\tUE radio capability ID deletion indication;\nh)\tTruncated 5G-S-TMSI configuration;\ni)\tAdditional configuration indication;\nj)\tT3447 value;\nk)\tService-level-AA container;\nl)\tNSAG information; and\nm)\tRAN timing synchronization.\no)\tS-NSSAI location validity information.\nThe following parameters are managed and sent per access type i.e., independently over 3GPP access or non-3GPP access:\na)\tAllowed NSSAI;\nb)\tRejected NSSAI (when the NSSAI is rejected for the current registration area or is rejected for the maximum number of UEs reached); and\nc)\tIf the UE is not registered to the same PLMN or SNPN over 3GPP and non-3GPP access:\n-\t5G-GUTI;\n-\tNITZ information;\n-\tRejected NSSAI (when the NSSAI is rejected for the current PLMN or SNPN or rejected for the failed or revoked NSSAA);\n-\tConfigured NSSAI;\n-\tNSSRG information;\n-\tSMS indication;\n-\t5GS registration result;\n-\tPEIPS assistance information; \n-\tMPS indicator;\n-\tS-NSSAI time validity information;\n-\tAlternative NSSAI; and\n-\tMCS indicator.\nIf the UE is registered to the same PLMN or SNPN over 3GPP and non-3GPP access, the following parameters are managed commonly and sent over 3GPP access or non-3GPP access:\na)\t5G-GUTI;\nb)\tNITZ information;\nc)\tRejected NSSAI (when the NSSAI is rejected for the current PLMN or SNPN or rejected for the failed or revoked NSSAA);\nd)\tConfigured NSSAI;\ne)\tSMS indication; and\nf)\t5GS registration result;\ng)\t\"list of PLMN(s) to be used in disaster condition\";\nh)\tdisaster roaming wait range;\ni)\tdisaster return wait range;\nj)\tPEIPS assistance information;\nk)\tNSSRG information;\nl)\tMPS indicator;\nm)\tS-NSSAI time validity information; and\nn)\tMCS indicator.\n\nFigure\u00a05.4.4.1.1: Generic UE configuration update procedure\n5.4.4.2\tGeneric UE configuration update procedure initiated by the network\nThe AMF shall initiate the generic UE configuration update procedure by sending the CONFIGURATION UPDATE COMMAND message to the UE.\nThe AMF shall in the CONFIGURATION UPDATE COMMAND message either:\na)\tinclude one or more of the following parameters: 5G-GUTI, TAI list, allowed NSSAI that may include the mapped S-NSSAI(s), LADN information, extended LADN information, service area list, MICO indication, NITZ information, configured NSSAI that may include the mapped S-NSSAI(s), NSSRG information, S-NSSAI location validity information, S-NSSAI time validity information, rejected S-NSSAI(s) in the Rejected NSSAI IE or in the Extended rejected NSSAI IE, network slicing subscription change indication, operator-defined access category definitions, SMS indication, \"CAG information list\", UE radio capability ID, 5GS registration result, UE radio capability ID deletion indication, truncated 5G-S-TMSI configuration, T3447 value, \"list of PLMN(s) to be used in disaster condition\", disaster roaming wait range, disaster return wait range, PEIPS assistance information, the priority indicator, the NSAG information, alternative NSSAI, partially allowed NSSAI, partially rejected NSSAI, on-demand NSSAI, feature authorization indication, or discontinuous coverage maximum time offset;\nb)\tinclude the Configuration update indication IE with the Registration requested bit set to \"registration requested\"; or\nc)\tinclude a combination of both a) and b).\nIf the UE is registering or registered for onboarding services in SNPN, the serving SNPN shall not provide the configured NSSAI, the allowed NSSAI or the rejected NSSAI to the UE.\nIf the UE supports extended rejected NSSAI, the rejected S-NSSAI(s) shall be included in the Extended rejected NSSAI IE. Otherwise, the rejected S-NSSAI(s) shall be included in the Rejected NSSAI IE.\nIn roaming scenarios, if the Extended rejected NSSAI IE is included in the CONFIGURATION UPDATE COMMAND message, the AMF shall provide mapped S-NSSAI(s) for the rejected NSSAI.\nIf an acknowledgement from the UE is requested, the AMF shall indicate \"acknowledgement requested\" in the Acknowledgement bit of the Configuration update indication IE in the CONFIGURATION UPDATE COMMAND message and shall start timer T3555. Acknowledgement shall be requested for all parameters except when only NITZ information is included.\nTo initiate parameter re-negotiation between the UE and network, the AMF shall indicate \"registration requested\" in the Registration requested bit of the Configuration update indication IE in the CONFIGURATION UPDATE COMMAND message.\nNOTE\u00a01:\tGeneric UE configuration update procedure can be initiated by the AMF for updating the emergency number list, the extended emergency number list or both by indicating \"registration requested\" in the Registration requested bit of the Configuration update indication IE in the CONFIGURATION UPDATE COMMAND message to the UE.\nIf a new allowed NSSAI information or AMF re-configuration of supported S-NSSAIs requires an AMF relocation, the AMF shall indicate \"registration requested\" in the Registration requested bit of the Configuration update indication IE and include the Allowed NSSAI IE in the CONFIGURATION UPDATE COMMAND message.\nIf the AMF includes a new allowed NSSAI in the CONFIGURATION UPDATE COMMAND message and the subscription information includes the NSSRG information, then the S-NSSAIs of the allowed NSSAI shall be associated with at least one common NSSRG value. If the network has pending NSSAI, the S-NSSAIs in the pending NSSAI and allowed NSSAI shall be associated with at least one common NSSRG value.\nIf the AMF includes a new partially allowed NSSAI and the new partially allowed NSSAI requires an AMF relocation, the AMF shall indicate \"registration requested\" in the Registration requested bit of the Configuration update indication IE and include the Partially allowed NSSAI IE in the CONFIGURATION UPDATE COMMAND message.\nIf the AMF includes a new configured NSSAI in the CONFIGURATION UPDATE COMMAND message and the new configured NSSAI requires an AMF relocation as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8], the AMF shall indicate \"registration requested\" in the Registration requested bit of the Configuration update indication IE in the message.\nIf the AMF includes a new configured NSSAI in the CONFIGURATION UPDATE COMMAND message, the subscription information includes the NSSRG information, and the UE has set the NSSRG bit in the 5GMM capability IE of the REGISTRATION REQUEST message to:\na)\t\"NSSRG supported\", then the AMF shall include the NSSRG information in the CONFIGURATION UPDATE COMMAND message; or\nb)\t\"NSSRG not supported\", then the configured NSSAI shall include one or more S-NSSAIs each of which is associated with all the NSSRG value(s) of the default S-NSSAI(s), or the configured NSSAI shall include, based on the indication received from the UDM as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8], all subscribed S-NSSAIs even if these S-NSSAIs do not share any common NSSRG value.\nIf the AMF needs to update the NSSRG information and the UE has set the NSSRG bit to \"NSSRG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, then the AMF shall include the new NSSRG information in the CONFIGURATION UPDATE COMMAND message.\nIf the AMF includes a new NSSRG information in the CONFIGURATION UPDATE COMMAND message and the AMF determines that the UE needs to provide a new requested NSSAI due to no NSSRG value common to all the S-NSSAI(s) of the allowed NSSAI based on the new NSSRG information, then the CONFIGURATION UPDATE COMMAND message shall indicate \"registration requested\" in the Registration requested bit of the Configuration update indication IE.\nIf the UE supports S-NSSAI time validity information and the AMF needs to update the S-NSSAI time validity information, then the AMF shall include the new S-NSSAI time validity information in the CONFIGURATION UPDATE COMMAND message.\nIf the AMF needs to update the S-NSSAI location validity information toward a UE which has set the SLVI bit to \"S-NSSAI location validity information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, then the AMF shall include the new S-NSSAI location validity information in the CONFIGURATION UPDATE COMMAND message.\nIf the CONFIGURATION UPDATE COMMAND message is initiated only due to changes to the allowed NSSAI and these changes require the UE to initiate a registration procedure, but the AMF is unable to determine an allowed NSSAI for the UE as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8], then the CONFIGURATION UPDATE COMMAND message shall indicate \"registration requested\" in the Registration requested bit of the Configuration update indication IE, and shall not contain any other parameters.\nIf the slice deregistration inactivity timer has expired, the UE does not support network slice usage control and the AMF removes the on-demand S-NSSAI from the allowed NSSAI over the corresponding access type, the AMF shall include the new allowed NSSAI in the CONFIGURATION UPDATE COMMAND message.\nIf:\n-\tthe AMF needs to enforce a change in the restriction on the use of enhanced coverage or use of CE mode B as described in subclause\u00a05.3.18; or\n-\tthe AMF decides to inform a UE in 5GMM-CONNECTED mode and registered for disaster roaming services, that a disaster condition is no longer applicable;\nNOTE\u00a01A:\tThe case of the AMF triggering a generic UE configuration update procedure to inform a UE registered for disaster roaming services that a disaster condition is no longer applicable, is only applicable for a UE already in 5GMM-CONNECTED mode.\nthe AMF shall indicate \"registration requested\" in the Registration requested bit of the Configuration update indication IE and \"release of N1 NAS signalling connection not required\" in the Signalling connection maintain request bit of the Additional configuration indication IE in the CONFIGURATION UPDATE COMMAND message.\nIf a network slice-specific authentication and authorization procedure for an S-NSSAI is completed as a:\na)\tsuccess, the AMF shall include this S-NSSAI in the allowed NSSAI over the same access of the requested S-NSSAI or in the partially allowed NSSAI over 3GPP access; or\nb)\tfailure, the AMF shall include this S-NSSAI in the rejected NSSAI for the failed or revoked NSSAA with the rejection cause \"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\" over either 3GPP access or non-3GPP access.\nIf authorization is revoked for an S-NSSAI that is in the current allowed NSSAI for an access type, the AMF shall:\na)\tprovide a new allowed NSSAI to the UE, excluding the S-NSSAI for which authorization is revoked; and\nb)\tprovide a new rejected NSSAI for the failed or revoked NSSAA, including the S-NSSAI in the rejected NSSAI for which the authorization is revoked, with the rejection cause \"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\".\nThe allowed NSSAI, the partially allowed NSSAI and the rejected NSSAI shall be included in the CONFIGURATION UPDATE COMMAND message to reflect the result of the procedures subject to network slice-specific authentication and authorization.\nNOTE\u00a02:\tIf there are multiple S-NSSAIs subject to network slice-specific authentication and authorization, it is implementation specific if the AMF informs the UE about the outcome of the procedures in one or more CONFIGURATION UPDATE COMMAND messages.\nIf the AMF includes the Network slicing indication IE in the CONFIGURATION UPDATE COMMAND message with the Network slicing subscription change indication set to \"Network slicing subscription changed\", and changes to the allowed NSSAI require the UE to initiate a registration procedure, but the AMF is unable to determine an allowed NSSAI for the UE as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8], then the CONFIGURATION UPDATE COMMAND message shall additionally indicate \"registration requested\" in the Registration requested bit of the Configuration update indication IE and shall not include an allowed NSSAI.\nIf EAC mode is activated for an S-NSSAI, the AMF shall perform NSAC for the S-NSSAI subject to NSAC before such S-NSSAI is included in the allowed NSSAI in the CONFIGURATION UPDATE COMMAND message. If EAC mode is deactivated for an S-NSSAI, the AMF shall perform NSAC for the S-NSSAI subject to NSAC after such S-NSSAI is included in the allowed NSSAI in the CONFIGURATION UPDATE COMMAND message.\nIf the UE supports extended rejected NSSAI and the AMF determines that maximum number of UEs reached for one or more S-NSSAI(s) in the allowed NSSAI as specified in subclause\u00a04.6.2.5, the AMF shall include the rejected NSSAI containing one or more S-NSSAIs with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\" in the Extended rejected NSSAI IE in the CONFIGURATION UPDATE COMMAND message. In addition, the AMF may include a back-off timer value for each S-NSSAI with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\" included in the Extended rejected NSSAI IE of the CONFIGURATION UPDATE COMMAND message. To avoid that large numbers of UEs simultaneously initiate deferred requests, the network should select the value for the backoff timer for each S-NSSAI for the informed UEs so that timeouts are not synchronised.\nIf the UE does not indicate support for extended rejected NSSAI and the maximum number of UEs has been reached, the AMF should include the rejected NSSAI containing one or more S-NSSAIs with the rejection cause \"S-NSSAI not available in the current registration area\" in the Rejected NSSAI IE and should not include these S-NSSAIs in the allowed NSSAI in the CONFIGURATION UPDATE COMMAND message. In addition, the AMF may based on the network policies start a local implementation specific timer for the UE per rejected S-NSSAI and upon expiration of the local implementation specific timer, the AMF may remove the rejected S-NSSAI from the rejected NSSAI and update to the UE by initiating the generic UE configuration update procedure.\nNOTE\u00a03:\tBased on network policies, the AMF can include the S-NSSAI(s) for which the maximum number of UEs has been reached in the rejected NSSAI with rejection causes other than \"S-NSSAI not available in the current registration area\".\nIf the UE has set the NSAG bit to \"NSAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the AMF may include the NSAG information IE in the CONFIGURATION UPDATE COMMAND message. Up to 4 NSAG entries are allowed to be associated with a TAI list in the NSAG information IE.\nNOTE\u00a03a:\tHow the AMF selects NSAG entries to be included in the NSAG information IE is implementation specific, e.g. take the NSAG priority and the current registration area into account.\nNOTE\u00a03b:\tIf the NSAG for the PLMN and its equivalent PLMN(s) have different associations with S-NSSAIs, then the AMF includes a TAI list for the NSAG entry in the NSAG information IE.\nIf the UE supports network slice replacement and the AMF determines to provide the mapping information between the S-NSSAI to be replaced and the alternative S-NSSAI to the UE, then the AMF shall include the Alternative NSSAI IE, the Allowed NSSAI IE including the alternative S-NSSAI, if not included in the current allowed NSSAI, and the Configured NSSAI IE including the alternative S-NSSAI, if not included in the current configured NSSAI, in the CONFIGURATION UPDATE COMMAND message. If the AMF determines that the S-NSSAI which has been replaced is available, then the AMF shall provide the updated alternative NSSAI excluding the S-NSSAI which has been replaced and the corresponding alternative S-NSSAI in the Alternative NSSAI IE in the CONFIGURATION UPDATE COMMAND message. If the AMF determines that all the S-NSSAI(s) which have been replaced are available, then the AMF shall provide the Alternative NSSAI IE with Length of Alternative NSSAI contents set to 0 in the CONFIGURATION UPDATE COMMAND message. If the AMF determines that the S-NSSAI which has been replaced is not supported due to the UE moving outside of NS-AoS of the S-NSSAI while the alternative S-NSSAI is available, then the AMF shall provide the updated allowed NSSAI excluding the S-NSSAI which has been replaced in the CONFIGURATION UPDATE COMMAND message.\nIf the UE supports partial network slice and the AMF needs to update the partially allowed NSSAI, partially rejected NSSAI or both, then the AMF shall include the Partially allowed NSSAI IE, the Partially rejected NSSAI IE or both, in the CONFIGURATION UPDATE COMMAND message.\nIf the UE supports network slice usage control and the AMF needs to update the on-demand NSSAI, the AMF shall include the On-demand NSSAI IE in the CONFIGURATION UPDATE COMMAND message.\nIf the AMF needs to update the LADN information, the AMF shall include the LADN information in the LADN information IE of the CONFIGURATION UPDATE COMMAND message.\nIf the UE supports LADN per DNN and S-NSSAI and the AMF needs to update the extended LADN information, the AMF shall include the extended LADN information in the Extended LADN information IE of the CONFIGURATION UPDATE COMMAND message.\nIf:\n-\tthe UE does not support LADN per DNN and S-NSSAI;\n-\tthe UE is subscribed to the LADN DNN for a single S-NSSAI only; and\n-\tthe AMF only has the extended LADN information;\nthe AMF may decide to provide the LADN service area for that LADN DNN of the extended LADN information as the LADN information and include the LADN information in the LADN information IE of the CONFIGURATION UPDATE COMMAND message.\nNOTE\u00a03c:\tIf the LADN service area is configured per DNN and S-NSSAI, in order to serve the UEs that do not support LADN per DNN and S-NSSAI, it is recommended that the LADN DNN is only served by a single S-NSSAI.\nNOTE\u00a03d:\tIn case of the UE is subscribed to the LADN DNN for multiple S-NSSAIs, the AMF can treat this as no extended LADN information is available.\nIf the UE does not support LADN per DNN and S-NSSAI and the AMF has neither the LADN information nor the extended LADN information, the AMF shall not provide any LADN information to the UE.\nIf the AMF needs to update the \"CAG information list\", the AMF shall include the CAG information list IE or the Extended CAG information list IE in the CONFIGURATION UPDATE COMMAND message. \nNOTE\u00a04:\tIf the UE supports extended CAG information list, the CAG information list can be included either in the CAG information list IE or Extended CAG information list IE.\nIf the UE does not support extended CAG information list, the CAG information list shall not be included in the Extended CAG information list IE.\nIf the AMF needs to update the \"CAG information list\", the UE has an emergency PDU session, and the AMF can determine that the UE is in\na)\ta CAG cell and none of the CAG-ID(s) supported by the CAG cell is authorized based on the \"allowed CAG list\" for the current PLMN in the updated \"CAG information list\"; or\nb)\ta non-CAG cell and the entry for the current PLMN in the updated \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\";\nthe AMF may indicate to the SMF to perform a local release of:\na)\tall non-emergency single access PDU sessions associated with 3GPP access;\nb)\tall MA PDU sessions without a PDN connection established as a user-plane resource and without user plane resources established on non-3GPP access; and \nc)\tthe 3GPP access user plane resources of all those MA PDU sessions with user plane resources established on both accesses.\nThe AMF shall not indicate to the SMF to release the emergency PDU session. If the AMF indicated to the SMF to perform a local release of:\na)\tall single access non-emergency PDU sessions associated with 3GPP access;\nb)\tall MA PDU sessions without a PDN connection established as a user-plane resource and without user plane resources established on non-3GPP access; and\nc)\tthe 3GPP access user plane resources of all those MA PDU sessions with user plane resources established on both accesses;\nthe network shall behave as if the UE is registered for emergency services over 3GPP access and shall set the emergency registered bit of the 5GS registration result IE to \"Registered for emergency services\" in the CONFIGURATION UPDATE COMMAND message.\nIf the AMF is initiating the generic UE configuration update procedure to indicate to a UE which is registered for disaster roaming services, and which has an ongoing emergency PDU session, that the UE is registered for emergency services as described in subclause\u00a04.24, the AMF shall set the emergency registered bit of the 5GS registration result IE to \"Registered for emergency services\" in the CONFIGURATION UPDATE COMMAND message. \nIf the AMF:\n-\tupdated the \"CAG information list\" to remove one or more CAG-ID(s) authorized based on the Allowed CAG list for the serving PLMN or an equivalent PLMN; or\n-\tupdated the \"CAG information list\" to set the \"indication that the UE is only allowed to access 5GS via CAG cells\" for the serving PLMN or an equivalent PLMN which was not set before,\nthen upon completion of the configuration update procedure and if the UE does not have an emergency PDU session, the AMF shall initiate the release of the N1 NAS signalling connection according to subclause\u00a05.3.1.3.\nIf the AMF needs to update the truncated 5G-S-TMSI configuration for a UE in NB-N1 mode using control plane CIoT 5GS optimization, the AMF shall include the Truncated 5G-S-TMSI configuration IE in the CONFIGURATION UPDATE COMMAND message.\nIf the AMF includes a UE radio capability ID deletion indication IE in the CONFIGURATION UPDATE COMMAND message, the AMF shall indicate \"registration requested\" in the Registration requested bit of the Configuration update indication IE.\nIf the AMF needs to redirect the UE to EPC as described in subclause\u00a04.8.4A.2, the AMF shall indicate \"registration requested\" in the Registration requested bit of the Configuration update indication IE and \"release of N1 NAS signalling connection not required\" in the Signalling connection maintain request bit of the Additional configuration indication IE in the CONFIGURATION UPDATE COMMAND message.\nIf the UE is not in NB-N1 mode and the UE supports RACS, the AMF may include either a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the CONFIGURATION UPDATE COMMAND message.\nDuring an established 5GMM context, the network may send none, one, or more CONFIGURATION UPDATE COMMAND messages to the UE. If more than one CONFIGURATION UPDATE COMMAND message is sent, the messages need not have the same content.\nUpon receipt of the result of the UUAA-MM procedure from the UAS-NF, the AMF shall include:\na)\tthe service-level-AA response with the SLAR field set to:\n1)\t\"Service level authentication and authorization was successful\" if the AMF detects the UUAA-MM procedure has succeeded; or\n2)\t\"Service level authentication and authorization was not successful or service level authorization is revoked\" if the AMF detects the UUAA-MM procedure has failed;\nb)\tif the CAA-Level UAV ID is provided by the UAS-NF, the service-level device ID with the value set to the CAA-Level UAV ID; and;\nc)\tif a payload is received from the UAS-NF:\n1)\tthe service-level-AA payload with the value set to the payload; and\n2)\tif a payload type associated with the payload is received, the service-level-AA payload type with the values set to the payload type; and\n3)\tif the payload type associated with the payload is for C2 authorization payload, the service-level-AA response with C2AR field set to either \"C2 authorization was successful\" or \"C2 authorization was not successful or C2 authorization is revoked\" according to the authorization result received from the UAS-NF;\nin the Service-level-AA container IE of the CONFIGURATION UPDATE COMMAND message.\nNOTE\u00a05:\tUAS security information can be included in the UUAA payload by the USS as specified in 3GPP\u00a0TS\u00a033.256\u00a0[24B].\nNOTE\u00a05A:\tThe service-level-AA payload associated with the payload type \"C2 authorization payload\" can include pairing information for the direct C2 communication, or the security information as specified in TS 33.256 [24B], or both.\nNOTE\u00a06:\tIf the AMF receives the HTTP code set to \"4xx\" or \"5xx\" as specified in 3GPP\u00a0TS\u00a029.500\u00a0[20AA] or the AMF detects that the UUAA-MM failure as specified in 3GPP\u00a0TS\u00a029.256\u00a0[21B], then the AMF considers the UUAA-MM procedure has failed.\nIf the AMF needs to deliver to the UE the UUAA revocation notification received from the UAS-NF, the AMF shall include the service-level-AA response with SLAR set to \"Service level authentication and authorization was not successful or service level authorization is revoked\" in the Service-level-AA container IE of the CONFIGURATION UPDATE COMMAND message.\nIf the UE supports UAS services and UAS services become enabled for the UE (e.g. because of the aerial subscription becomes a part of the UE subscription data retrieved from the UDM), the AMF may include the service-level-AA service status indication with UAS field set to \"UAS services enabled\" in the Service-level-AA container IE of the CONFIGURATION UPDATE COMMAND message.\nIf the UE supports MINT, the AMF may include the List of PLMNs to be used in disaster condition IE in the CONFIGURATION UPDATE COMMAND message.\nIf the UE supports MINT, the AMF may include the Disaster roaming wait range IE in the CONFIGURATION UPDATE COMMAND message.\nIf the UE supports MINT, the AMF may include the Disaster return wait range IE in the CONFIGURATION UPDATE COMMAND message.\nNOTE\u00a07:\tThe AMF can determine the content of the \"list of PLMN(s) to be used in disaster condition\", the value of the disaster roaming wait range and the value of the disaster return wait range based on the network local configuration.\nIf the UE supports discontinuous coverage, the AMF may include the Discontinuous coverage maximum time offset IE in the CONFIGURATION UPDATE COMMAND message.\nIf the UE supports and the network supports and accepts the use of the PEIPS assistance information, and the AMF needs to update the PEIPS assistance information, the AMF may include the PEIPS assistance information in the Updated PEIPS assistance information IE of the CONFIGURATION UPDATE COMMAND message.\nIf the AMF needs to inform the UE that the use of access identity 1 is valid or is no longer valid, then,\n1)\tif the UE supports MPS indicator update via the UE configuration update procedure, the AMF:\na)\tinforms the UE by setting the MPS indicator bit of the Priority indicator IE to \"Access identity 1 valid\" or \"Access identity 1 not valid\" respectively, in the CONFIGURATION UPDATE COMMAND message. Based on operator policy, the AMF sets the MPS indicator bit in the CONFIGURATION UPDATE COMMAND message based on the MPS priority information in the user's subscription context obtained from the UDM; or\nb)\tindicates \"registration requested\" in the Registration requested bit of the Configuration update indication IE in the CONFIGURATION UPDATE COMMAND message; or\n2)\tif the UE supports MCS indicator update via the UE configuration update procedure, the AMF:\na)\tinforms the UE by setting the MCS indicator bit of the Priority indicator IE to \"Access identity 2 valid\" or \"Access identity 2 not valid\" respectively, in the CONFIGURATION UPDATE COMMAND message. Based on operator policy, the AMF sets the MCS indicator bit in the CONFIGURATION UPDATE COMMAND message based on the MCS priority information in the user's subscription context obtained from the UDM; or\nb)\tindicates \"registration requested\" in the Registration requested bit of the Configuration update indication IE in the CONFIGURATION UPDATE COMMAND message; or\n3)\totherwise, the AMF shall indicate \"registration requested\" in the Registration requested bit of the Configuration update indication IE in the CONFIGURATION UPDATE COMMAND message.\nIf the UE has set the Reconnection to the network due to RAN timing synchronization status change (RANtiming) bit to \"Reconnection to the network due to RAN timing synchronization status change supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the AMF may include the RAN timing synchronization IE with the RecReq bit set to \"Reconnection requested\" in the CONFIGURATION UPDATE COMMAND message.\nWhen the UE is operating as an MBSR and its status of the MBSR authorization changes to not authorized for MBSR operation based on the UE subscription and local policy and the UE is allowed to operate as a UE, then the AMF shall include the Feature authorization indication IE in the CONFIGURATION UPDATE COMMAND message and shall set the MBSRAI field to \"not authorized to operate as MBSR but allowed to operate as a UE\", and the AMF can request the SMF to release the PDU session for OAM access (see 3GPP\u00a0TS\u00a023.501\u00a0[8]) provided in the serving PLMN. When the UE that was not allowed for MBSR operation becomes to be allowed for MBSR operation based on the UE subscription and local policy, then the AMF shall include the Feature authorization indication IE in the CONFIGURATION UPDATE COMMAND message and shall set the MBSRAI field to \"authorized to operate as MBSR\"\n5.4.4.3\tGeneric UE configuration update accepted by the UE\nUpon receiving the CONFIGURATION UPDATE COMMAND message, the UE shall stop timer T3346 if running and use the contents to update appropriate information stored within the UE.\nIf \"acknowledgement requested\" is indicated in the Acknowledgement bit of the Configuration update indication IE in the CONFIGURATION UPDATE COMMAND message, the UE shall send a CONFIGURATION UPDATE COMPLETE message.\nIf the UE receives a new 5G-GUTI in the CONFIGURATION UPDATE COMMAND message, the UE shall consider the new 5G-GUTI as valid, the old 5G-GUTI as invalid, stop timer T3519 if running, and delete any stored SUCI; otherwise, the UE shall consider the old 5G-GUTI as valid. The UE shall provide the 5G-GUTI to the lower layer of 3GPP access if the CONFIGURATION UPDATE COMMAND message is sent over the non-3GPP access, and the UE is in 5GMM-REGISTERED in both 3GPP access and non-3GPP access in the same PLMN.\nIf the UE receives a new TAI list in the CONFIGURATION UPDATE COMMAND message, the UE shall consider the new TAI list as valid and the old TAI list as invalid; otherwise, the UE shall consider the old TAI list as valid. If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, and\na)\tthe UE already has stored allowed NSSAI for the current registration area, the UE shall store the allowed NSSAI for the current registration area in each of the allowed NSSAIs which are associated with each of the PLMNs in the registration area;\nb)\tthe UE already has stored rejected NSSAI for the current registration area, the UE shall store the rejected NSSAI for the current registration area in each of the rejected NSSAIs which are associated with each of the PLMNs in the registration area;\nc)\tthe UE already has stored rejected NSSAI for the failed or revoked NSSAA, the UE shall store the rejected NSSAI for the failed or revoked NSSAA in each of the rejected NSSAIs which are associated with each of the PLMNs in the registration area;\nd)\tthe UE already has stored rejected NSSAI for the maximum number of UEs reached, the UE shall store the rejected NSSAI for the maximum number of UEs reached in each of the rejected NSSAIs which are associated with each of the PLMNs in the registration area; and\ne)\tthe UE already has stored pending NSSAI, the UE shall store the pending NSSAI in each of the pending NSSAIs which are associated with each of the PLMNs in the registration area.\nIf the UE receives a new truncated 5G-S-TMSI configuration in the CONFIGURATION UPDATE COMMAND message, the UE shall consider the new truncated 5G-S-TMSI configuration as valid and the old truncated 5G-S-TMSI configuration as invalid; otherwise, the UE shall consider the old truncated 5G-S-TMSI configuration as valid.\nIf the UE receives a new service area list in the CONFIGURATION UPDATE COMMAND message, the UE shall consider the new service area list as valid and the old service area list as invalid; otherwise, the UE shall consider the old service area list, if any, as valid.\nIf the UE receives new NITZ information in the CONFIGURATION UPDATE COMMAND message, the UE considers the new NITZ information as valid and the old NITZ information as invalid; otherwise, the UE shall consider the old NITZ information as valid.\nIf the UE receives a LADN information IE in the CONFIGURATION UPDATE COMMAND message, the UE shall consider the old LADN information as invalid and the new LADN information as valid, if any; otherwise, the UE shall consider the old LADN information as valid.\nIf the UE receives an Extended LADN information IE in the CONFIGURATION UPDATE COMMAND message, the UE shall consider the old extended LADN information as invalid and the new extended LADN information as valid, if any; otherwise, the UE shall consider the old extended LADN information as valid.\nIf the UE receives a new allowed NSSAI for the associated access type in the CONFIGURATION UPDATE COMMAND message, the UE shall consider the new allowed NSSAI as valid for the associated access type, store the allowed NSSAI for the associated access type as specified in subclause\u00a04.6.2.2 and consider the old allowed NSSAI for the associated access type as invalid; otherwise, the UE shall consider the old allowed NSSAI as valid for the associated access type.\nIf the UE receives a new configured NSSAI in the CONFIGURATION UPDATE COMMAND message, the UE shall consider the new configured NSSAI for the registered PLMN or SNPN as valid and the old configured NSSAI for the registered PLMN or SNPN as invalid; otherwise, the UE shall consider the old configured NSSAI for the registered PLMN or SNPN as valid. The UE shall store the new configured NSSAI as specified in subclause\u00a04.6.2.2. In addition, if the CONFIGURATION UPDATE COMMAND message contains:\na)\tan NSSRG information IE, the UE shall store the contents of the NSSRG information IE as specified in subclause\u00a04.6.2.2. If the UE receives a new configured NSSAI in the CONFIGURATION UPDATE COMMAND message and no NSSRG information IE, the UE shall delete any stored NSSRG information, if any, as specified in subclause\u00a04.6.2.2;\nNOTE\u00a01:\tWhen the UE receives the NSSRG information IE, the UE may provide the NSSRG information to lower layers for the purpose of NSAG-aware cell reselection.\nb)\tan S-NSSAI location validity information IE, the UE shall store the contents of the S-NSSAI location validity information IE as specified in subclause\u00a04.6.2.2. If the UE receives a new configured NSSAI in the CONFIGURATION UPDATE COMMAND message and no S-NSSAI location validity information IE, the UE shall delete any stored S-NSSAI location validity information, if any, as specified in subclause\u00a04.6.2.2;\nc)\tan S-NSSAI time validity information IE, the UE shall store the contents of the S-NSSAI time validity information IE as specified in subclause\u00a04.6.2.2. If the UE receives a new configured NSSAI in the CONFIGURATION UPDATE COMMAND message and no S-NSSAI time validity information IE, the UE shall delete any stored S-NSSAI time validity information, if any, as specified in subclause\u00a04.6.2.2; or\nd)\tan On-demand NSSAI IE, the UE shall store the contents of the On-demand NSSAI IE as specified in subclause\u00a04.6.2.2. If the UE receives a new Configured NSSAI IE in the CONFIGURATION UPDATE COMMAND message and no On-demand NSSAI IE, the UE shall delete any stored on-demand NSSAI as specified in subclause\u00a04.6.2.2. The UE shall stop slice deregistration inactivity timer, if running for the S-NSSAI which is deleted from the on-demand NSSAI.\nIf the CONFIGURATION UPDATE COMMAND message contains Partially allowed NSSAI IE the UE shall store the contents of the Partially allowed NSSAI IE as specified in subclause\u00a04.6.2.2. If the CONFIGURATION UPDATE COMMAND message contains Partially rejected NSSAI IE the UE shall store the contents of the Partially rejected NSSAI IE as specified in subclause\u00a04.6.2.2.\nIf the UE receives the Network slicing indication IE in the CONFIGURATION UPDATE COMMAND message with the Network slicing subscription change indication set to \"Network slicing subscription changed\", the UE shall delete the network slicing information for each and every PLMN or SNPN except for the current PLMN or SNPN as specified in subclause\u00a04.6.2.2 and remove all tracking areas from the list of \"5GS forbidden tracking areas for roaming\" which were added due to rejection of S-NSSAI due to \"S-NSSAI not available in the current registration area\".\nIf the UE receives Operator-defined access category definitions IE in the CONFIGURATION UPDATE COMMAND message and the Operator-defined access category definitions IE contains one or more operator-defined access category definitions, the UE shall delete any operator-defined access category definitions stored for the RPLMN and shall store the received operator-defined access category definitions for the RPLMN. If the UE receives the Operator-defined access category definitions IE in the CONFIGURATION UPDATE COMMAND message and the Operator-defined access category definitions IE contains no operator-defined access category definitions, the UE shall delete any operator-defined access category definitions stored for the RPLMN. If the CONFIGURATION UPDATE COMMAND message does not contain the Operator-defined access category definitions IE, the UE shall not delete the operator-defined access category definitions stored for the RPLMN.\nIf the UE receives the SMS indication IE in the CONFIGURATION UPDATE COMMAND message with the SMS availability indication set to:\na)\t\"SMS over NAS not available\", the UE shall consider that SMS over NAS transport is not allowed by the network; and\nb)\t\"SMS over NAS available\", the UE may request the use of SMS over NAS transport by performing a registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3, after the completion of the generic UE configuration update procedure.\nIf the UE receives the CAG information list IE or the Extended CAG information list IE in the CONFIGURATION UPDATE COMMAND message, the UE shall:\na)\treplace the \"CAG information list\" stored in the UE with the received CAG information list IE or the Extended CAG information list IE when received in the HPLMN or EHPLMN;\nNOTE\u00a02:\tWhen the UE receives the CAG information list IE or the Extended CAG information list IE in the HPLMN whose PLMN code is derived from the IMSI, the EHPLMN list is present and is not empty and the HPLMN is not present in the EHPLMN list, the UE behaves as if it receives the CAG information list IE or the Extended CAG information list IE in a VPLMN.\nb)\treplace the serving VPLMN's entry of the \"CAG information list\" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; or\nNOTE\u00a03:\tWhen the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored.\nc)\tremove the serving VPLMN's entry of the \"CAG information list\" stored in the UE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry.\nThe UE shall store the \"CAG information list\" received in the CAG information list IE or the Extended CAG information list IE as specified in annex\u00a0C.\nIf the received \"CAG information list\" includes an entry containing the identity of the current PLMN and the UE had set the CAG bit to \"CAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the UE shall operate as follows.\na)\tIf the UE receives the CONFIGURATION UPDATE COMMAND message via a CAG cell, none of the CAG-ID(s) supported by the current CAG cell is authorized based on the \"Allowed CAG list\" of the entry for the current PLMN in the received \"CAG information list\", and:\n1)\tthe entry for the current PLMN in the received \"CAG information list\" does not include an \"indication that the UE is only allowed to access 5GS via CAG cells\", then the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\"; or\n2)\tthe entry for the current PLMN in the received \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and:\ni)\tif one or more CAG-ID(s) are authorized based on the \"Allowed CAG list\" of the entry for the current PLMN in the received \"CAG information list\", the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] with the updated \"CAG information list\"; or\nii)\tif no CAG-ID is authorized based on the \"Allowed CAG list\" of the entry for the current PLMN in the received \"CAG information list\" and:\nA)\tthe UE does not have an emergency PDU session, then the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP TS 23.122 [5] with the updated \"CAG information list\"; or\nB)\tthe UE has an emergency PDU session, then the UE shall perform a local release of all PDU sessions associated with 3GPP access except for the emergency PDU session and enter the state 5GMM-REGISTERED.LIMITED-SERVICE; or\nb)\tIf the UE receives the CONFIGURATION UPDATE COMMAND message via a non-CAG cell and the entry for the current PLMN in the received \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and:\n1)\tif one or more CAG-ID(s) are authorized based on the \"allowed CAG list\" for the current PLMN in the received \"CAG information list\", the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] with the updated \"CAG information list\"; or\n2)\tif no CAG-ID is authorized based on the \"Allowed CAG list\" of the entry for the current PLMN in the received \"CAG information list\"and:\ni)\tthe UE does not have an emergency PDU session, then the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP TS 23.122 [5] with the updated \"CAG information list\"; or\nii)\tthe UE has an emergency PDU session, then the UE shall perform a local release of all PDU sessions associated with 3GPP access except for the emergency PDU session and enter the state 5GMM-REGISTERED.LIMITED-SERVICE.\nIf the received \"CAG information list\" does not include an entry containing the identity of the current PLMN and the UE receives the CONFIGURATION UPDATE COMMAND message via a CAG cell, the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\".\nIf the CONFIGURATION UPDATE COMMAND message indicates \"registration requested\" in the Registration requested bit of the Configuration update indication IE and:\na)\tcontains no other parameters or contains at least one of the following parameters: a new allowed NSSAI, a new partially allowed NSSAI, a new configured NSSAI, a new NSSRG information or the Network slicing subscription change indication, and:\n1)\tan emergency PDU session exists, the UE shall, after the completion of the generic UE configuration update procedure and the release of the emergency PDU session, release the existing N1 NAS signalling connection. Additionally, the UE shall:\ni)\tif any Tsor-cm timer(s) were running and have stopped, attempt to obtain service on a higher priority PLMN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]); or\nii)\tin all other cases, start a registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3; or\n2)\tno emergency PDU Session exists, the UE shall, after the completion of the generic UE configuration update procedure and the release of the existing N1 NAS signalling connection:\ni)\tif any Tsor-cm timer(s) were running and have stopped, attempt to obtain service on a higher priority PLMN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]); or\nii)\tin all other cases, start a registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3;\nb)\ta MICO indication is included without a new allowed NSSAI, a new configured NSSAI, a new NSSRG information or the Network slicing subscription change indication, the UE shall, after the completion of the generic UE configuration update procedure, start a periodic registration procedure for mobility and registration update as specified in subclause\u00a05.5.1.3 to re-negotiate MICO mode with the network;\nc)\tan Additional configuration indication IE is included, and:\n1)\t\"release of N1 NAS signalling connection not required\" is indicated in the Signalling connection maintain request bit of the Additional configuration indication IE; and\n2)\ta new allowed NSSAI, a new configured NSSAI, a new NSSRG information or the Network slicing subscription change indication is not included in the CONFIGURATION UPDATE COMMAND message,\n\tthe UE shall, after the completion of the generic UE configuration update procedure, start a registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3; or\nd)\ta UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\" is included, and:\n1)\tthe UE is not in NB-N1 mode;\n2)\ta new allowed NSSAI, a new configured NSSAI, a new NSSRG information or a Network slicing subscription change indication is not included; and\n3)\tthe UE has set the RACS bit to \"RACS supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message,\n\tthe UE shall, after the completion of the generic UE configuration update procedure, start a registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3.\nThe UE receiving the rejected NSSAI in the CONFIGURATION UPDATE COMMAND message takes the following actions based on the rejection cause in the rejected S-NSSAI(s):\n\"S-NSSAI not available in the current PLMN or SNPN\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN or SNPN as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current PLMN or SNPN over any access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\"S-NSSAI not available in the current registration area\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current registration area over the current access until switching off the UE, the UE moving out of the current registration area, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over any access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.1 and 4.6.2.2.\n\"S-NSSAI not available due to maximum number of UEs reached\"\n\tUnless the back-off timer value received along with the S-NSSAI is zero, the UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over the current access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclauses\u00a04.6.1 and\u00a04.6.2.2.\nNOTE\u00a04:\tIf the back-off timer value received along with the S-NSSAI in the rejected NSSAI for the maximum number of UEs reached is zero as specified in subclause\u00a010.5.7.4a of 3GPP\u00a0TS\u00a024.008\u00a0[12], the UE does not consider the S-NSSAI as the rejected S-NSSAI.\nIf there is one or more S-NSSAIs in the rejected NSSAI with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\", then for each S-NSSAI, the UE shall behave as follows:\na)\tstop the timer T3526 associated with the S-NSSAI, if running;\nb)\tstart the timer T3526 with:\n1)\tthe back-off timer value received along with the S-NSSAI, if back-off timer value is received along with the S-NSSAI that is neither zero nor deactivated; or\n2)\tan implementation specific back-off timer value, if no back-off timer value is received along with the S-NSSAI; and\nc)\tremove the S-NSSAI from the rejected NSSAI for the maximum number of UEs reached when the timer T3526 associated with the S-NSSAI expires.\nIf the UE receives the NSAG information IE in the CONFIGURATION UPDATE COMMAND message, the UE shall store the NSAG information as specified in subclause\u00a04.6.2.2.\nIf the UE receives the Alternative NSSAI IE in the CONFIGURATION UPDATE COMMAND message, the UE shall store the alternative NSSAI as specified in subclause\u00a04.6.2.2.\nIf the UE receives the On-demand NSSAI IE in the CONFIGURATION UPDATE COMMAND message, the UE shall store the on-demand NSSAI as specified in subclause\u00a04.6.2.2.\nIf the UE receives a T3447 value IE in the CONFIGURATION UPDATE COMMAND message and has indicated \"service gap control supported\" in the REGISTRATION REQUEST, then the UE shall replace the stored T3447 value with the received value in the T3447 value IE, and if neither zero nor deactivated use the received T3447 value with the timer T3447 next time it is started. If the received T3447 value is zero or deactivated, then the UE shall stop the timer T3447 if running.\nIf the UE is not in NB-N1 mode, the UE has set the RACS bit to \"RACS supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and the CONFIGURATION UPDATE COMMAND message includes:\na)\ta UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\", the UE shall delete any network-assigned UE radio capability IDs associated with the RPLMN or RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription stored at the UE; or\nb)\ta UE radio capability ID IE, the UE shall store the UE radio capability ID as specified in annex\u00a0C.\nIf the UE is not currently registered for emergency services and the emergency registered bit of the 5GS registration result IE in the CONFIGURATION UPDATE COMMAND message is set to \"Registered for emergency services\", the UE shall consider itself registered for emergency services and shall locally release all non-emergency PDU sessions, if any.\nIf the UE receives the service-level-AA container IE of the CONFIGURATION UPDATE COMMAND message, the UE passes it to the upper layer.\nNOTE\u00a05:\tThe service-level-AA container IE can include a service-level-AA payload of type \"C2 authorization payload\" that includes pairing information for the direct C2 communication, or the security information as specified in TS 33.256 [24B], or both.\nIf the CONFIGURATION UPDATE COMMAND message includes the service-level-AA response in the Service-level-AA container IE with the SLAR field set to \"Service level authentication and authorization was not successful or service level authorization is revoked\", the UE shall forward the service-level-AA response to the upper layers, so the UUAA authorization data is deleted as specified in 3GPP\u00a0TS\u00a033.256\u00a0[24B].\nIf the UE receives the List of PLMNs to be used in disaster condition IE in the CONFIGURATION UPDATE COMMAND message and the UE supports MINT, the UE shall delete the \"list of PLMN(s) to be used in disaster condition\" stored in the ME together with the PLMN ID of the RPLMN, if any, and may store the \"list of PLMN(s) to be used in disaster condition\" included in the List of PLMNs to be used in disaster condition IE in the ME together with the PLMN ID of the RPLMN.\nIf the UE receives the Disaster roaming wait range IE in the CONFIGURATION UPDATE COMMAND message and the UE supports MINT, the UE shall delete the disaster roaming wait range stored in the ME, if any, and store the disaster roaming wait range included in the Disaster roaming wait range IE in the ME.\nIf the UE receives the Disaster return wait range IE in the CONFIGURATION UPDATE COMMAND message and the UE supports MINT, the UE shall delete the disaster roaming wait range stored in the ME, if any, and store the disaster roaming wait range included in the Disaster roaming wait range IE in the ME.\nIf the UE receives, the Discontinuous coverage maximum time offset IE in the CONFIGURATION UPDATE COMMAND message, the UE shall replace any previously received discontinuous coverage maximum time offset value on the same satellite NG-RAN RAT type and PLMN with the latest received timer value.\nIf the UE receives the Updated PEIPS assistance information IE in the CONFIGURATION UPDATE COMMAND message and the UE supports NR paging subgrouping, the UE shall use the PEIPS assistance information included in the Updated PEIPS assistance information IE.\nIf the UE receives a CONFIGURATION UPDATE COMMAND message with the MPS indicator bit in the Priority indicator IE set to \"Access identity 1 valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same PLMN or SNPN over 3GPP access and non-3GPP access;\nthe UE shall act as a UE with access identity 1 configured for MPS, as described in subclause\u00a04.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs or in the case of SNPN, as described in subclause\u00a04.5.2A, in all NG-RAN of the registered SNPN and its equivalent SNPNs.\nIf the UE receives a CONFIGURATION UPDATE COMMAND message with the MPS indicator bit in the Priority indicator IE set to \"Access identity 1 valid\":\n-\tvia non-3GPP access; or \n-\tvia 3GPP access if the UE is registered to the same PLMN or SNPN over 3GPP access and non-3GPP access; \nthe UE shall act as a UE with access identity 1 configured for MPS, as described in subclause\u00a04.5.2, in non-3GPP access of the registered PLMN and its equivalent PLMNs or in the case of SNPN, as described in subclause\u00a04.5.2A, in non-3GPP access of the registered SNPN and its equivalent SNPNs.\nThe MPS indicator bit in the Priority indicator IE provided in the CONFIGURATION UPDATE COMMAND message is valid:\n-\tin all NG-RAN of the registered PLMN and its equivalent PLMNs, or in the case of SNPN in all NG-RAN of the registered SNPN and its equivalent SNPNs, until:\n-\tthe UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 not valid\" or the UE receives a CONFIGURATION UPDATE COMMAND message with the MPS indicator bit of the Priority indicator IE set to \"Access identity 1 not valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same PLMN or SNPN over 3GPP access and non-3GPP access; or\n-\tthe UE selects a non-equivalent PLMN (or in the case of SNPN, selects a non-equivalent SNPN); or\n-\tin non-3GPP access of the registered PLMN and its equivalent PLMNs, or in the case of SNPN in non-3GPP access of the registered SNPN and its equivalent SNPNs, until:\n-\tthe UE receives a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 not valid\" or the UE receives a CONFIGURATION UPDATE COMMAND message with the MPS indicator bit of the Priority indicator IE set to \"Access identity 1 not valid\":\n-\tvia non-3GPP access; or\n-\tvia 3GPP access if the UE is registered to the same PLMN or SNPN over 3GPP access and non-3GPP access; or\n-\tthe UE selects a non-equivalent PLMN (or in the case of SNPN, selects a non-equivalentSNPN).\nAccess identity 1 is only applicable while the UE is in N1 mode.\nIf the UE receives a CONFIGURATION UPDATE COMMAND message with the MCS indicator bit in the Priority indicator IE set to \"Access identity 2 valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same PLMN or SNPN over 3GPP access and non-3GPP access;\nthe UE shall act as a UE with access identity 2 configured for MCS, as described in subclause\u00a04.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs or in the case of SNPN, as described in subclause\u00a04.5.2A, in all NG-RAN of the registered SNPN and its equivalent SNPNs.\nIf the UE receives a CONFIGURATION UPDATE COMMAND message with the MCS indicator bit in the Priority indicator IE set to \"Access identity 2 valid\":\n-\tvia non-3GPP access; or \n-\tvia 3GPP access if the UE is registered to the same PLMN or SNPN over 3GPP access and non-3GPP access; \nthe UE shall act as a UE with access identity 2 configured for MCS, as described in subclause\u00a04.5.2, in non-3GPP access of the registered PLMN and its equivalent PLMNs or in the case of SNPN, as described in subclause\u00a04.5.2A, in non-3GPP access of the registered SNPN and its equivalent SNPNs.\nThe MCS indicator bit in the Priority indicator IE provided in the CONFIGURATION UPDATE COMMAND message is valid:\n-\tin all NG-RAN of the registered PLMN and its equivalent PLMNs, or in the case of SNPN in all NG-RAN of the registered SNPN and its equivalent SNPNs, until:\n-\tthe UE receives a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 not valid\" or the UE receives a CONFIGURATION UPDATE COMMAND message with the MCS indicator bit of the Priority indicator IE set to \"Access identity 2 not valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same PLMN or SNPN over 3GPP access and non-3GPP access; or\n-\tthe UE selects a non-equivalent PLMN (or in the case of SNPN, selects a non-equivalent SNPN); or\n-\tin non-3GPP access of the registered PLMN and its equivalent PLMNs, or in the case of SNPN in non-3GPP access of the registered SNPN and its equivalent SNPNs, until:\n-\tthe UE receives a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 not valid\" or the UE receives a CONFIGURATION UPDATE COMMAND message with the MCS indicator bit of the Priority indicator IE set to \"Access identity 2 not valid\":\n-\tvia non-3GPP access; or\n-\tvia 3GPP access if the UE is registered to the same PLMN or SNPN over 3GPP access and non-3GPP access; or\n-\tthe UE selects a non-equivalent PLMN (or in the case of SNPN, selects a non-equivalentSNPN).\nAccess identity 2 is only applicable while the UE is in N1 mode.\nIf the UE supporting UAS services is not currently registered for UAS services and the CONFIGURATION UPDATE COMMAND message includes the service-level-AA service status indication in the Service-level-AA container IE with the UAS field set to \"UAS services enabled\", then the UE passes the service-level-AA service status indication to the upper layers.\nIf the UE supporting the reconnection to the network due to RAN timing synchronization status change receives the RAN timing synchronization IE with the RecReq bit set to \"Reconnection requested\" in the CONFIGURATION UPDATE COMMAND message, the UE shall operate as specified in subclauses\u00a05.3.1.4, 5.5.1.3.2, and 5.6.1.1.\nIf the UE operating as MBSR receives the MBSRAI field of the Feature authorization indication IE in the CONFIGURATION UPDATE COMMAND message, the UE NAS layer informs the lower layers of the status of MBSR authorization.\n5.4.4.4\tGeneric UE configuration update completion by the network\nUpon receipt of the CONFIGURATION UPDATE COMPLETE message, the AMF shall stop the timer T3555.\nIf a new 5G-GUTI was included in the CONFIGURATION UPDATE COMMAND message, the AMF shall consider the new 5G-GUTI as valid and the old 5G-GUTI as invalid.\nIf a new TAI list was included in the CONFIGURATION UPDATE COMMAND message, the AMF shall consider the new TAI list as valid and the old TAI list as invalid.\nIf a new truncated 5G-S-TMSI configuration was included in the CONFIGURATION UPDATE COMMAND message, the AMF shall consider the new truncated 5G-S-TMSI configuration as valid and the old truncated 5G-S-TMSI configuration as invalid.\nIf a new service area list was included in the CONFIGURATION UPDATE COMMAND message, the AMF shall consider the new service area list as valid and the old service area list as invalid.\nIf new allowed NSSAI information was included in the CONFIGURATION UPDATE COMMAND message, the AMF shall consider the new allowed NSSAI information as valid and the old allowed NSSAI information as invalid. If new configured NSSAI information was included in the CONFIGURATION UPDATE COMMAND message, the AMF shall consider the new configured NSSAI information as valid and the old configured information as invalid. If there are active PDU sessions associated with S-NSSAI(s) not included in the new allowed NSSAI, the AMF shall notify the SMF(s) associated with these PDU sessions to initiate the network-requested PDU session release procedure according to subclause\u00a06.3.3 in the present specification and subclause\u00a05.15.5.2.2 in 3GPP\u00a0TS\u00a023.501\u00a0[8].\nIf \"registration requested\" was indicated in the Registration requested bit of the Configuration update indication IE in the CONFIGURATION UPDATE COMMAND message and:\na)\tthe CONFIGURATION UPDATE COMMAND message contained:\n1)\tan allowed NSSAI, a configured NSSAI or both;\n2)\tthe Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\"; or\n3)\tno other parameters; and\nb)\tno emergency PDU session has been established for the UE;\nthen the AMF shall initiate the release of the N1 NAS signalling connection.\nIf an LADN information IE was included in the CONFIGURATION UPDATE COMMAND message, the AMF shall consider the old LADN information as invalid and the new LADN information as valid, if any. If an Extended LADN information IE was included in the CONFIGURATION UPDATE COMMAND message, the AMF shall consider the old extended LADN information as invalid and the new extended LADN information as valid.\nIf a T3447 value was included in the CONFIGURATION UPDATE COMMAND message, the AMF shall consider the T3447 value as valid and if neither zero nor deactivated use the T3447 value with the timer T3447 next time it is started. If the T3447 value included in the CONFIGURATION UPDATE COMMAND message contained an indication that the timer is deactivated or timer value zero, then the AMF shall stop the timer T3447 if running.\nIf a CAG information IE or an Extended CAG information IE was included in the CONFIGURATION UPDATE COMMAND message, the AMF shall consider the new \"CAG information list\" as valid and the old \"CAG information list\" as invalid.\nIf a UE radio capability ID IE was included in the CONFIGURATION UPDATE COMMAND message, the AMF shall consider the new UE radio capability ID as valid and the old UE radio capability ID as invalid.\nIf an Updated PEIPS assistance information IE was included in the CONFIGURATION UPDATE COMMAND message, the AMF shall consider the new PEIPS assistance information as valid and the old PEIPS assistance information, if any, as invalid.\n5.4.4.5\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tTransmission failure of the CONFIGURATION UPDATE COMPLETE message with TAI change from lower layers\n\tIf the current TAI is not in the TAI list, the generic UE configuration update procedure shall be aborted and a registration procedure for mobility and periodic registration update shall be initiated.\n\tIf the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure that triggered the generic UE configuration update procedure.\nb)\tTransmission failure of CONFIGURATION UPDATE COMPLETE message indication without TAI change from lower layers\n\tIt is up to the UE implementation how to re-run the ongoing procedure that triggered the generic UE configuration update procedure.\nc)\tGeneric UE configuration update and de-registration procedure collision\n\tIf the UE receives CONFIGURATION UPDATE COMMAND message after sending a DEREGISTRATION REQUEST message and the access type included in the DEREGISTRATION REQEUST message is same as the access in which the CONFIGURATION UPDATE COMMAND message is received, then the UE shall ignore the CONFIGURATION UPDATE COMMAND message and proceed with the de-registration procedure. Otherwise, the UE shall proceed with both the procedures.\nd)\tVoid\ne)\tGeneric UE configuration update and service request procedure collision\n\tIf the SERVICE REQUEST message does not include UE request type IE with Request type value set to \"NAS signalling connection release\" and the UE receives a CONFIGURATION UPDATE COMMAND message before the ongoing service request procedure has been completed, the UE shall proceed with both the procedures.\n\tIf the SERVICE REQUEST message includes UE request type IE with Request type value set to \"NAS signalling connection release\" and the UE receives a CONFIGURATION UPDATE COMMAND message before the ongoing service request procedure has been completed, the UE shall ignore the CONFIGURATION UPDATE COMMAND message and proceed with the service request procedure.\nf)\t\"CAG information list\" is received and the UE is operating in SNPN access operation mode\n\tIf the UE receives the CAG information list IE in the CONFIGURATION UPDATE COMMAND message and the UE is operating in SNPN access operation mode, the UE shall ignore the content of CAG information list IE.\n5.4.4.6\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3555.\n\tThe network shall, on the first expiry of the timer T3555, retransmit the CONFIGURATION UPDATE COMMAND message and shall reset and start timer T3555. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3555, the procedure shall be aborted. In addition, if the CONFIGURATION UPDATE COMMAND message includes the 5G-GUTI IE, the network shall behave as described in case\u00a0b)-1) below.\nb)\tLower layer failure.\n\tIf a lower layer failure is detected before the CONFIGURATION UPDATE COMPLETE message is received and:\n1)\tif the CONFIGURATION UPDATE COMMAND message includes the 5G-GUTI IE, the old and the new 5G-GUTI shall be considered as valid until the old 5G-GUTI can be considered as invalid by the AMF. If a new TAI list was provided in the CONFIGURATION UPDATE COMMAND message, the old and new TAI list shall also be considered as valid until the old TAI list can be considered as invalid by the AMF.\n\tAdditionally, if the Updated PEIPS assistance information IE in the CONFIGURATION UPDATE COMMAND message includes a new Paging subgroup ID and the UE is previously assigned a different Paging subgroup ID then, the AMF shall consider both, the old and new Paging subgroup IDs as valid until the old Paging subgroup ID can be considered as invalid by the AMF.\nDuring this period the AMF:\ni)\tmay first use the old 5G-S-TMSI from the old 5G-GUTI and the old Paging subgroup ID, if any, for paging within the area defined by the old TAI list for an implementation dependent number of paging attempts for network originated transactions. If a new TAI list was provided in the CONFIGURATION UPDATE COMMAND message, the new TAI list should also be used for paging. Upon response from the UE, the AMF may re-initiate the CONFIGURATION UPDATE COMMAND. If the Updated PEIPS assistance information IE in the CONFIGURATION UPDATE COMMAND message includes a new Paging subgroup ID, then the AMF may re-initiate the CONFIGURATION UPDATE COMMAND. If the response is received from a tracking area within the old and new TAI list, the network shall re-initiate the CONFIGURATION UPDATE COMMAND message. If no response is received to the paging attempts, the network may use the new 5G-S-TMSI from the new 5G-GUTI and the new Paging subgroup ID, if any, for paging for an implementation dependent number of paging attempts. In this case, if a new TAI list was provided with new 5G-GUTI in the CONFIGURATION UPDATE COMMAND message, the new TAI list shall be used instead of the old TAI list. Upon response from the UE the AMF shall consider the new 5G-GUTI and the new PEIPS assistance information as valid and the old 5G-GUTI and the old PEIPS assistance information as invalid.\nii)\tshall consider the new 5G-GUTI as valid if it is used by the UE and, additionally, the new TAI list as valid if it was provided with this 5G-GUTI in the CONFIGURATION UPDATE COMMAND message; and\niii)\tmay use the identification procedure followed by a new generic UE configuration update procedure if the UE uses the old 5G-GUTI; or\n2)\tif the CONFIGURATION UPDATE COMMAND message does not include the 5G-GUTI IE and:\ni)\tthe CONFIGURATION UPDATE COMMAND message does not contain the Allowed NSSAI IE, the Rejected NSSAI IE, the Extended rejected NSSAI IE, or the Updated PEIPS assistance information IE, the network shall abort the procedure; or\nii)\tthe CONFIGURATION UPDATE COMMAND message contains the Allowed NSSAI IE, the Rejected NSSAI IE, the Extended rejected NSSAI IE, or the Updated PEIPS assistance information IE, the network shall either abort the procedure or retransmit the CONFIGURATION UPDATE COMMAND message on expiry of the timer T3555. The retransmission shall not be repeated more than four times. If the retransmission is repeated for four times, the network shall abort the procedure.\nc)\tGeneric UE configuration update and UE initiated de-registration procedure collision.\n\tIf the network receives a DEREGISTRATION REQUEST message before the ongoing generic UE configuration update procedure has been completed, the network shall abort the generic UE configuration update procedure and shall progress the de-registration procedure.\nd)\tGeneric UE configuration update and registration procedure for mobility and periodic registration update collision\n\tIf the network receives a REGISTRATION REQUEST message before the ongoing generic UE configuration update procedure has been completed, the network shall abort the generic UE configuration update procedure and shall progress the registration procedure for mobility and periodic registration update procedure.\ne)\tGeneric UE configuration update and service request procedure collision\n\tIf the network receives a SERVICE REQUEST message before the ongoing generic UE configuration update procedure has been completed and the SERVICE REQUEST message does not include UE request type IE with Request type value set to \"NAS signalling connection release\", both the procedures shall be progressed.\n\tIf the network receives a SERVICE REQUEST message before the ongoing generic UE configuration update procedure has been completed and the SERVICE REQUEST message includes UE request type IE with Request type value set to \"NAS signalling connection release\", the network shall abort the generic UE configuration update procedure and shall progress the service request procedure.\n5.4.5\tNAS transport procedure(s)\n5.4.5.1\tGeneral\nThe purpose of the NAS transport procedures is to provide a transport of payload between the UE and the AMF. The type of the payload is identified by the Payload container type IE and includes one of the following:\na)\ta single 5GSM message;\nb)\tSMS;\nc)\tan LPP message (see 3GPP\u00a0TS\u00a037.355\u00a0[26]);\nc1)\tan SLPP message (see 3GPP\u00a0TS\u00a038.355\u00a0[26A]);\nd)\tan SOR transparent container;\ne)\ta UE policy container;\nf)\ta UE parameters update transparent container;\ng)\ta location services message (see 3GPP\u00a0TS\u00a024.080\u00a0[13A]);\nh)\ta CIoT user data container;\ni)\ta Service-level-AA container;\nj)\ta UPP-CMI container; or\nk)\tMultiple payloads.\nFor payload type a) to e), g) and h), along with the payload, the NAS transport procedure may transport the associated information (e.g. PDU session information for 5GSM message payload).\nFor payload type k), the Payload container IE consists a list of payload container entries, where each of payload container entry contains the payload and optional associated information (e.g. PDU session information for 5GSM message payload).\nNOTE:\tPayload type can be set to \"Multiple payloads\" if there are more than one payloads to be transported using the NAS transport procedures.\n5.4.5.2\tUE-initiated NAS transport procedure\n5.4.5.2.1\tGeneral\nThe purpose of the UE-initiated NAS transport procedure is to provide a transport of:\na)\ta single 5GSM message as defined in subclause\u00a08.3;\nb)\tSMS (see 3GPP\u00a0TS\u00a024.011\u00a0[13]);\nc)\tan LPP message;\nc1)\tan SLPP message;\nd)\tan SOR transparent container;\ne)\ta UE policy container;\nf)\ta UE parameters update transparent container;\ng)\ta location services message;\nh)\ta CIoT user data container;\ni)\ta Service-level-AA container;\nj)\ta UPP-CMI container; or \nk)\tmultiple of the above types.\nand:\n-\tfor a) to e), g) and h), optional associated payload routing information from the UE to the AMF in a 5GMM message; and\n-\tfor k), the Payload container IE consists a list of payload container entries, where each of the payload container entry contains the payload and optional associated payload routing information (e.g. PDU session information for 5GSM message payload).\n5.4.5.2.2\tUE-initiated NAS transport procedure initiation\nIn the connected mode, the UE initiates the NAS transport procedure by sending the UL NAS TRANSPORT message to the AMF, as shown in figure\u00a05.4.5.2.2.1.\nIn case a) in subclause\u00a05.4.5.2.1, the UE shall:\n-\tinclude the PDU session information (PDU session ID, old PDU session ID, S-NSSAI, mapped S-NSSAI (if available in roaming scenarios), DNN, request type, alternative S-NSSAI, MA PDU session information), if available;\n-\tset the Payload container type IE to \"N1 SM information\"; and\n-\tset the Payload container IE to the 5GSM message.\nThe UE shall set the PDU session ID IE to the PDU session ID. If an old PDU session ID is to be included, the UE shall set the Old PDU session ID IE to the old PDU session ID.\nIf an alternative S-NSSAI is to be included, the UE shall set the Alternative S-NSSAI IE to the alternative S-NSSAI and shall set the S-NSSAI IE to the S-NSSAI to be replaced.\nIf an S-NSSAI is to be included, the UE shall set the S-NSSAI IE to the S-NSSAI selected for the PDU session from the allowed NSSAI for the current PLMN or SNPN, associated with the mapped S-NSSAI (if available in roaming scenarios).\nIf a DNN is to be included, the UE shall set the DNN IE to the DNN. 5GSM procedures specified in clause\u00a06 describe conditions for inclusion of the S-NSSAI, mapped S-NSSAI (if available in roaming scenarios), and the DNN.\nIf a request type is to be included, the UE shall set the Request type IE to the request type. The request type is not provided along 5GSM messages other than the PDU SESSION ESTABLISHMENT REQUEST message and the PDU SESSION MODIFICATION REQUEST message.\nIf an MA PDU session information is to be included, the UE shall set the MA PDU session information IE to the MA PDU session information. The MA PDU session information is not provided along 5GSM messages other than the PDU SESSION ESTABLISHMENT REQUEST message and the PDU SESSION MODIFICATION REQUEST message as specified in 3GPP\u00a0TS\u00a024.193\u00a0[13B].\nIf the UE supports the non-3GPP access path switching for the PDU session and the AMF has indicated its support for the non-3GPP access path switching, the UE shall include the Non-3GPP access path switching indication information element and set the NAPS bit to \"non-3GPP access path switching supported\". The non-3GPP access path switching indication is not provided along 5GSM messages other than the PDU SESSION ESTABLISHMENT REQUEST message.\nIn case b) in subclause\u00a05.4.5.2.1, the UE shall:\n-\tset the Payload container type IE to \"SMS\"; and\n-\tset the Payload container IE to the SMS payload.\nBased on the UE preferences regarding access selection for mobile originated (MO) transmission of SMS over NAS as described in 3GPP\u00a0TS\u00a023.501\u00a0[8]:\n-\twhen SMS over NAS is preferred to be sent over 3GPP access: the UE attempts to deliver MO SMS over NAS via the 3GPP access if the UE is registered over both 3GPP access and non-3GPP access. If the delivery of SMS over NAS via the 3GPP access is not available, the UE attempts to deliver MO SMS over NAS via the non-3GPP access; and\n-\twhen SMS over NAS is preferred to be sent over non-3GPP access: the UE attempts to deliver MO SMS over NAS via the non-3GPP access if the UE is registered over both 3GPP access and non-3GPP access. If the delivery of SMS over NAS via the non-3GPP access is not available, the UE attempts to deliver MO SMS over NAS via the 3GPP access.\nIn case c) in subclause\u00a05.4.5.2.1, the UE shall:\n-\tset the Payload container type IE to \"LTE Positioning Protocol (LPP) message container\";\n-\tset the Payload container IE to the LPP message payload; and\n-\tset the Additional information IE to the routing information provided by the upper layer location services application.\nIn case c1) in subclause\u00a05.4.5.2.1, the UE shall:\n-\tset the Payload container type IE to \"SLPP message container\";\n-\tset the Payload container IE to the SLPP message payload; and\n-\tset the Additional information IE to the routing information provided by the upper layer location services application.\nIn case d) in subclause\u00a05.4.5.2.1, the UE shall:\n-\tset the Payload container type IE to \"SOR transparent container\"; and\n-\tset the Payload container IE to the UE acknowledgement due to successful reception of steering of roaming information, and;\ni) \tset the ME support of SOR-CMCI indicator to \"SOR-CMCI supported by the ME\" ;\nii)\tset the ME support of SOR-SNPN-SI indicator to \"SOR-SNPN-SI supported by the ME\"; and\niii)\tset the ME support of SOR-SNPN-SI-LS indicator to \"SOR-SNPN-SI-LS supported by the ME\",\n-\tin the Payload container IE carrying the acknowledgement (see 3GPP\u00a0TS\u00a023.122\u00a0[5]).\nIn case e) in subclause\u00a05.4.5.2.1, the UE shall:\n-\tset the Payload container type IE to \"UE policy container\"; and\n-\tset the contents of the Payload container IE as specified in Annex\u00a0D.\nIn case f) in subclause\u00a05.4.5.2.1, the UE shall:\n-\tset the Payload container type IE to \"UE parameters update transparent container\"; and\n-\tset the contents of the Payload container IE to the UE acknowledgement due to successful reception of UE parameters update data (see 3GPP\u00a0TS\u00a023.502\u00a0[9]).\nIn case g) in subclause\u00a05.4.5.2.1, the UE shall:\n-\tset the Payload container type IE to \"Location services message container\";\n-\tset the Payload container IE to the Location services message payload;\n-\tset the Additional information IE to the routing information, if preconfigured or provided by AMF in a previous procedure or provided by the upper layer location services application; and\n-\tinclude the Payload container information IE with the PRU bit set to \"Payload container related to PRU\" if the location services message payload is related to PRU (see 3GPP\u00a0TS\u00a024.080\u00a0[13A]).\nNOTE:\tThe AMF may configure the routing information to the UE during the PRU association procedure or the PRU disassociation procedure as specified in 3GPP\u00a0TS\u00a023.273\u00a0[6B].\nFor case h), when the UE is located outside the LADN service area, the UE shall not perform the UE-initiated NAS transport procedure to send CIoT user data via the control plane for a PDU session for LADN.\nIn case h) in subclause\u00a05.4.5.2.1, the UE shall:\n-\tinclude the PDU session ID, and Release assistance indication (if available);\n-\tset the Payload container type IE to \"CIoT user data container\"; and\n-\tset the Payload container IE to the user data container.\nIn case i) in subclause\u00a05.4.5.2.1, the UE shall:\n-\tset the Payload container type IE to \"Service-level-AA container\"; and\n-\tset the Payload container IE to the Service-level-AA container.\nIn case j) in subclause\u00a05.4.5.2.1, the UE shall:\n-\tset the Payload container type IE to \"UPP-CMI container\";\n-\tset the Payload container IE to the UPP-CMI container; and\n-\tset the Additional information IE to the routing information, if provided by AMF in a previous procedure or provided by the upper layer location services application.\nIn case k) in subclause\u00a05.4.5.2.1, the UE shall:\n-\tset the Payload container type IE to \"Multiple payloads\"; and\n-\tset each payload container entry of the Payload container IE (see subclause\u00a09.11.3.39), as follows:\ni)\tset the payload container type field of the payload container entry to a payload container type value set in the Payload container type IE as specified in cases a) to j) above;\nii)\tset the payload container entry contents field of the payload container entry to the payload container contents set in the Payload container IE as specified in cases a) to j) above, and\niii)\tset the optional IE fields, if any, to the optional associated payload routing information as specified in cases a) to j) above.\n\nFigure\u00a05.4.5.2.2.1: UE-initiated NAS transport procedure\n5.4.5.2.3\tUE-initiated NAS transport of messages accepted by the network\nUpon reception of a UL NAS TRANSPORT message, if the Payload container type IE is set to:\na)\t\"N1 SM information\", the AMF looks up a PDU session routing context for:\n1)\tthe UE and the PDU session ID IE in case the Old PDU session ID IE is not included, and:\nNOTE\u00a01:\tIf the Old PDU session ID IE is not included in the UL NAS TRANSPORT message and the AMF has received a reallocation requested indication from the SMF, the AMF needs to ignore the reallocation requested indication.\ni)\tif the AMF has a PDU session routing context for the PDU session ID and the UE, and the Request type IE is either not included or is included but set to other value than \"initial request\", \"existing PDU session\", \"initial emergency request\", \"existing emergency PDU session\" or \"MA PDU request\", the AMF shall send the 5GSM message, and the PDU session ID IE towards the SMF identified by the SMF ID of the PDU session routing context;\nii)\tif the AMF has a PDU session routing context for the PDU session ID and the UE, the PDU session routing context indicates that the PDU session is not an emergency PDU session, the Request type IE is included and is set to \"existing PDU session\" or \"MA PDU request\", and the S-NSSAI associated with the PDU session identified by the PDU session ID is allowed for the target access type, the AMF shall send the 5GSM message, the PDU session ID, the S-NSSAI, the mapped S-NSSAI (in roaming scenarios), the DNN (if received) and the request type towards the SMF identified by the SMF ID of the PDU session routing context;\niii)\tif the AMF does not have a PDU session routing context for the PDU session ID and the UE, and the Request type IE is included and is set to \"initial request\" or \"MA PDU request\":\nA)\tthe AMF shall select an SMF with following handlings in case the UE is not registered for onboarding services in SNPN:\n\tIf the S-NSSAI IE is not included, the UE does not have a partially allowed NSSAI, and the allowed NSSAI contains:\n-\tone S-NSSAI, the AMF shall use the S-NSSAI in the allowed NSSAI as the S-NSSAI. Additionally, for a UE for which the AMF has provided a NS-AoS, the AMF shall use the S-NSSAI in the allowed NSSAI if the UE is inside the NS-AoS with respect to the S-NSSAI;\n-\ttwo or more S-NSSAIs and the user's subscription context obtained from UDM contains only one default S-NSSAI that is included in the allowed NSSAI, the AMF shall use the S-NSSAI in the allowed NSSAI that matches the default S-NSSAI as the S-NSSAI; or\n-\ttwo or more S-NSSAIs and the user's subscription context obtained from UDM contains two or more default S-NSSAI(s) included in the allowed NSSAI, the AMF shall use an S-NSSAI in the allowed NSSAI selected based on operator policy as the S-NSSAI.\n\tIf S-NSSAI IE is not included, the UE has both a partially allowed NSSAI and an allowed NSSAI, the AMF shall select an S-NSSAI from the partially allowed NSSAI or the allowed NSSAI based on operator policy. Additionally:\n-\tfor the case when the AMF determines to use the allowed NSSAI for selecting an S-NSSAI and for a UE for which the AMF has provided a NS-AoS, the AMF shall use the S-NSSAI in the allowed NSSAI if the UE is inside the NS-AoS with respect to the S-NSSAI; or\n-\tfor the case when the AMF determines to use the partially allowed NSSAI for selecting an S-NSSAI, the AMF shall use the S-NSSAI in the partially allowed NSSAI if the current TAI is in the list of TAs where the S-NSSAI is allowed.\n\tIf the S-NSSAI or the mapped S-NSSAI (in roaming scenarios) is an S-NSSAI to be replaced and the alternative S-NSSAI is not provided by the UE, the AMF shall retrieve an alternative S-NSSAI (see subclause\u00a05.15.19 of 3GPP\u00a0TS\u00a023.501\u00a0[8]).\n\tIf the S-NSSAI or the mapped S-NSSAI (in roaming scenarios) is an S-NSSAI to be replaced and the alternative S-NSSAI is provided by the UE, but the AMF determines that the S-NSSAI which has been replaced is available, the AMF shall use the S-NSSAI to be replaced (see subclause\u00a05.15.19 of 3GPP\u00a0TS\u00a023.501\u00a0[8]).\n\tIf the DNN IE is included, the AMF shall use the UE requested DNN as the DNN determined by the AMF; and\n\tIf the DNN IE is not included, and the user's subscription context obtained from UDM:\n-\tcontains the default DNN for the S-NSSAI, the AMF shall use the default DNN as the DNN determined by the AMF; and\n-\tdoes not contain the default DNN for the S-NSSAI, the AMF shall use a locally configured DNN as the DNN determined by the AMF;\nA1)\tthe AMF shall select an SMF with following handlings in case the UE is registered for onboarding services in SNPN:\n-\tif the AMF onboarding configuration data does not contain a configured SMF used for onboarding services in SNPN and contains the S-NSSAI used for onboarding services in SNPN, the AMF shall use the S-NSSAI used for onboarding services in SNPN as the S-NSSAI;\n-\tif the AMF onboarding configuration data does not contain a configured SMF used for onboarding services in SNPN and contains the DNN used for onboarding services in SNPN, the AMF shall use the DNN used for onboarding services in SNPN as the DNN;\n-\tif the AMF onboarding configuration data does not contain the S-NSSAI used for onboarding services in SNPN, does not contain the DNN used for onboarding services in SNPN, and contains a configured SMF used for onboarding services in SNPN, the AMF shall select the configured SMF used for onboarding services in SNPN;\n-\tif the AMF onboarding configuration data contains the S-NSSAI used for onboarding services in SNPN, the DNN used for onboarding services in SNPN, or both, and contains a configured SMF used for onboarding services in SNPN, the AMF shall use the S-NSSAI used for onboarding services in SNPN, if any, as the S-NSSAI, and use the DNN used for onboarding services in SNPN, if any, as the DNN or shall select the configured SMF used for onboarding services in SNPN, according to local policy; and\n-\tif the AMF onboarding configuration data contains none of the S-NSSAI used for onboarding services in SNPN, the DNN used for onboarding services in SNPN and a configured SMF used for onboarding services in SNPN, the AMF handling is implementation specific; and\nNOTE\u00a02:\tThe AMF can e.g. use a locally configured DNN used for onboarding services in SNPN as the DNN determined by the AMF.\nNOTE\u00a03:\tSMF selection is outside the scope of the present document.\nNOTE\u00a04:\tAs part of SMF selection, the PCF can provide the AMF with a DNN selected by the network different from the DNN determined by the AMF.\nB)\tif the SMF selection is successful:\n-\tif the DNN selected by the network is a LADN DNN, the AMF shall determine the UE presence in LADN service area (see subclause\u00a06.2.6);\n-\tthe AMF shall store a PDU session routing context for the PDU session ID and the UE, shall set the SMF ID in the stored PDU session routing context to the SMF ID corresponding to the DNN in the user's subscription context obtained from the UDM; and\n-\tthe AMF shall send the 5GSM message, the PDU session ID, the S-NSSAI, the mapped S-NSSAI (in roaming scenarios), the DNN determined by the AMF, DNN selected by the network (if different from DNN determined by the AMF), the request type, the MA PDU session information, the non-3GPP access path switching indication, UE presence in LADN service area (if DNN received corresponds to an LADN DNN), the onboarding indication (if the UE is registered for onboarding services in SNPN), and the alternative S-NSSAI associated with the S-NSSAI to be replaced (if available) towards the SMF identified by the SMF ID of the PDU session routing context;\nNOTE\u00a05:\tThe MA PDU session information is not sent towards the SMF if the DNN received corresponds to an LADN DNN.\niv)\tif the AMF does not have a PDU session routing context for the PDU session ID and the UE, the Request type IE is included and is set to \"existing PDU session\" or \"MA PDU request\", and the AMF retrieves an SMF ID associated with:\nA)\tthe PDU session ID matching the PDU session ID received from the UE, if any; or\nB)\tthe DNN matching the DNN received from the UE, otherwise;\n\tsuch that the SMF ID includes a PLMN identity corresponding to the UE's HPLMN or the current PLMN, then:\nA)\tthe AMF shall store a PDU session routing context for the PDU session ID and the UE, shall set the SMF ID in the stored PDU session routing context to the retrieved SMF ID; and\nB)\tthe AMF shall send the 5GSM message, the PDU session ID, the S-NSSAI, the mapped S-NSSAI (in roaming scenarios), the DNN (if received) and the request type towards the SMF identified by the SMF ID of the PDU session routing context;\nv)\tif the AMF does not have a PDU session routing context for the PDU session ID and the UE, the Request type IE is included and is set to \"initial emergency request\", and the AMF does not have a PDU session routing context for another PDU session ID of the UE indicating that the PDU session is an emergency PDU session:\nA)\tthe AMF shall select an SMF. The AMF shall use the emergency DNN from the AMF emergency configuration data as the DNN, if configured. The AMF shall derive the SMF from the emergency DNN or use the statically configured SMF from the AMF emergency configuration data, if configured; and\nB)\tif the SMF selection is successful:\n-\tthe AMF shall store a PDU session routing context for the PDU session ID and the UE, shall set the SMF ID in the stored PDU session routing context to the SMF ID of the selected SMF, and shall store an indication that the PDU session is an emergency PDU session in the stored PDU session routing context; and\n-\tthe AMF shall send the 5GSM message, the PDU session ID, the S-NSSAI (if configured in the AMF emergency configuration data), the DNN (if configured in the AMF emergency configuration data), and the request type towards the SMF identified by the SMF ID of the PDU session routing context; and\nvi)\tif the AMF does not have a PDU session routing context for the PDU session ID and the UE, the Request type IE is included and is set to \"initial emergency request\", and the AMF has a PDU session routing context indicating that the PDU session is an emergency PDU session for another PDU session ID of the UE:\nA)\tthe AMF shall store a PDU session routing context for the PDU session ID and the UE and shall set the SMF ID in the stored PDU session routing context to the SMF ID of the PDU session routing context for the other PDU session ID of the UE; and\nB)\tthe AMF shall send the 5GSM message, the PDU session ID, the S-NSSAI (if configured in the AMF emergency configuration data), the DNN (if configured in the AMF emergency configuration data) and the request type towards the SMF identified by the SMF ID of the PDU session routing context; or\nvii)\tif the AMF has a PDU session routing context for the PDU session ID and the UE, the PDU session routing context indicates that the PDU session is an emergency PDU session, and the Request type IE is included and is set to \"existing emergency PDU session\", the AMF shall send the 5GSM message, the PDU session ID, the S-NSSAI (if configured in the AMF emergency configuration data), the DNN (if configured in the AMF emergency configuration data), and the request type towards the SMF identified by the SMF ID of the PDU session routing context; and\nviii)\tif the AMF does not have a PDU session routing context for the PDU session ID and the UE, the Request type IE is included and is set to \"existing emergency PDU session\", and the AMF retrieves an SMF ID associated with emergency services such that the SMF ID includes a PLMN identity corresponding to the current PLMN, then:\nA)\tthe AMF shall store a PDU session routing context for the PDU session ID and the UE, shall set the SMF ID in the stored PDU session routing context to the retrieved SMF ID; and\nB)\tthe AMF shall send the 5GSM message, the PDU session ID, the S-NSSAI (if configured in the AMF emergency configuration data), the DNN (if configured in the AMF emergency configuration data), and the request type towards the SMF identified by the SMF ID of the PDU session routing context; or\n2)\tthe UE and the Old PDU session ID IE in case the Old PDU session ID IE is included, and:\ni)\tthe AMF has a PDU session routing context for the old PDU session ID and the UE and does not have a PDU session routing context for the PDU session ID and the UE, the Request type IE is included and is set to \"initial request\", and the AMF received a reallocation requested indication from the SMF indicating that the SMF is to be reused, the AMF shall store a PDU session routing context for the PDU session ID and the UE, set the SMF ID in the stored PDU session routing context to the SMF ID of the PDU session routing context for the old PDU session ID and the UE. If the DNN is a LADN DNN, the AMF shall determine the UE presence in LADN service area (see subclause\u00a06.2.6). The AMF shall send the 5GSM message, the PDU session ID, the old PDU session ID, the S-NSSAI (if received), the mapped S-NSSAI (in roaming scenarios), the DNN, the request type, UE presence in LADN service area (if DNN received corresponds to an LADN DNN), and the alternative S-NSSAI (if received) towards the SMF identified by the SMF ID of the PDU session routing context;\nii)\tthe AMF has a PDU session routing context for the old PDU session ID and the UE and does not have a PDU session routing context for the PDU session ID and the UE, the Request type IE is included and is set to \"initial request\", and the AMF received a reallocation requested indication from the SMF indicating that the SMF is to be reallocated:\nA)\tthe AMF shall select an SMF with the following handling;\n\tIf the S-NSSAI IE is not included and the allowed NSSAI contains:\n-\tone S-NSSAI, the AMF shall use the S-NSSAI in the allowed NSSAI as the S-NSSAI;\n-\ttwo or more S-NSSAIs and the user's subscription context obtained from UDM contains only one default S-NSSAI that is included in the allowed NSSAI, the AMF shall use the S-NSSAI in the allowed NSSAI that matches the default S-NSSAI; or\n-\ttwo or more S-NSSAIs and the user's subscription context obtained from UDM contains two or more default S-NSSAI(s) included in the allowed NSSAI, the AMF shall use an S-NSSAI in the allowed NSSAI selected based on operator policy as the S-NSSAI.\n\tIf the DNN is a LADN DNN, the AMF shall determine the UE presence in LADN service area (see subclause\u00a06.2.6).\nB)\tif the SMF selection is successful:\n-\tthe AMF shall store a PDU session routing context for the PDU session ID and the UE and set the SMF ID of the PDU session routing context to the SMF ID of the selected SMF; and\n-\tthe AMF shall send the 5GSM message, the PDU session ID, the old PDU session ID, the S-NSSAI, the mapped S-NSSAI (in roaming scenarios), the DNN, the request type, the MA PDU session information, the non-3GPP access path switching indication, UE presence in LADN service area (if DNN received corresponds to an LADN DNN), and the alternative S-NSSAI (if received) towards the SMF identified by the SMF ID of the PDU session routing context for the PDU session ID and the UE;\nNOTE\u00a06:\tThe MA PDU session information is not sent towards the SMF if the DNN received corresponds to an LADN DNN.\nb)\t\"SMS\", the AMF shall send the content of the Payload container IE to the SMSF associated with the UE;\nc)\t\"LTE Positioning Protocol (LPP) message container\", the AMF shall send the Payload container type and the content of the Payload container IE to the LMF associated with the routing information included in the Additional information IE of the UL NAS TRANSPORT message;\nc1)\t\"SLPP message container\", the AMF shall send the Payload container type and the content of the Payload container IE to the LMF associated with the routing information included in the Additional information IE of the UL NAS TRANSPORT message;\nd)\t\"SOR transparent container\", the AMF shall send the content of the Payload container IE to the UDM (see\u00a03GPP\u00a0TS\u00a029.503\u00a0[20AB]);\ne)\t\"UE policy container\", the AMF shall send the content of the Payload container IE to the PCF.\nf)\t\"UE parameters update transparent container\", the AMF shall send the content of the Payload container IE to the UDM.\ng)\t\"Location services message container\":\n1)\tif the Additional information IE is not included in the UL NAS TRANSPORT message, the AMF shall provide the Payload container type, the content of the Payload container IE and the content of the Payload container information IE, if included, to the location services application; and\n2)\tif the Additional information IE is included in the UL NAS TRANSPORT message, the AMF shall send the Payload container type and the content of the Payload container IE and the content of the Payload container information IE, if included, to an LMF associated with routing information included in the Additional information IE of the UL NAS TRANSPORT message or to a selected LMF if the Payload container information IE is included in the UL NAS TRANSPORT message and the PRU bit of the Payload container information IE indicates \"Payload container related to PRU\".\nh)\t\"CIoT user data container\", the AMF shall look up a PDU session routing context for the UE and the PDU session ID, and\n1)\tsend the content of the Payload container IE towards the SMF identified by the SMF ID of the PDU session routing context; and\n2)\tinitiate the release of the N1 NAS signalling connection:\ni)\tif the Release assistance indication IE is included in the UL NAS TRANSPORT message and the DDX field of the Release assistance indication IE indicates \"No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected\" and if there is no downlink signalling or downlink data for the UE; or\nii)\tupon subsequent delivery of the next received downlink data transmission to the UE if the Release assistance indication IE is included in the UL NAS TRANSPORT message and the DDX field of the Release assistance indication IE indicates \"Only a single downlink data transmission and no further uplink data transmission subsequent to the uplink data transmission is expected\" and if there is no additional downlink signalling or downlink data for the UE.\ni)\t\"Service-level-AA container\" and the Service-level-AA container is included in the Payload container IE of the UL NAS TRANSPORT message, and the Service-level device ID included in the Service-level-AA container is set to a CAA-level UAV ID, the AMF shall send the content of the Payload container IE to the UAS-NF corresponding to the CAA-level UAV ID. If the Service-level device ID is not included in the Service-level-AA container and a CAA-level UAV ID is included in the 5GMM context of the UE, then the AMF shall send the content of the Payload container IE to the UAS-NF corresponding to the CAA-level UAV ID included in the 5GMM context of the UE.\nj)\t\"UPP-CMI container\":\n1)\tif the Additional information IE is not included in the UL NAS TRANSPORT message, the AMF shall provide the Payload container type and the content of the Payload container IE to the location services application; or\n2)\tif the Additional information IE is included in the UL NAS TRANSPORT message, the AMF shall send the Payload container type and the content of the Payload container IE to an LMF associated with routing information included in the Additional information IE of the UL NAS TRANSPORT message.\nNOTE\u00a07:\tLMF selection for user plane positioning is outside the scope of the present document.\nk)\t\"Multiple payloads\", the AMF shall first decode the content of the Payload container IE (see subclause\u00a09.11.3.39) to obtain the number of payload container entries and for each payload container entry, the AMF shall:\ni)\tdecode the payload container type field;\nii)\tdecode the optional IE fields and the payload container contents field in the payload container entry; and\niii)\thandle the content of each payload container entry the same as the content of the Payload container IE and the associated optional IEs as specified in bullets a) to j) above according to the payload container type field.\n5.4.5.2.4\tUE-initiated NAS transport of messages not accepted by the network\nUpon reception of an UL NAS TRANSPORT message, if the Payload container type IE is set to \"N1 SM information\" and the UE is not configured for high priority access in selected PLMN or SNPN, and:\na)\tif the Request type IE is set to \"initial request\", \"existing PDU session\" or \"MA PDU request\";\n1)\tDNN based congestion control is activated for the DNN included in the UL NAS TRANSPORT message, or DNN based congestion control is activated for the selected DNN in case of no DNN included in the UL NAS TRANSPORT message, e.g. configured by operation and maintenance, the AMF shall send back to the UE the 5GSM message which was not forwarded, a back-off timer value and 5GMM cause #22 \"congestion\" as specified in subclause\u00a05.4.5.3.1 case f);\n2)\tS-NSSAI and DNN based congestion control is activated for the S-NSSAI and DNN included in the UL NAS TRANSPORT message, or S-NSSAI and DNN based congestion control is activated for the S-NSSAI included in the UL NAS TRANSPORT message and the selected DNN in case of no DNN included in the UL NAS TRANSPORT message, or S-NSSAI and DNN based congestion control is activated for the selected S-NSSAI in case of no S-NSSAI included in the UL NAS TRANSPORT message and the DNN included in the UL NAS TRANSPORT message, or S-NSSAI and DNN based congestion control is activated for the selected S-NSSAI and the selected DNN in case of no S-NSSAI and no DNN included in the UL NAS TRANSPORT message, e.g. configured by operation and maintenance, the AMF shall send back to the UE the 5GSM message which was not forwarded, a back-off timer value and 5GMM cause #67 \"insufficient resources for specific slice and DNN\" as specified in subclause\u00a05.4.5.3.1 case f);\n3)\tS-NSSAI only based congestion control is activated for the S-NSSAI included in the UL NAS TRANSPORT message, or S-NSSAI based congestion control is activated for the selected S-NSSAI in case of no S-NSSAI included in the UL NAS TRANSPORT message, e.g. configured by operation and maintenance, the AMF shall send back to the UE the 5GSM message which was not forwarded, a back-off timer value and 5GMM cause #69 \"insufficient resources for specific slice\" as specified in subclause\u00a05.4.5.3.1 case f);\nb)\tvoid;\nc)\tif the Request type IE is set to \"modification request\" and the PDU session is not an emergency PDU session;\n1)\tDNN based congestion control is activated for the stored DNN, e.g. configured by operation and maintenance, the AMF shall send back to the UE the 5GSM message which was not forwarded, a back-off timer value and 5GMM cause #22 \"congestion\" as specified in subclause\u00a05.4.5.3.1 case f);\n2)\tS-NSSAI and DNN based congestion control is activated for the stored S-NSSAI and DNN, e.g. configured by operation and maintenance, the AMF shall send back to the UE the 5GSM message which was not forwarded, a back-off timer value and 5GMM cause #67 \"insufficient resources for specific slice and DNN\" as specified in subclause\u00a05.4.5.3.1 case f);\n3)\tS-NSSAI only based congestion control is activated for the stored S-NSSAI, e.g. configured by operation and maintenance, the AMF shall send back to the UE the 5GSM message which was not forwarded, a back-off timer value and 5GMM cause #69 \"insufficient resources for specific slice\" as specified in subclause\u00a05.4.5.3.1 case f); or\nd)\tthe timer T3447 is running and the UE does not support service gap control:\n1)\tthe Request type IE:\ni)\tis set to \"initial request\";\nii)\tis set to \"existing PDU session\"; or\niii)\tis set to \"modification request\" and the PDU session being modified is a non-emergency PDU session;\n2)\tthe current NAS signalling connection was not triggered by paging; and\n3)\tmobile terminated signalling has not been sent or no user-plane resources have been established for any PDU session after the establishment of the current NAS signalling connection,\n\tthe AMF shall send back to the UE the message which was not forwarded, send the 5GMM cause #22 \"Congestion\", and may include a back-off timer set to the remaining time of the timer T3447 as specified in subclause\u00a05.4.5.3.1 case f).\nUpon reception of a UL NAS TRANSPORT message, if the Payload container type IE is set to \"N1 SM information\", the Request type IE is set to \"initial request\", \"existing PDU session\" or \"MA PDU request\", and the AMF determines that the PLMN's maximum number of PDU sessions has already been reached for the UE, the AMF shall send back to the UE the 5GSM message which was not forwarded and 5GMM cause #65 \"maximum number of PDU sessions reached\" as specified in subclause\u00a05.4.5.3.1 case\u00a0h).\nUpon reception of a UL NAS TRANSPORT message, if the Payload container type IE is set to \"N1 SM information\", the Request type IE is set to \"initial request\", and\na)\tthe UE is in NB-N1 mode;\nb)\tthe UE has indicated preference for user plane CIoT 5GS optimization;\nc)\tthe network accepted the use of user plane CIoT 5GS optimization; and\nd)\tthe AMF determines that there are user-plane resources established for a number of PDU sessions that is equal to the UE' s maximum number of supported user-plane resources (see 3GPP\u00a0TS\u00a023.501\u00a0[8]),\nthe AMF shall either:\na)\tsend back to the UE the message which was not forwarded as specified in in subclause\u00a05.4.5.3.1 case\u00a0h1); or\nb)\tproceed with the PDU session establishment and include the Control Plane CIoT 5GS Optimisation indication or Control Plane Only indicator to the SMF.\nUpon reception of a UL NAS TRANSPORT message, if the Payload container type IE is set to \"N1 SM information\", the Request type IE is set to \"initial request\", and\na)\tthe UE does not support S-NSSAI location validity information;\nb)\tthe S-NSSAI is subject to NS-AoS; and\nc)\tthe AMF determines that the UE is not in the NS-AoS,\nthe AMF may send back to the UE the message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case\u00a0h6), include the 5GMM cause #69 \"insufficient resources for specific slice\", and include a back-off timer.\nUpon reception of an UL NAS TRANSPORT message, if the Payload container type IE is set to \"CIoT user data container\", the UE is not configured for high priority access in selected PLMN, and:\na)\tthe timer T3447 is running and the UE does not support service gap control;\nb)\tthe current NAS signalling connection was not triggered by paging; and\nc)\tmobile terminated signalling has not been sent or no user-plane resources have been established for any PDU session after the establishment of the current NAS signalling connection;\nthe AMF shall send back to the UE the CIoT user data which was not forwarded, send the 5GMM cause #22 \"Congestion\", and include a back-off timer set to the remaining time of the timer T3447 as specified in subclause\u00a05.4.5.3.1 case l2).\nUpon reception of a UL NAS TRANSPORT message, if the Payload container type IE is set to \"N1 SM information\", the Request type IE is set to \"existing PDU session\", and\na)\tthe UE is in NB-N1 mode;\nb)\tthe UE has indicated preference for user plane CIoT 5GS optimization;\nc)\tthe network accepted the use of user plane CIoT 5GS optimization; and\nd)\tthe AMF determines that there are user-plane resources established for a number of PDU sessions that equals to the UE's maximum number of supported user-plane resources (see 3GPP\u00a0TS\u00a023.501\u00a0[8]),\nthe AMF shall send back to the UE the message which was not forwarded as specified in in subclause\u00a05.4.5.3.1 case\u00a0h1).\nUpon reception of an UL NAS TRANSPORT message, if the Payload container type IE is set to \"N1 SM information\", the Request type IE is set to \"initial request\" or \"modification request\", the associated S-NSSAI that the AMF determined through the S-NSSAI IE or the PDU session ID IE is an S-NSSAI for which the AMF is performing NSSAA, and the AMF determines to not forward the 5GSM message to the SMF based on local policy, the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case\u00a0h2).\nUpon reception of an UL NAS TRANSPORT message, if the Payload container type IE is set to \"SMS\", \"LTE Positioning Protocol (LPP) message container\" or \"UPP-CMI container\" or \"SLPP message container\", the UE is not configured for high priority access in selected PLMN, and:\na)\tthe timer T3447 is running and the UE does not support service gap control;\nb)\tthe current NAS signalling connection was not triggered by paging; and\nc)\tmobile terminated signalling has not been sent or no user-plane resources have been established for any PDU session after the establishment of the current NAS signalling connection;\nthe AMF shall abort the procedure.\nNOTE\u00a01:\tIn this state the NAS signalling connection can be released by the network.\nUpon reception of an UL NAS TRANSPORT message, if the Payload container type IE is set to \"N1 SM information\", the Request type IE is set to \"initial request\", and:\na)\tthe determined DNN, S-NSSAI or both DNN and S-NSSAI are identified for UAS services; and\nb)\tthe UE is marked in the UE's 5GMM context that it is not allowed to request UAS services;\nthe AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case\u00a0h4).\nNOTE\u00a02:\tThe UE marked in the UE's 5GMM context as not allowed to request UAS services happens in the case that the UUAA-MM procedure needs to be performed during the registration procedure according to operator policy.\n5.4.5.2.5\tAbnormal cases on the network side\nThe following abnormal cases in AMF are identified:\na)\tIf the Payload container type IE is set to \"N1 SM information\" and:\n1)\tif the Old PDU session ID IE is not included in the UL NAS TRANSPORT message, the AMF does not have a PDU session routing context for the PDU session ID and the UE, the Request type IE is set to \"initial request\" or \"MA PDU request\", and the SMF selection fails, then the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e) or case f);\n2)\tif the Old PDU session ID IE is included in the UL NAS TRANSPORT message, the AMF has a PDU session routing context for the old PDU session ID and the UE and does not have a PDU session routing context for the PDU session ID and the UE, the Request type IE is set to \"initial request\", the AMF received a reallocation requested indication from the SMF indicating that the SMF is to be reallocated, and the SMF selection fails, then the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e) or case f);\n3)\tif the AMF does not have a PDU session routing context for the PDU session ID and the UE, the Request type IE is set to \"existing PDU session\" or \"MA PDU request\", and the user's subscription context obtained from the UDM does not contain an SMF ID for the PDU session ID matching the PDU session ID received from the UE or for the DNN matching the DNN received from the UE such that the SMF ID includes a PLMN identity corresponding to the UE's HPLMN or the current PLMN or the PLMN ID part of the current SNPN, then the AMF may send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e) or case f).\n4)\tif the Old PDU session ID IE is included in the UL NAS TRANSPORT message, and the AMF has a PDU session routing context for the old PDU session ID and the UE and does not have a PDU session routing context for the PDU session ID and the UE, the Request type IE is set to \"initial request\" and the AMF has not received a reallocation requested indication, the AMF should select an SMF with following handlings:\ni)\tif the S-NSSAI IE is not included and the allowed NSSAI contains:\nA)\tone S-NSSAI, the AMF shall use the S-NSSAI in the allowed NSSAI as the S-NSSAI;\nB)\ttwo or more S-NSSAIs and the user's subscription context obtained from UDM contains only one default S-NSSAI that is included in the allowed NSSAI, the AMF shall use the S-NSSAI in the allowed NSSAI as the S-NSSAI; or\nC)\ttwo or more S-NSSAIs and the user's subscription context obtained from UDM contains two or more default S-NSSAI(s) included in the allowed NSSAI, the AMF shall use an S-NSSAI in the allowed NSSAI selected based on operator policy as the S-NSSAI;\nii)\tif the DNN IE is not included, and the user's subscription context obtained from UDM:\nA)\tcontains the default DNN for the S-NSSAI, the AMF shall use the default DNN as the DNN; and\nB)\tdoes not contain the default DNN for the S-NSSAI, the AMF shall use a locally configured DNN as the DNN;\niii)\tif the DNN selected by the network is a LADN DNN, the AMF shall determine the UE presence in LADN service area (see subclause\u00a06.2.6);\niv)\tif the SMF selection is successful, the AMF should store a PDU session routing context for the PDU session ID and the UE, set the SMF ID in the stored PDU session routing context to the selected SMF ID, and forward the 5GSM message, the PDU session ID, the old PDU session ID, the S-NSSAI, the mapped S-NSSAI (in roaming scenarios), the DNN determined by the AMF, DNN selected by the network (if different from DNN determined by the AMF), the request type and UE presence in LADN service area (if DNN selected by the network corresponds to an LADN DNN) towards the SMF ID of the PDU session routing context; and\nv)\tif the SMF selection fails, then the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e) or case f);\n5)\tif the AMF has a PDU session routing context for the PDU session ID and the UE, the PDU session routing context indicates that the PDU session is an emergency PDU session, the Request type IE is set to \"initial emergency request\", the AMF should forward the 5GSM message, the PDU session ID, the S-NSSAI (if configured in the AMF emergency configuration data), the DNN (if configured in the AMF emergency configuration data) and the request type towards the SMF ID of the PDU session routing context;\n6)\tif the Request type IE is set to \"initial emergency request\" and the S-NSSAI or the DNN is received, the AMF ignores the received S-NSSAI or the DNN and uses the emergency DNN from the AMF emergency configuration data, if any;\n7)\tif the AMF does not have a PDU session routing context for the PDU session ID and the UE, and the Request type IE of the UL NAS TRANSPORT message is either not provided or is provided but set to other value than \"initial request\", \"existing PDU session\", \"initial emergency request\", \"existing emergency PDU session\" and \"MA PDU request\", then the AMF may send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e) or case f);\n8)\tif the AMF unsuccessfully attempted to forward the 5GSM message, the PDU session ID, the S-NSSAI, the mapped S-NSSAI (in roaming scenarios), the DNN and the request type (if received) towards a SMF ID, then the AMF may send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e) or case f).\n9)\tif the Old PDU session ID IE is included in the UL NAS TRANSPORT message, the AMF does not have a PDU session routing context for the old PDU session ID and the UE, the AMF does not have a PDU session routing context for the PDU session ID and the UE, the Request type IE is set to \"initial request\", the AMF should select an SMF with following handlings:\ni)\tif the S-NSSAI IE is not included and the allowed NSSAI contains:\nA)\tone S-NSSAI, the AMF shall use the S-NSSAI in the allowed NSSAI as the S-NSSAI;\nB)\ttwo or more S-NSSAIs and the user's subscription context obtained from UDM contains only one default S-NSSAI that is included in the allowed NSSAI, the AMF shall use the default S-NSSAI in the allowed NSSAI as the S-NSSAI; or\nC)\ttwo or more S-NSSAIs and the user's subscription context obtained from UDM contains two or more default S-NSSAI(s) included in the allowed NSSAI, the AMF shall use an S-NSSAI in the allowed NSSAI selected based on operator policy as the S-NSSAI.\nii)\tif the DNN IE is not included, and the user's subscription context obtained from UDM:\nA)\tcontains the default DNN for the S-NSSAI, the AMF shall use the default DNN as the DNN; and\nB)\tdoes not contain the default DNN for the S-NSSAI, the AMF shall use a locally configured DNN as the DNN;\niii)\tif the DNN selected by the network is a LADN DNN, the AMF shall determine the UE presence in LADN service area (see subclause\u00a06.2.6);\niv)\tif the SMF selection is successful, the AMF should store a PDU session routing context for the PDU session ID and the UE, set the SMF ID in the stored PDU session routing context to the selected SMF ID, and forward the 5GSM message, the PDU session ID, the old PDU session ID, the S-NSSAI, the mapped S-NSSAI (in roaming scenarios), the DNN determined by the AMF, DNN selected by the network (if different from DNN determined by the AMF), the request type and UE presence in LADN service area (if DNN selected by the network corresponds to an LADN DNN) towards the SMF ID of the PDU session routing context; and\nv)\tif the SMF selection fails, then the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e) or case f);\n10)\tif the AMF has a PDU session routing context for the PDU session ID and the UE, the PDU session routing context indicates that the PDU session is not an emergency PDU session, and the Request type IE is included and is set to \"existing emergency PDU session\", the AMF may send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e) or case f);\n11)\tif the AMF has a PDU session routing context for the PDU session ID and the UE, the PDU session routing context indicates that the PDU session is an emergency PDU session, and the Request type IE is included and is set to \"existing PDU session\", the AMF may forward the 5GSM message, the PDU session ID, the S-NSSAI (if configured in the AMF emergency configuration data), the DNN (if configured in the AMF emergency configuration data), and the request type towards the SMF identified by the SMF ID of the PDU session routing context;\n12)\tif the AMF has a PDU session routing context for the PDU session ID and the UE, the Request type IE is set to \"initial request\", then the AMF shall perform a local release of the PDU session identified by the PDU session ID and shall request the SMF to perform a local release of the PDU session, and proceed as specified in subclause\u00a05.4.5.2.3;\n13)\tif the Request type IE is set to \"initial request\" or \"modification request\", and the S-NSSAI IE contains an S-NSSAI that is not allowed by the network, then the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e), case f) or h4);\n14)\tif the Request type IE is set to \"existing PDU session\", the AMF has a PDU session routing context for the PDU session ID and the UE, the PDU session routing context indicates that the PDU session is not an emergency PDU session, and the S-NSSAI associated with the PDU session identified by the PDU session ID is not allowed for the target access type, the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e), case f) or h4);\n15)\tif the Request type IE is set to \"initial request\", \"existing PDU session\", \"modification request\" or \"MA PDU request\", the UE is not configured for high priority access in selected PLMN or SNPN, and the UE is in non-allowed area or is not in allowed area, the AMF shall send back to the UE the 5GSM message which was not forwarded, and 5GMM cause #28 \"Restricted service area\" as specified in subclause\u00a05.4.5.3.1 case i);\n15a)\tif the Request type IE is set to \"initial request\" or \"initial emergency request\" and the AMF determines that the UE has registered to a PLMN via a satellite NG-RAN cell that is not allowed to operate at the present UE location, then the AMF may send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case i1); and\n16)\tif the Request type IE is set to \"initial request\" or \"MA PDU request\", the AMF is pending the receipt of a REGISTRATION REQUEST message indicating \"mobility registration updating\" in the 5GS registration type IE, and an emergency PDU session exists for the UE (see subclause\u00a05.4.4.3), the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e) or case f);\n17)\tif the timer T3447 is running and the UE supports service gap control and:\ni)\tthe Request type IE:\nA)\tis set to \"initial request\";\nB)\tis set to \"existing PDU session\"; or\nC\tis set to \"modification request\" and the PDU session being modified is a non-emergency PDU session;\nii)\tthe UE is not configured for high priority access in selected PLMN;\niii)\tthe current NAS signalling connection was not triggered by paging; and\niv)\tmobile terminated signalling has not been sent or no user-plane resources have been established for any PDU session after the establishment of the current NAS signalling connection,\n\tthen the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e) or case f);\n18)\tif the AMF has a PDU session routing context for the PDU session ID and the UE, the Request type IE is not included, the UE is not configured for high priority access in selected PLMN or SNPN, and the PDU session is not an emergency PDU session, then the AMF shall forward the 5GSM message, and the PDU session ID IE towards the SMF identified by the SMF ID of the PDU session routing context with:\ni)\tan exemptionInd attribute indicating \"message was exempted from the DNN based congestion activated in the AMF\" as specified in 3GPP\u00a0TS\u00a029.502\u00a0[20A], if DNN based congestion control is activated for the selected DNN;\nii)\tan exemptionInd attribute indicating \"message was exempted from the S-NSSAI and DNN based congestion activated in the AMF\" as specified in 3GPP\u00a0TS\u00a029.502\u00a0[20A], if S-NSSAI and DNN based congestion control is activated for the selected S-NSSAI and the selected DNN; or\niii)\tan exemptionInd attribute indicating \"message was exempted from the S-NSSAI only based congestion activated in the AMF\" as specified in 3GPP\u00a0TS\u00a029.502\u00a0[20A], if S-NSSAI only based congestion control is activated for the selected S-NSSAI;\n19)\tif the Request type IE is set to \"MA PDU request\" and the S-NSSAI IE contains an S-NSSAI that is not allowed by the network on neither access, then the AMF shall send to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e) or case f);\n20)\tif the Request type IE is set to \"initial request\" and the UE is registered for emergency services over the current access, then the AMF may send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e) or case f); and\n21)\tif the Request type IE is set to \"existing PDU session\", the UE is attempting to transfer a PDU session from 3GPP access to non-3GPP access, and the PDU session is associated with control plane only indication then the AMF shall send back to the UE the 5GSM message which was not forwarded as specified in subclause\u00a05.4.5.3.1 case e).\n22)\tif the Request type IE is set to \"MA PDU request\" and the UE requested DNN corresponds to an LADN DNN, the AMF shall send back to the UE the 5GSM message which was not forwarded and 5GMM cause #90 \"payload was not forwarded\" as specified in subclause\u00a05.4.5.3.1 case\u00a0hx).\n23)\tif the Request type IE is set to \"initial request\", the UE requested DNN corresponds to an LADN DNN, and the MA PDU session information IE is included, the AMF shall not forward the MA PDU session information towards the SMF.\n24)\tif the Request type IE is set to \"modification request\", the DNN associated with the PDU session corresponds to an LADN DNN, and MA PDU session information IE is included, the AMF shall not forward the MA PDU session information towards the SMF.\nb)\tIf the Payload container type IE is set to \"SMS\" and:\n1)\tthe AMF does not have an SMSF address associated with the UE;\n2)\tthe AMF cannot forward the content of the Payload container IE to the SMSF associated with the SMSF address available in the AMF; or\n3)\tthe AMF determines that the UE has registered to a PLMN via a satellite NG-RAN cell that is not allowed to operate at the present UE location;\nthen the AMF shall abort the procedure.\nc)\tIf the Payload container type IE is set to \"LTE Positioning Protocol (LPP) message container\" or \"SLPP message container\" and:\n1)\tif the Additional information IE is not included in the UL NAS TRANSPORT message;\n2)\tthe AMF cannot forward the content of the Payload container IE to the LMF associated with the routing information included in the Additional information IE; or\n3)\tthe AMF determines that the UE has registered to a PLMN via a satellite NG-RAN cell that is not allowed to operate at the present UE location;\nthen the AMF shall abort the procedure.\nd)\tIf the Payload container type IE is set to \"UE policy container\" and:\n1)\tthe AMF does not have a PCF address associated with the UE;\n2)\tthe AMF cannot forward the content of the Payload container IE to the PCF associated with the PCF address available in the AMF; or\n3)\tthe AMF determines that the UE has registered to a PLMN via a satellite NG-RAN cell that is not allowed to operate at the present UE location;\nthen the AMF shall abort the procedure.\ne)\tIf the Payload container type IE is set to \"Location services message container\" and:\n1)\tif the Additional information IE is included in the UL NAS TRANSPORT message and the AMF cannot forward the content of the Payload container IE to an LMF associated with the routing information included in the Additional information IE;\n2)\tthe AMF determines that the UE has registered to a PLMN via a satellite NG-RAN cell that is not allowed to operate at the present UE location;\n3)\tthe AMF determines that the payload container content is related to PRU and the UE has not a valid PRU subscription information; or\n4)\tany combination of bullets 1 to 3,\nthen the AMF shall abort the procedure.\nf)\tIf the Payload container type IE is set to \"SMS\" or \"LTE Positioning Protocol (LPP) message container\" or \"SLPP message container\":\n1)\tthe timer T3447 is running and the UE supports service gap control;\n2)\tthe UE is not configured for high priority access in selected PLMN;\n3)\tthe current NAS signalling connection was not triggered by paging; and\n4)\tmobile terminated signalling has not been sent or no user-plane resources have been established for any PDU session after the establishment of the current NAS signalling connection,\n\tthe AMF shall abort the procedure.\nNOTE:\tIn this state the N1 NAS signalling connection can be released by the network.\ng)\tIf the Payload container type IE is set to \"CIoT user data container\" and:\n1)\tif the AMF does not have a PDU session routing context for the PDU session ID and the UE; or\n2)\tif the AMF unsuccessfully attempted to forward the user data container and the PDU session ID,\n\tthen the AMF may send back to the UE the CIoT user data container which was not forwarded as specified in subclause\u00a05.4.5.3.1 case l1).\nh)\tIf the Payload container type IE is set to \"CIoT user data container\":\n1)\tif the timer T3447 is running and the UE supports service gap control;\n2)\tthe UE is not configured for high priority access in selected PLMN;\n3)\tthe current N1 NAS signalling connection was not triggered by paging; and\n4)\tmobile terminated signalling has not been sent or no user-plane resources have been established for any PDU session after the establishment of the current NAS signalling connection,\n\tthen the AMF shall send back to the UE the CIoT user data container which was not forwarded as specified in subclause\u00a05.4.5.3.1 case l1).\ni)\tIf the Payload container type IE is set to \"SOR transparent container\", \"UE prameters update transparent container\", or \"Service-level-AA container\", and the AMF determines that the UE has registered to a PLMN via a satellite NG-RAN cell that is not allowed to operate at the present UE location, then the AMF shall abort the procedure.\nj)\tIf the Payload container type IE is set to \"UPP-CMI container\" and:\n1)\tif the Additional information IE is not included in the UL NAS TRANSPORT message;\n2)\tthe AMF cannot forward the content of the Payload container IE to the LMF associated with the routing information included in the Additional information IE; or\n3)\tthe AMF determines that the UE has registered to a PLMN via a satellite NG-RAN cell that is not allowed to operate at the present UE location;\nthen the AMF shall abort the procedure.\n\n5.4.5.2.6\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tThe lower layers indicate that the access attempt is barred.\n\tThe UE shall not start the UE-initiated NAS transport procedure. The UE stays in the current serving cell and applies the normal cell reselection process.\n\tIf the access category for the access attempt is 6 due to a request from upper layers to send a mobile originated SMS over NAS and the UE is registered to the network via both 3GPP access and non-3GPP access, the UE may transmit the UL NAS TRANSPORT message via non-3GPP access, if available.\n\tOtherwise, the UE-initiated NAS transport procedure is started, if still needed, when the lower layers indicate that the barring is alleviated for the access category with which the access attempt was associated.\naa)\tThe lower layers indicate that:\n1)\taccess barring is applicable for all access categories except categories 0 and 2 and the access category with which the access attempt was associated is other than 0 and 2; or\n2)\taccess barring is applicable for all access categories except category 0 and the access category with which the access attempt was associated is other than 0.\n\tThe UE shall proceed as specified for case a. For additional UE requirements see subclause\u00a04.5.5.\nb)\tIf the Payload container type IE is set to \"N1 SM information\", the Request type IE is set to \"initial request\" or \"MA PDU request\" and registration procedure for mobility and periodic registration update is pending due to receipt by the UE of new network slicing information via the generic UE configuration update procedure with re-registration request; and an emergency PDU session exists then:\n1)\tThe UE shall not send the UL NAS TRANSPORT message; and\n2)\tThe UL NAS TRANSPORT message can be sent, if still necessary, after a successful procedure for mobility and periodic registration update.\nc)\tTransmission failure of the UL NAS TRANSPORT message with change in the current TAI.\n\tIf the current TAI is not in the TAI list, the UE-initiated NAS transport procedure shall be aborted and a registration procedure for mobility and periodic registration update shall be initiated. The UL NAS TRANSPORT message can be sent, if still necessary, after a successful procedure for mobility and periodic registration update.\n\tIf:\n1)\tthe current TAI is still part of the TAI list;\n2)\tthe UL NAS TRANSPORT message is sent to transport a 5GSM message associated with an S-NSSAI included in the partially allowed NSSAI; and\n3)\tthe current TAI is not in the list of TAs where the S-NSSAI is allowed,\nthen the UE-initiated NAS transport procedure shall be aborted.\n\tOtherwise, it is up to the UE implementation how to re-run the ongoing procedure that triggered the UE-initiated NAS transport procedure.\nd)\tTransmission failure of the UL NAS TRANSPORT message indication without change in the current TAI.\n\tIt is up to the UE implementation how to re-run the ongoing procedure that triggered the UE-initiated NAS transport procedure.\ne)\tVoid.\nf)\tTimer T3447 is running.\n\tThe UE shall not send the UL NAS TRANSPORT message unless:\n1)\tthe Payload container type IE is set to \"N1 SM information\" and:\ni)\tthe Request type IE is set to:\nA)\t\"initial emergency request\";\nB)\t\"existing emergency PDU session\"; or\nC)\t\"modification request\" and the PDU session being modified is an emergency PDU session (see error cases described in subclause\u00a06.4.1.3 and subclause\u00a06.3.2.3); or\nii)\tthe Request type IE is not included and the PDU session modification procedure is used to indicate a change of 3GPP PS data off UE status for a PDU session;\n2)\tthe UE is a UE configured for high priority access in selected PLMN;\n3)\ta paging request triggered the establishment of the current NAS signalling connection; or\n4)\tthe UE in 5GMM-CONNECTED mode receives mobile terminated signalling or downlink data over the user-plane.\n\tThe UL NAS TRANSPORT message can be sent, if still necessary, when timer T3447 expires or timer T3447 is stopped.\ng)\tThe lower layers indicate that the RRC connection has been suspended.\n\tThe UE shall abort the UE-initiated NAS transport procedure.\nh)\tTimer T3346 is running.\n\tThe UE shall not send the UL NAS TRANSPORT message unless:\n1)\tthe Payload container type IE is set to \"N1 SM information\" and:\ni)\tthe Request type IE is set to:\nA)\t\"initial emergency request\";\nB)\t\"existing emergency PDU session\"; or\nC)\t\"modification request\" and the PDU session being modified is an emergency PDU session; or\nii)\tthe Request type IE is not included and the PDU session modification procedure is used to indicate a change of 3GPP PS data off UE status for a PDU session; or\n2)\tthe UE is a UE configured for high priority access in selected PLMN or SNPN.\n\tThe UL NAS TRANSPORT message can be sent, if still necessary, when timer T3346 expires.\ni)\tNAS MAC calculation indication from lower layers.\n\tIf lower layers indicate to calculate an NAS MAC, the UE shall calculate an NAS MAC as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] and then provide the calculated NAS MAC and 5 least significant bits of the uplink NAS COUNT used to calculate the NAS MAC to lower layers (see 3GPP\u00a0TS\u00a036.331\u00a0[25A]). The UE shall increase the uplink NAS COUNT by one after the calculation of the NAS MAC.\n5.4.5.3\tNetwork-initiated NAS transport procedure\n5.4.5.3.1\tGeneral\nThe purpose of the network-initiated NAS transport procedure is to provide a transport of:\na)\ta single 5GSM message;\nb)\tSMS;\nc)\tan LPP message;\nc1)\tan SLPP message;\nd)\tan SOR transparent container;\ne)\ta single uplink 5GSM message which was not forwarded due to routing failure;\nf)\ta single uplink 5GSM message which was not forwarded due to congestion control;\ng)\ta UE policy container;\nh)\ta single uplink 5GSM message which was not forwarded, because the PLMN's maximum number of PDU sessions has been reached;\nh1)\ta single uplink 5GSM message which was not forwarded, because the maximum number of PDU sessions with active user-plane resources has been reached;\nh2)\ta single uplink 5GSM message which was not forwarded, because of ongoing network slice-specific authentication and authorization procedure for the S-NSSAI that is requested;\nh3)\ta single uplink 5GSM message which was not forwarded, because the UE requested to establish an MA PDU session for LADN DNN;\nh4)\ta single uplink 5GSM message which was not forwarded, because the maximum number of UEs for a network slice has been reached;\nh5)\ta single uplink 5GSM message which was not forwarded because the UE is marked in the UE's 5GMM context that it is not allowed to request UAS services;\nh6)\ta single uplink 5GSM message was not forwarded, because the UE not supporting S-NSSAI location validity information requested forwarding of an 5GSM message with Request type IE is set to \"initial request\" when not in the NS-AoS of the related S-NSSAI;\ni)\ta single uplink 5GSM message which was not forwarded due to service area restrictions;\ni1)\ta single uplink 5GSM message which was not forwarded because the UE is registered to a PLMN via a satellite NG-RAN cell that is not allowed to operate at the present UE location;\nj)\ta UE parameters update transparent container;\nk)\ta location services message;\nl)\ta CIoT user data container;\nl1)\ta single uplink CIoT user data container or control plane user data which was not forwarded due to routing failure;\nl2)\ta single uplink CIoT user data container which was not forwarded due to congestion control;\nm)\ta service-level-AA container;\nm1)\tan event notification for upper layers;\nm2)\ta UPP-CMI container;\nm3)\ta single UPP-CMI container which was not forwarded due to user plane positioning not authorized; or\nn)\tmultiple of the above types.\nfrom the AMF to the UE in a 5GMM message.\n5.4.5.3.2\tNetwork-initiated NAS transport procedure initiation\nIn 5GMM-CONNECTED mode, the AMF initiates the NAS transport procedure by sending the DL NAS TRANSPORT message, as shown in figure\u00a05.4.5.3.2.1.\nIn case a) in subclause\u00a05.4.5.3.1, i.e. upon reception from an SMF of a 5GSM message without an N1 SM delivery skip allowed indication for a UE or a 5GSM message with an N1 SM delivery skip allowed indication for a UE in the 5GMM-CONNECTED mode, the AMF shall:\na)\tinclude the PDU session information (PDU session ID) in the PDU session ID IE;\nb)\tset the Payload container type IE to \"N1 SM information\"; and\nc)\tset the Payload container IE to the 5GSM message.\nIn case b) in subclause\u00a05.4.5.3.1, i.e. upon reception from an SMSF of an SMS payload, the AMF shall:\na)\tset the Payload container type IE to \"SMS\";\nb)\tset the Payload container IE to the SMS payload; and\nc)\tselect the access type to deliver the DL NAS TRANSPORT message as follows in case the access type selection is required:\n1)\tif the UE to receive the DL NAS TRANSPORT message is registered to the network via both 3GPP access and non-3GPP access, the 5GMM context of the UE indicates that SMS over NAS is allowed, the UE is in MICO mode, and the UE is in 5GMM-IDLE mode for 3GPP access and in 5GMM-CONNECTED mode for non-3GPP access, then the AMF selects non-3GPP access. Otherwise, the AMF selects either 3GPP access or non-3GPP access.\n\tIf the delivery of the DL NAS TRANSPORT message over 3GPP access has failed, the AMF may re-send the DL NAS TRANSPORT message over the non-3GPP access.\n\tIf the delivery of the DL NAS TRANSPORT message over non-3GPP access has failed, the AMF may re-send the DL NAS TRANSPORT message over the 3GPP access; and\n2)\totherwise, the AMF selects 3GPP access.\nNOTE\u00a01:\tThe AMF selects an access type between 3GPP access and non-3GPP access based on operator policy.\nIn case c) in subclause\u00a05.4.5.3.1 i.e. upon reception from an LMF of an LPP message payload, the AMF shall:\na)\tset the Payload container type IE to \"LTE Positioning Protocol (LPP) message container\";\nb)\tset the Payload container IE to the LPP message payload received from the LMF;\nc)\tset the Additional information IE to an LCS correlation identifier received from the LMF from which the LPP message was received.\nNOTE\u00a02:\tThe LCS Correlation Identifier is assigned originally by the AMF except for LPP message transfer associated with event reporting for periodic or triggered location as described in subclause\u00a06.3.1 of 3GPP\u00a0TS\u00a023.273\u00a0[6B], where the LMF assigns the correlation identifier. AMF and LMF assigned correlation identifiers can be distinguished by an implementation specific convention (e.g. use of a different number of octets) to enable an AMF to distinguish one from the other when received in the Additional Information IE in an UL NAS Transport message.\nIn case c1) in subclause\u00a05.4.5.3.1 i.e. upon reception from an LMF of an SLPP message payload, the AMF shall:\na)\tset the Payload container type IE to \"SLPP message container\";\nb)\tset the Payload container IE to the SLPP message payload received from the LMF; and\nc)\tset the Additional information IE to an LCS correlation identifier received from the LMF from which the SLPP message was received.\nIn case d) in subclause\u00a05.4.5.3.1 i.e. upon reception of a steering of roaming information (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) from the UDM to be forwarded to the UE, the AMF shall:\na)\tset the Payload container type IE to \"SOR transparent container\"; and\nb)\tset the Payload container IE to the steering of roaming information received from the UDM (see\u00a03GPP\u00a0TS\u00a029.503\u00a0[20AB]).\nIn case e) in subclause\u00a05.4.5.3.1, i.e. upon sending a single uplink 5GSM message which was not forwarded due to routing failure, the AMF shall:\na)\tinclude the PDU session ID in the PDU session ID IE;\nb)\tset the Payload container type IE to \"N1 SM information\";\nc)\tset the Payload container IE to the 5GSM message which was not forwarded;\nd)\tset the 5GMM cause IE to the 5GMM cause #90 \"payload was not forwarded\" or 5GMM cause #91 \"DNN not supported or not subscribed in the slice\".\n\tThe AMF sets the 5GMM cause IE to the 5GMM cause #91 \"DNN not supported or not subscribed in the slice\", if the 5GSM message could not be forwarded since SMF selection fails because:\n1)\tthe DNN is not supported in the slice identified by the S-NSSAI used by the AMF; or\n2)\tneither the DNN provided by the UE nor the wildcard DNN are in the subscribed DNN list of the UE for the S-NSSAI used by the AMF.\n\tOtherwise, the AMF sets the 5GMM cause IE to the 5GMM cause #90 \"payload was not forwarded\"; and\ne)\toptionally include the Back-off timer value IE if the 5GMM cause IE is set to 5GMM cause #91 \"DNN not supported or not subscribed in the slice\" due to the DNN is not supported in the slice.\nIn case f) in subclause\u00a05.4.5.3.1, i.e. upon sending a single uplink 5GSM message which was not forwarded due to congestion control, the AMF shall:\na)\tinclude the PDU session ID in the PDU session ID IE;\nb)\tset the Payload container type IE to \"N1 SM information\";\nc)\tset the Payload container IE to the 5GSM message which was not forwarded;\nd)\tset the 5GMM cause IE to the 5GMM cause #22 \"Congestion\", the 5GMM cause #67 \"insufficient resources for specific slice and DNN\" or the 5GMM cause #69 \"insufficient resources for specific slice\"; and\ne)\tinclude the Back-off timer value IE.\nIn case g) in subclause\u00a05.4.5.3.1, i.e. upon reception of a UE policy container from the PCF to be forwarded to the UE, the AMF shall:\na)\tset the Payload container type IE to \"UE policy container\"; and\nb)\tset the Payload container IE to the UE policy container received from the PCF.\nIn case\u00a0h) in subclause\u00a05.4.5.3.1, i.e. upon sending a single uplink 5GSM message which was not forwarded, because the PLMN's maximum number of PDU sessions has been reached, the AMF shall:\na)\tinclude the PDU session ID in the PDU session ID IE;\nb)\tset the Payload container type IE to \"N1 SM information\";\nc)\tset the Payload container IE to the 5GSM message which was not forwarded; and\nd)\tset the 5GMM cause IE to the 5GMM cause #65 \"maximum number of PDU sessions reached\".\nIn case\u00a0h1) in subclause\u00a05.4.5.3.1, i.e. upon sending a single uplink 5GSM message which was not forwarded, because the maximum number of PDU sessions with active user-plane resources has been reached, the AMF shall:\na)\tinclude the PDU session ID in the PDU session ID IE;\nb)\tset the Payload container type IE to \"N1 SM information\";\nc)\tset the Payload container IE to the 5GSM message which was not forwarded; and\nd)\tset the 5GMM cause IE to the 5GMM cause #92 \"insufficient user-plane resources for the PDU session\".\nIn case\u00a0h2) in subclause\u00a05.4.5.3.1, i.e. upon sending a single uplink 5GSM message which was not forwarded because the UE requested to establish a PDU session associated with an S-NSSAI or to modify a PDU session associated with an S-NSSAI for which:\na)\tthe AMF is performing network slice-specific authentication and authorization and determined to reject the request based on local policy; or\nb)\tthe network slice-specific authentication and authorization has failed or the authorization has been revoked;\nthe AMF shall:\na)\tinclude the PDU session ID in the PDU session ID IE;\nb)\tset the Payload container type IE to \"N1 SM information\";\nc)\tset the Payload container IE to the 5GSM message which was not forwarded; and\nd)\tset the 5GMM cause IE to the 5GMM cause #90 \"payload was not forwarded\".\nIn case\u00a0h3) in subclause\u00a05.4.5.3.1, i.e. upon sending a single uplink 5GSM message which was not forwarded because the UE requested to establish an MA PDU session for LADN DNN, the AMF shall:\na)\tinclude the PDU session ID in the PDU session ID IE;\nb)\tset the Payload container type IE to \"N1 SM information\";\nc)\tset the Payload container IE to the 5GSM message which was not forwarded; and\nd)\tset the 5GMM cause IE to the 5GMM cause #90 \"payload was not forwarded\".\nIn case\u00a0h4) in subclause\u00a05.4.5.3.1, i.e. upon sending a single uplink 5GSM message which was not forwarded, because the maximum number of UEs for a network slice has been reached, the AMF shall:\na)\tinclude the PDU session ID in the PDU session ID IE;\nb)\tset the Payload container type IE to \"N1 SM information\";\nc)\tset the Payload container IE to the 5GSM message which was not forwarded;\nd)\tset the 5GMM cause IE to the 5GMM cause #69 \"insufficient resources for specific slice\"; and\ne)\tinclude the Back-off timer value IE.\nFor case\u00a0h5) in subclause\u00a05.4.5.3.1, i.e. upon sending a single uplink 5GSM message which was not forwarded because the UE is marked in the UE's 5GMM context that it is not allowed to request UAS services, the AMF shall:\na)\tinclude the PDU session ID in the PDU session ID IE;\nb)\tset the Payload container type IE to \"N1 SM information\";\nc)\tset the Payload container IE to the 5GSM message which was not forwarded; and\nd)\tset the 5GMM cause IE to the 5GMM cause #79 \"UAS services not allowed\".\nFor case\u00a0h6) in subclause\u00a05.4.5.3.1, i.e. upon sending a single uplink 5GSM message which was not forwarded because because the UE not supporting S-NSSAI location validity information requested forwarding of an 5GSM message with Request type IE is set to \"initial request\" when not in the NS-AoS of the related S-NSSAI, the AMF shall:\na)\tinclude the PDU session ID in the PDU session ID IE;\nb)\tset the Payload container type IE to \"N1 SM information\";\nc)\tset the Payload container IE to the 5GSM message which was not forwarded;\nd)\tset the 5GMM cause IE to the 5GMM cause #69 \"insufficient resources for specific slice\"; and\ne)\tinclude the Back-off timer value IE.\nIn case i) in subclause\u00a05.4.5.3.1, i.e. upon sending a single uplink 5GSM message which was not forwarded due to service area restrictions, the AMF shall:\na)\tinclude the PDU session ID in the PDU session ID IE;\nb)\tset the Payload container type IE to \"N1 SM information\";\nc)\tset the Payload container IE to the 5GSM message which was not forwarded; and\nd)\tset the 5GMM cause IE to the 5GMM cause #28 \"Restricted service area\".\nIn case i1) in subclause\u00a05.4.5.3.1, i.e. upon sending a single uplink 5GSM message which was not forwarded because the UE is registered to a PLMN via a satellite NG-RAN cell that is not allowed to operate at the present UE location, the AMF shall:\na)\tinclude the PDU session ID in the PDU session ID IE;\nb)\tset the Payload container type IE to \"N1 SM information\";\nc)\tset the Payload container IE to the 5GSM message which was not forwarded; and\nd)\tset the 5GMM cause IE to the 5GMM cause #78 \"PLMN not allowed to operate at the present UE location\".\nIn case j) in subclause\u00a05.4.5.3.1 i.e. upon reception of UE parameters update data (see 3GPP\u00a0TS\u00a023.502\u00a0[9]) from the UDM to be forwarded to the UE, the AMF shall:\na)\tset the Payload container type IE to \"UE parameters update transparent container\"; and\nb)\tset the contents of the Payload container IE to the UE parameters update data (see 3GPP\u00a0TS\u00a023.502\u00a0[9]) received from the UDM.\nFor case k) in subclause\u00a05.4.5.3.1 upon reception from a location services application of a Location services message payload, the AMF shall:\na)\tset the Payload container type IE to \"Location services message container\"; and\nb)\tset the Payload container IE to the Location services message payload.\nFor case k) in subclause\u00a05.4.5.3.1 upon reception from an LMF of a Location services message payload, the AMF shall:\na)\tset the Payload container type IE to \"Location services message container\";\nb)\tset the Payload container IE to the Location services message payload; and\nc)\tset the Additional information IE to routing information associated with the LMF from which the Location services message payload was received.\nNOTE\u00a03:\tCase k) in subclause\u00a05.4.5.3.1 supports transport of a Location services message container between a UE and an AMF and between a UE and an LMF. For transport between a UE and an LMF, the Additional information IE is included and provides routing information for the LMF. For transport between a UE and an AMF, the Additional information IE is not included.\nIn case l) in subclause\u00a05.4.5.3.1, i.e. upon reception from an SMF of a user data container payload, the AMF shall:\na)\tinclude the PDU session ID in the PDU session ID IE;\nb)\tset the Payload container type IE to \"CIoT user data container\"; and\nc)\tset the Payload container IE to the user data container.\nFor case l1) in subclause\u00a05.4.5.3.1, i.e. upon sending a single uplink CIoT user data container or control plane user data which was not forwarded due to routing failure, the AMF shall:\na)\tinclude the PDU session ID in the PDU session ID IE;\nb)\tset the Payload container type IE to \"CIoT user data container\";\nc)\tset the Payload container IE to the CIoT user data container or control plane user data which was not forwarded; and\nd)\tset the 5GMM cause IE to the 5GMM cause #90 \"payload was not forwarded\".\nNOTE\u00a04:\tFor case l1) in subclause\u00a05.4.5.3.1, this is also applied for a single uplink CIoT user data container or control plane user data in the CONTROL PLANE SERVICE REQUEST message which was not forwarded due to routing failure.\nFor case l2) in subclause\u00a05.4.5.3.1, i.e. upon sending a single uplink CIoT user data container which was not forwarded due to congestion control, the AMF shall:\na)\tinclude the PDU session ID in the PDU session ID IE;\nb)\tset the Payload container type IE to \" CIoT user data container\";\nc)\tset the Payload container IE to the CIoT user data container which was not forwarded;\nd)\tset the 5GMM cause IE to the 5GMM cause #22 \"Congestion\", the 5GMM cause #67 \"insufficient resources for specific slice and DNN\" or the 5GMM cause #69 \"insufficient resources for specific slice\", and include the Back-off timer value IE.\nIn case m) in subclause\u00a05.4.5.3.1, during UUAA-MM procedure, if the AMF receives the UUAA payload from the UAS-NF, the AMF shall:\na)\tinclude the service-level-AA payload with the value set to the payload; and\nb)\tif a payload type associated with the payload is received, include the service-level-AA payload type with the value set to the payload type\nIn case m1) in subclause\u00a05.4.5.3.1, i.e. if the AMF needs to send an event notification indicator for upper layers to the UE which set the \"EventNotification\" bit of the 5GMM capability IE in the last REGISTRATION REQUEST message to \"Event notification supported\", the AMF shall:\na)\tset the Payload container type IE to \"Event notification\"; and\nb)\tset the Payload container IE to the event notification indicator.\nIn case m2) in subclause\u00a05.4.5.3.1, i.e. upon reception from an LMF of a UPP-CMI container, the AMF shall:\na)\tset the Payload container type IE to \"UPP-CMI container\";\nb)\tset the Payload container IE to the UPP-CMI container received from the LMF; and\nc)\tset the Additional information IE to routing information associated with the LMF from which the Location services message payload was received.\nFor case m3) in subclause\u00a05.4.5.3.1, i.e. upon sending a single UPP-CMI container which was not forwarded due to user plane positioning not authorized, the AMF shall:\na)\tset the Payload container type IE to \"UPP-CMI container\";\nb)\tset the Payload container IE to the UPP-CMI container which was not forwarded; and\nc)\tset the 5GMM cause IE to the 5GMM cause #94 \"User plane positioning not authorized\".\nIn case n) in subclause\u00a05.4.5.3.1, the AMF shall:\na)\tset the Payload container type IE to \"Multiple payloads\";\nb)\tset each payload container entry of the Payload container IE (see subclause\u00a09.11.3.39) as follows:\ni)\tset the payload container type field of the payload container entry to a payload container type value set in the Payload container type IE as specified for cases a) to m3) above;\nii)\tset the payload container entry contents field of the payload container entry to the payload container contents set in the Payload container IE as specified for cases a) to m3) above;\niii)\tset the optional IE fields, if any, to the optional associated information as specified for cases a) to m3) above.\n\nFigure\u00a05.4.5.3.2.1: Network-initiated NAS transport procedure\n5.4.5.3.3\tNetwork-initiated NAS transport of messages\nUpon reception of a DL NAS TRANSPORT message, the UE shall stop the timer T3346 if running.\nUpon reception of a DL NAS TRANSPORT message, if the Payload container type IE is set to:\na)\t\"N1 SM information\" and the 5GMM cause IE is not included in the DL NAS TRANSPORT message, the 5GSM message in the Payload container IE and the PDU session ID are handled in the 5GSM procedures specified in clause\u00a06;\nb)\t\"SMS\", the UE shall forward the content of the Payload container IE to the SMS stack entity;\nc)\t\"LTE Positioning Protocol (LPP) message container\", the UE shall forward the payload container type, the content of the Payload container IE and the routing information included in the Additional information IE to the upper layer location services application;\nc1)\t\"SLPP message container\", the UE shall forward the payload container type, the content of the Payload container IE and the routing information included in the Additional information IE to the upper layer location services application;\nd)\t\"SOR transparent container\" and if the Payload container IE:\n1)\tsuccessfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]), the ME shall store the received SOR counter as specified in annex\u00a0C and proceed as follows:\ni)\tIf the Payload container IE indicates a list of preferred PLMN/access technology combinations is provided and the list type indicates \"PLMN ID and access technology list\", then the ME shall replace the highest priority entries in the \"Operator Controlled PLMN Selector with Access Technology\" list stored in the ME;\nii)\tIf the list type indicates \"secured packet\", then the ME shall behave as if a SMS is received with protocol identifier set to SIM data download, data coding scheme set to class 2 message and SMS payload as secured packet contents of SOR transparent container IE. The SMS payload is forwarded to UICC as specified in 3GPP\u00a0TS\u00a023.040\u00a0[4A]; \niii)\tIf the Payload container IE includes SOR-SNPN-SI, the ME shall replace SOR-SNPN-SI of the selected entry of the \"list of subscriber data\" or associated with the selected PLMN subscription, as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] with the received SOR-SNPN-SI; \niv)\tIf the SOR-CMCI is present, in plain text, and the Store SOR-CMCI in ME indicator is set to \"Store SOR-CMCI in ME\" then the UE shall store or delete the SOR-CMCI in the non-volatile memory of the ME as described in annex\u00a0C.1;and\nv)\tIf the Payload container IE includes SOR-SNPN-SI-LS, the ME shall replace SOR-SNPN-SI-LS of the selected entry of the \"list of subscriber data\" or associated with the selected PLMN subscription, as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] with the received SOR-SNPN-SI-LS;\n\tIf the ACK bit of the SOR header for SOR data type in the SOR transparent container is set to \"acknowledgement requested\" and the list type indicates:\nA)\t\"PLMN ID and access technology list\"; or\nB)\t\"secured packet\" and the ME receives status bytes from the UICC indicating that the UICC has received the secured packet successfully;\n\tthen the ME shall send an acknowledgement in the Payload container IE of an UL NAS TRANSPORT message with Payload type IE set to \"SOR transparent container\" as specified in subclause\u00a05.4.5.2.2. In the Payload container IE carrying the acknowledgement, the UE shall set the ME support of SOR-CMCI indicator to \"SOR-CMCI supported by the ME\". Additionally, if the UE supports access to an SNPN using credentials from a credentials holder and the UE is not operating in SNPN access operation mode, the UE may set the ME support of SOR-SNPN-SI indicator to \"SOR-SNPN-SI supported by the ME\".Additionally, if the UE supports access to an SNPN providing access for localized services in SNPN, the UE shall set the ME support of SOR-SNPN-SI-LS indicator to \"SOR-SNPN-SI-LS supported by the ME\".\n\tThe UE shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; or\n2)\tdoes not successfully pass the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]) then the UE shall discard the content of the payload container IE and proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C.\ne)\tVoid;\nf)\tVoid;\ng)\t\"N1 SM information\" and:\n1)\tthe 5GMM cause IE is set to the 5GMM cause #22 \"Congestion\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to DNN based congestion control along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE;\n2)\tthe 5GMM cause IE is set to the 5GMM cause #28 \"Restricted service area\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to service area restrictions along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message, enters the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE and, if the DL NAS TRANSPORT message is received over 3GPP access, performs the registration procedure for mobility and periodic registration update without waiting for the release of the N1 NAS signalling connection (see subclauses\u00a05.3.5 and 5.5.1.3);\n3)\tthe 5GMM cause IE is set to the 5GMM cause #65 \"maximum number of PDU sessions reached\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded because the PLMN's maximum number of PDU sessions has been reached, along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message;\n4)\tthe 5GMM cause IE is set to the 5GMM cause #67 \"insufficient resources for specific slice and DNN\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to S-NSSAI and DNN based congestion control along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE;\n5)\tthe 5GMM cause IE is set to the 5GMM cause #69 \"insufficient resources for specific slice\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to S-NSSAI only based congestion control along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE;\n5a)\tthe 5GMM cause IE is set to the 5GMM cause #78 \"PLMN not allowed to operate at the present UE location\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded because the UE is registered to a PLMN via a satellite NG-RAN cell that is not allowed to operate at the present UE location along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message.\nAdditionally, if the cause is received from a statellite NG-RAN cell, the UE shall not send the UL NAS TRANSPORT message to transport any of the data types listed in subclause\u00a05.4.5.2.1. The UE shall store the PLMN identity and, if it is known, the current geographical location in the list of \"PLMNs not allowed to operate at the present UE location\" and shall start a corresponding timer instance (see subclause\u00a04.23.2). The UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5];\n6)\tthe 5GMM cause IE is set to the 5GMM cause #90 \"payload was not forwarded\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to routing failure along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message. The UE shall ignore the Back-off timer value IE, if any;\n7)\tthe 5GMM cause IE is set to the 5GMM cause #91 \"DNN not supported or not subscribed in the slice\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded because the DNN is not supported or not subscribed in a slice along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE, if any;\n8)\tthe 5GMM cause IE is set to the 5GMM cause #92 \"insufficient user-plane resources for the PDU session\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to insufficient user-plane resources along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message.\n9)\tthe 5GMM cause IE is set to the 5GMM cause #79 \"UAS services not allowed\", the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded because the UE is marked in the UE's 5GMM context that it is not allowed to request UAS services along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message.\ng1)\t\"N1 SM information\" and:\n1)\tthe 5GMM cause IE is set to the 5GMM cause other than any of the cause values specified in bullet g) above, the UE passes to the 5GSM sublayer an indication that the 5GSM message was not forwarded due to unexpected cause along with the 5GSM message from the Payload container IE of the DL NAS TRANSPORT message;\nh)\t\"UE policy container\", the UE policy container in the Payload container IE is handled in the UE policy delivery procedures specified in Annex\u00a0D;\ni)\t\"UE parameters update transparent container\" and if the Payload container IE\n1)\tsuccessfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]), the ME shall store the received UE parameter update counter as specified in annex\u00a0C and proceed as follows:\ni)\tif the UE parameters update list includes a UE parameters update data set with UE parameters update data set type indicating \"Routing indicator update data\",\nA)\tthe ME shall behave as if an SMS is received with protocol identifier set to SIM data download, data coding scheme set to class 2 message and SMS payload as secured packet contents of UE parameters update transparent container IE. The SMS payload is forwarded to UICC as specified in 3GPP\u00a0TS\u00a023.040\u00a0[4A]; and\nB)\tif the ACK bit of the UE parameters update header in the UE parameters update transparent container is set to \"acknowledgment requested\" and if the ME receives status bytes from the UICC indicating that the UICC has received the secured packet successfully, the ME shall send an acknowledgement in the Payload container IE of an UL NAS TRANSPORT message with Payload type IE set to \"UE parameters update transparent container\" as specified in subclause\u00a05.4.5.2.2; and\nC)\tif the ME receives a REFRESH command from the UICC as specified in 3GPP\u00a0TS\u00a031.111\u00a0[22A] and if the REG bit of the UE parameters update header in the UE parameters update transparent container IE is set to \"re-registration requested\", and:\nC1)\tthe UE is registered over 3GPP access, then the UE shall wait until the emergency services over 3GPP access, if any, are completed, enter 5GMM-IDLE mode over 3GPP access or 5GMM-CONNECTED mode with RRC inactive indication, perform a de-registration procedure, and then delete its 5G-GUTI if the UE is registered to different PLMN or SNPN on non-3GPP access or the UE is not registered over non-3GPP access, or wait until the de-registration procedure over non-3GPP access specified in case C2) or C3) is completed before deleting its 5G-GUTI if the UE is registered to same PLMN or SNPN on non-3GPP access, and then initiate a registration procedure for initial registration as specified in subclause\u00a05.5.1.2;\nC2)\tthe UE is registered over non-3GPP access and does not have emergency services ongoing over non-3GPP access, then the UE shall locally release the N1 NAS signalling connection and enter 5GMM-IDLE mode over non-3GPP access, perform a de-registration procedure, and then delete its 5G-GUTI if the UE is registered to different PLMN or SNPN on 3GPP access or the UE is not registered over 3GPP access, or wait until the de-registration procedure over 3GPP access specified in case C1) is completed before deleting its 5G-GUTI if the UE is registered to same PLMN or SNPN on 3GPP access, and then initiate a registration procedure for initial registration as specified in subclause 5.5.1.2; and\nC3)\tthe UE is registered over non-3GPP access and has an emergency services ongoing over non-3GPP access, then the UE shall wait until the emergency services are completed before locally releasing the N1 NAS signalling connection and enter 5GMM-IDLE mode over non-3GPP access, perform a de-registration procedure, and then delete its 5G-GUTI if the UE is registered to different PLMN or SNPN on 3GPP access or if the UE is not registered over 3GPP access, or wait until the de-registration procedure over 3GPP access specified in case C1) is completed before deleting its 5G-GUTI if the UE is registered to same PLMN or SNPN on 3GPP access, and then initiate a registration procedure for initial registration as specified in subclause 5.5.1.2.\nii)\tif the UE parameters update list includes a UE parameters update data set with UE parameters update data set type indicating \"Default configured NSSAI update data\",\nA)\tif the ACK bit of the UE parameters update header in the UE parameters update transparent container is set to \"acknowledgment requested\" and if the UE parameters update list does not include a UE parameters update data set with UE parameters update data set type indicating \"Routing indicator update data\", the ME shall send an acknowledgement in the Payload container IE of an UL NAS TRANSPORT message with Payload type IE set to \"UE parameters update transparent container\" as specified in subclause\u00a05.4.5.2.2\nB)\tthe ME shall replace the stored default configured NSSAI with the default configured NSSAI included in the default configured NSSAI update data. In case of SNPN, the ME shall replace the stored default configured NSSAI associated with the selected entry of the \"list of subscriber data\" or the PLMN subscription with the default configured NSSAI included in the default configured NSSAI update data; and\nC)\tif the REG bit of the UE parameters update header in the UE parameters update transparent container is set to \"re-registration requested\" and the UE parameters update list does not include a UE parameters update data set with UE parameters update data set type indicating \"Routing indicator update data\", the UE shall wait until it enters 5GMM-IDLE mode and then the UE shall initiate a registration procedure for mobility registration update as specified in subclause 5.5.1.3.\n\tif the UE parameters update list does not include a UE parameters update data set with UE parameters update data set type indicating \"Routing indicator update data\", the UE used the old default configured NSSAI to create the requested NSSAI in a REGISTRATION REQUEST message, because the UE does not have a configured NSSAI for the current PLMN or SNPN, and the UE has an stored allowed NSSAI for the current PLMN or SNPN which contains one or more S-NSSAIs that are not included in the new default configured NSSAI, the UE shall wait until it enters 5GMM-IDLE mode and then the UE shall initiate a registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3; and\niii)\tif the UE parameters update list includes a UE parameters update data set with UE parameters update data set type indicating \"Disaster roaming information update data\",\nA)\tif the ACK bit of the UE parameters update header in the UE parameters update transparent container is set to \"acknowledgment requested\" and if the UE parameters update list does not include a UE parameters update data set with UE parameters update data set type indicating \"Routing indicator update data\" or a UE parameters update data set with UE parameters update data set type indicating \"Default configured NSSAI update data\", the ME shall send an acknowledgement in the Payload container IE of an UL NAS TRANSPORT message with Payload type IE set to \"UE parameters update transparent container\" as specified in subclause\u00a05.4.5.2.2;\nB)\tthe UE shall delete the indication of whether disaster roaming is enabled in the UE stored in the ME, if any, and store the indication of whether disaster roaming is enabled in the UE included in the disaster roaming information update data in the ME;\nC)\tthe UE shall delete the indication of applicability of \"lists of PLMN(s) to be used in disaster condition\" provided by a VPLMN' stored in the ME, if any, and store the indication of 'applicability of \"lists of PLMN(s) to be used in disaster condition\" provided by a VPLMN' included in the disaster roaming information update data in the ME; and\nD)\tif the REG bit of the UE parameters update header in the UE parameters update transparent container is set to \"re-registration requested\" and the UE parameters update list does not include a UE parameters update data set with UE parameters update data set type indicating \"Routing indicator update data\", the UE shall wait until it enters 5GMM-IDLE mode and then the UE shall initiate a registration procedure for mobility registration update as specified in subclause 5.5.1.3.\niv)\tif the UE parameters update list includes a UE parameters update data set with UE parameters update data set type indicating \"ME routing indicator update data\":\nA)\tif the ACK bit of the UE parameters update header in the UE parameters update transparent container is set to \"acknowledgment requested\" and the UE parameters update list does not include a UE parameters update data set with UE parameters update data set type indicating \"Default configured NSSAI update data\", the ME shall send an acknowledgement in the Payload container IE of an UL NAS TRANSPORT message with Payload type IE set to \"UE parameters update transparent container\" as specified in subclause\u00a05.4.5.2.2;\nB)\tthe UE shall set or replace the routing indicator of the selected entry of the \"list of subscriber data\" with the routing indicator included in the ME routing indicator update data; and\nC)\tif the REG bit of the UE parameters update header in the UE parameters update transparent container IE is set to \"re-registration requested\", and:\nC1)\tthe UE is registered over 3GPP access and is not registered over non-3GPP access, then the UE shall wait until the emergency services over 3GPP access, if any, are completed, enter 5GMM-IDLE mode over 3GPP access or 5GMM-CONNECTED mode with RRC inactive indication, perform a de-registration procedure, delete its 5G-GUTI, and then initiate a registration procedure for initial registration as specified in subclause\u00a05.5.1.2;\nC2)\tthe UE is registered over non-3GPP access and is not registered over 3GPP access, then the UE shall locally release the N1 NAS signalling connection and enter 5GMM-IDLE mode over non-3GPP access, perform a de-registration procedure, delete its 5G-GUTI, and then initiate a registration procedure for initial registration as specified in subclause 5.5.1.2; or\nC3)\tthe UE is registered over 3GPP access and non-3GPP access to same SNPN, then the UE shall wait until the emergency services over 3GPP access, if any, are completed, enter 5GMM-IDLE mode over 3GPP access or 5GMM-CONNECTED mode with RRC inactive indication over 3GPP access, perform a de-registration procedure over 3GPP access, locally release the N1 NAS signalling connection and enter 5GMM-IDLE mode over non-3GPP access, perform a de-registration procedure over non-3GPP access, delete its 5G-GUTI and then initiate a registration procedure for initial registration as specified in subclause 5.5.1.2.\n2)\tdoes not successfully pass the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]) then the UE shall discard the content of the payload container IE;\nj)\t\"Location services message container\" and the 5GMM cause IE is not included in the DL NAS TRANSPORT message, the UE shall forward the payload container type, the content of the Payload container IE and the routing information in the Additional information IE if included to the upper layer location services application;\nk)\t\"CIoT user data container\" and the 5GMM cause IE is not included in the DL NAS TRANSPORT message, the UE shall forward the content of the Payload container IE and the PDU session ID to the 5GSM sublayer;\nl)\t\"CIoT user data container\" and:\n1)\tthe 5GMM cause IE is set to the 5GMM cause #22 \"Congestion\", the UE passes to the 5GSM sublayer an indication that the CIoT user data was not forwarded due to DNN based congestion control along with the CIoT user data from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE;\n2)\tthe 5GMM cause IE is set to the 5GMM cause #67 \"insufficient resources for specific slice and DNN\", the UE passes to the 5GSM sublayer an indication that the CIoT user data was not forwarded due to S-NSSAI and DNN based congestion control along with the CIoT user data from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE;\n3)\tthe 5GMM cause IE is set to the 5GMM cause #69 \"insufficient resources for specific slice\", the UE passes to the 5GSM sublayer an indication that the CIoT user data was not forwarded due to S-NSSAI only based congestion control along with the CIoT user data from the Payload container IE of the DL NAS TRANSPORT message, and the time value from the Back-off timer value IE; or\n4)\tthe 5GMM cause IE is set to the 5GMM cause #90 \"payload was not forwarded\", the UE passes to the 5GSM sublayer an indication that the user data container was not forwarded due to routing failure along with the user data container from the Payload container IE and the PDU session ID from the PDU session ID IE of the DL NAS TRANSPORT message;\nm)\t\"service-level-AA container\", the UE shall forward the content of the Payload container IE to the upper layers;\nm1)\t\"Event notification\", the UE shall forward the received event notification indicator(s) to the upper layers (see 3GPP\u00a0TS\u00a023.216\u00a0[6A] and 3GPP\u00a0TS\u00a024.237\u00a0[14AA] for the \"SRVCC handover cancelled, IMS session re-establishment required\" indicator);\nm2)\t\"UPP-CMI container\" and the 5GMM cause IE is not included in the DL NAS TRANSPORT message, the UE shall forward the payload container type, the content of the Payload container IE and the routing information included in the Additional information IE to the upper layer location services application for user plane connection management for user plane positioning;\nNOTE\u00a02:\tThe user plane connection establishment for user plane positioning connection management is specified in 3GPP\u00a0TS\u00a024.572\u00a0[64].\nm3)\t\"UPP-CMI container\" and the 5GMM cause IE is set to the 5GMM cause #94 \"User plane positioning not authorized\", the UE passes to the upper layer location services application an indication that user plane positioning is not authorized by the network; or\nn)\t\"Multiple payloads\", the UE shall first decode the content of the Payload container IE (see subclause\u00a09.11.3.39) to obtain the number of payload container entries and for each payload container entry, the UE shall:\n1)\tdecode the payload container type field;\n2)\tdecode the optional IE fields and the payload container contents field in the payload container entry; and\n3)\thandle the content of each payload container entry the same as the content of the Payload container IE and the associated optional IEs as specified in bullets a) to m3) above according to the payload container type field.\n5.4.6\t5GMM status procedure\n5.4.6.1\tGeneral\nThe purpose of the 5GMM status procedure is to report at any time in the 5GMM STATUS message certain error conditions detected upon receipt of 5GMM protocol data in the AMF or in the UE. The 5GMM STATUS message can be sent by both the AMF and the UE (see example in figure\u00a05.4.6.1).\n\nFigure\u00a05.4.6.1: 5GMM status procedure\n5.4.6.2\t5GMM status received in the UE\nOn receipt of a 5GMM STATUS message, no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible. The local actions to be taken by UE on receipt of a 5GMM STATUS message are implementation dependent.\n5.4.6.3\t5GMM status received in the network\nOn receipt of a 5GMM STATUS message in the AMF, no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible. The local actions to be taken by the AMF on receipt of a 5GMM STATUS message are implementation dependent.\n5.4.7\tNetwork slice-specific authentication and authorization procedure\n5.4.7.1\tGeneral\nThe purpose of the network slice-specific authentication and authorization procedure is to enable the authentication, authorization and accounting server (AAA-S) via the Network Slice Specific and SNPN Authentication and Authorization Function (NSSAAF) to (re-)authenticate or (re-)authorize the upper layers of the UE.\nThe network slice-specific authentication and authorization procedure can be invoked for a UE supporting network slice-specific authentication and authorization procedure and for a HPLMN S-NSSAI or an SNPN S-NSSAI (see subclauses\u00a05.15.10 and 5.30.2.9 in 3GPP\u00a0TS\u00a023.501\u00a0[8] and subclause\u00a04.2.9.2 of 3GPP\u00a0TS\u00a023.502\u00a0[9]).\nThe network (re-)authenticates the UE using the EAP as specified in IETF\u00a0RFC\u00a03748\u00a0[34].\nEAP has defined four types of EAP messages:\na)\tan EAP-request message;\nb)\tan EAP-response message;\nc)\tan EAP-success message; and\nd)\tan EAP-failure message.\nThe EAP-request message is transported from the network to the UE using the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message of the network slice-specific EAP message reliable transport procedure.\nThe EAP-response message to the EAP-request message is transported from the UE to the network using the NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message of the network slice-specific EAP message reliable transport procedure.\nIf the (re-)authentication of the UE completes successfully or unsuccessfully, the EAP-success message or the EAP-failure message, respectively, is transported from the network to the UE using the NETWORK SLICE-SPECIFIC AUTHENTICATION RESULT message of the network slice-specific result message transport procedure.\nThere can be several rounds of exchange of an EAP-request message and a related EAP-response message for the AAA-S via the NSSAAF to complete the (re-)authentication and (re-)authorization of the request for an S-NSSAI (see example in figure\u00a05.4.7.1.1).\nThe AMF shall set the authenticator retransmission timer specified in subclause\u00a04.3 of IETF\u00a0RFC\u00a03748\u00a0[34] to infinite value.\nNOTE:\tThe network slice-specific authentication and authorization procedure provides a reliable transport of EAP messages and therefore retransmissions at the EAP layer of the AMF do not occur.\n\nFigure\u00a05.4.7.1.1: Network slice-specific authentication and authorization procedure\n5.4.7.2\tNetwork slice-specific EAP message reliable transport procedure\n5.4.7.2.1\tNetwork slice-specific EAP message reliable transport procedure initiation\nIn order to initiate the network slice-specific EAP message reliable transport procedure, the AMF shall create a NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message.\nThe AMF shall set the EAP message IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message to the EAP-request message which is generated by the AMF or provided by the AAA-S via the NSSAAF.\nThe AMF shall set the S-NSSAI IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message to the HPLMN S-NSSAI or the SNPN S-NSSAI to which the EAP-request message is related.\nThe AMF shall send the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message and start timer T3575 per S-NSSAI (see example in figure\u00a05.4.7.1.1).\nUpon receipt of a NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message, the UE shall stop timer T3346 if running. The UE shall pass:\na)\tthe EAP-request message received in the EAP message IE; and\nb)\tthe HPLMN S-NSSAI or the SNPN S-NSSAI in the S-NSSAI IE;\nto the upper layers. Apart from this action, the network slice-specific authentication and authorization procedure is transparent to the 5GMM layer of the UE.\n5.4.7.2.2\tNetwork slice-specific EAP message reliable transport procedure accepted by the UE\nWhen the upper layers provide an EAP-response message associated with the HPLMN S-NSSAI or the SNPN S-NSSAI, the UE shall create a NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message.\nThe UE shall set the EAP message IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message to the EAP-response message.\nThe UE shall set the S-NSSAI IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message to the HPLMN S-NSSAI or the SNPN S-NSSAI associated with the EAP-response message.\nThe UE shall send the NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message. Apart from this action, the network slice-specific authentication and authorization procedure is transparent to the 5GMM layer of the UE.\nUpon receipt of a NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message, the AMF shall stop timer T3575 and:\na)\tpass the EAP-response message received in the EAP message IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message associated with the HPLMN S-NSSAI or the SNPN S-NSSAI in the S-NSSAI IE to the upper layers; or\nb)\tprovide the EAP-response message received in the EAP message IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message associated with the HPLMN S-NSSAI or the SNPN S-NSSAI in the S-NSSAI IE to the AAA-S via the NSSAAF.\n5.4.7.2.3\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tT3575 expiry\n\tThe AMF shall, on the first expiry of the timer T3575, retransmit the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message and shall reset and start timer T3575. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3575, the AMF shall abort the network slice-specific authentication and authorization procedure for the S-NSSAI. The AMF shall consider that the network slice-specific authentication and authorization procedure for the S-NSSAI is completed as a failure.\nb)\tLower layers indication of non-delivered NAS PDU due to handover\n\tIf the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message could not be delivered due to an intra AMF handover and the target TAI is included in the TAI list, then upon successful completion of the intra AMF handover the AMF shall retransmit the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message. If a failure of handover procedure is reported by the lower layer and the N1 NAS signalling connection exists, the AMF shall retransmit the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message.\nc)\tNetwork slice-specific authentication and authorization procedure and de-registration procedure collision\n\tIf the network receives a DEREGISTRATION REQUEST message before the ongoing network slice-specific authentication and authorization procedure has been completed and the access type included in the DEREGISTRATION REQUEST message is the same as the one for which the network slice-specific authentication and authorization procedure is ongoing, the network shall abort the network slice-specific authentication and authorization procedure and shall progress the UE-initiated de-registration procedure. The AMF may initiate the network slice-specific authentication and authorization procedure for the S-NSSAI which is completed as a failure, if available. If the access type included in the DEREGISTRATION REQUEST message is different from the one for which the network slice-specific authentication and authorization procedure is ongoing, the network shall proceed with both procedures.\nd)\tNetwork slice-specific authentication and authorization procedure and service request procedure collision\n\tIf the network receives a SERVICE REQUEST message before the ongoing network slice-specific authentication and authorization procedure has been completed and the SERVICE REQUEST message includes the UE request type IE with the Request type value set to \"NAS signalling connection release\", the network shall abort the network slice-specific authentication and authorization procedure and shall progress the service request procedure.\n\tIf the network receives a SERVICE REQUEST message before the ongoing network slice-specific authentication and authorization procedure has been completed and the SERVICE REQUEST message does not include UE request type IE with the Request type value set to \"NAS signalling connection release\", both procedures shall be progressed.\ne)\tNetwork slice-specific authentication and authorization procedure and registration procedure for mobility and periodic registration update collision \n\tIf the network receives a REGISTRATION REQUEST message before the ongoing network slice-specific authentication and authorization procedure has been completed and the REGISTRATION REQUEST message includes the Unavailability information IE, the network shall abort the network slice-specific authentication and authorization procedure and shall progress the registration procedure for mobility and periodic registration update procedure.\n\tIf the network receives a REGISTRATION REQUEST message before the ongoing network slice-specific authentication and authorization procedure has been completed and the REGISTRATION REQUEST message does not include the Unavailability information IE, both procedures shall be progressed.\n5.4.7.2.4\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tTransmission failure of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message with change in the current TAI\n\tIf the current TAI is not in the TAI list, the network slice-specific authentication and authorization procedure shall be aborted and:\n-\tif the UE is in 5GMM-REGISTERED state, a registration procedure for mobility and periodic registration update indicating \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message shall be initiated; and\n-\totherwise a registration procedure for initial registration shall be initiated.\nb)\tTransmission failure of NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message indication without change in the current TAI\n\tIt is up to the UE implementation how to re-run the ongoing procedure that triggered the network slice-specific authentication and authorization procedure.\nc)\tNetwork slice-specific authentication and authorization procedure and de-registration procedure collision\n\tIf the UE receives NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message after sending a DEREGISTRATION REQUEST message and the access type included in the DEREGISTRATION REQUEST message is the same as the access in which the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message is received, then the UE shall ignore the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message and proceed with the de-registration procedure. Otherwise, the UE shall proceed with both procedures.\nd)\tNetwork slice-specific authentication and authorization procedure and service request procedure collision\n\tIf the SERVICE REQUEST message includes the UE request type IE with the Request type value set to \"NAS signalling connection release\" and the UE receives a NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message before the ongoing service request procedure has been completed, the UE shall ignore the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message and proceed with the service request procedure.\n\tIf the the SERVICE REQUEST message does not include the UE request type IE with the Request type value set to \"NAS signalling connection release\" and the UE receives a NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message before the ongoing service request procedure has been completed, the UE shall proceed with both procedures.\ne)\tNetwork slice-specific authentication and authorization procedure and registration procedure for mobility and periodic registration update collision\n\tIf the REGISTRATION REQUEST message includes the Unavailability information IE and the UE receives a NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message before the ongoing registration procedure for mobility and periodic registration update has been completed, the UE shall ignore the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message and proceed with the registration procedure for mobility and periodic registration update procedure.\n\tIf the the REGISTRATION REQUEST message does not include the Unavailability information IE and the UE receives a NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message before the ongoing registration procedure for mobility and periodic registration update has been completed, the UE shall proceed with both procedures.\n5.4.7.3\tNetwork slice-specific EAP result message transport procedure\n5.4.7.3.1\tNetwork slice-specific EAP result message transport procedure initiation\nIn order to initiate the network slice-specific EAP result message transport procedure, the AMF shall create a NETWORK SLICE-SPECIFIC AUTHENTICATION RESULT message.\nThe AMF shall set the EAP message IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION RESULT message to the EAP-success or EAP-failure message provided by the AAA-S via the NSSAAF.\nThe AMF shall set the S-NSSAI IE of the NETWORK SLICE-SPECIFIC AUTHENTICATION RESULT message to the HPLMN S-NSSAI or the SNPN S-NSSAI to which the EAP-success or EAP-failure message is related.\nThe AMF shall send the NETWORK SLICE-SPECIFIC AUTHENTICATION RESULT message. The AMF shall retain the authentication result for the UE and the HPLMN S-NSSAI or the SNPN S-NSSAI while the UE is registered to the PLMN (see subclause\u00a05.15.10 in 3GPP\u00a0TS\u00a023.501\u00a0[8]).\nUpon receipt of a NETWORK SLICE-SPECIFIC AUTHENTICATION RESULT message, the UE shall pass:\na)\tthe EAP-success or EAP-failure message received in the EAP message IE; and\nb)\tthe HPLMN S-NSSAI or the SNPN S-NSSAI in the S-NSSAI IE;\nto the upper layers. Apart from this action, the network slice-specific authentication and authorization procedure is transparent to the 5GMM layer of the UE.\n5.5\t5GMM specific procedures\n5.5.1\tRegistration procedure\n5.5.1.1\tGeneral\nThe registration procedure is always initiated by the UE and used for initial registration as specified in subclause\u00a05.5.1.2.2 or mobility and periodic registration update as specified in subclause\u00a05.5.1.3.2.\nWhen the UE needs to initiate registration over both 3GPP access and non-3GPP access in the same PLMN (e.g. the 3GPP access and the selected N3IWF are located in the same PLMN), the UE:\na)\tin 5GMM-REGISTERED-INITIATED over 3GPP access shall not initiate registration over non-3GPP access; or\nb)\tin 5GMM-REGISTERED-INITIATED over non-3GPP access shall not initiate registration over 3GPP access.\nNOTE\u00a01:\tTo which access (i.e. 3GPP access or non-3GPP access) the UE initiates registration first is up to UE implementation.\nWhen the UE is registered with a PLMN over a non-3GPP access, the AMF and the UE maintain:\na)\tregistration state and state machine over non-3GPP access;\nb)\t5G NAS security context;\nc)\t5G-GUTI;\nd)\tregistration area for non-3GPP access, which is associated with a single TAI; and\ne)\tnon-3GPP de-registration timer in the UE and non-3GPP implicit de-registration timer in the AMF.\nA registration attempt counter is used to limit the number of subsequently rejected registration attempts. The registration attempt counter shall be incremented as specified in subclause\u00a05.5.1.2.7 or subclause\u00a05.5.1.3.7. Depending on the value of the registration attempt counter, specific actions shall be performed. The registration attempt counter shall be reset when:\n-\tthe UE is powered on;\n-\ta USIM is inserted;\n-\ta registration procedure is successfully completed;\n-\tan EPS attach, combined EPS attach procedure, a normal or periodic tracking area updating or a combined tracking area updating procedure is successfully completed in S1 mode and the UE is operating in single-registration mode. In this case, the UE shall reset the registration attempt counter for 3GPP access;\nNOTE\u00a02:\tThe registration attempt counter for non-3GPP access is not impacted by the EPS attach and the combined EPS attach procedure.\n-\ta registration procedure is rejected with cause #11, #12, #13, #15, #27, #31, #62, #72, #73, #74, #75, #76, #77 or #78;\n-\ta registration procedure is rejected with cause #3, #6 or #7, the REGISTRATION REJECT message is received without integrity protection and the counter for \"SIM/USIM considered invalid for GPRS services\" events has a value less than a UE implementation-specific maximum value.\n-\ta network initiated de-registration procedure is completed with cause #11, #12, #13, #15, #27; #62, #72, #74, #75, #76, #77 or #78; or\n-\ta new PLMN or SNPN is selected.\nAdditionally, the registration attempt counter shall be reset when the UE is in substate 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION or 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE, and:\n-\tthe current TAI is changed;\n-\ttimer T3502 expires; or\n-\ttimer T3346 is started.\nWhen the registration attempt counter is reset, the UE shall stop timer T3519 if running, and delete any stored SUCI.\nThe lower layers indicate to NAS whether the network supports emergency services for the UE in limited service state (see 3GPP\u00a0TS\u00a038.331\u00a0[30]). This information is taken into account when deciding whether to initiate an initial registration for emergency services.\n5.5.1.2\tRegistration procedure for initial registration\n5.5.1.2.1\tGeneral\nThis procedure can be used by a UE for initial registration for 5GS services.\nWhen the UE initiates the registration procedure for initial registration, the UE shall indicate \"initial registration\" in the 5GS registration type IE. When the UE initiates the registration procedure for emergency services, the UE shall indicate \"emergency registration\" in the 5GS registration type IE. When the UE initiates the initial registration for onboarding services in SNPN, the UE shall indicate \"SNPN onboarding registration\" in the 5GS registration type IE. When the UE initiates the initial registration procedure for disaster roaming services, the UE shall indicate \"disaster roaming initial registration\" in the 5GS registration type IE.\nIf the MUSIM UE initiates the registration procedure for initial registration and indicates \"emergency registration\" in the 5GS registration type IE in the REGISTRATION REQUEST message, the network shall not indicate the support of:\n-\tthe N1 NAS signalling connection release;\n-\tthe paging indication for voice services;\n-\tthe reject paging request; or\n-\tthe paging restriction;\nin the REGISTRATION ACCEPT message.\n5.5.1.2.2\tInitial registration initiation\nThe UE in state 5GMM-DEREGISTERED shall initiate the registration procedure for initial registration by sending a REGISTRATION REQUEST message to the AMF,\na)\twhen the UE performs initial registration for 5GS services;\nb)\twhen the UE performs initial registration for emergency services;\nc)\twhen the UE performs initial registration for SMS over NAS;\nd)\twhen the UE moves from GERAN to NG-RAN coverage or the UE moves from a UTRAN to NG-RAN coverage and the following applies:\n1)\tthe UE initiated a GPRS attach or routing area updating procedure while in A/Gb mode or Iu mode; or\n2)\tthe UE has performed 5G-SRVCC from NG-RAN to UTRAN as specified in 3GPP\u00a0TS\u00a023.216\u00a0[6A],\n\tand since then the UE did not perform a successful EPS attach or tracking area updating procedure in S1 mode or registration procedure in N1 mode;\ne)\twhen the UE performs initial registration for onboarding services in SNPN;\nf)\twhen the UE performs initial registration for disaster roaming services; and\ng)\twhen the UE performs initial registration to come out of unavailability period and resume normal services;\nwith the following clarifications to initial registration for emergency services:\na)\tthe UE shall not initiate an initial registration for emergency services over the current access, if the UE is already registered for emergency services over the non-current access, unless the initial registration has to be initiated to perform handover of an existing emergency PDU session from the non-current access to the current access; and\nNOTE\u00a01:\tTransfer of an existing emergency PDU session between 3GPP access and non-3GPP access is needed e.g. if the UE determines that the current access is no longer available.\nb)\tthe UE can only initiate an initial registration for emergency services over non-3GPP access if it cannot register for emergency services over 3GPP access.\nThe UE initiates the registration procedure for initial registration by sending a REGISTRATION REQUEST message to the AMF, starting timer T3510. If timer T3502 is currently running, the UE shall stop timer T3502. If timer T3511 is currently running, the UE shall stop timer T3511.\nDuring initial registration the UE handles the 5GS mobile identity IE in the following order:\na)\tif:\n1)\tthe UE:\ni)\twas previously registered in S1 mode before entering state EMM-DEREGISTERED; and\nii)\thas received an \"interworking without N26 interface not supported\" indication from the network; and\n2)\tEPS security context and a valid native 4G-GUTI are available;\n\tthen the UE shall create a 5G-GUTI mapped from the valid native 4G-GUTI as specified in 3GPP\u00a0TS\u00a023.003\u00a0[4] and indicate the mapped 5G-GUTI in the 5GS mobile identity IE. The UE shall include the UE status IE with the EMM registration status set to \"UE is not in EMM-REGISTERED state\" and shall include an ATTACH REQUEST message as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] in the EPS NAS message container IE.\n\tAdditionally, if the UE holds a valid 5G-GUTI, the UE shall include the 5G-GUTI in the Additional GUTI IE in the REGISTRATION REQUEST message in the following order:\n1)\ta valid 5G-GUTI that was previously assigned by the same PLMN with which the UE is performing the registration, if available;\n2)\ta valid 5G-GUTI that was previously assigned by an equivalent PLMN, if available; and\n3)\ta valid 5G-GUTI that was previously assigned by any other PLMN, if available;\nb)\tif:\n1)\tthe UE is registering with a PLMN and the UE holds a valid 5G-GUTI that was previously assigned, over 3GPP access or non-3GPP access, by the same PLMN with which the UE is performing the registration, the UE shall indicate the 5G-GUTI in the 5GS mobile identity IE; or\n2)\tthe UE is registering with a SNPN, the UE holds a valid 5G-GUTI that was previously assigned, over 3GPP access or non-3GPP access, by the same SNPN with which the UE is performing the registration, and the UE is not initiating the initial registration for onboarding services in SNPN, the UE shall indicate the 5G-GUTI in the 5GS mobile identity IE;\nc)\tif:\n1)\tthe UE is registering with a PLMN and the UE holds a valid 5G-GUTI that was previously assigned, over 3GPP access or non-3GPP access, by an equivalent PLMN, the UE shall indicate the 5G-GUTI in the 5GS mobile identity IE; or\n2)\tthe UE is registering with an SNPN, the UE holds a valid 5G-GUTI that was previously assigned, over 3GPP access or non-3GPP access, by an equivalent SNPN identified by a globally unique SNPN identity, and the UE is not initiating the initial registration for onboarding services in SNPN, the UE shall indicate the 5G-GUTI in the 5GS mobile identity IE and shall additionally include the NID of the equivalent SNPN in the NID IE;\nd)\tif:\n1)\tthe UE is registering with a PLMN and the UE holds a valid 5G-GUTI that was previously assigned, over 3GPP access or non-3GPP access, by any other PLMN, the UE shall indicate the 5G-GUTI in the 5GS mobile identity IE; or\n2)\tthe UE is registering with an SNPN, the UE holds a valid 5G-GUTI that was previously assigned, over 3GPP access or non-3GPP access, by any other SNPN identified by a globally unique SNPN identity, and the UE is not initiating the initial registration for onboarding services in SNPN, the UE shall indicate the 5G-GUTI in the 5GS mobile identity IE and shall additionally include the NID of the other SNPN in the NID IE;\ne)\tif a SUCI other than an onboarding SUCI is available, and the UE is not initiating the initial registration for onboarding services in SNPN, the UE shall include the SUCI other than an onboarding SUCI in the 5GS mobile identity IE;\nf)\tif the UE does not hold a valid 5G-GUTI or SUCI other than an onboarding SUCI, and is initiating the initial registration for emergency services, the PEI shall be included in the 5GS mobile identity IE; and\ng)\tif the UE is initiating the initial registration for onboarding services in SNPN, an onboarding SUCI shall be included in the 5GS mobile identity IE.\nNOTE\u00a02:\tThe AMF in ON-SNPN uses the onboarding SUCI as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8].\nIf the SUCI is included in the 5GS mobile identity IE and the timer T3519 is not running, the UE shall start timer T3519 and store the value of the SUCI sent in the REGISTRATION REQUEST message. The UE shall include the stored SUCI in the REGISTRATION REQUEST message while timer T3519 is running.\nIf the UE is operating in the dual-registration mode and it is in EMM state EMM-REGISTERED, the UE shall include the UE status IE with the EMM registration status set to \"UE is in EMM-REGISTERED state\".\nNOTE\u00a03:\tInclusion of the UE status IE with this setting corresponds to the indication that the UE is \"moving from EPC\" as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9].\nNOTE\u00a04:\tThe value of the 5GMM registration status included by the UE in the UE status IE is not used by the AMF.\nIf the last visited registered TAI is available, the UE shall include the last visited registered TAI in the REGISTRATION REQUEST message.\nNOTE\u00a05:\tThe AMF can use the last visited registered TAI included in the REGISTRATION REQUEST message, if available, in the procedure of slice-based N3IWF selection as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9] when the registration procedure is performed over non-3gpp access.\nIf the UE requests the use of SMS over NAS, the UE shall include the 5GS update type IE in the REGISTRATION REQUEST message with the SMS requested bit set to \"SMS over NAS supported\". When the 5GS update type IE is included in the REGISTRATION REQUEST for reasons other than requesting the use of SMS over NAS, and the UE does not need to register for SMS over NAS, the UE shall set the SMS requested bit of the 5GS update type IE to \"SMS over NAS not supported\" in the REGISTRATION REQUEST message.\nIf the UE supports MICO mode and requests the use of MICO mode, then the UE shall include the MICO indication IE in the REGISTRATION REQUEST message. If the UE requests to use an active time value, it shall include the active time value in the T3324 IE in the REGISTRATION REQUEST message. If the UE includes the T3324 IE, it may also request a particular T3512 value by including the Requested T3512 IE in the REGISTRATION REQUEST message. Additionally, if the UE supports strictly periodic registration timer, the UE shall set the Strictly Periodic Registration Timer Indication bit of the MICO indication IE in the REGISTRATION REQUEST message to \"strictly periodic registration timer supported\".\nIf the UE needs to use the UE specific DRX parameters, the UE shall include the Requested DRX parameters IE in the REGISTRATION REQUEST message.\nIf the UE is in NB-N1 mode and if the UE needs to use the UE specific DRX parameters for NB-N1 mode, the UE shall include the Requested NB-N1 mode DRX parameters IE in the REGISTRATION REQUEST message.\nIf the UE supports eDRX and requests the use of eDRX, the UE shall include the Requested extended DRX parameters IE in the REGISTRATION REQUEST message.\nIf the UE needs to request LADN information for specific LADN DNN(s) or indicates a request for LADN information as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall include the LADN indication IE in the REGISTRATION REQUEST message and:\n-\trequest specific LADN DNNs by including a LADN DNN value in the LADN indication IE for each LADN DNN for which the UE requests LADN information; or\n-\tto indicate a request for LADN information by not including any LADN DNN value in the LADN indication IE.\nThe UE shall include the requested NSSAI containing the S-NSSAI(s) corresponding to the slice(s) to which the UE intends to register with and shall include the mapped S-NSSAI(s) for the requested NSSAI, if available, in the REGISTRATION REQUEST message. If the UE has allowed NSSAI or configured NSSAI or both for the current PLMN or SNPN, the requested NSSAI shall be either:\na)\tthe configured NSSAI for the current PLMN or SNPN, or a subset thereof as described below;\nb)\tthe allowed NSSAI for the current PLMN or SNPN, or a subset thereof as described below; or\nc)\tthe allowed NSSAI for the current PLMN or SNPN, or a subset thereof as described below, plus the configured NSSAI for the current PLMN or SNPN, or a subset thereof as described below.\nIf both the S-NSSAI to be replaced and the alternative S-NSSAI are included in the configured NSSAI, and the UE needs to request the S-NSSAI to be replaced, the UE shall include the S-NSSAI to be replaced in the requested NSSAI.\nIf the UE supports the S-NSSAI time validity information, S-NSSAI time validity information is available for an S-NSSAI, and the S-NSSAI time validity information indicates that the S-NSSAI is not available, the UE shall not include the S-NSSAI in the Requested NSSAI IE of the REGISTRATION REQUEST message. If the UE has S-NSSAI time validity information over the other access in the same PLMN and the S-NSSAI time validity information indicates that the S-NSSAI is not available, the UE shall not include the S-NSSAI in the Requested NSSAI IE of the REGISTRATION REQUEST message for the current access type.\nIf the UE has neither allowed NSSAI for the current PLMN or SNPN nor configured NSSAI for the current PLMN or SNPN and has a default configured NSSAI, the UE shall:\na)\tinclude the S-NSSAI(s) in the Requested NSSAI IE of the REGISTRATION REQUEST message using the default configured NSSAI; and\nb)\tinclude the Network slicing indication IE with the Default configured NSSAI indication bit set to \"Requested NSSAI created from default configured NSSAI\" in the REGISTRATION REQUEST message.\nIf the UE has no allowed NSSAI for the current PLMN or SNPN, no configured NSSAI for the current PLMN or SNPN, and no default configured NSSAI, the UE shall not include a requested NSSAI in the REGISTRATION REQUEST message.\nIf all the S-NSSAI(s) corresponding to the slice(s) to which the UE intends to register are included in the pending NSSAI, the UE shall not include a requested NSSAI in the REGISTRATION REQUEST message.\nThe subset of configured NSSAI provided in the requested NSSAI consists of one or more S-NSSAIs in the configured NSSAI applicable to the current PLMN or SNPN, where any included S-NSSAI is:\na)\tneither in the rejected NSSAI nor associated to an S-NSSAI in the rejected NSSAI. If the UE is inside the NS-AoS of an S-NSSAI in the rejected NSSAI with a rejection cause value set to \"S-NSSAI not available in the current registration area\", the S-NSSAI may be included in the requested NSSAI; or\nb)\tin the partially rejected NSSAI and the current TAI is not in the list of TAs for which the S-NSSAI is rejected. If the UE is inside the NS-AoS of an S-NSSAI in the partially rejected NSSAI and the current TAI is in the list of TAs for which the S-NSSAI is rejected, the S-NSSAI may be included in the requested NSSAI.\nIn addition, if the NSSRG information is available, the subset of configured NSSAI provided in the requested NSSAI shall be associated with at least one common NSSRG value. The UE may also include in the requested NSSAI, the S-NSSAI(s) which were added to configured NSSAI in S1 mode and for which the associated NSSRG information is not available. If the UE is in 5GMM-REGISTERED state over the other access and has already an allowed NSSAI for the other access in the same PLMN or in different PLMNs, all the S-NSSAI(s) in the requested NSSAI for the current access shall share at least an NSSRG value common to all the S-NSSAI(s) of the allowed NSSAI for the other access. If the UE is simultaneously performing the registration procedure on the other access in different PLMNs, the UE shall include S-NSSAIs that share at least a common NSSRG value across all access types. If the UE has pending NSSAI which the UE is still interested in using, then S-NSSAIs in the pending NSSAI and requested NSSAI shall be associated with at least one common NSSRG value.\nNOTE\u00a06:\tIf the UE has stored mapped S-NSSAI(s) for the rejected NSSAI, and one or more S-NSSAIs in the stored mapped S-NSSAI(s) for the configured NSSAI are not included in the stored mapped S-NSSAI(s) for the rejected NSSAI, then a S-NSSAI in the configured NSSAI associated to one or more of these mapped S-NSSAI(s) for the configured NSSAI are available to be included in the requested NSSAI together with their mapped S-NSSAI.\nNOTE\u00a07:\tIf one or more mapped S-NSSAIs in the stored mapped S-NSSAI(s) for the configured NSSAI are not included in the stored rejected NSSAI for the failed or revoked NSSAA, a S-NSSAI in the configured NSSAI associated to one or more of these mapped S-NSSAI(s) for the configured NSSAI are available to be included in the registration request together with their mapped S-NSSAI.\nNOTE\u00a08:\tThere is no need to consider the case that the UE is simultaneously performing the registration procedure on the other access in the same PLMN, due to that the UE is not allowed to initiate the registration procedure over one access when the registration over the other access to the same PLMN is going on.\nThe subset of allowed NSSAI provided in the requested NSSAI consists of one or more S-NSSAIs in the allowed NSSAI for the current PLMN.\nNOTE\u00a09:\tHow the UE selects the subset of configured NSSAI or allowed NSSAI to be provided in the requested NSSAI is implementation specific. The UE can take preferences indicated by the upper layers (e.g. policies like URSP, applications) and UE local configuration into account.\nNOTE\u00a010:\tThe number of S-NSSAI(s) included in the requested NSSAI cannot exceed eight.\nIf the UE initiates an initial registration for onboarding services in SNPN, the UE shall not include the Requested NSSAI IE in the REGISTRATION REQUEST message.\nIf the UE supports NSAG, the UE shall set the NSAG bit to \"NSAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports sending of REGISTRATION COMPLETE message for acknowledging the reception of NSAG information IE in the REGISTRATION ACCEPT message, the UE shall set the RCMAN bit to \"Sending of REGISTRATION COMPLETE message for NSAG information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE initiates an initial registration for emergency services or needs to prolong the established NAS signalling connection after the completion of the initial registration procedure (e.g. due to uplink signalling pending), the UE shall set the Follow-on request indicator to \"Follow-on request pending\".\nNOTE\u00a011:\tThe UE does not have to set the Follow-on request indicator to 1, even if the UE has to request resources for V2X communication over PC5 reference point, 5G ProSe direct discovery over PC5, 5G ProSe direct communication over PC5 or A2X communication over PC5 reference point.\nIf the UE supports S1 mode and the UE has not disabled its E-UTRA capability and the 5GS registration type IE in the REGISTRATION REQUEST message is not set to \"disaster roaming initial registration\", the UE shall:\n-\tset the S1 mode bit to \"S1 mode supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message;\n-\tinclude the S1 UE network capability IE in the REGISTRATION REQUEST message; additionally, if the UE supports EPS-UPIP, the UE shall set the EPS-UPIP bit to \"EPS-UPIP supported\" in the S1 UE network capability IE in the REGISTRATION REQUEST message; and\n-\tif the UE supports sending an ATTACH REQUEST message containing a PDN CONNECTIVITY REQUEST message with request type set to \"handover\" to transfer a PDU session from N1 mode to S1 mode, set the HO attach bit to \"attach request message containing PDN connectivity request with request type set to handover to transfer PDU session from N1 mode to S1 mode supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the LTE positioning protocol (LPP) in N1 mode as specified in 3GPP\u00a0TS\u00a037.355\u00a0[26], the UE shall set the LPP bit to \"LPP in N1 mode supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the Location Services (LCS) notification mechanisms in N1 mode as specified in 3GPP\u00a0TS\u00a023.273\u00a0[6B], the UE shall set the 5G-LCS bit to \"LCS notification mechanisms supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the user plane positioning using LCS-UPP as specified in 3GPP\u00a0TS\u00a023.273\u00a0[6B], the UE shall set the LCS-UPP bit to \"LCS-UPP user plane positioning supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the user plane positioning using SUPL as described in 3GPP\u00a0TS\u00a038.305\u00a0[67] and 3GPP\u00a0TS\u00a023.271\u00a0[68], the UE shall set the SUPL bit to \"SUPL user plane positioning supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports network verified UE location over satellite NG-RAN as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the NVL-SATNR bit to \"Network verified UE location over satellite NG-RAN supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE is in NB-N1 mode, then the UE shall set the Control plane CIoT 5GS optimization bit to \"Control plane CIoT 5GS optimization supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE is capable of NB-S1 mode, then the UE shall set the Control plane CIoT EPS optimization bit to \"Control plane CIoT EPS optimization supported\" in the S1 UE network capability IE of the REGISTRATION REQUEST message.\nIf the UE supports N3 data transfer and multiple user-plane resources in NB-N1 mode (see 3GPP\u00a0TS\u00a036.306\u00a0[25D], 3GPP\u00a0TS\u00a036.331\u00a0[25A]), then the UE shall set the Multiple user-plane resources support bit to \"Multiple user-plane resources supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports 5G-SRVCC from NG-RAN to UTRAN as specified in 3GPP\u00a0TS\u00a023.216\u00a0[6A], the UE shall:\n-\tset the 5G-SRVCC from NG-RAN to UTRAN capability bit to \"5G-SRVCC from NG-RAN to UTRAN supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message; and\n-\tinclude the Mobile station classmark\u00a02 IE and the Supported codecs IE in the REGISTRATION REQUEST message.\nIf the UE supports service gap control, then the UE shall set the SGC bit to \"service gap control supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the restriction on use of enhanced coverage, the UE shall set the RestrictEC bit to \"Restriction on use of enhanced coverage supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports network slice-specific authentication and authorization, the UE shall set the NSSAA bit to \"network slice-specific authentication and authorization supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports CAG feature, the UE shall set the CAG bit to \"CAG Supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports extended CAG information list, the UE shall set the Ex-CAG bit to \"Extended CAG information list supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports enhanced CAG information, the UE shall set the ECI bit to \"enhanced CAG information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports network slice replacement, the UE shall set the NSR bit to \"network slice replacement supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports sending of REGISTRATION COMPLETE message for acknowledging the reception of Negotiated PEIPS assistance information IE in the REGISTRATION ACCEPT message, the UE shall set the RCMP bit to \"Sending of REGISTRATION COMPLETE message for negotiated PEIPS assistance information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nWhen the UE is not in NB-N1 mode, if the UE supports RACS, the UE shall:\na)\tset the RACS bit to \"RACS supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message;\nb)\tif the UE has an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN or SNPN, include the applicable network-assigned UE radio capability ID in the UE radio capability ID IE of the REGISTRATION REQUEST message; and\nc)\tif the UE:\n1)\tdoes not have an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN or SNPN; and\n2)\thas an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration,\n\tinclude the applicable manufacturer-assigned UE radio capability ID in the UE radio capability ID IE of the REGISTRATION REQUEST message.\nIf the UE has one or more stored UE policy sections:\n-\tidentified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN; or\n-\tidentified by a UPSI with the PLMN ID part indicating the PLMN ID part of the SNPN identity of the selected SNPN and associated with the NID of the selected SNPN;\nthen the UE shall set the Payload container type IE to \"UE policy container\" and include the UE STATE INDICATION message (see annex\u00a0D) in the Payload container IE of the REGISTRATION REQUEST message.\nIf the UE does not have any stored UE policy section:\n-\tidentified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN; or\n-\tidentified by a UPSI with the PLMN ID part indicating the PLMN ID part of the SNPN identity of the selected SNPN and associated with the NID of the selected SNPN;\nand the UE needs to send a UE policy container to the network, then the UE shall set the Payload container type IE to \"UE policy container\" and include the UE STATE INDICATION message (see annex\u00a0D) in the Payload container IE of the REGISTRATION REQUEST message.\nNOTE\u00a012:\tIn this version of the protocol, the UE can only include the Payload container IE in the REGISTRATION REQUEST message to carry a payload of type \"UE policy container\".\nIf the UE does not have a valid 5G NAS security context, the UE shall send the REGISTRATION REQUEST message without including the NAS message container IE. The UE shall include the entire REGISTRATION REQUEST message (i.e. containing cleartext IEs and non-cleartext IEs, if any) in the NAS message container IE that is sent as part of the SECURITY MODE COMPLETE message as described in subclauses\u00a04.4.6 and\u00a05.4.2.3.\nIf the UE has a valid 5G NAS security context and the UE needs to send non-cleartext IEs, the UE shall send a REGISTRATION REQUEST message including the NAS message container IE as described in subclause\u00a04.4.6. If the UE does not need to send non-cleartext IEs, the UE shall send a REGISTRATION REQUEST message without including the NAS message container IE.\nIf the UE supports ciphered broadcast assistance data and needs to obtain new ciphering keys, the UE shall include the Additional information requested IE with the CipherKey bit set to \"ciphering keys for ciphered broadcast assistance data requested\" in the REGISTRATION REQUEST message.\nThe UE shall set the WUSA bit to \"WUS assistance information reception supported\" in the 5GMM capability IE if the UE supports WUS assistance information. The UE may include its UE paging probability information in the Requested WUS assistance information IE if the UE has set the WUSA bit to \"WUS assistance information reception supported\" in the 5GMM capability IE and the UE is not performing the initial registration for emergency services.\nThe UE shall set the NR-PSSI bit to \"NR paging subgrouping supported\" in the 5GMM capability IE if the UE supports PEIPS assistance information and the 5GS registration type IE in the REGISTRATION REQUEST message is not set to \"emergency registration\". The UE may include its UE paging probability information in the Requested PEIPS assistance information IE if the UE has set the NR-PSSI bit to \"NR paging subgrouping supported\" in the 5GMM capability IE.\nIf the REGISTRATION REQUEST message includes a NAS message container IE, the AMF shall process the REGISTRATION REQUEST message that is obtained from the NAS message container IE as described in subclause\u00a04.4.6.\nIf the UE supports V2X as specified in 3GPP\u00a0TS\u00a024.587\u00a0[19B], the UE shall set the V2X bit to \"V2X supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports V2X communication over E-UTRA-PC5 as specified in 3GPP\u00a0TS\u00a024.587\u00a0[19B], the UE shall set the V2XCEPC5 bit to \"V2X communication over E-UTRA-PC5 supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports V2X communication over NR-PC5 as specified in 3GPP\u00a0TS\u00a024.587\u00a0[19B], the UE shall set the V2XCNPC5 bit to \"V2X communication over NR-PC5 supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nThe UE shall set the ER-NSSAI bit to \"Extended rejected NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the NSSRG, then the UE shall set the NSSRG bit to \"NSSRG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the W-AGF acting on behalf of an N5GC device initiates an initial registration as specified in 3GPP\u00a0TS\u00a023.316\u00a0[6D], the W-AGF acting on behalf of the N5GC device shall include the N5GC indication IE with the N5GC device indication bit set to \"N5GC device registration is requested\" in the REGISTRATION REQUEST message.\nIf the 5G-RG acting on behalf of an AUN3 device initiates an initial registration as specified in 3GPP\u00a0TS\u00a023.316\u00a0[6D], the 5G-RG acting on behalf of an AUN3 device shall include the AUN3 indication IE with the AUN3 device indication bit set to \"AUN3 device registration is requested\" in the REGISTRATION REQUEST message.\nIf the UE supports UAS services, the UE shall set the UAS bit to \"UAS services supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports A2X over E-UTRA-PC5 as specified in 3GPP\u00a0TS\u00a024.577\u00a0[60], the UE shall set the A2XEPC5 bit to \"A2X over E-UTRA-PC5 supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports A2X over NR-PC5 as specified in 3GPP\u00a0TS\u00a024.577\u00a0[60], the UE shall set the A2XNPC5 bit to \"A2X over NR-PC5 supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports A2X over Uu as specified in 3GPP\u00a0TS\u00a024.577\u00a0[60], the UE shall set the A2X-Uu bit to \"A2X over Uu supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nWhen the UE supporting UAS services initiates an initial registration for UAS services, the UE shall include the service-level device ID in the Service-level-AA container IE of the REGISTRATION REQUEST message and set the value to the CAA-level UAV ID. The UE shall include the service-level-AA server address in the Service-level-AA container IE of the REGISTRATION REQUEST message and set the value to the USS address, if it is provided by the upper layers. The UE shall include the service-level-AA payload in the Service-level-AA container IE of the REGISTRATION REQUEST message and shall set the service-level-AA payload type, if the service-level-AA payload is provided by upper layers.\nNOTE\u00a013:\tThe service-level-AA payload can be of type \"C2 authorization payload\". The C2 authorization payload can include one or both of an indication of the request for direct C2 communication and pairing information for direct C2 communication.\nIf the UE supports 5G ProSe direct discovery as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-dd bit to \"5G ProSe direct discovery supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports 5G ProSe direct communication as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-dc bit to \"5G ProSe direct communication supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-2 UE-to-network relay UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l2relay bit to \"Acting as a 5G ProSe layer-2 UE-to-network relay UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-3 UE-to-network relay UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l3relay bit to \"Acting as a 5G ProSe layer-3 UE-to-network relay UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-2 UE-to-network remote UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l2rmt bit to \"Acting as a 5G ProSe layer-2 UE-to-network remote UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-3 UE-to-network remote UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l3rmt bit to \"Acting as a 5G ProSe layer-3 UE-to-network remote UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-2 UE-to-UE relay UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l2U2U relay bit to \"Acting as a 5G ProSe layer-2 UE-to-UE relay UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-3 UE-to-UE relay UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l3U2U relay bit to \"Acting as a 5G ProSe layer-3 UE-to-UE relay UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-2 end UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l2end bit to \"Acting as a 5G ProSe layer-2 end UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-3 end UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l3end bit to \"Acting as a 5G ProSe layer-3 end UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the MUSIM UE supports the N1 NAS signalling connection release, then the UE shall set the N1 NAS signalling connection release bit to \"N1 NAS signalling connection release supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message otherwise the UE shall not set the N1 NAS signalling connection release bit to \"N1 NAS signalling connection release supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the MUSIM UE supports the paging indication for voice services, then the UE shall set the paging indication for voice services bit to \"paging indication for voice services supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message otherwise the UE shall not set the paging indication for voice services bit to \"paging indication for voice services supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the MUSIM UE supports the reject paging request, then the UE shall set the reject paging request bit to \"reject paging request supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message otherwise the UE shall not set the reject paging request bit to \"reject paging request supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the MUSIM UE sets:\n-\tthe reject paging request bit to \"reject paging request supported\";\n-\tthe N1 NAS signalling connection release bit to \"N1 NAS signalling connection release supported\"; or\n-\tboth of them;\nand supports the paging restriction, then the UE shall set the paging restriction bit to \"paging restriction supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message otherwise the UE shall not set the paging restriction bit to \"paging restriction supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports MINT, the UE shall set the MINT bit to \"MINT supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports slice-based N3IWF selection, the UE shall set the SBNS bit to \"Slice-based N3IWF selection supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports slice-based TNGF selection, the UE shall set the SBTS bit to \"Slice-based TNGF selection supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE initiates the registration procedure for disaster roaming services, the UE has determined the MS determined PLMN with disaster condition as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] and:\na)\tthe MS determined PLMN with disaster condition is the HPLMN and:\n1)\tthe Additional GUTI IE is included in the REGISTRATION REQUEST message and does not contain a valid 5G-GUTI that was previously assigned by the HPLMN; or\n2)\tthe Additional GUTI IE is not included in the REGISTRATION REQUEST message and the 5GS mobile identity IE contains neither the SUCI nor a valid 5G-GUTI that was previously assigned by the HPLMN; or\nb)\tthe MS determined PLMN with disaster condition is not the HPLMN and:\n1)\tthe Additional GUTI IE is included in the REGISTRATION REQUEST message and does not contain a valid 5G-GUTI that was previously assigned by the MS determined PLMN with disaster condition; or\n2)\tthe Additional GUTI IE is not included in the REGISTRATION REQUEST message and the 5GS mobile identity IE does not contain a valid 5G-GUTI that was previously assigned by the MS determined PLMN with disaster condition;\nthe UE shall include in the REGISTRATION REQUEST message the MS determined PLMN with disaster condition IE indicating the MS determined PLMN with disaster condition.\nNOTE\u00a014:\t\tIf the UE initiates the registration procedure for disaster roaming services, and the MS determined PLMN with disaster condition cannot be determined when an NG-RAN cell of the PLMN broadcasts the disaster related indication as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5], the UE does not include in the REGISTRATION REQUEST message the MS determined PLMN with disaster condition IE but includes the Additional GUTI IE or the 5GS mobile identity IE or both as specified in subclauses\u00a05.5.1.2.2.\nIf the UE supports event notification, the UE shall set the EventNotification bit to \"Event notification supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports access to an SNPN using credentials from a credentials holder and:\na)\tthe UE is in its HPLMN or EHPLMN or the subscribed SNPN; or\nb)\tthe UE is in a non-subscribed SNPN and supports equivalent SNPNs;\nthe UE shall set the SSNPNSI bit to \"SOR-SNPN-SI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports equivalent SNPNs, the UE shall set the ESI bit to \"equivalent SNPNs supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the unavailability period, the UE shall set the UN-PER bit to \"unavailability period supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the reconnection to the network due to RAN timing synchronization status change, the UE shall set the Reconnection to the network due to RAN timing synchronization status change (RANtiming) bit to \"Reconnection to the network due to RAN timing synchronization status change supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports LADN per DNN and S-NSSAI, the UE shall set the LADN-DS bit to \"LADN per DNN and S-NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports MPS indicator update via the UE configuration update procedure, the UE shall set the MPSIU bit to \"MPS indicator update supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports MCS indicator update via the UE configuration update procedure, the UE shall set the MCSIU bit to \"MCS indicator update supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports ranging and sidelink positioning as specified in 3GPP\u00a0TS\u00a024.514\u00a0[62] and supports:\na)\tV2X communication over PC5 as specified in 3GPP\u00a0TS\u00a024.587\u00a0[19B];\nb)\t5G ProSe direct discovery and 5G ProSe direct communication as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E]; or\nc)\tboth a) and b),\nthe UE shall set \nthe RSPPC5 bit to \"Ranging and sidelink positioning over PC5 supported\";\nthe RSLPL bit to \"Ranging and sidelink positioning for located UE supported\";\nthe RSLPS bit to \"Ranging and sidelink positioning for SL positioning server UE supported\"; or\nany combination of a), b) and c), in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the partial network slice, the UE shall set the PNS bit to \"Partial network slice supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports network slice usage control, the UE shall set the NSUC bit to \"Network slice usage control supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the S-NSSAI time validity information, the UE shall set the TempNS bit to \"S-NSSAI time validity information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the S-NSSAI location validity information, the UE shall set the SLVI bit to \"S-NSSAI location validity information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\n\nFigure\u00a05.5.1.2.2.1: Registration procedure for initial registration\n5.5.1.2.3\t5GMM common procedure initiation\nThe network may initiate 5GMM common procedures, e.g. the identification, authentication and security procedures during the registration procedure, depending on the information received in the REGISTRATION REQUEST message.\nIf two NAS security mode control procedures are needed to signal an entire unciphered REGISTRATION REQUEST message followed by signalling of selected EPS NAS security algorithms, both NAS security mode control procedures should be initiated as part of 5GMM common procedures of the ongoing registration procedure (see subclause\u00a05.4.2.4).\nDuring a registration procedure with 5GS registration type IE set to \"emergency registration\", if the AMF is configured to support emergency registration for unauthenticated SUCIs, the AMF may choose to skip the authentication procedure even if no 5G NAS security context is available and proceed directly to the execution of the security mode control procedure.\n5.5.1.2.4\tInitial registration accepted by the network\nDuring a registration procedure with 5GS registration type IE set to \"emergency registration\", the AMF shall not check for mobility and access restrictions, regional restrictions or subscription restrictions, or CAG restrictions when processing the REGISTRATION REQUEST message.\nIf the initial registration request is accepted by the network, the AMF shall send a REGISTRATION ACCEPT message to the UE.\nNOTE\u00a00:\tIf the AMF receives the initial registration request over non-3GPP access and detects that the N3IWF used by the UE is compatible with only part of the allowed NSSAI and the UE has not indicated its support for slice-based N3IWF selection in the REGISTRATION REQUEST message, the AMF accepts the initial registration request.\nNOTE\u00a00A:\tIf the AMF receives the initial registration request over non-3GPP access and detects that the TNGF used by the UE is compatible with only part of the allowed NSSAI and the UE has not indicated its support for slice-based TNGF selection in the REGISTRATION REQUEST message, the AMF accepts the initial registration request.\nFor each of the information elements: 5GMM capability, S1 UE network capability, and UE security capability, the AMF shall store all octets received from the UE in the REGISTRATION REQUEST message, up to the maximum length defined for the respective information element.\nNOTE\u00a01:\tThis information is forwarded to the new AMF during inter-AMF handover or to the new MME during inter-system handover to S1 mode.\nThe AMF shall assign and include a TAI list as a registration area the UE is registered to in the REGISTRATION ACCEPT message. The AMF shall not assign a TAI list containing both tracking areas in NB-N1 mode and tracking areas not in NB-N1 mode. The UE, upon receiving a REGISTRATION ACCEPT message, shall delete its old TAI list and store the received TAI list. If the REGISTRATION REQUEST message was received over non-3GPP access, the AMF shall include a single TAI in the TAI list.\nNOTE\u00a02:\tFor non-3GPP access, the operator can allocate a TAI per N3IWF, TNGF, TWIF or W-AGF. Each N3IWF, TNGF, TWIF or W-AGF is locally configured with a TAI. Each N3IWF, TNGF, TWIF or W-AGF can be configured with its own TAI value, or with the same TAI value as other N3IWFs, TNGFs, TWIFs or W-AGFs.\nNOTE\u00a03:\tWhen assigning the TAI list, the AMF can take into account the eNodeB's capability of support of CIoT 5GS optimization.\nThe AMF may include service area restrictions in the Service area list IE in the REGISTRATION ACCEPT message. The UE, upon receiving a REGISTRATION ACCEPT message with the service area restrictions shall act as described in subclause\u00a05.3.5.\nThe AMF may also include a list of equivalent PLMNs in the REGISTRATION ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if the initial registration procedure is not for emergency services, the UE shall remove from the list any PLMN code that is already in the forbidden PLMN list as specified in subclause\u00a05.3.13A. In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message does not contain a list, then the UE shall delete the stored list. The AMF of a PLMN shall not include a list of equivalent SNPNs.\nIf the ESI bit of the 5GMM capability IE of the REGISTRATION REQUEST message is set to \"equivalent SNPNs supported\", the AMF of a SNPN may include a list of equivalent SNPNs in the REGISTRATION ACCEPT message. If the initial registration request is for onboarding services in SNPN, the AMF shall not include a list of equivalent SNPNs in the REGISTRATION ACCEPT message. Each entry in the list contains an SNPN identity. The UE shall store the list as provided by the network. If the initial registration procedure is not for emergency services and is not the initial registration for onboarding services in SNPN, the UE shall remove from the list any SNPN identity that is already in:\n-\tthe \"permanently forbidden SNPNs\" list or the \"temporarily forbidden SNPNs\" list, if the SNPN is not an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]); or\n-\tthe \"permanently forbidden SNPNs for access for localized services in SNPN\" list or the \"temporarily forbidden SNPNs for access for localized services in SNPN\" list, if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]).\nThe UE shall add to the stored list the SNPN identity of the registered SNPN that sent the list. The UE shall replace the stored list on each receipt of the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message does not contain a list, then the UE shall delete the stored list. The AMF of an SNPN shall not include a list of equivalent PLMNs.\nNOTE\u00a03A:\tIf N1 mode was disabled for an SNPN due to reception of 5GMM cause #27 or #62,\u00a0the UE implementation ensures that it does not register to this SNPN due to being part of the list of \"equivalent SNPNs\" received while registered in another SNPN.\nIf the initial registration procedure is not for emergency services, the UE is not registered for disaster roaming services, and if the PLMN identity of the registered PLMN is a member of the forbidden PLMN list as specified in subclause\u00a05.3.13A, any such PLMN identity shall be deleted from the corresponding list(s).\nIf the Service area list IE is not included in the REGISTRATION ACCEPT message, any tracking area in the registered PLMN and its equivalent PLMN(s) in the registration area, or in the registered SNPN, is considered as an allowed tracking area as described in subclause\u00a05.3.5.\nIf the REGISTRATION REQUEST message contains the LADN indication IE, based on the LADN indication IE, UE subscription information, UE location and local configuration about LADN and:\n-\tif the LADN indication IE includes requested LADN DNNs, the UE subscribed DNN list includes the requested LADN DNNs or the wildcard DNN, and the LADN service area of the requested LADN DNN has an intersection with the current registration area, the AMF shall determine the requested LADN DNNs included in the LADN indication IE as LADN DNNs for the UE;\n-\tif no requested LADN DNNs included in the LADN indication IE and the wildcard DNN is included in the UE subscribed DNN list, the AMF shall determine the LADN DNN(s) configured in the AMF whose LADN service area has an intersection with the current registration area as LADN DNNs for the UE; or\n-\tif no requested LADN DNNs included in the LADN indication IE and the wildcard DNN is not included in the UE subscribed DNN list, or if the UE subscribed DNN list does not include any of the DNN's in the LADN indication IE, the AMF shall determine the LADN DNN(s) included in the UE subscribed DNN list whose LADN service area has an intersection with the current registration area as LADN DNNs for the UE.\nIf the LADN indication IE is not included in the REGISTRATION REQUEST message, the AMF shall determine the LADN DNN(s) included in the UE subscribed DNN list whose service area has an intersection with the current registration area as LADN DNNs for the UE, except for the wildcard DNN included in the UE subscribed DNN list.\nIf the UE supports WUS assistance information and the AMF supports and accepts the use of WUS assistance information for the UE, then the AMF shall determine the negotiated UE paging probability information for the UE, store it in the 5GMM context of the UE, and if the UE is not performing the initial registration for emergency services, the AMF shall include it in the Negotiated WUS assistance information IE in the REGISTRATION ACCEPT message. The AMF may consider the UE paging probability information received in the Requested WUS assistance information IE when determining the negotiated UE paging probability information for the UE.\nNOTE\u00a04:\tBesides the UE paging probability information requested by the UE, the AMF can take local configuration or previous statistical information for the UE into account when determining the negotiated UE paging probability information for the UE.\nIf the UE sets the NR-PSSI bit to \"NR paging subgrouping supported\" in the 5GMM capability IE in the REGISTRATION REQUEST message and the AMF supports and accepts the use of PEIPS assistance information for the UE, then the AMF shall determine the Paging subgroup ID for the UE, store it in the 5GMM context of the UE, and shall include it in the Negotiated PEIPS assistance information IE in the REGISTRATION ACCEPT message or in the Updated PEIPS assistance information IE in the CONFIGURATION UPDATE COMMAND message as part of the registration procedure. The AMF may consider the UE paging probability information received in the Requested PEIPS assistance information IE when determining the Paging subgroup ID for the UE.\nNOTE\u00a05:\tBesides the UE paging probability information when provided by the UE, the AMF can also take local configuration, whether the UE is likely to receive IMS voice over PS session calls, UE mobility pattern or previous statistical information for the UE or information provided by the NG-RAN into account when determining the Paging subgroup ID for the UE.\nIf the UE set the UN-PER bit to \"unavailability period supported\" in the 5GMM capability IE in the REGISTRATION REQUEST message and the AMF supports and accepts the use of unavailability period for the UE, then the AMF shall set the UN-PER bit to \"unavailability period supported\" in the 5GS network feature support IE in the REGISTRATION ACCEPT message. Furthermore, if the AMF is able to determine a UE out-of-coverage period based on satellite coverage availability information, the AMF shall store the determined unavailability period duration and, optionally, the start of the unavailability period, and provide them to the UE by including the Unavailability configuration IE in the REGISTRATION ACCEPT message. The AMF may determine the periodic registration update timer value based on a network determined unavailability period duration.\nThe AMF shall include the LADN information which consists of the determined LADN DNNs for the UE and LADN service area(s) available in the current registration area in the LADN information IE of the REGISTRATION ACCEPT message.\nIf the UE has set the LADN-DS bit to \"LADN per DNN and S-NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and the extended LADN information is available for the UE, the AMF shall include the extended LADN information which consists of the determined LADN DNNs for the UE, the S-NSSAIs associated with the determined LADN DNNs for the UE and in the allowed NSSAI, and LADN service area(s) available in the current registration area in the Extended LADN information IE in the Registration accept type 6 IE container IE of the REGISTRATION ACCEPT message.\nIf:\n-\tthe UE does not support LADN per DNN and S-NSSAI;\n-\tthe UE is subscribed to the LADN DNN for a single S-NSSAI only; and\n-\tthe AMF only has the extended LADN information;\nthe AMF may decide to provide the LADN service area for that LADN DNN of the extended LADN information as the LADN information and include the LADN information in the LADN information IE of the CONFIGURATION UPDATE COMMAND message.\nNOTE\u00a05A:\tIf the LADN service area is configured per DNN and S-NSSAI, in order to serve the UEs that do not support LADN per DNN and S-NSSAI, it is recommended that the LADN DNN is only served by a single S-NSSAI.\nNOTE\u00a05B:\tIn case of the UE is subscribed to the LADN DNN for multiple S-NSSAIs, the AMF can treat this as no extended LADN information is available.\nIf the UE does not support LADN per DNN and S-NSSAI and the AMF has neither the LADN information nor the extended LADN information, the AMF shall not provide any LADN information to the UE.\nThe UE, upon receiving the REGISTRATION ACCEPT message with the LADN information, shall store the received LADN information. The UE, upon receiving the REGISTRATION ACCEPT message with the Extended LADN information, shall store the received extended LADN information. If there exists one or more LADN DNNs which are included in the LADN indication IE of the REGISTRATION REQUEST message and are not included in the LADN information IE and Extended LADN information IE in the Registration accept type 6 IE container IE of the REGISTRATION ACCEPT message, the UE considers such LADN DNNs as not available in the current registration area.\nThe 5G-GUTI reallocation shall be part of the initial registration procedure. During the initial registration procedure, if the AMF has not allocated a new 5G-GUTI by the generic UE configuration update procedure, the AMF shall include in the REGISTRATION ACCEPT message the new assigned 5G-GUTI together with the assigned TAI list.\nIf the UE has set the CAG bit to \"CAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and the AMF needs to update the \"CAG information list\" stored in the UE, the AMF shall include the CAG information list IE or the Extended CAG information list IE in the REGISTRATION ACCEPT message.\nNOTE\u00a06:\tThe \"CAG information list\" can be provided by the AMF and include no entry if no \"CAG information list\" exists in the subscription.\nNOTE\u00a07:\tIf the UE supports extended CAG information list, the CAG information list can be included either in the CAG information list IE or Extended CAG information list IE.\nIf the UE does not support extended CAG information list, the CAG information list shall not be included in the Extended CAG information list IE.\nIf a 5G-GUTI or the SOR transparent container IE is included in the REGISTRATION ACCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the Operator-defined access category definitions IE, the Extended emergency number list IE, the CAG information list IE or the Extended CAG information list IE are included in the REGISTRATION ACCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE has set the RCMAP bit to \"Sending of REGISTRATION COMPLETE message for negotiated PEIPS assistance information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and if the Negotiated PEIPS assistance information IE is included in the REGISTRATION ACCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE is not in NB-N1 mode and the UE has set the RACS bit to \"RACS supported\" in the 5GMM Capability IE of the REGISTRATION REQUEST message, the AMF may include either a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the REGISTRATION ACCEPT message. If the UE radio capability ID IE or the UE radio capability ID deletion indication IE is included in the REGISTRATION ACCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nThe AMF shall include the MICO indication IE in the REGISTRATION ACCEPT message only if the MICO indication IE was included in the REGISTRATION REQUEST message, the AMF supports and accepts the use of MICO mode. If the AMF supports and accepts the use of MICO mode, the AMF may indicate \"all PLMN registration area allocated\" in the MICO indication IE in the REGISTRATION ACCEPT message. If \"all PLMN registration area allocated\" is indicated in the MICO indication IE, the AMF shall not assign and include the TAI list in the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message included an MICO indication IE indicating \"all PLMN registration area allocated\", the UE shall treat all TAIs in the current PLMN as a registration area and delete its old TAI list. If \"strictly periodic registration timer supported\" is indicated in the MICO indication IE in the REGISTRATION REQUEST message, the AMF may indicate \"strictly periodic registration timer supported\" in the MICO indication IE in the REGISTRATION ACCEPT message.\nThe AMF shall include an active time value in the T3324 IE in the REGISTRATION ACCEPT message if the UE requested an active time value in the REGISTRATION REQUEST message and the AMF accepts the use of MICO mode and the use of active time.\nIf the AMF supports and accepts the use of MICO, and the UE included the Requested T3512 value IE in the REGISTRATION REQUEST message, then the AMF shall take into account the T3512 value requested when providing the T3512 value IE in the REGISTRATION ACCEPT message.\nNOTE\u00a07A:\tThe T3512 value assigned to the UE by AMF can be different from the T3512 value requested by the UE. AMF can take several factors into account when assigning the T3512 value, e.g. local configuration, expected UE behaviour, UE requested T3512 value, UE subscription data, network policies.\nThe AMF shall include the T3512 value IE in the REGISTRATION ACCEPT message only if the REGISTRATION REQUEST message was sent over the 3GPP access.\nThe AMF shall include the non-3GPP de-registration timer value IE in the REGISTRATION ACCEPT message only if the REGISTRATION REQUEST message was sent over the non-3GPP access.\nIf the UE requests \"control plane CIoT 5GS optimization\" in the 5GS update type IE, indicates support of control plane CIoT 5GS optimization in the 5GMM capability IE and the AMF decides to accept the requested CIoT 5GS optimization and the registration request, the AMF shall indicate \"control plane CIoT 5GS optimization supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message.\nThe AMF may include the T3447 value IE set to the service gap time value in the REGISTRATION ACCEPT message if:\n-\tthe UE has indicated support for service gap control in the REGISTRATION REQUEST message; and\n-\ta service gap time value is available in the 5GMM context.\nIf there is a running T3447 timer in the AMF and the Follow-on request indicator is set to \"Follow-on request pending\" in the REGISTRATION REQUEST message, the AMF shall ignore the flag and proceed as if the flag was not received except for the following cases:\na)\tthe UE is configured for high priority access in the selected PLMN; or\nb)\tthe 5GS registration type IE in the REGISTRATION REQUEST message is set to \"emergency registration\".\nIf the UE has indicated support for the control plane CIoT 5GS optimizations, and the AMF decides to activate the congestion control for transport of user data via the control plane, then the AMF shall include the T3448 value IE in the REGISTRATION ACCEPT message.\nIf:\n-\tthe UE in NB-N1 mode is using control plane CIoT 5GS optimization; and\n-\tthe network is configured to provide the truncated 5G-S-TMSI configuration for control plane CIoT 5GS optimizations;\nthe AMF shall include the Truncated 5G-S-TMSI configuration IE in the REGISTRATION ACCEPT message and set the \"Truncated AMF Set ID value\" and the \"Truncated AMF Pointer value\" in the Truncated 5G-S-TMSI configuration IE based on network policies. The AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message, and if:\n-\tthe UE has a valid aerial UE subscription information;\n-\tthe UUAA procedure is to be performed during the registration procedure according to operator policy;\n-\tthere is no valid successful UUAA result for the UE in the UE 5GMM context; and\n-\tthe REGISTRATION REQUEST message was not received over non-3GPP access,\nthen the AMF shall initiate the UUAA-MM procedure with the UAS-NF as specified in 3GPP\u00a0TS\u00a023.256\u00a0[6AB] and shall include a service-level-AA pending indication in the Service-level-AA container IE of the REGISTRATION ACCEPT message. The AMF shall store in the UE 5GMM context that a UUAA procedure is pending. The AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3. If the REGISTRATION REQUEST message was received over non-3GPP access, the AMF shall not initiate UUAA-MM procedure.\nIf the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message, and if:\n-\tthe UE has a valid aerial UE subscription information; \n-\tthe UUAA procedure is to be performed during the registration procedure according to operator policy; and\n-\tthere is a valid successful UUAA result for the UE in the UE 5GMM context,\nthen the AMF shall include a service-level-AA response in the Service-level-AA container IE of the REGISTRATION ACCEPT message and set the SLAR field in the service-level-AA response to \"Service level authentication and authorization was successful\".\nIf the AMF determines that the UUAA-MM procedure needs to be performed for a UE, the AMF has not received the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message from the UE and the AMF decides to accept the UE to be registered for other services than UAS services based on the user's subscription data and the operator policy, the AMF shall accept the initial registration request and shall mark in the UE's 5GMM context that the UE is not allowed to request UAS services.\nIf the UE supports MINT, the AMF may include the List of PLMNs to be used in disaster condition IE in the REGISTRATION ACCEPT message.\nIf the UE supports MINT, the AMF may include the Disaster roaming wait range IE in the REGISTRATION ACCEPT message.\nIf the UE supports MINT, the AMF may include the Disaster return wait range IE in the REGISTRATION ACCEPT message.\nNOTE\u00a08:\tThe AMF can determine the contents of the \"list of PLMN(s) to be used in disaster condition\", the value of the disaster roaming wait range and the value of the disaster return wait range based on the network local configuration.\nIf the AMF received the list of TAIs from the satellite NG-RAN as described in 3GPP\u00a0TS\u00a023.501\u00a0[8], and determines that, by UE subscription and operator's preferences, any but not all TAIs in the received list of TAIs is forbidden for roaming or for regional provision of service, the AMF shall include the TAI(s) in:\na) the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE; or\nb) the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE; or\nc)\tboth;\nin the REGISTRATION ACCEPT message.\nNOTE\u00a09:\tVoid.\nIf the UE has set the Reconnection to the network due to RAN timing synchronization status change (RANtiming) bit to \"Reconnection to the network due to RAN timing synchronization status change supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the AMF may include the RAN timing synchronization IE with the RecReq bit set to \"Reconnection requested\" in the REGISTRATION ACCEPT message.\nIf the AMF receives the initial registration request along with the mobile IAB-indication over N2 reference point (see TS\u00a038.413\u00a0[31]) from UE and the UE is authorized to operate as an MBSR based on the subscription information and local policy (see 3GPP\u00a0TS\u00a023.501\u00a0[8]), the AMF shall include the Feature authorization indication IE in the REGISTRATION ACCEPT message and shall set the MBSRAI field to \"authorized to operate as MBSR\". If the AMF receives the initial registration request along with the mobile IAB-indication over N2 reference point (see TS\u00a038.413\u00a0[31]) from UE and the UE is not authorized to operate as an MBSR based on the subscription information and local policy but can operate as a UE, the AMF shall include the Feature authorization indication IE in the REGISTRATION ACCEPT message and shall set the MBSRAI field to \"not authorized to operate as MBSR but allowed to operate as a UE\".\nIf the UE supports user plane positioning using LCS-UPP, SUPL, or both, the AMF shall set the LCS-UPP bit, the SUPL bit, or both in the 5GS network feature support IE of the REGISTRATION ACCEPT message as specified in 3GPP\u00a0TS\u00a024.572\u00a0[64].\nUpon receipt of the REGISTRATION ACCEPT message, the UE shall reset the registration attempt counter, enter state 5GMM-REGISTERED and set the 5GS update status to 5U1 UPDATED.\nIf the UE receives the REGISTRATION ACCEPT message from a PLMN, then the UE shall reset the PLMN-specific attempt counter for that PLMN for the specific access type for which the message was received. The UE shall also reset the PLMN-specific N1 mode attempt counter for that PLMN for the specific access type for which the message was received. If the message was received via 3GPP access, the UE shall reset the counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"SIM/USIM considered invalid for non-GPRS services\" events, if any. If the message was received via non-3GPP access, the UE shall reset the counter for \"USIM considered invalid for 5GS services over non-3GPP\" events.\nIf the UE receives the REGISTRATION ACCEPT message from an SNPN, then the UE shall reset the SNPN-specific attempt counter for the current SNPN for the specific access type for which the message was received. If the message was received via 3GPP access, the UE shall reset the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events. If the message was received via non-3GPP access, the UE shall reset the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events.\nIf the REGISTRATION ACCEPT message included a T3512 value IE, the UE shall use the value in the T3512 value IE as periodic registration update timer (T3512).\nIf the REGISTRATION ACCEPT message include a T3324 value IE, the UE shall use the value in the T3324 value IE as active timer (T3324).\nIf the REGISTRATION ACCEPT message included a non-3GPP de-registration timer value IE, the UE shall use the value in non-3GPP de-registration timer value IE as non-3GPP de-registration timer.\nIf the REGISTRATION ACCEPT message contains\na)\tthe Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\";\nb)\ta Configured NSSAI IE with a new configured NSSAI for the current PLMN or SNPN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN or SNPN;\nc)\tan NSSRG information IE with a new NSSRG information;\nd)\tan Alternative NSSAI IE with a new alternative NSSAI;\ne)\tan S-NSSAI location validity information in the Registration accept type 6 IE container IE with a new S-NSSAI location validity information; or\nf)\tan S-NSSAI time validity information IE with a new S-NSSAI time validity information,\nthe UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the successful update of the network slicing information. If the UE has set the RCMAN bit to \"Sending of REGISTRATION COMPLETE message for NSAG information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and if REGISTRATION ACCEPT message contains the NSAG information IE, the UE shall return REGISTRATION COMPLETE message to the AMF to acknowledge the reception of the NSAG information IE.\nNOTE\u00a09A:\tWhen the UE receives the NSSRG information IE, the UE may provide the NSSRG information to lower layers for the purpose of NSAG-aware cell reselection.\nIf the REGISTRATION ACCEPT message contains the CAG information list IE or the Extended CAG information list IE and the UE had set the CAG bit to \"CAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the UE shall:\na)\treplace the \"CAG information list\" stored in the UE with the received CAG information list IE or the Extended CAG information list IE when received in the HPLMN or EHPLMN;\nNOTE\u00a010:\tWhen the UE receives the CAG information list IE or the Extended CAG information list IE in the HPLMN whose PLMN code is derived from the IMSI, the EHPLMN list is present and is not empty and the HPLMN is not present in the EHPLMN list, the UE behaves as if it receives the CAG information list IE or the Extended CAG information list IE in a VPLMN.\nb)\treplace the serving VPLMN's entry of the \"CAG information list\" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; or\nNOTE\u00a011:\tWhen the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored.\nc)\tremove the serving VPLMN's entry of the \"CAG information list\" stored in the UE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry.\nThe UE shall store the \"CAG information list\" received in the CAG information list IE or the Extended CAG information list IE as specified in annex\u00a0C.\nIf the received \"CAG information list\" includes an entry containing the identity of the registered PLMN, the UE shall operate as follows:\na)\tif the UE receives the REGISTRATION ACCEPT message via a CAG cell, none of the CAG-ID(s) supported by the current CAG cell is authorized based on the \"Allowed CAG list\" of the entry for the registered PLMN in the received \"CAG information list\", and:\n1)\tthe entry for the registered PLMN in the received \"CAG information list\" does not include an \"indication that the UE is only allowed to access 5GS via CAG cells\", then the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\"; or\n2)\tthe entry for the registered PLMN in the received \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and:\ni)\tif one or more CAG-ID(s) are authorized based on the \"Allowed CAG list\" of the entry for the registered PLMN in the received \"CAG information list\", the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] with the updated \"CAG information list\"; or\nii)\tif no CAG-ID is authorized based on the \"Allowed CAG list\" of the entry for the registered PLMN in the received \"CAG information list\", the UE has not set the 5GS registration type IE in the REGISTRATION REQUEST message to \"emergency registration\", and the initial registration was not initiated to perform handover of an existing emergency PDU session from the non-current access to the current access, then the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP\u00a0TS\u00a023.122\u00a0[5] with the updated \"CAG information list\"; or\nb)\tif the UE receives the REGISTRATION ACCEPT message via a non-CAG cell and the entry for the registered PLMN in the received \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and:\n1)\tif one or more CAG-ID(s) are authorized based on the \"allowed CAG list\" for the registered PLMN in the received \"CAG information list\", the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] with the updated \"CAG information list\"; or\n2)\tif no CAG-ID is authorized based on the \"Allowed CAG list\" of the entry for the registered PLMN in the received \"CAG information list\", the UE has not set the 5GS registration type IE in the REGISTRATION REQUEST message to \"emergency registration\", and the initial registration was not initiated to perform handover of an existing emergency PDU session from the non-current access to the current access, then the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP\u00a0TS\u00a023.122\u00a0[5] with the updated \"CAG information list\".\nIf the received \"CAG information list\" does not include an entry containing the identity of the registered PLMN and the UE receives the REGISTRATION ACCEPT message via a CAG cell, the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\".\nIf the REGISTRATION ACCEPT message contains the Operator-defined access category definitions IE, the Extended emergency number list IE ,the CAG information list IE or the Extended CAG information list IE, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the operator-defined access category definitions, the extended local emergency numbers list or the \"CAG information list\".\nIf the UE has set the RCMAP bit to \"Sending of REGISTRATION COMPLETE message for negotiated PEIPS parameters supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and if REGISTRATION ACCEPT message contains the Negotiated PEIPS assistance information IE, the UE shall return REGISTRATION COMPLETE message to the AMF to acknowledge the reception of the Negotiated PEIPS assistance information IE.\nIf the REGISTRATION ACCEPT message contains the UE radio capability ID IE or the UE radio capability ID deletion indication IE, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the UE radio capability ID IE or the UE radio capability ID deletion indication IE.\nUpon receiving a REGISTRATION COMPLETE message, the AMF shall stop timer T3550 and change to state 5GMM-REGISTERED. The 5G-GUTI, if sent in the REGISTRATION ACCEPT message, shall be considered as valid, the PEIPS assistance information, if sent in the REGISTRATION ACCEPT message, shall be considered as valid, and the UE radio capability ID, if sent in the REGISTRATION ACCEPT, shall be considered as valid.\nIf the 5GS update type IE was included in the REGISTRATION REQUEST message with the SMS requested bit set to \"SMS over NAS supported\", and SMSF selection is successful, then the AMF shall send the REGISTRATION ACCEPT message after the SMSF has confirmed that the activation of the SMS service was successful. When sending the REGISTRATION ACCEPT message, the AMF shall:\na)\tset the SMS allowed bit of the 5GS registration result IE to \"SMS over NAS allowed\" in the REGISTRATION ACCEPT message, if the UE has set the SMS requested bit of the 5GS update type IE to \"SMS over NAS supported\" in the REGISTRATION REQUEST message and the network allows the use of SMS over NAS for the UE; and\nb)\tstore the SMSF address and the value of the SMS allowed bit of the 5GS registration result IE in the UE 5GMM context and consider the UE available for SMS over NAS.\nIf:\na)\tthe SMSF selection in the AMF is not successful;\nb)\tthe SMS activation via the SMSF is not successful;\nc)\tthe AMF does not allow the use of SMS over NAS;\nd)\tthe SMS requested bit of the 5GS update type IE was set to \"SMS over NAS not supported\" in the REGISTRATION REQUEST message; or\ne)\tthe 5GS update type IE was not included in the REGISTRATION REQUEST message;\nthen the AMF shall set the SMS allowed bit of the 5GS registration result IE to \"SMS over NAS not allowed\" in the REGISTRATION ACCEPT message.\nWhen the UE receives the REGISTRATION ACCEPT message, if the UE is also registered over another access to the same PLMN, the UE considers the value indicated by the SMS allowed bit of the 5GS registration result IE as applicable for both accesses over which the UE is registered.\nThe AMF shall include the 5GS registration result IE in the REGISTRATION ACCEPT message. If the 5GS registration result value in the 5GS registration result IE indicates:\na)\t\"3GPP access\", the UE:\n-\tshall consider itself as being registered to 3GPP access; and\n-\tif in 5GMM-REGISTERED state over non-3GPP access and on the same PLMN or SNPN as 3GPP access, shall enter state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over non-3GPP access and set the 5GS update status to 5U2 NOT UPDATED over non-3GPP access; or\nb)\t\"Non-3GPP access\", the UE:\n-\tshall consider itself as being registered to non-3GPP access; and\n-\tif in the 5GMM-REGISTERED state over 3GPP access and is on the same PLMN or SNPN as non-3GPP access, shall enter the state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over 3GPP access and set the 5GS update status to 5U2 NOT UPDATED over 3GPP access; or\nc)\t\"3GPP access and non-3GPP access\", the UE shall consider itself as being registered to both 3GPP access and non-3GPP access.\nIn roaming scenarios, the AMF shall provide mapped S-NSSAI(s) for the configured NSSAI, the allowed NSSAI, the partially allowed NSSAI, the rejected NSSAI (if Extended rejected NSSAI IE is used) , the partially rejected NSSAI, the pending NSSAI or NSSRG information when included in the REGISTRATION ACCEPT message.\nThe AMF shall include the allowed NSSAI for the current PLMN or SNPN and shall include the mapped S-NSSAI(s) for the allowed NSSAI contained in the requested NSSAI from the UE if available, in the REGISTRATION ACCEPT message if the UE included the requested NSSAI in the REGISTRATION REQUEST message and the AMF allows one or more S-NSSAIs in the requested NSSAI. Additionally, if the AMF allows one or more subscribed S-NSSAIs for the UE, the AMF may include the allowed subscribed S-NSSAI(s) in the allowed NSSAI in the REGISTRATION ACCEPT message.\nThe AMF may also include rejected NSSAI in the REGISTRATION ACCEPT message if the initial registration request is not for onboarding services in SNPN. If the UE has set the ER-NSSAI bit to \"Extended rejected NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the rejected NSSAI shall be included in the Extended rejected NSSAI IE in the REGISTRATION ACCEPT message; otherwise the rejected NSSAI shall be included in the Rejected NSSAI IE in the REGISTRATION ACCEPT message. If the initial registration request is for onboarding services in SNPN, the AMF shall not include rejected NSSAI in the REGISTRATION ACCEPT message.\nIf the UE has indicated the support for partial network slice and the AMF determines one or more S-NSSAI(s) in the requested NSSAI are to be included in the partially rejected NSSAI as specified in subclause\u00a04.6.2.11, the AMF shall include the Partially rejected NSSAI IE in the Registration accept type 6 IE container IE of the REGISTRATION ACCEPT message.\nIf the UE receives the Partially rejected NSSAI IE in the Registration accept type 6 IE container IE of the REGISTRATION ACCEPT message, the UE shall store the partially rejected NSSAI as specified in subclause\u00a04.6.2.2.\nIf the UE has set the ER-NSSAI bit to \"Extended rejected NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the rejected NSSAI contains S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with rejection cause(s); otherwise the rejected NSSAI contains S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with rejection cause(s) with the following restrictions:\na)\trejected NSSAI for the current PLMN or SNPN shall not include an S-NSSAI for the current PLMN or SNPN which is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are not allowed; and\nb)\trejected NSSAI for the current registration area shall not include an S-NSSAI for the current PLMN or SNPN which is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are not allowed.\nNOTE\u00a012:\tThe UE that does not support extended rejected NSSAI can avoid requesting an S-NSSAI associated with a mapped S-NSSAI, which was included in the previous requested NSSAI but neither in the allowed NSSAI nor in the rejected NSSAI in the consequent registration procedures.\nIf the UE indicated the support for network slice-specific authentication and authorization, and if the Requested NSSAI IE includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, the AMF shall in the REGISTRATION ACCEPT message include:\na)\tthe allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s), if any:\n1)\twhich are not subject to network slice-specific authentication and authorization and are allowed by the AMF; or\n2)\tfor which the network slice-specific authentication and authorization has been successfully performed;\naa)\tthe partially allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s), if any:\n1)\twhich are not subject to network slice-specific authentication and authorization and are allowed by the AMF; or\n2)\tfor which the network slice-specific authentication and authorization has been successfully performed;\nb)\toptionally, the rejected NSSAI;\nba)\toptionally, the partially rejected NSSAI;\nc)\tpending NSSAI containing one or more S-NSSAIs for which network slice-specific authentication and authorization (except for re-NSSAA) will be performed or is ongoing, and one or more S-NSSAIs from the pending NSSAI which the AMF provided to the UE during the previous registration procedure for which network slice-specific authentication and authorization will be performed or is ongoing, if any; and\nd)\tthe \"NSSAA to be performed\" indicator in the 5GS registration result IE set to indicate that the network slice-specific authentication and authorization procedure will be performed by the network, if the allowed NSSAI is not included in the REGISTRATION ACCEPT message.\nIf the initial registration request is not for onboarding services in SNPN, the UE indicated the support for network slice-specific authentication and authorization, and:\na)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed;\nb)\tall default S-NSSAIs are subject to network slice-specific authentication and authorization; and\nc)\tthe network slice-specific authentication and authorization procedure has not been successfully performed for any of the default S-NSSAIs,\nthe AMF shall in the REGISTRATION ACCEPT message include:\na)\tthe \"NSSAA to be performed\" indicator in the 5GS registration result IE to indicate that the network slice-specific authentication and authorization procedure will be performed by the network;\nb)\tpending NSSAI containing one or more default S-NSSAIs for which network slice-specific authentication and authorization will be performed or is ongoing and one or more S-NSSAIs from the pending NSSAI which the AMF provided to the UE during the previous registration procedure for which network slice-specific authentication and authorization will be performed or is ongoing (if any);\nc)\toptionally, the rejected NSSAI; and\ne)\toptionally, the partially rejected NSSAI.\nIf the initial registration request is not for onboarding services in SNPN, the UE indicated the support for network slice-specific authentication and authorization, and:\na)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed; and\nb)\tone or more default S-NSSAIs are not subject to network slice-specific authentication and authorization or the network slice-specific authentication and authorization procedure has been successfully performed for one or more default S-NSSAIs;\nthe AMF shall in the REGISTRATION ACCEPT message include:\na)\tpending NSSAI containing one or more default S-NSSAIs for which network slice-specific authentication and authorization will be performed or is ongoing (if any) and one or more S-NSSAIs from the pending NSSAI which the AMF provided to the UE during the previous registration procedure for which network slice-specific authentication and authorization will be performed or is ongoing (if any);\nb)\tallowed NSSAI containing S-NSSAI(s) for the current PLMN each of which corresponds to a default S-NSSAI which are not subject to network slice-specific authentication and authorization or for which the network slice-specific authentication and authorization has been successfully performed;\nc)\tallowed NSSAI containing one or more default S-NSSAIs, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, which are not subject to network slice-specific authentication and authorization or for which the network slice-specific authentication and authorization has been successfully performed; and\nd)\toptionally, the rejected NSSAI.\nIf the UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed, the allowed NSSAI shall not contain default S-NSSAI(s) that are subject to NSAC. If the subscription information includes the NSSRG information, the S-NSSAIs of the allowed NSSAI shall be associated with at least one common NSSRG value.\nWhen the REGISTRATION ACCEPT message includes a pending NSSAI, the pending NSSAI shall contain all S-NSSAIs for which network slice-specific authentication and authorization (except for re-NSSAA) will be performed or is ongoing from the requested NSSAI of the REGISTRATION REQUEST message that was received over the 3GPP access, non-3GPP access, or both the 3GPP access and non-3GPP access.\nIf the UE supports extended rejected NSSAI and the AMF determines that maximum number of UEs reached for one or more S-NSSAI(s) in the requested NSSAI as specified in subclause\u00a04.6.2.5, the AMF shall include the rejected NSSAI containing one or more S-NSSAIs with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\" in the Extended rejected NSSAI IE in the REGISTRATION ACCEPT message. In addition, the AMF may include a back-off timer value for each S-NSSAI with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\" included in the Extended rejected NSSAI IE of the REGISTRATION ACCEPT message. To avoid that large numbers of UEs simultaneously initiate deferred requests, the network should select the value for the backoff timer for each S-NSSAI for the informed UEs so that timeouts are not synchronised.\nIf the UE does not indicate support for extended rejected NSSAI and the maximum number of UEs has been reached, the AMF should include the rejected NSSAI containing one or more S-NSSAIs with the rejection cause \"S-NSSAI not available in the current registration area\" in the Rejected NSSAI IE and should not include these S-NSSAIs in the allowed NSSAI in the REGISTRATION ACCEPT message.\nNOTE\u00a013:\tBased on network policies, the AMF can include the S-NSSAI(s) for which the maximum number of UEs has been reached in the rejected NSSAI with rejection causes other than \"S-NSSAI not available in the current registration area\".\nIf the UE indicates the support for the network slice usage control and the AMF determines to provide on-demand NSSAI, the AMF shall include the On-demand NSSAI IE in the REGISTRATION ACCEPT message.\nIf the UE supports network slice usage control and the AMF determines to provide on-demand NSSAI, the AMF shall include the On-demand NSSAI IE in the REGISTRATION ACCEPT message.\nIf the UE receives the On-demand NSSAI IE in the REGISTRATION ACCEPT message, the UE shall store the on-demand NSSAI as specified in subclause\u00a04.6.2.2. \nIf the AMF has a new configured NSSAI for the current PLMN or SNPN, the AMF shall include the configured NSSAI for the current PLMN or SNPN in the REGISTRATION ACCEPT message.\nNOTE\u00a013A:\tA new configured NSSAI can be available at the AMF following an indication that the subscription data for network slicing has changed.\nThe AMF may include a new configured NSSAI for the current PLMN or SNPN in the REGISTRATION ACCEPT message if:\na)\tthe REGISTRATION REQUEST message did not include the requested NSSAI and the initial registration request is not for onboarding services in SNPN;\nb)\tthe REGISTRATION REQUEST message included the requested NSSAI containing an S-NSSAI that is not valid in the serving PLMN or SNPN;\nc)\tthe REGISTRATION REQUEST message included the requested NSSAI containing S-NSSAI(s) with incorrect mapped S-NSSAI(s);\nd)\tthe REGISTRATION REQUEST message included the Network slicing indication IE with the Default configured NSSAI indication bit set to \"Requested NSSAI created from default configured NSSAI\";\ne)\tthe S-NSSAIs of the requested NSSAI in the REGISTRATION REQUEST message are not associated with any common NSSRG value, except for the case that the AMF, based on the indication received from the UDM as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8], has provided all subscribed S-NSSAIs in the configured NSSAI to a UE who does not support NSSRG; or\nNOTE\u00a014:\tIf the S-NSSAIs of the requested NSSAI in the REGISTRATION REQUEST message are not associated with any common NSSRG value, it is possible that at least one of the S-NSSAIs is not included in any of new allowed NSSAI, new (extended) rejected NSSAI (if applicable), and new pending NSSAI (if applicable).\nf)\tthe UE is in 5GMM-REGISTERED state over the other access and the S-NSSAIs of the requested NSSAI in the REGISTRATION REQUEST message over the current access and the allowed NSSAI over the other access are not associated with any common NSSRG value.\nThe AMF may include a new configured NSSAI for the current PLMN or SNPN in the REGISTRATION ACCEPT message if the REGISTRATION REQUEST message includes a requested NSSAI containing an S-NSSAI and the S-NSSAI time validity information, if available, indicates that the S-NSSAI is not available (see 3GPP\u00a0TS\u00a023.501\u00a0[8]). In this case, if the TempNS bit of the 5GMM capability IE in the REGISTRATION REQUEST message is set to:\na)\t\"S-NSSAI time validity information supported\" and the S-NSSAI time validity information indicates that the S-NSSAI will:\n1)\tbecome available again, then the AMF shall also send S-NSSAI time validity information; or\n2)\tnot become available again, then the AMF shall not include the S-NSSAI in the new configured NSSAI; or\nb)\t\"S-NSSAI time validity information not supported\" and the AMF sends a new configured NSSAI, then the AMF shall not include the S-NSSAI in the new configured NSSAI.\nIf a new configured NSSAI for the current PLMN is included in the REGISTRATION ACCEPT message, the subscription information includes the NSSRG information, and the NSSRG bit in the 5GMM capability IE of the REGISTRATION REQUEST message is set to:\na)\t\"NSSRG supported\", then the AMF shall include the NSSRG information in the REGISTRATION ACCEPT message; or\nb)\t\"NSSRG not supported\", then the configured NSSAI shall include one or more S-NSSAIs each of which is associated with all the NSSRG value(s) of the default S-NSSAI(s), or the configured NSSAI shall include, based on the indication received from the UDM as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8], all subscribed S-NSSAIs even if these S-NSSAIs do not share any common NSSRG value.\nIf the AMF needs to update the NSSRG information and the UE has set the NSSRG bit to \"NSSRG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, then the AMF shall include the new NSSRG information in the REGISTRATION ACCEPT message. In addition, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE supports S-NSSAI time validity information and the AMF needs to update the S-NSSAI time validity information, then the AMF shall include the S-NSSAI time validity information IE in the REGISTRATION ACCEPT message. In addition, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE supports S-NSSAI location validity information and the AMF needs to update the S-NSSAI location validity information, then the AMF shall include the new S-NSSAI location validity information in the Registration accept type 6 IE container IE of the REGISTRATION ACCEPT message. In addition, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE has set the NSAG bit to \"NSAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message over 3GPP access, the AMF may include the NSAG information IE in the REGISTRATION ACCEPT message. Up to 4 NSAG entries are allowed to be associated with a TAI list in the NSAG information IE. If the UE has set the RCMAN bit to \"Sending of REGISTRATION COMPLETE message for NSAG information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and if the NSAG information IE is included in the REGISTRATION ACCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nNOTE\u00a014a:\tHow the AMF selects NSAG entries to be included in the NSAG information IE is implementation specific, e.g. take the NSAG priority and the current registration area into account.\nNOTE\u00a014b:\tIf the NSAG for the PLMN and its equivalent PLMN(s) have different associations with S-NSSAIs, then the AMF includes a TAI list for the NSAG entry in the NSAG information IE.\nIf the UE receives the NSAG information IE in the REGISTRATION ACCEPT message, the UE shall store the NSAG information as specified in subclause\u00a04.6.2.2.\nIf the UE supports network slice replacement and the AMF determines to provide the mapping information between the S-NSSAI to be replaced and the alternative S-NSSAI to the UE, then the AMF shall include the Alternative NSSAI IE, the Allowed NSSAI IE including the alternative S-NSSAI, if not included in the current allowed NSSAI, and the Configured NSSAI IE including the alternative S-NSSAI, if not included in the current configured NSSAI, in the REGISTRATION ACCEPT message. If the AMF determines that the S-NSSAI which has been replaced is available, then the AMF shall provide the updated alternative NSSAI excluding the S-NSSAI which has been replaced and the corresponding alternative S-NSSAI in the Alternative NSSAI IE in the REGISTRATION ACCEPT message. If the AMF determines that all the S-NSSAI(s) which have been replaced are available, then the AMF shall provide the Alternative NSSAI IE with Length of Alternative NSSAI contents set to 0 in the REGISTRATION ACCEPT message. In addition, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3. If the AMF determines that the S-NSSAI which has been replaced is not supported due to the UE moving outside of NS-AoS of the S-NSSAI while the alternative S-NSSAI is available, then the AMF shall provide the updated allowed NSSAI excluding the S-NSSAI which has been replaced in the REGISTRATION ACCEPT message.\nIf the UE receives the Alternative NSSAI IE in the REGISTRATION ACCEPT message, the UE shall store the alternative NSSAI as specified in subclause\u00a04.6.2.2.\nIf the UE has indicated the support for partial network slice and the AMF determines one or more S-NSSAI(s) in the requested NSSAI are to be included in the partially allowed NSSAI as specified in subclause\u00a04.6.2.11, the AMF shall include the Partially allowed NSSAI IE in the Registration accept type 6 IE container IE of the REGISTRATION ACCEPT message.\nIf the UE receives the Partially allowed NSSAI IE in the Registration accept type 6 IE container IE of the REGISTRATION ACCEPT message, the UE shall store the partially allowed NSSAI as specified in subclause\u00a04.6.2.2.\nIf the UE requests ciphering keys for ciphered broadcast assistance data in the REGISTRATION REQUEST message and the AMF has valid ciphering key data applicable to the UE's subscription and current tracking area, then the AMF shall include the ciphering key data in the Ciphering key data IE of the REGISTRATION ACCEPT message.\nThe AMF shall include the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\" in the REGISTRATION ACCEPT message if the UDM has indicated that the subscription data for network slicing has changed. In this case the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nThe UE that has indicated the support for network slice-specific authentication and authorization receiving the pending NSSAI in the REGISTRATION ACCEPT message shall store the S-NSSAI(s) in the pending NSSAI as specified in subclause\u00a04.6.2.2. If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, the UE shall store the received pending NSSAI for each of the equivalent PLMNs as specified in subclause 4.6.2.2. If the pending NSSAI is not included in the REGISTRATION ACCEPT message and the \"NSSAA to be performed\" indicator is not set to \"Network slice-specific authentication and authorization is to be performed\" in the 5GS registration result IE of the REGISTRATION ACCEPT message, then the UE shall delete the pending NSSAI for the current PLMN and its equivalent PLMN(s) or SNPN, if existing, as specified in subclause\u00a04.6.2.2.\nThe UE receiving the rejected NSSAI in the REGISTRATION ACCEPT message takes the following actions based on the rejection cause in the rejected S-NSSAI(s):\n\"S-NSSAI not available in the current PLMN or SNPN\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN or SNPN as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current PLMN or SNPN over any access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\"S-NSSAI not available in the current registration area\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current registration area over the current until switching off the UE, the UE moving out of the current registration area, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\"\n\tThe UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over any access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.1 and 4.6.2.2.\n\"S-NSSAI not available due to maximum number of UEs reached\"\n\tUnless the back-off timer value received along with the S-NSSAI is zero, the UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over the current access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclauses\u00a04.6.1 and\u00a04.6.2.2.\nNOTE\u00a015:\tIf the back-off timer value received along with the S-NSSAI in the rejected NSSAI for the maximum number of UEs reached is zero as specified in subclause\u00a010.5.7.4a of 3GPP\u00a0TS\u00a024.008\u00a0[12], the UE does not consider the S-NSSAI as the rejected S-NSSAI.\nIf there is one or more S-NSSAIs in the rejected NSSAI with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\", then for each S-NSSAI, the UE shall behave as follows:\na)\tstop the timer T3526 associated with the S-NSSAI, if running;\nb)\tstart the timer T3526 with:\n1)\tthe back-off timer value received along with the S-NSSAI, if a back-off timer value is received along with the S-NSSAI that is neither zero nor deactivated; or\n2)\tan implementation specific back-off timer value, if no back-off timer value is received along with the S-NSSAI; and\nc)\tremove the S-NSSAI from the rejected NSSAI for the maximum number of UEs reached when the timer T3526 associated with the S-NSSAI expires.\nIf the UE sets the NSSAA bit in the 5GMM capability IE to \"Network slice-specific authentication and authorization not supported\", and:\na)\tif the Requested NSSAI IE only includes the S-NSSAI(s) subject to network slice-specific authentication and authorization and one or more default S-NSSAIs (containing one or more S-NSSAIs each of which may be associated with a new S-NSSAI) which are not subject to network slice-specific authentication and authorization are available, the AMF shall in the REGISTRATION ACCEPT message include:\n1)\tthe allowed NSSAI or the partially allowed NSSAI containing S-NSSAI(s) for the current PLMN or SNPN each of which corresponds to a default S-NSSAI which are not subject to network slice-specific authentication and authorization;\n2)\tthe allowed NSSAI or the partially allowed NSSAI containing the default S-NSSAIs, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, which are not subject to network slice-specific authentication and authorization; and\n3)\tthe rejected NSSAI containing the S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating \"S-NSSAI not available in the current PLMN or SNPN\", except if the UE has not set the ER-NSSAI bit to \"Extended rejected NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and the S-NSSAI(s) is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are subject to NSSAA; or\nb)\tif the Requested NSSAI IE includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, the AMF shall in the REGISTRATION ACCEPT message include:\n1)\tthe allowed NSSAI or the partially allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s) which are not subject to network slice-specific authentication and authorization; and\n2)\tthe rejected NSSAI containing:\ni)\tthe S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating \"S-NSSAI not available in the current PLMN or SNPN\", except if the UE has not set the ER-NSSAI bit to \"Extended rejected NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and the S-NSSAI is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are subject to NSSAA; and\nii)\tthe S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with the rejection cause indicating \"S-NSSAI not available in the current PLMN or SNPN\" or the rejection cause indicating \"S-NSSAI not available in the current registration area\", if any.\nIf the UE does not indicate support for network slice-specific authentication and authorization, the initial registration request is not for onboarding services in SNPN, and if:\na)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message; or\nb)\tnone of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed;\nand one or more default S-NSSAIs (containing one or more S-NSSAIs each of which may be associated with a new S-NSSAI) which are not subject to network slice-specific authentication and authorization are available, the AMF shall:\na)\tput the allowed S-NSSAI(s) for the current PLMN or SNPN each of which corresponds to a default S-NSSAI and not subject to network slice-specific authentication and authorization in the allowed NSSAI of the REGISTRATION ACCEPT message;\nb)\tput the default S-NSSAIs and not subject to network slice-specific authentication and authorization, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, in the allowed NSSAI of the REGISTRATION ACCEPT message; and\nc)\tdetermine a registration area such that all S-NSSAIs of the allowed NSSAI are available in the registration area.\nIf the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\", the UE shall delete the network slicing information for each and every PLMN or SNPN except for the current PLMN or SNPN as specified in subclause\u00a04.6.2.2 and remove all tracking areas from the list of \"5GS forbidden tracking areas for roaming\" which were added due to rejection of S-NSSAI due to \"S-NSSAI not available in the current registration area\".\nIf the REGISTRATION ACCEPT message contains the allowed NSSAI, then the UE shall store the included allowed NSSAI together with the PLMN identity of the registered PLMN or the SNPN identity of the registered SNPN and the registration area as specified in subclause\u00a04.6.2.2. If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, the UE shall store the received allowed NSSAI in each of allowed NSSAIs which are associated with each of the PLMNs.\nIf the REGISTRATION ACCEPT message contains a configured NSSAI IE with a new configured NSSAI for the current PLMN or SNPN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN or SNPN, the UE shall store the contents of the configured NSSAI IE as specified in subclause\u00a04.6.2.2. In addition, if the REGISTRATION ACCEPT message contains:\na)\tan NSSRG information IE, the UE shall store the contents of the NSSRG information IE as specified in subclause\u00a04.6.2.2. If the UE receives a new configured NSSAI in the REGISTRATION ACCEPT message and no NSSRG information IE, the UE shall delete any stored NSSRG information, if any, as specified in subclause\u00a04.6.2.2;\nb)\tan S-NSSAI location validity information in the Registration accept type 6 IE container IE, the UE shall store the contents of the S-NSSAI location validity information as specified in subclause\u00a04.6.2.2. If the UE receives a Configured NSSAI IE in the REGISTRATION ACCEPT message and no S-NSSAI location validity information, the UE shall delete any stored S-NSSAI location validity information as specified in subclause\u00a04.6.2.2;\nc)\tan S-NSSAI time validity information IE, the UE shall store the contents of the S-NSSAI time validity information IE as specified in subclause\u00a04.6.2.2. If the UE receives a Configured NSSAI IE in the REGISTRATION ACCEPT message and no S-NSSAI time validity information IE, the UE shall delete any stored S-NSSAI time validity information as specified in subclause\u00a04.6.2.2; or\nd)\tan On-demand NSSAI IE, the UE shall store the contents of the On-demand NSSAI IE as specified in subclause\u00a04.6.2.2. If the UE receives a Configured NSSAI IE in the REGISTRATION ACCEPT message and no On-demand NSSAI IE, the UE shall delete any stored on-demand NSSAI as specified in subclause\u00a04.6.2.2. The UE shall stop slice deregistration inactivity timer, if running for the S-NSSAI which is deleted from the on-demand NSSAI.\nIf the REGISTRATION ACCEPT message:\na)\tincludes the 5GS registration result IE with the \"NSSAA to be performed\" indicator set to \"Network slice-specific authentication and authorization is to be performed\";\nb)\tincludes a pending NSSAI;\nc)\tdoes not include an allowed NSSAI; and\nd)\tdoes not include an partially allowed NSSAI,\nthe UE shall delete the stored allowed NSSAI, if any, as specified in subclause\u00a04.6.2.2, and the UE:\na)\tshall not initiate a 5GSM procedure except for emergency services ; and\nb)\tshall not initiate a service request procedure except for cases f), i), m) and o) in subclause\u00a05.6.1.1;\nc)\tshall not initiate an NAS transport procedure except for sending SMS, an LPP message, a UPP-CMI container, an SLPP message, a location service message, an SOR transparent container, a UE policy container, a UE parameters update transparent container or a CIoT user data container;\nuntil the UE receives an allowed NSSAI, a partially allowed NSSAI, or both.\nIf the UE included S1 mode supported indication in the REGISTRATION REQUEST message, the AMF supporting interworking with EPS shall set the IWK N26 bit to either:\na)\t\"interworking without N26 interface not supported\" if the AMF supports N26 interface; or\nb)\t\"interworking without N26 interface supported\" if the AMF does not support N26 interface\nin the 5GS network feature support IE in the REGISTRATION ACCEPT message.\nThe UE supporting S1 mode shall operate in the mode for interworking with EPS as follows:\na)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface not supported\", the UE shall operate in single-registration mode;\nb)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface supported\" and the UE supports dual-registration mode, the UE may operate in dual-registration mode; or\nNOTE\u00a016:\tThe registration mode used by the UE is implementation dependent.\nc)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface supported\" and the UE only supports single-registration mode, the UE shall operate in single-registration mode.\nThe UE shall store the received interworking without N26 interface indicator for interworking with EPS as specified in annex\u00a0C.1 and treat it as valid in the entire PLMN and its equivalent PLMN(s).\nThe network informs the UE about the support of specific features, such as IMS voice over PS session, location services (5G-LCS), emergency services, emergency services fallback, ATSSS and non-3GPP access path switching, in the 5GS network feature support information element. In a UE with IMS voice over PS session capability, the IMS voice over PS session indicator, the Emergency services support indicator, and the Emergency services fallback indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account when selecting the access domain for voice sessions or calls. In a UE with LCS capability, location services indicator (5G-LCS) shall be provided to the upper layers. When initiating an emergency call, the upper layers also take the IMS voice over PS session indicator, the Emergency services support indicator, and the Emergency services fallback indicator into account for the access domain selection. In a UE with the capability for ATSSS, the network support for ATSSS shall be provided to the upper layers. If the UE receives the 5GS network feature support IE with the ATSSS support indicator set to \"ATSSS not supported\", the UE shall perform a local release of the MA PDU session, if any. In a UE that supports non-3GPP access path switching, the network support for non-3GPP access path switching shall be provided to the upper layers. If the UE receives the 5GS network feature support IE with the non-3GPP access path switching bit set to \"non-3GPP access path switching not supported\", the UE shall not perform the registration procedure for mobility registration update for non-3GPP access path switching.\nNOTE\u00a017:\tIf the UE is registered to different PLMNs over 3GPP and non-3GPP accesses, the UE uses the capability received over non-3GPP access to determine whether to initiate the registration procedure for mobility registration update for non-3GPP path switching.\nThe AMF shall set the EMF bit in the 5GS network feature support IE to:\na)\t\"Emergency services fallback supported in NR connected to 5GCN and E-UTRA connected to 5GCN\" if the network supports the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN or an E-UTRA cell connected to 5GCN;\nb)\t\"Emergency services fallback supported in NR connected to 5GCN only\" if the network supports the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN and does not support the emergency services fallback procedure when the UE is in an E-UTRA cell connected to 5GCN;\nc)\t\"Emergency services fallback supported in E-UTRA connected to 5GCN only\" if the network supports the emergency services fallback procedure when the UE is in an E-UTRA cell connected to 5GCN and does not support the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN; or\nd)\t\"Emergency services fallback not supported\" if network does not support the emergency services fallback procedure when the UE is in any cell connected to 5GCN.\nNOTE\u00a018:\tIf the emergency services are supported in neither the EPS nor the 5GS homogeneously, based on operator policy, the AMF will set the EMF bit in the 5GS network feature support IE to \"Emergency services fallback not supported\".\nNOTE\u00a019:\tEven though the AMF's support of emergency services fallback is indicated per RAT, the UE's support of emergency services fallback is not per RAT, i.e. the UE's support of emergency services fallback is the same for both NR connected to 5GCN and E-UTRA connected to 5GCN.\nAccess identity 1 is only applicable while the UE is in N1 mode. Access identity 2 is only applicable while the UE is in N1 mode.\nWhen the UE is registered to the same PLMN or SNPN over 3GPP and non-3GPP access, the UE and the AMF maintain one MPS indicator and one MCS indicator that are common to both 3GPP and non-3GPP access. When the UE is registered to different PLMNs or SNPNs over 3GPP access and non-3GPP access, the UE maintains two MPS indicators and two MCS indicators separately for different accesses i.e., an MPS indicator and an MCS indicator for the 3GPP access and another MPS indicator and an MCS indicator for the non-3GPP access. For both 3GPP and non-3GPP access, the access identity is determined according to subclause\u00a04.5.2:\n-\tif the UE is not operating in SNPN access operation mode:\na)\tthe network informs the UE that the use of access identity 1 is valid in the RPLMN or equivalent PLMN by setting the MPS indicator bit of the 5GS network feature support IE to \"Access identity 1 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM;\nb)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access; \n\tthe UE shall act as a UE with access identity 1 configured for MPS, as described in subclause\u00a04.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in all NG-RAN of the registered PLMN and its equivalent PLMNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MPS indicator bit set to \"Access identity 1 not valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access; or \n\tuntil the UE selects a non-equivalent PLMN over 3GPP access;\nb1)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\":\n-\tvia non-3GPP access; or\n-\tvia 3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access;\n\tthe UE shall act as a UE with access identity 1 configured for MPS, as described in subclause\u00a04.5.2, in non-3GPP access of the registered PLMN and its equivalent PLMNs. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in non-3GPP access of the registered PLMN and its equivalent PLMNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MPS indicator bit set to \"Access identity 1 not valid\":\n-\tvia non-3GPP access; or\n-\tvia 3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access; or\n\tuntil the UE selects a non-equivalent PLMN over non-3GPP access;\nc)\tthe network informs the UE that the use of access identity 2 is valid in the RPLMN or equivalent PLMN by setting the MCS indicator bit of the 5GS network feature support IE to \"Access identity 2 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM;\nd)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access;\nthe UE shall act as a UE with access identity 2 configured for MCS, as described in subclause\u00a04.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in all NG-RAN of the registered PLMN and its equivalent PLMNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MCS indicator bit set to \"Access identity 2 not valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access; or \n\tuntil the UE selects a non-equivalent PLMN over 3GPP access; and\nd1)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\":\n-\tvia non-3GPP access; or\n-\tvia 3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access;\n\tthe UE shall act as a UE with access identity 2 configured for MCS, as described in subclause\u00a04.5.2, in non-3GPP access of the registered PLMN and its equivalent PLMNs. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in non-3GPP access of the registered PLMN and its equivalent PLMNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MCS indicator bit set to \"Access identity 2 not valid\":\n-\tvia non-3GPP access; or\n-\tvia 3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access; or\n\tuntil the UE selects a non-equivalent PLMN over non-3GPP access; or\n-\tif the UE is operating in SNPN access operation mode:\na)\tthe network informs the UE that the use of access identity 1 is valid in the RSNPN or equivalent SNPN by setting the MPS indicator bit of the 5GS network feature support IE to \"Access identity 1 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM;\nb)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\":\n-\tvia 3GPP access; or \n-\tvia non-3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access; \n\tthe UE shall act as a UE with access identity 1 configured for MPS, as described in subclause\u00a04.5.2A, in all NG-RAN of the registered SNPN and its equivalent SNPNs. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in all NG-RAN of the registered SNPN and its equivalent SNPNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MPS indicator bit set to \"Access identity 1 not valid\": \n-\tvia 3GPP access; or \n-\tvia non-3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access; or \n\tuntil the UE selects a non-equivalent SNPN over 3GPP access;\nb1)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\": \n-\tvia non-3GPP access; or \n-\tvia 3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access; \n\tthe UE shall act as a UE with access identity 1 configured for MPS, as described in subclause\u00a04.5.2A, in non-3GPP access of the registered SNPN and its equivalent SNPNs. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in non-3GPP access of the registered SNPN and its equivalent SNPNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MPS indicator bit set to \"Access identity 1 not valid\"; \n-\tvia non-3GPP access; or \n-\tvia 3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access; or \n\tuntil the UE selects a non-equivalent SNPN over non-3GPP access;\nc)\tthe network informs the UE that the use of access identity 2 is valid in the RSNPN or equivalent SNPN by setting the MCS indicator bit of the 5GS network feature support IE to \"Access identity 2 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM;\nd)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\": \n-\tvia 3GPP access; or \n-\tvia non-3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access; \n\tthe UE shall act as a UE with access identity 2 configured for MCS, as described in subclause\u00a04.5.2A, in all NG-RAN of the registered SNPN and its equivalent SNPNs. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in all NG-RAN of the registered SNPN and its equivalent SNPNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MCS indicator bit set to \"Access identity 2 not valid\": \n-\tvia 3GPP access; or \n-\tvia non-3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access; or \nuntil the UE selects a non-equivalent SNPN over 3GPP access; and\nd1)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\": \n-\tvia non-3GPP access; or \n-\tvia 3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access; \n\tthe UE shall act as a UE with access identity 2 configured for MCS, as described in subclause\u00a04.5.2A, in non-3GPP access of the registered SNPN and its equivalent SNPNs. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in non-3GPP access of the registered SNPN and its equivalent SNPNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MCS indicator bit set to \"Access identity 2 not valid\":\n-\tvia non-3GPP access; or \n-\tvia 3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access; or \n\tuntil the UE selects a non-equivalent SNPN over non-3GPP access.\nIf the UE indicates support for restriction on use of enhanced coverage in the REGISTRATION REQUEST message and:\na)\tin WB-N1 mode, the AMF decides to restrict the use of CE mode B for the UE, then the AMF shall set the RestrictEC bit to \"CE mode B is restricted\";\nb)\tin WB-N1 mode, the AMF decides to restrict the use of both CE mode A and CE mode B for the UE, then the AMF shall set the RestrictEC bit to \" Both CE mode A and CE mode B are restricted\"; or\nc)\tin NB-N1 mode, the AMF decides to restrict the use of enhanced coverage for the UE, then the AMF shall set the RestrictEC bit to \"Use of enhanced coverage is restricted\",\nin the 5GS network feature support IE in the REGISTRATION ACCEPT message.\nIf the UE indicates support of the N1 NAS signalling connection release in the REGISTRATION REQUEST message and the network decides to accept the N1 NAS signalling connection release, then the AMF shall set the N1 NAS signalling connection release bit to \"N1 NAS signalling connection release supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message.\nIf the UE indicates support of the paging indication for voice services in the REGISTRATION REQUEST message and the network decides to accept the paging indication for voice services, then the AMF shall set the paging indication for voice services bit to \"paging indication for voice services supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message. Upon receipt of REGISTRATION ACCEPT message with the paging indication for voice services bit set to \"paging indication for voice services supported\", the UE NAS layer informs the lower layers that paging indication for voice services is supported. Otherwise, the UE NAS layer informs the lower layers that paging indication for voice services is not supported.\nIf the UE indicates support of the reject paging request in the REGISTRATION REQUEST message and the network decides to accept the reject paging request, then the AMF shall set the reject paging request bit to \"reject paging request supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message.\nIf the UE indicates support of the paging restriction in the REGISTRATION REQUEST message, and the AMF sets:\n-\tthe reject paging request bit to \"reject paging request supported\";\n-\tthe N1 NAS signalling connection release bit to \"N1 NAS signalling connection release supported\"; or\n-\tboth of them;\nin the 5GS network feature support IE of the REGISTRATION ACCEPT message, and the network decides to accept the paging restriction, then the AMF shall set the paging restriction bit to \"paging restriction supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message.\nIf the UE indicates support of ranging and sidelink positioning in the REGISTRATION REQUEST message and the network supports and accepts the use of ranging and sidelink positioning, the AMF shall set the ranging and sidelink positioning supported bit to \"Ranging and sidelink positioning supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message.\nIf the UE has set the Follow-on request indicator to \"Follow-on request pending\" in the REGISTRATION REQUEST message, or the network has downlink signalling pending, the AMF shall not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the UE is authorized to use V2X communication over PC5 reference point based on:\na)\tat least one of the following bits in the 5GMM capability IE of the REGISTRATION REQUEST message set by the UE, or already stored in the 5GMM context in the AMF during the previous registration procedure as follows:\n1)\tthe V2XCEPC5 bit to \"V2X communication over E-UTRA-PC5 supported\"; or\n2)\tthe V2XCNPC5 bit to \"V2X communication over NR-PC5 supported\"; and\nb)\tthe user's subscription context obtained from the UDM as defined in 3GPP\u00a0TS\u00a023.287\u00a0[6C];\nthe AMF should not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the UE is authorized to use A2X communication over PC5 reference point based on:\na)\tat least one of the following bits in the 5GMM capability IE of the REGISTRATION REQUEST message set by the UE, or already stored in the 5GMM context in the AMF during the previous registration procedure as follows:\n1)\tthe A2XEPC5 bit to \"A2X over E-UTRA-PC5 supported\"; or\n2)\tthe A2XNPC5 bit to \"A2X over NR-PC5 supported\"; and\nb)\tthe user's subscription context obtained from the UDM as defined in 3GPP\u00a0TS\u00a023.256\u00a0[6C];\nthe AMF should not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the UE is authorized to use 5G ProSe services based on:\na)\tat least one of the following bits in the 5GMM capability IE of the REGISTRATION REQUEST message set by the UE, or already stored in the 5GMM context in the AMF during the previous registration procedure as follows:\n1)\tthe 5G ProSe direct discovery bit to \"5G ProSe direct discovery supported\"; or\n2)\tthe 5G ProSe direct communication bit to \"5G ProSe direct communication supported\"; and\nb)\tthe user's subscription context obtained from the UDM as defined in 3GPP\u00a0TS\u00a023.304\u00a0[6E];\nthe AMF should not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the Requested DRX parameters IE was included in the REGISTRATION REQUEST message, the AMF shall include the Negotiated DRX parameters IE in the REGISTRATION ACCEPT message and replace any stored Negotiated DRX parameter and use it for the downlink transfer of signalling and user data. The AMF may set the Negotiated DRX parameters IE based on the received Requested DRX parameters IE and operator policy if available.\nIf the Requested NB-N1 mode DRX parameters IE was included in the REGISTRATION REQUEST message, the AMF shall include the Negotiated NB-N1 mode DRX parameters IE in the REGISTRATION ACCEPT message and replace any stored Negotiated NB-N1 mode DRX parameters and use it for the downlink transfer of signalling and user data in NB-N1 mode. The AMF may set the Negotiated NB-N1 mode DRX parameters IE based on the received Requested NB-N1 mode DRX parameters IE and operator policy if available.\nThe AMF shall include the Negotiated extended DRX parameters IE in the REGISTRATION ACCEPT message only if the Requested extended DRX parameters IE was included in the REGISTRATION REQUEST message, and the AMF supports and accepts the use of eDRX. The AMF may set the Negotiated extended DRX parameters IE based on the received Requested extended DRX parameters IE, operator policy, information from NG-RAN and the user's subscription context obtained from the UDM if available.\nIf:\na)\tthe UE's USIM is configured with indication that the UE is to receive the SOR transparent container IE, the SOR transparent container IE included in the REGISTRATION ACCEPT message does not successfully pass the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]); and\nb)\tif the UE attempts obtaining service on another PLMNs as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C;\nthen the UE shall locally release the established N1 NAS signalling connection after sending a REGISTRATION COMPLETE message.\nIf:\na)\tthe UE's USIM is configured with indication that the UE is to receive the SOR transparent container IE, the SOR transparent container IE is not included in the REGISTRATION ACCEPT message; and\nb)\tthe UE attempts obtaining service on another PLMNs as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C;\nthen the UE shall locally release the established N1 NAS signalling connection.\nIf:\na)\tthe UE operates in SNPN access operation mode;\nb)\tthe ME is configured to indicate that the UE shall expect to receive the steering of roaming information during initial registration procedure for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription;\nc)\tthe SOR transparent container IE included in the REGISTRATION ACCEPT message does not successfully pass the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]); and\nd)\tthe UE attempts obtaining service on another SNPN as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C;\nthen the UE shall locally release the established N1 NAS signalling connection after sending a REGISTRATION COMPLETE message.\nIf:\na)\tthe UE operates in SNPN access operation mode;\nb)\tthe ME is configured to indicate that the UE shall expect to receive the steering of roaming information during initial registration procedure for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription;\nc)\tthe SOR transparent container IE is not included in the REGISTRATION ACCEPT message; and\nd)\tthe UE attempts obtaining service on another SNPN as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C;\nthen the UE shall locally release the established N1 NAS signalling connection.\nIf the REGISTRATION ACCEPT message includes the SOR transparent container IE and the SOR transparent container IE successfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]), the ME shall store the received SOR counter as specified in annex\u00a0C and proceed as follows:\na)\tthe UE shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; and\nb)\tif the registration procedure is performed over 3GPP access and the UE attempts obtaining service on another PLMNs or SNPNs as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C, then the UE may locally release the established N1 NAS signalling connection after sending a REGISTRATION COMPLETE message. Otherwise the UE shall send a REGISTRATION COMPLETE message and not release the current N1 NAS signalling connection locally. If an acknowledgement is requested in the SOR transparent container IE of the REGISTRATION ACCEPT message, the UE acknowledgement is included in the SOR transparent container IE of the REGISTRATION COMPLETE message. In the SOR transparent container IE carrying the acknowledgement, the UE shall set the ME support of SOR-CMCI indicator to \"SOR-CMCI supported by the ME\". Additionally, if the UE supports access to an SNPN using credentials from a credentials holder and the UE is not operating in SNPN access operation mode, the UE may set the ME support of SOR-SNPN-SI indicator to \"SOR-SNPN-SI supported by the ME\". Additionally, if the UE supports access to an SNPN providing access for localized services in SNPN, the UE shall set the ME support of SOR-SNPN-SI-LS indicator to \"SOR-SNPN-SI-LS supported by the ME\"\nIf the SOR transparent container IE successfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]) and:\na)\tthe list type indicates:\n1)\t\"PLMN ID and access technology list\", and the SOR transparent container IE indicates a list of preferred PLMN/access technology combinations is provided, then the ME shall replace the highest priority entries in the \"Operator Controlled PLMN Selector with Access Technology\" list stored in the ME and shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; or\n2)\t\"secured packet\", then the ME shall behave as if a SMS is received with protocol identifier set to SIM data download, data coding scheme set to class 2 message and SMS payload as secured packet contents of SOR transparent container IE. The SMS payload is forwarded to UICC as specified in 3GPP\u00a0TS\u00a023.040\u00a0[4A] and the ME shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; or\nb)\tthe list type indicates \"PLMN ID and access technology list\" and the SOR transparent container IE indicates \"HPLMN indication that 'no change of the \"Operator Controlled PLMN Selector with Access Technology\" list stored in the UE is needed and thus no list of preferred PLMN/access technology combinations is provided'\", the UE operates in SNPN access operation mode and the SOR transparent container IE includes SOR-SNPN-SI, the ME shall replace SOR-SNPN-SI of the selected entry of the \"list of subscriber data\" or associated with the selected PLMN subscription, as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] with the received SOR-SNPN-SI. Additionally, if the SOR transparent container IE includes SOR-SNPN-SI-LS, the ME shall replace SOR-SNPN-SI-LS of the selected entry of the \"list of subscriber data\" or associated with the selected PLMN subscription, as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] with the received SOR-SNPN-SI-LS.\n\tIf the SOR-CMCI is present and the Store SOR-CMCI in ME indicator is set to \"Store SOR-CMCI in ME\" then the UE shall store or delete the SOR-CMCI in the non-volatile memory of the ME as described in annex\u00a0C.1.\n\tThe UE shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C.\nIf the SOR transparent container IE does not pass the integrity check successfully, then the UE shall discard the content of the SOR transparent container IE.\nIf required by operator policy, the AMF shall include the NSSAI inclusion mode IE in the REGISTRATION ACCEPT message (see table\u00a04.6.2.3.1 of subclause\u00a04.6.2.3). Upon receipt of the REGISTRATION ACCEPT message:\na)\tif the message includes the NSSAI inclusion mode IE, the UE shall operate in the NSSAI inclusion mode indicated in the NSSAI inclusion mode IE over the current access within the current PLMN and its equivalent PLMN(s), if any, or the current SNPN ,in the current registration area; or\nb)\totherwise:\n1)\tif the UE has NSSAI inclusion mode for the current PLMN or SNPN and access type stored in the UE, the UE shall operate in the stored NSSAI inclusion mode;\n2)\tif the UE does not have NSSAI inclusion mode for the current PLMN or SNPN and the access type stored in the UE and if the UE is performing the registration procedure over:\ni)\t3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0D in the current PLMN or SNPN and the current access type;\nii)\tuntrusted non-3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0B in the current PLMN and the current access type; or\niii)\ttrusted non-3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0D in the current PLMN and the current access type; or\n3)\tif the 5G-RG does not have NSSAI inclusion mode for the current PLMN and wireline access stored in the 5G-RG, and the 5G-RG is performing the registration procedure over wireline access, the 5G-RG shall operate in NSSAI inclusion mode\u00a0B in the current PLMN and the current access type.\nThe AMF may include operator-defined access category definitions in the REGISTRATION ACCEPT message.\nIf the UE receives Operator-defined access category definitions IE in the REGISTRATION ACCEPT message and the Operator-defined access category definitions IE contains one or more operator-defined access category definitions, the UE shall delete any operator-defined access category definitions stored for the RPLMN and shall store the received operator-defined access category definitions for the RPLMN. If the UE receives the Operator-defined access category definitions IE in the REGISTRATION ACCEPT message and the Operator-defined access category definitions IE contains no operator-defined access category definitions, the UE shall delete any operator-defined access category definitions stored for the RPLMN. If the REGISTRATION ACCEPT message does not contain the Operator-defined access category definitions IE, the UE shall not delete the operator-defined access category definitions stored for the RPLMN.\nIf the UE has indicated support for service gap control in the REGISTRATION REQUEST message and:\n-\tthe REGISTRATION ACCEPT message contains the T3447 value IE, then the UE shall store the new T3447 value, erase any previous stored T3447 value if exists and use the new T3447 value with the timer T3447 next time it is started; or\n-\tthe REGISTRATION ACCEPT message does not contain the T3447 value IE, then the UE shall erase any previous stored T3447 value if exists and stop the timer T3447 if running.\nIf the T3448 value IE is present in the received REGISTRATION ACCEPT message and the value indicates that this timer is neither zero nor deactivated, the UE shall:\na)\tstop timer T3448 if it is running; and\nb)\tstart timer T3448 with the value provided in the T3448 value IE.\nIf the UE is using 5GS services with control plane CIoT 5GS optimization, the T3448 value IE is present in the REGISTRATION ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall ignore the T3448 value IE and proceed as if the T3448 value IE was not present.\nIf the REGISTRATION ACCEPT message contains the Truncated 5G-S-TMSI configuration IE, then the UE shall store the included truncated 5G-S-TMSI configuration and return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the truncated 5G-S-TMSI configuration.\nNOTE\u00a020: The UE provides the truncated 5G-S-TMSI configuration to the lower layers.\nIf the UE is not in NB-N1 mode, the UE has set the RACS bit to \"RACS supported\" in the 5GMM Capability IE of the REGISTRATION REQUEST message and the REGISTRATION ACCEPT message includes:\na)\ta UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\", the UE shall delete any network-assigned UE radio capability IDs associated with the RPLMN or RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription stored at the UE, then the UE shall, after the completion of the ongoing registration procedure, initiate a registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3.2 over the existing N1 NAS signalling connection; or\nb)\ta UE radio capability ID IE, the UE shall store the UE radio capability ID as specified in annex\u00a0C.\nIf the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message and the REGISTRATION ACCEPT message contains the service-level-AA pending indication in the Service-level-AA container IE, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the service-level-AA pending indication, and the UE shall not attempt to perform another registration procedure for UAS services until the UUAA-MM procedure is completed, or to establish a PDU session for USS communication or a PDU session for C2 communication until the UUAA-MM procedure is completed successfully.\nIf the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message and the REGISTRATION ACCEPT message does not contain the service-level-AA pending indication in the Service-level-AA container IE, the UE shall consider the UUAA-MM procedure is not triggered.\nIf the REGISTRATION REQUEST message includes the 5GS registration type IE set to \"SNPN onboarding registration\" or the network determines that the UE's subscription only allows for configuration of SNPN subscription parameters in PLMN via the user plane, the AMF may start an implementation specific timer for onboarding services when the network considers that the UE is in 5GMM-REGISTERED (i.e. the network receives the REGISTRATION COMPLETE message from UE).\nNOTE\u00a021:\tIf the AMF considers that the UE is in 5GMM-IDLE, when the implementation specific timer for onboarding services expires and the network considers that the UE is still in state 5GMM-REGISTERED, the AMF can locally de-register the UE; or if the UE is in 5GMM-CONNECTED, the AMF can initiate the network-initiated de-registration procedure (see subclause 5.5.2.3).\nNOTE\u00a022:\tThe value of the implementation specific timer for onboarding services needs to be large enough to allow a UE to complete the configuration of one or more entries of the \"list of subscriber data\" taking into consideration that configuration of SNPN subscription parameters in PLMN via the user plane or onboarding services in SNPN involves third party entities outside of the operator's network.\nIf the UE receives the List of PLMNs to be used in disaster condition IE in the REGISTRATION ACCEPT message and the UE supports MINT, the UE shall delete the \"list of PLMN(s) to be used in disaster condition\" stored in the ME together with the PLMN ID of the RPLMN, if any, and may store the \"list of PLMN(s) to be used in disaster condition\" included in the List of PLMNs to be used in disaster condition IE in the ME together with the PLMN ID of the RPLMN.\nIf the UE receives the Disaster roaming wait range IE in the REGISTRATION ACCEPT message and the UE supports MINT, the UE shall delete the disaster roaming wait range stored in the ME, if any, and store the disaster roaming wait range included in the Disaster roaming wait range IE in the ME.\nIf the UE receives the Disaster return wait range IE in the REGISTRATION ACCEPT message and the UE supports MINT, the UE shall delete the disaster return wait range stored in the ME, if any, and store the disaster return wait range included in the Disaster return wait range IE in the ME.\nIf the 5GS registration type IE in the REGISTRATION REQUEST message is set to \"disaster roaming initial registration\" and:\na)\tthe MS determined PLMN with disaster condition IE is included in the REGISTRATION REQUEST message, the AMF shall determine the PLMN with disaster condition in the MS determined PLMN with disaster condition IE;\nb)\tthe MS determined PLMN with disaster condition IE is not included in the REGISTRATION REQUEST message and the Additional GUTI IE is included in the REGISTRATION REQUEST message and contains 5G-GUTI of a PLMN of the country of the PLMN providing disaster roaming services, the AMF shall determine the PLMN with disaster condition in the PLMN identity of the 5G-GUTI;\nc)\tthe MS determined PLMN with disaster condition IE and the Additional GUTI IE are not included in the REGISTRATION REQUEST message and:\n1)\tthe 5GS mobile identity IE contains 5G-GUTI of a PLMN of the country of the PLMN providing disaster roaming services, the AMF shall determine the PLMN with disaster condition in the PLMN identity of the 5G-GUTI; or\n2)\tthe 5GS mobile identity IE contains SUCI of a PLMN of the country of the PLMN providing disaster roaming services, the AMF shall determine the PLMN with disaster condition in the PLMN identity of the SUCI; or\nd)\tthe MS determined PLMN with disaster condition IE is not included in the REGISTRATION REQUEST message, NG-RAN of the PLMN providing disaster roaming services broadcasts disaster roaming indication and:\n-\tthe Additional GUTI IE is included in the REGISTRATION REQUEST message and contains 5G-GUTI of a PLMN of a country other than the country of the PLMN providing disaster roaming services; or\n-\tthe Additional GUTI IE is not included and the 5GS mobile identity IE contains 5G-GUTI or SUCI of a PLMN of a country other than the country of the PLMN providing disaster roaming services;\n\tthe AMF shall determine the PLMN with disaster condition based on the disaster roaming agreement arrangement between mobile network operators.\nNOTE\u00a023:\tThe disaster roaming agreement arrangement between mobile network operators is out scope of 3GPP.\nIf the AMF determines that a disaster condition applies to the PLMN with disaster condition, and the UE is allowed to be registered for disaster roaming services, the AMF shall set the Disaster roaming registration result value bit in the 5GS registration result IE to \"no additional information\" in the REGISTRATION ACCEPT message. If the AMF determines that the UE can be registered to the PLMN for normal service, the AMF shall set the Disaster roaming registration result value bit in the 5GS registration result IE to \"request for registration for disaster roaming services accepted as registration not for disaster roaming services\" in the REGISTRATION ACCEPT message.\nIf the UE indicates \"disaster roaming initial registration\" in the 5GS registration type IE in the REGISTRATION REQUEST message and the 5GS registration result IE value in the REGISTRATION ACCEPT message is set to:\n-\t\"request for registration for disaster roaming service accepted as registration not for disaster roaming services\", the UE shall consider itself registered for normal service. If the PLMN identity of the registered PLMN is a member of the forbidden PLMN list as specified in subclause\u00a05.3.13A, any such PLMN identity shall be deleted from the corresponding list(s). If UE supports S1 mode, the UE shall initiate the registration procedure for mobility and periodic registration update and indicate that S1 mode is supported as described in subclause\u00a05.5.1.3.2; or\n-\t\"no additional information\", the UE shall consider itself registered for disaster roaming services.\nIf the UE receives the forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE in the REGISTRATION ACCEPT message, the UE shall store the TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE, if not already stored, into the list of \"5GS forbidden tracking areas for roaming\".\nIf the UE receives the forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE in the REGISTRATION ACCEPT message, the UE shall store the TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE, if not already stored, into the list of \"5GS forbidden tracking areas for regional provision of service\".\nIf the UE supporting the reconnection to the network due to RAN timing synchronization status change receives the RAN timing synchronization IE with the RecReq bit set to \"Reconnection requested\" in the REGISTRATION ACCEPT message, the UE shall operate as specified in subclauses\u00a05.3.1.4, 5.5.1.3.2 and 5.6.1.1.\nIf the UE supports discontinuous coverage, the AMF may include the Discontinuous coverage maximum time offset IE in the REGISTRATION ACCEPT message.\nIf the UE receives, the Discontinuous coverage maximum time offset IE in the REGISTRATION ACCEPT message, the UE shall replace any previously received discontinuous coverage maximum time offset value on the same satellite NG-RAN RAT type and PLMN with the latest received timer value.\nIf for discontinuous coverage the AMF includes Unavailability configuration IE in the REGISTRATION ACCEPT message and sets the End of unavailability report bit to \u201cUE does not need to report end of unavailability\u201d, the UE is not required to initiate the registration procedure for mobility registration update when the unavailability period duration has ended. If the Unavailability configuration IE includes a value of the unavailability period duration, then the UE may either:\na)\tuse the received value for unavailability period duration; or\nb)\tdetermine another value for unavailability period duration.\nNOTE\u00a024: The UE can consider the received value from the network when determining the value for unavailability period duration.\nIf the UE operating as MBSR receives the MBSRAI field of the Feature authorization indication IE in the REGISTRATION ACCEPT message, the UE NAS layer informs the lower layers of the status of MBSR authorization as specified in clause\u00a05.35A.4 of 3GPP\u00a0TS\u00a023.501\u00a0[8].\n5.5.1.2.5\tInitial registration not accepted by the network\nIf the initial registration request cannot be accepted by the network, the AMF shall send a REGISTRATION REJECT message to the UE including an appropriate 5GMM cause value.\nIf the initial registration request is rejected due to general NAS level mobility management congestion control, the network shall set the 5GMM cause value to #22 \"congestion\" and assign a value for back-off timer T3346.\nIn NB-N1 mode, if the registration request is rejected due to operator determined barring (see 3GPP\u00a0TS\u00a029.503\u00a0[20AB]), the network shall set the 5GMM cause value to #22 \"congestion\" and assign a value for back-off timer T3346.\nIf the REGISTRATION REJECT message with 5GMM cause #76 or #78 was received without integrity protection, then the UE shall discard the message. If the REGISTRATION REJECT message with 5GMM cause #62 was received without integrity protected, the behaviour of the UE is specified in subclause\u00a05.3.20.2.\nBased on operator policy, if the initial registration request is rejected due to core network redirection for CIoT optimizations, the network shall set the 5GMM cause value to #31 \"Redirection to EPC required\".\nNOTE\u00a01:\tThe network can take into account the UE's S1 mode capability, the EPS CIoT network behaviour supported by the UE or the EPS CIoT network behaviour supported by the EPC to determine the rejection with the 5GMM cause value #31 \"Redirection to EPC required\".\nIf the initial registration request is rejected because:\na)\tall the S-NSSAI(s) included in the requested NSSAI are rejected; and\nb)\tthe UE set the NSSAA bit in the 5GMM capability IE to:\n1)\t\"Network slice-specific authentication and authorization supported\" and:\ni)\tvoid;\nii)\tall default S-NSSAIs are not allowed; or\niii)\tnetwork slice-specific authentication and authorization has failed or been revoked for all default S-NSSAIs and based on network local policy, the network decides not to initiate the network slice-specific re-authentication and re-authorization procedures for any default S-NSSAI requested by the UE; or\n2)\t\"Network slice-specific authentication and authorization not supported\" and all default S-NSSAIs are either not allowed or are subject to network slice-specific authentication and authorization;\ni)\tvoid\nii)\tvoid\nthe network shall set the 5GMM cause value of the REGISTRATION REJECT message to #62 \"No network slices available\".\nIf the 5GMM cause value is set to #62 \"No network slices available\", the network shall include, in the rejected NSSAI of the REGISTRATION REJECT message, all the S-NSSAI(s) which were included in the requested NSSAI.\nIf the UE has set the ER-NSSAI bit to \"Extended rejected NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the rejected S-NSSAI(s) shall be included in the Extended rejected NSSAI IE of the REGISTRATION REJECT message. Otherwise, the rejected S-NSSAI(s) shall be included in the Rejected NSSAI IE of the REGISTRATION REJECT message.\nIn roaming scenarios, if the Extended rejected NSSAI IE is included in the REGISTRATION REJECT message, the AMF shall provide mapped S-NSSAI(s) for the rejected NSSAI.\nIf the UE supports extended rejected NSSAI and the AMF determines that maximum number of UEs reached for one or more S-NSSAIs in the requested NSSAI as specified in subclause\u00a04.6.2.5, the AMF shall include the rejected NSSAI containing one or more S-NSSAIs with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\" in the Extended rejected NSSAI IE in the REGISTRATION REJECT message. In addition, the AMF may include a back-off timer value for each S-NSSAI with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\" in the Extended rejected NSSAI IE of the REGISTRATION REJECT message.\nIf the AMF receives the initial registration request along with the authenticated indication over N2 reference point on non-3GPP access and does not receive the indication that authentication by the home network is not required over N12 reference point, or the 5G-RG acting on behalf of an AUN3 device is not allowed to access 5GS as specified in 3GPP\u00a0TS\u00a023.316\u00a0[6D], the network shall set the 5GMM cause value to #72 \"Non-3GPP access to 5GCN not allowed\".\nIf the initial registration request from a UE supporting CAG is rejected due to CAG restrictions, the network shall set the 5GMM cause value to #76 \"Not authorized for this CAG or authorized for CAG cells only\" and should include the \"CAG information list\" in the CAG information list IE or the Extended CAG information list IE in the REGISTRATION REJECT message.\nNOTE\u00a02:\tThe network cannot be certain that \"CAG information list\" stored in the UE is updated as result of sending of the REGISTRATION REJECT message with the CAG information list IE or the Extended CAG information list IE, as the REGISTRATION REJECT message is not necessarily delivered to the UE (e.g. due to abnormal radio conditions).\nNOTE\u00a03:\tThe \"CAG information list\" can be provided by the AMF and include no entry if no \"CAG information list\" exists in the subscription.\nNOTE\u00a04:\tIf the UE supports extended CAG information list, the CAG information list can be included either in the CAG information list IE or Extended CAG information list IE.\nNOTE\u00a04A:\tIt is unexpected for network to send REGISTRATION REJECT message to the UE with 5GMM cause value #76 in non-CAG cell and not indicate \"Indication that the UE is only allowed to access 5GS via CAG cells\" for the serving PLMN in the Extended CAG information list or the CAG information list.\nIf the UE does not support extended CAG information list, the CAG information list shall not be included in the Extended CAG information list IE.\nIf the initial registration request from a UE not supporting CAG is rejected due to CAG restrictions, the network shall operate as described in bullet\u00a0j) of subclause\u00a05.5.1.2.8.\nIf the UE's initial registration request is via a satellite NG-RAN cell and the network using the User Location Information provided by the NG-RAN, see 3GPP\u00a0TS\u00a038.413\u00a0[31], is able to determine that the UE is in a location where the network is not allowed to operate, the network shall set the 5GMM cause value in the REGISTRATION REJECT message to #78 \"PLMN not allowed to operate at the present UE location\".\nNOTE\u00a05:\tWhen the UE is accessing network for emergency services, it is up to operator and regulatory policies whether the network needs to determine if the UE is in a location where network is not allowed to operate.\nIf the AMF receives the initial registration request including the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE and the AMF determines that the UE is not allowed to use UAS services via 5GS based on the user's subscription data and the operator policy, the AMF shall return a REGISTRATION REJECT message with 5GMM cause #79 \u201cUAS services not allowed\u201d.\nIf the UE initiates the registration procedure for disaster roaming services and the AMF determines that it does not support providing disaster roaming services for the determined PLMN with disaster condition to the UE, then the AMF shall send a REGISTRATION REJECT message with 5GMM cause #80 \u201cDisaster roaming for the determined PLMN with disaster condition not allowed\u201d.\nIf the AMF receives the initial registration request over non-3GPP access and detects that the N3IWF used by the UE is not compatible with the allowed NSSAI and the UE has indicated its support for slice-based N3IWF selection in the REGISTRATION REQUEST message, the AMF may send a REGISTRATION REJECT message with 5GMM cause #81 \u201cSelected N3IWF is not compatible with the allowed NSSAI\u201d and may provide information for a suitable N3IWF in the REGISTRATION REJECT message indicating the suitable N3IWF that is compatible with the requested NSSAI.\nIf the AMF receives the initial registration request over non-3GPP access and detects that the TNGF used by the UE is not compatible with the allowed NSSAI and the UE has indicated its support for slice-based TNGF selection in the REGISTRATION REQUEST message, the AMF may send a REGISTRATION REJECT message with 5GMM cause #82 \u201cSelected TNGF is not compatible with the allowed NSSAI\u201d and may provide information for a suitable TNAN in the TNAN information IE in the REGISTRATION REJECT message indicating the suitable TNGF that is compatible with the requested NSSAI.\nIf the AMF received multiple TAIs from the satellite NG-RAN as described in 3GPP\u00a0TS\u00a023.501\u00a0[8], and determines that, by UE subscription and operator's preferences, all of the received TAIs are forbidden for roaming or for regional provision of service, the AMF shall include the TAI(s) in:\na)\tthe Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE; or\nb)\tthe Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE; or\nc)\tboth;\nin the REGISTRATION REJECT message.\nRegardless of the 5GMM cause value received in the REGISTRATION REJECT message via satellite NG-RAN,\n-\tif the UE receives the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE in the REGISTRATION REJECT message, the UE shall store the TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE, if not already stored, into the list of \"5GS forbidden tracking areas for roaming\"; and\n-\tif the UE receives the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE in the REGISTRATION REJECT message, the UE shall store the TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE, if not already stored, into the list of \"5GS forbidden tracking areas for regional provision of service\".\nFurthermore, the UE shall take the following actions depending on the 5GMM cause value received in the REGISTRATION REJECT message.\n#3\t(Illegal UE); or\n#6\t(Illegal ME).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n\tIn case of PLMN, the UE shall consider the USIM as invalid for 5GS services until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause\u00a05.3.19A.1;\n\tIn case of SNPN, if the UE is not performing initial registration for onboarding services in SNPN and the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the UE shall consider the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN as invalid until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause\u00a05.3.19A.2. In case of SNPN, if the UE is not performing initial registration for onboarding services in SNPN and the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid for 3GPP access until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause\u00a05.3.19A.2. Additionally, if EAP based primary authentication and key agreement procedure using EAP-AKA' or 5G AKA based primary authentication and key agreement procedure was performed in the current SNPN, the UE shall consider the USIM as invalid for the current SNPN until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause\u00a05.3.19A.2.\n\tIf the UE is not performing initial registration for onboarding services in SNPN, the UE shall delete the list of equivalent PLMNs (if any) or the list of equivalent SNPNs (if any), and enter the state 5GMM-DEREGISTERED.NO-SUPI. If the message has been successfully integrity checked by the NAS, then the UE shall:\n1)\tset the counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events in case of PLMN if the UE maintains these counters; or\n2)\tset the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events and the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events in case of SNPN if the UE maintains these counters;\n\tto a UE implementation-specific maximum value.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the EPS attach request procedure is rejected with the EMM cause with the same value. The USIM shall be considered as invalid also for non-EPS services until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause\u00a05.3.7a in 3GPP\u00a0TS\u00a024.301\u00a0[15]. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\", then the UE shall set this counter to a UE implementation-specific maximum value.\n\tIf the UE is performing initial registration for onboarding services in SNPN, the UE shall reset the registration attempt counter, store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS, the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value.\n\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#7\t(5GS services not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n\tIn case of PLMN, the UE shall consider the USIM as invalid for 5GS services until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause\u00a05.3.19A.1;\n\tIn case of SNPN, if the UE is not performing initial registration for onboarding services in SNPN and the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the UE shall consider the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN as invalid for 5GS services until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause\u00a05.3.19A.2. In case of SNPN, if the UE is not performing initial registration for onboarding services in SNPN and the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid for 3GPP access until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause\u00a05.3.19A.2. Additionally, if EAP based primary authentication and key agreement procedure using EAP-AKA' or 5G AKA based primary authentication and key agreement procedure was performed in the current SNPN, the UE shall consider the USIM as invalid for the current SNPN until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause\u00a05.3.19A.2.\n\tIf the UE is not performing initial registration for onboarding services in SNPN, the UE shall enter the state 5GMM-DEREGISTERED.NO-SUPI. If the message has been successfully integrity checked by the NAS, then the UE shall:\n1)\tset the counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events in case of PLMN if the UE maintains these counters; or\n2)\tset the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events and the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events in case of SNPN if the UE maintains these counters;\n\tto a UE implementation-specific maximum value.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the EPS attach request procedure is rejected with the EMM cause with the same value.\n\tIf the UE is performing initial registration for onboarding services in SNPN, the UE shall reset the registration attempt counter, store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS, the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value.\n\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#10\t(Implicitly de-registered).\n\t5GMM cause #10 is only applicable when received from a wireline access network by the 5G-RG acting on behalf of the AUN3 device and indicates that there is no 5G-RG connected to the same wireline. 5GMM cause #10 received when the 5G-RG is not acting on behalf of the AUN3 or received from a 5G access network other than a wireline access network is considered as abnormal cases and the behaviour of the UE is specified in subclause\u00a05.5.1.2.7.\n\tWhen received over wireline access network, the 5G-RG acting on behalf of the AUN3 device shall abort the initial registration procedure that was initiated on behalf of the AUN3 device. The 5G-RG shall set its 5GS update status to 5U2 NOT UPDATED (and shall store it according to subclause\u00a05.1.3.2.2), shall delete its 5G-GUTI, last visited registered TAI, TAI list, ngKSI, and shall reset its registration attempt counter, and shall enter the state 5GMM-DEREGISTERED.\n#11\t(PLMN not allowed).\n\tThis cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.2.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. The UE shall delete the list of equivalent PLMNs and reset the registration attempt counter and store the PLMN identity in the forbidden PLMN list as specified in subclause\u00a05.3.13A and if the UE is configured to use timer T3245 then the UE shall start timer T3245 and proceed as described in subclause 5.3.19A.1. For 3GPP access the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5], and for non-3GPP access the UE shall enter state 5GMM-DEREGISTERED.LIMITED-SERVICE and perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18]. If the message has been successfully integrity checked by the NAS and the UE maintains the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN, the UE shall set the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN to the UE implementation-specific maximum value.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the EPS attach request procedure is rejected with the EMM cause with the same value.\n\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access to the same PLMN, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#12\t(Tracking area not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI and ngKSI. Additionally, the UE shall reset the registration attempt counter.\n\tIf:\n1)\tthe UE is not operating in SNPN access operation mode and the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE is not included in the REGISTRATION REJECT message, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for regional provision of service\" and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. If the REGISTRATION REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for regional provision of service\" for non-integrity protected NAS reject message; or\n2)\tthe UE is operating in SNPN access operation mode, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for regional provision of service\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. If the REGISTRATION REJECT is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for regional provision of service\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, for non-integrity protected NAS reject message.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the EPS attach request procedure is rejected with the EMM cause with the same value.\n#13\t(Roaming not allowed in this tracking area).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI, ngKSI and the list of equivalent PLMNs (if available) or the list of equivalent SNPNs (if available). Additionally, the UE shall reset the registration attempt counter.\n\tIf:\n1)\tthe UE is not operating in SNPN access operation mode and the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE is not included in the REGISTRATION REJECT message, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE or optionally 5GMM-DEREGISTERED.PLMN-SEARCH. If the REGISTRATION REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for non-integrity protected NAS reject message; or\n2)\tthe UE is operating in SNPN access operation mode, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE or optionally 5GMM-DEREGISTERED.PLMN-SEARCH. If the REGISTRATION REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, for non-integrity protected NAS reject message.\n\tFor 3GPP access, if the UE is registered in S1 mode and operating in dual-registration mode, the PLMN that the UE chooses to register in is specified in subclause\u00a04.8.3. Otherwise the UE shall perform a PLMN selection or SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tFor non-3GPP access, the UE shall perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18].\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the EPS attach request procedure is rejected with the EMM cause with the same value.\n#15\t(No suitable cells in tracking area).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI and ngKSI. Additionally, the UE shall reset the registration attempt counter.\n\tIf:\n1)\tthe UE is not operating in SNPN access operation mode and the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE is not included in the REGISTRATION REJECT message, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. If the REGISTRATION REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for non-integrity protected NAS reject message; or\n2)\tthe UE is operating in SNPN access operation mode, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. If the REGISTRATION REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, for non-integrity protected NAS reject message.\n\tThe UE shall search for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C].\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the EPS attach request procedure is rejected with the EMM cause with the same value.\n\tIf received over non-3GPP access the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.1.2.7.\n#22\t(Congestion).\n\tIf the T3346 value IE is present in the REGISTRATION REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below; otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.1.2.7.\n\tThe UE shall abort the initial registration procedure, set the 5GS update status to 5U2 NOT UPDATED, reset the registration attempt counter and enter state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION.\n\tThe UE shall stop timer T3346 if it is running.\n\tIf the REGISTRATION REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the REGISTRATION REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n\tThe UE stays in the current serving cell and applies the normal cell reselection process. The initial registration procedure is started if still needed when timer T3346 expires or is stopped.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the EPS attach request procedure is rejected with the EMM cause with the same value.\n\tIf the UE is registering for onboarding services in SNPN, the UE may enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n#27\t(N1 mode not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter and shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. If the message has been successfully integrity checked by the NAS, the UE shall set:\n1)\tthe PLMN-specific N1 mode attempt counter for 3GPP access and the PLMN-specific N1 mode attempt counter for non-3GPP access for that PLMN in case of PLMN; or\n2)\tthe SNPN-specific attempt counter for 3GPP access for the current SNPN in case of SNPN and the SNPN-specific attempt counter for non-3GPP access for the current SNPN;\n\tto the UE implementation-specific maximum value.\n\tThe UE shall disable the N1 mode capability for the specific access type for which the message was received (see subclause\u00a04.9).\n\tIf the message has been successfully integrity checked by the NAS, the UE shall disable the N1 mode capability also for the other access type (see subclause\u00a04.9).\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED and shall delete any 4G-GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.\n#31\t(Redirection to EPC required).\n\t5GMM cause #31 received by a UE that has not indicated support for CIoT optimizations or not indicated support for S1 mode or received by a UE over non-3GPP access is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.2.7.\n\tThis cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.2.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter.\n\tThe UE shall enable the E-UTRA capability if it was disabled, disable the N1 mode capability for 3GPP access (see subclause\u00a04.9.2) and enter the 5GMM-DEREGISTERED.NO-CELL-AVAILABLE.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list, eKSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the EPS attach procedure is rejected with the EMM cause with the same value.\n#36\t(IAB-node operation not authorized).\n\tThis cause value is only applicable when received over 3GPP access by a UE operating as an IAB-node. This cause value received from a 5G access network other than 3GPP access or received by a UE not operating as an IAB-node is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.2.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n\tIf:\n1)\tthe UE is not operating in SNPN access operation mode, \ni)\tthe UE shall delete the list of equivalent PLMNs and reset the registration attempt counter and store the PLMN identity in the forbidden PLMN list as specified in subclause 5.3.13A and if the UE is configured to use timer T3245 then the UE shall start timer T3245 and proceed as described in subclause\u00a05.3.19a.1. The UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS and the UE maintains the PLMN-specific attempt counter for 3GPP access for that PLMN, the UE shall set the PLMN-specific attempt counter for 3GPP access for that PLMN to the UE implementation-specific maximum value; and\nii)\tIf the UE is operating in single-registration mode, the UE shall in addition handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the EPS attach request procedure is rejected with the EMM cause with the same value; or\n2)\tthe UE is operating in SNPN access operation mode, \ni)\tthe UE shall delete the list of equivalent SNPNs (if available). The UE shall reset the registration attempt counter and store the SNPN identity in the \"temporarily forbidden SNPNs\" list for 3GPP access and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. The UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS, the UE shall set the SNPN attempt counter for 3GPP access for the current SNPN to the UE implementation-specific maximum value.#62\t(No network slices available).\n\tThe UE shall abort the initial registration procedure, set the 5GS update status to 5U2 NOT UPDATED and enter state 5GMM-DEREGISTERED. ATTEMPTING-REGISTRATION or 5GMM-DEREGISTERED.PLMN-SEARCH. Additionally, the UE shall reset the registration attempt counter.\n\tThe UE receiving the rejected NSSAI in the REGISTRATION REJECT message takes the following actions based on the rejection cause in the rejected S-NSSAI(s):\n\t\"S-NSSAI not available in the current PLMN or SNPN\"\n\tThe UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN or SNPN as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current PLMN or SNPN over any access until switching off the UE, the UICC containing the USIM is removed, an entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\t\"S-NSSAI not available in the current registration area\"\n\tThe UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as described in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current registration area over the current access until switching off the UE, the UE moving out of the current registration area, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\t\"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\"\n\tThe UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over any access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.1 and 4.6.2.2.\n\t\"S-NSSAI not available due to maximum number of UEs reached\"\n\tUnless the back-off timer value received along with the S-NSSAI is zero, the UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over the current access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclauses\u00a04.6.1 and\u00a04.6.2.2.\nNOTE\u00a06:\tIf the back-off timer value received along with the S-NSSAI in the rejected NSSAI for the maximum number of UEs reached is zero as specified in subclause\u00a010.5.7.4a of 3GPP\u00a0TS\u00a024.008\u00a0[12], the UE does not consider the S-NSSAI as the rejected S-NSSAI.\n\tIf there is one or more S-NSSAIs in the rejected NSSAI with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\", then for each S-NSSAI, the UE shall behave as follows:\na)\tstop the timer T3526 associated with the S-NSSAI, if running;\nb)\tstart the timer T3526 with:\n1)\tthe back-off timer value received along with the S-NSSAI, if a back-off timer value is received along with the S-NSSAI that is neither zero nor deactivated; or\n2)\tan implementation specific back-off timer value, if no back-off timer value is received along with the S-NSSAI; and\nc)\tremove the S-NSSAI from the rejected NSSAI for the maximum number of UEs reached when the timer T3526 associated with the S-NSSAI expires.\n\tIf the UE has an allowed NSSAI or configured NSSAI and:\n1)\tat least one S-NSSAI of the allowed NSSAI or configured NSSAI is not included in the rejected NSSAI the UE may stay in the current serving cell, apply the normal cell reselection process and start an initial registration with a requested NSSAI that includes any S-NSSAI from the allowed NSSAI or the configured NSSAI that is not in the rejected NSSAI.\n2)\tall the S-NSSAI(s) in the allowed NSSAI and configured NSSAI are rejected and at least one S-NSSAI is rejected due to \"S-NSSAI not available in the current registration area\" and:\ni)\tthe REGISTRATION REJECT message is integrity protected, the UE is not operating in SNPN access operation mode and the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE is not included in the REGISTRATION REJECT message, then the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\", memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for S-NSSAI is rejected due to \"S-NSSAI not available in the current registration area\" and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. The UE shall search for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C]; or\nii)\tthe REGISTRATION REJECT message is integrity protected and the UE is operating in SNPN access operation mode, then the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\", memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for S-NSSAI is rejected due to \"S-NSSAI not available in the current registration area\" for the current SNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. The UE shall search for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C].\n3)\totherwise,the UE may perform a PLMN selection or SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5] and additionally, the UE may disable the N1 mode capability for the current PLMN or SNPN if the UE does not have an allowed NSSAI and each S-NSSAI in configured NSSAI, if available, was rejected with cause \"S-NSSAI not available in the current PLMN or SNPN\" or \"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\" as described in subclause\u00a04.9.\n\tIf the UE has neither allowed NSSAI for the current PLMN or SNPN nor configured NSSAI for the current PLMN or SNPN and,\n1)\tif at least one S-NSSAI in the default configured NSSAI is not rejected, the UE may stay in the current serving cell, apply the normal cell reselection process, and start an initial registration with a requested NSSAI with that default configured NSSAI; or\n2)\tif all the S-NSSAI(s) in the default configured NSSAI are rejected and at least one S-NSSAI is rejected due to \"S-NSSAI not available in the current registration area\",\ni)\tif the REGISTRATION REJECT message is integrity protected and the UE is not operating in SNPN access operation mode, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. The UE shall search for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C]; or\nii)\tif the REGISTRATION REJECT message is integrity protected and the UE is operating in SNPN access operation mode, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. The UE shall search for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C].\n3)\totherwise, the UE may perform a PLMN selection or SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5] and additionally, the UE may disable the N1 mode capability for the current PLMN or SNPN if each S-NSSAI in the default configured NSSAI was rejected with cause \"S-NSSAI not available in the current PLMN or SNPN\" or \"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\" as described in subclause\u00a04.9.\n\tIf\n1)\tthe UE has allowed NSSAI for the current PLMN or SNPN or configured NSSAI for the current PLMN or SNPN or both and all the S-NSSAIs included in the allowed NSSAI or the configured NSSAI or both are rejected; or\n2)\tthe UE has neither allowed NSSAI for the current PLMN or SNPN nor configured NSSAI for the current PLMN or SNPN and all the S-NSSAIs included in the default configured NSSAI are rejected,\n\tand the UE has rejected NSSAI for the maximum number of UEs reached, and the UE wants to obtain services in the current serving cell without performing a PLMN selection or SNPN selection, the UE may stay in the current serving cell and attempt to use the rejected S-NSSAI(s) for the maximum number of UEs reached in the current serving cell after the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU2 NOT UPDATED, reset the attach attempt counter and enter the state EMM-DEREGISTERED.\n#72\t(Non-3GPP access to 5GCN not allowed).\n\tWhen received over non-3GPP access the UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over 3GPP access, the UE shall additionally delete 5G-GUTI and ngKSI. Additionally, the UE shall reset the registration attempt counter and enter the state 5GMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS, the UE shall set:\n1)\tthe PLMN-specific N1 mode attempt counter for non-3GPP access for that PLMN in case of PLMN: or\n2)\tthe SNPN-specific attempt counter for non-3GPP access for that SNPN in case of SNPN;\n\tto the UE implementation-specific maximum value.\nNOTE\u00a07:\tThe 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses\u00a04.7.2 and 5.1.3).\n\tThe UE shall disable the N1 mode capability for non-3GPP access (see subclause\u00a04.9.3).\n\tAs an implementation option, the UE may enter the state 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf received over 3GPP access the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.1.2.7.\n#73\t(Serving network not authorized).\n\tThis cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.2.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. The UE shall delete the list of equivalent PLMNs, reset the registration attempt counter, store the PLMN identity in the forbidden PLMN list as specified in subclause\u00a05.3.13A. For 3GPP access the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5], and for non-3GPP access the UE shall enter state 5GMM-DEREGISTERED.LIMITED-SERVICE and perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18]. If the message has been successfully integrity checked by the NAS, the UE shall set the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN to the UE implementation-specific maximum value.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED and shall delete any 4G-GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.\n#74\t(Temporarily not authorized for this SNPN).\n\t5GMM cause #74 is only applicable when received from a cell belonging to an SNPN. 5GMM cause #74 received from a cell not belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.2.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list, ngKSI and the list of equivalent SNPNs (if available). The UE shall reset the registration attempt counter and store the SNPN identity in the \"temporarily forbidden SNPNs\" list or \"temporarily forbidden SNPNs for access for localized services in SNPN\" list if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) for the specific access type for which the message was received and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN using credentials from a credentials holder, the UE shall store the SNPN identity in the \"temporarily forbidden SNPNs\" list along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN providing access for localized services in SNPN and the access for localized services in SNPN has been enabled, the UE shall store the SNPN identity in the list of \"temporarily forbidden SNPNs for access for localized services in SNPN\" (if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the registration request is not for onboarding services in SNPN, for 3GPP access the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5] and for non-3GPP access the UE shall enter state 5GMM-DEREGISTERED.LIMITED-SERVICE and perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18]. If the registration request is for onboarding services in SNPN, the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS, the UE shall set the SNPN-specific attempt counter for 3GPP access and the SNPN-specific attempt counter for non-3GPP access for the current SNPN to the UE implementation-specific maximum value.\n\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access to the same SNPN, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#75\t(Permanently not authorized for this SNPN).\n\t5GMM cause #75 is only applicable when received from a cell belonging to an SNPN with a globally-unique SNPN identity. 5GMM cause #75 received from a cell not belonging to an SNPN or a cell belonging to an SNPN with a non-globally-unique SNPN identity is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.2.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list ngKSI and the list of equivalent SNPNs (if available). The UE shall reset the registration attempt counter and store the SNPN identity in the \"permanently forbidden SNPNs\" list or \"permanently forbidden SNPNs for access for localized services in SNPN\" list if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) for the specific access type for which the message was received and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN using credentials from a credentials holder, the UE shall store the SNPN identity in the \"permanently forbidden SNPNs\" list along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN providing access for localized services in SNPN and the access for localized services in SNPN has been enabled, the UE shall store the SNPN identity in the list of \"permanently forbidden SNPNs for access for localized services in SNPN\" (if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the registration request is not for onboarding services in SNPN, for 3GPP access the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5] and for non-3GPP access the UE shall enter state 5GMM-DEREGISTERED.LIMITED-SERVICE and perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18]. If the registration request is for onboarding services in SNPN, the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS, the UE shall set the SNPN-specific attempt counter for 3GPP access and the SNPN-specific attempt counter for non-3GPP access for the current SNPN to the UE implementation-specific maximum val\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access to the same SNPN, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#76\t(Not authorized for this CAG or authorized for CAG cells only).\n\tThis cause value received via non-3GPP access or from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.2.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED, store the 5GS update status according to subclause\u00a05.1.3.2.2, and reset the registration attempt counter.\n\tIf 5GMM cause #76 is received from:\n1)\ta CAG cell, and if the UE receives a \"CAG information list\" in the CAG information list IE or the Extended CAG information list IE included in the REGISTRATION REJECT message, the UE shall:\ni)\treplace the \"CAG information list\" stored in the UE with the received CAG information list IE or the Extended CAG information list IE when received in the HPLMN or EHPLMN;\nii)\treplace the serving VPLMN's entry of the \"CAG information list\" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; or\nNOTE\u00a08:\tWhen the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored.\niii)\tremove the serving VPLMN's entry of the \"CAG information list\" stored in the UE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry.\n\tOtherwise, then the UE shall delete the CAG-ID(s) of the cell from the \"allowed CAG list\" for the current PLMN, if the CAG-ID(s) are authorized based on the \"allowed CAG list\". In the case the \"allowed CAG list\" for the current PLMN only contains a range of CAG-IDs, how the UE deletes the CAG-ID(s) of the cell from the \"allowed CAG list\" for the current PLMN is up to UE implementation. In addition:\ni)\tif the entry in the \"CAG information list\" for the current PLMN does not include an \"indication that the UE is only allowed to access 5GS via CAG cells\" or if the entry in the \"CAG information list\" for the current PLMN includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and one or more CAG-ID(s) are authorized based on the updated \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\";\nii)\tif the entry in the \"CAG information list\" for the current PLMN includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and no CAG-ID is authorized based on the updated \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP TS 23.122 [5] with the updated \"CAG information list\"; or\niii)\tif the \"CAG information list\" does not include an entry for the current PLMN, then the UE shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\".\n2)\ta non-CAG cell, and if the UE receives a \"CAG information list\" in the CAG information list IE or the Extended CAG information list IE included in the REGISTRATION REJECT message, the UE shall:\ni)\treplace the \"CAG information list\" stored in the UE with the received CAG information list IE or the Extended CAG information list IE when received in the HPLMN or EHPLMN;\nii)\treplace the serving VPLMN's entry of the \"CAG information list\" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; or\nNOTE\u00a09:\tWhen the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored.\niii)\tremove the serving VPLMN's entry of the \"CAG information list\" stored in the UE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry.\n\tOtherwise, the UE shall store an \"indication that the UE is only allowed to access 5GS via CAG cells\" in the entry of the \"CAG information list\" for the current PLMN, if any. If the \"CAG information list\" stored in the UE does not include the current PLMN's entry, the UE shall add an entry for the current PLMN to the \"CAG information list\" and store an \"indication that the UE is only allowed to access 5GS via CAG cells\" in the entry of the \"CAG information list\" for the current PLMN. If the UE does not have a stored \"CAG information list\", the UE shall create a new \"CAG information list\" and add an entry with an \"indication that the UE is only allowed to access 5GS via CAG cells\" for the current PLMN.\nIn addition:\ni)\tif one or more CAG-ID(s) are authorized based on the \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] with the updated CAG information; or\nii)\tif no CAG-ID is authorized based on the \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP TS 23.122 [5] with the updated \"CAG information list\".\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED, reset the attach attempt counter and enter the state EMM-DEREGISTERED.\n#77\t(Wireline access area not allowed).\n\t5GMM cause #77 is only applicable when received from a wireline access network by the 5G-RG or the W-AGF acting on behalf of the FN-CRG. 5GMM cause #77 received from a 5G access network other than a wireline access network and 5GMM cause #77 received by the W-AGF acting on behalf of the FN-BRG are considered as abnormal cases and the behaviour of the UE is specified in subclause\u00a05.5.1.2.7.\n\tWhen received over wireline access network, the 5G-RG and the W-AGF acting on behalf of the FN-CRG shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2), shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI, shall reset the registration attempt counter, shall enter the state 5GMM-DEREGISTERED and shall act as specified in subclause\u00a05.3.23.\nNOTE\u00a010:\tThe 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses\u00a04.7.2 and 5.1.3).\n#78\t(PLMN not allowed to operate at the present UE location).\n\tThis cause value received from a non-satellite NG-RAN cell is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.2.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over non-3GPP access, the UE shall additionally delete 5G-GUTI and ngKSI. Additionally, the UE shall reset the registration attempt counter. The UE shall store the PLMN identity and, if it is known, the current geographical location in the list of \"PLMNs not allowed to operate at the present UE location\" and shall start a corresponding timer instance (see subclause\u00a04.23.2). The UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list, eKSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the EPS attach procedure is rejected with the EMM cause with the same value.\n#79\t(UAS services not allowed).\n\tThe UE shall abort the initial registration procedure, set the 5GS update status to 5U2 NOT UPDATED and enter state 5GMM-DEREGISTERED. ATTEMPTING-REGISTRATION or 5GMM-DEREGISTERED.PLMN-SEARCH. Additionally, the UE shall reset the registration attempt counter. If the UE re-attempt the registration procedure to the current PLMN, the UE shall not include the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of REGISTRATION REQUEST message unless the UE receives a CONFIGURATION UPDATE COMMAND message including the service-level-AA service status indication in the Service-level-AA container IE with the UAS field set to \"UAS services enabled\".\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU2 NOT UPDATED, reset the attach attempt counter and enter the state EMM-DEREGISTERED.\n#80\t(Disaster roaming for the determined PLMN with disaster condition not allowed).\n\tThis cause value received via non-3GPP access or from a cell belonging to an SNPN or when the UE did not indicate \"disaster roaming initial registration\" in the 5GS registration type IE in the REGISTRATION REQUEST message is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.2.7.\n\tThe UE shall abort the initial registration procedure, set the 5GS update status to 5U2 NOT UPDATED, enter state 5GMM-DEREGISTERED. PLMN-SEARCH and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter. The UE shall not attempt to register for disaster roaming services on this PLMN for the determined PLMN with disaster condition for a period in the range of 12 to 24 hours. The UE shall not attempt to register for disaster roaming services on this PLMN for a period in the range of 3 to 10 minutes. The UE shall perform PLMN selection as described in 3GPP\u00a0TS\u00a023.122\u00a0[6]. If the message has been successfully integrity checked by the NAS and the UE maintains the PLMN-specific attempt counter of the PLMN which sent the reject message for the determined PLMN with disaster condition, the UE shall set the PLMN-specific attempt counter of the PLMN which sent the reject message for the determined PLMN with disaster condition to the UE implementation-specific maximum value.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU2 NOT UPDATED, reset the attach attempt counter and enter the state EMM-DEREGISTERED.\n#81\t(Selected N3IWF is not compatible with the allowed NSSAI).\n\tThe UE shall abort the initial registration procedure, set the 5GS update status to 5U2 NOT UPDATED and enter state 5GMM-DEREGISTERED. ATTEMPTING-REGISTRATION or 5GMM-DEREGISTERED.PLMN-SEARCH. Additionally, the UE shall reset the registration attempt counter. If the N3IWF identifier IE is included in the REGISTRATION REJECT message and the UE supports slice-based N3IWF selection, the UE may use the provided N3IWF identifier IE in N3IWF selection as specified in 3GPP\u00a0TS\u00a024.502\u00a0[18] prior to an immediate consecutive initial registration attempt to the network, otherwise the UE shall ignore the N3IWF identifier IE. Additionally, if the UE selects a new N3IWF and a new initial registration attempt is performed, the UE shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n#82\t(Selected TNGF is not compatible with the allowed NSSAI).\n\tThe UE shall abort the initial registration procedure, set the 5GS update status to 5U2 NOT UPDATED and enter state 5GMM-DEREGISTERED. ATTEMPTING-REGISTRATION or 5GMM-DEREGISTERED.PLMN-SEARCH. Additionally, the UE shall reset the registration attempt counter. If the TNAN information IE is included in the REGISTRATION REJECT message and the UE supports slice-based TNGF selection, the UE may use the provided TNAN information IE in TNAN selection as specified in 3GPP\u00a0TS\u00a024.502\u00a0[18] prior to an immediate consecutive registration attempt to the network, otherwise the UE shall ignore the TNAN information IE. Additionally, if the UE selects a new TNAN and a new initial registration attempt is performed, the UE shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\nOther values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause\u00a05.5.1.2.7.\n5.5.1.2.6\tInitial registration for emergency services not accepted by the network\nUpon receiving the REGISTRATION REJECT message including 5GMM cause #5 \"PEI not accepted\", the UE shall enter the state 5GMM-DEREGISTERED.NO-SUPI. If the REGISTRATION REJECT message is received,\n-\tover 3GPP access; or\n-\tover non-3GPP access and is integrity protected;\nand the UE also supports the registration procedure over the other access, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\nUpon receiving the REGISTRATION REJECT message including 5GMM cause value which is not #5 \"PEI not accepted\", the UE shall perform the actions as described in subclause\u00a05.5.1.2.5 with the following addition: the UE shall inform the upper layers of the failure of the procedure.\nNOTE\u00a01:\tThis can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[14] can result in the emergency call being attempted to another IP-CAN.\nIf the initial registration request for emergency services fails due to abnormal cases, the UE shall perform the actions as described in subclause\u00a05.5.1.2.7 and inform the upper layers of the failure to access the network or the failure of the procedure.\nNOTE\u00a02:\tThis can result in the upper layers requesting other implementation specific mechanisms, e.g. procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[14] can result in the emergency call being attempted to another IP-CAN.\nIn a shared network, upon receiving the REGISTRATION REJECT message, the UE shall perform the actions as described in subclause\u00a05.5.1.2.5, and shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE\u00a03:\tThe upper layers can request implementation specific mechanisms, e.g. procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[14] that can result in the emergency call being attempted to another IP-CAN.\nb)\tattempt to perform a PLMN or SNPN selection in the shared network and, if an initial registration for emergency services was not already attempted with the selected PLMN or SNPN and the REGISTRATION REQUEST message, for which the REGISTRATION REJECT message was received, is:\n-\tnot for sending a PDU SESSION ESTABLISHMENT REQUEST message with request type set to \"existing emergency PDU session\", initiate an initial registration for emergency services with the selected PLMN or SNPN; or\n-\tfor sending a PDU SESSION ESTABLISHMENT REQUEST message with request type set to \"existing emergency PDU session\", and:\ni)\tthe selected PLMN is an equivalent PLMN or the selected SNPN is an equivalent SNPN, initiate an initial registration for emergency services with the selected PLMN or SNPN; and\nii)\tthe selected PLMN is not an equivalent PLMN or the selected SNPN is not an equivalent SNPN, perform a PLMN or SNPN selection and initiate an initial registration for emergency services with the selected PLMN or SNPN if an initial registration for emergency services was not already attempted with the selected PLMN or SNPN.\nIn a shared network, if the initial registration request for emergency services fails due to abnormal cases, the UE shall perform the actions as described in subclause\u00a05.5.1.2.7 and shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE\u00a04:\tThe upper layers can request implementation specific mechanisms, e.g. procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[14] that can result in the emergency call being attempted to another IP-CAN.\nb)\tattempt to perform a PLMN or SNPN selection in the shared network and, if an initial registration for emergency services was not already attempted with the selected PLMN or SNPN and the REGISTRATION REQUEST message is:\n-\tnot for sending a PDU SESSION ESTABLISHMENT REQUEST message with request type set to \"existing emergency PDU session\", initiate an initial registration for emergency services with the selected PLMN or SNPN; or\n-\tfor sending a PDU SESSION ESTABLISHMENT REQUEST message with request type set to \"existing emergency PDU session\", and:\ni)\tthe selected PLMN is an equivalent PLMN or the selected SNPN is an equivalent SNPN, initiate an initial registration for emergency services with the selected PLMN or SNPN; and\nii)\tthe selected PLMN is not an equivalent PLMN or the selected SNPN is not an equivalent SNPN, perform a PLMN or SNPN selection and initiate an initial registration for emergency services with the selected PLMN or SNPN if an initial registration for emergency services was not already attempted with the selected PLMN or SNPN.\n5.5.1.2.6A\tInitial registration for initiating an emergency PDU session not accepted by the network\nIf the network cannot accept an initial registration request with 5GS registration type IE set to \"initial registration\" and for sending a PDU SESSION ESTABLISHMENT REQUEST message with request type set to \"initial emergency request\", the UE shall perform the procedures as described in subclause\u00a05.5.1.2.5. Then if the UE is in the same selected PLMN or SNPN where the last initial registration request was attempted, the UE shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE\u00a01:\tThis can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[14] can result in the emergency call being attempted to another IP-CAN.\nb)\tattempt initial registration for emergency services.\nIf the network cannot accept an initial registration request with 5GS registration type IE set to \"initial registration\", for establishing an emergency PDU session and the PDU session needs to be established due to handover of an existing PDN connection for emergency bearer services, the UE shall perform the procedures as described in subclause\u00a05.5.1.2.5. Then if the UE is in the same selected PLMN or equivalent PLMN or the same selected SNPN or equivalent SNPN, where the last initial registration request was attempted, the UE shall attempt initial registration for emergency services.\nIf the initial registration request, with 5GS registration type IE set to \"initial registration\" and for initiating an emergency PDU session, fails due to abnormal case b) in subclause\u00a05.5.1.2.7, the UE shall perform the actions as described in subclause\u00a05.5.1.2.7 and inform the upper layers of the failure to access the network.\nNOTE\u00a02:\tThis can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[14] can result in the emergency call being attempted to another IP-CAN.\nIf the initial registration request, with 5GS registration type IE set to \"initial registration\" and for initiating an emergency PDU session, fails due to abnormal cases c), d) or e) in subclause\u00a05.5.1.2.7, the UE shall perform the actions as described in subclause\u00a05.5.1.2.7. Then if the UE is in:\na)\tthe same selected PLMN or SNPN where the last initial registration request was attempted and the PDU session does not need to be established due to handover of an existing PDN connection for emergency bearer services, the UE shall:\n-\tinform the upper layers of the failure of the procedure; or\nNOTE\u00a03:\tThis can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[14] can result in the emergency call being attempted to another IP-CAN.\n-\tattempt initial registration for emergency services; or\nb)\tthe same selected PLMN or equivalent PLMN or the same selected SNPN or equivalent SNPN, where the last initial registration request was attempted and the PDU session needs to be established due to handover of an existing PDN connection for emergency bearer services, attempt initial registration for emergency services.\n5.5.1.2.7\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tTimer T3346 is running.\n\tThe UE shall not start the registration procedure for initial registration unless:\n1)\tthe UE is a UE configured for high priority access in selected PLMN or SNPN;\n2)\tthe UE needs to perform the registration procedure for initial registration for emergency services;\n3)\tthe UE receives a DEREGISTRATION REQUEST message with the \"re-registration required\" indication;\n4)\tthe UE in NB-N1 mode is requested by the upper layer to transmit user data related to an exceptional event and:\n-\tthe UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP\u00a0TS\u00a024.368\u00a0[17] or the USIM file EFNASCONFIG in 3GPP\u00a0TS\u00a031.102\u00a0[22]); and\n-\ttimer T3346 was not started when N1 NAS signalling connection was established with RRC establishment cause set to \"mo-ExceptionData\"; or\n5)\tthe UE needs to perform the registration procedure with 5GS registration type IE set to \"initial registration\" for initiating of an emergency PDU session, upon request of the upper layers to establish the emergency PDU session.\n\tThe UE stays in the current serving cell and applies the normal cell reselection process.\nNOTE\u00a01:\tIt is considered an abnormal case if the UE needs to initiate a registration procedure for initial registration while timer T3346 is running independent on whether timer T3346 was started due to an abnormal case or a non-successful case.\nb)\tThe lower layers indicate that the access attempt is barred.\n\tThe UE shall not start the initial registration procedure. The UE stays in the current serving cell and applies the normal cell reselection process. Receipt of the access barred indication shall not trigger the selection of a different core network type (EPC or 5GCN).\n\tThe initial registration procedure is started, if still needed, when the lower layers indicate that the barring is alleviated for the access category with which the access attempt was associated.\nba)\tThe lower layers indicate that:\n1)\taccess barring is applicable for all access categories except categories 0 and 2 and the access category with which the access attempt was associated is other than 0 and 2; or\n2)\taccess barring is applicable for all access categories except category 0 and the access category with which the access attempt was associated is other than 0.\n\tIf the REGISTRATION REQUEST message has not been sent, the UE shall proceed as specified for case b. If the REGISTRATION REQUEST message has been sent, the UE shall proceed as specified for case e and, additionally, the registration procedure for initial registration is started, if still needed, when the lower layers indicate that the barring is alleviated for the access category with which the access attempt was associated.\nc)\tT3510 timeout.\n\tThe UE shall abort the registration procedure for initial registration and the NAS signalling connection, if any, shall be released locally if the initial registration request is neither for emergency services nor for initiating a PDU session for emergency services with request type set to \"existing emergency PDU session\". The UE shall proceed as described below.\nd)\tREGISTRATION REJECT message, other 5GMM cause values than those treated in subclause\u00a05.5.1.2.5, and cases of 5GMM cause values #10, #11, #15, #22, #31, #72, #73, #74, #75, #76, #77, #78 and #80, if considered as abnormal cases according to subclause\u00a05.5.1.2.5.\n\tIf the registration request is neither an initial registration request for emergency services nor an initial registration request for initiating a PDU session for emergency services with request type set to \"existing emergency PDU session\", upon reception of the 5GMM causes #95, #96, #97, #99 and #111 the UE should set the registration attempt counter to 5.\n\tThe UE shall proceed as described below.\ne)\tLower layer failure or release of the NAS signalling connection received from lower layers before the REGISTRATION ACCEPT or REGISTRATION REJECT message is received.\n\tThe UE shall abort the registration procedure for initial registration and proceed as described below.\nf)\tUE initiated de-registration required.\n\tThe registration procedure for initial registration shall be aborted, and the UE initiated de-registration procedure shall be performed.\ng)\tDe-registration procedure collision.\n\tIf the UE receives a DEREGISTRATION REQUEST message from the network in state 5GMM-REGISTERED-INITIATED the de-registration procedure shall be aborted and the initial registration procedure shall be progressed.\nNOTE\u00a02:\tThe above collision case is valid if the DEREGISTRATION REQUEST message indicates the access type over which the initial registration procedure is attempted otherwise both the procedures are progressed.\nh)\tChange in the current TAI.\n\tIf the current TAI is changed before the registration procedure for initial registration is completed, the registration procedure for initial registration shall be aborted and re-initiated immediately.\n\tIf the REGISTRATION COMPLETE message needs to be sent and a tracking area border is crossed when the REGISTRATION ACCEPT message has been received but before a REGISTRATION COMPLETE message is sent and:\n1)\tif the current TAI is in the TAI list, the UE sends the REGISTRATION COMPLETE message to the network; and\n2)\totherwise, the registration procedure for initial registration shall be aborted and the registration procedure for mobility registration update shall be initiated.\n\tIf a 5G-GUTI was allocated during the registration procedure, this 5G-GUTI shall be used in the registration procedure.\ni)\tTransmission failure of REGISTRATION COMPLETE message indication with change in the current TAI.\n1)\tIf the current TAI is still part of the TAI list, the UE resends the REGISTRATION COMPLETE message to the network; and\n2)\totherwise, the registration procedure for initial registration shall be aborted and the registration procedure for mobility registration update shall be initiated.\nj)\tTransmission failure of REGISTRATION COMPLETE message indication without change in the current TAI from lower layers.\n\tIt is up to the UE implementation how to re-run the ongoing procedure.\nk)\tTransmission failure of REGISTRATION REQUEST message indication from the lower layers.\n\tThe registration procedure for initial registration shall be aborted and re-initiated immediately.\nl)\tTimer T3447 is running.\n\tThe UE shall not start the registration procedure for initial registration with Follow-on request indicator set to \"Follow-on request pending\" unless:\n1)\tthe UE is a UE configured for high priority access in selected PLMN; or\n2)\tthe UE needs to perform the registration procedure for initial registration for emergency services.\n\tThe UE stays in the current serving cell and applies the normal cell reselection process. The registration procedure for initial registration is started, if still necessary, when timer T3447 expires or timer T3447 is stopped.\nm)\tUE is not registered to the access other than the access the REGISTRATION ACCEPT message is received and the 5GS registration result value in the 5GS registration result IE value in the REGISTRATION ACCEPT message is set to \"3GPP access and non-3GPP access\".\n\tThe UE shall consider itself as being registered to only the access where the REGISTRATION ACCEPT message is received.\nn)\tAccess for localized services in current SNPN is no longer allowed.\n\tIf the initial registration request is neither for emergency services nor for initiating a PDU session for emergency services with request type set to \"existing emergency PDU session\", the selected SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) and:\n1)\taccess for localized services in SNPN is disabled; or\n2)\tthe validity information for the selected SNPN is no longer met;\n\tthe UE shall reset the registration attempt counter, stop T3510, abort the registration procedure for initial registration, locally release the NAS signalling connection, if any, and enter state 5GMM-DEREGISTERED.LIMITED-SERVICE or 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\nFor the cases c, d and e, the UE shall proceed as follows:\n\tTimer T3510 shall be stopped if still running.\n\tIf the registration procedure is neither an initial registration for emergency services nor for establishing an emergency PDU session with registration type not set to \"emergency registration\", the registration attempt counter shall be incremented, unless it was already set to 5.\n\tIf the registration attempt counter is less than 5:\n-\tif the initial registration request is not for emergency services, timer T3511 is started and the state is changed to 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION. When timer T3511 expires the registration procedure for initial registration shall be restarted, if still required.\n\tIf the registration attempt counter is equal to 5\n-\tthe UE shall delete TAI list and last visited registered TAI, start timer T3502 if the value of the timer as indicated by the network is not zero and shall set the 5GS update status to 5U2 NOT UPDATED. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI, ngKSI and list of equivalent PLMNs (if any) or list of equivalent SNPNs (if any). The state is changed to 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION or optionally to 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection, SNPN selection or SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n-\tif the value of T3502 as indicated by the network is zero, the UE shall perform the actions defined for the expiry of the timer T3502.\n-\tif the procedure is performed via 3GPP access and the UE is operating in single-registration mode:\n-\tthe UE shall in addition handle the EMM parameters EPS update status, EMM state, 4G-GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the abnormal cases when an EPS attach procedure fails and the attach attempt counter is equal to 5; and\n-\tthe UE shall attempt to select E-UTRAN radio access technology and proceed with appropriate EMM specific procedures. Additionally, The UE may disable the N1 mode capability as specified in subclause\u00a04.9.\n5.5.1.2.8\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tLower layer failure\n\tIf a lower layer failure occurs before the REGISTRATION COMPLETE message has been received from the UE and timer T3550 is running, the AMF shall locally abort the registration procedure for initial registration, enter state 5GMM-REGISTERED and shall not resend the REGISTRATION ACCEPT message. If a new 5G-GUTI was assigned to the UE in the registration procedure for initial registration, the AMF shall consider both the old and the new 5G-GUTI as valid until the old 5G-GUTI can be considered as invalid by the AMF or the 5GMM context which has been marked as deregistered in the AMF is released. If the old 5G-GUTI was allocated by an AMF other than the current AMF, the current AMF does not need to retain the old 5G-GUTI. During this period the network may use the identification procedure followed by a generic UE configuration update procedure if the old 5G-GUTI is used by the UE in a subsequent message.\nb)\tProtocol error\n\tIf the REGISTRATION REQUEST message is received with a protocol error, the AMF shall return a REGISTRATION REJECT message with one of the following 5GMM cause values:\n#96\tinvalid mandatory information;\n#99\tinformation element non-existent or not implemented;\n#100\tconditional IE error; or\n#111\tprotocol error, unspecified.\nc)\tT3550 time-out\n\tOn the first expiry of the timer, the AMF shall retransmit the REGISTRATION ACCEPT message and shall reset and restart timer T3550.\n\tThis retransmission is repeated four times, i.e. on the fifth expiry of timer T3550, the registration procedure for initial registration shall be aborted and the AMF enters state 5GMM-REGISTERED. If a new 5G-GUTI was allocated in the REGISTRATION ACCEPT message, the AMF shall consider both the old and the new 5G-GUTIs as valid until the old 5G-GUTI can be considered as invalid by the AMF or the 5GMM context which has been marked as de-registered in the AMF is released. If the old 5G-GUTI was allocated by an AMF other than the current AMF, the current AMF does not need to retain the old 5G-GUTI. During this period, if the old 5G-GUTI is used by the UE in a subsequent message, the AMF acts as specified for case\u00a0a) above.\nd)\tREGISTRATION REQUEST message received after the REGISTRATION ACCEPT message has been sent and before the REGISTRATION COMPLETE message is received, if the REGISTRATION COMPLETE message is expected.\n1)\tIf one or more of the information elements in the REGISTRATION REQUEST message differ from the ones received within the previous REGISTRATION REQUEST message, the previously initiated the registration procedure for initial registration shall be aborted if the REGISTRATION COMPLETE message has not been received and the new registration procedure for initial registration shall be progressed; or\n2)\tif the information elements do not differ, then the REGISTRATION ACCEPT message shall be resent and the timer T3550 shall be restarted. In that case, the retransmission counter related to T3550 is not incremented.\ne)\tMore than one REGISTRATION REQUEST message with 5GS registration type IE set to \"initial registration\" received and no REGISTRATION ACCEPT message or REGISTRATION REJECT message has been sent.\n1)\tIf one or more of the information elements in the REGISTRATION REQUEST message with 5GS registration type IE set to \"initial registration\" differs from the ones received within the previous REGISTRATION REQUEST message with 5GS registration type IE set to \"initial registration\", the previously initiated the registration procedure for initial registration shall be aborted and the new the registration procedure for initial registration shall be executed;\n2)\tif the information elements do not differ, then the network shall continue with the previous the registration procedure for initial registration and shall ignore the second REGISTRATION REQUEST message.\nf)\tREGISTRATION REQUEST message with 5GS registration type IE set to \"initial registration\" received in state 5GMM-REGISTERED.\n\tIf a REGISTRATION REQUEST message with 5GS registration type IE set to \"initial registration\" is received in state 5GMM-REGISTERED the network may initiate the 5GMM common procedures; if it turned out that the REGISTRATION REQUEST message was sent by a genuine UE that has already been registered, the 5GMM context, if any, are deleted and the new REGISTRATION REQUEST is progressed, otherwise if network considers REGISTRATION REQUEST message was not sent by a genuine UE based on authentication procedure the network shall maintain the 5GMM-context, if any, unchanged.\nNOTE\u00a01:\tThe network can determine that the UE is genuine by executing the authentication procedure as described in subclause\u00a05.4.1.\ng)\tREGISTRATION REQUEST message with 5GS registration type IE set to \"mobility registration updating\" or \"periodic registration updating\" received before REGISTRATION COMPLETE message, if the REGISTRATION COMPLETE message is expected.\n\tTimer T3550 shall be stopped. The allocated 5G-GUTI in the registration procedure for initial registration shall be considered as valid and the registration procedure for mobility and periodic registration update shall be progressed as described in subclause\u00a05.5.1.3.\nh)\tDEREGISTRATION REQUEST message received before REGISTRATION COMPLETE message, if the REGISTRATION COMPLETE message is expected.\n\tThe AMF shall abort the registration procedure for initial registration and shall progress the de-registration procedure as described in subclause\u00a05.5.2.2.\ni)\tUE security capabilities invalid or unacceptable\n\tIf the REGISTRATION REQUEST message is received with invalid or unacceptable UE security capabilities (e.g. no 5GS encryption algorithms (all bits zero), no 5GS integrity algorithms (all bits zero), mandatory 5GS encryption algorithms not supported or mandatory 5GS integrity algorithms not supported, etc.), the AMF shall return a REGISTRATION REJECT message.\nNOTE\u00a02:\t5GMM cause value to be used in REGISTRATION REJECT message is up to the network implementation.\nj)\tBased on operator policy, if the initial registration request from a UE not supporting CAG is rejected due to CAG restrictions, the network shall reject the initial registration with a 5GMM cause value other than the 5GMM cause #76 (Not authorized for this CAG or authorized for CAG cells only).\nNOTE\u00a03:\t5GMM cause #7 (5GS services not allowed), 5GMM cause #11 (PLMN not allowed), 5GMM cause #27 (N1 mode not allowed), 5GMM cause #73 (Serving network not authorized) can be used depending on the subscription of the UE and whether the UE roams or not.\n5.5.1.3\tRegistration procedure for mobility and periodic registration update\n5.5.1.3.1\tGeneral\nThis procedure is used by a UE for both mobility and periodic registration update of 5GS services. This procedure, when used for periodic registration update of 5GS services, is performed only in 3GPP access.\nThis procedure used for periodic registration update of 5GS services is controlled in the UE by timer T3512. When timer T3512 expires, the registration procedure for mobility and periodic registration update is started. Start and reset of timer T3512 is described in subclause\u00a010.2.\nIf the MUSIM UE is registered for emergency services and initiates a registration procedure for mobility and periodic registration update, the network shall not indicate the support of:\n-\tthe NAS signalling connection release;\n-\tthe paging indication for voice services;\n-\tthe reject paging request; or\n-\tthe paging restriction;\nin the REGISTRATION ACCEPT message.\n5.5.1.3.2\tMobility and periodic registration update initiation\nThe UE in state 5GMM-REGISTERED shall initiate the registration procedure for mobility and periodic registration update by sending a REGISTRATION REQUEST message to the AMF,\na)\twhen the UE detects that the current TAI is not in the list of tracking areas that the UE previously registered in the AMF;\nb)\twhen the periodic registration updating timer T3512 expires in 5GMM-IDLE mode and the UE is not registered for emergency services (see subclause\u00a05.3.7);\nc)\twhen the UE receives a CONFIGURATION UPDATE COMMAND message indicating \"registration requested\" in the Registration requested bit of the Configuration update indication IE as specified in subclauses\u00a05.4.4.3;\nd)\twhen the UE in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE either receives a paging or the UE receives a NOTIFICATION message with access type indicating 3GPP access over the non-3GPP access for PDU sessions associated with 3GPP access;\nNOTE\u00a01:\tAs an implementation option, MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.\ne)\tupon inter-system change from S1 mode to N1 mode and if the UE previously had initiated an attach procedure or a tracking area updating procedure when in S1 mode;\nf)\twhen the UE receives an indication of \"RRC Connection failure\" from the lower layers and does not have signalling pending (i.e. when the lower layer requests NAS signalling connection recovery) except for the case specified in subclause\u00a05.3.1.4;\ng)\twhen the UE changes the 5GMM capability or the S1 UE network capability or both;\nh)\twhen the UE's usage setting changes;\ni)\twhen the UE needs to change the slice(s) it is currently registered to;\nNOTE\u00a01A:\tThe UE can after the completion of the ongoing registration procedure, initiate another registration procedure for mobility registration update to request more slices.\nj)\twhen the UE changes the UE specific DRX parameters;\nk)\twhen the UE in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE receives a request from the upper layers to establish an emergency PDU session or perform emergency services fallback;\nl)\twhen the UE needs to register for SMS over NAS, indicate a change in the requirements to use SMS over NAS, or de-register from SMS over NAS;\nm)\twhen the UE needs to indicate PDU session status to the network after performing a local release of PDU session(s) as specified in subclauses\u00a06.4.1.5 and 6.4.3.5;\nn)\twhen the UE in 5GMM-IDLE mode changes the radio capability for NG-RAN or E-UTRAN;\no)\twhen the UE receives a fallback indication from the lower layers and does not have signalling pending, see subclauses\u00a05.3.1.4 and\u00a05.3.1.2);\np)\tvoid;\nq)\twhen the UE needs to request new LADN information;\nr)\twhen the UE needs to request the use of MICO mode or needs to stop the use of MICO mode or to request the use of new T3324 value or new T3512 value;\ns)\twhen the UE in 5GMM-CONNECTED mode with RRC inactive indication enters a cell in the current registration area belonging to an equivalent PLMN of the registered PLMN and not belonging to the registered PLMN;\nt)\twhen the UE receives over 3GPP access a SERVICE REJECT message or a DL NAS TRANSPORT message, with the 5GMM cause value set to #28 \"Restricted service area\";\nu)\twhen the UE needs to request the use of eDRX, when a change in the eDRX usage conditions at the UE requires different extended DRX parameters, or needs to stop the use of eDRX;\nNOTE\u00a02:\tA change in the eDRX usage conditions at the UE can include e.g. a change in the UE configuration, a change in requirements from upper layers or the battery running low at the UE.\nv)\twhen the UE supporting 5G-SRVCC from NG-RAN to UTRAN changes the mobile station classmark 2 or the supported codecs;\nw)\twhen the UE in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE decides to request new network slices after being rejected due to no allowed network slices requested, or request S-NSSAI(s) which have been removed from the rejected NSSAI for the maximum number of UEs reached;\nx)\twhen the UE is not in NB-N1 mode and the UE has received a UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\u201d;\ny)\twhen the UE receives a REGISTRATION REJECT message with 5GMM cause values #3, #6 or #7 without integrity protection over another access;\nz)\twhen the UE needs to request new ciphering keys for ciphered broadcast assistance data;\nza)\twhen due to manual CAG selection the UE has selected a CAG-ID which is not a CAG-ID authorized based on the \"allowed CAG list\" for the selected PLMN or a CAG-ID in a PLMN for which the entry in the \"CAG information list\" does not exist or when the UE has selected, without selecting a CAG-ID, a PLMN for which the entry in the \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\";\nzb)\twhen the UE needs to start, stop or change the conditions for using the WUS assistance information or PEIPS assistance information;\nzc)\twhen the UE changes the UE specific DRX parameters in NB-N1 mode;\nzd)\twhen the UE in 5GMM-CONNECTED mode with RRC inactive indication enters a new cell with different RAT in current TAI list or not in current TAI list;\nze)\twhen the UE enters state 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE (as described in subclause\u00a05.3.5.2) over 3GPP access after the UE has sent a NOTIFICATION RESPONSE message over non-3GPP access in response to reception of a NOTIFICATION message over non-3GPP access as specified in subclause\u00a05.6.3.1;\nzf) when the UE supporting UAS services is not registered for UAS services and needs to register to the 5GS for UAS services;\nzg)\twhen the UE supporting MINT needs to perform the registration procedure for mobility and periodic registration update to register to the PLMN offering disaster roaming;\nzh)\twhen the MUSIM UE supporting the paging timing collision control needs to request a new 5G-GUTI assignment and the UE is not registered for emergency services;\nNOTE\u00a03:\tBased on implementation, the MUSIM UE can request a new 5G-GUTI assignment (e.g. when the lower layers request to modify the timing of the paging occasions).\nzi)\twhen the network supports the paging restriction and the MUSIM UE in state 5GMM-REGISTERED.NON-ALLOWED-SERVICE needs to requests the network to remove the paging restriction; \nzj)\twhen the UE changes the 5GS Preferred CIoT network behaviour or the EPS Preferred CIoT network behaviour;\nzk)\twhen the UE that has entered 5GMM-REGISTERED.NO-CELL-AVAILABLE and it has one or more S-NSSAI(s) in pending NSSAI, finds a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28];\nzl)\twhen the UE is registered for disaster roaming services and receives a request from the upper layers to establish an emergency PDU session or perform emergency services fallback;\nzm1)\twhen the UE needs to provide the unavailability information or to update the unavailability information;\nzm2)\tvoid;\nNOTE\u00a03A: How UE determines that it is about to lose satellite coverage is an implementation option.\nzn)\twhen the UE needs to come out of unavailability period and resume normal services;\nzo)\twhen the UE in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE, the UE supports the reconnection to the network due to RAN timing synchronization status change has been requested to reconnect to the network upon receiving an indication of a change in the RAN timing synchronization status (see subclauses\u00a05.4.4.2, 5.5.1.2.4, and 5.5.1.3.4), and the UE receives an indication of a change in the RAN timing synchronization status; or\nzp)\twhen the UE that supports non-3GPP access path switching needs to trigger non-3GPP access path switching from the old non-3GPP access to the new non-3GPP access that is in the same PLMN.\nNOTE\u00a04:\tNon-3GPP access path switching from a non-3GPP access to a wireline access, or from a wireline access to a non-3GPP access, is not specified in this release of the specification.\nzq)\tif the UE moves from a tracking area for which the TAI is configured for partially rejected NSSAI to another tracking area within the registration area with aTAI for which the S-NSSAI(s) is supported and the UE still needs to request that S-NSSAI(s).\nNOTE\u00a04A:\tThe UEs that do not initiate the registration procedure for mobility and periodic registration update in the case above will not receive service for the S-NSSAI(s) that are configured to support the S-NSSAI(s) in the tracking areas supporting the S-NSSAI(s). Operators are recomended to consider the impact of such a configuration, of having partially rejected NSSAI applicable in some tracking areas within a registration area, as it requires the UE to perform mobility and periodic registration update procedure upon mobility within the same registration area.\nIf case b) is the only reason for initiating the registration procedure for mobility and periodic registration update, the UE shall indicate \"periodic registration updating\" in the 5GS registration type IE; otherwise, if the UE initiates the registration procedure for mobility and periodic registration update due to case Zg), the UE shall indicate \"disaster roaming mobility registration updating\" in the 5GS registration type IE; otherwise the UE shall indicate \"mobility registration updating\".\nIf case zl) is the reason for initiating the registration procedure for mobility and periodic registration update and if the UE supports S1 mode and the UE has not disabled its E-UTRA capability, the UE shall:\n-\tset the S1 mode bit to \"S1 mode supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message; and\n-\tinclude the S1 UE network capability IE in the REGISTRATION REQUEST message;\nIf the UE which is not registered for disaster roaming services indicates \"mobility registration updating\" in the 5GS registration type IE and the UE supports S1 mode and the UE has not disabled its E-UTRA capability, the UE shall:\n-\tset the S1 mode bit to \"S1 mode supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message;\n-\tinclude the S1 UE network capability IE in the REGISTRATION REQUEST message additionally, if the UE supports EPS-UPIP, the UE shall set the EPS-UPIP bit to \"EPS-UPIP supported\" in the S1 UE network capability IE in the REGISTRATION REQUEST message; and\n-\tif the UE supports sending an ATTACH REQUEST message containing a PDN CONNECTIVITY REQUEST message with request type set to \"handover\" to transfer a PDU session from N1 mode to S1 mode, set the HO attach bit to \"attach request message containing PDN connectivity request with request type set to handover to transfer PDU session from N1 mode to S1 mode supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the LTE positioning protocol (LPP) in N1 mode as specified in 3GPP\u00a0TS\u00a037.355\u00a0[26], the UE shall set the LPP bit to \"LPP in N1 mode supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the Location Services (LCS) notification mechanisms in N1 mode as specified in 3GPP\u00a0TS\u00a023.273\u00a0[6B], the UE shall set the 5G-LCS bit to \"LCS notification mechanisms supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the user plane positioning using LCS-UPP as specified in 3GPP\u00a0TS\u00a023.273\u00a0[6B], the UE shall set the LCS-UPP bit to \"LCS-UPP user plane positioning supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the user plane positioning using SUPL as specified in 3GPP\u00a0TS\u00a038.305\u00a0[67] and 3GPP\u00a0TS\u00a023.271\u00a0[68], the UE shall set the SUPL bit to \"SUPL user plane positioning supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports network verified UE location over satellite NG-RAN as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the NVL-SATNR bit to \"Network verified UE location over satellite NG-RAN supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nFor all cases except case b), when the UE is not in NB-N1 mode and the UE supports RACS, the UE shall set the RACS bit to \"RACS supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports 5G-SRVCC from NG-RAN to UTRAN as specified in 3GPP\u00a0TS\u00a023.216\u00a0[6A], the UE shall set:\n-\tthe 5G-SRVCC from NG-RAN to UTRAN capability bit to \"5G-SRVCC from NG-RAN to UTRAN supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message for all cases except case\u00a0b; and\n-\tinclude the Mobile station classmark 2 IE and the Supported codecs IE in the REGISTRATION REQUEST message for all cases except case\u00a0b.\nIf the UE supports the restriction on use of enhanced coverage, the UE shall set the RestrictEC bit to \"Restriction on use of enhanced coverage supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports network slice-specific authentication and authorization, the UE shall set the NSSAA bit to \"network slice-specific authentication and authorization supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message for all cases except case\u00a0b.\nIf the UE supports CAG feature, the UE shall set the CAG bit to \"CAG Supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports extended CAG information list, the UE shall set the Ex-CAG bit to \"Extended CAG information list supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports enhanced CAG information, the UE shall set the ECI bit to \"enhanced CAG information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports sending of REGISTRATION COMPLETE message for acknowledging the reception of Negotiated PEIPS assistance inforation IE, the UE shall set the RCMAP bit to \"Sending of REGISTRATION COMPLETE message for negotiated PEIPS assistance information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE operating in the single-registration mode performs inter-system change from S1 mode to N1 mode and:\na)\thas one or more stored UE policy sections identified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN, the UE shall set the Payload container type IE to \"UE policy container\" and include the UE STATE INDICATION message (see annex\u00a0D) in the Payload container IE of the REGISTRATION REQUEST message; or\nb)\tdoes not have any stored UE policy section identified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN, and the UE needs to send a UE policy container to the network, the UE shall set the Payload container type IE to \"UE policy container\" and include the UE STATE INDICATION message (see annex\u00a0D) in the Payload container IE of the REGISTRATION REQUEST message.\nNOTE\u00a05:\tIn this version of the protocol, the UE can only include the Payload container IE in the REGISTRATION REQUEST message to carry a payload of type \"UE policy container\".\nThe UE in state 5GMM-REGISTERED shall initiate the registration procedure for mobility and periodic registration update by sending a REGISTRATION REQUEST message to the AMF when the UE needs to request the use of SMS over NAS transport or the current requirements to use SMS over NAS transport change in the UE. The UE shall set the SMS requested bit of the 5GS update type IE in the REGISTRATION REQUEST message as specified in subclause\u00a05.5.1.2.2.\nWhen initiating a registration procedure for mobility and periodic registration update and the UE needs to send the 5GS update type IE for a reason different than indicating a change in requirement to use SMS over NAS, the UE shall set the SMS requested bit of the 5GS update type IE in the REGISTRATION REQUEST message to the same value as indicated by the UE in the last REGISTRATION REQUEST message.\nIf the UE no longer requires the use of SMS over NAS, then the UE shall include the 5GS update type IE in the REGISTRATION REQUEST message with the SMS requested bit set to \"SMS over NAS not supported\".\nAfter sending the REGISTRATION REQUEST message to the AMF the UE shall start timer T3510. If timer T3502 is currently running, the UE shall stop timer T3502. If timer T3511 is currently running, the UE shall stop timer T3511.\nIf the last visited registered TAI is available, the UE shall include the last visited registered TAI in the REGISTRATION REQUEST message.\nThe UE shall handle the 5GS mobile identity IE in the REGISTRATION REQUEST message as follows:\na)\tif the UE is operating in the single-registration mode, performs inter-system change from S1 mode to N1 mode, and the UE holds a valid native 4G-GUTI, the UE shall create a 5G-GUTI mapped from the valid native 4G-GUTI as specified in 3GPP\u00a0TS\u00a023.003\u00a0[4] and indicate the mapped 5G-GUTI in the 5GS mobile identity IE. Additionally, if the UE holds a valid 5G-GUTI, the UE shall include the 5G-GUTI in the Additional GUTI IE in the REGISTRATION REQUEST message in the following order:\n1)\ta valid 5G-GUTI that was previously assigned by the same PLMN with which the UE is performing the registration, if available;\n2)\ta valid 5G-GUTI that was previously assigned by an equivalent PLMN, if available; and\n3)\ta valid 5G-GUTI that was previously assigned by any other PLMN, if available; and\nNOTE\u00a06:\tThe 5G-GUTI included in the Additional GUTI IE is a native 5G-GUTI.\nb)\tfor all other cases, if the UE holds a valid 5G-GUTI, the UE shall indicate the 5G-GUTI in the 5GS mobile identity IE. If the UE is registering with an SNPN and the valid 5G-GUTI was previously assigned by another SNPN, the UE shall additionally include the NID of the other SNPN in the NID IE.\n\tIf the UE does not operate in SNPN access operation mode, holds two valid native 5G-GUTIs assigned by PLMNs and:\n1)\tone of the valid native 5G-GUTI was assigned by the PLMN with which the UE is performing the registration, then the UE shall indicate the valid native 5G-GUTI assigned by the PLMN with which the UE is performing the registration. In addition, the UE shall include the other valid native 5G-GUTI in the Additional GUTI IE; or\n2)\tnone of the valid native 5G-GUTI was assigned by the PLMN with which the UE is performing the registration, then the UE shall indicate the valid native 5G-GUTI assigned over the same access via which the UE is performing the registration.\nIf the UE supports MICO mode and requests the use of MICO mode, then the UE shall include the MICO indication IE in the REGISTRATION REQUEST message. If the UE requests to use an active time value, it shall include the active time value in the T3324 IE in the REGISTRATION REQUEST message. If the UE includes the T3324 IE, it may also request a particular T3512 value by including the Requested T3512 IE in the REGISTRATION REQUEST message. Additionally, if the UE supports strictly periodic registration timer, the UE shall set the Strictly Periodic Registration Timer Indication bit of the MICO indication IE in the REGISTRATION REQUEST message to \"strictly periodic registration timer supported\". If the UE needs to stop the use of MICO mode, then the UE shall not include the MICO indication IE in the REGISTRATION REQUEST message.\nIf the UE needs to use or change the UE specific DRX parameters, the UE shall include the Requested DRX parameters IE in the REGISTRATION REQUEST message for all cases except case\u00a0b).\nIf the UE is in NB-N1 mode and if the UE needs to use or change the UE specific DRX parameters for NB-N1 mode, the UE shall include the Requested NB-N1 mode DRX parameters IE in the REGISTRATION REQUEST message for all cases except case\u00a0b).\nIf the UE supports eDRX and requests the use of eDRX, the UE shall include the Requested extended DRX parameters IE in the REGISTRATION REQUEST message.\nIf the UE needs to request LADN information for specific LADN DNN(s) or indicates a request for LADN information as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall include the LADN indication IE in the REGISTRATION REQUEST message and:\n-\trequest specific LADN DNNs by including a LADN DNN value in the LADN indication IE for each LADN DNN for which the UE requests LADN information; or\n-\tto indicate a request for LADN information by not including any LADN DNN value in the LADN indication IE.\nIf the UE is initiating the registration procedure for mobility and periodic registration update, the UE may include the Uplink data status IE to indicate which PDU session(s) is:\n-\tnot associated with control plane only indication;\n-\tassociated with the access type the REGISTRATION REQUEST message is sent over; and\n-\thave pending user data to be sent over user plane or are associated with active multicast MBS session(s). \nIf the UE has one or more active always-on PDU sessions associated with the access type over which the REGISTRATION REQUEST message is sent and the user-plane resources for these PDU sessions are not established, and for cases triggering the REGISTRATION REQUEST message except b), the UE shall include the Uplink data status IE and indicate that the UE has pending user data to be sent for those PDU sessions. If the UE is located outside the LADN service area and inside the registration area assigned by the network, the UE shall not include the PDU session for LADN in the Uplink data status IE. If the UE is in a non-allowed area or is not in an allowed area as specified in subclause\u00a05.3.5, and the UE is in the registration area assigned by the network, the UE shall not include the Uplink data status IE except for emergency services or for high priority access. If the MUSIM UE requests the network to release the NAS signalling connection, the UE shall not include the Uplink data status IE in the REGISTRATION REQUEST message.\nIf the UE has one or more active PDU sessions which are not accepted by the network as always-on PDU sessions and no uplink user data pending to be sent for those PDU sessions, the UE shall not include those PDU sessions in the Uplink data status IE in the REGISTRATION REQUEST message.\nWhen the registration procedure for mobility and periodic registration update is initiated in 5GMM-IDLE mode, the UE may include a PDU session status IE in the REGISTRATION REQUEST message, indicating:\n-\twhich single access PDU sessions associated with the access type the REGISTRATION REQUEST message is sent over are not inactive in the UE; and\n-\twhich MA PDU sessions are not inactive and having the corresponding user plane resources being established or established in the UE on the access the REGISTRATION REQUEST message is sent over.\nIf the UE received a paging message with the access type indicating non-3GPP access, the UE shall include the Allowed PDU session status IE in the REGISTRATION REQUEST message. If the UE has PDU session(s) associated with non-3GPP access for which the associated S-NSSAI(s) are included in the allowed NSSAI for 3GPP access or the S-NSSAI associated with the PDU session is included in the partially allowed NSSAI for 3GPP access and the TAI where the UE is currently camped is in list of TAs for which the S-NSSAI is allowed, the UE shall indicate the PDU session(s) for which the UE allows to re-establish the user-plane resources over 3GPP access in the Allowed PDU session status IE. Otherwise, the UE shall not indicate any PDU session(s) in the Allowed PDU session status IE. If the UE is in a non-allowed area or the UE is not in an allowed area, the UE shall set the Allowed PDU session status IE as specified in subclause\u00a05.3.5.2.\nWhen the Allowed PDU session status IE is included in the REGISTRATION REQUEST message, the UE shall indicate that a PDU session is not allowed to be transferred to the 3GPP access if the 3GPP PS data off UE status is \"activated\" for the corresponding PDU session and the UE is not using the PDU session to send uplink IP packets for any of the 3GPP PS data off exempt services (see subclause\u00a06.2.10).\nIf the UE operating in the single-registration mode performs inter-system change from S1 mode to N1 mode, the UE:\na)\tshall include the UE status IE with the EMM registration status set to \"UE is in EMM-REGISTERED state\" in the REGISTRATION REQUEST message;\nNOTE\u00a07:\tInclusion of the UE status IE with this setting corresponds to the indication that the UE is \"moving from EPC\" as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9], subclause\u00a04.11.1.3.3 and 4.11.2.3.\nNOTE\u00a08:\tThe value of the 5GMM registration status included by the UE in the UE status IE is not used by the AMF.\nb)\tmay include the PDU session status IE in the REGISTRATION REQUEST message indicating the status of the PDU session(s) mapped during the inter-system change from S1 mode to N1 mode from the PDN connection(s) for which the EPS indicated that interworking to 5GS is supported, if any (see subclause\u00a06.1.4.1);\nc)\tshall include a TRACKING AREA UPDATE REQUEST message as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] in the EPS NAS message container IE in the REGISTRATION REQUEST message if the registration procedure is initiated in 5GMM-IDLE mode and the UE has received an \"interworking without N26 interface not supported\" indication from the network;\nc1)\tmay include a TRACKING AREA UPDATE REQUEST message as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] in the EPS NAS message container IE in the REGISTRATION REQUEST message if the registration procedure is initiated in 5GMM-IDLE mode and the UE has received an \"interworking without N26 interface supported\" indication from the network; and\nd)\tshall include an EPS bearer context status IE in the REGISTRATION REQUEST message indicating which EPS bearer contexts are active in the UE, if the UE has locally deactivated EPS bearer context(s) for which interworking to 5GS is supported while the UE was in S1 mode without notifying the network.\nFor a REGISTRATION REQUEST message with a 5GS registration type IE indicating \"mobility registration updating\", if the UE:\na)\tis in NB-N1 mode and:\n1)\tthe UE needs to change the slice(s) it is currently registered to within the same registration area; or\n2)\tthe UE has entered a new registration area; or\nb)\tis not in NB-N1 mode and is not registered for onboarding services in SNPN;\nthe UE shall include the Requested NSSAI IE containing the S-NSSAI(s) corresponding to the network slices to which the UE intends to register and associated mapped S-NSSAI(s), if available, in the REGISTRATION REQUEST message as described in this subclause. When the UE is entering a visited PLMN and intends to register to the slices for which the UE has only HPLMN S-NSSAI(s) available, the UE shall include these HPLMN S-NSSAI(s) in the Requested mapped NSSAI IE This is also applicable when the UE is entering an EHPLMN whose PLMN code is not derived from the IMSI. The sum of number of S-NSSAI values in the Requested NSSAI IE and number of S-NSSAI values in the Requested mapped NSSAI IE shall not exceed eight.\nNOTE\u00a09:\tThe REGISTRATION REQUEST message can include both the Requested NSSAI IE and the Requested mapped NSSAI IE as described below.\nIf the UE is registered for onboarding services in SNPN, the UE shall not include the Requested NSSAI IE in the REGISTRATION REQUEST message.\nIf the UE has allowed NSSAI or configured NSSAI or both for the current PLMN, the Requested NSSAI IE shall include either:\na)\tthe configured NSSAI for the current PLMN or SNPN, or a subset thereof as described below;\nb)\tthe allowed NSSAI for the current PLMN or SNPN, or a subset thereof as described below; or\nc)\tthe allowed NSSAI for the current PLMN or SNPN, or a subset thereof as described below, plus the configured NSSAI for the current PLMN or SNPN, or a subset thereof as described below;\nIn addition, the Requested NSSAI IE shall include S-NSSAI(s) applicable in the current PLMN or SNPN, and if available the associated mapped S-NSSAI(s) for:\na)\teach PDN connection that is established in S1 mode when the UE is operating in the single-registration mode and the UE is performing an inter-system change from S1 mode to N1 mode; or\nb)\teach active PDU session.\nIf the UE does not have S-NSSAI(s) applicable in the current PLMN or SNPN, then the Requested mapped NSSAI IE shall include HPLMN S-NSSAI(s) (e.g. mapped S-NSSAI(s), if available) for:\na)\teach PDN connection established in S1 mode when the UE is operating in the single-registration mode and the UE is performing an inter-system change from S1 mode to N1 mode to a visited PLMN; or\nb)\teach active PDU session when the UE is performing mobility from N1 mode to N1 mode to a visited PLMN.\nNOTE\u00a010:\tThe Requested NSSAI IE is used instead of Requested mapped NSSAI IE in REGISTRATION REQUEST message when the UE enters HPLMN and the EHPLMN list is not present or is empty; or when the UE enters a PLMN whose PLMN code is derived from the IMSI and the EHPLMN list is not empty. The Requested mapped NSSAI IE is used when the UE enters an EHPLMN whose PLMN code is not derived from the IMSI.\nIf both the S-NSSAI to be replaced and the alternative S-NSSAI are included in the configured NSSAI, and the UE needs to request the S-NSSAI to be replaced, the UE shall include the S-NSSAI to be replaced in the Requested NSSAI IE or the Requested mapped NSSAI IE.\nFor a REGISTRATION REQUEST message with a 5GS registration type IE indicating \"mobility registration updating\", if the UE is in NB-N1 mode and the procedure is initiated for all cases except case a), c), e), i), s), t), w), and x), the REGISTRATION REQUEST message shall not include the Requested NSSAI IE.\nIf the UE has:\n-\tno allowed NSSAI for the current PLMN or SNPN;\n-\tno configured NSSAI for the current PLMN or SNPN;\n-\tneither active PDU session(s) nor PDN connection(s) to transfer associated with an S-NSSAI applicable in the current PLMN or SNPN; and\n-\tneither active PDU session(s) nor PDN connection(s) to transfer associated with mapped S-NSSAI(s);\nand has a default configured NSSAI, then the UE shall:\na)\tinclude the S-NSSAI(s) in the Requested NSSAI IE of the REGISTRATION REQUEST message using the default configured NSSAI; and\nb)\tinclude the Network slicing indication IE with the Default configured NSSAI indication bit set to \"Requested NSSAI created from default configured NSSAI\" in the REGISTRATION REQUEST message.\nIf the UE has:\n-\tno allowed NSSAI for the current PLMN or SNPN;\n-\tno configured NSSAI for the current PLMN or SNPN;\n-\tneither active PDU session(s) nor PDN connection(s) to transfer associated with an S-NSSAI applicable in the current PLMN or SNPN\n-\tneither active PDU session(s) nor PDN connection(s) to transfer associated with mapped S-NSSAI(s); and\n-\tno default configured NSSAI,\nthe UE shall include neither Requested NSSAI IE nor Requested mapped NSSAI IE in the REGISTRATION REQUEST message.\nIf all the S-NSSAI(s) corresponding to the slice(s) to which the UE intends to register are included in the pending NSSAI, the UE shall not include a requested NSSAI in the REGISTRATION REQUEST message.\nWhen the UE storing a pending NSSAI intends to register to additional S-NSSAI(s) over the same access type, the UE shall send the requested NSSAI containing the additional S-NSSAI(s) that the UE intends to register to in the REGISTRATION REQUEST message. The requested NSSAI shall not include any S-NSSAI from the pending NSSAI.\nThe subset of configured NSSAI provided in the requested NSSAI consists of one or more S-NSSAIs in the configured NSSAI applicable to the current PLMN or SNPN, where any included S-NSSAI is neither in the rejected NSSAI nor associated to an S-NSSAI in the rejected NSSAI. If the UE is inside the NS-AoS of an S-NSSAI in the rejected NSSAI with a rejection cause value set to \"S-NSSAI not available in the current registration area\", the S-NSSAI may be included in the requested NSSAI.\nFor case zq, the subset of configured NSSAI provided in the requested NSSAI consists of one or more S-NSSAIs in the configured NSSAI applicable to the current PLMN or SNPN, where any included S-NSSAI is in the partially rejected NSSAI and the current TAI is in the list of TAs for which the S-NSSAI is not rejected. If the UE is inside the NS-AoS of an S-NSSAI in the partially rejected NSSAI and the current TAI is in the list of TAs for which the S-NSSAI is rejected, the S-NSSAI may be included in the requested NSSAI. \nIn addition, if the NSSRG information is available, the subset of configured NSSAI provided in the requested NSSAI shall be associated with at least one common NSSRG value. The UE may also include in the requested NSSAI included in the Requested NSSAI IE or the Requested mapped NSSAI IE or both, the S-NSSAI(s) which were added to configured NSSAI in S1 mode and for which the associated NSSRG information is not available. If the UE is in 5GMM-REGISTERED state over the other access and has already an allowed NSSAI for the other access in the same PLMN or in different PLMNs, all the S-NSSAI(s) in the requested NSSAI included in the Requested NSSAI IE or the Requested mapped NSSAI IE or both for the current access shall share at least an NSSRG value common to all the S-NSSAI(s) of the allowed NSSAI for the other access. If the UE is simultaneously performing the registration procedure on the other access in different PLMNs, the UE shall include S-NSSAIs that share at least a common NSSRG value across all access types. If the UE has pending NSSAI which the UE is still interested in using, then S-NSSAIs in the pending NSSAI and requested NSSAI shall be associated with at least one common NSSRG value.\nNOTE\u00a011:\tIf the UE has stored mapped S-NSSAI(s) for the rejected NSSAI, and one or more S-NSSAIs in the stored mapped S-NSSAI(s) for the configured NSSAI are not included in the stored mapped S-NSSAI(s) for the rejected NSSAI, then a S-NSSAI in the configured NSSAI associated to one or more of these mapped S-NSSAI(s) for the configured NSSAI are available to be included in the requested NSSAI together with their mapped S-NSSAI.\nNOTE\u00a012:\tIf one or more mapped S-NSSAIs in the stored mapped S-NSSAI(s) for the configured NSSAI are not included in the stored rejected NSSAI for the failed or revoked NSSAA, a S-NSSAI in the configured NSSAI associated to one or more of these mapped S-NSSAI(s) for the configured NSSAI are available to be included in the registration request together with their mapped S-NSSAI.\nNOTE\u00a013:\tThere is no need to consider the case that the UE is simultaneously performing the registration procedure on the other access in the same PLMN, due to that the UE is not allowed to initiate the registration procedure over one access when the registration over the other access to the same PLMN is going on.\nIf:\na)\tthe UE is registered to current PLMN over the other access and has NSSRG information available;\nb)\tthe UE is attempting mobility registration to the same current PLMN from other PLMN in the current access; and\nc)\tthe UE has PDU session(s) or PDN connection(s) associated with NSSAI not sharing part of NSSRG available of the current PLMN;\nthen the UE locally releases these PDU session(s) or PDN connection(s), as the NSSAI for these PDU session(s) or PDN connection(s) will not be included in the requested or the requested mapped NSSAI in the current PLMN due to its lack of association to the common NSSRG of the current PLMN.\nThe subset of allowed NSSAI provided in the requested NSSAI consists of one or more S-NSSAIs in the allowed NSSAI for this PLMN.\nIf the UE supports the S-NSSAI time validity information, S-NSSAI time validity information is available for an S-NSSAI, and the S-NSSAI time validity information indicates that the S-NSSAI is not available, the UE shall not include the S-NSSAI in the Requested NSSAI IE of the REGISTRATION REQUEST message. If the UE has S-NSSAI time validity information over the other access in the same PLMN and the S-NSSAI time validity information indicates that the S-NSSAI is not available, the UE shall not include the S-NSSAI in the Requested NSSAI IE of the REGISTRATION REQUEST message for the current access type.\nNOTE\u00a014:\tHow the UE selects the subset of configured NSSAI or allowed NSSAI to be provided in the requested NSSAI is implementation specific. The UE can take preferences indicated by the upper layers (e.g. policies like URSP, applications) and UE local configuration into account.\nNOTE\u00a014A:\tIf the UE determines the on-demand S-NSSAI for a PDU session establishment as specified in subclause\u00a04.2.2 of 3GPP\u00a0TS\u00a024.526\u00a0[19], the UE includes the on-demand S-NSSAI in the requested NSSAI during the registration procedure.\nNOTE\u00a015:\tThe number of S-NSSAI(s) included in the requested NSSAI cannot exceed eight.\nIf the UE supports NSAG, the UE shall set the NSAG bit to \"NSAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports sending of REGISTRATION COMPLETE message for acknowledging the reception of NSAG information IE in the REGISTRATION ACCEPT message, the UE shall set the RCMAN bit to \"Sending of REGISTRATION COMPLETE message for NSAG information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the unavailability period, the UE shall set the UN-PER bit to \"unavailability period supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports network slice replacement, the UE shall set the NSR bit to \"network slice replacement supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nFor case zm1), if the network indicated support for the unavailability period in the last registration procedure and the UE is able to store its 5GMM and 5GSM contexts, the UE shall include the Unavailability information IE, set the Follow-on request indicator to \"No follow-on request pending\" in the REGISTRATION REQUEST message. In addition, the UE shall not include the Uplink data status IE or the Allowed PDU session status IE in the REGISTRATION REQUEST message even if the UE has one or more active always-on PDU sessions associated with the 3GPP access. If the UE includes the Unavailability information IE to indicate the type of the unavailability period and the UE will be unavailable due to NR satellite access discontinuous coverage, the UE shall set the Unavailability type bit to \"unavailability due to discontinuous coverage\" in the Unavailability information IE.\nFor case zm1, the UE should initiate the registration procedure for mobility and periodic registration update only if the UE can determine, based on its implementation, that there is enough time to complete the procedure before the start of the unavailability period.\nNOTE\u00a015A:\tIf the UE is unable to store its 5GMM and 5GSM contexts, the UE triggers the de-registration procedure. Ability to store the 5GMM information for UEs not operating in SNPN access operation mode as described in Annex C.1 does not imply the ability to store the 5GMM and 5GSM contexts.\nNOTE\u00a015B:\tIf the UE is able to store its 5GMM and 5GSM contexts, the UE can store the 5GMM and 5GSM contexts even if the registration procedure for mobility and periodic registration update is not completed successfully.\nThe UE shall set the Follow-on request indicator to \"Follow-on request pending\", if the UE:\na)\tinitiates the registration procedure for mobility and periodic registration update upon request of the upper layers to establish an emergency PDU session;\nb)\tinitiates the registration procedure for mobility and periodic registration update upon receiving a request from the upper layers to perform emergency services fallback; or\nc)\tneeds to prolong the established NAS signalling connection after the completion of the registration procedure for mobility and periodic registration update (e.g. due to uplink signalling pending but no user data pending).\nNOTE\u00a016:\tThe UE does not have to set the Follow-on request indicator to 1 even if the UE has to request resources for V2X communication over PC5 reference point, 5G ProSe direct discovery over PC5, 5G ProSe direct communication over PC5 or ranging and sidelink positioning or A2X communication over PC5 reference point.\nFor case n), the UE shall include the 5GS update type IE in the REGISTRATION REQUEST message with the NG-RAN-RCU bit set to \"UE radio capability update needed\". Additionally, if the UE is not in NB-N1 mode, the UE supports RACS and the UE has an applicable UE radio capability ID for the new UE radio configuration in the serving PLMN or SNPN, the UE shall include the applicable UE radio capability ID in the UE radio capability ID of the REGISTRATION REQUEST message.\nNOTE\u00a016A:\tFor cases n, if the UE supports RACS irrespective whether the UE has an applicable UE radio capability ID for the new UE radio configuration in the selected PLMN the 5GS update type IE in the REGISTRATION REQUEST message with the NG-RAN-RCU bit is set to \"UE radio capability update needed\".\nIf the UE is in the 5GMM-CONNECTED mode and the UE changes the radio capability for NG-RAN or E-UTRAN, the UE may locally release the established N1 NAS signalling connection and enter the 5GMM-IDLE mode. Then, the UE shall initiate the registration procedure for mobility and periodic registration update including the 5GS update type IE in the REGISTRATION REQUEST message with the NG-RAN-RCU bit set to \" UE radio capability update needed\".\nFor case o), the UE shall include the Uplink data status IE in the REGISTRATION REQUEST message indicating the PDU session(s) without active user-plane resources for which the UE has pending user data to be sent, if any, and the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any. If the UE has joined one or more multicast MBS session and was in 5GMM-CONNECTED mode with RRC inactive indication before receiving the fallback indication from the lower layers, the UE shall include the Uplink data status IE in the REGISTRATION REQUEST message indicating the PDU session(s) that are associated to the one or more multicast MBS session. If the UE is in a non-allowed area or if the UE is not in allowed area, the UE shall not include the Uplink data status IE in REGISTRATION REQUEST message, except if the PDU session for which user-plane resources were active prior to receiving the fallback indication is an emergency PDU session, or if the UE is configured for high priority access in the selected PLMN or SNPN as specified in subclause\u00a05.3.5.\nFor case f), the UE shall include the Uplink data status IE in the REGISTRATION REQUEST message indicating the PDU session(s) for which the UE has uplink user data pending and the PDU session(s) for which user-plane resources were active prior to receiving \"RRC Connection failure\" indication from the lower layers, if any. If the UE has joined one or more multicast MBS session and was in 5GMM-CONNECTED mode with RRC inactive indication before receiving the indication of \"RRC Connection failure\" from the lower layers or before receiving the indication that the resumption of the RRC connection has failed from the lower layers, the UE shall include the Uplink data status IE in the REGISTRATION REQUEST message indicating the PDU session(s) that are associated to the one or more multicast MBS session. If the UE is in non-allowed area or not in allowed area, the UE shall not include the Uplink data status IE in REGISTRATION REQUEST message, except that the PDU session for which user-plane resources were active prior to receiving the \"RRC Connection failure\"indication is emergency PDU session, or that the UE is configured for high priority access in selected PLMN or SNPN, as specified in subclause\u00a05.3.5.\nIf the UE supports service gap control, then the UE shall set the SGC bit to \"service gap control supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nFor case a), x) or if the UE operating in the single-registration mode performs inter-system change from S1 mode to N1 mode, the UE shall:\na)\tif the UE has an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN or SNPN, include the applicable network-assigned UE radio capability ID in the UE radio capability ID IE of the REGISTRATION REQUEST message; and\nb)\tif the UE:\n1)\tdoes not have an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN or SNPN; and\n2)\thas an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration,\n\tinclude the applicable manufacturer-assigned UE radio capability ID in the UE radio capability ID IE of the REGISTRATION REQUEST message.\nFor all cases except cases b) and z), if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys, the UE shall include the Additional information requested IE with the CipherKey bit set to \"ciphering keys for ciphered broadcast assistance data requested\" in the REGISTRATION REQUEST message.\nFor case z), the UE shall include the Additional information requested IE with the CipherKey bit set to \"ciphering keys for ciphered broadcast assistance data requested\" in the REGISTRATION REQUEST message.\nFor case a), if the UE supports ciphered broadcast assistance data and the UE detects that one or more ciphering keys stored at the UE is not applicable in the current TAI, the UE should include the Additional information requested IE with the CipherKey bit set to \"ciphering keys for ciphered broadcast assistance data requested\" in the REGISTRATION REQUEST message.\nFor case b), if the UE supports ciphered broadcast assistance data and the remaining validity time for one or more ciphering keys stored at the UE is less than timer T3512, the UE should include the Additional information requested IE with the CipherKey bit set to \"ciphering keys for ciphered broadcast assistance data requested\" in the REGISTRATION REQUEST message.\nThe UE shall set the WUSA bit to \"WUS assistance information reception supported\" in the 5GMM capability IE if the UE supports WUS assistance information. The UE may include its UE paging probability information in the Requested WUS assistance information IE if the UE has set the WUSA bit to \"WUS assistance information reception supported\" in the 5GMM capability IE and does not have an active emergency PDU session.\nThe UE shall set the NR-PSSI bit to \"NR paging subgrouping supported\" in the 5GMM capability IE if the UE supports PEIPS assistance information, is not registered for emergency services and does not have an active emergency PDU session. The UE may include its UE paging probability information in the Requested PEIPS assistance information IE if the UE has set the NR-PSSI bit to \"NR paging subgrouping supported\" in the 5GMM capability IE.\nIf the network supports the N1 NAS signalling connection release, and the MUSIM UE requests the network to release the NAS signalling connection, the UE shall set Request type to \"NAS signalling connection release\" in the UE request type IE, set the Follow-on request indicator to \"No follow-on request pending\" and, if the network supports the paging restriction, may set the paging restriction preference in the Paging restriction IE in the REGISTRATION REQUEST message. In addition, the UE shall not include the Uplink data status IE or the Allowed PDU session status IE in the REGISTRATION REQUEST message even if the UE has one or more active always-on PDU sessions associated with the 3GPP access.\nNOTE\u00a017:\tIf the network has already indicated support for N1 NAS signalling connection release in the current stored registration area and the UE doesn't have an emergency PDU session established, the MUSIM UE is allowed to request the network to release the NAS signalling connection during registration procedure for mobility and periodic registration update that is due to mobility outside the registration area even before detecting whether the network supports the N1 NAS signalling connection release in the current TAI.\nNOTE\u00a018:\tIf the network has already indicated support for paging restriction in the current stored registration area and the UE doesn't have an emergency PDU session established, the MUSIM UE is allowed to include paging restriction together with the request to the network to release the NAS signalling connection during registration procedure for mobility and periodic registration update that is due to mobility outside the registration area even before detecting whether the network supports the paging restriction in the current TAI.\nFor case zi), the UE shall not include the Paging restriction IE in the REGISTRATION REQUEST message. If the UE is in 5GMM-IDLE mode and the network supports the N1 NAS signalling connection release, the UE may include the UE request type IE and set Request type to \"NAS signalling connection release\" to remove the paging restriction and request the release of the NAS signalling connection at the same time. In addition, the UE shall not include the Uplink data status IE in the REGISTRATION REQUEST message.\nIf the UE does not have a valid 5G NAS security context and the UE is sending the REGISTRATION REQUEST message after an inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, the UE shall send the REGISTRATION REQUEST message without including the NAS message container IE. The UE shall include the entire REGISTRATION REQUEST message (i.e. containing cleartext IEs and non-cleartext IEs, if any) in the NAS message container IE that is sent as part of the SECURITY MODE COMPLETE message as described in subclauses\u00a04.4.6 and\u00a05.4.2.3.\nIf the UE indicates \"mobility registration updating\" in the 5GS registration type IE and supports V2X as specified in 3GPP\u00a0TS\u00a024.587\u00a0[19B], the UE shall set the V2X bit to \"V2X supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE indicates \"mobility registration updating\" in the 5GS registration type IE and supports V2X communication over E-UTRA-PC5 as specified in 3GPP\u00a0TS\u00a024.587\u00a0[19B], the UE shall set the V2XCEPC5 bit to \"V2X communication over E-UTRA-PC5 supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE indicates \"mobility registration updating\" in the 5GS registration type IE and supports V2X communication over NR-PC5 as specified in 3GPP\u00a0TS\u00a024.587\u00a0[19B], the UE shall set the V2XCNPC5 bit to \"V2X communication over NR-PC5 supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nThe UE shall send the REGISTRATION REQUEST message including the NAS message container IE as described in subclause\u00a04.4.6:\na)\twhen the UE is sending the message from 5GMM-IDLE mode, the UE has a valid 5G NAS security context, and needs to send non-cleartext IEs; or\nb)\twhen the UE is sending the message after an inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode and the UE has a valid 5G NAS security context and needs to send non-cleartext IEs.\nThe UE with a valid 5G NAS security context shall send the REGISTRATION REQUEST message without including the NAS message container IE when the UE does not need to send non-cleartext IEs and the UE is sending the message:\na)\tfrom 5GMM-IDLE mode; or\nb)\tafter an inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode.\nIf the UE is sending the REGISTRATION REQUEST message after an inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode and the UE needs to send non-cleartext IEs, the UE shall cipher the NAS message container IE using the mapped 5G NAS security context and send the REGISTRATION REQUEST message including the NAS message container IE as described in subclause\u00a04.4.6. If the UE does not need to send non-cleartext IEs, the UE shall send the REGISTRATION REQUEST message without including the NAS message container IE.\nIf the REGISTRATION REQUEST message includes a NAS message container IE, the AMF shall process the REGISTRATION REQUEST message that is obtained from the NAS message container IE as described in subclause\u00a04.4.6.\nIf the UE is in NB-N1 mode, then the UE shall set the Control plane CIoT 5GS optimization bit to \"Control plane CIoT 5GS optimization supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. For all cases except case b, if the UE is capable of NB-S1 mode, then the UE shall set the Control plane CIoT EPS optimization bit to \"Control plane CIoT EPS optimization supported\" in the S1 UE network capability IE of the REGISTRATION REQUEST message.\nIf the registration procedure for mobility and periodic registration update is initiated and there is request from the upper layers to perform \"emergency services fallback\" pending, the UE shall send a REGISTRATION REQUEST message without an Uplink data status IE.\nIf the UE supports N3 data transfer and multiple user-plane resources in NB-N1 mode (see 3GPP\u00a0TS\u00a036.306\u00a0[25D], 3GPP\u00a0TS\u00a036.331\u00a0[25A]), then the UE shall set the Multiple user-plane resources support bit to \"Multiple user-plane resources supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nThe UE shall set the ER-NSSAI bit to \"Extended rejected NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the NSSRG, then the UE shall set the NSSRG bit to \"NSSRG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nFor case zf), the UE shall include the service-level device ID in the Service-level-AA container IE of the REGISTRATION REQUEST message and set the value to the CAA-level UAV ID. The UE shall include the service-level-AA server address in the Service-level-AA container IE of the REGISTRATION REQUEST message and set the value to the USS address, if it is provided by the upper layers. The UE shall include the service-level-AA payload in the Service-level-AA container IE of the REGISTRATION REQUEST message and shall set the service-level-AA payload type, if the service-level-AA payload is provided by upper layers.\nNOTE\u00a018:\tThe service-level-AA payload can be of type \"C2 authorization payload\". The C2 authorization payload can include one or both of an indication of the request for direct C2 communication and pairing information for direct C2 communication.\nIf the UE supports 5G ProSe direct discovery as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-dd bit to \"5G ProSe direct discovery supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports 5G ProSe direct communication as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-dc bit to \"5G ProSe discovery communication supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-2 UE-to-network relay UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l2relay bit to \"Acting as a 5G ProSe layer-2 UE-to-network relay UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-3 UE-to-network relay UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l3relay bit to \"Acting as a 5G ProSe layer-3 UE-to-network relay UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-2 UE-to-network remote UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l2rmt bit to \"Acting as a 5G ProSe layer-2 UE-to-network remote UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-3 UE-to-network remote UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l3rmt bit to \"Acting as a 5G ProSe layer-3 UE-to-network remote UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-2 UE-to-UE relay UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l2U2U relay bit to \"Acting as a 5G ProSe layer-2 UE-to-UE relay UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-3 UE-to-UE relay UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l3U2U relay bit to \"Acting as a 5G ProSe layer-3 UE-to-UE relay UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-2 end UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l2end bit to \"Acting as a 5G ProSe layer-2 end UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports acting as 5G ProSe layer-3 end UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall set the 5G ProSe-l3end bit to \"Acting as a 5G ProSe layer-3 end UE supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nFor all cases except case b, if the MUSIM UE supports the N1 NAS signalling connection release, then the UE shall set the N1 NAS signalling connection release bit to \"N1 NAS signalling connection release supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message otherwise the UE shall not set the N1 NAS signalling connection release bit to \"N1 NAS signalling connection release supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nFor all cases except case b, if the MUSIM UE supports the paging indication for voice services, then the UE shall set the paging indication for voice services bit to \"paging indication for voice services supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message otherwise the UE shall not set the paging indication for voice services bit to \"paging indication for voice services supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nFor all cases except case b, if the MUSIM UE supports the reject paging request, then the UE shall set the reject paging request bit to \"reject paging request supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message otherwise the UE shall not set the reject paging request bit to \"reject paging request supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nFor all cases except case b, if the MUSIM UE sets:\n-\tthe reject paging request bit to \"reject paging request supported\";\n-\tthe N1 NAS signalling connection release bit to \"N1 NAS signalling connection release supported\"; or\n-\tboth of them;\nand supports the paging restriction, then the UE shall set the paging restriction bit to \"paging restriction supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message otherwise the UE shall not set the paging restriction bit to \"paging restriction supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports MINT, the UE shall set the MINT bit to \"MINT supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports slice-based N3IWF selection, the UE shall set the SBNS bit to \"Slice-based N3IWF selection supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports slice-based TNGF selection, the UE shall set the SBTS bit to \"Slice-based TNGF selection supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports UAS services, the UE shall set the UAS bit to \"UAS services supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports A2X over E-UTRA-PC5 as specified in 3GPP\u00a0TS\u00a024.577\u00a0[60], the UE shall set the A2XEPC5 bit to \"A2X over E-UTRA-PC5 supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports A2X over NR-PC5 as specified in 3GPP\u00a0TS\u00a024.577\u00a0[60], the UE shall set the A2XNPC5 bit to \"A2X over NR-PC5 supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message. If the UE supports A2X over Uu as specified in 3GPP\u00a0TS\u00a024.577\u00a0[60], the UE shall set the A2X-Uu bit to \"A2X over Uu supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nFor case zg), if the UE has determined the MS determined PLMN with disaster condition as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5], and:\na)\tthe MS determined PLMN with disaster condition is the HPLMN and:\n1)\tthe Additional GUTI IE is included in the REGISTRATION REQUEST message and does not contain a valid 5G-GUTI that was previously assigned by the HPLMN; or\n2)\tthe Additional GUTI IE is not included in the REGISTRATION REQUEST message and the 5GS mobile identity IE contains neither the SUCI nor a valid 5G-GUTI that was previously assigned by the HPLMN; or\nb)\tthe MS determined PLMN with disaster condition is not the HPLMN and:\n1)\tthe Additional GUTI IE is included in the REGISTRATION REQUEST message and does not contain a valid 5G-GUTI that was previously assigned by the MS determined PLMN with disaster condition; or\n2)\tthe Additional GUTI IE is not included in the REGISTRATION REQUEST message and the 5GS mobile identity IE does not contain a valid 5G-GUTI that was previously assigned by the MS determined PLMN with disaster condition;\nthe UE shall include in the REGISTRATION REQUEST message the MS determined PLMN with disaster condition IE indicating the MS determined PLMN with disaster condition.\nNOTE\u00a019:\tIf the UE initiates the registration procedure for disaster roaming services, and the MS determined PLMN with disaster condition cannot be determined when an NG-RAN cell of the PLMN broadcasts the disaster related indication as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5], the UE does not include in the REGISTRATION REQUEST message the MS determined PLMN with disaster condition IE but includes the Additional GUTI IE or the 5GS mobile identity IE or both as specified in subclauses\u00a05.5.1.2.2.\nFor case zh) the UE shall indicate \"mobility registration updating\" in the 5GS registration type IE of the REGISTRATION REQUEST message.\nFor case zp), the UE shall send the REGISTRATION REQUEST message over the new non-3GPP access. The UE shall include the Uplink data status IE in the REGISTRATION REQUEST message indicating the MA PDU session ID(s) or the single access PDU session ID(s) whose user plan resources are to be switched from the old non-3GPP access to the new non-3GPP access or to be established over the new non-3GPP access, if any. If the UE requests the network to keep using the user plane resources of the old non-3GPP access during path switching to the new non-3GPP access, the UE shall include the Non-3GPP path switching information IE in the REGISTRATION REQUEST message and set the NSONR bit to \"non-3GPP path switching while using old non-3GPP resources requested\".\nIf the UE supports event notification, the UE shall set the EventNotification bit to \"Event notification supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports access to an SNPN using credentials from a credentials holder and:\na)\tthe UE is in its HPLMN or EHPLMN or the subscribed SNPN; or\nb)\tthe UE is in a non-subscribed SNPN and supports equivalent SNPNs;\nthe UE shall set the SSNPNSI bit to \"SOR-SNPN-SI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports equivalent SNPNs, the UE shall set the ESI bit to \"equivalent SNPNs supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.If the UE supports LADN per DNN and S-NSSAI, the UE shall set the LADN-DS bit to \"LADN per DNN and S-NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the reconnection to the network due to RAN timing synchronization status change, the UE shall set the Reconnection to the network due to RAN timing synchronization status change (RANtiming) bit to \"Reconnection to the network due to RAN timing synchronization status change supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports MPS indicator update via the UE configuration update procedure, the UE shall set the MPSIU bit to \"MPS indicator update supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports MCS indicator update via the UE configuration update procedure, the UE shall set the MCSIU bit to \"MCS indicator update supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports ranging and sidelink positioning as specified in 3GPP\u00a0TS\u00a024.514\u00a0[62] and supports:\na)\tV2X communication over PC5 as specified in 3GPP\u00a0TS\u00a024.587\u00a0[19B];\nb)\t5G ProSe direct discovery and 5G ProSe direct communication as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E]; or\nc)\tboth a) and b),\nthe UE shall set \nthe RSPPC5 bit to \"Ranging and sidelink positioning over PC5 supported\";\nthe RSLPL bit to \"Ranging and sidelink positioning for located UE supported\";\nc)\tthe RSLPS bit to \"Ranging and sidelink positioning for SL positioning server UE supported\"; or\nd)\tany combination of a), b) and c), in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the partial network slice, the UE shall set the PNS bit to \"Partial network slice supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports network slice usage control, the UE shall set the NSUC bit to \"Network slice usage control supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the S-NSSAI time validity information, the UE shall set the TempNS bit to \"S-NSSAI time validity information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\nIf the UE supports the S-NSSAI location validity information, the UE shall set the SLVI bit to \"S-NSSAI location validity information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\n\nFigure\u00a05.5.1.3.2.1: Registration procedure for mobility and periodic registration update\n5.5.1.3.3\t5GMM common procedure initiation\nThe AMF may initiate 5GMM common procedures, e.g. the identification, authentication and security procedures during the registration procedure, depending on the information received in the REGISTRATION REQUEST message.\nThe AMF may be configured to skip the authentication procedure even if no 5GS security context is available and proceed directly to the execution of the security mode control procedure as specified in subclause\u00a05.4.2, during the registration procedure for mobility and periodic registration update for a UE that has only an emergency PDU session.\nThe AMF shall not initiate a 5GMM authentication procedure before completion of the registration procedure for mobility and periodic registration update, if the following conditions apply:\na)\tthe UE initiated the registration procedure for mobility and periodic registration update after handover or inter-system change to N1 mode in 5GMM-CONNECTED mode;\nb)\tthe target cell is a shared network cell; and\nc.1)\tthe UE has provided its 5G-GUTI in the 5GS mobile identity IE or the Additional GUTI IE in the REGISTRATION REQUEST message, and the PLMN identity included in the 5G-GUTI is different from the selected PLMN identity of the target cell; or\nc.2)\tthe UE has included the 5G-GUTI mapped from the 4G-GUTI in the 5GS mobile identity IE and not included an Additional GUTI IE in the REGISTRATION REQUEST message, and the PLMN identity included in the 5G-GUTI is different from the selected PLMN identity of the target cell.\n5.5.1.3.4\tMobility and periodic registration update accepted by the network\nIf the registration update request has been accepted by the network, the AMF shall send a REGISTRATION ACCEPT message to the UE.\nNOTE\u00a00:\tIf the AMF receives the registration update request over non-3GPP access and detects that the N3IWF used by the UE is compatible with only part of the allowed NSSAI and the UE has not indicated its support for slice-based N3IWF selection in the REGISTRATION REQUEST message, the AMF accepts the registration update request.\nNOTE\u00a00A:\tIf the AMF receives the registration update request over non-3GPP access and detects that the TNGF used by the UE is compatible with only part of the allowed NSSAI and the UE has not indicated its support for slice-based TNGF selection in the REGISTRATION REQUEST message, the AMF accepts the registration update request.\nIf timer T3513 is running in the AMF, the AMF shall stop timer T3513 if a paging request was sent with the access type indicating non-3GPP and the REGISTRATION REQUEST message includes the Allowed PDU session status IE.\nIf timer T3565 is running in the AMF, the AMF shall stop timer T3565 when a REGISTRATION REQUEST message is received.\nFor each of the information elements: 5GMM capability, S1 UE network capability, and UE security capability, the AMF shall store all octets received from the UE in the REGISTRATION REQUEST message, up to the maximum length defined for the respective information element.\nNOTE\u00a01:\tThis information is forwarded to the new AMF during inter-AMF handover or to the new MME during inter-system handover to S1 mode.\nThe 5G-GUTI reallocation shall be part of the registration procedure for mobility registration update. The 5G-GUTI reallocation should be part of the registration procedure for periodic registration update. During the registration procedure for mobility registration update, if the AMF has not allocated a new 5G-GUTI by the generic UE configuration update procedure, the AMF shall include in the REGISTRATION ACCEPT message the new assigned 5G-GUTI.\nIf the UE has set the CAG bit to \"CAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and the AMF needs to update the \"CAG information list\" stored in the UE, the AMF shall include the CAG information list IE or the Extended CAG information list IE in the REGISTRATION ACCEPT message.\nNOTE\u00a02:\tThe \"CAG information list\" can be provided by the AMF and include no entry if no \"CAG information list\" exists in the subscription.\nNOTE\u00a02A:\tIf the UE supports extended CAG information list, the CAG information list can be included either in the CAG information list IE or Extended CAG information list IE.\nIf the UE does not support extended CAG information list, the CAG information list shall not be included in the Extended CAG information list IE.\nIf a 5G-GUTI or the SOR transparent container IE is included in the REGISTRATION ACCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the Operator-defined access category definitions IE or the Extended emergency number list IE ,the CAG information list IE or the Extended CAG information list IE are included in the REGISTRATION ACCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE has set the RCMP bit to \"Sending of REGISTRATION COMPLETE message for negotiated PEIPS assistance information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and if the PEIPS assistance information IE is included in the REGISTRATION ACCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE is not in NB-N1 mode and the UE has set the RACS bit to \"RACS supported\" in the 5GMM Capability IE of the REGISTRATION REQUEST message, the AMF may include either a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the REGISTRATION ACCEPT message. If the UE radio capability ID IE or the UE radio capability ID deletion indication IE is included in the REGISTRATION ACCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nThe AMF may include a new TAI list for the UE in the REGISTRATION ACCEPT message. The new TAI list shall not contain both tracking areas in NB-N1 mode and tracking areas not in NB-N1 mode. The UE, upon receiving a REGISTRATION ACCEPT message, shall delete its old TAI list and store the received TAI list. If there is no TAI list received, the UE shall consider the old TAI list as valid. If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, and\na)\tthe UE already has stored allowed NSSAI for the current registration area, the UE shall store the allowed NSSAI for the current registration area in each of the allowed NSSAIs which are associated with each of the PLMNs in the registration area;\nb)\tthe UE already has stored rejected NSSAI for the current registration area, the UE shall store the rejected NSSAI for the current registration area in each of the rejected NSSAIs which are associated with each of the PLMNs in the registration area;\nc)\tthe UE already has stored rejected NSSAI for the failed or revoked NSSAA, the UE shall store the rejected NSSAI for the failed or revoked NSSAA in each of the rejected NSSAIs which are associated with each of the PLMNs in the registration area;\nd)\tthe UE already has stored rejected NSSAI for the maximum number of UEs reached, the UE shall store the rejected NSSAI for the maximum number of UEs reached in each of the rejected NSSAIs which are associated with each of the PLMNs in the registration area;\ne)\tthe UE already has stored pending NSSAI, the UE shall store the pending NSSAI in each of the pending NSSAIs which are associated with each of the PLMNs in the registration area; and\nf)\tthe UE already has stored partially rejected NSSAI, the UE shall store the partially rejected NSSAI in each of the partially rejected NSSAIs which are associated with each of the PLMNs in the registration area.\nNOTE\u00a03:\tWhen assigning the TAI list, the AMF can take into account the eNodeB's capability of support of CIoT 5GS optimization.\nThe AMF may also include a list of equivalent PLMNs in the REGISTRATION ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if there is no emergency PDU session established, the UE shall remove from the list any PLMN code that is already in the forbidden PLMN list as specified in subclause\u00a05.3.13A. If the UE is not registered for emergency services and there is an emergency PDU session established, the UE shall remove from the list of equivalent PLMNs any PLMN code present in the forbidden PLMN list as specified in subclause\u00a05.3.13A, when the emergency PDU session is released. In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message does not contain a list, then the UE shall delete the stored list. The AMF of a PLMN shall not include a list of equivalent SNPNs.\nIf the ESI bit of the 5GMM capability IE of the REGISTRATION REQUEST message is set to \"equivalent SNPNs supported\", the AMF of a SNPN may include a list of equivalent SNPNs in the REGISTRATION ACCEPT message. If the UE is registered for onboarding services in SNPN, the AMF shall not include a list of equivalent SNPNs in the REGISTRATION ACCEPT message. Each entry in the list contains an SNPN identity. The UE shall store the list as provided by the network. If there is no emergency PDU session established and the UE is not registered for onboarding services in SNPN, the UE shall remove from the list any SNPN identity that is already in:\n-\tthe \"permanently forbidden SNPNs\" list or the \"temporarily forbidden SNPNs\" list, if the SNPN is not an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]); or\n-\tthe \"permanently forbidden SNPNs for access for localized services in SNPN\" list or the \" temporarily forbidden SNPNs for access for localized services in SNPN\" list, if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]). \nIf the UE is not registered for emergency services and there is an emergency PDU session established, the UE shall remove from the list of equivalent SNPNs any SNPN identity present in the \"permanently forbidden SNPNs\" list or the \"temporarily forbidden SNPNs\" list, when the emergency PDU session is released. The UE shall add to the stored list the SNPN identity of the registered SNPN that sent the list. The UE shall replace the stored list on each receipt of the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message does not contain a list, then the UE shall delete the stored list. The AMF of an SNPN shall not include a list of equivalent PLMNs.\nNOTE\u00a03AA:\tIf N1 mode was disabled for an SNPN due to reception of 5GMM cause #27 or #62,\u00a0the UE implementation ensures that it does not register to this SNPN due to being part of the list of \"equivalent SNPNs\" received while registered in another SNPN.\nIf the UE is not registered for emergency services, and if the PLMN identity of the registered PLMN is a member of the forbidden PLMN list as specified in subclause\u00a05.3.13A, any such PLMN identity shall be deleted from the corresponding list(s).\nThe AMF may include new service area restrictions in the Service area list IE in the REGISTRATION ACCEPT message. The UE, upon receiving a REGISTRATION ACCEPT message with new service area restrictions shall act as described in subclause\u00a05.3.5.\nIf the Service area list IE is not included in the REGISTRATION ACCEPT message, any tracking area in the registered PLMN and its equivalent PLMN(s) in the registration area, or in the registered SNPN, is considered as an allowed tracking area as described in subclause\u00a05.3.5.\nThe AMF shall include the MICO indication IE in the REGISTRATION ACCEPT message only if the MICO indication IE was included in the REGISTRATION REQUEST message, the AMF supports and accepts the use of MICO mode. If the AMF supports and accepts the use of MICO mode, the AMF may indicate \"all PLMN registration area allocated\" in the MICO indication IE in the REGISTRATION ACCEPT message. If \"all PLMN registration area allocated\" is indicated in the MICO indication IE, the AMF shall not assign and include the TAI list in the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message includes an MICO indication IE indicating \"all PLMN registration area allocated\", the UE shall treat all TAIs in the current PLMN as a registration area and delete its old TAI list. If \"strictly periodic registration timer supported\" is indicated in the MICO indication IE in the REGISTRATION REQUEST message, the AMF may indicate \"strictly periodic registration timer supported\" in the MICO indication IE and may include the T3512 value IE in the REGISTRATION ACCEPT message. If the timer value received in T3512 IE is different from the already stored value of the timer T3512 and the timer T3512 is running, the UE shall restart T3512 with the new value received in the T3512 value IE.\nThe AMF shall include an active time value in the T3324 IE in the REGISTRATION ACCEPT message if the UE requested an active time value in the REGISTRATION REQUEST message and the AMF accepts the use of MICO mode and the use of active time.\nIf the UE does not include MICO indication IE in the REGISTRATION REQUEST message, then the AMF shall disable MICO mode if it was already enabled.\nIf the AMF supports and accepts the use of MICO, and the UE included the Requested T3512 value IE in the REGISTRATION REQUEST message, then the AMF shall take into account the T3512 value requested when providing the T3512 value IE in the REGISTRATION ACCEPT message.\nNOTE\u00a03A:\tThe T3512 value assigned to the UE by AMF can be different from the T3512 value requested by the UE. AMF can take several factors into account when assigning the T3512 value, e.g. local configuration, expected UE behaviour, UE requested T3512 value, UE subscription data, network policies.\nThe AMF may include the T3512 value IE in the REGISTRATION ACCEPT message only if the REGISTRATION REQUEST message was sent over the 3GPP access.\nThe AMF may include the non-3GPP de-registration timer value IE in the REGISTRATION ACCEPT message only if the REGISTRATION REQUEST message was sent for the non-3GPP access.\nIf the UE indicates support of the N1 NAS signalling connection release in the REGISTRATION REQUEST message and the network decides to accept the N1 NAS signalling connection release, then the AMF shall set the N1 NAS signalling connection release bit to \"N1 NAS signalling connection release supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message.\nIf the UE indicates support of the paging indication for voice services in the REGISTRATION REQUEST message and the network decides to accept the paging indication for voice services, then the AMF shall set the paging indication for voice services bit to \"paging indication for voice services supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message. If the UE receives the REGISTRATION ACCEPT message with the paging indication for voice services bit set to \"paging indication for voice services supported\", the UE NAS layer informs the lower layers that paging indication for voice services is supported. Otherwise, the UE NAS layer informs the lower layers that paging indication for voice services is not supported.\nIf the UE indicates support of the reject paging request in the REGISTRATION REQUEST message and the network decides to accept the reject paging request, then the AMF shall set the reject paging request bit to \"reject paging request supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message.\nIf the UE indicates support of the paging restriction in the REGISTRATION REQUEST message, and the AMF sets:\n-\tthe reject paging request bit to \"reject paging request supported\";\n-\tthe N1 NAS signalling connection release bit to \"N1 NAS signalling connection release supported\"; or\n-\tboth of them;\nin the 5GS network feature support IE of the REGISTRATION ACCEPT message, and the network decides to accept the paging restriction, then the AMF shall set the paging restriction bit to \"paging restriction supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message.\nIf the MUSIM UE does not include the Paging restriction IE in the REGISTRATION REQUEST message, the AMF shall delete any stored paging restriction for the UE and stop restricting paging.\nIf the MUSIM UE requests the release of the NAS signalling connection, by setting Request type to \"NAS signalling connection release\" in the UE request type IE included in the REGISTRATION REQUEST message, and the AMF supports the N1 NAS signalling connection release, the AMF shall initiate the release of the NAS signalling connection after the completion of the registration procedure for mobility and periodic registration update. If the UE requests restriction of paging by including the Paging restriction IE and the AMF supports the paging restriction, the AMF:\n-\tif accepts the paging restriction, shall include the 5GS additional request result IE in the REGISTRATION ACCEPT message and set the Paging restriction decision to \"paging restriction is accepted\". The AMF shall store the paging restriction of the UE and enforce these restrictions in the paging procedure as described in subclause\u00a05.6.2; or\n-\tif rejects the paging restriction, shall include the 5GS additional request result IE in the REGISTRATION ACCEPT message and set the Paging restriction decision to \"paging restriction is rejected\", and shall discard the received paging restriction. The AMF shall delete any stored paging restriction for the UE and stop restricting paging.\nIf the UE requests \"control plane CIoT 5GS optimization\" in the 5GS update type IE, indicates support of control plane CIoT 5GS optimization in the 5GMM capability IE and the AMF decides to accept the requested CIoT 5GS optimization and the registration request, the AMF shall indicate \"control plane CIoT 5GS optimization supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message.\nIf the UE has indicated support for the control plane CIoT 5GS optimizations, and the AMF decides to activate the congestion control for transport of user data via the control plane, then the AMF shall include the T3448 value IE in the REGISTRATION ACCEPT message.\nIf the AMF decides to deactivate the congestion control for transport of user data via the control plane, then the AMF shall delete the stored control plane data back-off time for the UE and the AMF shall not include timer T3448 value IE in the REGISTRATION ACCEPT message.\nIf:\n-\tthe UE in NB-N1 mode is using control plane CIoT 5GS optimization; and\n-\tthe network is configured to provide the truncated 5G-S-TMSI configuration for control plane CIoT 5GS optimizations;\nthe AMF shall include the Truncated 5G-S-TMSI configuration IE in the REGISTRATION ACCEPT message and set the \"Truncated AMF Set ID value\" and the \"Truncated AMF Pointer value\" in the Truncated 5G-S-TMSI configuration IE based on network policies. The AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nFor inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, if the UE has included a ngKSI indicating a current 5G NAS security context in the REGISTRATION REQUEST message by which the REGISTRATION REQUEST message is integrity protected, the AMF shall take one of the following actions:\na)\tif the AMF retrieves the current 5G NAS security context as indicated by the ngKSI and 5G-GUTI sent by the UE, the AMF shall integrity check the REGISTRATION REQUEST message using the current 5G NAS security context and integrity protect the REGISTRATION ACCEPT message using the current 5G NAS security context;\nb)\tif the AMF cannot retrieve the current 5G NAS security context as indicated by the ngKSI and 5G-GUTI sent by the UE, the AMF shall treat the REGISTRATION REQUEST message fails the integrity check and take actions as specified in subclause\u00a04.4.4.3; or\nc)\tif the UE has not included an Additional GUTI IE, the AMF may treat the REGISTRATION REQUEST message as in the previous item, i.e. as if it cannot retrieve the current 5G NAS security context.\nNOTE\u00a04:\tThe handling described above at failure to retrieve the current 5G NAS security context or if no Additional GUTI IE was provided does not preclude the option for the AMF to perform a primary authentication and key agreement procedure and create a new native 5G NAS security context.\nFor inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode, the AMF shall integrity check REGISTRATION REQUEST message using the current K'AMF as derived when triggering the handover to N1 mode (see subclause\u00a04.4.2.2). The AMF shall verify the received UE security capabilities in the REGISTRATION REQUEST message. The AMF shall then take one of the following actions:\na)\tif the REGISTRATION REQUEST does not contain a valid KSIAMF in the Non-current native NAS key set identifier IE, the AMF shall remove the non-current native 5G NAS security context, if any, for any 5G-GUTI for this UE. The AMF shall then integrity protect and cipher the REGISTRATION ACCEPT message using the security context based on K'AMF and take the mapped 5G NAS security context into use; or\nb)\tif the REGISTRATION REQUEST contains a valid KSIAMF in the Non-current native NAS key set identifier IE and:\n1)\tthe AMF decides to take the native 5G NAS security context into use, the AMF shall initiate a security mode control procedure to take the corresponding native 5G NAS security context into use and then integrity protect and cipher the REGISTRATION ACCEPT message using the corresponding native 5G NAS security context; and\n2)\totherwise, the AMF shall then integrity protect and cipher the REGISTRATION ACCEPT message using the security context based on K'AMF and take the mapped 5G NAS security context into use.\nNOTE\u00a05:\tIn above bullet b), it is recommended for the AMF to initiate a security mode control procedure to take the corresponding native 5G NAS security context into use.\nIf the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message, and if:\n-\tthe UE has a valid aerial UE subscription information; and\n-\tthe UUAA procedure is to be performed during the registration procedure according to operator policy; and\n-\tthere is no valid successful UUAA result for the UE in the UE 5GMM context,\nthen the AMF shall initiate the UUAA-MM procedure with the UAS-NF as specified in 3GPP\u00a0TS\u00a023.256\u00a0[6AB] and shall include a service-level-AA pending indication in the Service-level-AA container IE of the REGISTRATION ACCEPT message. The AMF shall store in the UE 5GMM context that a UUAA procedure is pending. The AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3. \nIf the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message, and if:\n-\tthe UE has a valid aerial UE subscription information; \n-\tthe UUAA procedure is to be performed during the registration procedure according to operator policy; and\n-\tthere is a valid successful UUAA result for the UE in the UE 5GMM context,\nthen the AMF shall include a service-level-AA response in the Service-level-AA container IE of the REGISTRATION ACCEPT message and set the SLAR field in the service-level-AA response to \"Service level authentication and authorization was successful\".\nIf the AMF determines that the UUAA-MM procedure needs to be performed for a UE, the AMF has not received the service -level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message from the UE and the AMF decides to accept the UE to be registered for other services than UAS services based on the user's subscription data and the operator policy, the AMF shall accept the registration update request and shall mark in the UE's 5GMM context that the UE is not allowed to request UAS services.\nIf the UE supports MINT, the AMF may include the List of PLMNs to be used in disaster condition IE in the REGISTRATION ACCEPT message.\nIf the UE supports MINT, the AMF may include the Disaster roaming wait range IE in the REGISTRATION ACCEPT message.\nIf the UE supports MINT, the AMF may include the Disaster return wait range IE in the REGISTRATION ACCEPT message.\nNOTE\u00a06:\tThe AMF can determine the content of the \"list of PLMN(s) to be used in disaster condition\", the value of the disaster roaming wait range and the value of the disaster return wait range based on the network local configuration.\nIf the AMF received the list of TAIs from the satellite NG-RAN as described in 3GPP\u00a0TS\u00a023.501\u00a0[8], and determines that, by UE subscription and operator's preferences, any but not all TAIs in the received list of TAIs is forbidden for roaming or for regional provision of service, the AMF shall include the TAI(s) in:\na) the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE; or\nb) the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE; or\nc)\tboth;\nin the REGISTRATION ACCEPT message.\nNOTE\u00a07A:\tVoid.\nIf the UE has set the Reconnection to the network due to RAN timing synchronization status change (RANtiming) bit to \"Reconnection to the network due to RAN timing synchronization status change supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the AMF may include the RAN timing synchronization IE with the RecReq bit set to \"Reconnection requested\" in the REGISTRATION ACCEPT message.\nIf the AMF receives the mobility and periodic registration request along with along with the mobile IAB-indication over N2 reference point (see TS\u00a038.413\u00a0[31]) from an UE and the UE is authorized to operate as an MBSR based on the subscription information and local policy (see 3GPP\u00a0TS\u00a023.501\u00a0[8]), the AMF shall include the Feature authorization indication IE in the REGISTRATION ACCEPT message and shall set the MBSRAI field to \"authorized to operate as MBSR\". If the AMF receives the mobility and periodic registration request along with along with the mobile IAB-indication over N2 reference point (see TS\u00a038.413\u00a0[31]) from a UE and the UE is not authorized operate as an MBSR based on the subscription information and local policy but can operate as a UE, the AMF shall include the Feature authorization indication IE in the REGISTRATION ACCEPT message and shall set the MBSRAI field to \"not authorized to operate as MBSR but allowed to operate as a UE\".\nIf the UE supports user plane positioning using LCS-UPP, SUPL, or both, the AMF shall set the LCS-UPP bit, the SUPL bit, or both in the 5GS network feature support IE of the REGISTRATION ACCEPT message as specified in 3GPP\u00a0TS\u00a024.572\u00a0[64].\nUpon receipt of the REGISTRATION ACCEPT message, the UE shall reset the registration attempt counter and service request attempt counter, enter state 5GMM-REGISTERED and set the 5GS update status to 5U1 UPDATED.\nIf the UE receives the REGISTRATION ACCEPT message from a PLMN, then the UE shall reset the PLMN-specific attempt counter for that PLMN for the specific access type for which the message was received. The UE shall also reset the PLMN-specific N1 mode attempt counter for that PLMN for the specific access type for which the message was received. If the message was received via 3GPP access, the UE shall reset the counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"SIM/USIM considered invalid for non-GPRS services\", if any. If the message was received via non-3GPP access, the UE shall reset the counter for \"USIM considered invalid for 5GS services over non-3GPP\" events.\nIf the UE receives the REGISTRATION ACCEPT message from an SNPN, then the UE shall reset the SNPN-specific attempt counter for the current SNPN for the specific access type for which the message was received. If the message was received via 3GPP access, the UE shall reset the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events. If the message was received via non-3GPP access, the UE shall reset the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events.\nIf the REGISTRATION ACCEPT message included a T3512 value IE, the UE shall use the value in T3512 value IE as periodic registration update timer (T3512). If the T3512 value IE is not included, the UE shall use the value currently stored, e.g. from a prior REGISTRATION ACCEPT message.\nIf the REGISTRATION ACCEPT message include a T3324 value IE, the UE shall use the value in the T3324 value IE as active time timer (T3324). If the REGISTRATION ACCEPT message does not include a T3324 value IE, UE shall not start the timer T3324 until a new value is received from the network.\nIf the REGISTRATION ACCEPT message included a non-3GPP de-registration timer value IE, the UE shall use the value in non-3GPP de-registration timer value IE as non-3GPP de-registration timer. If non-3GPP de-registration timer value IE is not included, the UE shall use the value currently stored, e.g. from a prior REGISTRATION ACCEPT message. If non-3GPP de-registration timer value IE is not included and there is no stored non-3GPP de-registration timer value in the UE, the UE shall use the default value of the non-3GPP de-registration timer.\nIf the REGISTRATION ACCEPT message contains a 5G-GUTI, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the received 5G-GUTI, stop timer T3519 if running, and delete any stored SUCI. The UE shall provide the 5G-GUTI to the lower layer of 3GPP access if the REGISTRATION ACCEPT message is sent over the non-3GPP access, and the UE is in 5GMM-REGISTERED in both 3GPP access and non-3GPP access in the same PLMN.\nIf the REGISTRATION ACCEPT message contains\na)\tthe Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\";\nb)\ta Configured NSSAI IE with a new configured NSSAI for the current PLMN or SNPN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN or SNPN;\nc)\tan NSSRG information IE with a new NSSRG information;\nd)\tan Alternative NSSAI IE with a new alternative NSSAI;\ne)\tan S-NSSAI location validity information in the Registration accept type 6 IE container IE with a new S-NSSAI location validity information; or\nf)\tan S-NSSAI time validity information IE with a new S-NSSAI time validity information,\nthe UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge the successful update of the network slicing information. If the UE has set the RCMAN bit to \"Sending of REGISTRATION COMPLETE message for NSAG information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and if REGISTRATION ACCEPT message contains the NSAG information IE, the UE shall return REGISTRATION COMPLETE message to the AMF to acknowledge the reception of the NSAG information IE.\nNOTE\u00a07B:\tWhen the UE receives the NSSRG information IE, the UE may provide the NSSRG information to lower layers for the purpose of NSAG-aware cell reselection.\nIf the REGISTRATION ACCEPT message contains the CAG information list IE or the Extended CAG information list IE and the UE had set the CAG bit to \"CAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the UE shall:\na)\treplace the \"CAG information list\" stored in the UE with the received CAG information list IE or the Extended CAG information list IE when received in the HPLMN or EHPLMN;\nb)\treplace the serving VPLMN's entry of the \"CAG information list\" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; or\nNOTE\u00a07:\tWhen the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored.\nc)\tremove the serving VPLMN's entry of the \"CAG information list\" stored in the UE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry.\nThe UE shall store the \"CAG information list\" received in the CAG information list IE or the Extended CAG information list IE as specified in annex\u00a0C.\nIf the received \"CAG information list\" includes an entry containing the identity of the registered PLMN, the UE shall operate as follows.\na)\tif the UE receives the REGISTRATION ACCEPT message via a CAG cell,none of the CAG-ID(s) supported by the current CAG cell is authorized based on the \"Allowed CAG list\" of the entry for the registered PLMN in the received \"CAG information list\", and:\n1)\tthe entry for the registered PLMN in the received \"CAG information list\" does not include an \"indication that the UE is only allowed to access 5GS via CAG cells\", then the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\"; or\n2)\tthe entry for the registered PLMN in the received \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and:\ni)\tif one or more CAG-ID(s) are authorized based on the \"Allowed CAG list\" of the entry for the registered PLMN in the received \"CAG information list\", the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] with the updated \"CAG information list\"; or\nii)\tif no CAG-ID is authorized based on the \"Allowed CAG list\" of the entry for the registered PLMN in the received \"CAG information list\" and:\nA)\tthe UE does not have an emergency PDU session, then the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP TS 23.122 [5] with the updated \"CAG information list\"; or\nB)\tthe UE has an emergency PDU session, then the UE shall perform a local release of all PDU sessions associated with 3GPP access except for the emergency PDU session and enter the state 5GMM-REGISTERED.LIMITED-SERVICE; or\nb)\tif the UE receives the REGISTRATION ACCEPT message via a non-CAG cell and the entry for the registered PLMN in the received \"CAG information list\" includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and:\n1)\tif one or more CAG-ID(s) are authorized based on the \"allowed CAG list\" for the registered PLMN in the received \"CAG information list\", the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] with the updated \"CAG information list\"; or\n2)\tif no CAG-ID is authorized based on the \"Allowed CAG list\" of the entry for the registered PLMN in the received \"CAG information list\" and:\ni)\tthe UE does not have an emergency PDU session, then the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP TS 23.122 [5] with the updated \"CAG information list\"; or\nii)\tthe UE has an emergency PDU session, then the UE shall perform a local release of all PDU sessions associated with 3GPP access except for the emergency PDU session and enter the state 5GMM-REGISTERED.LIMITED-SERVICE.\nIf the received \"CAG information list\" does not include an entry containing the identity of the registered PLMN and the UE receives the REGISTRATION ACCEPT message via a CAG cell, the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\".\nIf the REGISTRATION ACCEPT message contains the Operator-defined access category definitions IE, the Extended emergency number list IE, the CAG information list IE or the Extended CAG information list IE, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the operator-defined access category definitions or the extended local emergency numbers list or the CAG information list.\nIf the UE has set the RCMAP bit to \" Sending of REGISTRATION COMPLETE message for negotiated PEIPS assistance information supported \" in the 5GMM capability IE of the REGISTRATION REQUEST message and if REGISTRATION ACCEPT message contains the Negotiated PEIPS assistance information IE, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the Negotiated PEIPS assistance information IE.\nIf the REGISTRATION ACCEPT message contains the UE radio capability ID IE or the UE radio capability ID deletion indication IE, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the UE radio capability ID IE or the UE radio capability ID deletion indication IE.\nIf the T3448 value IE is present in the received REGISTRATION ACCEPT message and the value indicates that this timer is neither zero nor deactivated, the UE shall:\na)\tstop timer T3448 if it is running; and\nb)\tstart timer T3448 with the value provided in the T3448 value IE.\nIf the UE is using 5GS services with control plane CIoT 5GS optimization, the T3448 value IE is present in the REGISTRATION ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall ignore the T3448 value IE and proceed as if the T3448 value IE was not present.\nIf the UE in 5GMM-IDLE mode initiated the registration procedure for mobility and periodic registration update and the REGISTRATION ACCEPT message does not include the T3448 value IE and if timer T3448 is running, then the UE shall stop timer T3448.\nUpon receiving a REGISTRATION COMPLETE message, the AMF shall stop timer T3550 and change to state 5GMM-REGISTERED. The 5G-GUTI, if sent in the REGISTRATION ACCEPT message, shall be considered as valid, the PEIPS assistance information, if sent in the REGISTRATION ACCEPT message, shall be considered as valid, and the UE radio capability ID, if sent in the REGISTRATION ACCEPT message, shall be considered as valid.\nIf the 5GS update type IE was included in the REGISTRATION REQUEST message with the SMS requested bit set to \"SMS over NAS supported\" and:\na)\tthe SMSF address is stored in the UE 5GMM context and:\n1)\tthe UE is considered available for SMS over NAS; or\n2)\tthe UE is considered not available for SMS over NAS and the SMSF has confirmed that the activation of the SMS service is successful; or\nb)\tthe SMSF address is not stored in the UE 5GMM context, the SMSF selection is successful and the SMSF has confirmed that the activation of the SMS service is successful;\nthen the AMF shall set the SMS allowed bit of the 5GS registration result IE in the REGISTRATION ACCEPT message as specified in subclause\u00a05.5.1.2.4. If the UE 5GMM context does not contain an SMSF address or the UE is not considered available for SMS over NAS, then the AMF shall:\na)\tstore the SMSF address in the UE 5GMM context if not stored already; and\nb)\tstore the value of the SMS allowed bit of the 5GS registration result IE in the UE 5GMM context and consider the UE available for SMS over NAS.\nIf SMSF selection in the AMF or SMS activation via the SMSF is not successful, or the AMF does not allow the use of SMS over NAS, then the AMF shall set the SMS allowed bit of the 5GS registration result IE to \"SMS over NAS not allowed\" in the REGISTRATION ACCEPT message.\nIf the 5GS update type IE was included in the REGISTRATION REQUEST message with the SMS requested bit set to \"SMS over NAS not supported\" or the 5GS update type IE was not included in the REGISTRATION REQUEST message, then the AMF shall:\na)\tmark the 5GMM context to indicate that the UE is not available for SMS over NAS; and\nNOTE\u00a08:\tThe AMF can notify the SMSF that the UE is deregistered from SMS over NAS based on local configuration.\nb)\tset the SMS allowed bit of the 5GS registration result IE to \"SMS over NAS not allowed\" in the REGISTRATION ACCEPT message.\nWhen the UE receives the REGISTRATION ACCEPT message, if the UE is also registered over another access to the same PLMN, the UE considers the value indicated by the SMS allowed bit of the 5GS registration result IE as applicable for both accesses over which the UE is registered.\nIf the 5GS update type IE was included in the REGISTRATION REQUEST message with the NG-RAN-RCU bit set to \"UE radio capability update needed\", the AMF shall delete the stored UE radio capability information or the UE radio capability ID, if any.\nThe AMF shall include the 5GS registration result IE in the REGISTRATION ACCEPT message. If the 5GS registration result value in the 5GS registration result IE indicates:\na)\t\"3GPP access\", the UE:\n-\tshall consider itself as being registered to 3GPP access; and\n-\tif in 5GMM-REGISTERED state over non-3GPP access and on the same PLMN or SNPN as 3GPP access, shall enter state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over non-3GPP access and set the 5GS update status to 5U2 NOT UPDATED over non-3GPP access; or\nb)\t\"Non-3GPP access\", the UE:\n-\tshall consider itself as being registered to non-3GPP access; and\n-\tif in the 5GMM-REGISTERED state over 3GPP access and is on the same PLMN or SNPN as non-3GPP access, shall enter the state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over 3GPP access and set the 5GS update status to 5U2 NOT UPDATED over 3GPP access; or\nc)\t\"3GPP access and non-3GPP access\", the UE shall consider itself as being registered to both 3GPP access and non-3GPP access.\nIf the UE is not currently registered for emergency services and the emergency registered bit of the 5GS registration result IE in the REGISTRATION ACCEPT message is set to \"Registered for emergency services\", the UE shall consider itself registered for emergency services and shall locally release all non-emergency PDU sessions, if any.\nIn roaming scenarios, the AMF shall provide mapped S-NSSAI(s) for the configured NSSAI, the allowed NSSAI, the partially allowed NSSAI, the rejected NSSAI (if Extended rejected NSSAI IE is used), the partially rejected NSSAI, the pending NSSAI or NSSRG information when included in the REGISTRATION ACCEPT message.\nThe AMF shall include the allowed NSSAI for the current PLMN or SNPN, in roaming scenarios, and shall include the mapped S-NSSAI(s) for the allowed NSSAI contained in the requested NSSAI (i.e. Requested NSSAI IE or Requested mapped NSSAI IE) from the UE, in the REGISTRATION ACCEPT message if the UE included the requested NSSAI in the REGISTRATION REQUEST message and the AMF allows one or more S-NSSAIs for the current PLMN or SNPN in the Requested NSSAI IE or one or more mapped S-NSSAIs in the Requested NSSAI IE or Requested mapped NSSAI IE. Additionally, if the AMF allows one or more subscribed S-NSSAIs for the UE, the AMF may include the allowed subscribed S-NSSAI(s) in the allowed NSSAI in the REGISTRATION ACCEPT message. The S-NSSAI associated with each of the active PDN connections for which interworking to 5GS is supported, shall be included in the allowed NSSAI if the UE included the UE status IE with the EMM registration status set to \"UE is in EMM-REGISTERED state\" in the REGISTRATION REQUEST message and the AMF supports N26 interface.\nThe AMF may also include rejected NSSAI in the REGISTRATION ACCEPT message if the UE is not registered for onboarding services in SNPN. If the UE has set the ER-NSSAI bit to \"Extended rejected NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the rejected NSSAI shall be included in the Extended rejected NSSAI IE in the REGISTRATION ACCEPT message; otherwise the rejected NSSAI shall be included in the Rejected NSSAI IE in the REGISTRATION ACCEPT message. If the UE is registered for onboarding services in SNPN, the AMF shall not include rejected NSSAI in the REGISTRATION ACCEPT message.\nIf the UE has indicated the support for partial network slice and the AMF determines one or more S-NSSAI(s) in the requested NSSAI are to be included in the partially rejected NSSAI as specified in subclause\u00a04.6.2.11, the AMF shall include the Partially rejected NSSAI IE in the Registration accept type 6 IE container IE of the REGISTRATION ACCEPT message.\nIf the UE receives the Partially rejected NSSAI IE in the Registration accept type 6 IE container IE of the REGISTRATION ACCEPT message, the UE shall store the partially rejected NSSAI as specified in subclause\u00a04.6.2.2.\nIf the UE has set the ER-NSSAI bit to \"Extended rejected NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the rejected NSSAI contains S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with rejection cause(s); otherwise the rejected NSSAI contains S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with rejection cause(s) with the following restrictions:\na)\trejected NSSAI for the current PLMN or SNPN shall not include an S-NSSAI for the current PLMN or SNPN which is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are not allowed; and\nb)\trejected NSSAI for the current registration area shall not include an S-NSSAI for the current PLMN or SNPN which is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are not allowed.\nNOTE\u00a09:\tThe UE that does not support extended rejected NSSAI can avoid requesting an S-NSSAI associated with a mapped S-NSSAI, which was included in the previous requested NSSAI but neither in the allowed NSSAI nor in the rejected NSSAI in the consequent registration procedures.\nIf the UE indicated the support for network slice-specific authentication and authorization, and if the requested NSSAI (i.e. the Requested NSSAI IE or the Requested mapped NSSAI IE) includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, the AMF shall in the REGISTRATION ACCEPT message include:\na)\tthe allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s), if any:\ni)\twhich are not subject to network slice-specific authentication and authorization and are allowed by the AMF; or\nii)\tfor which the network slice-specific authentication and authorization has been successfully performed;\naa)\tthe partially allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s), if any:\ni)\twhich are not subject to network slice-specific authentication and authorization and are allowed by the AMF; or\nii)\tfor which the network slice-specific authentication and authorization has been successfully performed;\nb)\toptionally, the rejected NSSAI;\nba)\toptionally, the partially rejected NSSAI;\nc)\tpending NSSAI containing one or more S-NSSAIs for which network slice-specific authentication and authorization (except for re-NSSAA) will be performed or is ongoing, and one or more S-NSSAIs from the pending NSSAI which the AMF provided to the UE during the previous registration procedure for which network slice-specific authentication and authorization will be performed or is ongoing, if any; and\nd)\tthe \"NSSAA to be performed\" indicator in the 5GS registration result IE set to indicate that the network slice-specific authentication and authorization procedure will be performed by the network, if the allowed NSSAI is not included in the REGISTRATION ACCEPT message.\nIf the UE is not registered for onboarding services in SNPN, the UE indicated the support for network slice-specific authentication and authorization, and:\na)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed;\nb)\tall default S-NSSAIs are subject to network slice-specific authentication and authorization; and\nc)\tthe network slice-specific authentication and authorization procedure has not been successfully performed for any of the default S-NSSAIs,\nthe AMF shall in the REGISTRATION ACCEPT message include:\na)\tthe \"NSSAA to be performed\" indicator in the 5GS registration result IE to indicate that the network slice-specific authentication and authorization procedure will be performed by the network; and\nb)\tpending NSSAI containing one or more default S-NSSAIs for which network slice-specific authentication and authorization will be performed or is ongoing and one or more S-NSSAIs from the pending NSSAI which the AMF provided to the UE during the previous registration procedure for which network slice-specific authentication and authorization will be performed or is ongoing (if any); and\nc)\toptionally, the rejected NSSAI.\nIf the UE is not registered for onboarding services in SNPN, the UE indicated the support for network slice-specific authentication and authorization, and:\na)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed; and\nb)\tone or more default S-NSSAIs are not subject to network slice-specific authentication and authorization or the network slice-specific authentication and authorization procedure has been successfully performed for one or more default S-NSSAIs;\nthe AMF shall in the REGISTRATION ACCEPT message include:\na)\tpending NSSAI containing one or more default S-NSSAIs for which network slice-specific authentication and authorization will be performed or is ongoing (if any) and one or more S-NSSAIs from the pending NSSAI which the AMF provided to the UE during the previous registration procedure for which network slice-specific authentication and authorization will be performed or is ongoing (if any);\nb)\tallowed NSSAI containing S-NSSAI(s) for the current PLMN or SNPN each of which corresponds to a default S-NSSAI which are not subject to network slice-specific authentication and authorization or for which the network slice-specific authentication and authorization has been successfully performed;\nc)\tallowed NSSAI containing one or more default S-NSSAIs, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, which are not subject to network slice-specific authentication and authorization or for which the network slice-specific authentication and authorization has been successfully performed; and\nd)\toptionally, the rejected NSSAI; and\ne)\toptionally, the partially rejected NSSAI.\nIf the UE did not include the requested NSSAI in the REGISTRATION REQUEST message or none of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed, the allowed NSSAI shall not contain default S-NSSAI(s) that are subject to NSAC. If the subscription information includes the NSSRG information, the S-NSSAIs of the allowed NSSAI shall be associated with at least one common NSSRG value. If the network has pending NSSAI, the S-NSSAIs in the pending NSSAI and allowed NSSAI shall be associated with at least one common NSSRG value.\nWhen the REGISTRATION ACCEPT includes a pending NSSAI, the pending NSSAI shall contain all S-NSSAIs for which network slice-specific authentication and authorization (except for re-NSSAA) will be performed or is ongoing from the requested NSSAI of the REGISTRATION REQUEST message that was received over the 3GPP access, non-3GPP access, or both the 3GPP access and non-3GPP access.\nIf the UE supports extended rejected NSSAI and the AMF determines that maximum number of UEs reached for all S-NSSAIs in the requested NSSAI as specified in subclause\u00a04.6.2.5, the AMF shall include the rejected NSSAI containing one or more S-NSSAIs with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\" in the Extended rejected NSSAI IE in the REGISTRATION ACCEPT message. In addition, the AMF may include a back-off timer value for each S-NSSAI with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\" included in the Extended rejected NSSAI IE of the REGISTRATION ACCEPT message. To avoid that large numbers of UEs simultaneously initiate deferred requests, the network should select the value for the backoff timer for each S-NSSAI for the informed UEs so that timeouts are not synchronised.\nIf the UE does not indicate support for extended rejected NSSAI and the maximum number of UEs has been reached, the AMF should include the rejected NSSAI containing one or more S-NSSAIs with the rejection cause \"S-NSSAI not available in the current registration area\" in the Rejected NSSAI IE and should not include these S-NSSAIs in the allowed NSSAI in the REGISTRATION ACCEPT message.\nNOTE\u00a010:\tBased on network policies, the AMF can include the S-NSSAI(s) for which the maximum number of UEs has been reached in the rejected NSSAI with rejection causes other than \"S-NSSAI not available in the current registration area\".\nIf the UE indicates the support for network slice usage control and the AMF determines to provide the on-demand NSSAI, the AMF shall include the On-demand NSSAI IE in the REGISTRATION ACCEPT message.\nIf the UE receives the On-demand NSSAI IE in the REGISTRATION ACCEPT message, the UE shall store the on-demand NSSAI as specified in subclause\u00a04.6.2.2. \nIf the AMF has a new configured NSSAI for the current PLMN or SNPN, the AMF shall include the configured NSSAI for the current PLMN or SNPN in the REGISTRATION ACCEPT message.\nNOTE\u00a010A:\tA new configured NSSAI can be available at the AMF following an indication that the subscription data for network slicing has changed.\nThe AMF may include a new configured NSSAI for the current PLMN or SNPN in the REGISTRATION ACCEPT message if:\na)\tthe REGISTRATION REQUEST message did not include a requested NSSAI and the UE is not registered for onboarding services in SNPN;\nb)\tthe REGISTRATION REQUEST message included a requested NSSAI containing an S-NSSAI that is not valid in the serving PLMN or SNPN;\nc)\tthe REGISTRATION REQUEST message included a requested NSSAI containing an S-NSSAI with incorrect mapped S-NSSAI(s);\nd)\tthe REGISTRATION REQUEST message included the Network slicing indication IE with the Default configured NSSAI indication bit set to \"Requested NSSAI created from default configured NSSAI\";\ne)\tthe REGISTRATION REQUEST message included the requested mapped NSSAI; \nf)\tthe S-NSSAIs of the requested NSSAI in the REGISTRATION REQUEST message are not associated with any common NSSRG value, except for the case that the AMF, based on the indication received from the UDM as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8], has provided all subscribed S-NSSAIs in the configured NSSAI to a UE who does not support NSSRG;\nNOTE\u00a011:\tIf the S-NSSAIs of the requested NSSAI in the REGISTRATION REQUEST message are not associated with any common NSSRG value, it is possible that at least one of the S-NSSAIs is not included in any of new allowed NSSAI, new (extended) rejected NSSAI (if applicable), and new pending NSSAI (if applicable).\ng)\tthe UE is in 5GMM-REGISTERED state over the other access and the S-NSSAIs of the requested NSSAI in the REGISTRATION REQUEST message over the current access and the allowed NSSAI over the other access are not associated with any common NSSRG value;\nh)\tthe REGISTRATION REQUEST message included a 5GS mobile identity IE containing a mapped 5G-GUTI and did not include an Additional GUTI IE; or\ni)\tthe REGISTRATION REQUEST message included an Additional GUTI IE containing a valid native 5G-GUTI which was not allocated by the current PLMN or SNPN.\nThe AMF may include a new configured NSSAI for the current PLMN or SNPN in the REGISTRATION ACCEPT message if the REGISTRATION REQUEST message includes a requested NSSAI containing an S-NSSAI and the S-NSSAI time validity information, if available, indicates that the S-NSSAI is not available (see 3GPP\u00a0TS\u00a023.501\u00a0[8]). In this case, if the TempNS bit of the 5GMM capability IE in the REGISTRATION REQUEST message is set to:\na)\t\"S-NSSAI time validity information supported\" and the S-NSSAI time validity information indicates that the S-NSSAI will:\n1)\tbecome available again, then the AMF shall also send S-NSSAI time validity information; or\n2)\tnot become available again, then the AMF shall not include the S-NSSAI in the new configured NSSAI; or\nb)\t\"S-NSSAI time validity information not supported\" and the AMF sends a new configured NSSAI, then the AMF shall not include the S-NSSAI in the new configured NSSAI.\nIf a new configured NSSAI for the current PLMN or SNPN is included and the UE is roaming, the AMF shall also include the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN or SNPN in the REGISTRATION ACCEPT message. In this case the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf a new configured NSSAI for the current PLMN or SNPN is included, the subscription information includes the NSSRG information, and the NSSRG bit in the 5GMM capability IE of the REGISTRATION REQUEST message is set to:\na)\t\"NSSRG supported\", then the AMF shall include the NSSRG information in the REGISTRATION ACCEPT message; or\nb)\t\"NSSRG not supported\", then the configured NSSAI shall include S-NSSAIs each of which is associated with all the NSSRG value(s) of the default S-NSSAI(s), or the configured NSSAI shall include, based on the indication received from the UDM as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8], all subscribed S-NSSAIs even if these S-NSSAIs do not share any common NSSRG value.\nIf the AMF needs to update the NSSRG information and the UE has set the NSSRG bit to \"NSSRG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, then the AMF shall include the new NSSRG information in the REGISTRATION ACCEPT message. In addition, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE supports S-NSSAI time validity information and the AMF needs to update the S-NSSAI time validity information, then the AMF shall include the S-NSSAI time validity information IE in the REGISTRATION ACCEPT message. In addition, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE supports S-NSSAI location validity information and the AMF needs to update the S-NSSAI location validity information, then the AMF shall include the S-NSSAI location validity information IE in the Registration accept type 6 IE container IE of the REGISTRATION ACCEPT message. In addition, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nThe AMF shall include the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\" in the REGISTRATION ACCEPT message if the UDM has indicated that the subscription data for network slicing has changed. In this case the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the S-NSSAI(s) associated with the existing PDU session(s) of the UE is not included in the requested NSSAI (i.e. Requested NSSAI IE or Requested mapped NSSAI IE) of the REGISTRATION REQUEST message, the AMF shall perform a local release of the PDU session(s) associated with the S-NSSAI(s) except for a PDU session associated with DNN and S-NSSAI in the AMF onboarding configuration data and shall request the SMF to perform a local release of those PDU session(s).\nThe UE that has indicated the support for network slice-specific authentication and authorization receiving the pending NSSAI in the REGISTRATION ACCEPT message shall store the S-NSSAI(s) in the pending NSSAI as specified in subclause\u00a04.6.2.2. If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, the UE shall store the received pending NSSAI for each of the equivalent PLMNs as specified in subclause\u00a04.6.2.2. If the pending NSSAI is not included in the REGISTRATION ACCEPT message and the \"NSSAA to be performed\" indicator is not set to \"Network slice-specific authentication and authorization is to be performed\" in the 5GS registration result IE of the REGISTRATION ACCEPT message, then the UE shall delete the pending NSSAI for the current PLMN and its equivalent PLMN(s) or SNPN, if existing, as specified in subclause\u00a04.6.2.2.\nThe UE receiving the rejected NSSAI in the REGISTRATION ACCEPT message takes the following actions based on the rejection cause in the rejected S-NSSAI(s):\n\"S-NSSAI not available in the current PLMN or SNPN\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN or SNPN as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current PLMN or SNPN over any access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\"S-NSSAI not available in the current registration area\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current registration area over the current until switching off the UE, the UE moving out of the current registration area, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\"\n\tThe UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over any access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.1 and 4.6.2.2.\n\"S-NSSAI not available due to maximum number of UEs reached\"\n\tUnless the back-off timer value received along with the S-NSSAI is zero, the UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over the current access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclauses\u00a04.6.1 and\u00a04.6.2.2.\nNOTE\u00a012:\tIf the back-off timer value received along with the S-NSSAI in the rejected NSSAI for the maximum number of UEs reached is zero as specified in subclause\u00a010.5.7.4a of 3GPP\u00a0TS\u00a024.008\u00a0[12], the UE does not consider the S-NSSAI as the rejected S-NSSAI.\nIf there is one or more S-NSSAIs in the rejected NSSAI with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\", then for each S-NSSAI, the UE shall behave as follows:\na)\tstop the timer T3526 associated with the S-NSSAI, if running;\nb)\tstart the timer T3526 with:\n1)\tthe back-off timer value received along with the S-NSSAI, if a back-off timer value is received along with the S-NSSAI that is neither zero nor deactivated; or\n2)\tan implementation specific back-off timer value, if no back-off timer value is received along with the S-NSSAI; and\nc)\tremove the S-NSSAI from the rejected NSSAI for the maximum number of UEs reached when the timer T3526 associated with the S-NSSAI expires.\nIf the UE sets the NSSAA bit in the 5GMM capability IE to \"Network slice-specific authentication and authorization not supported\", and:\na)\tif the Requested NSSAI IE only includes the S-NSSAI(s) subject to network slice-specific authentication and authorization and one or more default S-NSSAIs (containing one or more S-NSSAIs each of which may be associated with a new S-NSSAI) which are not subject to network slice-specific authentication and authorization are available, the AMF shall in the REGISTRATION ACCEPT message include:\n1)\tthe allowed NSSAI or the partially allowed NSSAI containing S-NSSAI(s) for the current PLMN or SNPN each of which corresponds to a default S-NSSAI which are not subject to network slice-specific authentication and authorization;\n2)\tthe allowed NSSAI or the partially allowed NSSAI containing the default S-NSSAIs, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, which are not subject to network slice-specific authentication and authorization; and\n3)\tthe rejected NSSAI containing the S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating \"S-NSSAI not available in the current PLMN or SNPN\", except if the UE has not set the ER-NSSAI bit to \"Extended rejected NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and the S-NSSAI(s) is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are subject to NSSAA; or\nb)\tif the Requested NSSAI IE includes one or more S-NSSAIs subject to network slice-specific authentication and authorization, the AMF shall in the REGISTRATION ACCEPT message include:\n1)\tthe allowed NSSAI or the partially allowed NSSAI containing the S-NSSAI(s) or the mapped S-NSSAI(s) which are not subject to network slice-specific authentication and authorization; and\n2)\tthe rejected NSSAI containing:\ni)\tthe S-NSSAI(s) subject to network slice specific authentication and authorization with the rejection cause indicating \"S-NSSAI not available in the current PLMN or SNPN\", except if the UE has not set the ER-NSSAI bit to \"Extended rejected NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and the S-NSSAI(s) is associated to multiple mapped S-NSSAIs and some of these but not all mapped S-NSSAIs are subject to NSSAA; and\nii)\tthe S-NSSAI(s) which was included in the requested NSSAI but rejected by the network associated with the rejection cause indicating \"S-NSSAI not available in the current PLMN or SNPN\" or the rejection cause indicating \"S-NSSAI not available in the current registration area\", if any.\nFor a REGISTRATION REQUEST message with a 5GS registration type IE indicating \"mobility registration updating\", if the UE does not indicate support for network slice-specific authentication and authorization, the UE is not registered for onboarding services in SNPN, and:\na)\tthe UE is not in NB-N1 mode; and\nb)\tif:\n1)\tthe UE did not include the requested NSSAI in the REGISTRATION REQUEST message; or\n2)\tnone of the S-NSSAIs in the requested NSSAI in the REGISTRATION REQUEST message are allowed;\nand one or more default S-NSSAIs which are not subject to network slice-specific authentication and authorization are available, the AMF shall:\na)\tput the allowed S-NSSAI(s) for the current PLMN or SNPN each of which corresponds to a default S-NSSAI and not subject to network slice-specific authentication and authorization in the allowed NSSAI of the REGISTRATION ACCEPT message;\nb)\tput the default S-NSSAIs and not subject to network slice-specific authentication and authorization, as the mapped S-NSSAI(s) for the allowed NSSAI in roaming scenarios, in the allowed NSSAI of the REGISTRATION ACCEPT message; and\nc)\tdetermine a registration area such that all S-NSSAIs of the allowed NSSAI are available in the registration area.\nDuring a registration procedure for mobility and periodic registration update for which the 5GS registration type IE indicates:\na)\t\"periodic registration updating\"; or\nb)\t\"mobility registration updating\" and the UE is in NB-N1 mode;\nand the UE is not registered for onboarding services in SNPN, the AMF:\na)\tmay provide a new allowed NSSAI, a new partially allowed NSSAI, or both to the UE;\nb)\tshall provide a pending NSSAI to the UE if the UE has indicated the support for network slice-specific authentication and authorization and there are S-NSSAIs for which network slice-specific authentication and authorization (except for re-NSSAA) will be performed or is ongoing for the current PLMN or SNPN; or\nc)\tmay provide both a new allowed NSSAI and a pending NSSAI to the UE;\nin the REGISTRATION ACCEPT message. Additionally, if a pending NSSAI is provided without an allowed NSSAI and no S-NSSAI is currently allowed for the UE, the REGISTRATION ACCEPT message shall include the 5GS registration result IE with the \"NSSAA to be performed\" indicator set to \"Network slice-specific authentication and authorization is to be performed\".\nIf the REGISTRATION ACCEPT message contains the Network slicing indication IE with the Network slicing subscription change indication set to \"Network slicing subscription changed\", the UE shall delete the network slicing information for each and every PLMN or SNPN except for the current PLMN or SNPN as specified in subclause\u00a04.6.2.2 and remove all tracking areas from the list of \"5GS forbidden tracking areas for roaming\" which were added due to rejection of S-NSSAI due to \"S-NSSAI not available in the current registration area\".\nIf the REGISTRATION ACCEPT message contains the allowed NSSAI, then the UE shall store the included allowed NSSAI together with the PLMN identity of the registered PLMN or the SNPN identity of the registered SNPN and the registration area as specified in subclause\u00a04.6.2.2. If the registration area contains TAIs belonging to different PLMNs, which are equivalent PLMNs, the UE shall store the received allowed NSSAI in each of allowed NSSAIs which are associated with each of the PLMNs.\nFor each of the PDU session(s) active in the UE:\na)\tiif the allowed NSSAI contains an HPLMN S-NSSAI (e.g., mapped S-NSSAI, in roaming scenarios) matching to the HPLMN S-NSSAI of the PDU session, the UE shall locally update the S-NSSAI associated with the PDU session to the corresponding S-NSSAI received in the allowed NSSAI;\nb)\tif the allowed NSSAI does not contain an HPLMN S-NSSAI (e.g., mapped S-NSSAI, in roaming scenarios) matching to the HPLMN S-NSSAI of the PDU session, the UE may perform a local release of the PDU session except for an emergency PDU session, if any, and except for a PDU session established when the UE is registered for onboarding services in SNPN, if any; and\nc)\tif the partially allowed NSSAI contains an S-NSSAI associated with a PDU session, and the UE is in the TA where the S-NSSAI is not supported:\n1)\tthe UE may initiate:\ni)\tthe PDU session release procedure; or\nii)\t\tthe PDU session modification procedure to set the 3GPP PS data off status to \"deactivated\" as specified in 3GPP\u00a0TS\u00a024.008\u00a0[13]; and\n2)\tthe SMF may initiate the PDU session release procedure.\nNOTE\u00a013:\tAccording to 3GPP\u00a0TS\u00a023.501\u00a0[8], also the AMF will determine which PDU sessions can no longer be supported based on the new allowed NSSAI, and it will cause a release on the UE side either by indicating in the PDU session status IE which PDU sessions are inactive on the network side or by triggering the SMF to initiate a release via 5GSM signalling.\nIf the REGISTRATION ACCEPT message contains a configured NSSAI IE with a new configured NSSAI for the current PLMN or SNPN and optionally the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN or SNPN, the UE shall store the contents of the configured NSSAI IE as specified in subclause\u00a04.6.2.2. In addition, if the REGISTRATION ACCEPT message contains:\na)\tan NSSRG information IE, the UE shall store the contents of the NSSRG information IE as specified in subclause\u00a04.6.2.2. If the UE receives a Configured NSSAI IE in the REGISTRATION ACCEPT message and no NSSRG information IE, the UE shall delete any stored NSSRG information, if any, as specified in subclause\u00a04.6.2.2;\nb)\tan S-NSSAI location validity information IE in the Registration accept type 6 IE container IE, the UE shall store the contents of the S-NSSAI location validity information as specified in subclause\u00a04.6.2.2. If the UE receives a Configured NSSAI IE in the REGISTRATION ACCEPT message and no S-NSSAI location validity information IE, the UE shall delete any stored S-NSSAI location validity information as specified in subclause\u00a04.6.2.2;\nc)\tan S-NSSAI time validity information IE, the UE shall store the contents of the S-NSSAI time validity information IE as specified in subclause\u00a04.6.2.2. If the UE receives a Configured NSSAI IE in the REGISTRATION ACCEPT message and no S-NSSAI time validity information IE, the UE shall delete any stored S-NSSAI time validity information as specified in subclause\u00a04.6.2.2; or\nd)\tan On-demand NSSAI IE, the UE shall store the contents of the On-demand NSSAI IE as specified in subclause\u00a04.6.2.2. If the UE receives a Configured NSSAI IE in the REGISTRATION ACCEPT message and no On-demand NSSAI IE, the UE shall delete any stored on-demand NSSAI as specified in subclause\u00a04.6.2.2. The UE shall stop any slice deregistration inactivity timer associated with an S-NSSAI which is deleted from the on-demand NSSAI.\nIf the UE has set the NSAG bit to \"NSAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message over 3GPP access, the AMF may include the NSAG information IE in the REGISTRATION ACCEPT message. Up to 4 NSAG entries are allowed to be associated with a TAI list in the NSAG information IE. If the UE has set the RCMAN bit to \"Sending of REGISTRATION COMPLETE message for NSAG information supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and if the NSAG information IE is included in the REGISTRATION ACCEPT message, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nNOTE\u00a013A:\tHow the AMF selects NSAG entries to be included in the NSAG information IE is implementation specific, e.g. take the NSAG priority and the current registration area into account.\nNOTE\u00a013B:\tIf the NSAG for the PLMN and its equivalent PLMN(s) have different associations with S-NSSAIs, then the AMF includes a TAI list for the NSAG entry in the NSAG information IE.\nNOTE\u00a013C:\tIf the NSAG for the PLMN and its equivalent PLMN(s) have different associations with S-NSSAIs, then the AMF includes a TAI list for the NSAG entry in the NSAG information IE.\nIf the UE receives the NSAG information IE in the REGISTRATION ACCEPT message, the UE shall store the NSAG information as specified in subclause\u00a04.6.2.2.\nIf the UE supports network slice replacement and the AMF determines to provide the mapping information between the S-NSSAI to be replaced and the alternative S-NSSAI to the UE, then the AMF shall include the Alternative NSSAI IE, the Allowed NSSAI IE including the alternative S-NSSAI, if not included in the current allowed NSSAI, and the Configured NSSAI IE including the alternative S-NSSAI, if not included in the current configured NSSAI, in the REGISTRATION ACCEPT message. If the AMF determines that the S-NSSAI which has been replaced is available, then the AMF shall provide the updated alternative NSSAI excluding the S-NSSAI which has been replaced and the corresponding alternative S-NSSAI in the Alternative NSSAI IE in the REGISTRATION ACCEPT message. If the AMF determines that all the S-NSSAI(s) which have been replaced are available, then the AMF shall provide the Alternative NSSAI IE with Length of Alternative NSSAI contents set to 0 in the REGISTRATION ACCEPT message. In addition, the AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in subclause\u00a05.1.3.2.3.3.\nIf the UE receives the Alternative NSSAI IE in the REGISTRATION ACCEPT message, the UE shall store the alternative NSSAI as specified in subclause\u00a04.6.2.2.\nIf the UE has indicated the support for partial network slice and the AMF determines one or more S-NSSAI(s) in the requested NSSAI are to be included in the partially allowed NSSAI as specified in subclause\u00a04.6.2.11, the AMF shall include the Partially allowed NSSAI IE in the Registration accept type 6 IE container IE of the REGISTRATION ACCEPT message.\nIf the UE receives the Partially allowed NSSAI IE in the Registration accept type 6 IE container IE of the REGISTRATION ACCEPT message, the UE shall store the partially allowed NSSAI as specified in subclause\u00a04.6.2.2.\nIf the REGISTRATION ACCEPT message:\na)\tincludes the 5GS registration result IE with the \"NSSAA to be performed\" indicator set to \"Network slice-specific authentication and authorization is to be performed\";\nb)\tincludes a pending NSSAI;\nc)\tdoes not include an allowed NSSAI;\nd)\tdoes not include a partially allowed NSSAI;\nthe UE:\na)\tshall not perform the registration procedure for mobility and periodic registration update with the Uplink data status IE except for emergency services;\nb)\tshall not initiate a service request procedure except for emergency services, for responding to paging or notification over non-3GPP access, for cases f), i), m) and o) in subclause\u00a05.6.1.1;\nc)\tshall not initiate a 5GSM procedure except for emergency services, indicating a change of 3GPP PS data off UE status, or to request the release of a PDU session; and\nd)\tshall not initiate the NAS transport procedure except for sending a CIoT user data container, SMS, an LPP message, a UPP-CMI container, an SLPP message, a location services message, an SOR transparent container, a UE policy container or a UE parameters update transparent container;\nuntil the UE receives an allowed NSSAI, a partially allowed NSSAI, or both.\nDuring a registration procedure for mobility and periodic registration update for which the 5GS registration type IE indicates:\na)\t\"mobility registration updating\" and the UE is in NB-N1 mode; or\nb)\t\"periodic registration updating\";\nif the REGISTRATION ACCEPT message includes the 5GS registration result IE with the \"NSSAA to be performed\" indicator not set to \"Network slice-specific authentication and authorization is to be performed\" and the message does not contain an allowed NSSAI and no new allowed NSSAI, the UE shall consider the previously received allowed NSSAI as valid.\nDuring a registration procedure for mobility and periodic registration update for which the 5GS registration type IE indicates:\na)\t\"mobility registration updating\"; or\nb)\t\"periodic registration updating\";\nif the REGISTRATION ACCEPT message includes the 5GS registration result IE with the \"NSSAA to be performed\" indicator set to \"Network slice-specific authentication and authorization is to be performed\" and the message contains a pending NSSAI, the UE shall delete any stored allowed NSSAI as specified in subclause\u00a04.6.2.2.\nIf the Uplink data status IE is included in the REGISTRATION REQUEST message:\na)\tif the AMF determines that the UE is in non-allowed area or is not in allowed area, and the PDU session(s) indicated by the Uplink data status IE is non-emergency PDU session(s) or the UE is not configured for high priority access in selected PLMN or SNPN, the AMF shall include the PDU session reactivation result IE in the REGISTRATION ACCEPT message indicating that user-plane resources for the corresponding PDU session(s) cannot be re-established, and shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #28 \"Restricted service area\";\nb)\totherwise, the AMF shall:\n1)\tindicate the SMF to re-establish the user-plane resources for the corresponding PDU session;\n2)\tinclude PDU session reactivation result IE in the REGISTRATION ACCEPT message to indicate the user-plane resources re-establishment result of the PDU sessions for which the UE requested to re-establish the user-plane resources; and\n3)\tdetermine the UE presence in LADN service area (see subclause\u00a06.2.6) and forward the UE presence in LADN service area towards the SMF, if the corresponding PDU session is a PDU session for LADN.\nIf the Uplink data status IE is not included in the REGISTRATION REQUEST message and the REGISTRATION REQUEST message is sent for the trigger d) in subclause\u00a05.5.1.3.2, the AMF may indicate the SMF to re-establish the user-plane resources for the PDU sessions.\nIf the registration procedure for mobility registration update is triggered for non-3GPP access path switching from the old non-3GPP access to the new non-3GPP access and there are:\na)\tone or more single access PDU sessions whose user plane resources are associated to the old non-3GPP access but whose PDU session ID(s) are not indicated in the Uplink data status IE in the REGISTRATION REQUEST message; or\nb)\tone or more MA PDU sessions whose PDU session ID(s) are not indicated in the Uplink data status IE in the REGISTRATION REQUEST message;\nthe AMF shall not release those PDU session(s) and shall release the user plane resources of the old non-3GPP access of those PDU session(s), so that the UE or the network can re-establish user-plane resources on the new non-3GPP access by triggering a service request procedure.\nIf a PDU session status IE is included in the REGISTRATION REQUEST message:\na)\tfor single access PDU sessions, the AMF shall:\n1)\tperform a local release of all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE on the AMF side associated with the access type the REGISTRATION REQUEST message is sent over, but are indicated by the UE as being in 5GSM state PDU SESSION INACTIVE. If any of those PDU sessions is associated with one or more MBS multicast sessions, the SMF shall consider the UE as removed from the associated multicast MBS sessions; and\n2)\tinclude a PDU session status IE in the REGISTRATION ACCEPT message to indicate which PDU sessions associated with the access type the REGISTRATION ACCEPT message is sent over are not in 5GSM state PDU SESSION INACTIVE in the AMF; and\nb)\tfor MA PDU sessions:\n1)\tfor all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE and have user plane resources being established or established on the access the REGISTRATION REQUEST message is sent over on the AMF side, but are indicated by the UE as no user plane resources are being established or established:\ni)\tfor PDU sessions having user plane resources being established or established only on the access the REGISTRATION REQUEST message is sent over, the AMF shall perform a local release of all those PDU sessions. If the MA PDU session is associated with one or more multicast MBS sessions, the SMF shall consider the UE as removed from the associated multicast MBS sessions; and\nii)\tfor PDU sessions having user plane resources being established or established on both accesses, the AMF shall perform a local release on the user plane resources associated with the access type the REGISTRATION REQUEST message is sent over. If the REGISTRATION REQUEST message is sent over 3GPP access and the MA PDU session is associated with one or more multicast MBS sessions, the SMF shall consider the UE as removed from the associated multicast MBS sessions; and\n2)\tthe AMF shall include a PDU session status IE in the REGISTRATION ACCEPT message to indicate which MA PDU sessions having the corresponding user plane resources are being established or established on the AMF side on the access the REGISTRATION ACCEPT message is sent over.\nIf the Allowed PDU session status IE is included in the REGISTRATION REQUEST message, the AMF shall:\na)\tfor a 5GSM message from each SMF that has indicated pending downlink signalling only, forward the received 5GSM message via 3GPP access to the UE after the REGISTRATION ACCEPT message is sent;\nb)\tfor each SMF that has indicated pending downlink data only:\n1)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed if the corresponding PDU session ID(s) are not indicated in the Allowed PDU session status IE; and\n2)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed if the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE.\nc)\tfor each SMF that have indicated pending downlink signalling and data:\n1)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed if the corresponding PDU session ID(s) are not indicated in the Allowed PDU session status IE;\n2)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed if the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE; and\n3)\tdiscard the received 5GSM message for PDU session(s) associated with non-3GPP access; and\nd)\tinclude the PDU session reactivation result IE in the REGISTRATION ACCEPT message to indicate the successfully re-established user-plane resources for the corresponding PDU sessions, if any.\nIf the PDU session reactivation result IE is included in the REGISTRATION ACCEPT message indicating that the user-plane resources have been successfully reactivated for a PDU session that was indicated by the UE in the Allowed PDU session status IE as allowed to be re-established over 3GPP access, the UE considers the corresponding PDU session to be associated with the 3GPP access. If the user-plane resources of a PDU session have been successfully reactivated over the 3GPP access, the AMF and SMF update the associated access type of the corresponding PDU session.\nIf the PDU session reactivation result IE is included in the REGISTRATION ACCEPT message indicating that the user-plane resources cannot be established for a PDU session that was indicated by the UE in the Allowed PDU session status IE as allowed to be re-established over 3GPP access, the UE considers the corresponding PDU session to be associated with the non-3GPP access.\nIf an EPS bearer context status IE is included in the REGISTRATION REQUEST message, the AMF handles the received EPS bearer context status IE as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9].\nIf the EPS bearer context status information is generated for the UE during the inter-system change from S1 mode to N1 mode as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9] and the AMF supports N26 interface, the AMF shall include an EPS bearer context status IE in the REGISTRATION ACCEPT message to indicate the UE which mapped EPS bearer contexts are active in the network.\nIf the user-plane resources cannot be established for a PDU session, the AMF shall include the PDU session reactivation result IE in the REGISTRATION ACCEPT message indicating that user-plane resources for the corresponding PDU session cannot be re-established, and:\na)\tif the user-plane resources cannot be established because the SMF indicated to the AMF that the UE is located out of the LADN service area (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]), the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #43 \"LADN not available\";\nb)\tif the user-plane resources cannot be established because the SMF indicated to the AMF that only prioritized services are allowed (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]), the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #28 \"restricted service area\";\nc)\tif the user-plane resources cannot be established because the SMF indicated to the AMF that the resource is not available in the UPF (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]), the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #92 \"insufficient user-plane resources for the PDU session\";\nd)\tif the user-plane resources cannot be established because the SMF indicated to the AMF that the S-NSSAI associated with the PDU session is unavailable due to NSAC (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]), the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #69 \"insufficient resources for specific slice\"; or\ne)\totherwise, the AMF may include the PDU session reactivation result error cause IE to indicate the cause of failure to re-establish the user-plane resources.\nNOTE\u00a014:\tIt is up to UE implementation when to re-send a request for user-plane re-establishment for the associated PDU session after receiving a PDU session reactivation result error cause IE with a 5GMM cause set to #92 \"insufficient user-plane resources for the PDU session\".\nNOTE\u00a015:\tThe UE can locally start a back-off timer after receiving a PDU session reactivation result error cause IE with a 5GMM cause set to #69 \"insufficient resources for specific slice\". The value of the back-off timer is up to UE implementation. Upon expiry of the back-off timer, the UE can re-send a request for user-plane re-establishment for the associated PDU session.\nIf the AMF needs to initiate PDU session status synchronization the AMF shall include a PDU session status IE in the REGISTRATION ACCEPT message to indicate the UE:\n-\twhich single access PDU sessions associated with the access the REGISTRATION ACCEPT message is sent over are not in 5GSM state PDU SESSION INACTIVE in the AMF; and\n-\twhich MA PDU sessions are not in 5GSM state PDU SESSION INACTIVE and having user plane resources established in the AMF on the access the REGISTRATION ACCEPT message is sent over.\nThe AMF may include the LADN information IE in the REGISTRATION ACCEPT message as described in subclause\u00a05.5.1.2.4. The UE, upon receiving the REGISTRATION ACCEPT message with the LADN information IE, shall delete its old LADN information (if any) and store the received new LADN information.\nIf the UE has set the LADN-DS bit to \"LADN per DNN and S-NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the AMF may include the Extended LADN information IE in the Registration accept type 6 IE container IE in the REGISTRATION ACCEPT message as described in subclause\u00a05.5.1.2.4. The UE, upon receiving the REGISTRATION ACCEPT message with the Registration accept type 6 IE container IE which includes the Extended LADN information IE, shall delete its old extended LADN information (if any) and store the received new extended LADN information.\nIf:\n-\tthe UE does not support LADN per DNN and S-NSSAI;\n-\tthe UE is subscribed to the LADN DNN for a single S-NSSAI only; and\n-\tthe AMF only has the extended LADN information;\nthe AMF may decide to provide the LADN service area for that LADN DNN of the extended LADN information as the LADN information and include the LADN information in the LADN information IE of the CONFIGURATION UPDATE COMMAND message.\nNOTE\u00a015A:\tIf the LADN service area is configured per DNN and S-NSSAI, in order to serve the UEs that do not support LADN per DNN and S-NSSAI, it is recommended that the LADN DNN is only served by a single S-NSSAI.\nNOTE\u00a015B:\tIn case of the UE is subscribed to the LADN DNN for multiple S-NSSAIs, the AMF can treat this as no extended LADN information is available.\nIf the UE does not support LADN per DNN and S-NSSAI and the AMF has neither the LADN information nor the extended LADN information, the AMF shall not provide any LADN information to the UE.\nIf the AMF does not include the LADN information IE or Extended LADN information IE in the Registration accept type 6 IE container IE in the REGISTRATION ACCEPT message during registration procedure for mobility and periodic registration update, the UE shall delete its old LADN information or old extended LADN information respectively.\nIf the PDU session status IE is included in the REGISTRATION ACCEPT message:\na)\tfor single access PDU sessions, the UE shall perform a local release of all those PDU sessions associated with the access type the REGISTRATION ACCEPT message is sent over which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING on the UE side, but are indicated by the AMF as being in 5GSM state PDU SESSION INACTIVE. If a locally released PDU session is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions; and\nb)\tfor MA PDU sessions, for all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE and have the corresponding user plane resources being established or established in the UE on the access the REGISTRATION ACCEPT message is sent over, but are indicated by the AMF as no user plane resources are being established or established:\n1)\tfor MA PDU sessions having the corresponding user plane resources being established or established only on the access the REGISTRATION ACCEPT message is sent over, the UE shall perform a local release of those MA PDU sessions. If a locally released MA PDU session is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions; and\n2)\tfor MA PDU sessions having user plane resources being established or established on both accesses, the UE shall perform a local release on the user plane resources on the access the REGISTRATION ACCEPT message is sent over. If the user plane resources over 3GPP access are released and the MA PDU session is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions.\nIf:\na)\tthe UE included a PDU session status IE in the REGISTRATION REQUEST message;\nb)\tthe UE is operating in the single-registration mode;\nc)\tthe UE is performing inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode; and\nd)\tthe UE has received the IWK N26 bit set to \"interworking without N26 interface supported\";\nthe UE shall ignore the PDU session status IE if received in the REGISTRATION ACCEPT message.\nIf the EPS bearer context status IE is included in the REGISTRATION ACCEPT message, the UE shall locally delete all those QoS flow descriptions and all associated QoS rules, if any, which are associated with inactive EPS bearer contexts as indicated by the AMF in the EPS bearer context status IE.\nIf the UE included S1 mode supported indication in the REGISTRATION REQUEST message, the AMF supporting interworking with EPS shall set the IWK N26 bit to either:\na)\t\"interworking without N26 interface not supported\" if the AMF supports N26 interface; or\nb)\t\"interworking without N26 interface supported\" if the AMF does not support N26 interface\nin the 5GS network feature support IE in the REGISTRATION ACCEPT message.\nThe UE supporting S1 mode shall operate in the mode for inter-system interworking with EPS as follows:\na)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface not supported\", the UE shall operate in single-registration mode;\nb)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface supported\" and the UE supports dual-registration mode, the UE may operate in dual-registration mode; or\nNOTE\u00a016:\tThe registration mode used by the UE is implementation dependent.\nc)\tif the IWK N26 bit in the 5GS network feature support IE is set to \"interworking without N26 interface supported\" and the UE only supports single-registration mode, the UE shall operate in single-registration mode.\nThe UE shall store the received interworking without N26 interface indicator for inter-system change with EPS as specified in annex\u00a0C.1 and treat it as valid in the entire PLMN and its equivalent PLMN(s).\nThe network informs the UE about the support of specific features, such as IMS voice over PS session, location services (5G-LCS), emergency services, emergency services fallback, ATSSS and non-3GPP access path switching, in the 5GS network feature support information element. In a UE with IMS voice over PS session capability, the IMS voice over PS session indicator, Emergency services support indicator and Emergency services fallback indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account when selecting the access domain for voice sessions or calls. When initiating an emergency call, the upper layers take the IMS voice over PS session indicator, Emergency services support indicator and Emergency services fallback indicator into account for the access domain selection. When the UE determines via the IMS voice over PS session indicator that the network does not support IMS voice over PS sessions in N1 mode, then the UE shall not perform a local release of any persistent PDU session if the AMF does not indicate that the PDU session is in 5GSM state PDU SESSION INACTIVE via the PDU session status IE. When the UE determines via the Emergency services support indicator that the network does not support emergency services in N1 mode, then the UE shall not perform a local release of any emergency PDU session if user-plane resources associated with that emergency PDU session are established if the AMF does not indicate that the PDU session is in 5GSM state PDU SESSION INACTIVE via the PDU session status IE. In a UE with LCS capability, location services indicators (5G-LCS) shall be provided to the upper layers. In a UE with the capability for ATSSS, the network support for ATSSS shall be provided to the upper layers. If the UE receives the 5GS network feature support IE with the ATSSS support indicator set to \"ATSSS not supported\", the UE shall perform a local release of the MA PDU session, if any. If a locally released MA PDU session is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions. In a UE that supports non-3GPP access path switching, the network support for non-3GPP access path switching shall be provided to the upper layers. If the UE receives the 5GS network feature support IE with the non-3GPP access path switching bit set to \"non-3GPP access path switching not supported\", the UE shall not perform the registration procedure for mobility registration update for non-3GPP access path switching.\nNOTE\u00a016A:\tIf the UE is registered to different PLMNs over 3GPP and non-3GPP accesses, the UE uses the capability received over non-3GPP access to determine whether to initiate the registration procedure for mobility registration update for non-3GPP path switching.\nThe AMF shall set the EMF bit in the 5GS network feature support IE to:\na)\t\"Emergency services fallback supported in NR connected to 5GCN and E-UTRA connected to 5GCN\" if the network supports the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN or an E-UTRA cell connected to 5GCN;\nb)\t\"Emergency services fallback supported in NR connected to 5GCN only\" if the network supports the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN and does not support the emergency services fallback procedure when the UE is in an E-UTRA cell connected to 5GCN;\nc)\t\"Emergency services fallback supported in E-UTRA connected to 5GCN only\" if the network supports the emergency services fallback procedure when the UE is in an E-UTRA cell connected to 5GCN and does not support the emergency services fallback procedure when the UE is in an NR cell connected to 5GCN; or\nd)\t\"Emergency services fallback not supported\" if network does not support the emergency services fallback procedure when the UE is in any cell connected to 5GCN.\nNOTE\u00a017:\tIf the emergency services are supported in neither the EPS nor the 5GS homogeneously, based onoperator policy, the AMF will set the EMF bit in the 5GS network feature support IE to \"Emergency services fallback not supported\".\nNOTE\u00a018:\tEven though the AMF's support of emergency services fallback is indicated per RAT, the UE's support of emergency services fallback is not per RAT, i.e. the UE's support of emergency services fallback is the same for both NR connected to 5GCN and E-UTRA connected to 5GCN.\nIf the UE indicates support for restriction on use of enhanced coverage in the REGISTRATION REQUEST message and:\na)\tin WB-N1 mode, the AMF decides to restrict the use of CE mode B for the UE, then the AMF shall set the RestrictEC bit to \"CE mode B is restricted\";\nb)\tin WB-N1 mode, the AMF decides to restrict the use of both CE mode A and CE mode B for the UE, then the AMF shall set the RestrictEC bit to \" Both CE mode A and CE mode B are restricted\"; or\nc)\tin NB-N1 mode, the AMF decides to restrict the use of enhanced coverage for the UE, then the AMF shall set the RestrictEC bit to \"Use of enhanced coverage is restricted\",\nin the 5GS network feature support IE in the REGISTRATION ACCEPT message.\nAccess identity 1 is only applicable while the UE is in N1 mode. Access identity 2 is only applicable while the UE is in N1 mode.\nWhen the UE is registered to the same PLMN or SNPN over 3GPP and non-3GPP access, the UE and the AMF maintain one MPS indicator and one MCS indicator that are common to both 3GPP and non-3GPP access. When the UE is registered to different PLMNs or SNPNs over 3GPP access and non-3GPP access, the UE maintains two MPS indicators and two MCS indicators separately for different accesses i.e., an MPS indicator and an MCS indicator for the 3GPP access and another MPS indicator and an MCS indicator for the non-3GPP access. For both 3GPP and non-3GPP access, the access identity is determined according to subclause\u00a04.5.2:\n-\tif the UE is not operating in SNPN access operation mode:\na)\tthe network informs the UE that the use of access identity 1 is valid in the RPLMN or equivalent PLMN by setting the MPS indicator bit of the 5GS network feature support IE to \"Access identity 1 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM;\nb)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access;\n\tthe UE shall act as a UE with access identity 1 configured for MPS, as described in subclause\u00a04.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in all NG-RAN of the registered PLMN and its equivalent PLMNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MPS indicator bit set to \"Access identity 1 not valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access; or\n\tuntil the UE selects a non-equivalent PLMN over 3GPP access;\nb1)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\":\n-\tvia non-3GPP access; or \n-\tvia 3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access;\n\tthe UE shall act as a UE with access identity 1 configured for MPS, as described in subclause\u00a04.5.2, in non-3GPP access of the registered PLMN and its equivalent PLMNs. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in non-3GPP access of the registered PLMN and its equivalent PLMNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MPS indicator bit set to \"Access identity 1 not valid\":\n-\tvia non-3GPP access; or\n-\tvia 3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access; or\n\tuntil the UE selects a non-equivalent PLMN over non-3GPP access;\nc)\tduring ongoing active PDU sessions that were set up relying on the MPS indicator bit being set to \"Access identity 1 valid\", if the network indicates in a registration update that the MPS indicator bit is reset to \"Access identity 1 not valid\", then the UE shall no longer act as a UE with access identity 1 configured for MPS as described in subclause\u00a04.5.2 unless the USIM contains a valid configuration for access identity 1 in RPLMN or equivalent PLMN. In the UE, the ongoing active PDU sessions are not affected by the change of the MPS indicator bit;\nd)\tthe network informs the UE that the use of access identity 2 is valid in the RPLMN or equivalent PLMN by setting the MCS indicator bit of the 5GS network feature support IE to \"Access identity 2 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM;\ne)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access;\n\tthe UE shall act as a UE with access identity 2 configured for MCS, as described in subclause\u00a04.5.2, in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in all NG-RAN of the registered PLMN and its equivalent PLMNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MCS indicator bit set to \"Access identity 2 not valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access; or\n\tuntil the UE selects a non-equivalent PLMN over 3GPP access;\ne1)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\":\n-\tvia non-3GPP access; or\n-\tvia 3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access;\n\tthe UE shall act as a UE with access identity 2 configured for MCS, as described in subclause\u00a04.5.2, in non-3GPP access of the registered PLMN and its equivalent PLMNs. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in non-3GPP access of the registered PLMN and its equivalent PLMNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MCS indicator bit set to \"Access identity 2 not valid\":\n-\tvia non-3GPP access; or\n-\tvia 3GPP access if the UE is registered to the same PLMN over 3GPP access and non-3GPP access; or\n\tuntil the UE selects a non-equivalent PLMN over non-3GPP access; and\nf)\tduring ongoing active PDU sessions that were set up relying on the MCS indicator bit being set to \"Access identity 2 valid\", if the network indicates in a registration update that the MCS indicator bit is reset to \"Access identity 2 not valid\", then the UE shall no longer act as a UE with access identity 2 configured for MCS as described in subclause\u00a04.5.2 unless the USIM contains a valid configuration for access identity 2 in RPLMN or equivalent PLMN. In the UE, the ongoing active PDU sessions are not affected by the change of the MCS indicator bit; or\n-\tif the UE is operating in SNPN access operation mode:\na)\tthe network informs the UE that the use of access identity 1 is valid in the RSNPN or equivalent SNPN by setting the MPS indicator bit of the 5GS network feature support IE to \"Access identity 1 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority information in the user's subscription context obtained from the UDM;\nb)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access; \n\tthe UE shall act as a UE with access identity 1 configured for MPS, as described in subclause\u00a04.5.2A, in all NG-RAN of the registered SNPN and its equivalent SNPNs. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in all NG-RAN of the registered SNPN and its equivalent SNPNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MPS indicator bit set to \"Access identity 1 not valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access; or\n\tuntil the UE selects a non-equivalent SNPN over 3GPP access;\nb1)\tupon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to \"Access identity 1 valid\":\n-\tvia non-3GPP access; or\n-\tvia 3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access;\n\tthe UE shall act as a UE with access identity 1 configured for MPS, as described in subclause\u00a04.5.2A, in non-3GPP access of the registered SNPN and its equivalent SNPNs. The MPS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in non-3GPP access of the registered SNPN and its equivalent SNPNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MPS indicator bit set to \"Access identity 1 not valid\":\n-\tvia non-3GPP access; or\n-\tvia 3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access; or\n\tuntil the UE selects a non-equivalent SNPN over non-3GPP access;\nc)\tduring ongoing active PDU sessions that were set up relying on the MPS indicator bit being set to \"Access identity 1 valid\", if the network indicates in a registration update that the MPS indicator bit is reset to \"Access identity 1 not valid\", then the UE shall no longer act as a UE with access identity 1 configured for MPS as described in subclause\u00a04.5.2A unless the unified access control configuration in the \"list of subscriber data\" stored in the ME (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) indicates the UE is configured for access identity 1 in the RSNPN or equivalent SNPN. In the UE, the ongoing active PDU sessions are not affected by the change of the MPS indicator bit;\nd)\tthe network informs the UE that the use of access identity 2 is valid in the RSNPN or equivalent SNPN by setting the MCS indicator bit of the 5GS network feature support IE to \"Access identity 2 valid\", in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority information in the user's subscription context obtained from the UDM;\ne)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access;\n\tthe UE shall act as a UE with access identity 2 configured for MCS, as described in subclause\u00a04.5.2A, in all NG-RAN of the registered SNPN and its equivalent SNPNs. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in all NG-RAN of the registered SNPN and its equivalent SNPNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MCS indicator bit set to \"Access identity 2 not valid\":\n-\tvia 3GPP access; or\n-\tvia non-3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access; or\n\tuntil the UE selects a non-equivalent SNPN;\ne1)\tupon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to \"Access identity 2 valid\":\n-\tvia non-3GPP access; or\n-\tvia 3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access;\n\tthe UE shall act as a UE with access identity 2 configured for MCS, as described in subclause\u00a04.5.2A, in non-3GPP access of the registered SNPN and its equivalent SNPNs. The MCS indicator bit in the 5GS network feature support IE provided in the REGISTRATION ACCEPT message is valid in non-3GPP access of the registered SNPN and its equivalent SNPNs until the UE receives a REGISTRATION ACCEPT message or a CONFIGURATION UPDATE COMMAND message with the MCS indicator bit set to \"Access identity 2 not valid\":\n-\tvia non-3GPP access; or\n-\tvia 3GPP access if the UE is registered to the same SNPN over 3GPP access and non-3GPP access; or\n\tuntil the UE selects a non-equivalent SNPN over non-3GPP access; and\nf)\tduring ongoing active PDU sessions that were set up relying on the MCS indicator bit being set to \"Access identity 2 valid\", if the network indicates in a registration update that the MCS indicator bit is reset to \"Access identity 2 not valid\", then the UE shall no longer act as a UE with access identity 2 configured for MCS as described in subclause\u00a04.5.2A unless the unified access control configuration in the \"list of subscriber data\" stored in the ME (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) indicates the UE is configured for access identity 2 in the RSNPN or equivalent SNPN. In the UE, the ongoing active PDU sessions are not affected by the change of the MCS indicator bit.\nIf the UE has set the Follow-on request indicator to \"Follow-on request pending\" in the REGISTRATION REQUEST message, or the network has downlink signalling pending, the AMF shall not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the UE is authorized to use V2X communication over PC5 reference point based on:\na)\tat least one of the following bits in the 5GMM capability IE of the REGISTRATION REQUEST message set by the UE, or already stored in the 5GMM context in the AMF during the previous registration procedure as follows:\n1)\tthe V2XCEPC5 bit to \"V2X communication over E-UTRA-PC5 supported\"; or\n2)\tthe V2XCNPC5 bit to \"V2X communication over NR-PC5 supported\"; and\nb)\tthe user's subscription context obtained from the UDM as defined in 3GPP\u00a0TS\u00a023.287\u00a0[6C];\nthe AMF should not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the UE is authorized to use A2X communication over PC5 reference point based on:\na)\tat least one of the following bits in the 5GMM capability IE of the REGISTRATION REQUEST message set by the UE, or already stored in the 5GMM context in the AMF during the previous registration procedure as follows:\n1)\tthe A2XEPC5 bit to \"A2X over E-UTRA-PC5 supported\"; or\n2)\tthe A2XNPC5 bit to \"A2X over NR-PC5 supported\"; and\nb)\tthe user's subscription context obtained from the UDM as defined in 3GPP\u00a0TS\u00a023.256\u00a0[6C];\nthe AMF should not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the UE is authorized to use 5G ProSe services based on:\na)\tat least one of the following bits in the 5GMM capability IE of the REGISTRATION REQUEST message set by the UE, or already stored in the 5GMM context in the AMF during the previous registration procedure as follows:\n1)\tthe 5G ProSe direct discovery bit to \"5G ProSe direct discovery supported\"; or\n2)\tthe 5G ProSe direct communication bit to \"5G ProSe direct communication supported\"; and\nb)\tthe user's subscription context obtained from the UDM as defined in 3GPP\u00a0TS\u00a023.304\u00a0[6E];\nthe AMF should not immediately release the NAS signalling connection after the completion of the registration procedure.\nIf the UE indicates support of ranging and sidelink positioning in the REGISTRATION REQUEST message and the network supports and accepts the use of ranging and sidelink positioning, the AMF shall set the ranging and sidelink positioning supported bit to \"Ranging and sidelink positioning supported\" in the 5GS network feature support IE of the REGISTRATION ACCEPT message.\nIf the UE has included the Non-3GPP path switching information IE in the REGISTRATION REQUEST message with the NSONR bit set to \"non-3GPP path switching while using old non-3GPP resources requested\" and the AMF supports non-3GPP path switching while using old non-3GPP resources , the AMF shall not release the user plane resources of the old non-3GPP access of the PDU sessions supporting non-3GPP access path switching and whose PDU session IDs are included in the Uplink data status IE of the REGISTRATION REQUEST message until the user plane resources of the new non-3GPP access are established. Otherwise, the AMF shall release the user plane resources of the old non-3GPP access before proceeding with the registration procedure.\nIf the UE has triggered the registration procedure for mobility registration update for non-3GPP access path switching from the old non-3GPP access to the new non-3GPP access and the UE receives the REGISTRATION ACCEPT message over the new non-3GPP access, the UE shall consider itself as de-registered for 5GS services over the old non-3GPP access.\nIf the Requested DRX parameters IE was included in the REGISTRATION REQUEST message, the AMF shall include the Negotiated DRX parameters IE in the REGISTRATION ACCEPT message and replace any stored Negotiated DRX parameter and use it for the downlink transfer of signalling and user data. The AMF may set the Negotiated DRX parameters IE based on the received Requested DRX parameters IE and operator policy if available.\nIf the Requested NB-N1 mode DRX parameters IE was included in the REGISTRATION REQUEST message and replace any stored Negotiated NB-N1 mode DRX parameters and use it for the downlink transfer of signalling and user data in NB-N1 mode, the AMF shall include the Negotiated NB-N1 mode DRX parameters IE in the REGISTRATION ACCEPT message. The AMF may set the Negotiated NB-N1 mode DRX parameters IE based on the received Requested NB-N1 mode DRX parameters IE and operator policy if available.\nThe AMF shall include the Negotiated extended DRX parameters IE in the REGISTRATION ACCEPT message only if the Requested extended DRX parameters IE was included in the REGISTRATION REQUEST message, and the AMF supports and accepts the use of eDRX. The AMF may set the Negotiated extended DRX parameters IE based on the received Requested extended DRX parameters IE, operator policy, information from NG-RAN and the user's subscription context obtained from the UDM if available.\nIf the network cannot derive the UE's identity from the 5G-GUTI because of e.g. no matching identity/context in the network, failure to validate the UE's identity due to integrity check failure of the received message, the AMF may operate as described in subclause\u00a05.5.1.2.4 and include a PDU session status IE indicating all PDU sessions are in 5GSM state PDU SESSION INACTIVE in the AMF. If the UE included in the REGISTRATION REQUEST message the UE status IE with the EMM registration status set to \"UE is in EMM-REGISTERED state\" and the AMF does not support N26 interface, the AMF shall operate as described in subclause\u00a05.5.1.2.4.\nIf the UE has indicated support for service gap control in the REGISTRATION REQUEST message, a service gap time value is available in the 5GMM context, the AMF may include the T3447 value IE set to the service gap time value in the REGISTRATION ACCEPT message.\nIf the UE requests ciphering keys for ciphered broadcast assistance data in the REGISTRATION REQUEST message and the AMF has valid ciphering key data applicable to the UE's subscription and current tracking area, then the AMF shall include the ciphering key data in the Ciphering key data IE of the REGISTRATION ACCEPT message.\nIf the UE supports WUS assistance information and the AMF supports and accepts the use of WUS assistance information for the UE, then the AMF shall determine the negotiated UE paging probability information for the UE, store it in the 5GMM context of the UE, and if the UE does not have an active emergency PDU session, the AMF shall include it in the Negotiated WUS assistance information IE in the REGISTRATION ACCEPT message. The AMF may consider the UE paging probability information received in the Requested WUS assistance information IE when determining the negotiated UE paging probability information for the UE.\nNOTE\u00a019:\tBesides the UE paging probability information requested by the UE, the AMF can take local configuration or previous statistical information for the UE into account when determining the negotiated UE paging probability information for the UE.\nIf the UE sets the NR-PSSI bit to \"NR paging subgrouping supported\" in the 5GMM capability IE in the REGISTRATION REQUEST message and the AMF supports and accepts the use of PEIPS assistance information for the UE, then the AMF shall determine the Paging subgroup ID for the UE, store it in the 5GMM context of the UE, and include it in the Negotiated PEIPS assistance information IE in the REGISTRATION ACCEPT message or in the Updated PEIPS assistance information IE in the CONFIGURATION UPDATE COMMAND message as part of the registration procedure. The AMF may consider the UE paging probability information received in the Requested PEIPS assistance information IE when determining the Paging subgroup ID for the UE.\nNOTE\u00a020:\tBesides the UE paging probability information when provided by the UE, the AMF can also take local configuration, whether the UE is likely to receive IMS voice over PS session calls, UE mobility pattern or previous statistical information for the UE or information provided by the NG-RAN into account when determining the Paging subgroup ID for the UE.\nIf the UE set the UN-PER bit to \"unavailability period supported\" in the 5GMM capability IE in the REGISTRATION REQUEST message and the AMF supports and accepts the use of unavailability period for the UE, then the AMF shall set the UN-PER bit to \"unavailability period supported\" in the 5GS network feature support IE in the REGISTRATION ACCEPT message. \nIf the UE set the Unavailability type to \"unavailability due to UE reasons\" in the Unavailability information IE in the REGISTRATION REQUEST message, then the AMF shall:\na1)\tdetermine the Unavailability period duration value as:\n-\tA value that was provided by the UE; or\n-\tA value that was determined by the AMF; and\na2)\tdetermine the Start of the unavailability period duration value as:\n-\tA value that was provided by the UE; or\n-\tA value that was determined by the AMF; and\n\tthe AMF shall store the Start of unavailability period value and the Unavailability period duration. When the time of the Start of unavailability period arrives, the AMF shall consider the UE as unreachable until the UE registers for normal service;\nb)\tstore the received unavailability period duration, if any; and\nc)\trelease the signalling connection immediately after the completion of the registration procedure.\nIf the UE set the Unavailability type to \"unavailability due to discontinuous coverage\" in the Unavailability information IE and the UE provides the Unavailability information IE in the REGISTRATION REQUEST message then:\na)\tif the AMF is able to determine a UE out-of-coverage period based on satellite coverage availability information and the value of the Unavailability information IE in the REGISTRATION REQUEST message if available, the AMF shall store the determined unavailability period duration and provide the expected unavailability period duration to the UE by including the Unavailability period duration in the unavailability configuration IE in the REGISTRATION ACCEPT message. If the AMF is able to determine the start of the unavailability period based on satellite coverage availability information and the value of the Unavailability information IE in the REGISTRATION REQUEST message if available, the AMF shall store the determined start of the unavailability period and provide the expected start of the unavailability period to the UE by including the start of the unavailability period in the Unavailability configuration IE in the REGISTRATION ACCEPT message; and\nb1)\tthe AMF shall determine the unavailability period duration value as:\n-\tA value that was provided by the UE; or\n-\tA value that was determined by the AMF based on satellite coverage availability information; and\nb2)\tthe AMF shall determine the start of the unavailability period value as:\n-\tA value that was provided by the UE; or\n-\tA value that was determined by the AMF based on satellite coverage availability information; and\n\tthe AMF shall store the unavailability period duration and the start of unavailability period value. When the unavailability period starts, the AMF shall consider the UE as unreachable until the UE registers for normal service again;\nc)\tthe AMF shall determine whether the UE is required to perform the registration procedure in NG-RAN satellite access when the unavailability period has ended and set the EURP bit to \"UE needs to report end of unavailability period \" or \"UE does not need to report end of unavailability period\" in the Unavailability configuration IE in the REGISTRATION ACCEPT message.\nThe AMF may determine the periodic registration update timer value based on the stored value of the received unavailability period duration if any, the received Start of unavailability period if any, the network determined unavailability period duration if any and the network determined Start of unavailability period if any. If the UE does not provide the Unavailability information IE in the REGISTRATION REQUEST message, the AMF shall delete any stored value of the Unavailability information IE if exists.\nIf the UE receives the Unavailability configuration IE with a value of the unavailability period duration in the REGISTRATION ACCEPT message, then the UE may either:\na)\tdelete a UE determined value and start using the received value; or\nb)\tuse a UE determined value with or without taking into consideration the received value.\nIf the UE receives the Unavailability configuration IE with a value of the start of the unavailability period in the REGISTRATION ACCEPT message, then the UE may either:\na)\tdelete a UE determined value and start using the received value; or\nb)\tuse a UE determined value with or without taking into consideration the received value\nIf due to regional subscription restrictions or access restrictions the UE is not allowed to access the TA or due to CAG restrictions the UE is not allowed to access the cell, but the UE has an emergency PDU session established, the AMF may accept the REGISTRATION REQUEST message and indicate to the SMF to perform a local release of all non-emergency PDU sessions (associated with 3GPP access if it is due to CAG restrictions) and informs the UE via the PDU session status IE in the REGISTRATION ACCEPT message. The AMF shall not indicate to the SMF to release the emergency PDU session. If the AMF indicated to the SMF to perform a local release of all non-emergency PDU sessions (associated with 3GPP access if it is due to CAG restrictions), the network shall behave as if the UE is registered for emergency services and shall set the emergency registered bit of the 5GS registration result IE to \"Registered for emergency services\" in the REGISTRATION ACCEPT message.\nIf the REGISTRATION ACCEPT message includes the PDU session reactivation result error cause IE with the 5GMM cause set to #28 \"Restricted service area\", the UE shall enter the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE and behave as specified in subclause\u00a05.3.5.\nIf the REGISTRATION ACCEPT message includes the SOR transparent container IE and:\na)\tthe SOR transparent container IE does not successfully pass the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]); and\nb)\tif the UE attempts obtaining service on another PLMNs or SNPNs as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C;\nthen the UE shall release locally the established NAS signalling connection after sending a REGISTRATION COMPLETE message.\nIf the REGISTRATION ACCEPT message includes the SOR transparent container IE and the SOR transparent container IE successfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]), the ME shall store the received SOR counter as specified in annex\u00a0C and proceed as follows:\na)\tthe UE shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C; and\nb)\tif the registration procedure is performed over 3GPP access and the UE attempts obtaining service on another PLMNs or SNPNs as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C then the UE may release locally the established NAS signalling connection after sending a REGISTRATION COMPLETE message. Otherwise the UE shall send a REGISTRATION COMPLETE message and not release the current N1 NAS signalling connection locally. If an acknowledgement is requested in the SOR transparent container IE of the REGISTRATION ACCEPT message, the UE acknowledgement is included in the SOR transparent container IE of the REGISTRATION COMPLETE message. In the SOR transparent container IE carrying the acknowledgement, the UE shall set the ME support of SOR-CMCI indicator to \"SOR-CMCI supported by the ME\". Additionally, if the UE supports access to an SNPN using credentials from a credentials holder and the UE is not operating in SNPN access operation mode, the UE may set the ME support of SOR-SNPN-SI indicator to \"SOR-SNPN-SI supported by the ME\". Additionally, if the UE supports access to an SNPN providing access for localized services in SNPN, the UE shall set the ME support of SOR-SNPN-SI-LS indicator to \"SOR-SNPN-SI-LS supported by the ME\".\nIf the SOR transparent container IE successfully passes the integrity check (see 3GPP\u00a0TS\u00a033.501\u00a0[24]), and:\na)\tthe SOR transparent container IE indicates a list of preferred PLMN/access technology combinations is provided and the list type indicates \"PLMN ID and access technology list\", then the ME shall replace the highest priority entries in the \"Operator Controlled PLMN Selector with Access Technology\" list stored in the ME and shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C.\n\tIf the SOR-CMCI is present and the Store SOR-CMCI in ME indicator is set to \"Store SOR-CMCI in ME\" then the UE shall store or delete the SOR-CMCI in the non-volatile memory of the ME as described in annex\u00a0C.1;\nb)\tthe list type indicates \"secured packet\", then the ME shall behave as if a SMS is received with protocol identifier set to SIM data download, data coding scheme set to class 2 message and SMS payload as secured packet contents of SOR transparent container IE. The SMS payload is forwarded to UICC as specified in 3GPP\u00a0TS\u00a023.040\u00a0[4A]; or\nc)\tthe SOR transparent container IE indicates \"HPLMN indication that 'no change of the \"Operator Controlled PLMN Selector with Access Technology\" list stored in the UE is needed and thus no list of preferred PLMN/access technology combinations is provided'\", the UE operates in SNPN access operation mode and the SOR transparent container IE includes SOR-SNPN-SI, the ME shall replace SOR-SNPN-SI of the selected entry of the \"list of subscriber data\" or associated with the selected PLMN subscription, as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] with the received SOR-SNPN-SI. Additionally, if the SOR transparent container IE includes SOR-SNPN-SI-LS, the ME shall replace SOR-SNPN-SI-LS of the selected entry of the \"list of subscriber data\" or associated with the selected PLMN subscription, as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] with the received SOR-SNPN-SI-LS.\n\tIf the SOR-CMCI is present and the Store SOR-CMCI in ME indicator is set to \"Store SOR-CMCI in ME\" then the UE shall store or delete the SOR-CMCI in the non-volatile memory of the ME as described in annex\u00a0C.1;\nand the UE shall proceed with the behaviour as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5]\u00a0annex\u00a0C.\nIf the SOR transparent container IE does not pass the integrity check successfully, then the UE shall discard the content of the SOR transparent container IE.\nIf required by operator policy, the AMF shall include the NSSAI inclusion mode IE in the REGISTRATION ACCEPT message (see table\u00a04.6.2.3.1 of subclause\u00a04.6.2.3). Upon receipt of the REGISTRATION ACCEPT message:\na)\tif the message includes the NSSAI inclusion mode IE, the UE shall operate in the NSSAI inclusion mode indicated in the NSSAI inclusion mode IE over the current access within the current PLMN and its equivalent PLMN(s), if any, or the current SNPN, in the current registration area; or\nb)\totherwise:\n1)\tif the UE has NSSAI inclusion mode for the current PLMN or SNPN and access type stored in the UE, the UE shall operate in the stored NSSAI inclusion mode;\n2)\tif the UE does not have NSSAI inclusion mode for the current PLMN or SNPN and the access type stored in the UE and if the UE is performing the registration procedure over:\ni)\t3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0D in the current PLMN or SNPN and the current access type;\nii)\tuntrusted non-3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0C in the current PLMN and the current access type; or\niii)\ttrusted non-3GPP access, the UE shall operate in NSSAI inclusion mode\u00a0D in the current PLMN and the current access type; or\n3)\tif the 5G-RG does not have NSSAI inclusion mode for the current PLMN and wireline access stored in the 5G-RG, and the 5G-RG is performing the registration procedure over wireline access, the 5G-RG shall operate in NSSAI inclusion mode\u00a0B in the current PLMN and the current access type.\nThe AMF may include operator-defined access category definitions in the REGISTRATION ACCEPT message.\nIf there is a running T3447 timer in the AMF and the Uplink data status IE is included or the Follow-on request indicator is set to \"Follow-on request pending\" in the REGISTRATION REQUEST message, the AMF shall ignore the Uplink data status IE or that the Follow-on request indicator is set to \"Follow-on request pending\" and proceed as if the Uplink data status IE was not received or the Follow-on request indicator was not set to \"Follow-on request pending\" except for the following case:\n-\tthe PDU session indicated by the Uplink data status IE is emergency PDU session;\n-\tthe UE is configured for high priority access in selected PLMN;\n-\tthe REGISTRATION REQUEST message is as a paging response; or\n-\tthe UE is establishing an emergency PDU session or performing emergency services fallback.\nIf the UE receives Operator-defined access category definitions IE in the REGISTRATION ACCEPT message and the Operator-defined access category definitions IE contains one or more operator-defined access category definitions, the UE shall delete any operator-defined access category definitions stored for the RPLMN and shall store the received operator-defined access category definitions for the RPLMN. If the UE receives the Operator-defined access category definitions IE in the REGISTRATION ACCEPT message and the Operator-defined access category definitions IE contains no operator-defined access category definitions, the UE shall delete any operator-defined access category definitions stored for the RPLMN. If the REGISTRATION ACCEPT message does not contain the Operator-defined access category definitions IE, the UE shall not delete the operator-defined access category definitions stored for the RPLMN.\nIf the UE has indicated support for service gap control in the REGISTRATION REQUEST message and:\n-\tthe REGISTRATION ACCEPT message contains the T3447 value IE, then the UE shall store the new T3447 value, erase any previous stored T3447 value if exists and use the new T3447 value with the timer T3447 next time it is started; or\n-\tthe REGISTRATION ACCEPT message does not contain the T3447 value IE, then the UE shall erase any previous stored T3447 value if exists and stop the timer T3447 if running.\nIf the REGISTRATION ACCEPT message contains the Truncated 5G-S-TMSI configuration IE, then the UE shall store the included truncated 5G-S-TMSI configuration and return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the truncated 5G-S-TMSI configuration.\nNOTE\u00a021:\tThe UE provides the truncated 5G-S-TMSI configuration to the lower layers.\nIf the UE is not in NB-N1 mode, the UE has set the RACS bit to \"RACS supported\" in the 5GMM Capability IE of the REGISTRATION REQUEST message, and the REGISTRATION ACCEPT message includes:\na)\ta UE radio capability ID deletion indication IE set to \"Network-assigned UE radio capability IDs deletion requested\", the UE shall delete any network-assigned UE radio capability IDs associated with the RPLMN or RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription stored at the UE, then the UE shall initiate a registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3.2 over the existing N1 NAS signalling connection; or\nb)\ta UE radio capability ID IE, the UE shall store the UE radio capability ID as specified in annex\u00a0C.\nIf the registration procedure for mobility and periodic registration update was initiated and there is a request from the upper layers to perform \"emergency services fallback\" pending, the UE shall restart the service request procedure after the successful completion of the mobility and periodic registration update.\nWhen AMF re-allocation occurs in the registration procedure for mobility and periodic registration update, if the new AMF receives in the 5GMM context of the UE the indication that the UE is registered for onboarding services in SNPN, the new AMF may start an implementation specific timer for onboarding services when the registration procedure for mobility and periodic registration update is successfully completed.\nIf the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message and the REGISTRATION ACCEPT message contains the service-level-AA pending indication in the Service-level-AA container IE, the UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge reception of the service-level-AA pending indication, and the UE shall not attempt to perform another registration procedure for UAS services until the UUAA-MM procedure is completed, or to establish a PDU session for USS communication or a PDU session for C2 communication until the UUAA-MM procedure is completed successfully.\nIf the UE has included the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the REGISTRATION REQUEST message and the REGISTRATION ACCEPT message does not contain the service-level-AA pending indication in the Service-level-AA container IE, the UE shall consider the UUAA-MM procedure is not triggered.\nIf the UE is registered for onboarding services in SNPN or the network determines that the UE's subscription only allows for configuration of SNPN subscription parameters in PLMN via the user plane, the AMF may start an implementation specific timer for onboarding services, if not running already, when the network considers that the UE is in 5GMM-REGISTERED (i.e. the network receives the REGISTRATION COMPLETE message from UE).\nNOTE\u00a022:\tIf the AMF considers that the UE is in 5GMM-IDLE, when the implementation specific timer for onboarding services expires and the network considers that the UE is still in state 5GMM-REGISTERED, the AMF can locally de-register the UE; or if the UE is in 5GMM-CONNECTED, the AMF can initiate the network-initiated de-registration procedure (see subclause 5.5.2.3).\nNOTE\u00a023:\tThe value of the implementation specific timer for onboarding services needs to be large enough to allow a UE to complete the configuration of one or more entries of the \"list of subscriber data\" taking into consideration that configuration of SNPN subscription parameters in PLMN via the user plane or onboarding services in SNPN involves third party entities outside of the operator's network.\nIf the UE receives the List of PLMNs to be used in disaster condition IE in the REGISTRATION ACCEPT message and the UE supports MINT, the UE shall delete the \"list of PLMN(s) to be used in disaster condition\" stored in the ME together with the PLMN ID of the RPLMN, if any, and may store the \"list of PLMN(s) to be used in disaster condition\" included in the List of PLMNs to be used in disaster condition IE in the ME together with the PLMN ID of the RPLMN.\nIf the UE receives the Disaster roaming wait range IE in the REGISTRATION ACCEPT message and the UE supports MINT, the UE shall delete the disaster roaming wait range stored in the ME, if any, and store the disaster roaming wait range included in the Disaster roaming wait range IE in the ME.\nIf the UE receives the Disaster return wait range IE in the REGISTRATION ACCEPT message and the UE supports MINT, the UE shall delete the disaster return wait range stored in the ME, if any, and store the disaster return wait range stored included in the Disaster return wait range IE in the ME.\nIf the 5GS registration type IE is set to \"disaster roaming mobility registration updating\" and:\na)\tthe MS determined PLMN with disaster condition IE is included in the REGISTRATION REQUEST message, the AMF shall determine the PLMN with disaster condition in the MS determined PLMN with disaster condition IE;\nb)\tthe MS determined PLMN with disaster condition IE is not included in the REGISTRATION REQUEST message and the Additional GUTI IE is included in the REGISTRATION REQUEST message and contains 5G-GUTI of a PLMN of the country of the PLMN providing disaster roaming, the AMF shall determine the PLMN with disaster condition in the PLMN identity of the 5G-GUTI;\nc)\tthe MS determined PLMN with disaster condition IE and the Additional GUTI IE are not included in the REGISTRATION REQUEST message and:\n1)\tthe 5GS mobile identity IE contains 5G-GUTI of a PLMN of the country of the PLMN providing disaster roaming, the AMF shall determine the PLMN with disaster condition in the PLMN identity of the 5G-GUTI; or\n2)\tthe 5GS mobile identity IE contains SUCI of a PLMN of the country of the PLMN providing disaster roaming, the AMF shall determine the PLMN with disaster condition in the PLMN identity of the SUCI; or\nd)\tthe MS determined PLMN with disaster condition IE is not included in the REGISTRATION REQUEST message, NG-RAN of the PLMN providing disaster roaming broadcasts disaster roaming indication and:\n-\tthe Additional GUTI IE is included in the REGISTRATION REQUEST message and contains 5G-GUTI of a PLMN of a country other than the country of the PLMN providing disaster roaming; or\n-\tthe Additional GUTI IE is not included and the 5GS mobile identity IE contains 5G-GUTI or SUCI of a PLMN of a country other than the country of the PLMN providing disaster roaming;\n\tthe AMF shall determine the PLMN with disaster condition based on the disaster roaming agreement arrangement between mobile network operators.\nNOTE\u00a024:\tThe disaster roaming agreement arrangement between mobile network operators is out scope of 3GPP.\nIf the AMF determines that a disaster condition applies to the PLMN with disaster condition, and the UE is allowed to be registered for disaster roaming services, the AMF shall set the Disaster roaming registration result value bit in the 5GS registration result IE to \"no additional information\" in the REGISTRATION ACCEPT message. If the AMF determines that the UE can be registered to the PLMN for normal service, the AMF shall set the Disaster roaming registration result value bit in the 5GS registration result IE to \"request for registration for disaster roaming service accepted as registration not for disaster roaming service \" in the REGISTRATION ACCEPT message.\nIf the UE indicates \"disaster roaming mobility registration updating\" in the 5GS registration type IE in the REGISTRATION REQUEST message and the 5GS registration result IE value in the REGISTRATION ACCEPT message is set to:\n-\t\"request for registration for disaster roaming service accepted as registration not for disaster roaming service\", the UE shall consider itself registered for normal service. If the PLMN identity of the registered PLMN is a member of the forbidden PLMN list as specified in subclause\u00a05.3.13A, any such PLMN identity shall be deleted from the corresponding list(s). If UE supports S1 mode, the UE shall initiate the registration procedure for mobility and periodic registration update and indicate that S1 mode is supported as described in subclause\u00a05.5.1.3.2; or\n-\t\"no additional information\", the UE shall consider itself registered for disaster roaming.\nIf the UE receives the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE in the REGISTRATION ACCEPT message and the TAI(s) included in the IE is not part of the list of \"5GS forbidden tracking areas for roaming\", the UE shall store the TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE into the list of \"5GS forbidden tracking areas for roaming\" and remove the TAI(s) from the stored TAI list if present.\nIf the UE receives the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE in the REGISTRATION ACCEPT message and the TAI(s) included in the IE is not part of the list of \"5GS forbidden tracking areas for regional provision of service\", the UE shall store the TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE into the list of \"5GS forbidden tracking areas for regional provision of service\" and remove the TAI(s) from the stored TAI list if present.\nIf the ESI bit of the 5GMM capability IE of the REGISTRATION REQUEST message is set to \"equivalent SNPNs supported\", and the serving SNPN changes, the AMF shall indicate the NID of the serving SNPN in the REGISTRATION ACCEPT message. The UE shall determine the SNPN identity of the RSNPN from the NID received in the REGISTRATION ACCEPT message and the MCC and the MNC of the new 5G-GUTI.\nIf the UE supporting the reconnection to the network due to RAN timing synchronization status change receives the RAN timing synchronization IE with the RecReq bit set to \"Reconnection requested\" in the REGISTRATION ACCEPT message, the UE shall operate as specified in subclauses\u00a05.3.1.4, 5.5.1.3.2 and 5.6.1.1.\nIf the UE supports discontinuous coverage, the AMF may include the Discontinuous coverage maximum time offset IE in the REGISTRATION ACCEPT message.\nIf the UE receives, the Discontinuous coverage maximum time offset IE in the REGISTRATION ACCEPT message, the UE shall replace any previously received maximum time offset value on the same satellite NG-RAN RAT type and PLMN with the latest received timer value.\nIf for discontinuous coverage the AMF includes Unavailability configuration IE in the REGISTRATION ACCEPT message and sets the End of unavailability report bit to \u201cUE does not need to report end of unavailability\u201d, the UE is not requied to initiate the registration procedure for mobility registration update when the unavailability period duration has ended.\nIf the UE operating as MBSR receives the MBSRAI field of the Feature authorization indication IE in the REGISTRATION ACCEPT message, the UE NAS layer informs the lower layers of the status of MBSR authorization as specified in clause\u00a05.35A.4 of 3GPP\u00a0TS\u00a023.501\u00a0[8].\n5.5.1.3.5\tMobility and periodic registration update not accepted by the network\nIf the mobility and periodic registration update request cannot be accepted by the network, the AMF shall send a REGISTRATION REJECT message to the UE including an appropriate 5GMM cause value.\nIf the mobility and periodic registration update request is rejected due to general NAS level mobility management congestion control, the network shall set the 5GMM cause value to #22 \"congestion\" and assign a value for back-off timer T3346.\nIn NB-N1 mode, if the mobility and periodic registration update request is rejected due to operator determined barring (see 3GPP\u00a0TS\u00a029.503\u00a0[20AB]), the network shall set the 5GMM cause value to #22 \"congestion\" and assign a value for back-off timer T3346.\nWhen the UE performs inter-system change from S1 mode to N1 mode, if the AMF is informed that verification of the integrity protection of the TRACKING AREA UPDATE REQUEST message included by the UE in the EPS NAS message container IE of the REGISTRATION REQUEST message has failed in the MME, then:\na)\tIf the AMF can retrieve the current 5G NAS security context as indicated by the ngKSI and 5G-GUTI sent by the UE, the AMF shall proceed as specified in subclause\u00a05.5.1.3.4;\nb)\tif the AMF cannot retrieve the current 5G NAS security context as indicated by the ngKSI and 5G-GUTI sent by the UE, or the ngKSI or 5G-GUTI was not sent by the UE, the AMF may initiate the identification procedure by sending the IDENTITY REQUEST message with the \"Type of identity\" of the 5GS identity type IE set to \"SUCI\" before taking actions as specified in subclause\u00a04.4.4.3; or\nc)\tIf the AMF needs to reject the mobility and periodic registration update procedure, the AMF shall send REGISTRATION REJECT message including 5GMM cause #9 \"UE identity cannot be derived by the network\".\nIf the REGISTRATION REJECT message with 5GMM cause #76 or #78 was received without integrity protection, then the UE shall discard the message. If the REGISTRATION REJECT message with 5GMM cause #62 was received without integrity protected, the behaviour of the UE is specified in subclause\u00a05.3.20.2.\nBased on operator policy, if the mobility and periodic registration update request is rejected due to core network redirection for CIoT optimizations, the network shall set the 5GMM cause value to #31 \"Redirection to EPC required\".\nNOTE\u00a01:\tThe network can take into account the UE's S1 mode capability, the EPS CIoT network behaviour supported by the UE or the EPS CIoT network behaviour supported by the EPC to determine the rejection with the 5GMM cause value #31 \"Redirection to EPC required\".\nIf the mobility and periodic registration update request is rejected because:\na)\tall the S-NSSAI(s) included in the requested NSSAI (i.e. Requested NSSAI IE or Requested mapped NSSAI IE) are rejected;\nb)\tthe UE set the NSSAA bit in the 5GMM capability IE to:\n1)\t\"Network slice-specific authentication and authorization supported\" and;\ni)\tvoid;\nii)\tall default S-NSSAIs are not allowed; or\niii)\tnetwork slice-specific authentication and authorization has failed or been revoked for all default S-NSSAIs and based on network local policy, the network decides not to initiate the network slice-specific re-authentication and re-authorization procedures for any default S-NSSAI requested by the UE; or\n2)\t\"Network slice-specific authentication and authorization not supported\" and all subscribed default S-NSSAIs marked as default are either not allowed or are subject to network slice-specific authentication and authorization; and\ni)\tvoid; or\nii)\tvoid; and\nc)\tno emergency PDU session has been established for the UE;\nthe network shall set the 5GMM cause value of the REGISTRATION REJECT message to #62 \"No network slices available\" and shall include, in the rejected NSSAI of the REGISTRATION REJECT message, all the S-NSSAI(s) which were included in the requested NSSAI.\nIf the UE has set the ER-NSSAI bit to \"Extended rejected NSSAI supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the rejected S-NSSAI(s) shall be included in the Extended rejected NSSAI IE of the REGISTRATION REJECT message. Otherwise, the rejected S-NSSAI(s) shall be included in the Rejected NSSAI IE of the REGISTRATION REJECT message.\nIn roaming scenarios, if the Extended rejected NSSAI IE is included in the REGISTRATION REJECT message, the AMF shall provide mapped S-NSSAI(s) for the rejected NSSAI.\nIf the UE supports extended rejected NSSAI and the AMF determines that maximum number of UEs reached for one or more S-NSSAI(s) in the requested NSSAI as specified in subclause\u00a04.6.2.5, the AMF shall include the rejected NSSAI containing one or more S-NSSAIs with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\" in the Extended rejected NSSAI IE in the REGISTRATION REJECT message. In addition, the AMF may include a back-off timer value for each S-NSSAI with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\" in the Extended rejected NSSAI IE of the REGISTRATION REJECT message.\nIf the mobility and periodic registration update request from a UE supporting CAG is rejected due to CAG restrictions, the network shall set the 5GMM cause value to #76 \"Not authorized for this CAG or authorized for CAG cells only\" and should include the \"CAG information list\" in the CAG information list IE or the Extended CAG information list IE in the REGISTRATION REJECT message.\nNOTE\u00a02:\tThe network cannot be certain that \"CAG information list\" stored in the UE is updated as result of sending of the REGISTRATION REJECT message with the CAG information list IE or the Extended CAG information list IE, as the REGISTRATION REJECT message is not necessarily delivered to the UE (e.g due to abnormal radio conditions).\nNOTE\u00a03:\tThe \"CAG information list\" can be provided by the AMF and include no entry if no \"CAG information list\" exists in the subscription.\nNOTE\u00a03A:\tIf the UE supports extended CAG information list, the CAG information list can be included either in the CAG information list IE or Extended CAG information list IE.\nNOTE\u00a03B:\tIt is unexpected for network to send REGISTRATION REJECT message to the UE with 5GMM cause value #76 in non-CAG cell and not indicate \"Indication that the UE is only allowed to access 5GS via CAG cells\" for the serving PLMN in the Extended CAG information list or the CAG information list.\nIf the UE does not support extended CAG information list, the CAG information list shall not be included in the Extended CAG information list IE.\nIf the mobility and periodic registration update request from a UE not supporting CAG is rejected due to CAG restrictions, the network shall operate as described in bullet\u00a0i) of subclause\u00a05.5.1.3.8.\nIf the UE's mobility and periodic registration update request is via a satellite NG-RAN cell and the network determines that the UE is in a location where the network is not allowed to operate, see 3GPP\u00a0TS\u00a023.502\u00a0[9], the network shall set the 5GMM cause value in the REGISTRATION REJECT message to #78 \"PLMN not allowed at the present UE location\".\nNOTE\u00a04:\tWhen the UE accessing network for emergency services, it is up to operator and regulatory policies whether the network needs to determine if the UE is in a location where network is not allowed to operate.\nIf the AMF receives the mobility and periodic registration update request including the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE and the AMF determines that the UE is not allowed to use UAS services via 5GS based on the user's subscription data and the operator policy, the AMF shall return a REGISTRATION REJECT message with 5GMM cause #79 \u201cUAS services not allowed\u201d.\nIf the mobility and periodic registration update request from a UE supporting MINT is rejected due to a disaster condition no longer being applicable in the current location of the UE, the network shall set the 5GMM cause value to #11 \"PLMN not allowed\" or #13 \"Roaming not allowed in this tracking area\" and may include a disaster return wait range in the Disaster return wait range IE in the REGISTRATION REJECT message.\nIf the UE initiates the registration procedure for disaster roaming and the AMF determines that it does not support providing disaster roaming services for the determined PLMN with disaster condition to the UE, then the AMF shall send a REGISTRATION REJECT message with 5GMM cause #80 \u201cDisaster roaming for the determined PLMN with disaster condition not allowed\u201d.\nIf the AMF receives the mobility and periodic registration update request over non-3GPP access and detects that the N3IWF used by the UE is not compatible with the allowed NSSAI and the UE has indicated its support for slice-based N3IWF selection in the REGISTRATION REQUEST message, the AMF may send a REGISTRATION REJECT message with 5GMM cause #81 \"Selected N3IWF is not compatible with the allowed NSSAI\" and may provide information for a suitable N3IWF in the REGISTRATION REJECT message indicating the suitable N3IWF that is compatible with the requested NSSAI.\nIf the AMF receives the mobility and periodic registration update request over non-3GPP access and detects that the TNGF used by the UE is not compatible with the allowed NSSAI and the UE has indicated its support for slice-based TNGF selection in the REGISTRATION REQUEST message, the AMF may send a REGISTRATION REJECT message with 5GMM cause #82 \"Selected TNGF is not compatible with the allowed NSSAI\" and may provide information for a suitable TNAN in the TNAN information IE in the REGISTRATION REJECT message indicating the suitable TNGF that is compatible with the requested NSSAI.\nIf the AMF received multiple TAIs from the satellite NG-RAN as described in 3GPP\u00a0TS\u00a023.501\u00a0[8], and determines that, by UE subscription and operator's preferences, all of the received TAIs are forbidden for roaming or for regional provision of service, the AMF shall include the TAI(s) in:\na)\tthe Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE; or\nb)\tthe Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE; or\nc)\tboth;\nin the REGISTRATION REJECT message.\nRegardless of the 5GMM cause value received in the REGISTRATION REJECT message via satellite NG-RAN,\n-\tif the UE receives the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE in the REGISTRATION REJECT message and if the TAI(s) included in the IE is not part of the list of \"5GS forbidden tracking areas for roaming\", the UE shall store the TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE, if not already stored, into the list of \"5GS forbidden tracking areas for roaming\"; and\n-\tif the UE receives the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE in the REGISTRATION REJECT message and if the TAI(s) included in the IE is not part of the list of \"5GS forbidden tracking areas for regional provision of service\", the UE shall store the TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE, if not already stored, into the list of \"5GS forbidden tracking areas for regional provision of service\".\nIn a shared network, the UE shall construct the TAI of the cell from one of the PLMN identities as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] and the TAC received on the broadcast system information. Whenever a REGISTRATION REJECT message is received by the UE:\n-\twith the 5GMM cause #11 \"PLMN not allowed\", the chosen PLMN identity shall be stored in the \"forbidden PLMN list\" and if the UE is configured to use timer T3245 (see 3GPP\u00a0TS\u00a024.368\u00a0[17] or 3GPP\u00a0TS\u00a031.102\u00a0[22]) then the UE shall start timer T3245 and proceed as described in subclause\u00a05.3.19A;\n-\twith the 5GMM cause #12 \"tracking area not allowed\", #13 \"roaming not allowed in this tracking area\", #15 \"no suitable cells in tracking Area\", or #62 \"No network slices available\", the constructed TAI shall be stored in the suitable list; or\n-\tas a response to registration procedure for mobility registration update initiated in 5GMM-CONNECTED mode, the UE need not update forbidden lists with the selected PLMN identity or the constructed TAI, respectively.\nFurthermore, the UE shall take the following actions depending on the 5GMM cause value received in the REGISTRATION REJECT message.\n#3\t(Illegal UE); or\n#6\t(Illegal ME).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n\tIn case of PLMN, the UE shall consider the USIM as invalid for 5GS services until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.19a.1.\n\tIn case of SNPN, if the UE is not registered for onboarding services in SNPN and the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the UE shall consider the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN as invalid until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause 5.3.19a.2. In case of SNPN, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid for 3GPP access until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause 5.3.19a.2. Additionally, if EAP based primary authentication and key agreement procedure using EAP-AKA' or 5G AKA based primary authentication and key agreement procedure was performed in the current SNPN, the UE shall consider the USIM as invalid for the current SNPN until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.19a.2.\n\tIf the UE is not registered for onboarding services in SNPN, the UE shall delete the list of equivalent PLMNs (if any) or the list of equivalent SNPNs (if any), and shall move to 5GMM-DEREGISTERED.NO-SUPI state. If the message has been successfully integrity checked by the NAS, then the UE shall:\n1)\tset the counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events to UE implementation-specific maximum value in case of PLMN if the UE maintains these counters;\n2)\tset the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events and the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events to UE implementation-specific maximum value in case of SNPN if the UE maintains these counters; and\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause\u00a05.3.7a of 3GPP\u00a0TS\u00a024.301\u00a0[15]. If the UE is in EMM-REGISTERED state, the UE shall move to EMM-DEREGISTERED state. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\n\tIf the UE is registered for onboarding services in SNPN, the UE shall reset the registration attempt counter, store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS, the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value.\n\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#7\t(5GS services not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n\tIn case of PLMN, the UE shall consider the USIM as invalid for 5GS services until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause\u00a05.3.19a.1;\n\tIn case of SNPN, if the UE is not registered for onboarding services in SNPN and the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the UE shall consider the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN as invalid for 5GS services until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause\u00a05.3.19a.2. In case of SNPN, if the UE is not registered for onboarding services in SNPN and the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid for 3GPP access until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause\u00a05.3.19a.2. Additionally, if EAP based primary authentication and key agreement procedure using EAP-AKA' or 5G AKA based primary authentication and key agreement procedure was performed in the current SNPN, the UE shall consider the USIM as invalid for the current SNPN until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause\u00a05.3.19a.2.\n\tIf the UE is not registered for onboarding services in SNPN, the UE shall move to 5GMM-DEREGISTERED.NO-SUPI state. If the message has been successfully integrity checked by the NAS, then the UE shall:\n1)\tset the counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events to UE implementation-specific maximum value in case of PLMN if the UE maintains these counters;\n2)\tset the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events and the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events to UE implementation-specific maximum value in case of SNPN if the UE maintains these counters; and\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n\tIf the UE is registered for onboarding services in SNPN, the UE shall reset the registration attempt counter, store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS, the UE shall set the SNPN-specific attempt counter for the current SNPN to the UE implementation-specific maximum value.\n\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#9\t(UE identity cannot be derived by the network).\n\tThe UE shall set the 5GS update status to 5U2 NOT UPDATED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. The UE shall enter the state 5GMM-DEREGISTERED.\n\tIf the UE has initiated the registration procedure in order to enable performing the service request procedure for emergency services fallback, the UE shall attempt to select an E-UTRA cell connected to EPC or 5GCN according to the domain priority and selection rules specified in 3GPP\u00a0TS\u00a023.167\u00a0[6]. If the UE finds a suitable E-UTRA cell, it then proceeds with the appropriate EMM or 5GMM procedures. If the UE operating in single-registration mode has changed to S1 mode, it shall disable the N1 mode capability for 3GPP access.\n\tIf the rejected request was neither for initiating an emergency PDU session nor for emergency services fallback, the UE shall subsequently, automatically initiate the initial registration procedure.\nNOTE\u00a05:\tUser interaction is necessary in some cases when the UE cannot re-establish the PDU session(s) automatically.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n#10\t(implicitly de-registered).\n\tThe UE shall enter the state 5GMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped 5G NAS security context or partial native 5G NAS security context.\n\tIf the UE has initiated the registration procedure in order to enable performing the service request procedure for emergency services fallback, the UE shall attempt to select an E-UTRA cell connected to EPC or 5GCN according to the domain priority and selection rules specified in 3GPP\u00a0TS\u00a023.167\u00a0[6]. If the UE finds a suitable E-UTRA cell, it then proceeds with the appropriate EMM or 5GMM procedures. If the UE operating in single-registration mode has changed to S1 mode, it shall disable the N1 mode capability for 3GPP access.\n\tIf the rejected request was neither for initiating an emergency PDU session nor for emergency services fallback, the UE shall perform a new registration procedure for initial registration.\nNOTE\u00a06:\tUser interaction is necessary in some cases when the UE cannot re-establish the PDU session(s) automatically.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM state as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n#11\t(PLMN not allowed).\n\tThis cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.3.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. The UE shall store the PLMN identity in the forbidden PLMN list as specified in subclause\u00a05.3.13A and if the UE is configured to use timer T3245 then the UE shall start timer T3245 and proceed as described in subclause\u00a05.3.19a.1, delete the list of equivalent PLMNs, reset the registration attempt counter. For 3GPP access, the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. For non-3GPP access the UE shall enter state 5GMM-DEREGISTERED.LIMITED-SERVICE and perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18]. If the message has been successfully integrity checked by the NAS and the UE maintains the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN, the UE shall set the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN to the UE implementation-specific maximum value.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access to the same PLMN, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n\tIf the UE receives the Disaster return wait range IE in the REGISTRATION REJECT message and the UE supports MINT, the UE shall delete the disaster return wait range stored in the ME, if any, and store the disaster return wait range included in the Disaster return wait range IE in the ME.\n#12\t(Tracking area not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI and ngKSI. Additionally, the UE shall reset the registration attempt counter.\n\tIf:\n1)\tthe UE is not operating in SNPN access operation mode and the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE is not included in the REGISTRATION REJECT message, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for regional provision of service\" and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. If the REGISTRATION REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for regional provision of service\" for non-integrity protected NAS reject message; or\n2)\tthe UE is operating in SNPN access operation mode, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for regional provision of service\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. If the REGISTRATION REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for regional provision of service\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, for non-integrity protected NAS reject message.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n#13\t(Roaming not allowed in this tracking area).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2). If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access the UE shall delete the list of equivalent PLMNs (if available) or the list of equivalent SNPNs (if available). The UE shall reset the registration attempt counter. For 3GPP acess the UE shall change to state 5GMM-REGISTERED.PLMN-SEARCH, and for non-3GPP access the UE shall change to state 5GMM-REGISTERED.LIMITED-SERVICE.\n\tIf the UE is registered in S1 mode and operating in dual-registration mode, the PLMN that the UE chooses to register in is specified in subclause\u00a04.8.3. Otherwise if:\n1)\tthe UE is not operating in SNPN access operation mode and the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE is not included in the REGISTRATION REJECT message, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" and shall remove the current TAI from the stored TAI list if present. If the REGISTRATION REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for non-integrity protected NAS reject message; or\n2)\tthe UE is operating in SNPN access operation mode, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the REGISTRATION REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, for non-integrity protected NAS reject message.\n\tFor 3GPP access the UE shall perform a PLMN selection or SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5], and for non-3GPP access the UE shall perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18].\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n\tIf the UE receives the Disaster return wait range IE in the REGISTRATION REJECT message and the UE supports MINT, the UE shall delete the disaster return wait range stored in the ME, if any, and store the disaster return wait range included in the Disaster return wait range IE in the ME.\n#15\t(No suitable cells in tracking area).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2). The UE shall reset the registration attempt counter and shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE.\n\tIf the UE has initiated the registration procedure in order to enable performing the service request procedure for emergency services fallback, the UE shall attempt to select an E-UTRA cell connected to EPC or 5GC according to the emergency services support indicator (see 3GPP\u00a0TS\u00a036.331\u00a0[25A]). If the UE finds a suitable E-UTRA cell, it then proceeds with the appropriate EMM or 5GMM procedures. If the UE operating in single-registration mode has changed to S1 mode, it shall disable the N1 mode capability for 3GPP access. Otherwise, the UE shall search for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C].\n\tIf:\n1)\tthe UE is not operating in SNPN access operation mode and the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE is not included in the REGISTRATION REJECT message, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" and shall remove the current TAI from the stored TAI list, if present. If the REGISTRATION REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for non-integrity protected NAS reject message; or\n2)\tthe UE is operating in SNPN access operation mode, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, and shall remove the current TAI from the stored TAI list, if present. If the REGISTRATION REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, for non-integrity protected NAS reject message.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n\tIf received over non-3GPP access the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.1.3.7.\n#22\t(Congestion).\n\tIf the T3346 value IE is present in the REGISTRATION REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.1.3.7.\n\tThe UE shall abort the registration procedure for mobility and periodic registration update. If the rejected request was not for initiating an emergency PDU session, the UE shall set the 5GS update status to 5U2 NOT UPDATED, reset the registration attempt counter and change to state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE.\n\tThe UE shall stop timer T3346 if it is running.\n\tIf the REGISTRATION REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the REGISTRATION REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n\tThe UE stays in the current serving cell and applies the normal cell reselection process. The registration procedure for mobility and periodic registration update is started, if still necessary, when timer T3346 expires or is stopped.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n\tIf the registration procedure for mobility and periodic registration update was initiated for an MO MMTEL voice call (i.e. access category 4), or an MO MMTEL video call (i.e. access category 5), or an MO IMS registration related signalling (i.e. access category 9) or for NAS signalling connection recovery during an ongoing MO MMTEL voice call (i.e. access category 4), or during an ongoing MO MMTEL video call (i.e. access category 5) or during an ongoing MO IMS registration related signalling (i.e. access category 9), then a notification that the request was not accepted due to network congestion shall be provided to upper layers.\nNOTE\u00a08:\tUpper layers specified in 3GPP\u00a0TS\u00a024.173\u00a0[13C] and 3GPP\u00a0TS\u00a024.229\u00a0[14] handle the notification that the request was not accepted due to network congestion.\n\tIf the UE is registered for onboarding services in SNPN, the UE may enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n#27\t(N1 mode not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2). Additionally, the UE shall reset the registration attempt counter and shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE. If the message has been successfully integrity checked by the NAS, the UE shall set:\n1)\tthe PLMN-specific N1 mode attempt counter for 3GPP access and the PLMN-specific N1 mode attempt counter for non-3GPP access for that PLMN in case of PLMN; or\n2)\tthe SNPN-specific attempt counter for 3GPP access for the current SNPN and the SNPN-specific attempt counter for non-3GPP access for the current SNPN in case of SNPN;\n\tto the UE implementation-specific maximum value.\n\tThe UE shall disable the N1 mode capability for the specific access type for which the message was received (see subclause\u00a04.9).\n\tIf the message has been successfully integrity checked by the NAS, the UE shall disable the N1 mode capability also for the other access type (see subclause\u00a04.9).\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED. Additionally, the UE shall reset the tracking area updating attempt counter and enter the state EMM-REGISTERED.\n#31\t(Redirection to EPC required).\n\t5GMM cause #31 received by a UE that has not indicated support for CIoT optimizations or not indicated support for S1 mode or received by a UE over non-3GPP access is considered an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.3.7.\n\tThis cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.3.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2). The UE shall reset the registration attempt counter and enter the state 5GMM- REGISTERED.LIMITED-SERVICE.\n\tThe UE shall enable the E-UTRA capability if it was disabled and disable the N1 mode capability for 3GPP access (see subclause\u00a04.9.2).\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n#62\t(No network slices available).\n\tThe UE shall abort the registration procedure for mobility and periodic registration update procedure, set the 5GS update status to 5U2 NOT UPDATED and enter state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE. Additionally, the UE shall reset the registration attempt counter.\n\tThe UE receiving the rejected NSSAI in the REGISTRATION REJECT message takes the following actions based on the rejection cause in the rejected S-NSSAI(s):\n\t\"S-NSSAI not available in the current PLMN or SNPN\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN or SNPN as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current PLMN or SNPN over any access until switching off the UE, the UICC containing the USIM is removed, an entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\t\"S-NSSAI not available in the current registration area\"\n\tThe UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current registration area over the current access until switching off the UE, the UE moving out of the current registration area, the UICC containing the USIM is removed, an entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\t\"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\"\n\tThe UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over any access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.1 and 4.6.2.2.\n\t\"S-NSSAI not available due to maximum number of UEs reached\"\n\tUnless the back-off timer value received along with the S-NSSAI is zero, the UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over the current access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclauses\u00a04.6.1 and\u00a04.6.2.2.\nNOTE\u00a08:\tIf the back-off timer value received along with the S-NSSAI in the rejected NSSAI for the maximum number of UEs reached is zero as specified in subclause\u00a010.5.7.4a of 3GPP\u00a0TS\u00a024.008\u00a0[12], the UE does not consider the S-NSSAI as the rejected S-NSSAI.\n\tIf there is one or more S-NSSAIs in the rejected NSSAI with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\", then for each S-NSSAI, the UE shall behave as follows:\na)\tstop the timer T3526 associated with the S-NSSAI, if running;\nb)\tstart the timer T3526 with:\n1)\tthe back-off timer value received along with the S-NSSAI, if a back-off timer value is received along with the S-NSSAI that is neither zero nor deactivated; or\n2)\tan implementation specific back-off timer value, if no back-off timer value is received along with the S-NSSAI; and\nc)\tremove the S-NSSAI from the rejected NSSAI for the maximum number of UEs reached when the timer T3526 associated with the S-NSSAI expires.\n\tIf the UE has an allowed NSSAI or configured NSSAI and:\n1)\tat least S-NSSAI of the allowed NSSAI or configured NSSAI is not included in the rejected NSSAI, the UE may stay in the current serving cell, apply the normal cell reselection process and start a registration procedure for mobility and periodic registration update with a requested NSSAI that includes any S-NSSAI from the allowed S-NSSAI or the configured NSSAI that is not in the rejected NSSAI.\n2)\tall the S-NSSAI(s) in the allowed NSSAI and configured NSSAI are rejected and at least one S-NSSAI is rejected due to \"S-NSSAI not available in the current registration area\" and:\ni)\tthe REGISTRATION REJECT message is integrity protected, the UE is not operating in SNPN access operation mode and the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE is not included in the REGISTRATION REJECT message and the REGISTRATION REJECT message is received from one of the TAI(s) in the current registration area, the UE shall store the TAI(s) belonging to the registration area in the list of \"5GS forbidden tracking areas for roaming\". If the REGISTRATION REJECT message is received from a TAI not in the current registration area, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\". The UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE. The UE shall search for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C]; or\nii)\tthe REGISTRATION REJECT message is integrity protected and the UE is operating in SNPN access operation mode and the REGISTRATION REJECT message is received from one of the TAI(s) in the current registration area, the UE shall store the TAI(s) belonging to current registration area in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN. If the REGISTRATION REJECT message is received from a TAI not in the current registration area, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\". If the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, and enter the state 5GMM-REGISTERED.LIMITED-SERVICE. The UE shall search for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C].\n3)\totherwise, the UE may perform a PLMN selection or SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5] and additionally, the UE may disable the N1 mode capability for the current PLMN or SNPN if the UE does not have an allowed NSSAI and each S-NSSAI in the configured NSSAI, if available, was rejected with cause \"S-NSSAI not available in the current PLMN or SNPN\" or \"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\" as described in subclause\u00a04.9.\n\tIf the UE has neither allowed NSSAI for the current PLMN or SNPN nor configured NSSAI for the current PLMN or SNPN and,\n1)\tif at least one S-NSSAI in the default configured NSSAI is not rejected, the UE may stay in the current serving cell, apply the normal cell reselection process, and start a registration procedure for mobility and periodic registration update with a requested NSSAI with that default configured NSSAI; or\n2)\tif all the S-NSSAI(s) in the default configured NSSAI are rejected and at least one S-NSSAI is rejected due to \"S-NSSAI not available in the current registration area\",\ni)\tif the REGISTRATION REJECT message is integrity protected and the UE is not operating in SNPN access operation mode and the REGISTRATION REJECT message is received from one of the TAI(s) in the current registration area, the UE shall store the TAI(s) belonging to current registration area in the list of \"5GS forbidden tracking areas for roaming\". If the REGISTRATION REJECT message is received from a TAI not in the current registration area, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\". The UE shall memorize the TAI(s) was stored in the list of \"5GS forbidden tracking areas for roaming\" for S-NSSAI is rejected due to \"S-NSSAI not available in the current registration area\" and enter the state 5GMM-REGISTERED.LIMITED-SERVICE. The UE shall search for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C]; or\nii)\tIf the REGISTRATION REJECT message is integrity protected and the UE is operating in SNPN access operation mode and the REGISTRATION REJECT message is received from one of the TAI(s) in the current registration area, the UE shall store the TAI(s) belonging to current registration area in the list of \"5GS forbidden tracking areas for roaming\". If the REGISTRATION REJECT message is received from a TAI not in the current registration area, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\". The UE shall memorize the TAI(s) was stored in the list of \"5GS forbidden tracking areas for roaming\" for S-NSSAI is rejected due to \"S-NSSAI not available in the current registration area\" for the current SNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, and enter the state 5GMM-REGISTERED.LIMITED-SERVICE. The UE shall search for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C].\n3)\totherwise, the UE may perform a PLMN selection or SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5] and additionally, the UE may disable the N1 mode capability for the current PLMN or SNPN if each S-NSSAI in the default configured NSSAI was rejected with cause \"S-NSSAI not available in the current PLMN or SNPN\" or \"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\" as described in subclause\u00a04.9.\n\tIf\n1)\tthe UE has allowed NSSAI for the current PLMN or SNPN or configured NSSAI for the current PLMN or SNPN or both and all the S-NSSAIs included in the allowed NSSAI or the configured NSSAI or both are rejected; or\n2)\tthe UE has neither allowed NSSAI for the current PLMN or SNPN nor configured NSSAI for the current PLMN or SNPN and all the S-NSSAIs included in the default configured NSSAI are rejected,\n\tand the UE has rejected NSSAI for the maximum number of UEs reached, and the UE wants to obtain services in the current serving cell without performing a PLMN selection or SNPN selection, the UE may stay in the current serving cell and attempt to use the rejected S-NSSAI(s) for the maximum number of UEs reached in the current serving cell after the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU2 NOT UPDATED, reset the tracking area updating attempt counter and enter the state EMM-REGISTERED.\n#72\t(Non-3GPP access to 5GCN not allowed).\n\tWhen received over non-3GPP access the UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI and ngKSI. Additionally, the UE shall reset the registration attempt counter and enter the state 5GMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS, the UE shall set:\n1)\tthe PLMN-specific N1 mode attempt counter for non-3GPP access for that PLMN in case of PLMN; or\n2)\tthe SNPN-specific attempt counter for non-3GPP access for that SNPN in case of SNPN;\n\tto the UE implementation-specific maximum value.\nNOTE\u00a010:\tThe 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses\u00a04.7.2 and 5.1.3).\n\tThe UE shall disable the N1 mode capability for non-3GPP access (see subclause\u00a04.9.3).\n\tAs an implementation option, the UE may enter the state 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf received over 3GPP access the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.1.3.7.\n#73\t(Serving network not authorized).\n\tThis cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.3.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. The UE shall delete the list of equivalent PLMNs, reset the registration attempt counter, store the PLMN identity in the forbidden PLMN list as specified in subclause\u00a05.3.13A. For 3GPP access the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5], and for non-3GPP access the UE shall enter state 5GMM-DEREGISTERED.LIMITED-SERVICE and perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18]. If the message has been successfully integrity checked by the NAS, the UE shall set the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN to the UE implementation-specific maximum value.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED and shall delete any 4G-GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the tracking area updating attempt counter and enter the state EMM-DEREGISTERED.\n#74\t(Temporarily not authorized for this SNPN).\n\t5GMM cause #74 is only applicable when received from a cell belonging to an SNPN. 5GMM cause #74 received from a cell not belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.3.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list ngKSI and the list of equivalent SNPNs (if available). The UE shall reset the registration attempt counter and store the SNPN identity in the \"temporarily forbidden SNPNs\" list or \"temporarily forbidden SNPNs for access for localized services in SNPN\" list if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) for the specific access type for which the message was received and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN using credentials from a credentials holder, the UE shall store the SNPN identity in the \"temporarily forbidden SNPNs\" list along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN providing access for localized services in SNPN and the access for localized services in SNPN has been enabled, the UE shall store the SNPN identity in the list of \"temporarily forbidden SNPNs for access for localized services in SNPN\" (if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE is not registered for onboarding services in SNPN, for 3GPP access the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5] and for non-3GPP access the UE shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE amd perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18]. If the UE is registered for onboarding services in SNPN, the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS, the UE shall set the SNPN-specific attempt counter for 3GPP access and the SNPN-specific attempt counter for non-3GPP access for the current SNPN to the UE implementation-specific maximum value.\n\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access to the same SNPN, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#75\t(Permanently not authorized for this SNPN).\n\t5GMM cause #75 is only applicable when received from a cell belonging to an SNPN with a globally-unique SNPN identity. 5GMM cause #75 received from a cell not belonging to an SNPN or a cell belonging to an SNPN with a non-globally-unique SNPN identity is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.3.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list ngKSI and the list of equivalent SNPNs (if available). The UE shall reset the registration attempt counter and store the SNPN identity in the \"permanently forbidden SNPNs\" or \"permanently forbidden SNPNs for access for localized services in SNPN\" list if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) list for the specific access type for which the message was received and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN using credentials from a credentials holder, the UE shall store the SNPN identity in the \"permanently forbidden SNPNs\" list along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN providing access for localized services in SNPN and the access for localized services in SNPN has been enabled, the UE shall store the SNPN identity in the list of \"permanently forbidden SNPNs for access for localized services in SNPN\" (if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE is not registered for onboarding services in SNPN, for 3GPP access the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5] and for non-3GPP access the UE shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE amd perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18]. If the UE is registered for onboarding services in SNPN, the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS, the UE shall set the SNPN-specific attempt counter for 3GPP access and the SNPN-specific attempt counter for non-3GPP access for the current SNPN to the UE implementation-specific maximum value.\n\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access to the same SNPN, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#76\t(Not authorized for this CAG or authorized for CAG cells only).\n\tThis cause value received via non-3GPP access or from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.3.7.\n\tThe UE shall set the 5GS update status to 5U3.ROAMING NOT ALLOWED, store the 5GS update status according to subclause\u00a05.1.3.2.2, and reset the registration attempt counter.\n\tIf 5GMM cause #76 is received from:\n1)\ta CAG cell, and if the UE receives a \"CAG information list\" in the CAG information list IE or the Extended CAG information list IE included in the REGISTRATION REJECT message, the UE shall:\ni)\treplace the \"CAG information list\" stored in the UE with the received CAG information list IE or the Extended CAG information list IE when received in the HPLMN or EHPLMN;\nii)\treplace the serving VPLMN's entry of the \"CAG information list\" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; or\nNOTE\u00a010:\tWhen the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored.\niii)\tremove the serving VPLMN's entry of the \"CAG information list\" stored in the UE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry.\n\tOtherwise, the UE shall delete the CAG-ID(s) of the cell from the \"allowed CAG list\" for the current PLMN, if the CAG-ID(s) are authorized based on the \"Allowed CAG list\". In the case the \"allowed CAG list\" for the current PLMN only contains a range of CAG-IDs, how the UE deletes the CAG-ID(s) of the cell from the \"allowed CAG list\" for the current PLMN is up to UE implementation. In addition:\ni)\tif the entry in the \"CAG information list\" for the current PLMN does not include an \"indication that the UE is only allowed to access 5GS via CAG cells\" or if the entry in the \"CAG information list\" for the current PLMN includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and one or more CAG-ID(s) are authorized based on the updated \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\";\nii)\tif the entry in the \"CAG information list\" for the current PLMN includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and no CAG-ID is authorized based on the updated \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP TS 23.122 [5] with the updated \"CAG information list\"; or\niii)\tif the \"CAG information list\" does not include an entry for the current PLMN, then the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\".\n2)\ta non-CAG cell, and if the UE receives a \"CAG information list\" in the CAG information list IE or the Extended CAG information list IE included in the REGISTRATION REJECT message, the UE shall:\ni)\treplace the \"CAG information list\" stored in the UE with the received CAG information list IE or the Extended CAG information list IE when received in the HPLMN or EHPLMN;\nii)\treplace the serving VPLMN's entry of the \"CAG information list\" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; or\nNOTE\u00a011:\tWhen the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored.\niii)\tremove the serving VPLMN's entry of the \"CAG information list\" stored in the UE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry.\n\tOtherwise, the UE shall store an \"indication that the UE is only allowed to access 5GS via CAG cells\" in the entry of the \"CAG information list\" for the current PLMN, if any. If the \"CAG information list\" stored in the UE does not include the current PLMN's entry, the UE shall add an entry for the current PLMN to the \"CAG information list\" and store an \"indication that the UE is only allowed to access 5GS via CAG cells\" in the entry of the \"CAG information list\" for the current PLMN. If the UE does not have a stored \"CAG information list\", the UE shall create a new \"CAG information list\" and add an entry with an \"indication that the UE is only allowed to access 5GS via CAG cells\" for the current PLMN.\nIn addition:\ni)\tif one or more CAG-ID(s) are authorized based on the \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] with the updated CAG information; or\nii)\tif no CAG-ID is authorized based on the \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP TS 23.122 [5] with the updated \"CAG information list\".\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED, reset the tracking area updating attempt counter and enter the state EMM-REGISTERED.\n#77\t(Wireline access area not allowed).\n\t5GMM cause #77 is only applicable when received from a wireline access network by the 5G-RG or the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device). 5GMM cause #77 received from a 5G access network other than a wireline access network and 5GMM cause #77 received by the W-AGF acting on behalf of the FN-BRG are considered as abnormal cases and the behaviour of the UE is specified in subclause\u00a05.5.1.3.7.\n\tWhen received over wireline access network, the 5G-RG and the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device) shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2), shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI, shall reset the registration attempt counter, shall enter the state 5GMM-DEREGISTERED and shall act as specified in subclause\u00a05.3.23.\nNOTE\u00a012:\tThe 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses\u00a04.7.2 and 5.1.3).\n#78\t(PLMN not allowed to operate at the present UE location).\n\tThis cause value received from a non-satellite NG-RAN cell is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.3.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI and ngKSI. Additionally, the UE shall reset the registration attempt counter. The UE shall store the PLMN identity and, if it is known, the current geographical location in the list of \"PLMNs not allowed to operate at the present UE location\" and shall start a corresponding timer instance (see subclause\u00a04.23.2). The UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, and tracking area updating attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the normal tracking area updating procedure is rejected with the EMM cause with the same value.\n#79\t(UAS services not allowed).\n\tThe UE shall abort the registration procedure for mobility and periodic registration update procedure, set the 5GS update status to 5U2 NOT UPDATED and enter state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE. Additionally, the UE shall reset the registration attempt counter. The UE may re-attempt the registration procedure to the current PLMN for services other than UAS services and shall not include the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of REGISTRATION REQUEST message unless the UE receives a CONFIGURATION UPDATE COMMAND message including the service-level-AA service status indication in the Service-level-AA container IE with the UAS field set to \"UAS services enabled\".\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU2 NOT UPDATED, reset the tracking area updating attempt counter and enter the state EMM-REGISTERED.\n#80\t(Disaster roaming for the determined PLMN with disaster condition not allowed).\n\tThis cause value received via non-3GPP access or from a cell belonging to an SNPN or when the UE did not indicate \"disaster roaming mobility registration updating\" in the 5GS registration type IE in the REGISTRATION REQUEST message is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.1.3.7.\n\tThe UE shall abort the registration procedure for mobility and periodic registration update procedure, set the 5GS update status to 5U2 NOT UPDATED and enter state 5GMM-REGISTERED. PLMN-SEARCH. Additionally, the UE shall reset the registration attempt counter. The UE shall not attempt to register for disaster roaming on this PLMN for the determined PLMN with disaster condition for a period in the range of 12 to 24 hours. The UE shall not attempt to register for disaster roaming on this PLMN for a period in the range of 3 to 10 minutes. The UE shall perform PLMN selection as described in 3GPP TS 23.122 [6]. If the message has been successfully integrity checked by the NAS and the UE maintains the PLMN-specific attempt counter of the PLMN which sent the reject message for the determined PLMN with disaster condition, the UE shall set the PLMN-specific attempt counter of the PLMN which sent the reject message for the determined PLMN with disaster condition to the UE implementation-specific maximum value.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU2 NOT UPDATED, reset the tracking area updating attempt counter and enter the state EMM-REGISTERED.\n#81\t(Selected N3IWF is not compatible with the allowed NSSAI).\n\tThe UE shall abort the registration procedure for mobility and periodic registration update procedure, set the 5GS update status to 5U2 NOT UPDATED and enter state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION or 5GMM-DEREGISTERED.PLMN-SEARCH. Additionally, the UE shall reset the registration attempt counter. If the N3IWF identifier IE is included in the REGISTRATION REJECT message and the UE supports slice-based N3IWF selection, the UE may use the provided N3IWF identifier IE in N3IWF selection as specified in 3GPP\u00a0TS\u00a024.502\u00a0[18] prior to an immediate consecutive initial registration attempt to the network, otherwise the UE shall ignore the N3IWF identifier IE. Additionally, if the UE selects a new N3IWF and a new initial registration attempt is performed, the UE shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n#82\t(Selected TNGF is not compatible with the allowed NSSAI).\n\tThe UE shall abort the registration procedure for mobility and periodic registration update procedure, set the 5GS update status to 5U2 NOT UPDATED and enter state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION or 5GMM-DEREGISTERED.PLMN-SEARCH. Additionally, the UE shall reset the registration attempt counter. If the TNAN information IE is included in the REGISTRATION REJECT message and the UE supports slice-based TNGF selection, the UE may use the provided TNAN information IE in TNAN selection as specified in 3GPP\u00a0TS\u00a024.502\u00a0[18] prior to an immediate consecutive registration attempt to the network, otherwise the UE shall ignore the TNAN information IE. Additionally, if the UE selects a new TNAN and a new initial registration attempt is performed, the UE shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\nOther values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause\u00a05.5.1.3.7.\n5.5.1.3.6\tMobility and periodic registration update for initiating an emergency PDU session not accepted by the network\nIf the mobility and periodic registration update request for initiating an emergency PDU session cannot be accepted by the network, the UE shall perform the procedures as described in subclause\u00a05.5.1.3.5. If the mobility and periodic registration update request for initiating an emergency PDU session fails due to receiving the AUTHENTICATION REJECT message, the UE shall perform the procedures as described in subclauses\u00a05.4.1.2.2.11, 5.4.1.2.3.1, 5.4.1.2.3A.1 or 5.4.1.3.5. Then if the UE is in the same selected PLMN where the last mobility and periodic registration update request was attempted, the UE shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE\u00a01:\tThis can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[14] can result in the emergency call being attempted to another IP-CAN.\nb)\tperform de-registration locally, if not de-registered already, and attempt initial registration for emergency services.\nIf the mobility and periodic registration update request for initiating an emergency PDU session fails due to abnormal case b) in subclause\u00a05.5.1.3.7, the UE shall perform the actions as described in subclause\u00a05.5.1.3.7 and inform the upper layers of the failure to access the network.\nNOTE\u00a02:\tThis can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[14] can result in the emergency call being attempted to another IP-CAN.\nIf the mobility and periodic registration update request for initiating an emergency PDU session fails due to abnormal cases c), d), e) or g) in subclause\u00a05.5.1.3.7, the UE shall perform the procedures as described in subclause\u00a05.5.1.3.7. Then if the UE is in the same selected PLMN where the last mobility and periodic registration update request was attempted, the UE shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE\u00a03:\tThis can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[14] can result in the emergency call being attempted to another IP-CAN.\nb)\tperform de-registration locally, if not de-registered already, and attempt initial registration for emergency services.\n5.5.1.3.6A\tMobility and periodic registration update for an emergency services fallback not accepted by the network\nIf the mobility and periodic registration update request triggered upon receiving a request from the upper layers to perform an emergency services fallback:\n-\tfails due to an abnormal case described in subclause\u00a05.5.1.3.7, the UE shall perform the procedures as described in subclause\u00a05.5.1.3.7;\n-\tcannot be accepted by the network as described in subclause\u00a05.5.1.3.5, the UE shall perform the procedures as described in subclause\u00a05.5.1.3.5; or\n-\tfails due to receiving the AUTHENTICATION REJECT message, the UE shall perform the procedures as described in subclauses\u00a05.4.1.2.2.11, 5.4.1.2.3.1, 5.4.1.2.3A.1 or 5.4.1.3.5.\nIf the mobility and periodic registration update request triggered upon receiving a request from the upper layers to perform an emergency services fallback fails due to abnormal case b) in subclause\u00a05.5.1.3.7, the UE shall inform the upper layers of the failure to access the network.\nNOTE\u00a01:\tThis can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[14] can result in the emergency call being attempted to another IP-CAN.\nIf the mobility and periodic registration update request triggered upon receiving a request from the upper layers to perform an emergency services fallback fails due to abnormal cases c), d), e) or g), cannot be accepted or fails due to receiving the AUTHENTICATION REJECT message and the UE does not attempt to select an E-UTRA cell connected to EPC or 5GCN as described in subclause\u00a05.5.1.3.5 and the UE is camped on NR or E-UTRA cell connected to 5GCN in the same PLMN where the last mobility and periodic registration update request was attempted, the UE shall inform the upper layers of the failure of the procedure.\nNOTE\u00a02:\tThis can result in the upper layers requesting implementation specific mechanisms, e.g. procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[14] can result in the emergency call being attempted to another IP-CAN.\n5.5.1.3.7\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tTimer T3346 is running.\n\tThe UE shall not start the registration procedure for mobility and periodic registration update unless:\n1)\tthe UE is in 5GMM-CONNECTED mode;\n2)\tthe UE received a paging;\n3)\tthe UE receives a NOTIFICATION message over non-3GPP access when the UE is in 5GMM-CONNECTED mode over non-3GPP access and in 5GMM-IDLE mode over 3GPP access;\n4)\tthe UE is a UE configured for high priority access in selected PLMN or SNPN;\n5)\tthe UE has an emergency PDU session established or is establishing an emergency PDU session;\n6)\tthe UE receives a request from the upper layers to perform emergency services fallback;\n7)\tthe UE receives the CONFIGURATION UPDATE COMMAND message as specified in subclause\u00a05.4.4.3;\n8)\tthe UE in NB-N1 mode is requested by the upper layer to transmit user data related to an exceptional event and:\n-\tthe UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP\u00a0TS\u00a024.368\u00a0[17] or the USIM file EFNASCONFIG in 3GPP\u00a0TS\u00a031.102\u00a0[22]); and\n-\ttimer T3346 was not started when N1 NAS signalling connection was established with RRC establishment cause set to \"mo-ExceptionData\"; or\n9)\tthe MUSIM UE needs to request a new 5G-GUTI assignment as specified in subclause\u00a05.5.1.3.2.\n\tThe UE stays in the current serving cell and applies the normal cell reselection process.\nNOTE\u00a01:\tIt is considered an abnormal case if the UE needs to initiate a registration procedure for mobility and periodic registration update while timer T3346 is running independent on whether timer T3346 was started due to an abnormal case or a non-successful case.\n\tIf the registration procedure for mobility and periodic registration update was initiated for an MO MMTEL voice call (i.e. access category 4), for an MO MMTEL video call (i.e. access category 5), for an MO IMS registration related signalling (i.e. access category 9) or for NAS signalling connection recovery during an ongoing MO MMTEL voice call (i.e. access category 4), or during an MO MMTEL video call (i.e. access category 5) or during an ongoing MO IMS registration related signalling (i.e. access category 9), then a notification that the procedure was not initiated due to network congestion shall be provided to upper layers.\nb)\tThe lower layers indicate that the access attempt is barred.\n\tThe UE shall not start the registration procedure for mobility and periodic registration update. The UE stays in the current serving cell and applies the normal cell reselection process. Receipt of the access barred indication shall not trigger the selection of a different core network type (EPC or 5GCN).\n\tThe registration procedure for mobility and periodic registration update is started, if still needed, when the lower layers indicate that the barring is alleviated for the access category with which the access attempt was associated.\nba)\tThe lower layers indicate that:\n1)\taccess barring is applicable for all access categories except categories 0 and 2 and the access category with which the access attempt was associated is other than 0 and 2; or\n2)\taccess barring is applicable for all access categories except category 0 and the access category with which the access attempt was associated is other than 0.\n\tIf the REGISTRATION REQUEST message has not been sent, the UE shall proceed as specified for case b. If the REGISTRATION REQUEST message has been sent, the UE shall proceed as specified for case e and, additionally, the registration procedure for mobility and periodic registration update is started, if still needed, when the lower layers indicate that the barring is alleviated for the access category with which the access attempt was associated. For additional UE requirements for both cases see subclause\u00a04.5.5.\nc)\tT3510 timeout.\n\tThe UE shall abort the registration update procedure and the N1 NAS signalling connection, if any, shall be released locally.\n\tIf the UE has initiated the registration procedure in order to enable performing the service request procedure for emergency services fallback,the UE shall inform the upper layers of the failure of the emergency services fallback (see 3GP P\u00a0TS\u00a024.229\u00a0[14]). Otherwise, the UE shall proceed as described below.\nd)\tREGISTRATION REJECT message, other 5GMM cause values than those treated in subclause\u00a05.5.1.3.5, and cases of 5GMM cause values #11, #15, #22, #31, #72, #73, #74, #75, #76, #77, #78 and #80, if considered as abnormal cases according to subclause\u00a05.5.1.3.5.\n\tUpon reception of the 5GMM causes #95, #96, #97, #99 and #111 the UE should set the registration attempt counter to 5.\n\tThe UE shall proceed as described below.\ne)\tLower layer failure, release of the NAS signalling connection received from lower layers or the lower layers indicate that the RRC connection has been suspended without a cell change before the REGISTRATION ACCEPT or REGISTRATION REJECT message is received.\n\tThe UE shall abort the registration procedure and proceed as described below.\nf)\tChange in the current TAI.\n\tIf the current TAI is changed before the registration procedure for mobility and periodic registration update is completed, the registration procedure for mobility and periodic registration update shall be aborted and re-initiated immediately. The UE shall set the 5GS update status to 5U2 NOT UPDATED.\ng)\tRegistration procedure for mobility and periodic registration update and de-registration procedure collision.\n\tIf the UE receives a DEREGISTRATION REQUEST message without 5GMM cause value #11, #12, #13 or #15 before the registration procedure for mobility and periodic registration update has been completed, the registration procedure for mobility and periodic registration update shall be aborted and the de-registration procedure shall be progressed.\n\tIf the UE receives a DEREGISTRATION REQUEST message with 5GMM cause value #11, #12, #13 or #15 before the registration procedure for mobility and periodic registration update has been completed, the registration procedure for mobility and periodic registration update shall be progressed and the de-registration procedure shall be aborted.\nNOTE\u00a02:\tThe registration procedure for mobility and periodic registration update shall be aborted only if the DEREGISTRATION REQUEST message indicates in the access type that the access in which the registration procedure for mobility and periodic registration update was attempted shall be de-registered. Otherwise both the procedures shall be progressed.\nh)\tVoid\ni)\tTransmission failure of REGISTRATION REQUEST message indication from the lower layers or the lower layers indicate that the RRC connection has been suspended with a cell change.\n\tThe registration procedure for mobility and periodic registration update shall be aborted and re-initiated immediately. The UE shall set the 5GS update status to 5U2 NOT UPDATED.\nj)\tTransmission failure of REGISTRATION COMPLETE message indication with change in the current TAI.\n\tIf the current TAI is not in the TAI list, the registration procedure for mobility and periodic registration update shall be aborted and re-initiated immediately. The UE shall set the 5GS update status to 5U2 NOT UPDATED.\n\tIf the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure.\nk)\tTransmission failure of REGISTRATION COMPLETE message indication without change in the current TAI.\n\tIt is up to the UE implementation how to re-run the ongoing procedure.\nl)\tUE-initiated de-registration required.\n\tDe-registration due to removal of USIM or entry update in the \"list of subscriber data\" or due to switch off:\n\tThe registration procedure for mobility and periodic registration update shall be aborted, and the UE initiated de-registration procedure shall be performed.\n\tDe-registration not due to removal of USIM or entry update in the \"list of subscriber data\" and not due to switch off:\n\tthe UE initiated de-registration procedure shall be initiated after successful completion of the registration procedure for mobility and periodic registration update.\nm)\tTimer T3447 is running\n\tThe UE shall not start any mobility and periodic registration update procedure with Uplink data status IE or Follow-on request indicator set to \"Follow-on request pending\" unless:\n-\tthe UE received a paging;\n-\tthe UE is a UE configured for high priority access in selected PLMN;\n-\tthe UE has an emergency PDU session established or is establishing an emergency PDU session;\n-\tthe UE receives a request from the upper layers to perform emergency services fallback; or\n-\tthe MUSIM UE needs to request a new 5G-GUTI assignment as specified in subclause\u00a05.5.1.3.2.\n\tThe UE stays in the current serving cell and applies the normal cell reselection process. The mobility and periodic registration update procedure is started, if still necessary, when timer T3447 expires or timer T3447 is stopped.\nn)\tTimer T3448 is running\n\tThe UE in 5GMM-IDLE mode shall not start any mobility and periodic registration update procedure with Follow-on request indicator set to \"Follow-on request pending\" unless:\n1)\tthe UE is a UE configured for high priority access in selected PLMN;\n2)\tthe UE which is only using 5GS services with control plane CIoT 5GS optimization received a paging request; or\n3)\tthe UE in NB-N1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP\u00a0TS\u00a024.368\u00a0[17] or the USIM file EFNASCONFIG in 3GPP\u00a0TS\u00a031.102\u00a0[22]).\n\tThe UE stays in the current serving cell and applies the normal cell reselection process. The mobility and periodic registration update procedure is started, if still necessary, when timer T3448 expires.\no)\tUE is not registered to the access other than the access the REGISTRATION ACCEPT message is received and the 5GS registration result value in the 5GS registration result IE value in the REGISTRATION ACCEPT message is set to \"3GPP access and non-3GPP access\".\n\tThe UE shall consider itself as being registered to only the access where the REGISTRATION ACCEPT message is received.\np)\tAccess for localized services in current SNPN is no longer allowed.\n\tIf the mobility and periodic registration update is not for initiating an emergency PDU session, the registered SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) and:\n-\taccess for localized services in SNPN is disabled; or\n-\tthe validity information for the selected SNPN is no longer met;\n\tthe UE shall reset the registration attempt counter, stop T3510, abort the registration procedure for mobility and periodic registration update, locally release the NAS signalling connection, if any, and enter state 5GMM-REGISTERED.LIMITED-SERVICE or 5GMM-REGISTERED.PLMN-SEARCH in order to perform SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\nFor the cases c, d and e the UE shall proceed as follows:\n\tTimer T3510 shall be stopped if still running.\n\tIf the registration procedure is not for initiating an emergency PDU session, the registration attempt counter shall be incremented, unless it was already set to 5.\n\tIf the registration attempt counter is less than 5:\n-\tif the TAI of the current serving cell is not included in the TAI list or the 5GS update status is different to 5U1 UPDATED or if the registration procedure was triggered due to cases c, g, n, v in subclause\u00a05.5.1.3.2, the UE shall start timer T3511, shall set the 5GS update status to 5U2 NOT UPDATED and change to state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE. When timer T3511 expires, the registration update procedure is triggered again.\n-\tif the TAI of the current serving cell is included in the TAI list, the 5GS update status is equal to 5U1 UPDATED, and the UE is not performing the registration procedure after an inter-system change from S1 mode to N1 mode, the UE shall keep the 5GS update status to 5U1 UPDATED and enter state 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE (as described in subclause\u00a05.3.5.2). The UE shall start timer T3511. If in addition the REGISTRATION REQUEST message did not include the MICO indication IE or the Extended DRX IE, and:\n-\tthe REGISTRATION REQUEST message indicated \"periodic registration updating\";\n-\tthe registration procedure was initiated to recover the NAS signalling connection due to \"RRC Connection failure\" from the lower layers; or\n-\tthe registration procedure was initiated by the UE in 5GMM-CONNECTED mode with RRC inactive indication entering a cell in the current registration area belonging to an equivalent PLMN of the registered PLMN and not belonging to the registered PLMN,\n\tand none of the other reasons for initiating the registration updating procedure listed in subclause\u00a05.5.1.3.2 was applicable, the timer T3511 may be stopped when the UE enters 5GMM-CONNECTED mode.\n-\tif the TAI of the current serving cell is included in the TAI list, the 5GS update status is equal to 5U1 UPDATED and the UE is performing the registration procedure after an inter-system change from S1 mode to N1 mode, the UE shall change the 5GS update status to 5U2 NOT UPDATED and enter state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE. The UE shall start timer T3511.\n-\tIf the procedure is performed via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition handle the EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the abnormal cases when a normal or periodic tracking area updating procedure fails and the tracking area attempt counter is less than 5 and the EPS update status is different from EU1 UPDATED.\n\tIf the registration attempt counter is equal to 5\n-\tthe UE shall start timer T3502 if the value of the timer as indicated by the network is not zero, shall set the 5GS update status to 5U2 NOT UPDATED.\n-\tthe UE shall delete the list of equivalent PLMNs (if any) or the list of equivalent SNPNs (if any) if the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, and shall change to state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE or optionally to 5GMM-REGISTERED.PLMN-SEARCH in order to perform a PLMN selection, SNPN selection or SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n-\tif the value of T3502 as indicated by the network is zero, the UE shall perform the actions defined for the expiry of the timer T3502.\nNOTE\u00a03:\tFor case e) if the lower layer failure is on a cell which was selected due to network slice-based cell reselection (see 3GPP\u00a0TS\u00a023.501\u00a0[8]), the UE can as an implementation option change the S-NSSAI(s) in the requested NSSAI to try and find a suitable NR cell.\n-\tif the procedure is performed via 3GPP access and the UE is operating in single-registration mode:\n-\tthe UE shall in addition handle the EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the abnormal cases when a normal or periodic tracking area updating procedure fails and the tracking area attempt counter is equal to 5; and\n-\tif the UE does not change to state 5GMM-REGISTERED.PLMN-SEARCH, the UE shall attempt to select E-UTRAN radio access technology. The UE may disable the N1 mode capability as specified in subclause\u00a04.9.\n5.5.1.3.8\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tLower layer failure \n\tIf a lower layer failure occurs before the message REGISTRATION COMPLETE has been received from the UE and timer T3550 is running, the AMF shall abort the procedure, enter 5GMM-IDLE mode.\n\tIf a new 5G-GUTI was assigned to the UE in the REGISTRATION ACCEPT message, the AMF shall consider both, the old and new 5G-GUTIs as valid until the old 5G-GUTI can be considered as invalid by the AMF. If a new TAI list was provided in the REGISTRATION ACCEPT message, both the old and new TAI lists shall also be considered valid until the old TAI list can be considered invalid by the AMF. If the old 5G-GUTI was allocated by an AMF other than the current AMF, the current AMF does not need to retain the old 5G-GUTI.\n\tAdditionally, if the REGISTRATION ACCEPT message includes:\n1)\tNegotiated PEIPS assistance information IE: \ni)\tcontaining a new Paging subgroup ID and the UE is previously assigned a different Paging subgroup ID then, the AMF shall consider both, the old and new Paging subgroup IDs as valid until the old Paging subgroup ID can be considered as invalid by the AMF; or\nNOTE\u00a00:\tIf the UE was not previously assigned a paging subgroup ID by the AMF, then AMF informs RAN about the new PEIPS assistance information, i.e., paging subgroup ID and it is up to RAN how to handle the old information at RAN and new information from AMF so that the paging is not missed.\nii)\tcontaining no Paging subgroup ID or no Negotiated PEIPS assistance information IE, then the AMF shall delete any old Paging subgroup ID stored in the 5GMM context of the UE.\n2)\tNegotiated WUS assistance information IE: \ni)\tcontaining a new UE paging probability information value and the UE is previously assigned a different UE paging probability information value then, the AMF shall consider both, the old and new UE paging probability information values as valid until the old UE paging probability information value can be considered as invalid by the AMF; or\nii)\tcontaining no UE paging probability information value or no Negotiated WUS assistance information IE, then the AMF shall delete any old UE paging probability information value stored in the 5GMM context of the UE.\n\tDuring this period:\n1)\tif the new 5G-GUTI is used by the UE in a subsequent message, then:\ni)\tthe AMF shall consider the old 5G-GUTI as invalid and, additionally, the old TAI list as invalid if a new TAI list was provided with the new 5G-GUTI in the REGISTRATION ACCEPT message;\nii)\tif the AMF assigns a new Paging subgroup ID to the UE in the REGISTRATION ACCEPT message, then, the AMF shall consider the new Paging subgroup ID as valid and the old Paging subgroup ID, if any, as invalid; and\niii)\tif the AMF assigns a new UE paging probability information value in the Negotiated WUS assistance information IE to the UE in the REGISTRATION ACCEPT message, then, the AMF shall consider the new UE paging probability information value as valid and the old UE paging probability information value, if any, as invalid.\n2)\tif the old 5G-GUTI is used by the UE in a subsequent message, the AMF may use the identification procedure followed by a generic UE configuration update procedure. If the AMF in the REGISTRATION ACCEPT message:\ni)\tassigns a new Paging subgroup ID to the UE, then, the AMF shall include the PEIPS assistance information; or\nii)\tdoes not assign a Paging subgroup ID to the UE then, the AMF shall not include the PEIPS assistance information;\nand initiate the generic UE configuration update procedure; and\n3)\tif the UE needs to be paged:\ni)\tif in the REGISTRATION ACCEPT message a new Paging subgroup ID in the Negotiated PEIPS assistance information IE is assigned to the UE:\n-\tthat previously has no Paging subgroup ID assigned then, the AMF shall use the new Paging subgroup ID for paging the UE;\n-\tthat is same as the old Paging subgroup ID then, the AMF shall use the same Paging subgroup ID for paging the UE; or\n-\tthat is different than the old Paging subgroup ID then, the AMF may first use the old Paging subgroup ID followed by the new Paging subgroup ID for paging the UE.\nii)\tif in the REGISTRATION ACCEPT message a new UE paging probability information value in the Negotiated WUS assistance information IE is assigned to the UE:\n-\tthat previously has no UE paging probability information value assigned then, the AMF shall use the new UE paging probability information value for paging the UE;\n-\tthat is same as the old UE paging probability information value then, the AMF shall use the same UE paging probability information value for paging the UE; or\n-\tthat is different than the old UE paging probability information value then, the AMF may first use the old UE paging probability information value followed by the new UE paging probability information value for paging the UE.\niii)\tthe AMF selects the 5G-GUTI and TAI list as follows:\n-\tthe AMF may first use the old 5G-S-TMSI from the old 5G-GUTI for paging within the area defined by the old TAI list for an implementation dependent number of paging attempts using the selected Paging subgroup ID or the selected UE paging probability information value in the WUS assistance information IE. If a new TAI list was provided in the REGISTRATION ACCEPT message, the new TAI list should also be used for paging. Upon response from the UE, the AMF may initiate the generic UE configuration update procedure. If the response is received from a tracking area within the old and new TAI list, the network shall initiate the generic UE configuration update procedure. If in the REGISTRATION ACCEPT message a new Paging subgroup ID was assigned to the UE that is different than the old Paging subgroup ID then the network shall initiate the generic UE configuration update procedure; and\n-\tif no response is received to the paging attempts using the old 5G-S-TMSI from the old 5G-GUTI and the old Paging subgroup ID or the old UE paging probability information value in the WUS assistance information IE, the AMF may use the new 5G-S-TMSI from the new 5G-GUTI and the new Paging subgroup ID or the new UE paging probability information value in the WUS assistance information IE, if any, for paging, for an implementation dependent number of paging attempts. In this case, if a new TAI list was provided with the new 5G-GUTI in the REGISTRATION ACCEPT message, the new TAI list shall be used instead of the old TAI list.\nb)\tProtocol error.\n\tIf the REGISTRATION REQUEST message has been received with a protocol error, the AMF shall return a REGISTRATION REJECT message with one of the following 5GMM cause values:\n#96\tinvalid mandatory information;\n#99\tinformation element non-existent or not implemented;\n#100\tconditional IE error; or\n#111\tprotocol error, unspecified.\nc)\tT3550 time out.\n\tOn the first expiry of the timer, the AMF shall retransmit the REGISTRATION ACCEPT message and shall reset and restart timer T3550. The retransmission is performed four times, i.e. on the fifth expiry of timer T3550, the registration procedure for mobility and periodic registration update procedure is aborted.\n\tDuring this period the AMF acts as described for case\u00a0a) above.\nd)\tREGISTRATION REQUEST with 5GS registration type IE set to \"mobility registration updating\" or \"periodic registration updating\" received after the REGISTRATION ACCEPT message has been sent and before the REGISTRATION COMPLETE message is received, if the REGISTRATION COMPLETE message is expected.\n1)\tIf one or more of the information elements in the REGISTRATION REQUEST message differ from the ones received within the previous REGISTRATION REQUEST message, the previously initiated registration procedure for mobility and periodic registration update shall be aborted if the REGISTRATION COMPLETE message has not been received and the new registration procedure for mobility and periodic registration update shall be progressed; or\n2)\tif the information elements do not differ, then the REGISTRATION ACCEPT message shall be resent and timer T3550 shall be restarted. In that case, the retransmission counter related to timer T3550 is not incremented.\ne)\tMore than one REGISTRATION REQUEST message with 5GS registration type IE set to \"mobility registration updating\" or \"periodic registration updating\" received and neither REGISTRATION ACCEPT message nor REGISTRATION REJECT message has been sent.\n1)\tIf one or more of the information elements in the REGISTRATION REQUEST message differs from the ones received within the previous REGISTRATION REQUEST message, the previously initiated registration procedure for mobility and periodic registration update shall be aborted and the new registration procedure for mobility and periodic registration update shall be progressed; or\n2)\tif the information elements do not differ, then the network shall continue with the previous registration procedure for mobility and periodic registration update and shall not treat any further this REGISTRATION REQUEST message.\nf)\tLower layers indication of non-delivered NAS PDU due to handover.\n\tIf the REGISTRATION ACCEPT message or REGISTRATION REJECT message could not be delivered due to an intra AMF handover and the target TA is included in the TAI list, then upon successful completion of the intra AMF handover the AMF shall retransmit the REGISTRATION ACCEPT message or REGISTRATION REJECT message. If a failure of the handover procedure is reported by the lower layer and the N1 NAS signalling connection exists, the AMF shall retransmit the REGISTRATION ACCEPT message or REGISTRATION REJECT message.\ng)\tDEREGISTRATION REQUEST message received before REGISTRATION COMPLETE message is received, if the REGISTRATION COMPLETE message is expected.\n\tIf the De-registration type IE is set to \"switch off\":\n\tThe AMF shall abort the signalling for the registration procedure for mobility and periodic registration update towards the UE and shall progress the de-registration procedure as described in subclause\u00a05.5.2.2.\nNOTE\u00a01:\tInternally in the AMF, before processing the de-registration request, the AMF can perform the necessary signalling procedures for the registration procedure for mobility and periodic registration update before progressing the de-registration procedure.\n\tIf the De-registration type IE is set to other type than \"switch off\":\n\tThe AMF shall proceed with registration procedure for mobility and periodic registration update and shall progress the de-registration procedure after successful completion of the registration procedure for mobility and periodic registration update.\nh)\tIf the REGISTRATION REQUEST message with 5GS registration type IE indicating \"periodic registration updating\" is received by the new AMF which does not have the 5GMM context data related to the subscription, the new AMF may send the REGISTRATION REJECT message with 5GMM cause #10 \"implicitly de-registered\".\ni)\tBased on operator policy, if the mobility and periodic registration update request from a UE not supporting CAG is rejected due to CAG restrictions, the network shall reject the mobility and periodic registration update request with a 5GMM cause value other than the 5GMM cause #76 (Not authorized for this CAG or authorized for CAG cells only).\nNOTE\u00a02:\t5GMM cause #7 (5GS services not allowed), 5GMM cause #11 (PLMN not allowed), 5GMM cause #27 (N1 mode not allowed), 5GMM cause #73 (Serving network not authorized) can be used depending on the subscription of the UE and whether the UE roams or not.\n5.5.2\tDe-registration procedure\n5.5.2.1\tGeneral\nThe de-registration procedure is used:\na)\tby the UE to de-register for 5GS services over 3GPP access when the UE is registered over 3GPP access;\nb)\tby the UE to de-register for 5GS services over non-3GPP access when the UE is registered over non-3GPP access;\nc)\tby the UE to de-register for 5GS services over 3GPP access, non-3GPP access or both when the UE is registered in the same PLMN over both accesses;\nd)\tby the network to inform the UE that it is deregistered for 5GS services over 3GPP access when the UE is registered over 3GPP access;\ne)\tby the network to inform the UE that it is deregistered for 5GS services over non-3GPP access when the UE is registered over non-3GPP access;\nf)\tby the network to inform the UE that it is deregistered for 5GS services over 3GPP access, non-3GPP access or both when the UE is registered in the same PLMN over both accesses;\ng)\tby the network to inform the UE to re-register to the network;\nh)\tby the network to inform the UE supporting UAS service that it is deregistered for UAS services in 5GS; and\ni)\tby the network to inform the UE operating as MBSR that it is deregistered for MBSR in 5GS.\nThe de-registration procedure with appropriate de-registration type shall be invoked by the UE:\na)\tif the UE is switched off;\nb)\tas part of the eCall inactivity procedure defined in subclause\u00a05.5.3; and\nc)\tas part of USIM removal.\nThe de-registration procedure with appropriate de-registration type shall be invoked by the network:\na)\tif the network informs whether the UE should re-register to the network.\nThe de-registration procedure with appropriate access type shall be invoked by the UE:\na)\tto de-register for 5GS services over 3GPP access when the UE is registered over 3GPP access;\nb)\tto de-register for 5GS services over non-3GPP access when the UE is registered over non-3GPP access;\nc)\tto de-register for 5GS services over 3GPP access, non-3GPP access or both when the UE is registered in the same PLMN over both accesses;\nd)\tto de-register for 5GS services over 3GPP access, if the UE is registered for disaster roaming over 3GPP access and has successfully registered over non-3GPP access on another PLMN; or\ne)\tto de-register for 5GS services if an event is triggered in the UE that would make the UE unavailable for a certain period of time and the UE is not able to store its 5GMM and 5GSM context.\nNOTE\u00a01:\tIf the UE is able to store its 5GMM and 5GSM contexts, the UE triggers the registration procedure for mobility and periodic registration update.\nThe de-registration procedure with appropriate access type shall be invoked by the network:\na)\tif the network needs to inform the UE that it is deregistered over 3GPP access when the UE is registered over 3GPP access;\nb)\tif the network needs to inform the UE that it is deregistered over non-3GPP access when the UE is registered over non-3GPP access; or\nc)\tif the network needs to inform the UE that it is deregistered over 3GPP access, non-3GPP access or both when the UE is registered in the same PLMN over both accesses.\nIf the de-registration procedure is triggered due to USIM removal, the UE shall indicate \"switch off\" in the de-registration type IE.\nIf the de-registration procedure is requested by the network for a UE that has an emergency PDU session, the AMF shall not send a DEREGISTRATION REQUEST message to the UE and indicate to the SMF to release all non-emergency PDU sessions as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9].\nIf the de-registration procedure for 5GS services is performed, a local release of the PDU sessions over the indicated access(es), if any, for this particular UE is performed. If a PDU session that will be released is associated with one or more multicast MBS sessions, the UE is considered as removed from the associated multicast MBS sessions.\nThe UE is allowed to initiate the de-registration procedure even if the timer T3346 is running.\nNOTE\u00a02:\tWhen the UE has no PDU sessions over non-3GPP access, or the UE moves all the PDU sessions over a non-3GPP access to a 3GPP access, the UE and the AMF need not initiate de-registration over the non-3GPP access.\nThe AMF shall provide the UE with a non-3GPP de-registration timer.\nWhen the AMF enters the state 5GMM-DEREGISTERED for 3GPP access, the AMF shall delete the stored UE radio capability information or the UE radio capability ID, if any.\nWhen upper layers indicate that emergency services are no longer required, the UE if still registered for emergency services, may perform UE-initiated de-registration procedure followed by a re-registration to regain normal services, if the UE is in or moves to a suitable cell.\nIf the UE is registered for onboarding services in SNPN, after completing the configuration of one or more entries of the \"list of subscriber data\", the UE should perform UE-initiated de-registration procedure. To prevent the UE registered for onboarding services in SNPN from staying on the ON-SNPN or to prevent a UE whose subscription only allows for configuration of SNPN subscription parameters in PLMN via the user plane, from staying registered indefinitely, when an implementation specific timer expires:\n-\tif the AMF considers that the UE is in 5GMM-IDLE, the AMF shall locally de-registers the UE; or\n-\tif the UE is in 5GMM-CONNECTED, the AMF shall initiate the network-initiated de-registration procedure (see subclause 5.5.2.3).\nNOTE\u00a03:\tThe value of the implementation specific timer for onboarding services needs to be large enough to allow a UE to complete the configuration of one or more entries of the \"list of subscriber data\" taking into consideration that configuration of SNPN subscription parameters in PLMN via the user plane or onboarding services in SNPN involves third party entities outside of the operator's network.\nNOTE\u00a04:\tHow to determine the completion of the configuration of one or more entries of the \"list of subscriber data\" is UE implementation specific.\nIf the de-registration procedure is not due to switch off and upper layers request establishing an emergency PDU session before the de-registration procedure has been completed, the UE shall abort the de-registration procedure, perform local de-registration and initiate a registration procedure.\nIf the UE in 5GMM-CONNECTED mode determines to obtain service on a higher priority PLMN due to SOR, then based on the conditions as specified in 3GPP TS 23.122 [5] annex C, where applicable, the UE shall perform UE-initiated de-registration procedure.\nIf the UE is registered for disaster roaming services, and the UE receives an indication of whether disaster roaming is enabled in the UE set to \"Disaster roaming is disabled in the UE\" in a UE parameters update transparent container, the UE shall perform UE-initiated de-registration procedure.\n5.5.2.2\tUE-initiated de-registration procedure\n5.5.2.2.1\tUE-initiated de-registration procedure initiation\nThe de-registration procedure is initiated by the UE by sending a DEREGISTRATION REQUEST message (see example in figure\u00a05.5.2.2.1). The De-registration type IE included in the message indicates whether the de-registration procedure is due to a \"switch off\" or not. The access type included in the message indicates whether the de-registration procedure is:\na)\tfor 5GS services over 3GPP access when the UE is registered over 3GPP access;\nb)\tfor 5GS services over non-3GPP access when the UE is registered over non-3GPP access; or\nc)\tfor 3GPP access, non-3GPP access or both when the UE is registered in the same PLMN over both accesses.\nIf the UE has a valid 5G-GUTI, the UE shall populate the 5GS mobile identity IE with the valid 5G-GUTI. If the UE does not have a valid 5G-GUTI, the UE shall populate the 5GS mobile identity IE with its SUCI as follows:\na)\tif timer T3519 is not running, generate a fresh SUCI as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24], send a DEREGISTRATION REQUEST message with the SUCI, start timer T3519 and store the value of the SUCI sent in the DEREGISTRATION REQUEST message; and\nb)\tif timer T3519 is running, send a DEREGISTRATION REQUEST message with the stored SUCI.\nIf the UE does not have a valid 5G-GUTI and it does not have a valid SUCI, then the UE shall populate the5GS mobile identity IE with its PEI.\nIf the de-registration request is not due to switch off and the UE is in the state 5GMM-REGISTERED or 5GMM-REGISTERED-INITIATED, timer T3521 shall be started in the UE after the DEREGISTRATION REQUEST message has been sent. The UE shall enter the state 5GMM-DEREGISTERED-INITIATED.\nIf the UE is to be switched off, the UE shall try for a period of 5 seconds to send the DEREGISTRATION REQUEST message. During this period, the UE may be switched off as soon as the DEREGISTRATION REQUEST message has been sent.\nIf the network indicated support for the unavailability period in the last registration procedure; and an event is triggered in the UE that would make the UE unavailable for a certain period, and:\na)\tthe use of unavailability period is not due to NR satellite access discontinuous coverage and the UE is unable to store its 5GMM and 5GSM contexts; or\nb)\tthe use of unavailability period is due to NR satellite access discontinuous coverage, \nthe UE shall include the unavailability period duration in the Unavailability information IE, and set the De-registration type to \"Normal de-registration\" in the DEREGISTRATION REQUEST message. The UE shall start the timer T3521 and enter the state 5GMM-DEREGISTERED-INITIATED.\nIf the UE is sending the DEREGISTRATION REQUEST message from 5GMM-IDLE mode and the UE needs to send non-cleartext IEs, the UE shall send the DEREGISTRATION REQUEST message including the NAS message container IE as described in subclause\u00a04.4.6.\nThe 5G-RG shall not initiate the de-registration procedure for itself until it successfully de-registers all the AUN3 devices connected to it, if any, by initiating the de-registration procedure on behalf of the AUN3 device.\n\nFigure\u00a05.5.2.2.1.1: UE-initiated de-registration procedure\n5.5.2.2.2\tUE-initiated de-registration procedure completion\nWhen the DEREGISTRATION REQUEST message is received by the AMF, the AMF shall send a DEREGISTRATION ACCEPT message to the UE, if the De-registration type IE does not indicate \"switch off\". Otherwise, the procedure is completed when the AMF receives the DEREGISTRATION REQUEST message.\nThe UE, when receiving the DEREGISTRATION ACCEPT message, shall stop timer T3521, stop timer T3519 if running, and delete any stored SUCI.\n5.5.2.2.3\tUE-initiated de-registration procedure completion for 5GS services over 3GPP access\nIf the access type in the DEREGISTRATION REQUEST message indicates that the de-registration procedure is for 3GPP access, the AMF shall trigger the SMF to perform a local release of the PDU session(s) established over 3GPP access, if any, for this UE. The UE shall perform a local release of the PDU session(s) established over 3GPP access, if any. If a PDU session is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions and the SMF shall consider the UE as removed from the associated multicast MBS sessions. If there is an MA PDU session with user plane resources established on both 3GPP access and non-3GPP access in the same PLMN or in different PLMNs, the AMF shall trigger SMF to perform release of user plane resources on 3GPP access, and the UE shall consider the user plane resources on 3GPP access as released. If there is an MA PDU session with user plane resources established on 3GPP access only, the AMF shall trigger the SMF to perform a local release of the MA PDU session, and the UE shall perform a local release of the MA PDU session. If the MA PDU session is associated with one or more MBS multicast sessions, the UE shall locally leave the associated MBS multicast sessions. The UE is marked as inactive in the AMF for 5GS services for 3GPP access. The AMF shall enter the state 5GMM-DEREGISTERED for 3GPP access.\nIf the UE supports N1 mode only and the de-registration request is not due to switch off, then:\na)\tif the de-registration procedure was performed due to disabling of 5GS services, then the UE shall enter the 5GMM-NULL state for 3GPP access;\nb)\totherwise, the UE shall enter the 5GMM-DEREGISTERED state for 3GPP access.\nNOTE:\tCase b) is applicable when the UE is also registered over non-3GPP access.\nIf the access type indicates that the de-registration procedure is for 3GPP access or for 3GPP access and non-3GPP access, and the UE is operating in single-registration mode, it shall additionally proceed as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15], subclause\u00a05.5.2.2.2, for the case when the UE receives an EMM message DETACH ACCEPT. Furthermore, if the UE supports A/Gb or Iu mode, it shall disable the N1 mode capability for 3GPP access.\n5.5.2.2.4\tUE-initiated de-registration procedure completion for 5GS services over non-3GPP access\nIf the access type in the DEREGISTRATION REQUEST indicates that the de-registration procedure is for non-3GPP access, the AMF shall trigger SMF to perform a local release of the PDU session(s) established over non-3GPP access, if any, for this UE. The UE shall perform a local release of the PDU session(s) established over non-3GPP access, if any. If there is an MA PDU session with user plane resources established on both 3GPP access and non-3GPP access in the same PLMN or in different PLMNs, the AMF shall trigger SMF to perform release of user plane resources on non-3GPP access, and the UE shall consider the user plane resources on non-3GPP access as released. If there is an MA PDU session with a PDN connection as a user-plane resource and user plane resources established on non-3GPP access, the AMF shall trigger SMF to perform release of user plane resources on non-3GPP access, and the UE shall consider the user plane resources on non-3GPP access as released. If the UE has an MA PDU session with user plane resources established on non-3GPP access only, the AMF shall trigger the SMF to perform a local release of the MA PDU session, and the UE shall perform a local release of the MA PDU session. The UE is marked as inactive in the AMF for 5GS services for non-3GPP access. The AMF shall enter the state 5GMM-DEREGISTERED over non-3GPP access.\nIf the de-registration request is not due to switch off, the UE shall:\na)\tif the de-registration procedure was performed due to disabling of 5GS services, enter the 5GMM-NULL state for non-3GPP access;\nb)\totherwise, enter the 5GMM-DEREGISTERED state for non-3GPP access.\nNOTE:\tCase b) is applicable when the UE is also registered over 3GPP access.\n5.5.2.2.5\tUE-initiated de-registration procedure completion for 5GS services over both 3GPP access and non-3GPP access\nIf the access type in the DEREGISTRATION REQUEST indicates that the de-registration procedure is for both 3GPP access and non-3GPP access when the UE is registered in the same PLMN over both accesses, the descriptions for UE-initiated de-registration procedure completion for 5GS services over 3GPP access and over non-3GPP access, as specified in subclauses\u00a05.5.2.2.3 and 5.5.2.2.4, shall be followed.\n5.5.2.2.6\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tLower layer failure or release of the N1 NAS signalling connection before reception of DEREGISTRATION ACCEPT message.\n\tThe de-registration procedure shall be aborted and the UE proceeds as follows:\n1)\tif the de-registration procedure was performed due to disabling of 5GS services, the UE shall enter the 5GMM-NULL state; or\n2)\tif the de-registration type \"normal de-registration\" was requested for reasons other than disabling of 5GS services, the UE shall enter the 5GMM-DEREGISTERED state.\nb)\tThe lower layers indicate that the access attempt is barred.\n\tThe UE shall not start the de-registration signalling procedure. The UE stays in the current serving cell and applies the normal cell reselection process. Receipt of the access barred indication shall not trigger the selection of a different core network type (EPC or 5GCN).\n\tThe UE may perform a local de-registration either immediately or after an implementation-dependent time.\n\tThe de-registration signalling procedure is started, if still needed, when the lower layers indicate that the barring is alleviated for the access category with which the access attempt was associated.\nba)\tThe lower layers indicate that:\n1)\taccess barring is applicable for all access categories except categories 0 and 2 and the access category with which the access attempt was associated is other than 0 and 2; or\n2)\taccess barring is applicable for all access categories except category 0 and the access category with which the access attempt was associated is other than 0.\n\tIf the DEREGISTRATION REQUEST message has not been sent, the UE shall proceed as specified for case b. If the DEREGISTRATION REQUEST message has been sent, the UE shall proceed as specified for case a.\nc)\tT3521 timeout.\n\tIf the de-registration procedure was performed based on conditions specified in 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C, on the expiry of timer T3521 the de-registration procedure shall be aborted and the UE shall locally release the established N1 NAS signalling connection and enter the 5GMM-DEREGISTERED state.\nOtherwise, on the first four expiries of the timer, the UE shall retransmit the DEREGISTRATION REQUEST message and shall reset and restart timer T3521. On the fifth expiry of timer T3521, the de-registration procedure shall be aborted and the UE proceeds as follows:\n1)\tif the de-registration procedure was performed due to disabling of 5GS services, the UE shall enter the 5GMM-NULL state; or\n2)\tif the de-registration type \"normal de-registration\" was requested for reasons other than disabling of 5GS services, the UE shall enter the 5GMM-DEREGISTERED state.\nd)\tDe-registration procedure collision.\n\tDe-registration containing de-registration type \"switch off\":\n-\tIf the UE receives a DEREGISTRATION REQUEST message before the UE-initiated de-registration procedure has been completed, this message shall be ignored and the UE-initiated de-registration procedure shall continue.\n\tOtherwise:\n-\tIf the UE receives a DEREGISTRATION REQUEST message before the UE-initiated de-registration procedure has been completed, it shall treat the message as specified in subclause\u00a05.5.2.3.2 with the following modification:\n-\tIf the DEREGISTRATION REQUEST message received by the UE contains de-registration type \"re-registration required\", and the UE-initiated de-registration procedure is with de-registration type \"normal de-registration\":\n-\tIf the access type included in the DEREGISTRATION REQUEST message sent by the UE is same as access type sent by the network, the UE need not initiate the registration procedure for initial registration; or\n-\tIf the access type included in the DEREGISTRATION REQUEST message sent by the UE is not same as access type sent by the network, the UE shall initiate the registration procedure for initial registration for the access type not indicated in the DEREGISTRATION REQUEST message sent by the UE but indicated by the network.\ne)\tDe-registration and 5GMM common procedure collision.\n\tDe-registration containing de-registration type \"switch off\":\n-\tIf the UE receives a message used in a 5GMM common procedure before the de-registration procedure has been completed, this message shall be ignored and the de-registration procedure shall continue.\n\tOtherwise:\n-\tIf the UE receives a message used in a 5GMM common procedure before the de-registration procedure has been completed, both the 5GMM common procedure and the de-registration procedure shall continue; or\n-\tIf the UE receives a DL NAS TRANSPORT message containing payload container type \"Service-level-AA container\" before the de-registration procedure has been completed, this message shall be ignored and the de-registration procedure shall continue.\nf)\tChange in the current TAI.\n\tIf that the current TAI is not in the stored TAI list before the UE-initiated de-registration procedure is completed, the UE proceeds as follows:\n1)\tif the de-registration procedure was initiated for reasons other than removal of the USIM, the UE is to be switched off or due to the last Tsor-cm timer expiry or stopped (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), the de-registration procedure shall be aborted and re-initiated after successfully performing a registration procedure for mobility or periodic update used for mobility (i.e. the 5GS registration type IE set to \"mobility registration updating\" in the REGISTRATION REQUEST message); or\n2)\tif the de-registration procedure was initiated due to removal of the USIM or the UE is to be switched off or due to the last Tsor-cm timer expiry or stopped (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), the UE shall abort the de-registration procedure, perform a local de-registration and enter the state 5GMM-DEREGISTERED.\ng)\tTransmission failure of DEREGISTRATION REQUEST message indication with change in the current TAI.\n\tIf the current TAI is not in the TAI list, the UE proceeds as follows:\n1)\tif the de-registration procedure was initiated for reasons other than removal of the USIM ,the UE is to be switched off or due to the last Tsor-cm timer expiry or stopped (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), the de-registration procedure shall be aborted and re-initiated after successfully performing a registration procedure for mobility or periodic update; or\n2)\tif the de-registration procedure was initiated due to removal of the USIM or the UE is to be switched off or due to the last Tsor-cm timer expiry or stopped (see 3GPP\u00a0TS\u00a023.122\u00a0[5]), the UE shall abort the de-registration procedure, perform a local de-registration and enter the state 5GMM-DEREGISTERED.\n\tIf the current TAI is still part of the TAI list, the UE shall restart the de-registration procedure.\nh)\tTransmission failure of DEREGISTRATION REQUEST message indication without change in the current TAI.\n\tThe UE shall restart the de-registration procedure.\ni)\tThe lower layers indicate that the RRC connection has been suspended.\n\tDe-registration containing de-registration type \"switch off\":\n-\tThe UE may perform a local de-registration either immediately or after an implementation-dependent time.\n\tOtherwise:\n-\tThe UE shall wait for an implementation-dependent time and shall restart the de-registration procedure, if still needed, upon expiry of the implementation-dependent time.\nFor the cases a, f, g and i:\n-\tTimer T3521 shall be stopped if still running.\n5.5.2.2.7\tAbnormal cases in the network side\nThe following abnormal cases can be identified:\na)\tDe-registration request received in a cell belonging to an SNPN with a non-globally-unique SNPN identity for which the UE has no valid subscription\n\tIf the UE initiates a de-registration procedure in a cell belonging to an SNPN with a non-globally-unique SNPN identity for which the UE has no valid subscription, and the de-registration procedure is not due to \"switch off\", the network shall initiate the de-registration procedure. The AMF shall send a DEREGISTRATION REQUEST message including the 5GMM cause #74 \"Temporarily not authorized for this SNPN\".\nb)\tDe-registration request received in a cell belonging to an SNPN with a globally-unique SNPN identity for which the UE has no valid subscription\n\tIf the UE initiates a de-registration procedure in a cell belonging to an SNPN with a globally-unique SNPN identity for which the UE has no valid subscription, and the de-registration procedure is not due to \"switch off\", the network shall initiate the de-registration procedure. The AMF shall send a DEREGISTRATION REQUEST message including the 5GMM cause #75 \"Permanently not authorized for this SNPN\".\nc)\tDe-registration request received in a CAG cell and none of the CAG ID broadcasted by the CAG cell is authorized based on the UE's \"allowed CAG list\" for the current PLMN\n\tIf the UE initiates a de-registration procedure in a CAG cell and none of the CAG ID broadcasted by the CAG cell is authorized based on the UE's \"allowed CAG list\" for the current PLMN and the de-registration procedure is not due to \"switch off\", the AMF shall initiate the de-registration procedure. The AMF shall send a DEREGISTRATION REQUEST message including the 5GMM cause #76 \"Not authorized for this CAG or authorized for CAG cells only\" if the UE supports CAG. Otherwise, the network shall operate as described in bullet\u00a0g) of subclause\u00a05.5.2.3.5.\nd)\tDe-registration request received in a non-CAG cell from a UE whose \"CAG information list\" includes an entry associated with the current PLMN, where the entry contains an \"indication that the UE is only allowed to access 5GS via CAG cells\"\n\tIf the UE initiates a de-registration procedure in a non-CAG cell from a UE whose \"CAG information list\" includes an entry associated with the current PLMN, where the entry contains an \"indication that the UE is only allowed to access 5GS via CAG cells\" and the de-registration procedure is not due to \"switch off\", the AMF shall initiate the de-registration procedure. The AMF shall send a DEREGISTRATION REQUEST message including the 5GMM cause #76 \"Not authorized for this CAG or authorized for CAG cells only\" if the UE supports CAG. Otherwise, the network shall operate as described in bullet\u00a0g) of subclause\u00a05.5.2.3.5.\ne)\tDe-registration and registration procedure for initial registration collision\n\tIf the network receives a REGISTRATION REQUEST message indicating either \"initial registration\" or \"emergency registration\" in the 5GS registration type IE from the UE before the UE-initiated de-registration procedure, which is not due to switch off, has been completed, the network shall abort the de-registration procedure and the registration procedure shall be progressed.\n5.5.2.3\tNetwork-initiated de-registration procedure\n5.5.2.3.1\tNetwork-initiated de-registration procedure initiation\nThe network initiates the de-registration procedure by sending a DEREGISTRATION REQUEST message to the UE (see example in figure\u00a05.5.2.3.1.1).\nNOTE\u00a01:\tIf the AMF performs a local de-registration, it will inform the UE with a 5GMM messages (e.g. SERVICE REJECT message or REGISTRATION REJECT message) with 5GMM cause #10 \"implicitly de-registered\" only when the UE initiates a 5GMM procedure.\nThe network may include a 5GMM cause IE to specify the reason for the DEREGISTRATION REQUEST message. The network shall start timer T3522. The network shall indicate whether re-registration is needed or not in the De-registration type IE. The network shall also indicate via the access type whether the de-registration procedure is:\na)\tfor 3GPP access only;\nb)\tfor non-3GPP access only; or\nc)\tfor 3GPP access, non-3GPP access or both when the UE is registered in the same PLMN for both accesses.\nIf the network de-registration is triggered due to network slice-specific authentication and authorization failure or revocation as specified in subclause\u00a04.6.2.4, then the network shall set the 5GMM cause value to #62 \"No network slices available\" in the DEREGISTRATION REQUEST message. In addition, if the UE supports extended rejected NSSAI, the AMF shall include the Extended rejected NSSAI IE in the DEREGISTRATION REQUEST message; otherwise, the AMF shall include the Rejected NSSAI IE in the DEREGISTRATION REQUEST message.\nIn roaming scenarios, if the Extended rejected NSSAI IE is included in the DEREGISTRATION REQUEST message, the AMF shall provide mapped S-NSSAI(s) for the rejected NSSAI.\nIf the UE supports extended rejected NSSAI and the network de-registration is triggered due to mobility management based network slice admission control as specified in subclause\u00a04.6.2.5, then the network shall set the 5GMM cause value to #62 \"No network slices available\" in the DEREGISTRATION REQUEST message. In addition, the network may include a back-off timer value for each S-NSSAI with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\" in the Extended rejected NSSAI IE of the DEREGISTRATION REQUEST message.\nIf the network de-registration is triggered for a UE supporting CAG due to CAG restrictions, the network shall set the 5GMM cause value to #76 \"Not authorized for this CAG or authorized for CAG cells only\" and should include the \"CAG information list\" in the CAG information list IE or the Extended CAG information list IE in the DEREGISTRATION REQUEST message.\nNOTE\u00a02:\tIf the UE supports extended CAG information list, the CAG information list can be included either in the CAG information list IE or Extended CAG information list IE.\nNOTE\u00a03:\tIt is unexpected for network to send REGISTRATION REJECT message to the UE with 5GMM cause value #76 in non-CAG cell and not indicate \"Indication that the UE is only allowed to access 5GS via CAG cells\" for the serving PLMN in the Extended CAG information list or the CAG information list.\nIf the network de-registration is triggered for a UE not supporting CAG due to CAG restrictions, the network shall operate as described in bullet\u00a0g) of subclause\u00a05.5.2.3.5.\nIf the network de-registration is triggered because the network determines that the UE is in a location where the network is not allowed to operate, see 3GPP\u00a0TS\u00a023.502\u00a0[9], the network shall set the 5GMM cause value in the DEREGISTRATION REQUEST message to #78 \"PLMN not allowed to operate at the present UE location\".\nIf the network de-registration is triggered due to:\na)\tan unsuccessful outcome of an ongoing UUAA-MM procedure;\nb)\tan UUAA revocation notification received from the UAS-NF for a UE supporting UAS service requesting UAS services; or\nc)\tthe UE not allowed to use UAS services via 5GS due to a change of the aerial UE subscription information,\nthen the network shall set the 5GMM cause value in the DEREGISTRATION REQUEST message to #79 \"UAS services not allowed\".\nNOTE\u00a04:\tIf the UE supporting UAS service has requested other services than UAS services, or if there are other ongoing network slice-specific authentication and authorization on pending NSSAIs, it is then an operator policy or configuration decision whether to keep the UE supporting UAS service registered to the network, but that UE supporting UAS services is not allowed to access UAS services via 5GS as specified in 3GPP\u00a0TS\u00a023.256\u00a0[6AB].\nIf the network de-registration is triggered for a UE supporting MINT due to a disaster condition no longer being applicable in the current location of the UE, the network shall set the 5GMM cause value to #11 \"PLMN not allowed\" and may include a disaster return wait range in the Disaster return wait range IE in the DEREGISTRATION REQUEST message.\nIf the network de-registration is triggered because the AMF determines that, by UE subscription and operator's preferences, all of the TAIs received from the satellite NG-RAN are forbidden for roaming or for regional provision of service, the AMF shall include the TAI(s) in:\na)\tthe Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE; or\nb)\tthe Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE; or\nc)\tboth;\nin the DEREGISTRATION REQUEST message.\nIf the network de-registration is triggered because the AMF determines that the UE operating as an IAB-node by subscription is not authorized for IAB-node operation, the AMF shall set the 5GMM cause value to #36 \"IAB-node operation not authorized\" in the DEREGISTRATION REQUEST message.\nIf the network de-registration is triggered for a UE operating as MBSR due to the UE no longer being allowed to operate as MBSR based on the UE subscription and the local policy and the UE is allowed to operate as a UE, then the network shall indicate \"re-registration required\" in the De-registration type IE of the DEREGISTRATION REQUEST message based on the local policy.\nIf the network de-registration is triggered due to the UE that was not allowed for MBSR operation becoming allowed to operate as MBSR based on the UE subscription and the local policy, then the network shall indicate \"re-registration required\" in the De-registration type IE of the DEREGISTRATION REQUEST message.\nThe AMF shall trigger the SMF to release locally the PDU session(s) over the indicated access(es), if any, for the UE and enter state 5GMM-DEREGISTERED-INITIATED. If a PDU session is associated with one or more multicast MBS sessions, the SMF shall consider the UE as removed from the associated multicast MBS sessions.\n\nFigure\u00a05.5.2.3.1.1: Network-initiated de-registration procedure\n5.5.2.3.2\tNetwork-initiated de-registration procedure completion by the UE\nUpon receiving the DEREGISTRATION REQUEST message, if the DEREGISTRATION REQUEST message indicates \"re-registration required\" and the de-registration request is for 3GPP access, the UE shall perform a local release of the PDU sessions over 3GPP access, if any. If a PDU session is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions. If there is an MA PDU session with user plane resources established on both 3GPP access and non-3GPP access in the same PLMN or in different PLMNs, the UE shall perform a local release of the user plane resources on 3GPP access. If there is an MA PDU session with user plane resources established on 3GPP access only, the UE shall perform a local release of the MA PDU session. If the MA PDU session is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions. The UE shall stop the timer(s) T3346, T3396, T3584, T3585 and 5GSM back-off timer(s) not related to congestion control (see subclause\u00a06.2.12), if running. If the UE is operating in single-registration mode, the UE shall also stop the ESM back-off timer(s) not related to congestion control (see subclause\u00a06.3.6 in 3GPP\u00a0TS\u00a024.301\u00a0[15]), if running. The UE shall send a DEREGISTRATION ACCEPT message to the network and enter the state 5GMM-DEREGISTERED for 3GPP access. Furthermore, the UE shall, after the completion of the de-registration procedure, and the release of the existing NAS signalling connection, if any Tsor-cm timer(s) were running and have stopped, the UE shall attempt to obtain service on a higher priority PLMN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) on 3GPP access, otherwise initiate an initial registration. The UE should also re-establish any previously established PDU sessions over 3GPP access. For any previously established MA PDU sessions with user plane resources established on both accesses the UE should also re-establish the user plane resources over 3GPP access, and for any previously established MA PDU sessions with user plane resources established only on the 3GPP access the UE should re-establish the MA PDU session over 3GPP access.\nUpon receiving the DEREGISTRATION REQUEST message, if the DEREGISTRATION REQUEST message indicates \"re-registration required\" and the de-registration request is for non-3GPP access, the UE shall perform a local release of the PDU sessions over non-3GPP access, if any. If there is an MA PDU session with user plane resources established on both 3GPP access and non-3GPP access in the same PLMN or in different PLMNs, the UE shall perform a local release of the user plane resources on non-3GPP access. If there is an MA PDU session with a PDN connection as a user-plane resource and user plane resources established on non-3GPP access, the UE shall perform a local release of the user plane resources on non-3GPP access. If there is an MA PDU session with user plane resources established on non-3GPP access only, the UE shall perform a local release of the MA PDU session. The UE shall stop the timer(s) T3346, T3396, T3584 and T3585, if it is running. The UE shall send a DEREGISTRATION ACCEPT message to the network and enter the state 5GMM-DEREGISTERED for non-3GPP access. Furthermore, the UE shall, after the completion of the de-registration procedure, and the release of the existing NAS signalling connection, initiate an initial registration over non-3GPP. The UE should also re-establish any previously established PDU sessions over non-3GPP access. For any previously established MA PDU sessions with user plane resources established on both accesses the UE should also re-establish the user plane resources over non-3GPP access, and for any previously established MA PDU sessions with user plane resources established only on the non-3GPP access the UE should re-establish the MA PDU session over non-3GPP access, and for any previously established MA PDU sessions with a PDN connection as a user-plane resource and user plane resources established on non-3GPP access the UE should re-establish the user plane resources over non-3GPP access.\nUpon receiving the DEREGISTRATION REQUEST message, if the DEREGISTRATION REQUEST message indicates \"re-registration required\" and the de-registration request is for both 3GPP access and non-3GPP access when the UE is registered in the same PLMN for both accesses, the UE shall perform a local release of the MA PDU sessions and PDU sessions over both 3GPP access and non-3GPP access, if any. If an MA PDU session or a PDU sessions is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions. The UE shall stop the timer(s) T3346, T3396, T3584 and T3585, if it is running. The UE shall send a DEREGISTRATION ACCEPT message to the network and enter the state 5GMM-DEREGISTERED for both 3GPP access and non-3GPP access. Furthermore, the UE shall, after the completion of the de-registration procedure, and the release of the existing NAS signalling connection, if any Tsor-cm timer(s) were running and have stopped, the UE shall attempt to obtain service on a higher priority PLMN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) on 3GPP access, otherwise initiate an initial registration over both 3GPP access and non-3GPP access. The UE should also re-establish any previously established PDU sessions over both 3GPP access and non-3GPP access. For any previously established MA PDU sessions the UE should also re-establish the MA PDU session and the user plane resources which were established previously.\nNOTE\u00a01:\tWhen the de-registration type indicates \"re-registration required\", user interaction is necessary in some cases when the UE cannot re-establish the PDU session (s), if any, automatically.\nUpon receiving the DEREGISTRATION REQUEST message, if the DEREGISTRATION REQUEST message indicates \"re-registration not required\" and the de-registration request is for 3GPP access, the UE shall perform a local release of the PDU sessions over 3GPP access, if any. If a PDU session is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions. If there is an MA PDU session with user plane resources established on both 3GPP access and non-3GPP access in the same PLMN or in different PLMNs, the UE shall perform a local release of the user plane resources on 3GPP access. If there is an MA PDU session with user plane resources established on 3GPP access only, the UE shall perform a local release of the MA PDU session. If the MA PDU session is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions. The UE shall send a DEREGISTRATION ACCEPT message to the network and enter the state 5GMM-DEREGISTERED for 3GPP access.\nUpon receiving the DEREGISTRATION REQUEST message, if the DEREGISTRATION REQUEST message indicates \"re-registration not required\" and the de-registration request is for non-3GPP access, the UE shall perform a local release of the PDU sessions over non-3GPP access, if any. If there is an MA PDU session with user plane resources established on both 3GPP access and non-3GPP access in the same PLMN or in different PLMNs, the UE shall perform a local release of the user plane resources on non-3GPP access. If there is an MA PDU session with a PDN connection as a user-plane resource and user plane resources established on non-3GPP access, the UE shall perform a local release of the user plane resources on non-3GPP access. If there is an MA PDU session with user plane resources established on non-3GPP access only, the UE shall perform a local release of the MA PDU session. The UE shall send a DEREGISTRATION ACCEPT message to the network and enter the state 5GMM-DEREGISTERED for non-3GPP access.\nUpon receiving the DEREGISTRATION REQUEST message, if the DEREGISTRATION REQUEST message indicates \"re-registration not required\" and the de-registration request is for both 3GPP access and non-3GPP access when the UE is registered in the same PLMN for both accesses, the UE shall perform a local release of the MA PDU sessions and PDU sessions over both 3GPP access and non-3GPP access, if any. If an MA PDU session or a PDU session is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions. The UE shall send a DEREGISTRATION ACCEPT message to the network and enter the state 5GMM-DEREGISTERED for both 3GPP access and non-3GPP access.\nUpon receiving the DEREGISTRATION REQUEST message, if the DEREGISTRATION REQUEST message includes the rejected NSSAI, the UE takes the following actions based on the rejection cause in the rejected S-NSSAI(s):\n\"S-NSSAI not available in the current PLMN or SNPN\"\n\tThe UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN or SNPN as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over any access until switching off the UE, the UICC containing the USIM is removed, an entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, if the UE does not support access to an SNPN using credentials from a credentials holder and equivalent SNPNs, the selected entry of the \"list of subscriber data\" is updated, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\"S-NSSAI not available in the current registration area\"\n\tThe UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as described in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current registration area over the current access until switching off the UE, the UE moving out of the current registration area, the UICC containing the USIM is removed, an entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\"\n\tThe UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over any access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.1 and 4.6.2.2.\n\"S-NSSAI not available due to maximum number of UEs reached\"\n\tUnless the back-off timer value received along with the S-NSSAI is zero, the UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over the current access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclauses\u00a04.6.1 and\u00a04.6.2.2.\nNOTE\u00a02:\tIf the back-off timer value received along with the S-NSSAI in the rejected NSSAI for the maximum number of UEs reached is zero as specified in subclause\u00a010.5.7.4a of 3GPP\u00a0TS\u00a024.008\u00a0[12], the UE does not consider the S-NSSAI as the rejected S-NSSAI.\n\tIf there is one or more S-NSSAIs in the rejected NSSAI with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\", then for each S-NSSAI, the UE shall behave as follows:\na)\tstop the timer T3526 associated with the S-NSSAI, if running;\nb)\tstart the timer T3526 with:\n1)\tthe back-off timer value received along with the S-NSSAI, if a back-off timer value is received along with the S-NSSAI that is neither zero nor deactivated; or\n2)\tan implementation specific back-off timer value, if no back-off timer value is received along with the S-NSSAI; and\nc)\tremove the S-NSSAI from the rejected NSSAI for the maximum number of UEs reached when the timer T3526 associated with the S-NSSAI expires.\nUpon sending a DEREGISTRATION ACCEPT message, the UE shall delete the rejected NSSAI as specified in subclause\u00a04.6.2.2.\nRegardless of the 5GMM cause value received in the DEREGISTRATION REQUEST message via satellite NG-RAN,\n--\tif the UE receives the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE in the DEREGISTRATION REQUEST message, the UE shall store the TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE, if not already stored, into the list of \"5GS forbidden tracking areas for roaming\"; and\n-\tif the UE receives the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE in the DEREGISTRATION REQUEST message, the UE shall store the TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE, if not already stored, into the list of \"5GS forbidden tracking areas for regional provision of service\".\nUpon receiving the DEREGISTRATION REQUEST message, the 5G-RG shall delete the contexts of the AUN3 devices behind the 5G-RG, if any.\nIf the de-registration type indicates \"re-registration required\", then the UE shall ignore the 5GMM cause IE if received.\nIf the de-registration type indicates \"re-registration not required\", the UE shall take the actions depending on the received 5GMM cause value:\n#3\t(Illegal UE);\n#6\t(Illegal ME)\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n-\tIn case of PLMN, the UE shall consider the USIM as invalid for 5GS services until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause\u00a05.3.19A.1;\n\tIn case of SNPN, if the UE is not registered for onboarding services in SNPN and the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the UE shall consider the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN as invalid until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause 5.3.19A.2. In case of SNPN, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid for 3GPP access until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause 5.3.19A.2. Additionally, if EAP based primary authentication and key agreement procedure using EAP-AKA' or 5G AKA based primary authentication and key agreement procedure was performed in the current SNPN, the UE shall consider the USIM as invalid for the current SNPN until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.19A.2.\n\tIf the UE is not registered for onboarding services in SNPN, the UE shall delete the list of equivalent PLMNs (if any) or the list of equivalent SNPNs (if any), and shall enter the state 5GMM-DEREGISTERED.NO-SUPI.\n\tIf the de-registration request is for 3GPP access only or for both 3GPP access and non-3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\". The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause\u00a05.3.7a in 3GPP\u00a0TS\u00a024.301\u00a0[15].\n\tIf the UE is registered for onboarding services in SNPN, the UE shall reset the registration attempt counter, store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf the UE also supports the registration procedure over the other access, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#7\t(5GS services not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n\tIn case of PLMN, the UE shall consider the USIM as invalid for 5GS services until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.19A.1;\n\tIn case of SNPN, if the UE is not registered for onboarding services in SNPN and the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the UE shall consider the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN as invalid for 5GS services until the UE is switched off, or the entry is updated or the timer T3245 expires as described in subclause 5.3.19A.2. In case of SNPN, if the UE is not registered for onboarding services in SNPN and the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid for 3GPP access until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause 5.3.19A.2. Additionally, if EAP based primary authentication and key agreement procedure using EAP-AKA' or 5G AKA based primary authentication and key agreement procedure was performed in the current SNPN, the UE shall consider the USIM as invalid for the current SNPN until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.19A.2.\n\tIf the UE is not registered for onboarding services in SNPN, the UE shall enter the state 5GMM-DEREGISTERED.NO-SUPI.\n\tIf the de-registration request is for 3GPP access only or for both 3GPP access and non-3GPP access and and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\n\tIf the UE is registered for onboarding services in SNPN, the UE shall reset the registration attempt counter, store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf the UE also supports the registration procedure over the other access, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#11\t(PLMN not allowed).\n\tThis cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.2.3.4.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. The UE shall delete the list of equivalent PLMNs, shall reset the registration attempt counter. For 3GPP access the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH, and for non-3GPP access the UE shall enter state 5GMM-DEREGISTERED.LIMITED-SERVICE.\n\tThe UE shall store the PLMN identity in the forbidden PLMN list as specified in subclause\u00a05.3.13A and if the UE is configured to use timer T3245 then the UE shall start timer T3245 and proceed as described in subclause 5.3.19A.1.\n\tFor 3GPP access the UE shall perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5], and for non-3GPP access the UE shall perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18].\n\tIf the de-registration request is for 3GPP access only or for both 3GPP access and non-3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\n\tIf the UE also supports the registration procedure over the other access to the same PLMN, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n\tIf the UE receives the Disaster return wait range IE in the DEREGISTRATION REQUEST message and the UE supports MINT, the UE shall delete the disaster return wait range stored in the ME, if any, and store the disaster return wait range included in the Disaster return wait range IE in the ME.\n#12\t(Tracking area not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI and ngKSI. The UE shall reset the registration attempt counter and shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE.\n\tIf the UE is not operating in SNPN access operation mode and the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE is not included in the DEREGISTRATION REQUEST message, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for regional provision of service\". Otherwise, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for regional provision of service\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription.\n\tIf the de-registration request is for 3GPP access only or for both 3GPP access and non-3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters, EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\n#13\t(Roaming not allowed in this tracking area).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI, ngKSI, and the list of equivalent PLMNs (if available) or the list of equivalent SNPNs (if available). The UE shall reset the registration attempt counter. For 3GPP access the UE shall change to state 5GMM-DEREGISTERED.PLMN-SEARCH, and for non-3GPP access the UE shall change to state 5GMM-DEREGISTERED.LIMITED-SERVICE.\n\tIf the UE is not operating in SNPN access operation mode and the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE is not included in the DEREGISTRATION REQUEST message, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\". Otherwise, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription.\n\tFor 3GPP access the UE shall perform a PLMN selection or SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5], and for non-3GPP access the UE shall perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18].\n\tIf the de-registration request is for 3GPP access only or for both 3GPP access and non-3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\n#15\t(No suitable cells in tracking area).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI and ngKSI. The UE shall reset the registration attempt counter and shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE.\n\tIf the UE is not operating in SNPN access operation mode and the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE is not included in the DEREGISTRATION REQUEST message, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\". Otherwise, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription.\n\tThe UE shall search for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C].\n\tIf the de-registration request is for 3GPP access only or for both 3GPP access and non-3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\n\tIf received over non-3GPP access and de-registration request is for non-3GPP access only, the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.2.3.4.\n#22\t(Congestion).\n\tIf the T3346 value IE is present in the DEREGISTRATION REQUEST message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.2.3.4.\n\tThe UE shall stop timer T3346 if it is running, set the 5GS update status to 5U2 NOT UPDATED, reset the registration attempt counter and enter the state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION.\n\tThe UE shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the de-registration request is for 3GPP access only or for both 3GPP access and non-3GPP access and the UE is operating in the single-registration mode, the UE shall set the EPS update status to EU2 NOT UPDATED, reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.\n#27\t(N1 mode not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter and shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE.\n\tThe UE shall disable the N1 mode capability for both 3GPP access and non-3GPP access (see subclause\u00a04.9).\n\tIf the de-registration request is for 3GPP access only or for both 3GPP access and non-3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED and shall delete any 4G-GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.\n#36\t(IAB-node operation not authorized).\n\tThis cause value is only applicable when received over 3GPP access by a UE operating as an IAB-node. This cause value received from a 5G access network other than 3GPP access or received by a UE not operating as an IAB-node is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.2.3.4.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n\tIf:\n1)\tthe UE is not operating in SNPN access operation mode, \ni)\tthe UE shall delete the list of equivalent PLMNs and reset the registration attempt counter and store the PLMN identity in the forbidden PLMN list as specified in subclause 5.3.13A and if the UE is configured to use timer T3245 then the UE shall start timer T3245 and proceed as described in subclause\u00a05.3.19a.1. The UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5]; and\nii)\tIf the UE is operating in single-registration mode, the UE shall in addition handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\"; or\n2)\tthe UE is operating in SNPN access operation mode, \ni)\tthe UE shall reset the registration attempt counter and store the SNPN identity in the \"temporarily forbidden SNPNs\" list for 3GPP access and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. The UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n#62\t(No network slices available).\n\tThe UE shall set the 5GS update status to 5U2 NOT UPDATED and enter state 5GMM-DEREGISTERED.NORMAL-SERVICE or 5GMM-DEREGISTERED.PLMN-SEARCH. Additionally, the UE shall reset the registration attempt counter.\n\tThe UE receiving the rejected NSSAI in the DEREGISTRATION REQUEST message takes the following actions based on the rejection cause in the rejected S-NSSAI(s):\n\t\"S-NSSAI not available in the current PLMN or SNPN\"\n\tThe UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the current PLMN or SNPN as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current PLMN or SNPN over any access until switching off the UE, the UICC containing the USIM is removed, an entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\t\"S-NSSAI not available in the current registration area\"\n\tThe UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the current registration area as described in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI(s) in the current registration area over the current access until switching off the UE, the UE moving out of the current registration area, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\t\"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\"\n\tThe UE shall store the rejected S-NSSAI(s) in the rejected NSSAI for the failed or revoked NSSAA as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over any access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.1 and 4.6.2.2.\n\t\"S-NSSAI not available due to maximum number of UEs reached\"\n\tUnless the back-off timer value received along with the S-NSSAI is zero, the UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the maximum number of UEs reached as specified in subclause\u00a04.6.2.2 and shall not attempt to use this S-NSSAI in the current PLMN or SNPN over the current access until switching off the UE, the UICC containing the USIM is removed, the entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN is updated, or the rejected S-NSSAI(s) are removed as described in subclauses\u00a04.6.1 and\u00a04.6.2.2.\nNOTE\u00a03:\tIf the back-off timer value received along with the S-NSSAI in the rejected NSSAI for the maximum number of UEs reached is zero as specified in subclause\u00a010.5.7.4a of 3GPP\u00a0TS\u00a024.008\u00a0[12], the UE does not consider the S-NSSAI as the rejected S-NSSAI.\n\tIf there is one or more S-NSSAIs in the rejected NSSAI with the rejection cause \"S-NSSAI not available due to maximum number of UEs reached\", then for each S-NSSAI, the UE shall behave as follows:\na)\tstop the timer T3526 associated with the S-NSSAI, if running;\nb)\tstart the timer T3526 with:\n1)\tthe back-off timer value received along with the S-NSSAI, if a back-off timer value is received along with the S-NSSAI that is neither zero nor deactivated; or\n2)\tan implementation specific back-off timer value, if no back-off timer value is received along with the S-NSSAI; and\nc)\tremove the S-NSSAI from the rejected NSSAI for the maximum number of UEs reached when the timer T3526 associated with the S-NSSAI expires.\n\tIf the UE has an allowed NSSAI or configured NSSAI that contains S-NSSAI(s) which are not included in the rejected NSSAI, the UE may stay in the current serving cell, apply the normal cell reselection process and start an initial registration with a requested NSSAI that includes any S-NSSAI from the allowed NSSAI or the configured NSSAI that is not in the rejected NSSAI. Otherwise the UE may perform a PLMN selection or SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5] and additionally, the UE may disable the N1 mode capability for the current PLMN or SNPN if the UE does not have an allowed NSSAI and each S-NSSAI in configured NSSAI, if available, was rejected with cause \"S-NSSAI not available in the current PLMN or SNPN\" or \"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\" as described in subclause\u00a04.9.\n\tIf the UE has neither allowed NSSAI for the current PLMN or SNPN nor configured NSSAI for the current PLMN or SNPN and,\n1)\tif at least one S-NSSAI in the default configured NSSAI is not rejected, the UE may stay in the current serving cell, apply the normal cell reselection process, and start an initial registration with a requested NSSAI with that default configured NSSAI; or\n2)\tif all the S-NSSAI(s) in the default configured NSSAI are rejected and at least one S-NSSAI is rejected due to \"S-NSSAI not available in the current registration area\",\ni)\tif the UE is not operating in SNPN access operation mode and the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE is not included in the DEREGISTRATION REQUEST message, the UE shall store the TAI(s) belonging to current registration area in the list of \"5GS forbidden tracking areas for roaming\", memorize the TAI(s) belonging to current registration area were stored in the list of \"5GS forbidden tracking areas for roaming\" for S-NSSAI is rejected due to \"S-NSSAI not available in the current registration area\" and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. The UE shall search for a suitable cell in another tracking area not belonging to current registration area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C]; or\nii)\tif the UE is operating in SNPN access operation mode, the UE shall store the TAI(s) belonging to current registration area in the list of \"5GS forbidden tracking areas for roaming\", memorize the TAI(s) belonging to current registration area were stored in the list of \"5GS forbidden tracking areas for roaming\" for S-NSSAI is rejected due to \"S-NSSAI not available in the current registration area\" for the current SNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. The UE shall search for a suitable cell in another tracking area not belonging to current registration area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C].\n3)\totherwise, the UE may perform a PLMN selection or SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5] and additionally, the UE may disable the N1 mode capability for the current PLMN or SNPN if each S-NSSAI in the default configured NSSAI was rejected with cause \"S-NSSAI not available in the current PLMN or SNPN\" or \"S-NSSAI not available due to the failed or revoked network slice-specific authentication and authorization\" as described in subclause\u00a04.9.\n\tIf\n1)\tthe UE has allowed NSSAI for the current PLMN or SNPN or configured NSSAI for the current PLMN or SNPN or both and all the S-NSSAIs included in the allowed NSSAI or the configured NSSAI or both are rejected; or\n2)\tthe UE has neither allowed NSSAI for the current PLMN or SNPN nor configured NSSAI for the current PLMN or SNPN and all the S-NSSAIs included in the default configured NSSAI are rejected,\n\tand the UE has rejected NSSAI for the maximum number of UEs reached, and the UE wants to obtain services in the current serving cell without performing a PLMN selection or SNPN selection, the UE may stay in the current serving cell and attempt to use the rejected S-NSSAI(s) for the maximum number of UEs reached in the current serving cell after the rejected S-NSSAI(s) are removed as described in subclause\u00a04.6.2.2.\n\tIf the de-registration request is for 3GPP access only or for both 3GPP access and non-3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU2 NOT UPDATED, reset the attach attempt counter and enter the state EMM-DEREGISTERED.\n#72\t(Non-3GPP access to 5GCN not allowed).\n\tIf received over non-3GPP access when the UE is registered over non-3GPP access, or received over 3GPP access and de-registration request is for non-3GPP access when the UE is registered in the same PLMN for both accesses, the UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI for non-3GPP access. Additionally, the UE shall reset the registration attempt counter and enter the state 5GMM-DEREGISTERED for non-3GPP access.\nNOTE\u00a04:\tThe 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses\u00a04.7.2 and 5.1.3).\n\tThe UE shall disable the N1 mode capability for non-3GPP access (see subclause\u00a04.9.3).\n\tAs an implementation option, if the UE is not currently registered over 3GPP access, the UE may enter the state 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf received over 3GPP access and de-registration request is for 3GPP access only, the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.5.2.3.4.\n#74\t(Temporarily not authorized for this SNPN).\n\t5GMM cause #74 is only applicable when received from a cell belonging to an SNPN. 5GMM cause #74 received from a cell not belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.2.3.4.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list, ngKSI and the list of equivalent SNPNs (if available). The UE shall reset the registration attempt counter and shall store the SNPN identity in the \"temporarily forbidden SNPNs\" list or \"temporarily forbidden SNPNs for access for localized services in SNPN\" list if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) for the specific access type for which the message was received and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN using credentials from a credentials holder, the UE shall store the SNPN identity in the \"temporarily forbidden SNPNs\" list along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN providing access for localized services in SNPN and the access for localized services in SNPN has been enabled, the UE shall store the SNPN identity in the list of \"temporarily forbidden SNPNs for access for localized services in SNPN\" (if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE is not registered for onboarding services in SNPN, the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the UE is registered for onboarding services in SNPN, the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n#75\t(Permanently not authorized for this SNPN).\n\t5GMM cause #75 is only applicable when received from a cell belonging to an SNPN with a globally-unique SNPN identity. 5GMM cause #75 received from a cell not belonging to an SNPN or a cell belonging to an SNPN with a non-globally-unique SNPN identity is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.2.3.4.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list, ngKSI and the list of equivalent SNPNs (if available). The UE shall reset the registration attempt counter and store the SNPN identity in the \"permanently forbidden SNPNs\" list or \"permanently forbidden SNPNs for access for localized services in SNPN\" list if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) for the specific access type for which the message was received and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN using credentials from a credentials holder, the UE shall store the SNPN identity in the \"permanently forbidden SNPNs\" list along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN providing access for localized services in SNPN and the access for localized services in SNPN has been enabled, the UE shall store the SNPN identity in the list of \"permanently forbidden SNPNs for access for localized services in SNPN\" (if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE is not registered for onboarding services in SNPN, the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the UE is registered for onboarding services in SNPN, the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n#76\t(Not authorized for this CAG or authorized for CAG cells only).\n\tThis cause value received via non-3GPP access or from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.2.3.4.\n\tThe UE shall set the 5GS update status to 5U3.ROAMING NOT ALLOWED, store the 5GS update status according to subclause\u00a05.1.3.2.2, and reset the registration attempt counter.\n\tIf 5GMM cause #76 is received from:\n1)\ta CAG cell, and if the UE receives a \"CAG information list\" in the CAG information list IE or the Extended CAG information list IE included in the DEREGISTRATION REQUEST message, the UE shall:\ni)\treplace the \"CAG information list\" stored in the UE with the received CAG information list IE or the Extended CAG information list IE when received in the HPLMN or EHPLMN;\nii)\treplace the serving VPLMN's entry of the \"CAG information list\" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; or\nNOTE\u00a05:\tWhen the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored.\niii)\tremove the serving VPLMN's entry of the \"CAG information list\" stored in the UE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry.\n\tOtherwise, the UE shall delete the CAG-ID(s) of the cell from the \"allowed CAG list\" for the current PLMN, if the CAG-ID(s) are authorized based on the \"Allowed CAG list\". In the case the \"allowed CAG list\" for the current PLMN only contains a range of CAG-IDs, how the UE deletes the CAG-ID(s) of the cell from the \"allowed CAG list\" for the current PLMN is up to UE implementation. In addition:\ni)\tif the entry in the \"CAG information list\" for the current PLMN does not include an \"indication that the UE is only allowed to access 5GS via CAG cells\" or if the entry in the \"CAG information list\" for the current PLMN includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and one or more CAG-ID(s) are authorized based on the updated \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\";\nii)\tif the entry in the \"CAG information list\" for the current PLMN includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and no CAG-ID is authorized based on the updated \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP TS 23.122 [5] with the updated \"CAG information list\"; or\niii)\tif the \"CAG information list\" does not include an entry for the current PLMN, then the UE shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\".\n2)\ta non-CAG cell, and if the UE receives a \"CAG information list\" in the CAG information list IE or the Extended CAG information list IE included in the DEREGISTRATION REQUEST message, the UE shall:\ni)\treplace the \"CAG information list\" stored in the UE with the received CAG information list IE or the Extended CAG information list IE when received in the HPLMN or EHPLMN;\nii)\treplace the serving VPLMN's entry of the \"CAG information list\" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; or\nNOTE\u00a06:\tWhen the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored.\niii)\tremove the serving VPLMN's entry of the \"CAG information list\" stored in the UE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry.\n\tOtherwise, the UE shall store an \"indication that the UE is only allowed to access 5GS via CAG cells\" in the entry of the \"CAG information list\" for the current PLMN, if any. If the \"CAG information list\" stored in the UE does not include the current PLMN's entry, the UE shall add an entry for the current PLMN to the \"CAG information list\" and store an \"indication that the UE is only allowed to access 5GS via CAG cells\" in the entry of the \"CAG information list\" for the current PLMN. If the UE does not have a stored \"CAG information list\", the UE shall create a new \"CAG information list\" and add an entry with an \"indication that the UE is only allowed to access 5GS via CAG cells\" for the current PLMN.\nIn addition:\ni)\tif one or more CAG-ID(s) are authorized based on the \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] with the updated CAG information; or\nii)\tif no CAG-ID is authorized based on the \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP TS 23.122 [5] with the updated \"CAG information list\".\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED, reset the attach attempt counter and enter the state EMM-DEREGISTERED.\n#77\t(Wireline access area not allowed).\n\t5GMM cause #77 is only applicable when received from a wireline access network by the 5G-RG or the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device). 5GMM cause #77 received from a 5G access network other than a wireline access network and 5GMM cause #77 received by the W-AGF acting on behalf of the FN-BRG are considered as abnormal cases and the behaviour of the UE is specified in subclause\u00a05.5.2.3.4.\n\tWhen received over wireline access network, the 5G-RG and the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device) shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2), shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI, shall reset the registration attempt counter, shall enter the state 5GMM-DEREGISTERED and shall act as specified in subclause\u00a05.3.23.\nNOTE\u00a07:\tThe 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses\u00a04.7.2 and 5.1.3).\n#78\t(PLMN not allowed to operate at the present UE location).\n\tThis cause value received from a non-satellite NG-RAN cell is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.2.3.4.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI and ngKSI. Additionally, the UE shall reset the registration attempt counter. The UE shall store the PLMN identity and, if it is known, the current geographical location in the list of \"PLMNs not allowed to operate at the present UE location\" and shall start a corresponding timer instance (see subclause\u00a04.23.2). The UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf the de-registration request is for 3GPP access only or for both 3GPP access and non-3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list, eKSI and attach attempt counter as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when a DETACH REQUEST is received with the EMM cause with the same value and with detach type set to \"re-attach not required\".\n#79\t(UAS services not allowed).\n-\tA UE which is not a UE supporting UAS services receiving this cause value shall considered it as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.2.3.4.\n\tA UE supporting UAS service shall set the 5GS update status to 5U2 NOT UPDATED and enter state 5GMM-DEREGISTERED.NORMAL-SERVICE or 5GMM-DEREGISTERED.PLMN-SEARCH. Additionally, the UE shall reset the registration attempt counter. If the UE re-attempt the registration procedure to the current PLMN, the UE shall not include the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of REGISTRATION REQUEST message.\n\tIf the de-registration request is for 3GPP access only or for both 3GPP access and non-3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU2 NOT UPDATED, reset the attach attempt counter and enter the state EMM-DEREGISTERED.\n#93\t(Onboarding services terminated).\n\tIf the UE is not registered for onboarding services in SNPN, this cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.5.2.3.4.\n\tIf the UE is not operating in SNPN access operation mode, the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf the UE is operating in SNPN access operation mode, the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\nNOTE\u00a08:\tIn case the configuration of one or more entries of the \"list of subscriber data\" was not completed at the time of network-initiated de-registration procedure, the UE can retry registration after the de-registration procedure is completed.\n5.5.2.3.3\tNetwork-initiated de-registration procedure completion by the network\nThe network shall stop timer T3522 upon receipt of the DEREGISTRATION ACCEPT message. The network shall enter state 5GMM-DEREGISTERED for 3GPP access if the de-registration request is for 3GPP access. The network shall enter state 5GMM-DEREGISTERED for non-3GPP access if the de-registration request is for non-3GPP access. The network shall enter state 5GMM-DEREGISTERED for both 3GPP access and non-3GPP access if the de-registration request is for both 3GPP access and non-3GPP access.\n5.5.2.3.4\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tTransmission failure of DEREGISTRATION ACCEPT message indication from lower layers.\n\tThe de-registration procedure shall be progressed and the UE shall send the DEREGISTRATION ACCEPT message.\nb)\tDEREGISTRATION REQUEST, other 5GMM cause values than those treated in subclause\u00a05.5.2.3.2, cases of 5GMM cause value#11, #15, #22, #72, #74, #75, #76, #77, #78, #79 and #93 that are considered as abnormal cases according to subclause\u00a05.5.2.3.2 or no 5GMM cause IE is included, and the De-registration type IE indicates \"re-registration not required\".\n\tThe UE shall delete TAI list, last visited registered TAI and list of equivalent PLMNs (if any) or list of equivalent SNPNs (if any), shall set the 5GS update status to 5U2 NOT UPDATED and shall start timer T3502. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI and ngKSI.\n\tA UE not supporting S1 mode may enter the state 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection or SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5]; otherwise the UE shall enter the state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION.\n\tIf the de-registration request is for 3GPP access only or for both 3GPP access and non-3GPP access and the UE is operating in the single-registration mode, the UE shall:\n-\tenter the state 5GMM-DEREGISTERED and attempt to select E-UTRAN radio access technology and proceed with the appropriate EMM specific procedures. In this case, the UE may disable the N1 mode capability (see subclause\u00a04.9); or\n-\tenter the state 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf the message was received via 3GPP access and the UE is operating in the single-registration mode, the UE shall set the EPS update status to EU2 NOT UPDATED, enter the state EMM-DEREGISTERED and shall delete the EMM parameters 4G-GUTI, last visited registered TAI, TAI list and eKSI.\n5.5.2.3.5\tAbnormal cases in the network side\nThe following abnormal cases can be identified:\na)\tT3522 time-out\n\tOn the first expiry of the timer, the network shall retransmit the DEREGISTRATION REQUEST message and shall start timer T3522. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3522, the de-registration procedure shall be aborted. The network shall change to the state 5GMM-DEREGISTERED for the access type which the de-registration procedure is intended for.\nb)\tLower layer failure\n\tThe de-registration procedure is aborted. The network shall change to the state 5GMM-DEREGISTERED for the access type which the de-registration procedure is intended for.\nc)\tDe-registration procedure collision\n\tIf the network receives a DEREGISTRATION REQUEST message with \"switch off\" indication, before the network-initiated de-registration procedure has been completed:\n-\tIf the access type included in the DEREGISTRATION REQUEST message sent by the UE is same as access type sent by the network, both procedures shall be considered completed; or\n-\tIf the access type included in the DEREGISTRATION REQUEST message sent by the UE is not same as access type sent by the network, the network shall consder UE initiated de-registration completed. The network shall re-initiate the de-registration procedure, if required, for the access type not indicated in the DEREGISTRATION REQUEST message sent by the UE.\n\tIf the network receives a DEREGISTRATION REQUEST message without \"switch off\" indication, before the network-initiated de-registration procedure has been completed, the network shall send a DEREGISTRATION ACCEPT message to the UE.\nd)\tDe-registration and registration procedure for initial registration collision\n\tIf the network receives a REGISTRATION REQUEST message indicating either \"initial registration\" or \"emergency registration\" in the 5GS registration type IE before the network-initiated de-registration procedure has been completed, the network shall abort the de-registration procedure and the registration procedure shall be progressed after the PDU sessions associated with the access type the REGISTRATION REQUEST message is sent over have been deleted.\nNOTE\u00a01:\tThe above collision case is valid if the DEREGISTRATION REQUEST message indicates the access type over which the initial registration procedure is attempted otherwise both the procedures are progressed.\ne)\tDe-registration and registration procedure for mobility and periodic registration update collision\n\tIf the network sent a DEREGISTRATION REQUEST message without 5GMM cause value #11, #12, #13 or #15 and the network receives a REGISTRATION REQUEST message indicating either \"mobility registration updating\" or \"periodic registration updating\" in the 5GS registration type IE before the network-initiated de-registration procedure has been completed, the de-registration procedure shall be progressed, i.e. the REGISTRATION REQUEST message shall be ignored.\n\tIf the network sent a DEREGISTRATION REQUEST message with 5GMM cause value #11, #12, #13 or #15 and the network receives a REGISTRATION REQUEST message indicating either \"mobility registration updating\" or \"periodic registration updating\" in the 5GS registration type IE before the network-initiated de-registration procedure has been completed, the de-registration procedure shall be aborted and the registration procedure shall be progressed.\nNOTE\u00a02:\tThe above collision case is valid if the DEREGISTRATION REQUEST message indicates the access type over which the mobility and periodic registration procedure is attempted otherwise both the procedures are progressed.\nf)\tDe-registration and service request procedure collision\n\tIf the network receives a SERVICE REQUEST message or a CONTROL PLANE SERVICE REQUEST message before the network-initiated de-registration procedure has been completed (e.g. the DEREGISTRATION REQUEST message is pending to be sent to the UE), the network shall progress the de-registration procedure.\nNOTE\u00a03:\tThe above collision case is valid if the DEREGISTRATION REQUEST message indicates the access type over which the service request procedure is attempted otherwise both the procedures are progressed.\ng)\tDe-registration requested for a UE not supporting CAG due to CAG restrictions\n\tBased on operator policy, if the network-initiated de-registration procedure is triggered for a UE not supporting CAG due to CAG restrictions, the network shall send the DEREGISTRATION REQUEST message including a 5GMM cause value other than the 5GMM cause #76 (Not authorized for this CAG or authorized for CAG cells only).\nNOTE\u00a04:\t5GMM cause #7 (5GS services not allowed), 5GMM cause #11 (PLMN not allowed), 5GMM cause #27 (N1 mode not allowed), 5GMM cause #73 (Serving network not authorized) can be used depending on the subscription of the UE and whether the UE roams or not.\n5.5.3\teCall inactivity procedure\nThe eCall inactivity procedure is performed only in 3GPP access and applicable only to a UE configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22]. The procedure shall be started when:\na)\tthe UE is in any 5GMM-REGISTERED substate except substates 5GMM-REGISTERED.PLMN-SEARCH or 5GMM-REGISTERED.NO-CELL-AVAILABLE;\nb)\tthe UE is in 5GMM-IDLE mode or 5GMM-CONNECTED mode with RRC inactive indication; and\nc)\tone of the following conditions applies:\n1)\ttimer T3444 expires or is found to have already expired and timer T3445 is not running;\n2)\ttimer T3445 expires or is found to have already expired and timer T3444 is not running; or\n3)\ttimers T3444 and T3445 expire or are found to have already expired.\nThe UE shall then perform the following actions:\na)\tstop other running timers (e.g. T3511, T3512);\nb)\tif the UE is currently registered to the network for 5GS services, perform a de-registration procedure;\nc)\tdelete any 5G-GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs, and ngKSI; and\nd)\tenter 5GMM-DEREGISTERED.eCALL-INACTIVE state.\n5.5.4\tAuthentication and key agreement procedure for 5G ProSe UE-to-network relay and 5G ProSe UE-to-UE relay\n5.5.4.1\tGeneral\nThe purpose of the authentication and key agreement procedure:\na)\tfor 5G ProSe UE-to-network relay, is to perform the authentication for 5G ProSe remote UE initiated by the 5G ProSe UE-to-network relay UE and to agree on the KAUSF_P and KNR_ProSe when the security for 5G ProSe communication via 5G ProSe UE-to-network relay is performed over control plane as specified in 3GPP\u00a0TS\u00a033.503\u00a0[56]; or\nb)\tfor 5G ProSe UE-to-UE relay, is to perform the authentication for 5G ProSe end UE initiated by the 5G ProSe UE-to-UE relay UE and to agree on the KAUSF_P and KNR_ProSe when the security for 5G ProSe communication via 5G ProSe UE-to-UE relay is performed over control plane as specified in 3GPP\u00a0TS\u00a033.503\u00a0[56].\nThe procedure as shown in figure\u00a05.5.4.1.1 is initiated by the UE when the UE receives the ProSe direct link establishment request including the SUCI or the CP-PRUK ID of:\na)\tthe 5G ProSe remote UE from the 5G ProSe remote UE; or\nb)\tthe 5G ProSe end UE from the 5G ProSe end UE,\nfor establishing secure PC5 unicast link as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E].\nIf the network decides to process the relay key request message, the EAP based authentication and key agreement procedure is initiated and controlled by the network. The exchanges of EAP messages between:\na)\tthe 5G ProSe remote UE and the network; or\nb)\tthe 5G ProSe end UE and the network,\nare relayed by the UE.\n\n\nFigure\u00a05.5.4.1.1: Authentication and key agreement procedure for 5G ProSe UE-to-network relay and 5G ProSe UE-to-UE relay\n5.5.4.2\tProSe relay transaction identity (PRTI)\nUpon receiving a ProSe direct link establishment request from a 5G ProSe remote UE or a 5G ProSe end UE for establishing a secure PC5 unicast link as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall allocate an available PRTI value for the authentication and key agreement procedure for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay and associate this PRTI value with the 5G ProSe remote UE or the 5G ProSe end UE.\nThe UE shall release the PRTI value allocated to the authentication and key agreement procedure for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay when the authentication and key agreement procedure for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay completes or is aborted.\n5.5.4.3\tUE-initiated authentication and key agreement procedure initiation\nUpon receiving a ProSe direct link establishment request from the 5G ProSe remote UE or the 5G ProSe end UE including the SUCI or the CP-PRUK ID of the 5G ProSe remote UE or the 5G ProSe end UE, for establishing a secure PC5 unicast link as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E] when the security for 5G ProSe communication via 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay is performed over control plane as specified in 3GPP\u00a0TS\u00a033.503\u00a0[56], the UE shall:\na)\tallocate a PRTI value as specified in subclause\u00a05.5.4.2;\nb)\tcreate a RELAY KEY REQUEST message;\nc)\tset the PRTI IE of the RELAY KEY REQUEST message to the allocated PRTI value;\nd)\tset the relay key request parameters IE of the RELAY KEY REQUEST message with SUCI or the CP-PRUK ID, relay service code, and nonce_1 received from the of the 5G ProSe remote UE or the 5G ProSe end UE;\ne)\tsend the RELAY KEY REQUEST message; and\nf)\tstart the timer T3527 upon sending the RELAY KEY REQUEST message.\n5.5.4.4\tUE-initiated authentication and key agreement procedure accepted by the network\nUpon receiving the RELAY KEY REQUEST message, the AMF processes the message and interacts with the AUSF of the 5G ProSe remote UE or the 5G ProSe end UE as specified in 3GPP\u00a0TS\u00a033.503\u00a0[56]. If EAP-AKA' authentication for the 5G ProSe remote UE or the 5G ProSe end UE is initiated by the network, the AMF shall:\na)\tcreate a RELAY AUTHENTICATION REQUEST message;\nb)\tset the PRTI IE of the RELAY AUTHENTICATION REQUEST message to the PRTI value of the received RELAY KEY REQUEST message;\nc)\tset the EAP message IE of the RELAY AUTHENTICATION REQUEST message to EAP request message received from the AUSF; and\nd)\tsend the RELAY AUTHENTICATION REQUEST message to the UE.\nUpon receiving the RELAY AUTHENTICATION REQUEST message, the UE stops the timer T3527 and forwards the EAP message to the 5G ProSe remote UE or the 5G ProSe end UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E].\nUpon receiving the EAP response message from the 5G ProSe remote UE or the 5G ProSe end UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], the UE shall:\na)\tcreate a RELAY AUTHENTICATION RESPONSE message;\nb)\tset the PRTI IE of the RELAY AUTHENTICATION RESPONSE message to the PRTI value of the received RELAY AUTHENTICATION REQUEST message;\nc)\tset the EAP message IE of the RELAY AUTHENTICATION RESPONSE message to EAP response message received from the 5G ProSe remote UE or the 5G ProSe end UE; and\nd)\tstart a timer T3527 upon sending the RELAY AUTHENTICATION RESPONSE message to the AMF.\nAfter receiving the RELAY AUTHENTICATION RESPONSE message, the AMF may send a new RELAY AUTHENTICATION REQUEST message carrying EAP request message according to further handling of EAP-AKA' authentication from the AUSF as specified in 3GPP\u00a0TS\u00a033.503\u00a0[56]. The UE repeats the handling of the RELAY AUTHENTICATION REQUEST message as described above.\nUpon receiving the message from the AUSF that the authentication is successful, the AMF shall:\na)\tcreate a RELAY KEY ACCEPT message;\nb)\tset the PRTI IE of the RELAY KEY ACCEPT message to the PRTI value of the RELAY KEY REQUEST message;\nc)\tinclude the EAP message IE of the RELAY KEY ACCEPT message set to EAP-success message received from the AUSF, if any;\nd)\tinclude the relay key response parameters IE of the RELAY KEY ACCEPT message set to KNR_ProSe and nonce_2 received from AUSF; and\ne)\tinclude the CP-PRUK ID in the relay key response parameters IE of the RELAY KEY ACCEPT message.\nUpon receiving the RELAY KEY ACCEPT message, the UE shall forward the EAP-success message, if any, and nonce_2 to the 5G ProSe remote UE or the 5G ProSe end UE as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], and consider the authentication as completed successfully. The UE shall store the CP-PRUK ID to be used in the remote UE report procedure as specified in subclause\u00a06.6.2.2.\n5.5.4.5\tUE-initiated authentication and key agreement procedure not accepted by the network\nIf the UE-initiated authentication and key agreement procedure is not accepted by the network, the AMF shall:\na)\tcreate a RELAY KEY REJECT message;\nb)\tset the PRTI IE of the RELAY KEY REJECT message to the PRTI value of the received RELAY KEY REQUEST message if the network decides to reject the RELAY KEY REQUEST message; or\nNOTE:\tThe network decides to reject the RELAY KEY REQUEST message when e.g. the CP-PRUK is not found in the network.\n\tset the PRTI IE of the RELAY KEY REJECT message to the PRTI value of the received RELAY AUTHENTICATION RESPONSE message and include the EAP message IE set with EAP-failure message if the AMF receives an EAP-failure message from the AUSF; and\nc)\tsend the RELAY KEY REJECT message to the UE.\nUpon receiving the RELAY KEY REJECT message, the UE shall consider the authentication has failed and perform the PC5 signalling protocol procedure as specified in subclause\u00a07.2.2.5 of 3GPP\u00a024.554\u00a0[19E].\n5.5.4.6\tAbnormal cases in the UE\nThe following abnormal cases in the UE can be identified:\na)\tTransmission failure of RELAY KEY REQUEST message or RELAY KEY AUTHENTICATION RESPONSE message indication from lower layers.\n\tThe UE shall abort the authentication and key agreement procedure for 5G ProSe UE-to-network relay and perform the PC5 signalling protocol procedure as specified in subclause\u00a07.2.2.5 of 3GPP\u00a024.554\u00a0[19E].\nb)\tExpiry of timer T3527.\n\tThe UE shall, on the first expiry of the timer T3527, retransmit the RELAY KEY REQUEST message or the RELAY KEY AUTHENTICATION RESPONSE message and shall reset and start timer T3527. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3527, the procedure shall be aborted.\nc)\tCollision between the authentication and key agreement procedure for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay and de-registration procedure.\n\tThe UE shall abort the authentication and key agreement procedure for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay, proceed with the network initiated de-registration procedure, and perform the PC5 signalling protocol procedure as specified in subclause\u00a07.2.2.5 of 3GPP\u00a024.554\u00a0[19E].\n5.5.4.7\tAbnormal cases on the network side\nThe following abnormal cases on the network side can be identified:\na)\tLower layer failure before the RELAY KEY AUTHENTICATION RESPONSE message is received.\n\tThe network shall abort the authentication and key agreement procedure for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay.\nb)\tCollision between the authentication and key agreement procedure for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay and de-registration procedure.\n\tThe network shall abort the authentication and key agreement procedure for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay and proceed with the UE-initiated de-registration procedure.\nc)\tCollision between the authentication and key agreement procedure for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay and other 5GMM procedures other than in item\u00a0b.\n\tThe network shall progress both procedures.\n5.6\t5GMM connection management procedures\n5.6.1\tService request procedure\n5.6.1.1\tGeneral\nThe purpose of the service request procedure is to change the 5GMM mode from 5GMM-IDLE to 5GMM-CONNECTED mode. If the UE is not using 5GS services with control plane CIoT 5GS optimization, this procedure is used to request the establishment of user-plane resources for PDU sessions which are established without user-plane resources. In latter case, the 5GMM mode can be the 5GMM-IDLE mode or the 5GMM-CONNECTED mode if the UE requires to establish user-plane resources for PDU sessions. If the UE is using 5GS services with control plane CIoT 5GS optimization, this procedure can be used for UE initiated transfer of user data via the control plane from 5GMM-IDLE mode.\nNOTE\u00a01:\tThe lower layer indicates when the user-plane resources for PDU sessions are successfully established or released.\nThis procedure is used when:\n-\tthe network has downlink signalling pending over 3GPP access and the UE is in 5GMM-IDLE mode over 3GPP access;\n-\tthe network has downlink signalling pending over non-3GPP access, the UE is in 5GMM-IDLE mode over non-3GPP access and in 5GMM-IDLE or 5GMM-CONNECTED mode over 3GPP access;\n-\tthe UE has uplink signalling pending over 3GPP access and the UE is in 5GMM-IDLE mode over 3GPP access;\n-\tthe network has downlink user data pending over 3GPP access and the UE is in 5GMM-IDLE mode over 3GPP access;\n-\tthe network has downlink user data pending over non-3GPP access, the UE is in 5GMM-IDLE mode over non-3GPP access and in 5GMM-IDLE or 5GMM-CONNECTED mode over 3GPP access;\n-\tthe UE has user data pending over 3GPP access and the UE is in 5GMM-IDLE or 5GMM-CONNECTED mode over 3GPP access;\n-\tthe UE has user data pending over non-3GPP access and the UE is in 5GMM-CONNECTED mode over non-3GPP access;\n-\tthe UE in 5GMM-IDLE mode over non-3GPP access, receives an indication from the lower layers of non-3GPP access, that the access stratum connection is established between the UE and the network, if T3346 is not running;\n-\tthe UE in 5GMM-IDLE or 5GMM-CONNECTED mode over 3GPP access receives a request from the upper layers to perform emergency services fallback and performs emergency services fallback as specified in subclause\u00a04.13.4.2 of 3GPP\u00a0TS\u00a023.502\u00a0[9];\n-\tthe UE has to request resources for V2X communication over PC5;\n-\tthe UE has to request resources for 5G ProSe direct discovery over PC5 or 5G ProSe direct communication over PC5;\n-\tthe UE has to request resources for A2X communication over PC5;\nNOTE\u00a02:\tThe purpose for the UE to request resources for V2X communication over PC5, 5G ProSe direct discovery over PC5 and 5G ProSe direct communication over PC5 can be to perform the ranging and sidelink positioning service over PC5.\n-\tthe MUSIM UE in 5GMM-IDLE mode requests the network to remove the paging restriction;\n-\tthe MUSIM UE requests the release of the NAS signalling connection or rejects the paging request from the network; or\n-\tthe UE supporting the reconnection to the network due to RAN timing synchronization status change receives an indication of a change in the RAN timing synchronization status.\nThis procedure shall not be used for:\na)\tinitiating user data transfer or CIoT user data via the control plane; or\nb)\tPDU session management related signalling other than for performing UE-requested PDU session release procedure related to a PDU session for LADN or for performing the UE-requested PDU session modification procedure to indicate a change of 3GPP PS data off UE status;\nwhen the UE is located outside the LADN service area.\nIn NB-N1 mode, this procedure shall not be used to request the establishment of user-plane resources: \na)\tfor a number of PDU sessions that exceeds the UE' s maximum number of supported user-plane resources if there is currently:\n1)\tno user-plane resources established for the UE;\n2)\tuser-plane resources established for:\ni)\tone PDU session and the Multiple user-plane resources support bit was set to \"Multiple user-plane resources not supported\" in the 5GMM capability IE; or\nii)\ttwo PDU sessions and the Multiple user-plane resources support bit was set to \"Multiple user-plane resources supported\" in the 5GMM capability IE; or\nb)\tfor additional PDU sessions, if the number of PDU sessions for which user-plane resources are currently established is equal to the UE's maximum number of supported user-plane resources.\nThe service request procedure is initiated by the UE, however, it can be triggered by the network by means of:\n-\tthe paging procedure (see subclause\u00a05.6.2) for the transfer of downlink signalling or user data pending over 3GPP access to a UE in 5GMM-IDLE mode over 3GPP access;\n-\tthe paging procedure (see subclause\u00a05.6.2) for the transfer of downlink signalling or user data pending over non-3GPP access to a UE in 5GMM-IDLE mode over 3GPP access and in 5GMM-IDLE mode over non-3GPP access;\n-\tthe notification procedure (see subclause\u00a05.6.3) for the transfer of downlink signalling or user data pending over non-3GPP access to a UE in 5GMM-CONNECTED mode over 3GPP access and in 5GMM-IDLE mode over non-3GPP access; or\n-\tthe notification procedure (see subclause\u00a05.6.3) for the transfer of downlink signalling or user data pending over 3GPP access to a UE in 5GMM-IDLE mode over 3GPP access and in 5GMM-CONNECTED mode over non-3GPP access.\nNOTE\u00a03:\tIn case the UE is in 5GMM-IDLE mode over 3GPP access and in 5GMM-CONNECTED mode over non-3GPP access and downlink signalling or user data pending over 3GPP access needs to be transferred, the AMF can trigger either the notification procedure or the paging procedure based on implementation.\nThe UE shall invoke the service request procedure when:\na)\tthe UE, in 5GMM-IDLE mode over 3GPP access, receives a paging request from the network;\nNOTE\u00a04:\tAs an implementation option, the MUSIM UE is allowed to not invoke service request to respond to paging based on the information available in the paging message, e.g. voice service indication.\nb)\tthe UE, in 5GMM-CONNECTED mode over 3GPP access, receives a notification from the network with access type indicating non-3GPP access;\nc)\tthe UE, in 5GMM-IDLE mode over 3GPP access, has uplink signalling pending (except in case\u00a0i);\nd)\tthe UE, in 5GMM-IDLE mode over 3GPP access, has uplink user data pending (except in case\u00a0j);\ne)\tthe UE, in 5GMM-CONNECTED mode or in 5GMM-CONNECTED mode with RRC inactive indication, has user data pending due to no user-plane resources established for PDU session(s) used for user data transport;\nf)\tthe UE in 5GMM-IDLE mode over non-3GPP access, with T3346 not active or upon expiry of T3346, receives or has already received an indication from the lower layers of non-3GPP access, that the access stratum connection is established between the UE and the network;\ng)\tthe UE, in 5GMM-IDLE mode over 3GPP access, receives a notification from the network with access type indicating 3GPP access when the UE is in 5GMM-CONNECTED mode over non-3GPP access;\nh)\tthe UE, in 5GMM-IDLE, 5GMM-CONNECTED mode over 3GPP access, or 5GMM-CONNECTED mode with RRC inactive indication, receives a request from the upper layers to perform emergency services fallback and performs emergency services fallback as specified in subclause\u00a04.13.4.2 of 3GPP\u00a0TS\u00a023.502\u00a0[9];\ni)\tthe UE, in 5GMM-CONNECTED mode over 3GPP access or in 5GMM-CONNECTED mode with RRC inactive indication, receives a fallback indication from the lower layers (see subclauses\u00a05.3.1.2 and 5.3.1.4) and the UE has a pending NAS procedure other than a registration, service request, or de-registration procedure; the UE, in 5GMM-CONNECTED mode over 3GPP access, receives a \"RRC Connection failure\" from the lower layers and the UE has a pending NAS procedure other than a registration, service request, or de-registration procedure;\nj)\tthe UE, in 5GMM-CONNECTED mode over 3GPP access or in 5GMM-CONNECTED mode with RRC inactive indication, receives a fallback indication from the lower layers (see subclauses\u00a05.3.1.2 and\u00a05.3.1.4) and the UE has pending uplink user data for PDU session(s) with user-plane resources already established but no pending NAS procedure; the UE, in 5GMM-CONNECTED mode over 3GPP access, receives a \"RRC Connection failure\" indication from the lower layers and the UE has pending uplink user data for PDU session(s) with user-plane resources already established but no pending NAS procedure;\nk)\tthe UE, in 5GMM-CONNECTED mode and has a NAS signalling connection only, is using 5GS services with control plane CIoT 5GS optimization and has pending user data to be sent via user-plane resources;\nl)\tthe UE in 5GMM-IDLE mode over 3GPP access has to request resources for V2X communication over PC5 (see 3GPP\u00a0TS\u00a023.287\u00a0[6C]);\nla)\tthe UE in 5GMM-IDLE mode over 3GPP access has to request resources for A2X communication over PC5 (see 3GPP\u00a0TS\u00a023.256\u00a0[6AB]);\nm)\tthe network supports the paging restriction, and the MUSIM UE in 5GMM-IDLE mode is requesting the network to remove the paging restriction;\nn)\tthe UE in 5GMM-IDLE mode over 3GPP access\n-\thas to request resources for 5G ProSe direct discovery over PC5 or 5G ProSe direct communication over PC5 (see 3GPP\u00a0TS\u00a023.304\u00a0[6E]); or\n-\tacts as a 5G ProSe layer-2 UE-to-network relay UE and receives a trigger from lower layers to establish the NAS signalling connection (see 3GPP\u00a0TS\u00a023.304\u00a0[6E]);\no)\tthe network supports the N1 NAS signalling connection release, the MUSIM UE,\n-\tis in 5GMM-CONNECTED mode, requests the network to release the NAS signalling connection and, if the network supports the paging restriction, optionally includes paging restriction;\n-\tis in 5GMM-CONNECTED mode with RRC inactive indication, requests the network to release the NAS signalling connection and, if the network supports the paging restriction, optionally includes paging restriction; or\n-\tis in 5GMM-CONNECTED mode with RRC inactive indication, rejects the RAN paging, requests the network to release the NAS signalling connection and, if the network supports the paging restriction, optionally includes paging restriction;\np)\tthe network supports the reject paging request, the MUSIM UE in 5GMM-IDLE mode when responding to paging rejects the paging request from the network, requests the network to release the NAS signalling connection and, if the network supports the paging restriction, optionally includes paging restriction; or\nq)\tthe UE supporting the reconnection to the network due to RAN timing synchronization status change has been requested to reconnect to the network upon receiving an indication of a change in the RAN timing synchronization status (see subclauses\u00a05.4.4.2, 5.5.1.2.4, and 5.5.1.3.4) and the UE in 5GMM-IDLE mode receives an indication of a change in the RAN timing synchronization status;\nIf one of the above criteria to invoke the service request procedure is fulfilled, then the service request procedure shall only be initiated by the UE when the following conditions are fulfilled:\n-\tits 5GS update status is 5U1 UPDATED, and the TAI of the current serving cell is included in the TAI list; and\n-\tno 5GMM specific procedure is ongoing.\nThe UE shall not invoke the service request procedure when the UE is in the state 5GMM-SERVICE-REQUEST-INITIATED.\nThe MUSIM UE shall not initiate service request procedure for requesting the network to release the N1 NAS signalling connection if the UE is registered for emergency services or if the UE has an emergency PDU session established. To enable the emergency call back, the UE shall not initiate service request procedure for requesting the network to release the NAS signalling connection for a UE implementation-specific duration of time after the completion of the emergency services.\nThe UE supporting S-NSSAI location validity information shall not invoke the service request procedure to establish user-plane resources for PDU sessions associated to an S-NSSAI when the UE is not in the NS-AoS of the S-NSSAI.\n\nFigure\u00a05.6.1.1.1: Service Request procedure (Part 1)\n\nFigure\u00a05.6.1.1.2: Service Request procedure (Part 2)\nA service request attempt counter is used to limit the number of service request attempts and no response from the network. The service request attempt counter shall be incremented as specified in subclause\u00a05.6.1.7.\nThe service request attempt counter shall be reset when:\n-\ta registration procedure for mobility and periodic registration update is successfully completed;\n-\ta service request procedure is successfully completed;\n-\ta service request procedure is rejected as specified in subclause\u00a05.6.1.5 or subclause\u00a05.3.20; or\n-\tthe UE moves to 5GMM-DEREGISTERED state.\n5.6.1.2\tService request procedure initiation\n5.6.1.2.1\tUE is not using 5GS services with control plane CIoT 5GS optimization\nThe UE initiates the service request procedure by sending a SERVICE REQUEST message to the AMF. The UE shall start timer T3517 and enter the state 5GMM-SERVICE-REQUEST-INITIATED.\nIf the UE is sending the SERVICE REQUEST message from 5GMM-IDLE mode and the UE needs to send non-cleartext IEs, the UE shall send the SERVICE REQUEST message including the NAS message container IE as described in subclause\u00a04.4.6.\nFor cases a), b), and g) in subclause\u00a05.6.1.1, the service type IE in the SERVICE REQUEST message shall be set to \"mobile terminated services\".\nFor cases c), d), e), f), i), j), l), la, m), n), and q) in subclause\u00a05.6.1.1, if the UE is a UE configured for high priority access in selected PLMN or SNPN, the service type IE in the SERVICE REQUEST message shall be set to \"high priority access\".\nFor case a) in subclause\u00a05.6.1.1:\na)\tif the paging request includes an indication for non-3GPP access type, the Allowed PDU session status IE shall be included in the SERVICE REQUEST message. If the UE has PDU session(s) associated with non-3GPP access for which the associated S-NSSAI(s) are included in the allowed NSSAI for 3GPP access or the S-NSSAI associated with the PDU session is included in the partially allowed NSSAI for 3GPP access and the TAI where the UE is currently camped is in list of TAs for which the S-NSSAI is allowed, the UE shall indicate the PDU session(s) for which the UE allows the user-plane resources to be re-established over 3GPP access in the Allowed PDU session status IE. Otherwise, the UE shall not indicate any PDU session(s) in the Allowed PDU session status IE; and\nb)\tif the UE has uplink user data pending to be sent over 3GPP access, the Uplink data status IE shall be included in the SERVICE REQUEST message to indicate the PDU session(s) for which the UE has pending user data to be sent. Otherwise, the Uplink data status IE shall not be included in the SERVICE REQUEST message.\nFor case b) in subclause\u00a05.6.1.1:\na)\tthe Allowed PDU session status IE shall be included in the SERVICE REQUEST message. If the UE has PDU session(s) associated with non-3GPP access for which the associated S-NSSAI(s) are included in the allowed NSSAI for 3GPP access or the S-NSSAI associated with the PDU session is included in the partially allowed NSSAI for 3GPP access and the TAI where the UE is currently camped is in list of TAs for which the S-NSSAI is allowed, the UE shall indicate the PDU session(s) for which the UE allows the user-plane resources to be re-established over 3GPP access in the Allowed PDU session status IE. Otherwise, the UE shall not indicate any PDU session(s) in the Allowed PDU session status IE; and\nb)\tif the UE has uplink user data pending to be sent over 3GPP access, the Uplink data status IE shall be included in the SERVICE REQUEST message to indicate the PDU session(s) for which the UE has pending user data to be sent. Otherwise, the Uplink data status IE shall not be included in the SERVICE REQUEST message.\nFor cases a) and b) in subclause\u00a05.6.1.1, if the UE is in a non-allowed area or the UE is not in an allowed area, the UE shall set the Allowed PDU session status IE as specified in subclause\u00a05.3.5.2.\nWhen the Allowed PDU session status IE is included in the SERVICE REQUEST message, the UE shall indicate that a PDU session is not allowed to be transferred to the 3GPP access if the 3GPP PS data off UE status is \"activated\" for the corresponding PDU session and the UE is not using the PDU session to send uplink IP packets for any of the 3GPP PS data off exempt services (see subclause\u00a06.2.10).\nFor case c) in subclause\u00a05.6.1.1, the Uplink data status IE shall not be included in the SERVICE REQUEST message except if the UE has one or more active always-on PDU sessions associated with the access type over which the SERVICE REQUEST message is sent. If the UE is not a UE configured for high priority access in selected PLMN or SNPN and:\na)\tif the SERVICE REQUEST message is triggered by a request for emergency services from the upper layer, the UE shall set the service type IE in the SERVICE REQUEST message to \"emergency services\"; or\nb)\totherwise, the UE shall set the service type IE to \"signalling\".\nWhen the UE is in a non-allowed area or is not in an allowed area as specified in subclause\u00a05.3.5 and:\na)\tif the uplink signalling pending is to indicate a change of 3GPP PS data off UE status for a PDU session, the UE shall set the service type IE in the SERVICE REQUEST message to \"elevated signalling\", and shall not include the Uplink data status IE in the SERVICE REQUEST message even if the UE has one or more active always-on PDU sessions associated with the access type over which the SERVICE REQUEST message is sent; or\nb)\totherwise, the UE shall not initiate service request procedure except for emergency services, high priority access or responding to paging or notification.\nFor cases d) and e) in subclause\u00a05.6.1.1, the Uplink data status IE shall be included in the SERVICE REQUEST message to indicate the PDU session(s) the UE has pending user data to be sent. If the UE is not a UE configured for high priority access in selected PLMN or SNPN:\na)\tif there exists an emergency PDU session which is indicated in the Uplink data status IE the service type IE in the SERVICE REQUEST message shall be set to \"emergency services\"; or\nb)\totherwise, the service type IE in the SERVICE REQUEST message shall be set to \"data\".\nNOTE\u00a01:\tFor a UE in NB-N1 mode, the Uplink data status IE cannot be used to request the establishment of user-plane resources such that there will be user-plane resources established for a number of PDU sessions that exceeds the UE's maximum number of supported user-plane resources.\nFor case f) in subclause\u00a05.6.1.1:\na)\tif the UE has uplink user data pending to be sent, the Uplink data status IE shall be included in the SERVICE REQUEST message to indicate the PDU session(s) the UE has pending user data to be sent. If the UE is not a UE configured for high priority access in selected PLMN or SNPN, the service type IE in the SERVICE REQUEST message shall be set to \"data\";\nb)\totherwise, if the UE is not a UE configured for high priority access in selected PLMN or SNPN, the service type IE in the SERVICE REQUEST message shall be set to \"signalling\".\nFor case g) in subclause\u00a05.6.1.1, if the UE has uplink user data pending to be sent, the Uplink data status IE shall be included in the SERVICE REQUEST message to indicate the PDU session(s) the UE has pending user data to be sent.\nFor case h) in subclause\u00a05.6.1.1, the UE shall send a SERVICE REQUEST message with service type set to \"emergency services fallback\" and without an Uplink data status IE.\nFor case i) in subclause\u00a05.6.1.1, if the UE is not configured for high priority access in selected PLMN or SNPN, the UE shall set the Service type IE in the SERVICE REQUEST message as follows:\na)\tif the pending message is an UL NAS TRANSPORT message with the Request type IE set to \"initial emergency request\" or \"existing emergency PDU session\", the UE shall set the Service type IE in the SERVICE REQUEST message to \"emergency services\"; or\nb)\totherwise, the UE shall set the Service type IE in the SERVICE REQUEST message to \"signalling\".\nFor case\u00a0j) in subclause\u00a05.6.1.1:\na)\tthe UE shall include the Uplink data status IE in the SERVICE REQUEST message indicating the PDU session(s) for which the UE has uplink user data pending and the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication or \"RRC Connection failure\" indication from the lower layers, if any; and\nb)\tif the UE is not a UE configured for high priority access in selected PLMN or SNPN, the UE shall set the Service type IE in the SERVICE REQUEST message as follows:\n1)\tif there is an emergency PDU session which is indicated in the Uplink data status IE, the UE shall set the Service type IE in the SERVICE REQUEST message to \"emergency services\"; or\n2)\tif there is no emergency PDU session which is indicated in the Uplink data status IE, the UE shall set the Service type IE in the SERVICE REQUEST message to \"data\".\nFor cases l), la, n), and q) in subclause\u00a05.6.1.1, if the UE is not a UE configured for high priority access in selected PLMN or SNPN:\na)\tif there exists an emergency PDU session which is indicated in the Uplink data status IE the service type IE in the SERVICE REQUEST message shall be set to \"emergency services\"; or\nb)\totherwise, the service type IE in the SERVICE REQUEST message shall be set to \"signalling\".\nFor case m) in subclause\u00a05.6.1.1, the UE shall not include the Paging restriction IE in the SERVICE REQUEST message and set Service type to \"signalling\". The UE may include the UE request type IE and set Request type to \"NAS signalling connection release\" to remove the paging restriction and request the release of the NAS signalling connection at the same time. If the UE requests the release of the NAS signalling connection, the UE shall not include the Uplink data status IE in the SERVICE REQUEST message.\nFor cases o) and p) in subclause\u00a05.6.1.1, the UE shall not include the Uplink data status IE and the Allowed PDU session status IE in the SERVICE REQUEST message. Further,\n-\tfor case o in subclause\u00a05.6.1.1, the UE shall set Request type to \"NAS signalling connection release\" in the UE request type IE and Service type to \"signalling\";\n-\tfor case p in subclause\u00a05.6.1.1, the UE shall set Request type to \"Rejection of paging\" in the UE request type IE and Service type to \"mobile terminated services\"; and\nmay include its paging restriction preference in the Paging restriction IE in the SERVICE REQUEST message.\nThe UE shall include a valid 5G-S-TMSI in the 5G-S-TMSI IE of the SERVICE REQUEST message.\nFor all cases except cases o) and p) in subclause\u00a05.6.1.1, if the UE has one or more active always-on PDU sessions associated with the access type over which the SERVICE REQUEST message is sent and the user-plane resources for these PDU sessions are not established, the UE shall include the Uplink data status IE in the SERVICE REQUEST message and indicate that the UE has pending user data to be sent for those PDU sessions.\nIf the UE has one or more active PDU sessions which are not accepted by the network as always-on PDU sessions and no uplink user data pending to be sent for those PDU sessions, the UE shall not include those PDU sessions in the Uplink data status IE in the SERVICE REQUEST message.\nThe Uplink data status IE may be included in the SERVICE REQUEST message to indicate which PDU session(s) associated with the access type the SERVICE REQUEST message is sent over have pending user data to be sent or are associated with active multicast MBS session(s). If the UE is located outside the LADN service area of a PDU session, the UE shall not include the PDU session for LADN in the Uplink data status IE.\nIf the UE is in a non-allowed area or the UE is not in an allowed area, the UE shall apply the restrictions for the inclusion of the Uplink data status IE specified in subclause\u00a05.3.5.2.\nThe PDU session status information element may be included in the SERVICE REQUEST message to indicate:\n-\tthe single access PDU session(s) not in 5GSM state PDU SESSION INACTIVE in the UE associated with the access type the SERVICE REQUEST message is sent over; and\n-\tthe MA PDU session(s) not in 5GSM state PDU SESSION INACTIVE and having the corresponding user plane resources being established or established in the UE on the access the SERVICE REQUEST message is sent over.\nIf the SERVICE REQUEST message includes a NAS message container IE, the AMF shall process the SERVICE REQUEST message that is obtained from the NAS message container IE as described in subclause\u00a04.4.6.\nIf the UE has an emergency PDU session over the non-current access, it shall not initiate the SERVICE REQUEST message with the service type IE set to \"emergency services\" over the current access, unless the SERVICE REQUEST message has to be initiated to perform handover of an existing emergency PDU session from the non-current access to the current access.\nNOTE\u00a02:\tTransfer of an existing emergency PDU session between 3GPP access and non-3GPP access is needed e.g. if the UE determines that the current access is no longer available.\n5.6.1.2.2\tUE is using 5GS services with control plane CIoT 5GS optimization\nThe UE shall send a CONTROL PLANE SERVICE REQUEST message, start T3517 and enter the state 5GMM-SERVICE-REQUEST-INITIATED.\nFor case a), and case b) in subclause\u00a05.6.1.1, the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate \"mobile terminating request\". If:\na)\tthe UE only has uplink CIoT user data or SMS to be sent, the UE shall:\n1)\tif the data size is not more than 254 octets and there is no other optional IE to be included in the message:\ni)\tfor sending CIoT user data, set the Data type field to \"control plane user data\", include the PDU session ID, data, and Downlink data expected (DDX) (if available), in the CIoT small data container IE; and\nii)\tfor sending SMS, set the Data type field to \"SMS\", include SMS in the CIoT small data container IE; and\n2)\totherwise if the data size is more than 254 octets or there are other optional IEs to be included in the message:\ni)\tfor sending CIoT user data, set the Payload container type IE to \"CIoT user data container\", include the PDU session ID in the PDU session ID IE and include data in the Payload container IE as described in subclause\u00a05.4.5.2.2; and\nii)\tfor sending SMS, set the Payload container type IE to \"SMS\" and include data in the Payload container IE as described in subclause\u00a05.4.5.2.2; and\nb)\tthe paging request or the notification includes an indication for non-3GPP access type, the UE has at least one PDU session that is not associated with control plane only indication, the Allowed PDU session status IE shall be included in the CONTROL PLANE SERVICE REQUEST message. If the UE is in a non-allowed area or the UE is not in an allowed area, the UE shall set the Allowed PDU session status IE as specified in subclause\u00a05.3.5.2. If the UE has PDU session(s) associated with non-3GPP access for which the associated S-NSSAI(s) are included in the allowed NSSAI for 3GPP access or the S-NSSAI associated with the PDU session is included in the partially allowed NSSAI for 3GPP access and the TAI where the UE is currently camped is in list of TAs for which the S-NSSAI is supported, the UE shall indicate the PDU session(s) for which the UE allows the user-plane resources to be re-established over 3GPP access in the Allowed PDU session status IE. Otherwise, the UE shall not indicate any PDU session(s) in the Allowed PDU session status IE.\nNOTE\u00a01:\tThe term DDX used in the present document corresponds to the term NAS RAI used in 3GPP\u00a0TS\u00a023.502\u00a0[9].\nFor case c), and case d), when the UE is located outside the LADN service area, the UE shall not perform the service request procedure to send CIoT user data via the control plane for a PDU session for LADN.\nFor case c), and case d) if the UE has pending CIoT user data that is to be sent via the control plane in subclause\u00a05.6.1.1, the UE shall set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to \"mobile originating request\". If the UE has only uplink CIoT user data, SMS or location services message to be sent, the UE shall:\na)\tif the data size is not more than 254 octets, there is no other optional IE to be included in the CONTROL PLANE SERVICE REQUEST message, and the data being sent is:\n1)\tCIoT user data, set the Data type field to \"control plane user data\", include the PDU session ID, data, and Downlink data expected (DDX) (if available), in the CIoT small data container IE;\n2)\tlocation services message, set the Data type field to \"Location services message container\" and Downlink data expected (DDX), if available, in the CIoT small data container IE, and:\ni)\tif routing information is provided by upper layers:\nA)\tset the length of additional information field in the CIoT small data container IE to the length of routing information provided by upper layer location services application (see subclause\u00a09.11.3.67), and set the additional information field in the CIoT small data container IE to the routing information provided by upper layer location services application (see subclause\u00a09.11.3.67); or\nB)\totherwise set the length of additional information field in the CIoT small data container IE to zero. In this case the Additional information field of the CIoT small data container IE shall not be included; and\nii)\tset the Data contents field of the CIoT small data container IE to the location services message payload; or\n3)\tSMS, set the Data type field to \"SMS\", include SMS in the CIoT small data container IE; or\nb)\totherwise if the data size is more than 254 octets or there are other optional IEs to be included in the CONTROL PLANE SERVICE REQUEST message, and the data being sent is:\n1)\tCIoT user data, set the Payload container type IE to \"CIoT user data container\", include the PDU session ID in the PDU session ID IE and include data in the Payload container IE as described in subclause\u00a05.4.5.2.2;\n2)\tlocation services message, set the Payload container type IE to \"Location services message container\", include data in the Payload container IE as described in subclause\u00a05.4.5.2.2. If the upper layer location services application provides the routing information set the Additional information IE to the routing information as described in subclause\u00a05.4.5.2.2; or\n3)\tSMS, set the Payload container type IE to \"SMS\" and include data in the Payload container IE as described in subclause\u00a05.4.5.2.2.\nFor case a), and case b) in subclause\u00a05.6.1.1, if the UE has pending user data that is to be sent via the user plane, the UE shall set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to \"mobile terminating request\". The UE shall include the Uplink data status IE in the CONTROL PLANE SERVICE REQUEST message to indicate which PDU session(s) have pending user data to be sent via user-plane resources.\nFor case c) in subclause\u00a05.6.1.1, if the UE is in WB-N1 mode and the CONTROL PLANE SERVICE REQUEST message is triggered by a request for emergency services from the upper layer, the UE shall set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to \"emergency services\".\nFor cases d) and k), if the UE has pending user data that is to be sent via the user plane in subclause\u00a05.6.1.1:\na)\tand if there exists an emergency PDU session which is indicated in the Uplink data status IE, the UE shall set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to \"emergency services\"; or\nb)\totherwise, the UE shall set the Control plane service type to \"mobile originating request\".\nThe UE shall include the Uplink data status IE in the CONTROL PLANE SERVICE REQUEST message to indicate which PDU session(s) have pending user data to be sent via user-plane resources or are associated with active multicast MBS session(s).\nNOTE\u00a02:\tFor a UE in NB-N1 mode, the Uplink data status IE cannot be used to request the establishment of user-plane resources such that there will be user-plane resources established for a number of PDU sessions that exceeds the UE's maximum number of supported user-plane resources.\nFor case h) in subclause\u00a05.6.1.1, if the UE is in WB-N1 mode and the UE does not have any PDU session that is associated with control plane only indication, the UE shall send a CONTROL PLANE SERVICE REQUEST message with the Control plane service type set to \"emergency services fallback\" and without an Uplink data status IE.\nFor case i) in subclause\u00a05.6.1.1, the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate \"mobile originating request\". If the pending message is an UL NAS TRANSPORT message with the Payload container type IE set to:\na)\t\"SMS\", \"Location services message container\", or \"CIoT user data container\", the UE shall send the CONTROL PLANE SERVICE REQUEST and include the SMS, location services message, or CIoT user data as described in this subclause; or\nb)\totherwise, the UE shall send the CONTROL PLANE SERVICE REQUEST:\n1)\twithout including the CIoT small data container IE and without including the NAS message container IE if the UE has no other optional IE to be sent; or\n2)\twith the NAS message container IE if the UE has an optional IE to be sent as described in this subclause.\nFor case\u00a0j) in subclause\u00a05.6.1.1, the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate \"mobile originating request\". The UE shall include the Uplink data status IE in the CONTROL PLANE SERVICE REQUEST message indicating the PDU session(s) for which user-plane resources were active prior to receiving the fallback indication, if any.\nFor cases o) and p) in subclause\u00a05.6.1.1, the UE shall not include the Uplink data status IE and the Allowed PDU session status IE in the CONTROL PLANE SERVICE REQUEST message. Further,\n-\tfor case o) in subclause\u00a05.6.1.1, the UE shall set Request type to \"NAS signalling connection release\" in the UE request type IE and Control plane service type to \"mobile originating request\";\n-\tfor case p) in subclause\u00a05.6.1.1, the UE shall set Request type to \"Rejection of paging\" in the UE request type IE and Control plane service type to \"mobile terminating request\"; and\nmay include its paging restriction preferences in the Paging restriction IE in the CONTROL PLANE SERVICE REQUEST message.\nFor case m) in subclause\u00a05.6.1.1, the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate \"mobile originating request\". The UE shall not include the Paging restriction IE in the CONTROL PLANE SERVICE REQUEST message. The UE may include the UE request type IE and set Request type to \"NAS signalling connection release\" to remove the paging restriction and request the release of the NAS signalling connection at the same time. If the UE requests the release of the NAS signalling connection, the UE shall not include the Uplink data status IE in the SERVICE REQUEST message. For all cases, if the UE includes the Uplink data status IE and the UE is located outside the LADN service area of a PDU session, the UE shall not include the PDU session for LADN in the Uplink data status IE.\nIf the UE is in a non-allowed area or the UE is not in an allowed area, the UE shall apply the restrictions for the inclusion of the Uplink data status IE specified in subclause\u00a05.3.5.2.\nThe UE may include the PDU session status IE in the CONTROL PLANE SERVICE REQUEST message to indicate which PDU session(s) associated with the access type the CONTROL PLANE SERVICE REQUEST message is sent over are active in the UE.\n5.6.1.3\tCommon procedure initiation\nUpon receipt of the SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message, the AMF may initiate the common procedures e.g. the 5G AKA based primary authentication and key agreement procedure or the EAP based primary authentication and key agreement procedure.\n5.6.1.4\tService request procedure accepted by the network\n5.6.1.4.1\tUE is not using 5GS services with control plane CIoT 5GS optimization\nFor cases other than h) in subclause\u00a05.6.1.1, the UE shall treat the reception of the SERVICE ACCEPT message as successful completion of the procedure. The UE shall reset the service request attempt counter, stop timer T3517 and enter the state 5GMM-REGISTERED.\nFor case h) in subclause\u00a05.6.1.1,\na)\tthe UE shall treat the indication from the lower layers when the UE has changed to S1 mode or E-UTRA connected to 5GCN (see 3GPP\u00a0TS\u00a023.502\u00a0[9]) as successful completion of the procedure and stop timer T3517;\nb)\tif a UE operating in single-registration mode has changed to S1 mode, it shall disable the N1 mode capability for 3GPP access (see subclause\u00a04.9.2); and\nc)\tthe AMF shall not check for CAG restrictions.\nIf the PDU session status information element is included in the SERVICE REQUEST message, then:\na)\tfor single access PDU sessions, the AMF shall:\n1)\tperform a local release of all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE on the AMF side associated with the access type the SERVICE REQUEST message is sent over, but are indicated by the UE as being in 5GSM state PDU SESSION INACTIVE; and\n2)\trequest the SMF to perform a local release of all those PDU sessions. If any of those PDU sessions is associated with one or more multicast MBS sessions, the SMF shall consider the UE as removed from the associated multicast MBS sessions; and\nb)\tfor MA PDU sessions, the AMF shall:\n1)\tfor MA PDU sessions having user plane resources established in the AMF only on the access the SERVICE REQUEST message is sent over, but are indicated by the UE as no user plane resources established:\ni)\tfor all those MA PDU sessions without a PDN connection established as a user-plane resource, perform a local release of all those MA PDU sessions and request the SMF to perform a local release of all those MA PDU sessions. If the MA PDU session is associated with one or more multicast MBS sessions, the SMF shall consider the UE as removed from the associated multicast MBS sessions; and\nii) \tfor all those MA PDU sessions with a PDN connection established as a user-plane resource, perform a local release of user plane resources of all those PDU sessions on the access the SERVICE REQUEST message is sent over and request the SMF to perform a local release of user plane resources of all those PDU sessions on the access type the SERVICE REQUEST message is sent over; and\n2)\tfor MA PDU sessions having user plane resources established on both accesses in the AMF, but are indicated by the UE as no user plane resources established:\ni)\tperform a local release of user plane resources of all those PDU sessions on the access the SERVICE REQUEST message is sent over; and\nii)\trequest the SMF to perform a local release of user plane resources of all those PDU sessions on the access type the SERVICE REQUEST message is sent over. If the SERVICE REQUEST message is sent over 3GPP access and the MA PDU session is associated with one or more multicast MBS sessions, the SMF shall consider the UE as removed from the associated multicast MBS sessions.\nIf the AMF needs to initiate PDU session status synchronization or a PDU session status IE was included in the SERVICE REQUEST message, the AMF shall include a PDU session status IE in the SERVICE ACCEPT message to indicate:\n-\twhich single access PDU sessions associated with the access type the SERVICE ACCEPT message is sent over are not in 5GSM state PDU SESSION INACTIVE in the AMF; and\n-\twhich MA PDU sessions are not in 5GSM state PDU SESSION INACTIVE and having user plane resources established in the AMF on the access the SERVICE ACCEPT message is sent over.\nIf the PDU session status information element is included in the SERVICE ACCEPT message, then:\na)\tfor single access PDU sessions, the UE shall perform a local release of all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING on the UE side associated with the access type the SERVICE ACCEPT message is sent over, but are indicated by the AMF as in 5GSM state PDU SESSION INACTIVE. If a locally released PDU session is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions; and\nb)\tfor MA PDU sessions, for all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING and have user plane resources established on the UE side associated with the access the SERVICE ACCEPT message is sent over, but are indicated by the AMF as no user plane resources established:\n1)\tfor MA PDU sessions having user plane resources established only on the access type the SERVICE ACCEPT message is sent over, the UE shall perform a local release of those MA PDU sessions. If a locally released MA PDU session is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions; and\n2)\tfor MA PDU sessions having user plane resources established on both accesses, the UE shall perform a local release on the user plane resources on the access type the SERVICE ACCEPT message is sent over. If the user plane resources over 3GPP access are released and the MA PDU session is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions.\nIf the Uplink data status IE is included in the SERVICE REQUEST message and the UE is:\na)\tnot in NB-N1 mode; or\nb)\tin NB-N1 mode and the UE does not indicate a request to have user-plane resources established for a number of PDU sessions that exceeds the UE's maximum number of supported user-plane resources;\nthe AMF shall:\na)\tindicate the SMF to re-establish the user-plane resources for the corresponding PDU sessions;\nb)\tinclude the PDU session reactivation result IE in the SERVICE ACCEPT message to indicate the user-plane resources re-establishment result of the PDU sessions for which the UE requested to re-establish the user-plane resources; and\nc)\tdetermine the UE presence in LADN service area (see subclause\u00a06.2.6) and forward the UE presence in LADN service area towards the SMF, if the corresponding PDU session is a PDU session for LADN.\nIf the Allowed PDU session status IE is included in the SERVICE REQUEST message, the AMF shall:\na)\tfor a 5GSM message from each SMF that has indicated pending downlink signalling only, forward the received 5GSM message via 3GPP access to the UE after the SERVICE ACCEPT message is sent;\nb)\tfor each SMF that has indicated pending downlink data only:\n1)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed if the corresponding PDU session ID(s) are not indicated in the Allowed PDU session status IE; and\n2)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed if:\ni)\tfor a UE not in NB-N1 mode, the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE; or\nii)\tfor a UE in NB-N1 mode, the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE, and the resulting number of PDU sessions with established user-plane resources does not exceed the UE's maximum number of supported user-plane resources;\nc)\tfor each SMF that have indicated pending downlink signalling and data:\n1)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed if the corresponding PDU session ID(s) are not indicated in the Allowed PDU session status IE;\n2)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed if:\ni)\tfor a UE not in NB-N1 mode, the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE; or\nii)\tfor a UE in NB-N1 mode, the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE, and the resulting number of PDU sessions with established user-plane resources does not exceed the UE's maximum number of supported user-plane resources; and\n3)\tdiscard the received 5GSM message for PDU session(s) associated with non-3GPP access; and\nd)\tinclude the PDU session reactivation result IE in the SERVICE ACCEPT message to indicate the successfully re-established user-plane resources for the corresponding PDU sessions, if any.\nIf due to regional subscription restrictions or access restrictions the UE is not allowed to access the TA or due to CAG restrictions the UE is not allowed to access the cell, but the UE has an emergency PDU session established, the AMF may accept the SERVICE REQUEST message and indicate to the SMF to perform a local release of all non-emergency PDU sessions (associated with 3GPP access if it is due to CAG restrictions) and informs the UE via the PDU session status IE in the SERVICE ACCEPT message. The AMF shall not indicate to the SMF to release the emergency PDU session. If the AMF indicated to the SMF to perform a local release of all non-emergency PDU sessions (associated with 3GPP access if it is due to CAG restrictions), the network shall behave as if the UE is registered for emergency services.\nIf the PDU session reactivation result IE is included in the SERVICE ACCEPT message indicating that the user-plane resources have been successfully reactivated for a PDU session that was indicated by the UE in the Allowed PDU session status IE as allowed to be re-established over 3GPP access, the UE considers the corresponding PDU session to be associated with the 3GPP access. If the user-plane resources of a PDU session have been successfully reactivated over the 3GPP access, the AMF and SMF update the associated access type of the corresponding PDU session.\nIf the user-plane resources cannot be established for a PDU session, the AMF shall include the PDU session reactivation result IE in the SERVICE ACCEPT message indicating that user-plane resources for the corresponding PDU session cannot be re-established, and:\na)\tif the user-plane resources cannot be established because the SMF indicated to the AMF that the UE is located out of the LADN service area (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]), the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #43 \"LADN not available\";\nb)\tif the user-plane resources cannot be established because the SMF indicated to the AMF that only prioritized services are allowed (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]), the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #28 \"restricted service area\";\nc)\tif the user-plane resources cannot be established because the SMF indicated to the AMF that the resource is not available in the UPF (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]), the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #92 \"insufficient user-plane resources for the PDU session\";\nd)\tif the user-plane resources cannot be established because the SMF indicated to the AMF that the S-NSSAI associated with the PDU session is unavailable due to NSAC (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]), the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #69 \"insufficient resources for specific slice\"; or\ne)\totherwise, the AMF may include the PDU session reactivation result error cause IE to indicate the cause of failure to re-establish the user-plane resources.\nNOTE\u00a01:\tIt is up to UE implementation when to re-send a request for user-plane re-establishment for the associated PDU session after receiving a PDU session reactivation result error cause IE with a 5GMM cause set to #92 \"insufficient user-plane resources for the PDU session\".\nNOTE\u00a02:\tThe UE can locally start a back-off timer after receiving a PDU session reactivation result error cause IE with a 5GMM cause set to #69 \"insufficient resources for specific slice\". The value of the back-off timer is up to UE implementation. Upon expiry of the back-off timer, the UE can re-send a request for user-plane re-establishment for the associated PDU session.\nFor case a and b, \n-\tif the AMF has a service area list or LADN information which is applicable to the current TAI of the UE and was not yet provided to the UE, before sending the SERVICE ACCEPT message the AMF shall initiate the generic UE configuration update procedure and include the service area list or LADN information or both in the CONFIGURATION UPDATE COMMAND message; and \n-\tif timer T3540 is not started (see subclause\u00a05.3.1.3, item f), and the UE did not receive a CONFIGURATION UPDATE COMMAND message during the service request procedure, the UE may initiate a registration procedure for mobility or periodic registration update. If timer T3540 is started and the UE does not receive a CONFIGURATION UPDATE COMMAND message before the established N1 NAS signalling connection is released by the network or timer T3540 expires or is stopped as specified in subclause\u00a05.3.1.3, the UE may initiate the registration procedure for mobility or periodic registration update upon release of the N1 NAS signalling connection.\nIf the PDU session reactivation result IE is included in the SERVICE ACCEPT message indicating that the user-plane resources cannot be established for a PDU session that was indicated by the UE in the Allowed PDU session status IE as allowed to be re-established over 3GPP access, the UE considers the corresponding PDU session to be associated with the non-3GPP access.\nIf the MUSIM UE does not include the Paging restriction IE in the SERVICE REQUEST message, the AMF shall delete any stored paging restriction for the UE and stop restricting paging.\nFor case m in subclause\u00a05.6.1.1 when the MUSIM UE sets the Request type to \"NAS signalling connection release\" in the SERVICE REQUEST message, the AMF shall initiate the release of the N1 NAS signalling connection after the completion of the service request procedure.\nFor cases o and p in subclause\u00a05.6.1.1 when the MUSIM UE sets the Request type to \"NAS signalling connection release\" or to \"Rejection of paging\" in the UE request type IE in the SERVICE REQUEST message and if the UE requests restriction of paging by including the Paging restriction IE, the AMF:\n-\tif accepts the paging restriction, shall include the 5GS additional request result IE in the SERVICE ACCEPT message and set the Paging restriction decision to \"paging restriction is accepted\". The AMF shall store the paging restriction of the UE and enforce these restrictions in the paging procedure as described in subclause\u00a05.6.2; or\n-\tif rejects the paging restriction, shall include the 5GS additional request result IE in the SERVICE ACCEPT message and set the Paging restriction decision to \"paging restriction is rejected\", and shall discard the received paging restriction. The AMF shall delete any stored paging restriction for the UE and stop restricting paging; and\nthe AMF shall initiate the release of the N1 NAS signalling connection as follows:\n-\tfor case o in subclause\u00a05.6.1.1, after the completion of the service request procedure;\n-\tfor case p in subclause\u00a05.6.1.1, after the completion of the generic UE configuration update procedure that is triggered after the completion of the service request procedure.\nIf the SERVICE REQUEST message is for emergency services fallback, the AMF triggers the emergency services fallback procedure as specified in subclause\u00a04.13.4.2 of 3GPP\u00a0TS\u00a023.502\u00a0[9].\nIf the UE having an emergency PDU session associated with 3GPP access sent the SERVICE REQUEST message via:\na)\ta CAG cell and none of the CAG-ID(s) of the CAG cell are authorized based on the \"Allowed CAG list\" for the current PLMN in the UE's subscription; or\nb)\ta non-CAG cell in a PLMN for which the UE's subscription contains an \"indication that the UE is only allowed to access 5GS via CAG cells\";\nthe network shall accept the SERVICE REQUEST message and release all non-emergency PDU sessions associated with 3GPP access locally. The emergency PDU session associated with 3GPP access and PDU sessions associated with non-3GPP access shall not be released.\nIf the AMF received the list of TAIs from the satellite NG-RAN as described in 3GPP\u00a0TS\u00a023.501\u00a0[8], and determines that, by UE subscription and operator's preferences, any but not all TAIs in the received list of TAIs is forbidden for roaming or for regional provision of service, the AMF shall include the TAI(s) in:\na) the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE; or\nb) the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE; or\nc)\tboth;\nin the SERVICE ACCEPT message.\nNOTE\u00a09:\tVoid.\nIf the UE receives the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE in the SERVICE ACCEPT message and the TAI(s) included in the IE is not part of the list of \"5GS forbidden tracking areas for roaming\", the UE shall store the TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE into the list of \"5GS forbidden tracking areas for roaming\" and remove the TAI(s) from the stored TAI list if present.\nIf the UE receives the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE in the SERVICE ACCEPT message and the TAI(s) included in the IE is not part of the list of \"5GS forbidden tracking areas for regional provision of service\", the UE shall store the TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE into the list of \"5GS forbidden tracking areas for regional provision of service\" and remove the TAI(s) from the stored TAI list if present.\n5.6.1.4.2\tUE is using 5GS services with control plane CIoT 5GS optimization\nFor case a in subclause\u00a05.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating \"mobile terminating request\", after completion of the 5GMM common procedures (if initiated) according to subclause\u00a05.6.1.3, the AMF shall send a SERVICE ACCEPT message.\nFor cases c, d and m in subclause\u00a05.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating \"mobile originating request\", after completion of the 5GMM common procedures (if initiated) according to subclause\u00a05.6.1.3, the AMF shall send a SERVICE ACCEPT message, except for case d when the DDX field of the Release assistance indication IE or the DDX field of the CIoT small data container IE indicates \"No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected\".\nFor case a, c and d:\na)\tif the CIoT small data container IE is included in the message, the AMF shall decipher the value part of the CIoT small data container IE and:\n1)\tif the Data type field indicates \"control plane user data\", extract the PDU session ID and data content from the CIoT small data container IE, look up a PDU session routing context for the UE and the PDU session ID, and forward the content of the CIoT small data container IE to the SMF associated with the UE. If the corresponding PDU session is a PDU session for LADN, the AMF determines the UE presence in LADN service area (see subclause\u00a06.2.6) and forwards the UE presence in LADN service area towards the SMF;\n2)\tif the Data type field indicates \"SMS\", forward the content of the CIoT small data container IE to the SMSF associated with the UE; or\n3)\tif the Data type field indicates \"Location services message container\", and if\ni)\tlength of additional information field in the CIoT small data container IE is zero, forward the value of Data type field and the content of the CIoT small data container IE to the to the location services application; or\nii)\totherwise forward the value of Data type field and the content of the CIoT small data container IE to the LMF associated with the routing information that is included in the additional information field of the CIoT small data container IE; or\nNOTE\u00a01:\tIf the AMF determines there is no pending data or signalling for the UE, the AMF provides an indication of control plane CIoT 5GS Optimisation to the LMF as specified in 3GPP\u00a0TS\u00a029.518\u00a0[20B].\nb)\totherwise, the AMF shall decipher the value part of NAS message container IE and:\n1)\tif the Payload container IE is included in the CONTROL PLANE SERVICE REQUEST message and if the Payload container type IE is set to \"CIoT user data container\", the AMF shall look up a PDU session routing context for the UE and the PDU session ID, and forward the content of the Payload container IE to the SMF associated with the UE. If the corresponding PDU session is a PDU session for LADN, the AMF determines the UE presence in LADN service area (see subclause\u00a06.2.6) and forwards the UE presence in LADN service area towards the SMF;\n2)\tif the Payload container IE is included in the CONTROL PLANE SERVICE REQUEST message and if the Payload container type IE is set to \"SMS\", the AMF shall forward the content of the Payload container IE to the SMSF associated with the UE;\n3)\tif the PDU session status IE is included in the CONTROL PLANE SERVICE REQUEST message or the AMF needs to perform a PDU session status synchronization, the AMF shall include a PDU session status IE in the SERVICE ACCEPT message to indicate which PDU sessions associated with the access type the SERVICE ACCEPT message is sent over are active in the AMF;\n4)\tif the Uplink data status IE is included in the CONTROL PLANE SERVICE REQUEST message and the UE is:\ni)\tnot in NB-N1 mode; or\nii)\tin NB-N1 mode and the UE does not indicate a request to have user-plane resources established for a number of PDU sessions that exceeds the UE's maximum number of supported user-plane resources;\n\tthe AMF shall:\ni)\tindicate the SMF to re-establish the user-plane resources for the corresponding PDU sessions; and\nii)\tinclude the PDU session reactivation result IE in the SERVICE ACCEPT message to indicate the user-plane resources re-establishment result of the PDU sessions for which the UE requested to re-establish the user-plane resources;\n5)\tif the Uplink data status IE is included in the CONTROL PLANE SERVICE REQUEST, the UE is in NB-N1 mode, and the UE indicates a request to have user-plane resources established for a number of PDU sessions that exceeds the UE's maximum number of supported user-plane resources, the AMF shall not indicate to the SMF to re-establish the user-plane resources for the corresponding PDU sessions; or\n6)\totherwise, if the Payload container IE is included in the message and if the Payload container type IE is set to \"Location services message container\", the AMF shall forward the Payload container type and the content of the Payload container IE to the LMF associated with the routing information included in the Additional information IE of the CONTROL PLANE SERVICE REQUEST message.\nNOTE\u00a02:\tIf the AMF determines there is no pending data or signalling for the UE, the AMF provides an indication of control plane CIoT 5GS Optimisation to the LMF as specified in 3GPP\u00a0TS\u00a029.518\u00a0[20B].\nFor case k) in subclause\u00a05.6.1.1, if the Uplink data status IE is included in the CONTROL PLANE SERVICE REQUEST message and the UE is:\na)\tnot in NB-N1 mode; or\nb)\tin NB-N1 mode and the UE does not indicate a request to have user-plane resources established for a number of PDU sessions that exceeds the UE's maximum number of supported user-plane resources,\nthe AMF shall:\na)\tindicate the SMF to re-establish the user-plane resources for the corresponding PDU sessions; and\nb)\tinclude the PDU session reactivation result IE in the SERVICE ACCEPT message to indicate the user-plane resources re-establishment result of the PDU sessions for which the UE requested to re-establish the user-plane resources.\nIf the Allowed PDU session status IE is included in the CONTROL PLANE SERVICE REQUEST message, the AMF shall:\na)\tfor a 5GSM message from each SMF that has indicated pending downlink signalling only, forward the received 5GSM message via 3GPP access to the UE after the SERVICE ACCEPT message is sent;\nb)\tfor each SMF that has indicated pending downlink data only:\n1)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed if the corresponding PDU session ID(s) are not indicated in the Allowed PDU session status IE; and\n2)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed if:\ni)\tfor a UE not in NB-N1 mode, the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE; or\nii)\tfor a UE in NB-N1 mode, the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE and the resulting number of PDU sessions with established user-plane resources does not exceed the UE's maximum number of supported user-plane resources;\nc)\tfor each SMF that have indicated pending downlink signalling and data:\n1)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access cannot be performed if the corresponding PDU session ID(s) are not indicated in the Allowed PDU session status IE;\n2)\tnotify the SMF that reactivation of the user-plane resources for the corresponding PDU session(s) associated with non-3GPP access can be performed if:\ni)\tfor a UE not in NB-N1 mode, the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE; or\nii)\tfor a UE in NB-N1 mode, the corresponding PDU session ID(s) are indicated in the Allowed PDU session status IE and the resulting number of PDU sessions with established user-plane resources does not exceed the UE's maximum number of supported user-plane resources; and\n3)\tdiscard the received 5GSM message for PDU session(s) associated with non-3GPP access; and\nd)\tinclude the PDU session reactivation result IE in the SERVICE ACCEPT message to indicate the successfully re-established user-plane resources for the corresponding PDU sessions, if any.\nIf the DDX field in the CIoT small data container IE or the DDX field of the Release assistance indication IE indicates:\n1)\t\"No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected\" and if there is no downlink signalling or downlink data for the UE; or\n2)\t\"Only a single downlink data transmission and no further uplink data transmission subsequent to the uplink data transmission is expected\" and upon subsequent delivery of the next received downlink data transmission to the UE and if there is no additional downlink signalling or downlink data for the UE,\nthe AMF initiates the release of the N1 NAS signalling connection (see 3GPP\u00a0TS\u00a023.502\u00a0[9]).\nIf the MUSIM UE does not include the Paging restriction IE in the CONTROL PLANE SERVICE REQUEST message, the AMF shall delete any stored paging restriction for the UE and stop restricting paging.\nFor case m in subclause\u00a05.6.1.1 when the MUSIM UE sets the Request type to \"NAS signalling connection release\" in the CONTROL PLANE SERVICE REQUEST message, the AMF shall initiate the release of the N1 NAS signalling connection after the completion of the service request procedure.\nFor cases o and p in subclause\u00a05.6.1.1 when the MUSIM UE sets the Request type to \"NAS signalling connection release\" or to \"Rejection of paging\" in the UE request type IE in the CONTROL PLANE SERVICE REQUEST message and if the UE requests restriction of paging by including the Paging restriction IE, the AMF:\n-\tif accepts the paging restriction, shall include the 5GS additional request result IE in the SERVICE ACCEPT message and set the Paging restriction decision to \"paging restriction is accepted\". The AMF shall store the paging restriction of the UE and enforce these restrictions in the paging procedure as described in subclause\u00a05.6.2; or\n-\tif rejects the paging restriction, shall include the 5GS additional request result IE in the SERVICE ACCEPT message and set the Paging restriction decision to \"paging restriction is rejected\", and shall discard the received paging restriction. The AMF shall delete any stored paging restriction for the UE and stop restricting paging; and\nthe AMF shall send the SERVICE ACCEPT message and initiate the release of the N1 NAS signalling connection as follows:\n-\tfor case o in subclause\u00a05.6.1.1, after the completion of the service request procedure;\n-\tfor case p in subclause\u00a05.6.1.1, after the completion of the generic UE configuration update procedure that is triggered after the completion of the service request procedure.\nUpon successful completion of the procedure, the UE shall reset the service request attempt counter, stop the timer T3517 and enter the state 5GMM-REGISTERED.\nIf the PDU session status information element is included in the CONTROL PLANE SERVICE REQUEST message, then the AMF:\na)\tshall perform a local release of all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE on the AMF side associated with the access type the CONTROL PLANE SERVICE REQUEST message is sent over, but are indicated by the UE as being inactive, and\nb)\trequest the SMF to perform a local release of all those PDU sessions. If any of those PDU sessions is associated with one or more multicast MBS sessions, the SMF shall consider the UE as removed from the associated multicast MBS sessions.\nIf the PDU session status information element is included in the SERVICE ACCEPT message, then the UE shall perform a local release of all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING on the UE side associated with the 3GPP access but are indicated by the AMF as being inactive. If a locally released PDU session:\na)\tis associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions; or \nb)\thas the same PDU session identity value as that used by the UE in the CONTROL PLANE SERVICE REQUEST message, and the message contained CIoT user data, then the UE determines that the CIoT user data was not successfully sent.\nIf the user-plane resources cannot be established for a PDU session, the AMF shall include the PDU session reactivation result IE in the SERVICE ACCEPT message indicating that user-plane resources for the corresponding PDU session cannot be re-established, and:\na)\tif the user-plane resources cannot be established because the SMF indicated to the AMF that the UE is located out of the LADN service area (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]), the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #43 \"LADN not available\";\nb)\tif the user-plane resources cannot be established because the SMF indicated to the AMF that only prioritized services are allowed (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]), the AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #28 \"restricted service area\"; or\nc)\tif the user-plane resources cannot be established because:\n1)\tthe SMF indicated to the AMF that the resource is not available in the UPF (see 3GPP\u00a0TS\u00a029.502\u00a0[20A]); or\n2)\tthe UE is in NB-N1 mode and the result will lead to user-plane resources established for more than two PDU sessions (see 3GPP\u00a0TS\u00a023.502\u00a0[9])\n\tthe AMF shall include the PDU session reactivation result error cause IE with the 5GMM cause set to #92 \"insufficient user-plane resources for the PDU session\":\nNOTE\u00a03:\tFor a UE that is not in NB-N1 mode, it is up to UE implementation when to re-send a request for user-plane re-establishment for the associated PDU session after receiving a PDU session reactivation result error cause IE with a 5GMM cause set to #92 \"insufficient user-plane resources for the PDU session\".\nFor case a and b, \n-\tif the AMF has a service area list or LADN information which is applicable to the current TAI of the UE and was not yet provided to the UE, before sending the SERVICE ACCEPT message the AMF shall initiate the generic UE configuration update procedure and include the service area list or LADN information or both in the CONFIGURATION UPDATE COMMAND message; and \n-\tif timer T3540 is not started (see subclause\u00a05.3.1.3, item f), and the UE did not receive a CONFIGURATION UPDATE COMMAND message during the service request procedure, the UE may initiate a registration procedure for mobility or periodic registration update. If timer T3540 is started and the UE does not receive a CONFIGURATION UPDATE COMMAND message before the established N1 NAS signalling connection is released by the network or timer T3540 expires or is stopped as specified in subclause\u00a05.3.1.3, the UE may initiate the registration procedure for mobility or periodic registration update upon release of the N1 NAS signalling connection.\nIf the PDU session reactivation result IE is included in the SERVICE ACCEPT message indicating that the user-plane resources cannot be established for a PDU session that was indicated by the UE in the Allowed PDU session status IE as allowed to be re-established over 3GPP access, the UE considers the corresponding PDU session to be associated with the non-3GPP access.\nFor case d) in subclause\u00a05.6.1.1, the UE shall also treat the indication from the lower layers that the RRC connection has been released as successful completion of the procedure. The UE shall reset the service request attempt counter, stop the timer T3517 and enter the state 5GMM-REGISTERED.\nUpon receipt of the CONTROL PLANE SERVICE REQUEST message with uplink data:\n-\tif the DDX field of the Release assistance indication IE or the DDX field of the CIoT small data container IE is set to \"No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected\" in the message;\n-\tif the AMF decides to forward the uplink data piggybacked in the CONTROL PLANE SERVICE REQUEST message; and\n-\tif the AMF decides to activate the congestion control for transport of user data via the control plane,\nthen the AMF shall send SERVICE ACCEPT message with the T3448 value IE included.\nIf the AMF decides to deactivate the congestion control for transport of user data via the control plane, then the AMF shall delete the stored control plane data back-off time for the UE and the AMF shall not include timer T3448 value IE in the SERVICE ACCEPT message.\nIf the T3448 value IE is present in the received SERVICE ACCEPT message and the value indicates that this timer is neither zero nor deactivated, the UE shall:\na)\tstop timer T3448 if it is running;\nb)\tconsider the transport of user data via the control plane as successful; and\nc)\tstart timer T3448 with the value provided in the T3448 value IE.\nIf the UE is using 5GS services with control plane CIoT 5GS optimization, the T3448 value IE is present in the SERVICE ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall ignore the T3448 value IE and proceed as if the T3448 value IE was not present.\nIf the UE in 5GMM-IDLE mode initiated the service request procedure by sending a CONTROL PLANE SERVICE REQUEST message and the SERVICE ACCEPT message does not include the T3448 value IE and if timer T3448 is running, then the UE shall stop timer T3448.\nFor case h) in subclause\u00a05.6.1.1,\na)\tthe UE shall treat the indication from the lower layers when the UE has changed to S1 mode as successful completion of the procedure and stop timer T3517;\nb)\tif a UE operating in single-registration mode has changed to S1 mode, it shall disable the N1 mode capability for 3GPP access (see subclause\u00a04.9.2); and\nc)\tthe AMF shall not check for CAG restrictions.\nIf the CONTROL PLANE SERVICE REQUEST message is for emergency services fallback, the AMF triggers the emergency services fallback procedure as specified in subclause\u00a04.13.4.2 of 3GPP\u00a0TS\u00a023.502\u00a0[9].\n5.6.1.5\tService request procedure not accepted by the network\nIf the service request cannot be accepted, the network shall return a SERVICE REJECT message to the UE including an appropriate 5GMM cause value.\nIf the SERVICE REJECT message with 5GMM cause #76 or #78 was received without integrity protection, then the UE shall discard the message.\nIf the AMF needs to initiate PDU session status synchronisation or a PDU session status IE was included in the SERVICE REQUEST message, the AMF shall include a PDU session status IE in the SERVICE REJECT message to indicate which PDU sessions associated with the access type the SERVICE REJECT message is sent over are active in the AMF. If the PDU session status IE is included in the SERVICE REJECT message and if the message is integrity protected, then:\na)\tfor single access PDU sessions, the UE shall perform a local release of all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING on the UE side associated with the access type the SERVICE REJECT message is sent over, but are indicated by the AMF as being in 5GSM state PDU SESSION INACTIVE. If a locally released PDU session is associated with one or more MBS sessions, the UE shall locally leave the associated MBS multicast sessions; and\nb)\tfor MA PDU sessions, for all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE or PDU SESSION ACTIVE PENDING and have user plane resources established on the UE side associated with the access the SERVICE REJECT message is sent over, but are indicated by the AMF as no user plane resources established:\n1)\tfor MA PDU sessions having user plane resources established only on the access type the SERVICE REJECT message is sent over, the UE shall perform a local release of those MA PDU sessions. If a locally released PDU session is associated with one or more MBS sessions, the UE shall locally leave the associated MBS multicast sessions; and\n2)\tfor MA PDU sessions having user plane resources established on both accesses, the UE shall perform a local release on the user plane resources on the access type the SERVICE REJECT message is sent over. If a locally released PDU session is associated with one or more MBS sessions, the UE shall locally leave the associated MBS multicast sessions.\nIf the service request for mobile originated services is rejected due to general NAS level mobility management congestion control, the network shall set the 5GMM cause value to #22 \"congestion\" and assign a value for back-off timer T3346.\nIn NB-N1 mode, if the service request for mobile originated services is rejected due to operator determined barring (see 3GPP\u00a0TS\u00a029.503\u00a0[20AB]), the network shall set the 5GMM cause value to #22 \"congestion\" and assign a value for back-off timer T3346.\nIf the service request from a UE supporting CAG is rejected due to CAG restrictions, the network shall set the 5GMM cause value to #76 \"Not authorized for this CAG or authorized for CAG cells only\" and should include the \"CAG information list\" in the CAG information list IE or the Extended CAG information list IE in the SERVICE REJECT message.\nNOTE\u00a01:\tThe network cannot be certain that \"CAG information list\" stored in the UE is updated as result of sending of the SERVICE REJECT message with the CAG information list IE or the Extended CAG information list IE, as the SERVICE REJECT message is not necessarily delivered to the UE (e.g., due to abnormal radio conditions).\nNOTE\u00a02:\tThe \"CAG information list\" can be provided by the AMF and include no entry if no \"CAG information list\" exists in the subscription.\nNOTE\u00a02A:\tIf the UE supports extended CAG information list, the CAG information list can be included either in the CAG information list IE or Extended CAG information list IE.\nNOTE\u00a02B:\tIt is unexpected for network to send REGISTRATION REJECT message to the UE with 5GMM cause value #76 in non-CAG cell and not indicate \"Indication that the UE is only allowed to access 5GS via CAG cells\" for the serving PLMN in the Extended CAG information list or the CAG information list.\nIf the UE does not support extended CAG information list, the CAG information list shall not be included in the Extended CAG information list IE.\nIf the service request from a UE not supporting CAG is rejected due to CAG restrictions, the network shall operate as described in bullet\u00a0h) of subclause\u00a05.6.1.8.\nUpon receipt of the CONTROL PLANE SERVICE REQUEST message with uplink data:\n-\tif the AMF decides to not forward the uplink data piggybacked in the CONTROL PLANE SERVICE REQUEST message; and\n-\tif the AMF decides to activate the congestion control for transport of user data via the control plane,\nthen the AMF shall send a SERVICE REJECT message and set the 5GMM cause value to #22 \"congestion\" and assign a value for control plane data back-off timer T3448.\nIf the AMF determines that the UE is in a non-allowed area or is not in an allowed area as specified in subclause\u00a05.3.5, then:\na)\tif the service type IE in the SERVICE REQUEST message is set to \"signalling\" or \"data\", the AMF shall send a SERVICE REJECT message with the 5GMM cause value set to #28 \"Restricted service area\";\nb)\totherwise, if the service type IE in the SERVICE REQUEST message is set to \"mobile terminated services\", \"emergency services\", \"emergency services fallback\", \"high priority access\" or \"elevated signalling\", the AMF shall continue the process as specified in subclause\u00a05.6.1.4 unless for other reasons the service request cannot be accepted.\nIf the service request for mobile originated services is rejected due to service gap control as specified in subclause 5.3.17, i.e. the T3447 timer is running in AMF, the network shall set the 5GMM cause value to #22 \"Congestion\" and may include T3346 value IE in the SERVICE REJECT message set to the remaining time of the running T3447 timer.\nBased on operator policy, if the service request procedure is rejected due to core network redirection for CIoT optimizations, the network shall set the 5GMM cause value to #31 \"Redirection to EPC required\".\nNOTE\u00a03:\tThe network can take into account the UE's S1 mode capability, the EPS CIoT network behaviour supported by the UE or the EPS CIoT network behaviour supported by the EPC to determine the rejection with the 5GMM cause value #31 \"Redirection to EPC required\".\nIf the service request is via a satellite NG-RAN cell, and the network determines that the UE is in a location where the network is not allowed to operate, see 3GPP\u00a0TS\u00a023.502\u00a0[9], the network shall set the 5GMM cause value in the SERVICE REJECT message to #78 \"PLMN not allowed to operate at the present UE location\".\nIf the service request from a UE supporting MINT is rejected due to a disaster condition no longer being applicable in the current location of the UE, the network shall set the 5GMM cause value to #11 \"PLMN not allowed\" or #13 \"Roaming not allowed in this tracking area\" and may include a disaster return wait range in the Disaster return wait range IE in the SERVICE REJECT message.\nOn receipt of the SERVICE REJECT message, if the UE is in state 5GMM-SERVICE-REQUEST-INITIATED, the UE shall reset the service request attempt counter and stop timer T3517 if running.\nIf the AMF received multiple TAIs from the satellite NG-RAN as described in 3GPP\u00a0TS\u00a023.501\u00a0[8], and determines that, by UE subscription and operator's preferences, all of the received TAIs are forbidden, for roaming or for regional provision of service, the AMF shall include the TAI(s) in:\na)\tthe Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE; or\nb)\tthe Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE; or\nc)\tboth;\nin the SERVICE REJECT message.\nRegardless of the 5GMM cause value received in the SERVICE REJECT message via satellite NG-RAN,\n-\tif the UE receives the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE in the SERVICE REJECT message, the UE shall store the TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE, if not already stored, into the list of \"5GS forbidden tracking areas for roaming\"; and\n-\tif the UE receives the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for regional provision of service\" IE in the SERVICE REJECT message, the UE shall store the TAI(s) belonging to the serving PLMN or equivalent PLMN(s) and ignore the TAI(s) which do not belong to the serving PLMN or equivalent PLMN(s) included in the IE, if not already stored, into the list of \"5GS forbidden tracking areas for regional provision of service\".\nFurthermore, the UE shall take the following actions depending on the 5GMM cause value received in the SERVICE REJECT message.\n#3\t(Illegal UE);\n#6\t(Illegal ME);\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n\tIn case of PLMN, the UE shall consider the USIM as invalid for 5GS services until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause\u00a05.3.19A.1;\n\tIn case of SNPN, if the UE is not registered for onboarding services in SNPN and the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the UE shall consider the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN as invalid until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause 5.3.19A.2. In case of SNPN, if the UE is not registered for onboarding services in SNPN and the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid for 3GPP access until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause 5.3.19A.2. Additionally, if EAP based primary authentication and key agreement procedure using EAP-AKA' or 5G AKA based primary authentication and key agreement procedure was performed in the current SNPN, the UE shall consider the USIM as invalid for the current SNPN until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.19A.2.\n\tIf the UE is not registered for onboarding services in SNPN, the UE shall delete the list of equivalent PLMNs (if any) or the list of equivalent SNPNs (if any), and shall enter the state 5GMM-DEREGISTERED.NO-SUPI. If the message has been successfully integrity checked by the NAS, then the UE shall:\n1)\tset the counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events to UE implementation-specific maximum value in case of PLMN if the UE maintains these counters;\n2)\tset the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events and the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events to UE implementation-specific maximum value in case of SNPN if the UE maintains these counters; and\n\tIf the message was received via 3GPP access and the UE is operating in the single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the service request procedure is rejected with the EMM cause with the same value. The USIM shall be considered as invalid also for non-EPS services until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause\u00a05.3.7a in 3GPP TS 24.301 [15]. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for \"SIM/USIM considered invalid for non-GPRS services\", then the UE shall set this counter to UE implementation-specific maximum value.\n\tIf the UE is registered for onboarding services in SNPN, the UE shall store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS, the UE shall set the SNPN-specific attempt counter to the UE implementation-specific maximum value.\n\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#7\t(5GS services not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.\n\tIn case of PLMN, the UE shall consider the USIM as invalid for 5GS services until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.19A.1;\n\tIn case of SNPN, if the UE is not registered for onboarding services in SNPN and the UE does not support access to an SNPN using credentials from a credentials holder and does not support equivalent SNPNs, the UE shall consider the selected entry of the \"list of subscriber data\" with the SNPN identity of the current SNPN as invalid for 5GS services until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause 5.3.19A.2. In case of SNPN, if the UE is not registered for onboarding services in SNPN and the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs, or both, the UE shall consider the selected entry of the \"list of subscriber data\" as invalid for 3GPP access until the UE is switched off, the entry is updated or the timer T3245 expires as described in subclause 5.3.19A.2. Additionally, if EAP based primary authentication and key agreement procedure using EAP-AKA' or 5G AKA based primary authentication and key agreement procedure was performed in the current SNPN, the UE shall consider the USIM as invalid for the current SNPN until switching off, the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.19A.2.\n\tIf the UE is not registered for onboarding services in SNPN, the UE shall enter the state 5GMM-DEREGISTERED.NO-SUPI. If the message has been successfully integrity checked by the NAS, then the UE shall:\n1)\tset the counter for \"SIM/USIM considered invalid for GPRS services\" events and the counter for \"USIM considered invalid for 5GS services over non-3GPP access\" events to UE implementation-specific maximum value in case of PLMN if the UE maintains these counters; or\n2)\tset the counter for \"the entry for the current SNPN considered invalid for 3GPP access\" events and the counter for \"the entry for the current SNPN considered invalid for non-3GPP access\" events to UE implementation-specific maximum value in case of SNPN if the UE maintains these counters; and\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the service request procedure is rejected with the EMM cause with the same value.\n\tIf the UE is registered for onboarding services in SNPN, the UE shall store the SNPN identity in the \"permanently forbidden SNPNs\" list for onboarding services, enter state 5GMM-DEREGISTERED.PLMN-SEARCH, and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS, the UE shall set the SNPN-specific attempt counter to the UE implementation-specific maximum value.\n\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\nNOTE\u00a04:\tThe possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is outside the scope of the present document.\n#9\t(UE identity cannot be derived by the network).\n\tThe UE shall set the 5GS update status to 5U2 NOT UPDATED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. The UE shall enter the state 5GMM-DEREGISTERED.\n\tIf the service request was initiated for emergency services fallback, the UE shall attempt to select an E-UTRA cell connected to EPC or 5GCN according to the domain priority and selection rules specified in 3GPP\u00a0TS\u00a023.167\u00a0[6]. If the UE finds a suitable E-UTRA cell, it then proceeds with the appropriate EMM or 5GMM procedures. If the UE operating in single-registration mode has changed to S1 mode, it shall disable the N1 mode capability for 3GPP access.\n\tIf the service request was initiated for any reason other than emergency services fallback or initiating an emergency PDU session, the UE shall perform a new initial registration procedure.\nNOTE\u00a05:\tUser interaction is necessary in some cases when the UE cannot re-establish the PDU session(s) automatically.\n\tIf the message was received via 3GPP access and the UE is operating in the single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the service request procedure is rejected with the EMM cause with the same value.\n#10\t(Implicitly de-registered).\n\tThe UE shall enter the state 5GMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped 5G NAS security context or partial native 5G NAS security context.\n\tIf the service request was initiated for emergency services fallback, the UE shall attempt to select an E-UTRA cell connected to EPC or 5GCN according to the domain priority and selection rules specified in 3GPP\u00a0TS\u00a023.167\u00a0[6]. If the UE finds a suitable E-UTRA cell, it then proceeds with the appropriate EMM or 5GMM procedures. If the UE operating in single-registration mode has changed to S1 mode, it shall disable the N1 mode capability for 3GPP access.\n\tIf the rejected request was neither for initiating an emergency PDU session nor for emergency services fallback, the UE shall perform a new initial registration procedure.\nNOTE\u00a06:\tUser interaction is necessary in some cases when the UE cannot re-establish the PDU session(s) automatically.\n\tIf the message was received via 3GPP access and the UE is operating in the single-registration mode, the UE shall handle the EMM state as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the service request procedure is rejected with the EMM cause with the same value.\n#11\t(PLMN not allowed).\n\tThis cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.6.1.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. The UE shall delete the list of equivalent PLMNs and store the PLMN identity in the forbidden PLMN list as specified in subclause\u00a05.3.13A and if the UE is configured to use timer T3245 then the UE shall start timer T3245 and proceed as described in subclause 5.3.19A.1. For 3GPP access, the UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5], and for non-3GPP access the UE shall enter state 5GMM-DEREGISTERED.LIMITED-SERVICE and perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18]. If the message has been successfully integrity checked by the NAS and the UE mantains the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN, the UE shall set the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN to the UE implementation-specific maximum value.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the service request procedure is rejected with the EMM cause with the same value.\n\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access to the same PLMN, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n\tIf the UE receives the Disaster return wait range IE in the SERVICE REJECT message and the UE supports MINT, the UE shall delete the disaster return wait range stored in the ME, if any, and store the disaster return wait range included in the Disaster return wait range IE in the ME.\n#12\t(Tracking area not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI and ngKSI.\n\tIf:\n1)\tthe UE is not operating in SNPN access operation mode, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for regional provision of service\" and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for regional provision of service\" for non-integrity protected NAS reject message; or\n2)\tthe UE is operating in SNPN access operation mode, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for regional provision of service\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for regional provision of service\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, for non-integrity protected NAS reject message.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the service request procedure is rejected with the EMM cause with the same value.\n#13\t(Roaming not allowed in this tracking area).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2). For 3GPP access the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH, and for non-3GPP access the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE.\n\tIf:\n1)\tthe UE is not operating in SNPN access operation mode, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" and remove the current TAI from the stored TAI list if present. If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for non-integrity protected NAS reject message; or\n2)\tthe UE is operating in SNPN access operation mode, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, and remove the current TAI from the stored TAI list if present. If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, for non-integrity protected NAS reject message.\n\tFor 3GPP access the UE shall perform a PLMN selection or SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5], and for non-3GPP access the UE shall perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18].\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the service request procedure is rejected with the EMM cause with the same value.\n\tIf the UE receives the Disaster return wait range IE in the SERVICE REJECT message and the UE supports MINT, the UE shall delete the disaster return wait range stored in the ME, if any, and store the disaster return wait range included in the Disaster return wait range IE in the ME.\n#15\t(No suitable cells in tracking area).\n\tThe UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE.\n\tIf:\n1)\tthe UE is not operating in SNPN access operation mode, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" and remove the current TAI from the stored TAI list if present. If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for non-integrity protected NAS reject message; or\n2)\tthe UE is operating in SNPN access operation mode, the UE shall store the current TAI in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, and remove the current TAI from the stored TAI list if present. If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of \"5GS forbidden tracking areas for roaming\" for the current SNPN and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, for non-integrity protected NAS reject message.\n\tIf the UE initiated service request for emergency services fallback, the UE shall attempt to select an E-UTRA cell connected to EPC or 5GC according to the emergency services support indicator (see 3GPP\u00a0TS\u00a036.331\u00a0[25A]). If the UE finds a suitable E-UTRA cell, it then proceeds with the appropriate EMM or 5GMM procedures. If the UE operating in single-registration mode has changed to S1 mode, it shall disable the N1 mode capability for 3GPP access.\n\tIf the service request was not initiated for emergency services fallback, the UE shall search for a suitable cell in another tracking area according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C].\n\tIf the message was received via 3GPP access and the UE is operating in the single-registration mode, the UE shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the service request procedure is rejected with the EMM cause with the same value.\n\tIf received over non-3GPP access the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.6.1.7.\n#22\t(Congestion).\n\tIf the T3346 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.6.1.7.\n\tIf the rejected request was not for initiating an emergency PDU session, the UE shall abort the service request procedure and enter state 5GMM-REGISTERED and stop timer T3517 if still running.\n\tThe UE shall stop timer T3346 if it is running.\n\tIf the SERVICE REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.\n\tIf the SERVICE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n\tFor all other cases the UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.\n\tIf the message was received via 3GPP access and the UE is operating in the single-registration mode, the UE shall handle the EMM parameters EMM state and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the service request procedure is rejected with the EMM cause with the same value.\n\tIf the service request procedure was initiated for an MO MMTEL voice call (i.e. access category 4), or for an MO MMTEL video call (i.e. access category 5) or for an MO IMS registration related signalling (i.e. access category 9), a notification that the service request was not accepted due to congestion shall be provided to the upper layers.\n\tIf the UE is using 5GS services with control plane CIoT 5GS optimization and if the T3448 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall:\na)\tstop timer T3448 if it is running;\nb)\tconsider the transport of user data via the control plane as unsuccessful; and\nc)\tstart timer T3448:\n1)\twith the value provided in the T3448 value IE if the SERVICE REJECT message is integrity protected; or\n2)\twith a random value from the default range specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] table\u00a010.2.1 if the SERVICE REJECT message is not integrity protected.\n\tIf the UE is using 5GS services with control plane CIoT 5GS optimization, the T3448 value IE is present in the SERVICE REJECT message and the value indicates that this timer is either zero or deactivated, the UE shall ignore the T3448 value IE and:\na)\tstop timer T3448 if it is running; and\nb)\tconsider the transport of user data via the control plane as unsuccessful.\n\tIf the UE is using 5GS services with control plane CIoT 5GS optimization and if the T3448 value IE is not present in the SERVICE REJECT message, it shall be considered as an abnormal case and the behaviour of UE for this case is specified in subclause\u00a05.6.1.7.\n#27\t(N1 mode not allowed).\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE. If the message has been successfully integrity checked by the NAS, the UE shall set:\n1)\tthe PLMN-specific N1 mode attempt counter for 3GPP access and the PLMN-specific N1 mode attempt counter for non-3GPP access for that PLMN in case of PLMN; or\n2)\tthe SNPN-specific attempt counter for 3GPP access for the current SNPN and the SNPN-specific attempt counter for non-3GPP access for the current SNPN in case of SNPN\n\tto the UE implementation-specific maximum value.\n\tThe UE shall disable the N1 mode capability for the specific access type for which the message was received (see subclause\u00a04.9).\n\tIf the message has been successfully integrity checked by the NAS, the UE shall disable the N1 mode capability also for the other access type (see subclause\u00a04.9).\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED and enter the state EMM-REGISTERED.\n#28\t(Restricted service area).\n\tThe UE shall enter the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE, wait for the release of the N1 NAS signalling connection and perform the registration procedure for mobility and periodic registration update if the service type IE in the SERVICE REQUEST message was not set to \"elevated signalling\" and the SERVICE REJECT message is received over 3GPP access (see subclause\u00a05.3.5 and 5.5.1.3).\n\tIf the service type IE in the SERVICE REQUEST message was set to \"elevated signalling\", the UE shall not re-initiate service request procedure until the UE enters an allowed area or leaves a non-allowed area, except for emergency services, high priority access or responding to paging or notification.\n#31\t(Redirection to EPC required).\n\t5GMM cause #31 received by a UE that has not indicated support for CIoT optimizations or received by a UE over non-3GPP access is considered an abnormal case and the behaviour of the UE is specified in subclause\u00a05.6.1.7.\n\tThis cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.6.1.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2). The UE shall reset the service request attempt counter and enter the state 5GMM-REGISTERED.LIMITED-SERVICE.\n\tThe UE shall enable the E-UTRA capability if it was disabled and disable the N1 mode capability for 3GPP access (see subclause\u00a04.9.2).\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters, EMM state, and EPS update status as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the service request procedure is rejected with the EMM cause with the same value.\n#36\t(IAB-node operation not authorized).\n\tThis cause value is only applicable when received over 3GPP access by a UE operating as an IAB-node. This cause value received from a 5G access network other than 3GPP access or received by a UE not operating as an IAB-node is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.6.1.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. \n\tIf:\n1)\tthe UE is not operating in SNPN access operation mode, \ni)\tthe UE shall delete the list of equivalent PLMNs and store the PLMN identity in the forbidden PLMN list as specified in subclause\u00a05.3.13A and if the UE is configured to use timer T3245 then the UE shall start timer T3245 and proceed as described in subclause\u00a05.3.19a.1. The UE shall enter the state 5GMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS and the UE maintains the PLMN-specific attempt counter for 3GPP access for that PLMN, the UE shall set the PLMN-specific attempt counter for 3GPP access for that PLMN to the UE implementation-specific maximum value; and\nii)\tIf the UE is operating in single-registration mode, the UE shall in addition handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the service request procedure is rejected with the EMM cause with the same value; or\n2)\tthe UE is operating in SNPN access operation mode, \ni)\tthe UE shall delete the list of equivalent SNPNs (if available). The UE shall store the SNPN identity in the \"temporarily forbidden SNPNs\" list for 3GPP access and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. The UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS, the UE shall set the SNPN-specific attempt counter for 3GPP access for the current SNPN to the UE implementation-specific maximum value.\n#72\t(Non-3GPP access to 5GCN not allowed).\n\tIf the UE initiated the service request procedure over non-3GPP access, the UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI and ngKSI. Additionally, the UE shall enter the state 5GMM-DEREGISTERED for non-3GPP access. If the message has been successfully integrity checked by the NAS, the UE shall set:\n1)\tthe PLMN-specific N1 mode attempt counter for non-3GPP access for that PLMN in case of PLMN; or\n2)\tthe SNPN-specific attempt counter for non-3GPP access for that SNPN in case of SNPN;\n\tto the UE implementation-specific maximum value.\nNOTE\u00a07:\tThe 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses\u00a04.7.2 and 5.1.3).\n\tThe UE shall disable the N1 mode capability for non-3GPP access (see subclause\u00a04.9.3).\n\tAs an implementation option, if the UE is not currently registered over 3GPP access, the UE may enter the state 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf received over 3GPP access the cause shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause\u00a05.6.1.7.\n#73\t(Serving network not authorized).\n\tThis cause value received from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.6.1.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. The UE shall delete the list of equivalent PLMNs, store the PLMN identity in the forbidden PLMN list as specified in subclause\u00a05.3.13A. For 3GPP access the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5], and for non-3GPP access the UE shall enter state 5GMM-DEREGISTERED.LIMITED-SERVICE in order to perform network selection as defined in 3GPP\u00a0TS\u00a024.502\u00a0[18]. If the message has been successfully integrity checked by the NAS, the UE shall set the PLMN-specific attempt counter and the PLMN-specific attempt counter for non-3GPP access for that PLMN to the UE implementation-specific maximum value.\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED, enter the state EMM-DEREGISTERED and shall delete any 4G-GUTI, last visited registered TAI, TAI list and eKSI.\n#74\t(Temporarily not authorized for this SNPN).\n\t5GMM cause #74 is only applicable when received from a cell belonging to an SNPN. 5GMM cause #74 received from a cell not belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.6.1.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list, ngKSI and the list of equivalent SNPNs (if available). The UE shall store the SNPN identity in the \"temporarily forbidden SNPNs\" list for the specific access type for which the message was received and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN using credentials from a credentials holder, the UE shall store the SNPN identity in the \"temporarily forbidden SNPNs\" list along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN providing access for localized services in SNPN and the access for localized services in SNPN has been enabled, the UE shall store the SNPN identity in the list of \"temporarily forbidden SNPNs for access for localized services in SNPN\" (if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE is not registered for onboarding services in SNPN, the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the UE is registered for onboarding services in SNPN, the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS, the UE shall set the SNPN-specific attempt counter for 3GPP access and the SNPN-specific attempt counter for non-3GPP access for the current SNPN to the UE implementation-specific maximum value.\n\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access to the same SNPN, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#75\t(Permanently not authorized for this SNPN).\n\t5GMM cause #75 is only applicable when received from a cell belonging to an SNPN with a globally-unique SNPN identity. 5GMM cause #75 received from a cell not belonging to an SNPN or a cell belonging to an SNPN with a non-globally-unique SNPN identity is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.6.1.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete any 5G-GUTI, last visited registered TAI, TAI list, ngKSI and the list of equivalent SNPNs (if available). The UE shall store the SNPN identity in the \"permanently forbidden SNPNs\" list for the specific access type for which the message was received and the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE is not registered for onboarding services in SNPN, the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the UE supports access to an SNPN using credentials from a credentials holder, the UE shall store the SNPN identity in the \"permanently forbidden SNPNs\" list along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE supports access to an SNPN providing access for localized services in SNPN and the access for localized services in SNPN has been enabled, the UE shall store the SNPN identity in the list of \"permanently forbidden SNPNs for access for localized services in SNPN\" (if the SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) along with the GIN(s) broadcasted by the SNPN if any, for the selected entry of the \"list of subscriber data\" or the selected PLMN subscription. If the UE is registered for onboarding services in SNPN, the UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform an SNPN selection or an SNPN selection for onboarding services according to 3GPP\u00a0TS\u00a023.122\u00a0[5]. If the message has been successfully integrity checked by the NAS, the UE shall set the SNPN-specific attempt counter for 3GPP access and the SNPN-specific attempt counter for non-3GPP access for the current SNPN to the UE implementation-specific maximum value.\n\tIf the message has been successfully integrity checked by the NAS and the UE also supports the registration procedure over the other access to the same SNPN, the UE shall in addition handle 5GMM parameters and 5GMM state for this access, as described for this 5GMM cause value.\n#76\t(Not authorized for this CAG or authorized for CAG cells only).\n\tThis cause value received via non-3GPP access or from a cell belonging to an SNPN is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.6.1.7.\n\tThe UE shall set the 5GS update status to 5U3.ROAMING NOT ALLOWED, store the 5GS update status according to subclause\u00a05.1.3.2.2.\n\tIf 5GMM cause #76 is received from:\n1)\ta CAG cell, and if the UE receives a \"CAG information list\" in the CAG information list IE or the Extended CAG information list IE included in the SERVICE REJECT message, the UE shall:\ni)\treplace the \"CAG information list\" stored in the UE with the received \"CAG information list\" when received in the HPLMN or EHPLMN;\nii)\treplace the serving VPLMN's entry of the \"CAG information list\" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; or\nNOTE\u00a08:\tWhen the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored.\niii)\tremove the serving VPLMN's entry of the \"CAG information list\" stored in the UE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry.\n\tOtherwise, the UE shall delete the CAG-ID(s) of the cell from the \"allowed CAG list\" for the current PLMN, if the CAG-ID(s) are authorized based on the \"Allowed CAG list\". In the case the \"allowed CAG list\" for the current PLMN only contains a range of CAG-IDs, how the UE deletes the CAG-ID(s) of the cell from the \"allowed CAG list\" for the current PLMN is up to UE implementation. In addition:\ni)\tif the entry in the \"CAG information list\" for the current PLMN does not include an \"indication that the UE is only allowed to access 5GS via CAG cells\" or if the entry in the \"CAG information list\" for the current PLMN includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and one or more CAG-ID(s) are authorized based on the updated \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\";\nii)\tif the entry in the \"CAG information list\" for the current PLMN includes an \"indication that the UE is only allowed to access 5GS via CAG cells\" and no CAG-ID is authorized based on the updated \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP TS 23.122 [5] with the updated \"CAG information list\"; or\niii)\tif the \"CAG information list\" does not include an entry for the current PLMN, then the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] or 3GPP\u00a0TS\u00a036.304\u00a0[25C] with the updated \"CAG information list\".\n2)\ta non-CAG cell, and if the UE receives a \"CAG information list\" in the CAG information list IE or the Extended CAG information list IE included in the SERVICE REJECT message, the UE shall:\ni)\treplace the \"CAG information list\" stored in the UE with the received \"CAG information list\" when received in the HPLMN or EHPLMN;\nii)\treplace the serving VPLMN's entry of the \"CAG information list\" stored in the UE with the serving VPLMN's entry of the received CAG information list IE or the Extended CAG information list IE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN; or\nNOTE\u00a09:\tWhen the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN, entries of a PLMN other than the serving VPLMN, if any, in the received CAG information list IE or the Extended CAG information list IE are ignored.\niii)\tremove the serving VPLMN's entry of the \"CAG information list\" stored in the UE when the UE receives the CAG information list IE or the Extended CAG information list IE in a serving PLMN other than the HPLMN or EHPLMN and the CAG information list IE or the Extended CAG information list IE does not contain the serving VPLMN's entry.\n\tOtherwise, the UE shall store an \"indication that the UE is only allowed to access 5GS via CAG cells\" in the entry of the \"CAG information list\" for the current PLMN, if any. If the \"CAG information list\" stored in the UE does not include the current PLMN's entry, the UE shall add an entry for the current PLMN to the \"CAG information list\" and store an \"indication that the UE is only allowed to access 5GS via CAG cells\" in the entry of the \"CAG information list\" for the current PLMN. If the UE does not have a stored \"CAG information list\", the UE shall create a new \"CAG information list\" and add an entry with an \"indication that the UE is only allowed to access 5GS via CAG cells\" for the current PLMN.\nIn addition:\ni)\tif one or more CAG-ID(s) are authorized based on the \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-REGISTERED.LIMITED-SERVICE and shall search for a suitable cell according to 3GPP\u00a0TS\u00a038.304\u00a0[28] with the updated CAG information; or\nii)\tif no CAG-ID is authorized based on the \"allowed CAG list\" for the current PLMN, then the UE shall enter the state 5GMM-REGISTERED.PLMN-SEARCH and shall apply the PLMN selection process defined in 3GPP TS 23.122 [5] with the updated \"CAG information list\".\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall in addition set the EPS update status to EU3 ROAMING NOT ALLOWED, reset the service request attempt counter and enter the state EMM-REGISTERED.\n#77\t(Wireline access area not allowed).\n\t5GMM cause #77 is only applicable when received from a wireline access network by the 5G-RG or the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device). 5GMM cause #77 received from a 5G access network other than a wireline access network and 5GMM cause #77 received by the W-AGF acting on behalf of the FN-BRG are considered as abnormal cases and the behaviour of the UE is specified in subclause\u00a05.6.1.7.\n\tWhen received over wireline access network, the 5G-RG and the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device) shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2), shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI, shall enter the state 5GMM-DEREGISTERED and shall act as specified in subclause\u00a05.3.23.\nNOTE\u00a010:\tThe 5GMM sublayer states, the 5GMM parameters and the registration status are managed per access type independently, i.e. 3GPP access or non-3GPP access (see subclauses\u00a04.7.2 and 5.1.3).\n#78\t(PLMN not allowed to operate at the present UE location).\n\tThis cause value received from a non-satellite NG-RAN cell is considered as an abnormal case and the behaviour of the UE is specified in subclause\u00a05.6.1.7.\n\tThe UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it according to subclause\u00a05.1.3.2.2) and shall delete last visited registered TAI and TAI list. If the UE is not registering or has not registered to the same PLMN over both 3GPP access and non-3GPP access, the UE shall additionally delete 5G-GUTI and ngKSI. Additionally, the UE shall reset the registration attempt counter. The UE shall store the PLMN identity and, if it is known, the current geographical location in the list of \"PLMNs not allowed to operate at the present UE location\" and shall start a corresponding timer instance (see subclause\u00a04.23.2). The UE shall enter state 5GMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n\tIf the message was received via 3GPP access and the UE is operating in single-registration mode, the UE shall handle the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered TAI, TAI list and eKSI as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15] for the case when the service request procedure is rejected with the EMM cause with the same value.\n5.6.1.6\tService request procedure for initiating an emergency PDU session not accepted by the network\nIf the service request for initiating an emergency PDU session cannot be accepted by the network, the UE shall perform the procedures as described in subclause\u00a05.6.1.5. If the service request for initiating an emergency PDU session fails due to receiving the AUTHENTICATION REJECT message, the UE shall perform the procedures as described in subclauses\u00a05.4.1.2.2.11, 5.4.1.2.3.1, 5.4.1.2.3A.1 or 5.4.1.3.5. Then if the UE is in the same selected PLMN where the last service request was attempted, the UE shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE\u00a01:\tThis can result in the upper layers requesting another emergency call attempt using domain selection as specified in 3GPP\u00a0TS\u00a023.167\u00a0[6].\nb)\tde-register locally, if not de-registered already, attempt initial registration for emergency services.\nIf the service request for initiating an emergency PDU session fails due to abnormal cases a), f) or l) in subclause\u00a0.7, the UE shall perform the procedures as described in subclause\u00a05.6.1.7. Then if the UE is in the same selected PLMN where the last SERVICE REQUEST message was attempted, the UE shall:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE\u00a02:\tThis can result in the upper layers requesting another emergency call attempt using domain selection as specified in 3GPP\u00a0TS\u00a023.167\u00a0[6] and 3GPP\u00a0TS\u00a024.229\u00a0[14].\nb)\tde-register locally, if not de-registered already, attempt initial registration for emergency services.\nIf the service request for initiating a PDU session for emergency services fails due to abnormal case b) in subclause\u00a05.6.1.7, the UE shall perform the actions as described in subclause\u00a05.6.1.7 and inform the upper layers of the failure to access the network.\nNOTE\u00a03:\tThis can result in the upper layers requesting another emergency call attempt using domain selection as specified in 3GPP\u00a0TS\u00a023.167\u00a0[6].\n5.6.1.6A\tService request procedure for an emergency services fallback not accepted by the network\nIf the service request for initiating an emergency services fallback cannot be accepted by the network, the UE shall perform the procedures as described in subclause\u00a05.6.1.5, if the service request for initiating an emergency services fallback fails due to receiving the AUTHENTICATION REJECT message, the UE shall perform the procedures as described in subclauses\u00a05.4.1.2.2.11, 5.4.1.2.3.1, 5.4.1.2.3A.1 or 5.4.1.3.5, and if the UE does not attempt to select an E-UTRA cell connected to EPC or 5GCN as described in subclause\u00a05.6.1.5 and is camped on NR or E-UTRA cell connected to 5GCN in the same PLMN where the last service request was attempted, the UE shall inform the upper layers of the failure of the procedure.\nNOTE\u00a01:\tThis can result in the upper layers requesting another emergency call attempt using domain selection as specified in 3GPP\u00a0TS\u00a023.167\u00a0[6].\nIf the service request for initiating an emergency services fallback fails due to abnormal cases a) in subclause\u00a05.6.1.7, the UE shall inform the upper layers of the failure of the emergency services fallback.\nNOTE\u00a02:\tThis can result in the upper layers requesting another emergency call attempt using domain selection as specified in 3GPP\u00a0TS\u00a023.167\u00a0[6].\nIf the service request procedure for initiating an emergency services fallback fails due to abnormal cases other than a) in subclause\u00a05.6.1.7, the UE may abort the service request procedure, if not aborted already and attempt to select an E-UTRA cell connected to EPC or 5GCN according to the domain priority and selection rules specified in 3GPP TS 23.167 [6]. If the UE finds a suitable E-UTRA cell, it then proceeds with the appropriate EMM or 5GMM procedures. If the UE operating in single-registration mode has changed to S1 mode, it shall disable the N1 mode capability for 3GPP access.\n5.6.1.7\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tT3517 expired.\n\tThe UE shall enter the state 5GMM-REGISTERED.\n\tIf the UE triggered the service request procedure in 5GMM-IDLE mode sending a:\n1)\tSERVICE REQUEST message and the service type of the SERVICE REQUEST message was not set to \"emergency services fallback\"; or\n2)\tCONTROL PLANE SERVICE REQUEST message and the control plane service type of the CONTROL PLANE SERVICE REQUEST message was not set to \"emergency services fallback\";\n\tthen the 5GMM sublayer shall increment the service request attempt counter, abort the procedure and release locally any resources allocated for the service request procedure. The service request attempt counter shall not be incremented, if:\n1)\tthe service request procedure is initiated to establish an emergency PDU session;\n2)\tthe UE has an emergency PDU session established;\n3)\tthe UE is a UE configured for high priority access in selected PLMN or SNPN;\n4)\tthe service request procedure is initiated in response to paging or notification from the network; or\n5)\tthe UE in NB-N1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP\u00a0TS\u00a024.368\u00a0[17] or the USIM file EFNASCONFIG in 3GPP\u00a0TS\u00a031.102\u00a0[22]).\n\tIf the service request attempt counter is greater than or equal to 5, the UE shall start timer T3525. Additionally, if the service request procedure was initiated for an MO MMTEL voice call or for an MO MMTEL video call or for an MO IMS registration related signalling, a notification that the service request was not initiated due to the UE having started timer T3525 shall be provided to the upper layers.\nNOTE\u00a01:\tThis can result in the upper layers requesting implementation specific mechanisms, e.g. the MMTEL voice call being attempted to another IP-CAN, or establishment of a CS voice call (if supported and not already attempted in the CS domain).\n\tThe UE shall not attempt service request until expiry of timer T3525 unless:\n1)\tthe service request procedure is initiated in response to paging or notification from the network;\n2)\tthe UE is a UE configured for high priority access in selected PLMN or SNPN;\n3)\tthe service request procedure is initiated to establish an emergency PDU session;\n4)\tthe UE has an emergency PDU session established;\n5)\tthe service request procedure is initiated for emergency services fallback;\n6)\tthe UE is registered in a new PLMN;\nNOTE\u00a02:\tAccording to Table\u00a010.2.1, when \"UE camped on a new PLMN other than the PLMN on which timer started\", timer T3525 is stopped, hence this check may be skipped.\n7)\tthe UE in NB-N1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP\u00a0TS\u00a024.368\u00a0[17] or the USIM file EFNASCONFIG in 3GPP\u00a0TS\u00a031.102\u00a0[22]); or\n8)\tthe UE supports the reconnection to the network due to RAN timing synchronization status change and receives an indication of a change in the RAN timing synchronization status.\nNOTE\u00a03:\tThe NAS signalling connection can also be released if the UE deems that the network has failed the authentication check as specified in subclause\u00a05.4.1.3.7.\n\tIf the UE triggered the service request procedure in 5GMM-CONNECTED mode sending a:\n1)\tSERVICE REQUEST message and the service type of the SERVICE REQUEST message was not set to \"emergency services fallback\"; or\n2)\tCONTROL PLANE SERVICE REQUEST message and the control plane service type of the CONTROL PLANE SERVICE REQUEST message was not set to \"emergency services fallback\",\n\tthe 5GMM sublayer shall abort the procedure, and stay in 5GMM-CONNECTED mode.\n\tIf the service type of the SERVICE REQUEST message was set to \"emergency services fallback\" or the control plane service type of the CONTROL PLANE SERVICE REQUEST message was set to \"emergency services fallback\" and:\n1)\tthe service request procedure was triggered in 5GMM-IDLE mode, the 5GMM sublayer shall abort the procedure, release locally any resources allocated for the service request procedure; or\n2)\tthe service request procedure was triggered in 5GMM-CONNECTED mode, the 5GMM sublayer shall abort the procedure, stay in 5GMM-CONNECTED mode.\nb)\tThe lower layers indicate that the access attempt is barred.\n\tThe UE shall not start the service request procedure. The UE stays in the current serving cell and applies the normal cell reselection process. Receipt of the access barred indication shall not trigger the selection of a different core network type (EPC or 5GCN).\n\tThe service request procedure is started, if still needed, when the lower layers indicate that the barring is alleviated for the access category with which the access attempt was associated.\nba)\tThe lower layers indicate that:\n1)\taccess barring is applicable for all access categories except categories 0 and 2 and the access category with which the access attempt was associated is other than 0 and 2; or\n2)\taccess barring is applicable for all access categories except category 0 and the access category with which the access attempt was associated is other than 0.\n\tIf the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST has not been sent, the UE shall proceed as specified for case b.\n\tIf the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST has been sent:\n1)\tthe UE shall abort the service request procedure and stop timer T3517. The UE stays in the current serving cell and applies the normal cell reselection process; and\n2)\tthe service request procedure is started, if still needed, when the lower layers indicate that the barring is alleviated for the access category with which the access attempt was associated.\n\tFor additional UE requirements for both cases see subclause\u00a04.5.5.\nc)\tTimer T3346 is running.\n\tThe UE shall not start the service request procedure unless:\n1)\tthe UE receives a paging;\n2)\tthe UE receives a NOTIFICATION message over non-3GPP access when the UE is in 5GMM-CONNECTED mode over non-3GPP access and in 5GMM-IDLE mode over 3GPP access;\n3)\tthe UE receives a NOTIFICATION message over 3GPP access when the UE is in 5GMM-CONNECTED mode over 3GPP access and in 5GMM-IDLE mode over non-3GPP access;\n4)\tthe UE is a UE configured for high priority access in selected PLMN or SNPN;\n5)\tthe UE has an emergency PDU session established or is establishing an emergency PDU session;\n6)\tthe service request procedure is initiated for emergency services fallback;\n7)\tthe service request procedure is initiated for elevated signalling;\n8)\tthe UE in NB-N1 mode is requested by the upper layer to transmit user data related to an exceptional event and:\n-\tthe UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the\tNAS configuration MO in 3GPP\u00a0TS\u00a024.368\u00a0[17] or the USIM file EFNASCONFIG in 3GPP\u00a0TS\u00a031.102\u00a0[22]); and\n-\ttimer T3346 was not started when N1 NAS signalling connection was established with RRC establishment cause set to \"mo-ExceptionData\"; or\n9)\tthe MUSIM UE is in 5GMM-CONNECTED mode and requests the network to release the NAS signalling connection (see case o in subclause\u00a05.6.1.1).\n\tIf the UE is in 5GMM-IDLE mode, the UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.\n\tIf the service request procedure was triggered for an MO MMTEL voice call (i.e. access category 4), or for an MO MMTEL video call (i.e. access category 5) or for an MO IMS registration related signalling (i.e. access category 9), a notification that the service request procedure was not initiated due to congestion shall be provided to the upper layers.\n\tIf the UE receives a paging with access type set to \"Non-3GPP access\" and the non-3GPP access is available and UE is in 5GMM-REGISTERED.NORMAL SERVICE over non-3GPP access, the UE shall stop timer T3346 and send the SERVICE REQUEST message over non-3GPP access.\nd)\tRegistration procedure for mobility and periodic registration update is triggered.\n\tThe UE shall abort the service request procedure, stop timer T3517, if running and perform the registration procedure for mobility and periodic registration update. The Follow-on request indicator in the REGISTRATION REQUEST message shall be handled as specified in subclause\u00a05.5.1.3.2.\ne)\tSwitch off.\n\tIf the UE is in state 5GMM-SERVICE-REQUEST-INITIATED at switch off, the de-registration procedure shall be performed.\nf)\tDe-registration procedure collision.\n\tIf the UE receives a DEREGISTRATION REQUEST message from the network in state 5GMM-SERVICE-REQUEST-INITIATED, the UE shall progress the DEREGISTRATION REQUEST message and the service request procedure shall be aborted.\nNOTE\u00a04:\tThe above collision case is valid if the DEREGISTRATION REQUEST message indicates the access type over which the service request procedure is attempted otherwise both the procedures are progressed.\ng)\tTransmission failure of SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message indication with change in the current TAI.\n\tIf the current TAI is not in the TAI list, UE shall abort the service request procedure to perform the registration procedure for mobility and periodic registration update as specified in subclause\u00a05.5.1.3.2.\nIf the current TAI is part of the TAI list, the UE shall restart the service request procedure unless the service request procedure is initiated for case o) or p) in subclause\u00a05.6.1.1. For case o) and p) in subclause\u00a05.6.1.1 the UE shall abort the service request procedure, enters state 5GMM-REGISTERED, locally release the N1 NAS signalling connection, stop timer T3517 and locally release any resources allocated for the service request procedure.\nh)\tTransmission failure of SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message indication without change in the current TAI.\n\tThe UE shall restart the service request procedure unless the service request procedure is initiated for case o) or p) in subclause\u00a05.6.1.1. For case o) and p) in subclause\u00a05.6.1.1 the UE shall abort the service request procedure, enters state 5GMM-REGISTERED, locally release the N1 NAS signalling connection, stop timer T3517 and locally release any resources allocated for the service request procedure.\ni)\tSERVICE REJECT message received with other 5GMM cause values than those treated in subclause\u00a05.6.1.5, and cases of 5GMM cause values #11, #15, #22, #31, #72, #73, #74, #75, #76, #77 and #78 that are considered as abnormal cases according to subclause\u00a05.6.1.5.\n\tThe UE shall enter state 5GMM-REGISTERED.\n\tThe UE shall abort the service request procedure, stop timer T3517 and locally release any resources allocated for the service request procedure.\nj)\tThe UE in 5GMM-CONNECTED mode with RRC inactive indication over the 3GPP access, and in 5GMM-CONNECTED mode over non-3GPP access, receives a NOTIFICATION message over the non-3GPP access with access type indicating 3GPP access.\n\tThe UE shall transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-IDLE mode over 3GPP access and initiate the service request procedure over the 3GPP access.\nk)\tTimer T3447 is running\n\tThe UE shall not start any service request procedure unless:\n1)\tthe UE in 5GMM-IDLE receives a paging request;\n2)\tthe UE is a UE configured for high priority access;\n3)\tthe UE has a PDU session for emergency services established or is establishing a PDU session for emergency services;\n4)\tthe service request procedure is initiated for emergency services fallback;\n5)\tthe UE in 5GMM-CONNECTED mode receives mobile terminated signalling or downlink data over the user-plane;\n6)\tthe service request procedure is initiated for elevated signalling; or\n7)\tthe MUSIM UE requests the network to release the NAS signalling connection (see case o in subclause\u00a05.6.1.1).\n\tThe UE stays in the current serving cell and applies the normal cell reselection process. The service request procedure is started, if still necessary, when timer T3447 expires or timer T3447 is stopped.\nl)\tLower layer failure, release of the N1 signalling connection received from lower layers or the lower layers indicate that the RRC connection has been suspended before the service request procedure is completed or SERVICE REJECT message is received.\n\tThe UE shall abort the service request procedure, stop timer T3517, locally release any resources allocated for the service request procedure and enters state 5GMM-REGISTERED. For case m) in subclause\u00a05.6.1.1 the UE may retry the service request procedure a certain number of times (maximum re-attempts 5).\nm)\tTimer T3448 is running\n\tThe UE in 5GMM-IDLE mode shall not initiate the service request procedure for transport of user data via the control plane unless:\n1)\tthe UE is a UE configured for high priority access in selected PLMN;\n2)\tthe UE which is only using 5GS services with control plane CIoT 5GS optimization received a paging request;\n3)\tthe UE in NB-N1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP\u00a0TS\u00a024.368\u00a0[17] or the USIM file EFNASCONFIG in 3GPP\u00a0TS\u00a031.102\u00a0[22]); or\n4)\tthe UE is initiating the service request procedure to request emergency services or emergency services fallback.\n\tThe UE stays in the current serving cell and applies the normal cell reselection process. The service request procedure is started, if still necessary, when timer T3448 expires.\nn)\tAccess for localized services in current SNPN is no longer allowed.\n\tIf the service request procedure is not to request emergency services and there is no PDU session for emergency services, the registered SNPN is an SNPN selected for localized services in SNPN (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) and:\n-\taccess for localized services in SNPN is disabled; or\n-\tthe validity information for the selected SNPN is no longer met;\n\tthen the UE shall reset the service request attempt counter, stop T3517, abort the service request procedure, locally release the NAS signalling connection, if any, and enter state 5GMM-REGISTERED.LIMITED-SERVICE or 5GMM-REGISTERED.PLMN-SEARCH in order to perform SNPN selection according to 3GPP\u00a0TS\u00a023.122\u00a0[5].\n5.6.1.8\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tLower layer failure.\n\tIf a lower layer failure occurs before a SERVICE REJECT message has been sent to the UE or the service request procedure has been completed by the AMF, the AMF enters/stays in 5GMM-IDLE.\nb)\tProtocol error.\n\tIf the SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message is received with a protocol error, the AMF shall return a SERVICE REJECT message with one of the following 5GMM cause values:\n#96\tinvalid mandatory information;\n#99\tinformation element non-existent or not implemented;\n#100\tconditional IE error; or\n#111\tprotocol error, unspecified.\n\tThe AMF stays in the current 5GMM mode.\nc)\tMore than one SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message received before the procedure has been completed (i.e., before SERVICE REJECT message has been sent or service request procedure has been completed).\n-\tIf one or more of the information elements in the SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message differs from the ones received within the previous SERVICE REQUEST message or CONTROL PLANE SERVICE REQUEST message, the previously initiated service request procedure shall be aborted, and the new service request procedure shall be progressed;\n-\tIf the information elements do not differ, then the AMF shall continue with the previous service request procedure and shall not treat any further this SERVICE REQUEST message or this CONTROL PLANE SERVICE REQUEST message.\nd)\tREGISTRATION REQUEST message received with \"initial registration\" or \"emergency registration\" in the 5GS registration type IE before a SERVICE REJECT message has been sent or the service request procedure has been completed.\n\tIf a REGISTRATION REQUEST message with \"initial registration\" or \"emergency registration\" in the 5GS registration type IE is received and the service request procedure has not been completed or a SERVICE REJECT message has not been sent, the AMF may initiate the 5GMM common procedures, e.g. the primary authentication and key agreement procedure. The AMF may e.g. after a successful primary authentication and key agreement procedure execution, abort the service request procedure, delete the 5GMM context, indicate towards the SMF that the 5GMM context has been deleted and progress the new REGISTRATION REQUEST message.\ne)\tREGISTRATION REQUEST message received with \"mobility registration updating\" or \"periodic registration updating\" in the 5GS registration type IE received before the service request procedure has been completed or a SERVICE REJECT message has been sent.\n\tIf a REGISTRATION REQUEST message with \"mobility registration updating\" or \"periodic registration updating\" in the 5GS registration type IE is received and the service request procedure has not been completed or a SERVICE REJECT message has not been sent, the AMF may initiate the 5GMM common procedures, e.g. the primary authentication and key agreement procedure. The AMF may e.g. after a successful primary authentication and key agreement procedure execution, abort the service request procedure and progress the new REGISTRATION REQUEST message.\nf)\tIf a CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating \"mobile originating request\" is received after the AMF initiated a paging procedure, the AMF shall treat this CONTROL PLANE SERVICE REQUEST as a paging response and handle the message according to subclauses\u00a05.6.1.4 and 5.6.1.5.\ng)\tCONTROL PLANE SERVICE REQUEST message received with the Data type field indicates \"control plane user data\" in the CIoT small data container IE or received with Payload container type IE set to \"CIoT user data container\" and:\n1)\tthe AMF does not have a PDU session routing context for the PDU session ID and the UE; or\n2)\tthe AMF unsuccessfully attempted to forward the user data container and the PDU session ID,\n\tthen the AMF may send back to the UE the CIoT user data container or control plane user data which was not forwarded as specified in subclause\u00a05.4.5.3.1 case l1) or case l2).\nh)\tBased on operator policy, if the service request from a UE not supporting CAG is rejected due to CAG restrictions, the network shall reject the service request with a 5GMM cause value other than the 5GMM cause #76 (Not authorized for this CAG or authorized for CAG cells only).\nNOTE:\t5GMM cause #7 (5GS services not allowed), 5GMM cause #11 (PLMN not allowed), 5GMM cause #27 (N1 mode not allowed), 5GMM cause #73 (Serving network not authorized) can be used depending on the subscription of the UE and whether the UE roams or not.\ni)\tCIoT user data received for a PDU session ID which is inactive in the network.\n\tIf a CONTROL PLANE SERVICE REQUEST message is received with CIoT user data for a PDU session that is inactive in the network, the AMF shall discard the CIoT user data. The AMF shall send the SERVICE ACCEPT message and indicate that this PDU session ID is inactive using the PDU session status IE.\n5.6.2\tPaging procedure\n5.6.2.1\tGeneral\nThe paging procedure is performed only in 3GPP access and used by the network to request the establishment of a NAS signalling connection to the UE. The paging procedure is also used by the network to request the UE to re-establish the user-plane resources of PDU sessions for downlink user data transport. Another purpose of the paging procedure is to request the UE to re-establish the user-plane resources of PDU session(s) associated with non-3GPP access over 3GPP access.\nAdditionally, the network can use the paging procedure to initiate the mobile terminating SMS.\nFor the UE using eDRX, the network initiates the paging procedure when NAS signalling messages or user data is pending to be sent to the UE within the paging time window and requests the lower layers to include the eDRX cycle length and paging time window length in the paging message. If NAS signalling messages or user data is pending to be sent to the UE outside the paging time window and the eDRX value that the network provides to the UE in the Negotiated extended DRX parameters IE during the last registration procedure indicates:\na)\tthe eDRX cycle length duration of the E-UTRA cell connected to 5GCN, is higher than 5.12 seconds; or\nb)\tthe eDRX cycle length duration of the NR cell connected to 5GCN, is higher than 10.24 seconds,\nthe network initiates the paging procedure at T time ahead of the beginning of the next paging time window.\nNOTE:\tT time is a short time period based on implementation. The operator can take possible imperfections in the synchronization between the 5GCN and the UE into account when choosing T time.\nIf the network detects that the pending user data to be sent to the UE is related to the voice service as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9] and the network decides to initiate the paging procedure based on the stored paging restriction information, if any, the AMF should request the lower layer to include the Voice Service Indication in the paging message when the UE and the network support the paging indication for voice services.\n5.6.2.2\tPaging for 5GS services\n5.6.2.2.1\tGeneral\nThe network shall initiate the paging procedure for 5GS services when NAS signalling messages or user data is pending to be sent to the UE in 5GMM-IDLE mode over 3GPP access (see example in figure\u00a05.6.2.2.1.1) and there is no paging restriction applied in the network for that paging.\n\nFigure\u00a05.6.2.2.1.1: Paging procedure\nTo initiate the procedure the 5GMM entity in the AMF requests the lower layer to start paging and shall start timer T3513.\nIf downlink signalling or user data is pending to be sent over non-3GPP access, the 5GMM entity in the AMF shall indicate to the lower layer that the paging is associated to non-3GPP access.\nThe network shall not page the UE to re-establish user-plane resources of PDU session(s) associated with non-3GPP access over 3GPP access if all the PDU sessions of the UE that are established over the 3GPP access are associated with control plane only indication or S-NSSAI(s) associated with PDU session(s) are not in the UE\u2019s allowed NSSAI for a PLMN on 3GPP access.\nIf the network has downlink user data pending for a UE, the AMF has stored paging restriction of the UE and the Paging restriction type in the stored paging restriction is set to:\na)\t\"All paging is restricted\", the network should not page the UE;\nb)\t\"All paging is restricted except for voice service\", the network should page the UE only when:\n1)\tthe pending downlink user data for the UE is considered as voice service related by the network;\nc)\t\"All paging is restricted except for specified PDU session(s)\", the network should page the UE only when:\n1)\tfor PDU session(s) that paging is not restricted based on the stored paging restriction, the network has downlink user data pending; or\nd)\t\"All paging is restricted except for voice service and specified PDU session(s)\", the network should page the UE only when:\n1)\tthe pending downlink user data for the UE is considered as voice service related by the network; or\n2)\tfor PDU session(s) that paging is not restricted based on the stored paging restriction, the network has downlink user data pending.\nIf the network has downlink signalling pending for a UE and the AMF has stored paging restriction of the UE and the Paging restriction type in the stored paging restriction is set to:\na)\t\"All paging is restricted\", the network should not page the UE;\nb)\t\"All paging is restricted except for voice service\", the network should page the UE only when:\n1)\tthe pending downlink signalling for the UE is 5GMM signalling or 5GSM signalling of the PDU session of voice service;\nc)\t\"All paging is restricted except for specified PDU session(s)\", the network should page the UE only when:\n1)\tthe pending downlink signalling for the UE is 5GMM signalling; or\n2)\tfor PDU session(s) that paging is not restricted based on the stored paging restriction, the network has downlink 5GSM signalling pending; or\nd)\t\"All paging is restricted except for voice service and specified PDU session(s)\", the network should page the UE only when:\n1)\tthe pending downlink signalling for the UE is 5GMM signalling or 5GSM signalling of the PDU session of voice service; or\n2)\tfor PDU session(s) that paging is not restricted based on the stored paging restriction, the network has downlink 5GSM signalling pending.\nNOTE\u00a01:\tIf the network pages the UE due to downlink signalling pending, the network initiates the release of the N1 NAS signalling connection after network-requested procedure is completed.\nThe 5GMM entity in the AMF may provide the lower layer with the \"allowed CAG list\" and an \"indication that the UE is only allowed to access 5GS via CAG cells\" for the current PLMN, if available, and with the \"allowed CAG list\" and an \"indication that the UE is only allowed to access 5GS via CAG cells\" per equivalent PLMN, if available. If there is an active emergency PDU session, the 5GMM entity in the AMF shall not provide the lower layer with the \"allowed CAG list\" and an \"indication that the UE is only allowed to access 5GS via CAG cells\" for the current PLMN, even if available, or with the \"allowed CAG list\" and an \"indication that the UE is only allowed to access 5GS via CAG cells\" per equivalent PLMN, even if available.\nUpon reception of a paging indication, the UE shall stop the timer T3346, if running, and:\na)\tif control plane CIoT 5GS optimization is not used by the UE, the UE shall:\n1)\tinitiate a service request procedure over 3GPP access to respond to the paging as specified in subclauses\u00a05.6.1.2.1 if the UE is in 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE (as described in subclause\u00a05.3.5.2) state and the UE is in the 5GMM-IDLE mode without suspend indication;\n2)\tinitiate a service request procedure over non-3GPP access to respond to the paging as specified in subclauses\u00a05.6.1;\n3)\tinitiate a registration procedure for mobility and periodic registration update over 3GPP access to respond to the paging as specified in subclauses\u00a05.5.1.3.2; or\n4)\tproceed as specified in subclause\u00a05.3.1.5 if the UE is in the 5GMM-IDLE mode with suspend indication; or\nb)\tif control plane CIoT 5GS optimization is used by the UE, the UE shall:\n1)\tinitiate a service request procedure as specified in subclause\u00a05.6.1.2.2 if the UE is in the 5GMM-IDLE mode without suspend indication;\n2)\tinitiate a registration procedure for mobility and periodic registration update over 3GPP access as specified in subclauses\u00a05.5.1.3.2; or\n3)\tproceed as specified in subclause\u00a05.3.1.5 if the UE is in the 5GMM-IDLE mode with suspend indication.\nNOTE\u00a02:\tIf the UE is in the 5GMM-IDLE mode without suspend indication and has an uplink user data to be sent to the network using control plane CIoT 5GS optimization when receiving the paging indication, the UE can piggyback the uplink user data during the service request procedure initiated to respond to the paging, as specified in subclause\u00a05.6.1.2.2.\nThe MUSIM UE based on implementation may use the paging cause indicated by lower layers (see 3GPP\u00a0TS\u00a038.331\u00a0[30]), if any, to accept the paging, reject the paging or ignore the paging indication.\nUpon reception of a paging indication, if the network supports the rejection of paging request and if a MUSIM UE decides not to accept the paging, the UE may initiate a service request procedure to reject the paging as specified in subclause\u00a05.6.1.1.\nNOTE\u00a03: As an implementation option, MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.\nIf TMGI is used as paging identity and the TMGI matches with multicast MBS session which the has UE joined, the UE shall respond to the paging. Otherwise, the UE shall not respond to the paging.\nThe network shall stop timer T3513 for the paging procedure when an integrity-protected response is received from the UE and successfully integrity checked by the network or when the 5GMM entity in the AMF receives an indication from the lower layer that it has received the NGAP UE context resume request message as specified in 3GPP\u00a0TS\u00a038.413\u00a0[31]. If the response received is not integrity protected, or the integrity check is unsuccessful, timer T3513 for the paging procedure shall be kept running unless:\na)\tthe UE is registered for emergency services;\nb)\tthe UE has an emergency PDU session; or\nc)\tthe response received is a REGISTRATION REQUEST message for mobility and periodic registration update and the security mode control procedure or authentication procedure performed during mobility and periodic registration update has completed successfully.\nUpon expiry of timer T3513, the network may reinitiate paging.\nIf the network, while waiting for a response to the paging sent without paging priority, receives downlink signalling or downlink data associated with priority user-plane resources for PDU sessions, the network shall stop timer T3513, and then initiate the paging procedure with paging priority.\n5.6.2.2.2\tAbnormal cases on the network side\nThe following abnormal case can be identified:\na)\tVoid.\n5.6.2.2.3\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tPaging message received with access type set to non-3GPP access while the UE is in 5GMM-CONNECTED mode over non-3GPP access.\n\tThe UE shall not respond to paging message.\nb)\tPaging message received with access type set to 3GPP access when UE-initiated 5GMM specific procedure or service request procedure is ongoing.\n\tThe UE shall proceed with 5GMM specific procedure or service request procedure. If for registration procedure and service requestprocedure lower layers indicate that the access attempt is barred, then the UE shall handle the pending paging message as specified in subclause\u00a05.6.2.2.1. Otherwise, the UE shall ignore the paging once lower layers confirm the establishment of the signalling connection.\n5.6.3\tNotification procedure\n5.6.3.1\tGeneral\nThe notification procedure is used by the network:\na)\tto request the UE, by sending the NOTIFICATION message over 3GPP access, to re-establish the user-plane resources of PDU session(s) associated with non-3GPP access over 3GPP access or to deliver 5GSM downlink signalling messages associated with non-3GPP access over 3GPP access when the UE is in 5GMM-IDLE mode over non-3GPP access and in 5GMM-CONNECTED mode over 3GPP access; or\nb)\tto request the UE, by sending the NOTIFICATION message over non-3GPP access, to re-establish user-plane resources of the PDU session(s) or to deliver downlink signalling associated with 3GPP access over 3GPP access when the UE is in 5GMM-CONNECTED mode over non-3GPP access and:\n1)\tin 5GMM-IDLE mode over 3GPP access when the UE is not in MICO mode or when the network determines the unavailability period is not activated for the UE; or\n2)\tin 5GMM-IDLE mode with suspend indication over 3GPP access when the UE is not in MICO mode or when the network determines the unavailability period is not activated for the UE.\nThe network shall not use the NOTIFICATION message to re-establish user-plane resources of PDU session(s) associated with non-3GPP access over 3GPP access if all the PDU sessions of the UE that are established over the 3GPP access are associated with control plane only indication. .\nThe network shall not use the NOTIFICATION message over non-3GPP access, if:\na)\tthe MUSIM UE supports the paging indication for voice services;\nb)\tthe network has indicated \"paging indication for voice services supported\" to the UE; and\nc)\tthe AMF detects that the downlink data is related to voice service (see 3GPP\u00a0TS\u00a023.501\u00a0[8]).\n5.6.3.2\tNotification procedure initiation\nThe network shall initiate the notification procedure by sending the NOTIFICATION message to the UE and start timer T3565 (see example in figure\u00a05.6.3.2.1).\nFor case a) in subclause\u00a05.6.3.1, the NOTIFICATION message is sent from the network to the UE via 3GPP access with access type indicating non-3GPP access.\nFor case b) in subclause\u00a05.6.3.1, the NOTIFICATION message is sent from the network to the UE via non-3GPP access with access type indicating 3GPP access when the UE is not in MICO mode or when the network determines the unavailability period is not activated for the UE.\n\nFigure\u00a05.6.3.2.1: Notification procedure\nFor case b) in subclause\u00a05.6.3.1, if the network has downlink user data pending for a UE and the AMF has stored paging restriction of the UE and the Paging restriction type in the stored paging restriction is set to:\na)\t\"All paging is restricted\", the network should not send the NOTIFICATION message to the UE;\nb)\t\"All paging is restricted except for voice service\", the network should send the NOTIFICATION message to the UE only when the pending downlink user data for the UE is considered as voice service related by the network and the MUSIM UE does not support the paging indication for voice services or the network has not indicated \"paging indication for voice services supported\" to the UE;\nc)\t\"All paging is restricted except for specified PDU session(s)\", the network should send the NOTIFICATION message to the UE only when:\n1)\tfor PDU session(s) that paging is not restricted based on the stored paging restriction, the network has downlink user data pending;\nd)\t\"All paging is restricted except for voice service and specified PDU session(s)\" the network should send the NOTIFICATION message to the UE only:\n1) when the pending downlink user data for the UE is considered as voice service related by the network and the MUSIM UE does not support the paging indication for voice services, or the network has not indicated \"paging indication for voice services supported\" to the UE; or\n2) for PDU session(s) that paging is not restricted based on the stored paging restriction, the network has downlink user data pending.\nFor case b) in subclause\u00a05.6.3.1, if the network has downlink signalling pending for a UE and the AMF has stored paging restriction of the UE and the Paging restriction type in the stored paging restriction is set to:\na)\t\"All paging is restricted\", the network should not send the NOTIFICATION message to the UE;\nb)\t\"All paging is restricted except for voice service\", then the network should send the NOTIFICATION message to the UE only when:\n1)\tthe pending downlink signalling for the UE is 5GMM signalling or 5GSM signalling of the PDU session of voice service;\nc)\t\"All paging is restricted except for specified PDU session(s)\", the network should send the NOTIFICATION message to the UE only when:\n1)\tthe pending downlink signalling for the UE is 5GMM signalling; or\n2)\tfor PDU session(s) that paging is not restricted based on the stored paging restriction, the network has downlink 5GSM signalling pending; or\nd)\t\"All paging is restricted except for voice service and specified PDU session(s)\" then the network should send the NOTIFICATION message to the UE only when:\n1)\tthe pending downlink signalling for the UE is 5GMM signalling or 5GSM signalling pending of the PDU session of voice service; or\n2)\tfor PDU session(s) that paging is not restricted based on the stored paging restriction, the network has downlink 5GSM signalling pending.\nNOTE\u00a01:\tIf the network sends NOTIFICATION message to the UE due to downlink signalling pending, the network initiates the release of the N1 NAS signalling connection over 3GPP access after network-requested procedure is completed.\nUpon reception of a NOTIFICATION message, the UE shall stop the timer T3346, if running.\nFor case a) in subclause\u00a05.6.3.1, upon reception of NOTIFICATION message, the UE shall initiate a service request procedure over 3GPP access as specified in subclauses\u00a05.6.1.\nNOTE\u00a02:\tFor a UE in NB-NI mode, if there is DL user data pending for a PDU session associated with non-3GPP access then the AMF notifies the SMF that reactivation of user plane resources cannot be performed if the number of PDU sessions that currently has user-plane resources established equals to the UE's maximum number of supported user-plane resources.\nFor case b) in subclause\u00a05.6.3.1, upon reception of NOTIFICATION message:\na)\tif control plane CIoT 5GS optimization is not used by the UE, the UE shall:\n1)\tinitiate a service request procedure over 3GPP access as specified in subclause\u00a05.6.1.2.1, if the UE is in 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE (as described in subclause\u00a05.3.5.2) state over 3GPP access or 5GMM-REGISTERED.NON-ALLOWED-SERVICE state (see subclause\u00a05.3.5.2), and the UE is in the 5GMM-IDLE mode without suspend indication;\n2)\tinitiate a registration procedure for mobility and periodic registration update over 3GPP access as specified in subclause\u00a05.5.1.3.2, if the UE is in 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE state over 3GPP access; or\n3)\tproceed as specified in subclause\u00a05.3.1.5 if the UE is in the 5GMM-IDLE mode with suspend indication;\nb)\tif control plane CIoT 5GS optimization is used by the UE, the UE shall:\n1)\tinitiate a service request procedure over 3GPP access as specified in subclause\u00a05.6.1.2.2, if the UE is in 5GMM-REGISTERED.NORMAL-SERVICE or 5GMM-REGISTERED.NON-ALLOWED-SERVICE (as described in subclause\u00a05.3.5.2) state and the UE is in the 5GMM-IDLE mode without suspend indication;\n2)\tinitiate a registration procedure for mobility and periodic registration update over 3GPP access as specified in subclause\u00a05.5.1.3.2, if the UE is in 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE state; or\n3)\tproceed as specified in subclause\u00a05.3.1.5 if the UE is in the 5GMM-IDLE mode with suspend indication; or\nc)\tif:\n1)\tthe UE is in 5GMM-REGISTERED.NO-CELL-AVAILABLE state, 5GMM-REGISTERED.PLMN-SEARCH state, 5GMM-REGISTERED.LIMITED-SERVICE state or 5GMM-REGISTERED.UPDATE-NEEDED state over 3GPP access; or\n2) \tthe MUSIM UE is not able to respond the NOTIFICATION message as specified in case a) and b) above, e.g., due to UE implementation constraints;\n\tthe UE shall respond with NOTIFICATION RESPONSE message over non-3GPP access indicating inability of the UE to initiate a service request procedure or a registration procedure over 3GPP access and may include the PDU session status information element to indicate:\n1)\tthe single access PDU session(s) not in 5GSM state PDU SESSION INACTIVE in the UE associated with the 3GPP access type; and\n2)\tthe MA PDU session(s) not in 5GSM state PDU SESSION INACTIVE in the UE and having user plane resources established associated with the 3GPP access type.\nUpon reception of NOTIFICATION message:\n\tFor case b) in subclause\u00a05.6.3.1, if the UE is in 5GMM-REGISTERED.NO-CELL-AVAILABLE state or 5GMM-REGISTERED.PLMN-SEARCH state and a local release was performed in the UE for the single access PDU sessions associated with the 3GPP access or for user plane resources on the 3GPP access of MA PDU sessions;\nthen the UE shall respond with NOTIFICATION RESPONSE message over non-3GPP access indicating with the PDU session status information element that:\n-\tthe local release of its single access PDU sessions associated with the 3GPP access was performed; and\n-\tthe local release of its 3GPP access user plane resources of MA PDU sessions was performed.\n5.6.3.3\tNotification procedure completion\nUpon reception of SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST message or REGISTRATION REQUEST message, the AMF shall stop timer T3565 and proceed service request procedure as specified in subclauses\u00a05.6.3.1 or registration procedure for mobility and periodic registration update as specified in subclauses\u00a05.5.1.3. If no user-plane resources of PDU session(s) need to be re-established, the AMF should notify the SMF that the UE was reachable but did not accept to re-establish the user-plane resources of PDU session(s).\nWhen the 5GMM entity in the AMF receives an indication from the lower layer that it has received the NGAP UE context resume request message as specified in 3GPP\u00a0TS\u00a038.413\u00a0[31], the AMF shall stop timer T3565.\nUpon reception of NOTIFICATION RESPONSE message over non-3GPP access, the AMF shall stop timer T3565 and should notify the SMF that the UE is unreachable.\nIf the NOTIFICATION RESPONSE message includes the PDU session status information element, then:\na)\tfor single access PDU sessions, the AMF shall:\n1)\tperform a local release of all those PDU sessions which are not in 5GSM state PDU SESSION INACTIVE on the AMF side associated with 3GPP access, but are indicated by the UE in the PDU session status information element in the NOTIFICATION RESPONSE message as being in 5GSM state PDU SESSION INACTIVE; and\n2)\tshall request the SMF to perform a local release of all those PDU sessions associated with 3GPP access. If any of those PDU sessions is associated with one or more multicast MBS sessions, the SMF shall consider the UE as removed from the associated multicast MBS sessions; and\nb)\tFor MA PDU sessions, the AMF shall:\n1)\tfor MA PDU sessions having user plane resources established only on the 3GPP access in the AMF side, but are indicated by the UE in the PDU session status information element in the NOTIFICATION RESPONSE message as no user plane resources established on the 3GPP access:\ni)\tperform a local release of all those MA PDU sessions; and\nii)\trequest the SMF to perform a local release of all those MA PDU sessions. If the MA PDU session is associated with one or more multicast MBS sessions, the SMF shall consider the UE as removed from the associated multicast MBS sessions; and\n2)\tfor MA PDU sessions having user plane resources established on both accesses in the AMF side, but are indicated by the UE in the PDU session status information element in the NOTIFICATION RESPONSE message as no user plane resources established on the 3GPP access:\ni)\tperform a local release of 3GPP access user plane resources of all those MA PDU sessions; and\nii)\trequest the SMF to perform a local release of 3GPP access user plane resources of all those MA PDU sessions. If the MA PDU session is associated with one or more MBS sessions, the SMF shall consider the UE as removed from the associated MBS sessions.\n5.6.3.4\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3565.\n\tThe network shall, on the first expiry of the timer T3565, retransmit the NOTIFICATION message and shall reset and start timer T3565. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3565, the procedure shall be aborted. In addition, upon the fifth expiry of timer T3565:\n\tFor case a) in subclause\u00a05.6.3.1, the AMF should notify the SMF that the UE is unreachable. The AMF may enter 5GMM-IDLE mode over 3GPP access.\n\tFor case b) in subclause\u00a05.6.3.1, the AMF may either:\n1)\tperform the paging procedure over the 3GPP access; or\n2)\tnotify the SMF that the UE is unreachable.\nNOTE:\tWhether the AMF performs the paging procedure or notifies the SMF is up to operator's policies.\nb)\tDe-registration procedure collision\n\tIf the network receives a DEREGISTRATION REQUEST message before it receives a SERVICE REQUEST message or REGISTRATION REQUEST message, the AMF shall stop timer T3565 and proceed de-registration procedure as specified in subclause\u00a05.5.2.\n5.6.3.5\tAbnormal cases on the UE side\nThe following abnormal cases can be identified:\na)\tNOTIFICATION message received via non-3GPP access with access type indicating 3GPP access when UE-initiated 5GMM specific procedure or service request procedure over 3GPP access is ongoing.\n\tThe UE shall proceed with 5GMM specific procedure or service request procedure. If for registration procedure and service requestprocedure lower layers indicate that the access attempt is barred, then the UE shall handle the pending NOTIFICATION message as specified in subclause 5.6.3.2. Otherwise, the UE shall ignore the NOTIFICATION message once lower layers confirms the establishment of the signalling connection.\nx)\tNOTIFICATION message received via non-3GPP access with access type indicating 3GPP access when the unavailability period is activated in the UE or the UE is about to activate unavailability period.\n\tThe UE shall respond with NOTIFICATION RESPONSE message over non-3GPP access indicating inability of the UE to initiate a service request procedure or a registration procedure over 3GPP access.\n6\tElementary procedures for 5GS session management\n6.1\tOverview\n6.1.1\tGeneral\nThis clause describes the procedures used for 5GS session management (5GSM) performed over an N1 NAS signalling connection.\nThe main function of the 5GSM sublayer is to support the PDU session handling in the UE and in the SMF (transferred via the AMF).\nThe 5GSM comprises procedures for:\n-\tthe authentication and authorization, establishment, modification and release of PDU sessions; and\n-\trequest for performing handover of an existing PDU session between 3GPP access and non-3GPP access, or to transfer an existing PDN connection in the EPS to the 5GS.\nEach PDU session represents a PDU session established between the UE and an SMF. PDU sessions can remain established even if the radio and network resources constituting the corresponding PDU session between the UE and the SMF are temporarily released.\n5GSM procedures can be performed only if a 5GMM context has been established between the UE and the AMF, and the secure exchange of NAS messages has been initiated by the AMF by use of the 5GMM procedures described in clause\u00a05. Once the UE is successfully registered to a PLMN, a PDU session can be established. If no 5GMM context has been established, the 5GMM sublayer has to initiate the establishment of a 5GMM context by use of the 5GMM procedures as described in clause\u00a05.\nThe UE can request the network to modify or release PDU sessions. The network can fulfil such a request from the UE by modifying a PDU session or releasing a PDU session using network-requested procedures (see subclause\u00a06.3).\n6.1.2\tTypes of 5GSM procedures\nThree types of 5GSM procedures can be distinguished:\na)\tProcedures related to PDU sessions:\n\tThese procedures are initiated by the network and are used for authentication and authorization or manipulation of PDU sessions:\n1)\tPDU authentication and authorization;\n2)\tnetwork-requested PDU session modification;\n3)\tnetwork-requested PDU session release; and\n4)\tservice-level authentication and authorization.\n\tThis procedure is initiated by the UE and to request for establishment of PDU sessions or to perform handover of an existing PDU session between 3GPP access and non-3GPP access, or to transfer an existing PDN connection in the EPS to the 5GS:\n\tUE-requested PDU session establishment.\nb)\tTransaction related procedures:\n\tThese procedures are initiated by the UE to request for handling of PDU sessions, i.e. to modify a PDU session, or to release a PDU session:\n1)\tUE-requested PDU session modification; and\n2)\tUE-requested PDU session release.\n\tThis procedure is initiated by the 5G ProSe UE-to-network relay UE and is used for the manipulation of PDU sessions:\n-\tremote UE report.\nA successful transaction related procedure initiated by the UE triggers the network to execute one of the following procedures related to PDU session; network-requested PDU session modification procedure or network-requested PDU session release procedure. The UE treats the start of the procedure related to the PDU session as completion of the transaction related procedure.\nc)\tCommon procedure:\n\tThe following 5GSM procedure can be related to a PDU session or to a procedure transaction:\n\t5GSM status procedure.\n6.1.3\t5GSM sublayer states\n6.1.3.1\tGeneral\nIn the following subclauses, the possible states of a PDU session in the UE and the network side are described.\n6.1.3.2\t5GSM sublayer states in the UE\n6.1.3.2.1\tOverview\nIn the following subclauses, the possible 5GSM sublayer states of the UE are described and shown in figure\u00a06.1.3.2.1.1.\n\n\nNOTE\u00a01:\tNot all possible transitions are shown in this figure.\nNOTE\u00a02:\tSome transitions shown in this figure are not applicable to the MA PDU session.\nFigure\u00a06.1.3.2.1.1: The 5GSM sublayer states for PDU session handling in the UE (overview)\n6.1.3.2.2\tPDU SESSION INACTIVE\nNo PDU session exists.\n6.1.3.2.3\tPDU SESSION ACTIVE PENDING\nThe UE has initiated a PDU session establishment procedure towards the network and is waiting for a response from the network.\n6.1.3.2.4\tPDU SESSION ACTIVE\nThe PDU session is active in the UE.\n6.1.3.2.5\tPDU SESSION INACTIVE PENDING\nThe UE has initiated a PDU session release procedure towards the network and is waiting for a response from the network.\n6.1.3.2.6\tPDU SESSION MODIFICATION PENDING\nThe UE has initiated a PDU session modification procedure towards the network and is waiting for a response from the network.\n6.1.3.2.7\tPROCEDURE TRANSACTION INACTIVE\nNo procedure transaction exists.\n6.1.3.2.8\tPROCEDURE TRANSACTION PENDING\nThe UE has initiated a procedure transaction towards the network.\n\nFigure\u00a06.1.3.2.8.1: The procedure transaction states in the UE (overview)\n6.1.3.3\t5GSM sublayer states in the network side\n6.1.3.3.1\tOverview\nIn the following subclauses, the possible 5GSM sublayer states of the network are described and shown in Figure\u00a06.1.3.3.1.1.\n\nNOTE\u00a01:\tNot all possible transitions are shown in this figure.\nNOTE\u00a02:\tSome transitions shown in this figure are not applicable to the MA PDU session.\nFigure\u00a06.1.3.3.1.1: The 5GSM sublayer states for PDU session handling in the network (overview)\n6.1.3.3.2\tPDU SESSION INACTIVE\nNo PDU session exists.\n6.1.3.3.3\tPDU SESSION ACTIVE\nThe PDU session is active in the network.\n6.1.3.3.4\tPDU SESSION INACTIVE PENDING\nThe network has initiated a PDU session release procedure towards the UE and is waiting for a response from the UE.\n6.1.3.3.5\tPDU SESSION MODIFICATION PENDING\nThe network has initiated a PDU session modification procedure towards the UE and is waiting for a response from the UE.\n6.1.3.3.6\tPROCEDURE TRANSACTION INACTIVE\nNo procedure transaction exists.\n6.1.3.3.7\tPROCEDURE TRANSACTION PENDING\nThe network has initiated a procedure transaction towards the UE.\n\nFigure\u00a06.1.3.3.7.1: The procedure transaction states in the network (overview)\n6.1.4\tCoordination between 5GSM and ESM\n6.1.4.1\tCoordination between 5GSM and ESM with N26 interface\nInterworking with EPS is supported for a PDU session, if the PDU session includes the mapped EPS bearer context(s) or has association(s) between QoS flow and mapped EPS bearer after inter-system change from S1 mode to N1 mode. The SMF shall not include any mapped EPS bearer contexts associated with a PDU session for LADN and with a PDU session which is a multi-homed IPv6 PDU session. If the UE receives any mapped EPS bearer context for a PDU session for LADN or for a multi-homed IPv6 PDU session, the UE may locally delete the mapped EPS bearer context. See coding of the Mapped EPS bearer contexts IE in subclause\u00a09.11.4.8. In an MA PDU session, the UE shall have one set of the mapped EPS bearer contexts. The network can provide the set of the mapped EPS bearer contexts of the MA PDU session via either access of the MA PDU session. In an MA PDU session, the UE shall support modification or deletion via an access of a mapped EPS bearer context of the MA PDU session created via the same or the other access.\nUpon inter-system change from N1 mode to S1 mode, the UE shall create the default EPS bearer context and the dedicated EPS bearer context(s) based on the parameters of the mapped EPS bearer contexts or the associations between QoS flow and mapped EPS bearer in the PDU session, if available. The EPS bearer identity assigned for the QoS flow of the default QoS rule becomes the EPS bearer identity of the default bearer in the corresponding PDN connection. If there is no EPS bearer identity assigned to the QoS flow of the default QoS rule of a PDU session associated with 3GPP access, or if there is no corresponding mapped EPS bearer contexts associated with the EPS bearer identity assigned to the QoS flow of the default QoS rule of a PDU session associated with 3GPP access:\na)\tthe PDU session is not an MA PDU session established over both 3GPP access and non-3GPP access, the UE shall perform a local release of the PDU session; or\nb)\tthe PDU session is an MA PDU session established over both 3GPP access and non-3GPP access, the UE shall perform a local release of the PDU session over 3GPP access and consider that the MA PDU session is established over non-3GPP access only.\nIf there is no EPS bearer identity assigned to the QoS flow(s) of a PDU session associated with 3GPP access which is not associated with the default QoS rule, or if there is no corresponding mapped EPS bearer contexts associated with the EPS bearer identity assigned to the QoS flow of the non-default QoS rule of a PDU session associated with 3GPP access, unless the PDU session is an MA PDU session established over 3GPP access and over non-3GPP access, the UE shall locally delete the QoS rules and the QoS flow description(s). The UE uses the parameters from each PDU session for which interworking with EPS is supported to create corresponding default EPS bearer context and optionally dedicated EPS bearer context(s) as follows:\na)\tthe PDU session type of the PDU session shall be mapped to the PDN type of the default EPS bearer context as follows:\n1)\tthe PDN type shall be set to \"non-IP\" if the PDU session type is \"Unstructured\";\n2)\tthe PDN type shall be set to \"IPv4\" if the PDU session type is \"IPv4\";\n3)\tthe PDN type shall be set to \"IPv6\" if the PDU session type is \"IPv6\";\n4)\tthe PDN type shall be set to \"IPv4v6\" if the PDU session type is \"IPv4v6\";\n5)\tthe PDN type shall be set to \"non-IP\" if the PDU session type is \"Ethernet\", and the UE, the network or both of them do not support Ethernet PDN type in S1 mode; and\n6)\tthe PDN type shall be set to \"Ethernet\" if the PDU session type is \"Ethernet\" and the UE and the network support Ethernet PDN type in S1 mode;\nb)\tthe PDU address of the PDU session shall be mapped to the PDN address of the default EPS bearer context as follows:\n1)\tthe PDN address of the default EPS bearer context is set to the PDU address of the PDU session, if the PDU session type is \"IPv4\", \"IPv6\" or \"IPv4v6\"; and\n2)\tthe PDN address of the default EPS bearer context is set to zero, if the PDU session type is \"Ethernet\" or \"Unstructured\";\nc)\tthe DNN of the PDU session shall be mapped to the APN of the default EPS bearer context, unless the PDU session is an emergency PDU session;\nd)\tthe APN-AMBR and extended APN-AMBR received in the parameters of the default EPS bearer context of the mapped EPS bearer contexts shall be mapped to the APN-AMBR and extended APN-AMBR of the default EPS bearer context;\ne)\tfor each PDU session in state PDU SESSION ACTIVE, PDU SESSION MODIFICATION PENDING or PDU SESSION INACTIVE PENDING:\n1)\tif the UE is performing an inter-system change from N1 mode to WB-S1 mode, the UE shall set the state of the mapped EPS bearer context(s) to BEARER CONTEXT ACTIVE; or\n2)\tif the UE is performing an inter-system change from N1 mode to NB-S1 mode, for the mapped EPS bearer context corresponding to the default EPS bearer, the UE shall set the state of the mapped EPS bearer context to BEARER CONTEXT ACTIVE. Additionally, if the UE is performing an inter-system change from WB-N1 mode to NB-S1 mode, for the mapped EPS bearer context corresponding to a dedicated EPS bearer, if any, the UE shall set the state of the mapped EPS bearer context to BEARER CONTEXT INACTIVE; and\nf)\tfor any other PDU session the UE shall set the state of the mapped EPS bearer context(s) to BEARER CONTEXT INACTIVE.\nAdditionally, for each mapped EPS bearer context or the association between QoS flow and mapped EPS bearer in the PDU session:\na)\tthe EPS bearer identity shall be set to the EPS bearer identity received in the mapped EPS bearer context, or the EPS bearer identity associated with the QoS flow;\nb)\tthe EPS QoS parameters shall be set to the mapped EPS QoS parameters of the EPS bearer received in the mapped EPS bearer context, or the EPS QoS parameters associated with the QoS flow;\nc)\tthe extended EPS QoS parameters shall be set to the mapped extended EPS QoS parameters of the EPS bearer received in the mapped EPS bearer context, or the extended EPS QoS parameters associated with the QoS flow; and\nd)\tthe traffic flow template shall be set to the mapped traffic flow template of the EPS bearer received in the mapped EPS bearer context, or the stored traffic flow template associated with the QoS flow, if available.\nAfter inter-system change from N1 mode to S1 mode, the UE shall associate the PDU session identity, the S-NSSAI, and the session-AMBR with the default EPS bearer context, and for each EPS bearer context mapped from one or more QoS flows, associate the QoS rule(s) for the QoS flow(s) and the QoS flow description(s) for the QoS flow(s) with the EPS bearer context.\nIf the PDU session is associated with the control plane only indication and supports interworking with EPS, after inter-system change from N1 mode to S1 mode, the UE shall associate the EPS bearer context(s) of the PDN connection corresponding to the PDU session with the control plane only indication.\nIf the PDU session is associated with a PDU session pair ID, after inter-system change from N1 mode to S1 mode, the UE shall associate the default EPS bearer context of the PDN connection corresponding to the PDU session with the PDU session pair ID. If the PDU session is associated with an RSN, after inter-system change from N1 mode to S1 mode, the UE shall associate the default EPS bearer context of the PDN connection corresponding to the PDU session with the RSN.\nAfter inter-system change from N1 mode to S1 mode, if:\na)\tthe UE sent the URSP provisioning in EPS support indicator and received the URSP provisioning in EPS support indicator in the PDU session; or\nb)\tthe PDU session is associated with the URSP provisioning in EPS support indicators;\nthe UE shall associate the default EPS bearer context of the PDN connection corresponding to the PDU session with the URSP provisioning in EPS support indicators.\nAfter inter-system change from N1 mode to S1 mode, the UE and the SMF shall maintain the PDU session type of the PDU session until the PDN connection corresponding to the PDU session is released if the UE supports non-IP PDN type and the PDU session type is \"Ethernet\" or \"Unstructured\".\nAfter inter-system change from N1 mode to S1 mode, the UE and the SMF shall maintain the following 5GSM attributions and capabilities associated with the PDU session until the PDN connection corresponding to the PDU session is released:\na)\tthe always-on PDU session indication;\nb)\tthe maximum number of supported packet filters;\nc)\tthe support of reflective QoS;\nd)\tthe maximum data rate per UE for user-plane integrity protection supported by the UE for uplink and the maximum data rate per UE for user-plane integrity protection supported by the UE for downlink;\ne)\tthe support of multi-homed IPv6 PDU session; and\nf)\tif the PDU session is an MA PDU session established over 3GPP access, the PDN connection of the default EPS bearer corresponding to the MA PDU session shall be considered as a user-plane resource of the MA PDU session.\nAfter inter-system change from N1 mode to S1 mode, the UE operating in single-registration mode in a network supporting N26 interface shall deem that the following features are supported by the network on the PDN connection corresponding to the PDU session:\na)\tPS data off; and\nb)\tLocal address in TFT.\nIf there is a QoS flow used for IMS signalling, after inter-system change from N1 mode to S1 mode, the EPS bearer associated with the QoS flow for IMS signalling becomes the EPS bearer for IMS signalling.\nWhen the UE is provided with a new session-AMBR in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall discard the corresponding association and associate the new valuewith the default EPS bearer context.\nThe network may provide the UE with one or more QoS rules by including either one QoS rules parameter, or one QoS rules with the length of two octets parameter, but not both, in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message. The network may provide the UE with one or more QoS flow descriptions corresponding to the EPS bearer context being modified, by including either one QoS flow descriptions parameter, or one QoS flow descriptions with the length of two octets parameter, but not both, in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message.\nWhen the UE is provided with one or more QoS flow descriptions or the EPS bearer identity of an existing QoS flow description is modified in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall check the EPS bearer identity included in the QoS flow description; and:\na)\tif the EPS bearer identity corresponds to the EPS bearer context being modified or the EPS bearer identity is not included, the UE shall store the QoS flow description and all the associated QoS rules, if any, for the EPS bearer context being modified for use during inter-system change from S1 mode to N1 mode; and\nb)\totherwise the UE shall locally delete the QoS flow description and all the associated QoS rules, if any, and include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #84 \"syntactical error in the QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\nWhen the UE is provided with one or more QoS rules, or one or more QoS flow descriptions in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall process the QoS rules sequentially starting with the first QoS rule and shall process the QoS flow descriptions sequentially starting with the first QoS flow description. The UE shall check the QoS rules and QoS flow descriptions for different types of errors as follows:\nNOTE\u00a01:\tIf an error is detected in a QoS rule or a QoS flow description which requires sending a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause value, then the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter and the QoS flow descriptions with the length of two octets parameter included in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message are discarded, if any.\nNOTE\u00a02:\tIf the EPS bearer context modification procedure is rejected, then the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter and the QoS flow descriptions with the length of two octets parameter included in the Protocol configuration options IE or Extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message are discarded, if any.\na)\tSemantic errors in QoS operations:\n1)\tWhen the rule operation is \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters\" or \"Modify existing QoS rule without modifying packet filters\" on the default QoS rule and the DQR bit is set to \"the QoS rule is not the default QoS rule\".\n2)\tWhen the rule operation is \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters\" or \"Modify existing QoS rule without modifying packet filters\" on a QoS rule which is not the default QoS rule and the DQR bit is set to \"the QoS rule is the default QoS rule\".\n3)\tWhen the rule operation is \"Create new QoS rule\" and the DQR bit is set to \"the QoS rule is the default QoS rule\" when there's already a default QoS rule with different QoS rule identifier.\n4)\tWhen the rule operation is \"Delete existing QoS rule\" on the default QoS rule.\n5)\tWhen the rule operation is \"Create new QoS rule\", \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters\", or \"Modify existing QoS rule without modifying packet filters\" and two or more QoS rules associated with this PDU session would have identical precedence values.\n6)\tWhen the rule operation is \"Modify existing QoS rule and delete packet filters\", the QoS rule is a QoS rule of a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type, and the packet filter list in the resultant QoS rule is empty.\n7)\tWhen the rule operation is \"Create new QoS rule\", and there is already an existing QoS rule with the same QoS rule identifier and the existing QoS rule is associated with a QoS flow description stored for the EPS bearer context being modified or the existing QoS rule is not associated with any QoS flow description.\n8)\tWhen the rule operation is \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters\", or \"Modify existing QoS rule without modifying packet filters\" and there is no existing QoS rule with the same QoS rule identifier associated with a QoS flow description stored for the EPS bearer context being modified.\n9)\tWhen the rule operation is \"Delete existing QoS rule\" and there is no existing QoS rule with the same QoS rule identifier associated with a QoS flow description stored for the EPS bearer context being modified.\n10)\tWhen the flow description operation is \"Create new QoS flow description\" and there is already an existing QoS flow description with the same QoS flow identifier stored for the EPS bearer context being modified.\n11)\tWhen the flow description operation is \"Modify existing QoS flow description\" and there is no existing QoS flow description with the same QoS flow identifier stored for the EPS bearer context being modified.\n12)\tWhen the flow description operation is \"Delete existing QoS flow description\" and there is no existing QoS flow description with the same QoS flow identifier stored for the EPS bearer context being modified.\n13)\tWhen the UE determines that:\ni)\tthe default EPS bearer context is associated with one or more QoS flows but the default EPS bearer context is not associated with the default QoS rule.\nii)\ta dedicated EPS bearer context is associated with one or more QoS flows but the dedicated EPS bearer context is associated with the default QoS rule.\n14)\tWhen the rule operation is \"Create new QoS rule\" and there is already an existing QoS rule with the same QoS rule identifier associated with a QoS flow description stored for an EPS bearer context different from the EPS bearer context being modified and belonging to the same PDN connection as the EPS bearer context being modified.\n15)\tWhen the flow description operation is \"Create new QoS flow description\", and there is already an existing QoS flow description with the same QoS flow identifier stored for an EPS bearer context different from the EPS bearer context being modified and belonging to the same PDN connection as the EPS bearer context being modified.\n16)\tWhen the rule operation is \"Create new QoS rule\", \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters\", or \"Modify existing QoS rule without modifying packet filters\" and the resultant QoS rule is associated with a QoS flow description stored for an EPS bearer context different from the EPS bearer context being modified.\n17)\tWhen the rule operation is \"Create new QoS rule\", the DQR bit is set to \"the QoS rule is not the default QoS rule\", the QoS rule is provided for a PDN connection of PDN type \"non-IP\" and there is locally available information associated with the PDN connection that is set to \"Unstructured\".\n18)\tWhen the flow description operation is \"Create new QoS flow description\" or \"Modify existing QoS flow description\", the QFI associated with the QoS flow description is not the same as the QFI of the default QoS rule, the QoS flow description is provided for a PDN connection of PDN type \"non-IP\" and there is locally available information associated with the PDN connection that is set to \"Unstructured\".\n19)\tWhen the rule operation is \"Modify existing QoS rule and add packet filters\", the \"packet filter list\" field contains a match-all packet filter, the resultant QoS rule is the default QoS rule and there is already an existing match-all packet filter associated with the default QoS rule.\n20)\tWhen the rule operation is \"Create new QoS rule\" and the DQR bit is set to \"the QoS rule is not the default QoS rule\", or the rule operation is \"Modify existing QoS rule and add packet filters\" on a QoS rule which is not the default QoS rule or \"Modify existing QoS rule and replace all packet filters\" on a QoS rule which is not the default QoS rule, and one match-all packet filter is to be associated with the resultant QoS rule.\n\tIn case 5, if the old QoS rule (i.e. the QoS rule that existed before the MODIFY EPS BEARER CONTEXT REQUEST message was received) is not the default QoS rule and the old QoS rule is associated with a QoS flow description stored for the EPS bearer context being modified, the UE shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old QoS rule which has identical precedence value. Otherwise, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\n\tIn case 6, if the QoS rule is not the default QoS rule, the UE shall delete the QoS rule. If the QoS rule is the default QoS rule, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\n\tIn case 7, if the existing QoS rule is not the default QoS rule and the DQR bit of the new QoS rule is set to \"the QoS rule is not the default QoS rule\", the UE shall not diagnose an error, further process the create request and, if it was processed successfully, delete the old QoS rule (i.e. the QoS rule that existed when case 7 was detected). If the existing QoS rule is the default QoS rule or the DQR bit of the new QoS rule is set to \"the QoS rule is the default QoS rule\", the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\n\tIn case 9, the UE shall not diagnose an error, further process the delete request and, if it was processed successfully, consider the respective QoS rule as successfully deleted.\n\tIn case 10, the UE shall not diagnose an error, further process the create request and, if it was processed successfully, delete the old QoS flow description (i.e. the QoS flow description that existed when case 10 was detected.\n\tIn case 12, the UE shall not diagnose an error, further process the delete request and, if it was processed successfully, consider the respective QoS flow description as successfully deleted.\n\tOtherwise, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\nb)\tSyntactical errors in QoS operations:\n1)\tWhen the rule operation is \"Create new QoS rule\", \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\" or \"Modify existing QoS rule and delete packet filters\", the packet filter list in the QoS rule is empty, and the QoS rule is provided for a PDN connection of PDN type IPv4, IPv6, IPv4v6 or Ethernet, or for a PDN connection of PDN type \"non-IP\" and there is locally available information associated with the PDN connection that is set to \"Ethernet\".\n2)\tWhen the rule operation is \"Delete existing QoS rule\" or \"Modify existing QoS rule without modifying packet filters\" with a non-empty packet filter list in the QoS rule.\n3)\tWhen the rule operation is \"Modify existing QoS rule and delete packet filters\" and the packet filter to be deleted does not exist in the original QoS rule.\n4)\tVoid.\n5)\tWhen there are other types of syntactical errors in the coding of the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter or the QoS flow descriptions with the length of two octets parameter, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list when the rule operation is \"delete existing QoS rule\" or \"create new QoS rule\", or the number of packet filters subfield is larger than the maximum possible number of packet filters in the packet filter list (i.e., there is no QoS rule precedence subfield included in the QoS rule IE), the QoS Rule Identifier is set to \"no QoS rule identifier assigned\" when the rule operation is not \"delete existing QoS rule\", or the QoS flow identifier is set to \"no QoS flow identifier assigned\" when the flow description operation is not \"Delete existing QoS flow description\".\n6)\tWhen, the\nA)\trule operation is \"Create new QoS rule\", \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters\" or \"Modify existing QoS rule without modifying packet filters\", the UE determines, by using the QoS rule\u2019s QFI as the 5QI, that there is a resulting QoS rule for a GBR QoS flow (as described in 3GPP\u00a0TS\u00a023.501\u00a0[8] table\u00a05.7.4-1), and there is no QoS flow description with a QFI corresponding to the QFI of the resulting QoS rule.\nB)\tflow description operation is \"Delete existing QoS flow description\", and the UE determines, by using the QoS rule\u2019s QFI as the 5QI, that there is a resulting QoS rule for a GBR QoS flow (as described in 3GPP\u00a0TS\u00a023.501\u00a0[8] table\u00a05.7.4-1) with a QFI corresponding to the QFI of the QoS flow description that is deleted (i.e. there is no associated QoS flow description with the same QFI).\n7)\tWhen the flow description operation is \"Create new QoS flow description\" or \"Modify existing QoS flow description\", and the UE determines that there is a QoS flow description of a GBR QoS flow (as described in 3GPP\u00a0TS\u00a023.501\u00a0[8] table\u00a05.7.4-1) which lacks at least one of the mandatory parameters (i.e., GFBR uplink, GFBR downlink, MFBR uplink and MFBR downlink). If the QoS flow description does not include a 5QI, the UE determines this by using the QFI as the 5QI.\n8)\tWhen the rule operation is \"Create new QoS rule\", \"Modify existing QoS rule and add packet filters\" or \"Modify existing QoS rule and replace all packet filters\" with a non-empty packet filter list in the QoS rule, and the DQR bit is set to \"the QoS rule is the default QoS rule\", the QoS rule is provided for a PDN connection of PDN type \"non-IP\" and there is locally available information associated with the PDN connection that is set to \"Unstructured\".\n\tIn case 3 the UE shall not diagnose an error, further process the deletion request and, if no error according to items c and d was detected, consider the respective packet filter as successfully deleted.\n\tOtherwise the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #84 \"syntactical error in the QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\nNOTE\u00a03:\tIt is not considered an error if the UE determines that after processing all QoS operations on QoS rules and QoS flow descriptions there is a QoS flow description that is not associated with any QoS rule and the UE is not in NB-N1 mode.\nNOTE\u00a03a:\tAn implementation that strictly follows QoS rule operation as defined in subclause\u00a09.11.4.13 might not detect case 2).\nc)\tSemantic errors in packet filters:\n1)\tWhen a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.\n\tThe UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #44 \"semantic errors in packet filter(s)\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\nd)\tSyntactical errors in packet filters:\n1)\tWhen the rule operation is \"Modify existing QoS rule and add packet filters\" or \"Modify existing QoS rule and replace all packet filters\", and two or more packet filters in the resultant QoS rule would have identical packet filter identifiers.\n2)\tWhen the rule operation is \"Create new QoS rule\", and two or more packet filters in the resultant QoS rule would have identical packet filter identifiers.\n3)\tWhen there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.\n4)\tVoid.\n\tIn case 1, if two or more packet filters with identical packet filter identifiers are contained in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #45 \"syntactical error in packet filter(s)\" in the MODIFY EPS BEARER CONTEXT ACCEPT message. Otherwise, the UE shall not diagnose an error, further process the MODIFY EPS BEARER CONTEXT REQUEST message and, if it was processed successfully, delete the old packet filters which have the identical packet filter identifiers.\n\tOtherwise the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #45 \"syntactical error in packet filter(s)\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.\nIf the UE detects different errors in the QoS rules and QoS flow descriptions as described in this subclause which requires sending a 5GSM cause parameter in the MODIFY EPS BEARER CONTEXT ACCEPT message, the UE shall include a single 5GSM cause parameter in the MODIFY EPS BEARER CONTEXT ACCEPT message.\nNOTE\u00a04:\tThe 5GSM cause to use cannot be different from #44 \"semantic error in packet filter(s)\", #45 \"syntactical errors in packet filter(s)\", #83 \"semantic error in the QoS operation\" or #84 \"syntactical error in the QoS operation\". The selection of a 5GSM cause is up to UE implementation.\nUpon successful completion of an EPS attach procedure or tracking area updating procedure after inter-system change from N1 mode to S1 mode (see 3GPP\u00a0TS\u00a024.301\u00a0[15]), unless the PDU session is an MA PDU session established over 3GPP access and over non-3GPP access both connected to 5GCN,\na)\tthe UE shall delete any UE derived QoS rules of each PDU session which has been transferred to EPS;\nb)\tthe UE and the SMF shall perform a local release of the PDU session(s) associated with 3GPP access which have not been transferred to EPS; and\nc)\tthe UE and the SMF shall perform a local release of QoS flow(s) which have not been transferred to EPS, of the PDU session(s) which have been transferred to EPS. The UE and the SMF shall also perform a local release of any QoS flow description not associated with any QoS rule and not associated with any mapped EPS bearer context. If there is a QoS flow description not associated with any QoS rule, but associated with a mapped EPS bearer context, and after the inter-system change from N1 mode to S1 mode the respective EPS bearer context is active, then the UE shall associate the QoS flow description with the EPS bearer context.\nFor PDU session(s) associated with non-3GPP access in 5GS, if present, the UE may:\na)\tkeep some or all of these PDU sessions still associated with non-3GPP access in 5GS, if supported;\nb)\trelease some or all of these PDU sessions explicitly by initiating the UE requested PDU session release procedure(s); or\nc)\tattempt to transfer some or all of these PDU sessions from N1 mode to S1 mode by initiating the UE requested PDN connectivity procedure(s) with the PDN CONNECTIVITY REQUEST message created as follows:\n1)\tif the PDU session is an emergency PDU session, the request type shall be set to \"handover of emergency bearer services\". Otherwise the request type shall be set to \"handover\";\n2)\tthe PDU session type of the PDU session shall be mapped to the PDN type of the default EPS bearer context as follows:\ni)\tthe PDN type shall be set to \"non-IP\" if the PDU session type is \"Unstructured\";\nii)\tthe PDN type shall be set to \"IPv4\" if the PDU session type is \"IPv4\";\niii)\tthe PDN type shall be set to \"IPv6\" if the PDU session type is \"IPv6\";\niv)\tthe PDN type shall be set to \"IPv4v6\" if the PDU session type is \"IPv4v6\";\nv)\tthe PDN type shall be set to \"non-IP\" if the PDU session type is \"Ethernet\" and the UE, the network or both of them do not support Ethernet PDN type in S1 mode; and\nvi)\tthe PDN type shall be set to \"Ethernet\" if the PDU session type is \"Ethernet\" and the UE and the network support Ethernet PDN type in S1 mode;\n3)\tthe DNN of the PDU session shall be mapped to the APN of the default EPS bearer context, unless the PDN connection is an emergency PDN connection; and\n4)\tthe PDU session ID parameter in the Protocol configuration options IE or the Extended protocol configuration options IE shall be set to the PDU session identity of the PDU session.\n\tIf a PDU session associated with non-3GPP access is transferred to EPS, the UE shall associate the PDU session identity with the default EPS bearer context and shall delete any UE derived QoS rules of such PDU session.\nInterworking to 5GS is supported for a PDN connection, if the corresponding default EPS bearer context includes a PDU session identity, an S-NSSAI, if the PDN connection is a non-emergency PDN connection, session AMBR and one or more QoS flow descriptions received in the Protocol configuration options IE or Extended protocol configuration options IE (see 3GPP\u00a0TS\u00a024.301\u00a0[15]), or the default EPS bearer context has association with the PDU session identity, the S-NSSAI, if the PDU session is a non-emergency PDU session, the session-AMBR and one or more QoS flow descriptions after inter-system change from N1 mode to S1 mode.\nFor a PDN connection established in S1 mode, to enable the UE to attempt to transfer the PDN connection from S1 mode to N1 mode in case of inter-system change, the UE shall allocate a PDU session identity, indicate the allocated PDU session identity in the PDU session ID parameter in the Protocol configuration options IE of the PDN CONNECTIVITY REQUEST message and associate the allocated PDU session identity with the default EPS bearer context of the PDN connection. If an N5CW device supporting 3GPP access establishes a new PDN connection in S1 mode, the N5CW device supporting 3GPP access shall refrain from allocating \"PDU session identity value 15\".\nFor a PDN connection established in S1 mode, the SMF assigning the QoS rules shall consider that the UE supports 16 packet filters for the corresponding PDU session until the UE indicates a higher number (as specified in subclause\u00a06.4.2.2).\nThe network may provide the UE with one or more QoS rules by including either one QoS rules parameter, or one QoS rules with the length of two octets parameter, but not both, in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message. The network may provide the UE with one or more QoS flow descriptions corresponding to the EPS bearer context being activated, by including either one QoS flow descriptions parameter, or one QoS flow descriptions with the length of two octets parameter, but not both, in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message.\nWhen the UE is provided with one or more QoS flow descriptions in the Protocol configuration options IE or Extended protocol configuration options IE of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall check the EPS bearer identity included in the QoS flow description; and:\na)\tif the EPS bearer identity corresponds to the EPS bearer context being activated or the EPS bearer identity is not included, the UE shall store the QoS flow description and all the associated QoS rules, if any, for the EPS bearer context being activated for use during inter-system change from S1 mode to N1 mode; and\nb)\totherwise the UE shall locally delete the QoS flow description and all the associated QoS rules, if any, and include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #84 \"syntactical error in the QoS operation\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\nWhen the UE is provided with one or more QoS rules, or one or more QoS flow descriptions in the Protocol configuration options IE or Extended protocol configuration options IE of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall process the QoS rules sequentially starting with the first QoS rule and shall process the QoS flow descriptions sequentially starting with the first QoS flow description. The UE shall check QoS rules and QoS flow descriptions for different types of errors as follows:\nNOTE\u00a05:\tIf an error is detected in a QoS rule or a QoS flow description which requires sending a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause value, then the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter and the QoS flow descriptions with the length of two octets parameter included in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message are discarded, if any.\nNOTE\u00a06:\tIf the default EPS bearer context activation procedure or the dedicated EPS bearer context activation procedure is rejected, then the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter and the QoS flow descriptions with the length of two octets parameter included in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message are discarded, if any.\na)\tSemantic errors in QoS operations:\n1)\tWhen the rule operation is \"Create new QoS rule\" and the DQR bit is set to \"the QoS rule is the default QoS rule\" when there's already a default QoS rule.\n2)\tWhen the rule operation is received in an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the rule operation is \"Create new QoS rule\", and there is no rule with the DQR bit set to \"the QoS rule is the default QoS rule\".\n3)\tWhen the rule operation is \"Create new QoS rule\" and two or more QoS rules associated with this PDU session would have identical precedence values.\n4)\tWhen the rule operation is an operation other than \"Create new QoS rule\".\n5)\tWhen the flow description operation is an operation other than \"Create new QoS flow description\".\n6)\tWhen the UE determines that:\ni)\tthe default EPS bearer context is associated with one or more QoS flows but the default EPS bearer context is not associated with the default QoS rules.\nii)\ta dedicated EPS bearer context is associated with one or more QoS flows but the dedicated EPS bearer context is associated with the default QoS rule.\n7)\tWhen the flow description operation is received in an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the flow description operation is \"Create new QoS flow description\" and there is already an existing QoS flow description with the same QoS flow identifier stored for an EPS bearer context different from the EPS bearer context being activated and belonging to the same PDN connection as the EPS bearer context being activated.\n8)\tWhen the rule operation is received in an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the rule operation is \"Create new QoS rule\" and there is already an existing QoS rule with the same QoS rule identifier stored for an EPS bearer context different from the EPS bearer context being activated and belonging to the same PDN connection as the EPS bearer context being activated.\n9)\tWhen the rule operation is received in an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the rule operation is \"Create new QoS rule\" and the resultant QoS rule is associated with a QoS flow description stored for an EPS bearer context different from the EPS bearer context being activated and belonging to the same PDN connection as the EPS bearer context being activated.\n10)\tWhen the rule operation is \"Create new QoS rule\" and the DQR bit is set to \"the QoS rule is not the default QoS rule\" and one match-all packet filter is to be associated with the QoS rule.\n11)\tWhen the flow description operation is \"Create new QoS flow description\" and there is already an existing QoS flow description with the same QoS flow identifier stored for the EPS bearer context being activated.\n12)\tWhen the rule operation is \"Create new QoS rule\", and there is already an existing QoS rule with the same QoS rule identifier and the existing QoS rule is associated with a QoS flow description stored for the EPS bearer context being activated or the existing QoS rule is not associated with any QoS flow description.\n\tIn case 4, if the rule operation is for a non-default QoS rule, the UE shall delete the QoS rule. If the QoS rule is the default QoS rule, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS operation\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\n\tIn case 11, the UE shall not diagnose an error, further process the create request and, if it was processed successfully, delete the old QoS flow description (i.e. the QoS flow description that existed when case 11 was detected).\n\tIn case 12, if the existing QoS rule is not the default QoS rule and the DQR bit of the new QoS rule is set to \"the QoS rule is not the default QoS rule\", the UE shall not diagnose an error, further process the create request and, if it was processed successfully, delete the old QoS rule (i.e. the QoS rule that existed when case 12 was detected). If the existing QoS rule is the default QoS rule or the DQR bit of the new QoS rule is set to \"the QoS rule is the default QoS rule\", the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS operation\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\n\tOtherwise for all the cases above, the UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS operation\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\nb)\tSyntactical errors in QoS operations:\n1)\tWhen the rule operation is \"Create new QoS rule\", the packet filter list in the QoS rule is empty, and the QoS rule is provided for a PDN connection of PDN type IPv4, IPv6, IPv4v6 or Ethernet, or for a PDN connection of PDN type \"non-IP\" and there is locally available information associated with the PDN connection that is set to \"Ethernet\".\n2)\tVoid.\n3)\tWhen there are other types of syntactical errors in the coding of the QoS rules parameter, the QoS rules with the length of two octets parameter, the QoS flow descriptions parameter or the QoS flow descriptions with the length of two octets parameter, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list when the rule operation is \"delete existing QoS rule\" or \"create new QoS rule\", or the number of packet filters subfield is larger than the maximum possible number of packet filters in the packet filter list (i.e., there is no QoS rule precedence subfield included in the QoS rule IE), the QoS Rule Identifier is set to \"no QoS rule identifier assigned\", or the QoS flow identifier is set to \"no QoS flow identifier assigned.\n4)\tWhen, the\nA)\trule operation is \"Create new QoS rule\", the UE determines, by using the QoS rule\u2019s QFI as the 5QI, that there is a resulting QoS rule for a GBR QoS flow (as described in 3GPP\u00a0TS\u00a023.501\u00a0[8] table\u00a05.7.4-1), and there is no QoS flow description with a QFI corresponding to the QFI of the resulting QoS rule.\n5)\tWhen the flow description operation is \"Create new QoS flow description\", and the UE determines that there is a QoS flow description of a GBR QoS flow (as described in 3GPP\u00a0TS\u00a023.501\u00a0[8] table\u00a05.7.4-1) which lacks at least one of the mandatory parameters (i.e., GFBR uplink, GFBR downlink, MFBR uplink and MFBR downlink). If the QoS flow description does not include a 5QI, the UE determines this by using the QFI as the 5QI.\n\tThe UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #84 \"syntactical error in the QoS operation\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\nNOTE\u00a07:\tIt is not considered an error if the UE determines that after processing all QoS operations on QoS rules and QoS flow descriptions there is a QoS flow description that is not associated with any QoS rule and the UE is not in NB-N1 mode.\nc)\tSemantic errors in packet filters:\n1)\tWhen a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.\n\tThe UE shall include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #44 \"semantic errors in packet filter(s)\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\nd)\tSyntactical errors in packet filters:\n1)\tWhen the rule operation is \"Create new QoS rule\" and two or more packet filters in the resultant QoS rule would have identical packet filter identifiers.\n2)\tWhen there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.\n\tThe UE shall delete the QoS rule and include a Protocol configuration options IE or Extended protocol configuration options IE with a 5GSM cause parameter set to 5GSM cause #45 \"syntactical error in packet filter(s)\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\nIf the UE detects different errors in the QoS rules and QoS flow descriptions as described in this subclause which requires sending a 5GSM cause parameter in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message, the UE shall include a single 5GSM cause parameter in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.\nNOTE\u00a08:\tThe 5GSM cause to use cannot be different from #44 \"semantic error in packet filter(s)\", #45 \"syntactical errors in packet filter(s)\", #83 \"semantic error in the QoS operation\" or #84 \"syntactical error in the QoS operation\". The selection of a 5GSM cause is up to UE implementation.\nUpon inter-system change from S1 mode to N1 mode, the UE uses the parameters from the default EPS bearer context of each PDN connection for which interworking to 5GS is supported to create a corresponding PDU session associated with 3GPP access as follows, unless the PDN connection is a user-plane resource of an MA PDU session:\na)\tthe PDN type of the default EPS bearer context shall be mapped to the PDU session type of the PDU session as follows:\n1)\tif the PDN type is \"non-IP\":\n-\tthe PDU session type is set to the locally available information associated with the PDN connection (either \"Ethernet\" or \"Unstructured\"), if available; or\n-\totherwise, the PDU session type is set to \"Unstructured\";\n2)\tif the PDN type is \"IPv4\" the PDU session type is set to \"IPv4\";\n3)\tif the PDN type is \"IPv6\", the PDU session type is set to \"IPv6\";\n4)\tif the PDN type is \"IPv4v6\", the PDU session type is set to \"IPv4v6\"; and\n5)\tif the PDN type is \"Ethernet\", the PDU session type is \"Ethernet\";\nb)\tthe PDN address of the default EPS bearer context shall be mapped to PDU address of the PDU session, if the PDN type is \"IPv4\", \"IPv6\" or \"IPv4v6\";\nc)\tthe APN of the default EPS bearer context shall be mapped to the DNN of the PDU session, unless the PDN connection is an emergency PDN connection;\nd)\tfor each default EPS bearer context in state BEARER CONTEXT ACTIVE the UE shall set the state of the mapped PDU session to PDU SESSION ACTIVE; and\ne)\tfor any other default EPS bearer context the UE shall set the state of the mapped PDU session to PDU SESSION INACTIVE.\nAdditionally, the UE shall set:\na)\tthe PDU session identity of the PDU session to the PDU session identity included by the UE in the Protocol configuration options IE or Extended protocol configuration options IE in the PDN CONNECTIVITY REQUEST message, or the PDU session identity associated with the default EPS bearer context;\nb)\tthe S-NSSAI of the PDU session to the S-NSSAI included by the network in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message, or the S-NSSAI associated with the default EPS bearer context, if the PDN connection is a non-emergency PDN connection;\nc)\tthe session-AMBR of the PDU session to the session-AMBR included by the network in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message or the MODIFY EPS BEARER CONTEXT REQUEST message, or the session-AMBR associated with the default EPS bearer context;\nd)\tthe SSC mode of the PDU session to \"SSC mode 1\"; and\ne)\tthe always-on PDU session indication to the always-on PDU session indication maintained in the UE, if any.\nUpon inter-system change from S1 mode to N1 mode, the UE shall locally release the PDN connection(s) for which interworking to 5GS is not supported.\nUpon inter-system change from S1 mode to N1 mode, for each PDN connection which is a user-plane resource of MA PDU session and for which interworking to 5GS is supported, the UE shall consider that the MA PDU session is established over 3GPP access and, unless the MA PDU session is established over non-3GPP access too, the UE shall set the session-AMBR of the PDU session to the session-AMBR included by the network in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message or the MODIFY EPS BEARER CONTEXT REQUEST message, or the session-AMBR associated with the default EPS bearer context of the PDN connection.\nUpon inter-system change from S1 mode to N1 mode, if:\na)\tthe UE sent the URSP provisioning in EPS support indicator and received the URSP provisioning in EPS support indicator in the PDN connection corresponding to the PDU session; or\nb)\tthe default EPS bearer context of the PDN connection corresponding to the PDU session is associated with the URSP provisioning in EPS support indicators;\nthen the UE shall associate the PDU session with the URSP provisioning in EPS support indicators.\nAdditionally, for each EPS bearer context of the PDN connection, the UE shall create QoS flow(s) each of which is associated with the QoS flow description received in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message, ACTIVATE DEDICATED EPS BEARER REQUEST message, or MODIFY EPS BEARER REQUEST message (see 3GPP\u00a0TS\u00a024.301\u00a0[15]), or the QoS flow description associated with EPS bearer context, unless:\na)\tthe PDU session is an MA PDU session which:\n1)\tis established over non-3GPP access; and\n2)\thas a PDN connection as a user-plane resource; and\nb)\tthe QoS flow already exists over the non-3GPP access.\nAdditionally, for each EPS bearer context of the PDN connection, the UE shall create QoS rules(s), if any, each of which is associated with the QoS rule received in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message, ACTIVATE DEDICATED EPS BEARER REQUEST message, or MODIFY EPS BEARER CONTEXT REQUEST message (see 3GPP\u00a0TS\u00a024.301\u00a0[15]), or the QoS rules associated with EPS bearer context, unless:\na)\tthe PDU session is an MA PDU session which:\n1)\tis established over non-3GPP access; and\n2)\thas a PDN connection as a user-plane resource; and\nb)\tthe QoS rule already exists over the non-3GPP access.\nNOTE\u00a09:\tFor a QoS rule which does not exist over non-3GPP access, the UE does not create the QoS rule if the QoS rule is the default QoS rule, or the precedence value of the QoS rule equals to the precedence value of a QoS rule exists over the non-3GPP access.\nAdditionally, for each PDU session which was created at inter-system change from S1 mode to N1 mode from a corresponding PDN connection of the \"Ethernet\" PDN type, the UE shall consider that Ethernet PDN type in S1 mode is supported by the network and the SMF shall consider that Ethernet PDN type in S1 mode is supported by the UE.\nThe UE and the network shall locally release the PDN connection(s) and EPS bearer context(s) associated with the 3GPP access which have not been transferred to 5GS.\nAfter inter-system change from S1 mode to N1 mode, for each QoS flow mapped from an EPS bearer context the UE shall associate the EPS bearer identity, the EPS QoS parameters, the extended EPS QoS parameters, and the traffic flow template, if available, of the EPS bearer context with the QoS flow.\nAfter inter-system change from S1 mode to N1 mode, for each QoS flow of an MA PDU session which:\na)\tis established over non-3GPP access; and\nb)\thas a PDN connection as a user-plane resource;\nsuch that the QoS flow was received in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message, ACTIVATE DEDICATED EPS BEARER REQUEST message, MODIFY EPS BEARER CONTEXT REQUEST message, (see 3GPP\u00a0TS\u00a024.301\u00a0[15]), or associated with EPS bearer context, the UE shall associate the EPS bearer identity, the EPS QoS parameters, the extended EPS QoS parameters, and the traffic flow template, if available, of the EPS bearer context with the QoS flow.\nIf the EPS bearer context(s) of the PDN connection are associated with the control plane only indication, and the PDN connection supports interworking to 5GS, after inter-system change from S1 mode to N1 mode, the UE shall associate the PDU session corresponding to the PDN connection with the control plane only indication.\nIf the default EPS bearer context of the PDN connection is associated with the PDU session pair ID, and the PDN connection supports interworking to 5GS, after inter-system change from S1 mode to N1 mode, the UE shall associate the PDU session corresponding to the PDN connection with the PDU session pair ID. If the default EPS bearer context of the PDN connection is associated with the RSN, and the PDN connection supports interworking to 5GS, after inter-system change from S1 mode to N1 mode, the UE shall associate the PDU session corresponding to the PDN connection with the RSN.\nIf there is an EPS bearer used for IMS signalling, after inter-system change from S1 mode to N1 mode, the QoS flow of the default QoS rule in the corresponding PDU session is used for IMS signalling.\nFor a PDN connection established when in S1 mode, upon an inter-system change from S1 mode to N1 mode, if a UE-requested PDU session modification procedure has not been successfully performed yet,the SMF shall determine the always-on PDU session indication as specified in subclause\u00a06.3.2.2.\nWhen the UE is provided with one or more mapped EPS bearer contexts in the Mapped EPS bearer contexts IE of the PDU SESSION MODIFICATION COMMAND message, the UE shall process the mapped EPS bearer contexts sequentially starting with the first mapped EPS bearer context.\nWhen the UE is provided with a new EPS bearer identity, a new EPS QoS parameters, a new extended EPS QoS parameters, a new APN-AMBR or a new extended APN-AMBR in the Mapped EPS bearer context IE of the PDU SESSION MODIFICATION COMMAND message for a QoS flow, the UE shall discard the corresponding association(s) and associate the new value(s) with the QoS flow.\nWhen the UE is provided with a new traffic flow template in the Mapped EPS bearer contexts IE of the PDU SESSION MODIFICATION COMMAND message for a QoS flow, the UE shall check the traffic flow template for different types of TFT IE errors as specified in subclause\u00a06.3.2.3.\nWhen a QoS flow is deleted, the associated EPS bearer context information that are mapped from the deleted QoS flow shall be deleted from the UE and the network if there is no other existing QoS flow associated with this EPS bearer context. When the EPS bearer identity of a QoS flow is deleted, the associated EPS bearer context information that are mapped from the deleted EPS bearer identity shall be deleted from the UE and the network if there is no other existing QoS flow associated with this EPS bearer context. When an EPS bearer is released, all the associated QoS flow descriptions and QoS rules that are mapped from the released EPS bearer shall be deleted from the UE and the network.\nNOTE\u00a010:\tIf T3584 is running or deactivated for the S-NSSAI and optionally the DNN combination, the UE is allowed to initate ESM procedures in EPS with or without APN corresponding to that DNN, and if the APN is congested in EPS, the MME can send a back-off timer for the APN to the UE as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15].\nUpon inter-system change from N1 mode to S1 mode, if the UE has any PDU sessions associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions and the network shall consider the UE as removed from the associated MBS sessions.\nFor the case of handover of an existing PDU session from 3GPP access to non-3GPP access,\n-\tupon receipt of the PDU SESSION ESTABLISHMENT ACCEPT message, the UE locally deletes the EPS bearer identities for the PDU session, if any (see subclause\u00a06.4.1.3); and\n-\tafter successful handover, the network shall locally delete the EPS bearer identities for the PDU session, if any.\n6.1.4.2\tCoordination between 5GSM and ESM without N26 interface\nWhen the network does not support N26 interface, the SMF does not provide the UE with the mapped EPS bearer context for a PDU session.\nNOTE\u00a01:\tSince the SMF does not provide the UE with the mapped EPS bearer context for a PDU session, the UE does not know whether interworking with EPS is supported for a PDU session before attempting to transfer the PDU session from N1 mode to S1 mode.\nNOTE\u00a02:\tIt is up to UE implementation to decide which PDU session(s) to be attempted to transfer from N1 mode to S1 mode, e.g. based on UE policy or UE local configuration.\nUpon inter-system change from N1 mode to S1 mode in EMM-IDLE mode, the UE shall not transfer a PDU session for LADN to EPS.\nUpon inter-system change from N1 mode to S1 mode in EMM-IDLE mode, the UE shall not transfer a multi-homed IPv6 PDU session to EPS.\nUpon inter-system change from N1 mode to S1 mode in EMM-IDLE mode, the UE shall use the parameters from each PDU session which the UE intends to transfer to EPS to create the contents of a PDN CONNECTIVITY REQUEST message as follows:\na)\tif the PDU session is an emergency PDU session, the request type shall be set to \"handover of emergency bearer services\". Otherwise the request type shall be set to \"handover\";\nb)\tthe PDU session type of the PDU session shall be mapped to the PDN type of the default EPS bearer context as follows:\n1)\tthe PDN type shall be set to \"non-IP\" if the PDU session type is \"Unstructured\";\n2)\tthe PDN type shall be set to \"IPv4\" if the PDU session type is \"IPv4\";\n3)\tthe PDN type shall be set to \"IPv6\" if the PDU session type is \"IPv6\";\n4)\tthe PDN type shall be set to \"IPv4v6\" if the PDU session type is \"IPv4v6\";\n5)\tthe PDN type shall be set to \"non-IP\" if the PDU session type is \"Ethernet\" and the UE, the network or both of them do not support Ethernet PDN type in S1 mode; and\n6)\tthe PDN type shall be set to \"Ethernet\" if the PDU session type is \"Ethernet\" and the UE and the network support Ethernet PDN type in S1 mode;\nc)\tthe DNN of the PDU session shall be mapped to the APN of the default EPS bearer context, unless the PDU session is an emergency PDU session;\nd)\tthe PDU session ID parameter in the Protocol configuration options IE or Extended protocol configuration options IE shall be set to the PDU session identity of the PDU session; and\ne)\tif the PDU session is an MA PDU session established over 3GPP access, the ATSSS request parameter shall be included in the Protocol configuration options IE or Extended protocol configuration options IE.\nAfter inter-system change from N1 mode to S1 mode, the UE shall associate the PDU session identity with the default EPS bearer context. If the PDU session being transferred is a non-emergency PDU session, the UE shall in addition associate the S-NSSAI and the PLMN ID of the current PLMN with the default EPS bearer context.\nUpon successful completion of an EPS attach procedure after inter-system change from N1 mode to S1 mode (see 3GPP\u00a0TS\u00a024.301\u00a0[15]), the UE shall delete any UE derived QoS rules except when the PDU session is an MA PDU session established over 3GPP access and non-3GPP access both connected to the 5GCN.\nThe UE shall perform a local release of the PDU session(s) and QoS flow(s) associated with the 3GPP access which have not been transferred to EPS. The UE shall also perform a local release of any QoS flow description not associated with any QoS rule.\nFor PDU session(s) associated with non-3GPP access in 5GS, if present, the UE may:\na)\tkeep some or all of these PDU sessions still associated with non-3GPP access in 5GS, if supported;\nb)\trelease some or all of these PDU sessions explicitly by initiating the UE requested PDU session release procedure(s); or\nc)\tattempt to transfer some or all of these PDU sessions from N1 mode to S1 mode by initiating the UE requested PDN connectivity procedure(s) with the PDN CONNECTIVITY REQUEST message created as above.\nWhen the network does not support N26 interface, the MME does not provide the UE with the mapped PDU session for a PDN connection but provides the UE with an S-NSSAI if the PDN connection is not for emergency bearer services. When establishing a new PDN connection in S1 mode, to enable the UE to attempt to transfer the PDN connection from S1 mode to N1 mode in case of inter-system change, the UE shall allocate a PDU session identity, indicate the allocated PDU session identity in the PDU session ID parameter in the Protocol configuration options IE of the PDN CONNECTIVITY REQUEST message and associate the allocated PDU session identity with the default EPS bearer context of the PDN connection. If an N5CW device supporting 3GPP access establishes a new PDN connection in S1 mode, the N5CW device supporting 3GPP access shall refrain from allocating \"PDU session identity value 15\". The network provides the UE with an S-NSSAI and the related PLMN ID in the Protocol configuration options IE or Extended protocol configuration options IE of the ACTIVATE DEFAULT EPS BEARER REQUEST message, the UE shall delete the stored S-NSSAI and the related PLMN ID, if any, and shall store the S-NSSAI and the related PLMN ID provided in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message.\nNOTE\u00a03:\tSince the MME does not provide the UE with the mapped PDU session for a PDN connection, the UE does not know whether interworking to 5GS is supported for a PDN connection for which the UE assigned a PDU Session identity before attempting to transfer the PDN connection from S1 mode to N1 mode.\nNOTE\u00a04:\tIt is up to UE implementation to decide which PDN connection(s) to be attempted to transfer from S1 mode to N1 mode, e.g. based on UE policy or UE local configuration.\nNOTE\u00a05:\tIf the PDN connection has been transferred from a PDN connection established via non-3GPP access to EPC, it is possible that the network provided the S-NSSAI already during the establishment via non-3GPP access (see 3GPP\u00a0TS\u00a024.302\u00a0[16]).\nUpon inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, the UE uses the parameters from the default EPS bearer context of each PDN connection which the UE intends to transfer to 5GS and for which the UE has allocated a PDU session identity to create a PDU SESSION ESTABLISHMENT REQUEST message as follows:\na)\tif the PDN connection is for emergency bearer services, the request type shall be set to \"existing emergency PDU session\". Otherwise the request type shall be set to:\n1)\t\"MA PDU request\", if the PDN connection to be transferred is a user-plane resource of an MA PDU session; or\n2)\t\"existing PDU session\";\nb)\tthe PDN type of the default EPS bearer context shall be mapped to the PDU session type of the PDU session as follows:\n1)\tif the PDN type is \"non-IP\":\n-\tthe PDU session type is set to the locally available information associated with the PDN connection (either \"Ethernet\" or \"Unstructured\"), if available; or\n-\totherwise, the PDU session type is set to \"Unstructured\";\n2)\tif the PDN type is \"IPv4\" the PDU session type is set to \"IPv4\";\n3)\tif the PDN type is \"IPv6\", the PDU session type is set to \"IPv6\";\n4)\tif the PDN type is \"IPv4v6\", the PDU session type is set to \"IPv4v6\"; and\n5)\tif the PDN type is \"Ethernet\", the PDU session type is set to \"Ethernet\"; and\nc)\tthe APN of the default EPS bearer context shall be mapped to the DNN of the PDU session, unless the PDN connection is an emergency PDN connection;\nd)\tthe PDU session ID shall be set to the PDU session identity included by the UE in the Protocol configuration options IE or Extended protocol configuration options IE in the PDN CONNECTIVITY REQUEST message, or to the PDU session ID associated with the default EPS bearer context;\ne)\tif the PDU session is not an emergency PDU session, the S-NSSAI of the PDU session shall be set to the S-NSSAI included by the network in the Protocol configuration options IE or Extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message, if provided by the network, or the S-NSSAI associated with the default EPS bearer context, if available; and\nf)\tthe SSC mode IE shall be set to \"SSC mode 1\".\nNOTE\u00a06:\tIf T3584 is running or deactivated for the S-NSSAI and optionally the DNN combination, the UE is allowed to initiate ESM procedures in EPS with or without APN corresponding to that DNN, and if the APN is congested in EPS, the MME can send a back-off timer for the APN to the UE as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15].\nThe UE shall locally release the PDN connection(s) and EPS bearer(s) associated with the 3GPP access which have not been transferred to 5GS.\nUpon inter-system change from N1 mode to S1 mode, if the UE has any PDU sessions associated with one or more MBS multicast sessions, the UE shall locally leave the associated multicast MBS sessions and the network shall consider the UE as removed from the associated multicast MBS sessions.\n6.1.4a\tCoordination between 5GSM and SM\nCoordination between 5GSM and SM states is not required.\nAfter the 5G-SRVCC handover from NG-RAN to UTRAN (see 3GPP\u00a0TS\u00a023.216\u00a0[6A]), all the PDU sessions of the UE are locally released at the UE and the network. If the UE has any PDU sessions associated with one or more MBS multicast sessions, the UE shall locally leave the associated MBS multicast sessions and the network shall consider the UE as removed from the associated MBS sessions.\n6.1.5\tCoordination for interworking with ePDG connected to EPC\nWhen the UE establishes a new PDN connection via an ePDG connected to EPC, to enable the transfer of the PDN connection to N1 mode  in case of inter-system change, the UE allocates a PDU session identity and indicates its value in the PDU session ID field in the N1_MODE_CAPABILITY Notify payload of the IKE_AUTH request message (see 3GPP\u00a0TS\u00a024.302\u00a0[16]). The network provides the UE with an S-NSSAI in the N1_MODE_INFORMATION Notify payload of the IKE_AUTH response message (see 3GPP\u00a0TS\u00a024.302\u00a0[16]).\n\nUpon inter-system change to N1 mode , for PDN connection(s) established via an ePDG connected to EPC, if present, the UE may:\na)\tkeep some or all of these PDN connections still via ePDG connected to EPC, if supported;\nb)\trelease some or all of these PDN connections explicitly by initiating the UE initiated tunnel disconnection procedure(s) as specified in 3GPP\u00a0TS\u00a024.302\u00a0[16]; or\nc)\tattempt to transfer some or all of these PDN connections to N1 mode using the parameters of the PDN connection for which the UE has allocated a PDU session identity by initiating the PDU session establishment procedure(s) with the PDU SESSION ESTABLISHMENT REQUEST message created. In that case, for each and every PDN connection to be transferred:\n1)\tif the PDN connection is for emergency bearer services, the request type shall be set to \"existing emergency PDU session\". Otherwise the request type shall be set to \"existing PDU session\";\n2)\tif the previously allocated home address information for a PDN connection consists of an IPv4 address only for an ePDG connected to EPC according to 3GPP\u00a0TS\u00a024.302\u00a0[16], the PDU session type shall be set to \"IPv4\";\n3)\tif the previously allocated home address information for a PDN connection consists of an IPv6 prefix only for an ePDG connected to EPC according to 3GPP\u00a0TS\u00a024.302\u00a0[16], the PDU session type shall be set to \"IPv6\";\n4)\tif the previously allocated home address information for a PDN connection consists of both an IPv4 address and an IPv6 prefix for an ePDG connected to EPC according to 3GPP\u00a0TS\u00a024.302\u00a0[16], the PDU session type shall be set to \"IPv4v6\";\n5)\tthe APN of the PDN connection shall be mapped to the DNN of the PDU session;\n6)\tthe PDU session ID shall be set to the PDU session identity in the N1_MODE_CAPABILITY Notify payload of the IKE_AUTH request message establishing IPsec tunnel of the PDN connection;\n7)\tif the PDN connection is not for emergency bearer services, the S-NSSAI of the PDU session shall be set to the S-NSSAI associated with the PDN connection as specified in 3GPP\u00a0TS\u00a024.302\u00a0[16]. The UE shall not request to perform handover of an existing PDN connection to N1 mode if the associated S-NSSAI is not included in the allowed NSSAI for 3GPP access; and\n8)\tthe SSC mode IE shall be set to \"SSC mode 1\".\nIf an existing PDU session is transferred from 3GPP access to an ePDG connected to EPC connection and that existing PDU session is associated with one or more MBS sessions, the UE shall locally leave the associated multicast MBS sessions and the SMF shall consider the UE as removed from the associated multicast MBS sessions.\n6.2\tGeneral on elementary 5GSM procedures\n6.2.1\tPrinciples of PTI handling for 5GSM procedures\nWhen the UE or the network initiates a transaction related procedure (i.e. a procedure consisting of more than one message and the messages are related), it shall include a valid PTI value in the message header of the request message or of the command message.\nIf a response message is sent as result of a received request message or a received command message, the sending entity shall include in the response message the PTI value received within the request message or within the command message (see examples in figure\u00a06.2.1.1, figure\u00a06.2.1.2, and figure\u00a06.2.1.3).\nIf a command message is sent as result of a received request message, the sending entity shall include in the command message the PTI value received with the request message (see examples in figure\u00a06.2.1.3).\nIf a command message is not sent as result of a received request message, the sending entity shall include in the command message the PTI value set to \"no procedure transaction identity assigned\" (see examples in figure\u00a06.2.1.4).\n\nFigure\u00a06.2.1.1: UE-requested transaction related procedure accepted by the network\n\nFigure\u00a06.2.1.2: UE-requested transaction related procedure rejected by the network\n\nFigure\u00a06.2.1.3: UE-requested transaction related procedure triggering a network-requested transaction related procedure\n\nFigure\u00a06.2.1.4: network-requested transaction related procedure not triggered by a UE-requested transaction related procedure\n6.2.2\tPDU session types\nThe following PDU Session types are supported:\na)\tIPv4;\nb)\tIPv6;\nc)\tIPv4v6;\nd)\tEthernet (EtherType as defined in IEEE\u00a0Std\u00a0802.3\u00a0[31A]); and\ne)\tUnstructured.\nIP address allocation for IPv4, IPv6 and IPv4v6 PDU session types is described in subclause\u00a06.2.4.\nNeither a MAC nor an IP address is allocated by the 5GCN to the UE for Ethernet PDU session type.\n6.2.3\tPDU session management\nThe SMF is responsible for the session management functions to provide the PDU connectivity service to the UE via the 5GSM signalling between UE and SMF. The session management procedures includes:\na)\tthe UE-requested PDU session establishment procedure;\nb)\tthe PDU session authentication and authorization procedure;\nc)\tthe UE-requested PDU session modification procedure;\nd)\tthe network-requested PDU session modification procedure;\ne)\tthe UE-requested PDU session release procedure; and\nf)\tthe network-requested PDU session release procedure.\nA UE may establish multiple PDU sessions, to the same data network or to different data networks, via 3GPP access and via non-3GPP access at the same time. It is not required for a UE to initiate the PDU session release procedure to release a PDU session associated with another access, if any, due to the reason that the UE initiates the registration procedure or PDU session establishment procedure over the current access.\nNOTE:\tPDU session is managed independently between 3GPP access and non-3GPP access.\nThe session management messages between UE and SMF are transferred via AMF as specified in subclause\u00a08.3.\n6.2.4\tIP address allocation\n6.2.4.1\tGeneral\nThis clause specifies IP address allocation for the PDU session.\nIn this release of specification, PDU session can be initiated with one IP version, i.e. IPv4 PDU session type or IPv6 PDU session type, or with both IP versions, i.e. IPv4v6 PDU session type.\nIP address allocation to the UE shall be performed by SMF based on one or both the selected IP versions and operator policies. If IPv4 PDU session type is selected, an IPv4 address is allocated to the UE. If IPv6 PDU session type is selected, an IPv6 prefix except when the SMF acts according to subclause\u00a06.2.4.3, and an interface identifier for the IPv6 link local address are allocated to the UE. If IPv4v6 PDU session type is selected, an IPv4 address, an IPv6 prefix except when the SMF acts according to subclause\u00a06.2.4.3 or 6.2.4.4, and an interface identifier for the IPv6 link local address are allocated to the UE. If IPv6 or IPv4v6 PDU session type is selected in a PDU session established by the W-AGF acting on behalf of the FN-RG and the PDU SESSION ESTABLISHMENT REQUEST message contains the Suggested interface identifier IE, the SMF shall allocate to the UE the interface identifier for the IPv6 link local address indicated in the Suggested interface identifier IE.\nFor IPv4 PDU session type and for IPv4v6 PDU session type, the UE:\na)\tshall obtain an IPv4 address via:\n1)\tNAS signalling as specified in subclause\u00a06.2.4.2; or\n2)\tDHCPv4 as specified in IETF\u00a0RFC\u00a02131\u00a0[33E]; and\nb)\tmay obtain IPv4 configuration parameters (e.g. DNS server address) via DHCPv4 as specified in IETF\u00a0RFC\u00a02132\u00a0[33F] or may receive IPv4 configuration parameters (e.g. DNS server address) as specified in subclause\u00a06.4.1 and subclause\u00a06.3.2.\nFor IPv6 PDU session type and for IPv4v6 PDU session type, the UE:\na)\tshall build an IPv6 link local address based on the allocated interface identifier for the IPv6 link local address;\nb)\tshall obtain /64 IPv6 prefix via IPv6 stateless address autoconfiguration as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8] and IETF\u00a0RFC\u00a04862\u00a0[39], except when the 5G-RG or the W-AGF act according to subclause\u00a06.2.4.3; \nc)\tmay obtain IPv6 configuration parameters via stateless DHCPv6 as specified in IETF\u00a0RFC\u00a08415\u00a0[33D], except when the 5G-RG or the W-AGF act according to subclause\u00a06.2.4.3, may receive IPv6 configuration parameters (e.g. DNS server address) as specified in subclause\u00a06.4.1 and subclause\u00a06.3.2, or may receive DNS server IPv6 addresses in a Router Advertisement Message as specified in IETF\u00a0RFC\u00a04861\u00a0[38B] with recursive DNS server option as specified in IETF\u00a0RFC\u00a08106\u00a0[52];and\nd)\tmay obtain an additional IPv6 prefix for a PDU session by IPv6 prefix delegation via DHCPv6 as specified in subclause\u00a06.2.4.2a.\n6.2.4.2\tIP address allocation via NAS signalling\nThe UE shall set the PDU session type IE in the PDU SESSION ESTABLISHMENT REQUEST message, based on its IP stack capabilities if the UE requests IP connectivity as follows:\na)\tA UE:\n1)\twhich is IPv6 and IPv4 capable, shall set the PDU session type IE to IPv4, IPv6 or IPv4v6 according to UE configuration or received policy.\n2)\twhich is only IPv6 capable, shall set the PDU session type IE to IPv6.\n3)\twhich is only IPv4 capable, shall set the PDU session type IE to IPv4.\nb)\tWhen the IP version capability of the UE is unknown in the UE (as in the case when the MT and TE are separated and the capability of the TE is not known in the MT), the UE shall set the PDU session type IE to IPv4v6.\nIf the UE wants to use DHCPv4 for IPv4 address assignment, it shall indicate that to the network within the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT REQUEST.\nOn receipt of the PDU SESSION ESTABLISHMENT REQUEST message sent by the UE, the network when allocating an IP address shall take into account the PDU session type IE, the operator's policies of the network, and the user's subscription data and:\na)\tif the network sets the Selected PDU session type IE to IPv4, the network shall include an IPv4 address in the PDU address IE;\nb)\tif the network sets the Selected PDU session type IE to IPv6, the network shall include an interface identifier for the IPv6 link local address in the PDU address IE; and\nc)\tif the network sets the Selected PDU session type IE to IPv4v6, the network shall include an IPv4 address and an interface identifier for the IPv6 link local address in the PDU address IE.\n6.2.4.2a\tIPv6 prefix delegation via DHCPv6\nIn order to perform the IPv6 prefix delegation via DHCPv6, the UE shall use DHCPv6 to request additional IPv6 prefixes (i.e. prefixes shorter than the default /64 prefix) from the SMF. The UE shall act as a \"Requesting Router\" as described in IETF\u00a0RFC\u00a08415\u00a0[33D] and shall insert one or more identity association for prefix delegation options into a DHCPv6 Solicit message.\nIf the IPv6 address allocation using IPv6 stateless address autoconfiguration is used, the UE sends the DHCPv6 message to request additional IPv6 prefixes to the SMF after the PDU session establishment and IPv6 prefix allocation.\nWhen the UE requests additional prefixes using DHCPv6, the UE may include DHCPv6 Rapid Commit option as specified in IETF\u00a0RFC\u00a08415\u00a0[33D] in a DHCPv6 Solicit message, and the UE other than the ones specified in subclause\u00a06.2.4.3 shall include DHCPv6 OPTION_ORO option with the OPTION_PD_EXCLUDE option code as specified in IETF\u00a0RFC\u00a06603\u00a0[40A] in the DHCPv6 message.\nUpon receiving one or more identity association for prefix delegation prefixes in a DHCPv6 Reply message, the UE is allowed to use the allocated additional prefixes after inter-system change from N1 mode to S1 mode or from S1 mode to N1 mode.\n6.2.4.3\tAdditional RG related requirements for IP address allocation\nIf IPv6 PDU session type or IPv4v6 PDU session type is selected, an IPv6 address, one or more IPv6 prefixes or both are allocated to the 5G-RG or the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device).\nIf the 5G-RG or the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) receives a Router Advertisement Message as specified in IETF\u00a0RFC\u00a04861\u00a0[38B] with the \"Managed address configuration\" flag set to zero, the 5G-RG and the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device):\na)\tshall obtain /64 IPv6 prefix via IPv6 stateless address autoconfiguration as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8] and IETF\u00a0RFC\u00a04862\u00a0[39];\nb)\tmay obtain IPv6 configuration parameters via stateless DHCPv6 as specified in IETF\u00a0RFC\u00a08415\u00a0[33D]; and\nc)\tmay request additional IPv6 prefixes using DHCPv6. If the 5G-RG and the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) request IPv6 prefixes using DHCPv6, the 5G-RG and the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) shall act as a \"Requesting Router\" as described in IETF\u00a0RFC\u00a08415\u00a0[33D], shall perform procedures described in subclause\u00a06.2.4.2a. Additionally, the 5G-RG or the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) may include DHCPv6 OPTION_ORO option with the OPTION_PD_EXCLUDE option code as specified in IETF\u00a0RFC\u00a06603\u00a0[40A] in the DHCP.\nIf the 5G-RG or the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) receives a Router Advertisement Message as specified in IETF\u00a0RFC\u00a04861\u00a0[38B] with the \"Managed address configuration\" flag set to one, the 5G-RG and the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device):\na)\tshall obtain an IPv6 address via DHCPv6 and the DHCPv6 Identity association for non-temporary addresses option as specified in IETF\u00a0RFC\u00a08415\u00a0[33D];\nb)\tmay obtain IPv6 configuration parameters via DHCPv6 as specified in IETF\u00a0RFC\u00a08415\u00a0[33D]; and\nc)\tmay request IPv6 prefixes using DHCPv6. If the 5G-RG and the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) requests IPv6 prefixes using DHCPv6, the 5G-RG and the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) shall act as a \"Requesting Router\" as described in IETF\u00a0RFC\u00a08415\u00a0[33D], shall perform procedures described in subclause\u00a06.2.4.2a. Additionally, the 5G-RG or the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) may include DHCPv6 OPTION_ORO option with the OPTION_PD_EXCLUDE option code as specified in IETF\u00a0RFC\u00a06603\u00a0[40A] in the DHCP message. The 5G-RG or the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) may include both IA_PD option and IA_NA option to request the delegated prefix together with the IPv6 address in the same DHCPv6 message.\nNOTE:\tThe 5G-RG and the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) can send multiple DHCPv6 requests with different DHCPv6 Identity association for non-temporary addresses options when the 5G-RG or the FN-RG acts as a DHCP relay for devices behind the 5G-RG or the FN-RG.\nThe 5G-RG may obtain ACS information via DHCP as specified in subclause\u00a03.1 of BBF\u00a0TR-069\u00a0[49] or in BBF\u00a0TR-369\u00a0[50] R-DIS.1 and R-DIS.2.\n6.2.4.4\tAdditional requirements of the UE acting as 5G ProSe layer-3 UE-to-network relay UE for IP address allocation\nIf a UE acting as 5G ProSe layer-3 UE-to-network relay needs to indicate \"IPv6 Router\" or \"DHCPv4 Server & IPv6 Router\" in the IP address configuration IE as specified in 3GPP\u00a024.554\u00a0[19E], the UE shall support acting as a \"Requesting Router\" as described in IETF\u00a0RFC\u00a08415\u00a0[33D] to request additional IPv6 prefixes (i.e. prefixes in addition to the /64 default prefix which was allocated via stateless IPv6 address autoconfiguration as specified in subclause\u00a06.2.4.1) from the SMF as specified in subclause\u00a05.5.2 of 3GPP\u00a0TS\u00a023.304\u00a0[6E].\nWhen the UE acting as 5G ProSe layer-3 UE-to-network relay UE requests additional prefixes using DHCPv6, the UE shall perform procedures described in subclause\u00a06.2.4.2a.\n6.2.5\tQuality of service\n6.2.5.1\tGeneral\n6.2.5.1.1\tQoS rules\n6.2.5.1.1.1\tGeneral\nIn a PDU session of IPv4, IPv6, IPv4v6 and Ethernet PDU session type, the NAS protocol enables different forwarding treatments of UL user data packets in one or more QoS flows based on signalled QoS rules, derived QoS rules or any combination of them.\nIn a PDU session of Unstructured PDU session type, all UL user data packets are associated with the same QoS flow.\n6.2.5.1.1.2\tSignalled QoS rules\nThe NAS protocol enables the network to provide the UE with signalled QoS rules associated with a PDU session.\nThe network can provide the UE with one or more signalled QoS rules associated with a PDU session at the PDU session establishment or at the PDU session modification.\nEach signalled QoS rule contains:\na)\tan indication of whether the QoS rule is the default QoS rule;\nb)\ta QoS rule identifier (QRI);\nc)\ta QoS flow identifier (QFI);\nd)\toptionally, a set of packet filters; and\ne)\ta precedence value.\nNOTE\u00a01:\tThe default QoS rule indication (DQR) of a signalled QoS rule cannot be changed.\nFor case d) above:\n1)\tIf the QoS rule is the default QoS rule of a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type, the set of packet filters contains zero or more packet filters for DL direction, and may additionaly contain one of the following:\nA)\ta match-all packet filter for UL direction;\nB)\ta match-all packet filter for UL and DL directions;\nC)\tzero or more packet filters for UL direction (other than the match-all packet filter for UL direction);\nD)\tzero or more packet filters for UL and DL directions (other than the match-all packet filter for UL and DL directions); or\nE)\tone or more packet filters for UL direction (other than the match-all packet filter for UL direction) and one or more packet filters for UL and DL directions (other than the match-all packet filter for UL and DL directions).\n\tThe set of packet filters for the default QoS rule shall not be empty. If the default QoS rule contains a match-all packet filter, then the highest precedence value shall be used for the default QoS rule.\nNOTE\u00a01a:\tSet of packet filters for the default QoS rule can contain only packet filters for DL direction e.g. for determination that local preconditions are met in an IMS session (see 3GPP\u00a0TS\u00a024.229\u00a0[14]) with a receive only media.\n2)\tIf the QoS rule is a QoS rule of a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type and is not the default QoS rule, the set of packet filters contains zero or more packet filters for the DL direction, and may additionally contain one of the following:\nA)\tzero or more packet filters for UL direction (other than the match-all packet filter for UL direction); and\nB)\tzero or more packet filters for both UL and DL directions (other than the match-all packet filter for UL and DL directions).\nThe set of packet filters for a QoS rule which is not the default QoS rule shall not be empty.\nNOTE\u00a01b:\tSet of packet filters for a QoS rule which is not the default QoS rule can contain only packet filters for DL direction e.g. for determination that local preconditions are met in an IMS session (see 3GPP\u00a0TS\u00a024.229\u00a0[14]) with a receive only media.\n3)\tFor PDU session of unstructured PDU session type, there is only one QoS rule associated with it and the set of packet filters of that QoS rule is empty.\nIf the UE requests a new QoS rule, it shall assign a precedence value for the signalled QoS rule which is not in the range from 70 to 99 (decimal).\nNOTE\u00a02:\tIn this release of the specification, there is no support for a match-all packet filter for DL direction.\nNOTE\u00a03:\tIn order to support QoS differentiation in case of access to PLMN services via an SNPN, the UE, within the SNPN, can construct packet filters based on the destination IP address to reach the N3IWF in the PLMN and the security parameters index (SPI) for the IPsec SA.\nNOTE\u00a04:\tIn order to support QoS differentiation in case of access to SNPN services via a PLMN, the UE, within the PLMN, can construct packet filters based on the destination IP address to reach the N3IWF in the SNPN and the security parameters index (SPI) for the IPsec SA.\nNOTE\u00a05:\tThe above described condition of assigning a precedence value for the signalled QoS rule is applied to the UE when the UE requests a QoS rule for network to bind service data flows described by the QoS rule to a dedicated QoS flow by setting the segregation bit to 1.\nIn NB-N1 mode, there is only one QoS rule associated with a PDU session and that is the default QoS rule. As described in 3GPP\u00a0TS\u00a023.501\u00a0[8], when the SMF determines that the UE has:\na)\tmoved from a tracking area in WB-N1 mode into a tracking area in NB-N1 mode;\nb)\tmoved from a tracking area in WB-S1 mode into a tracking area in NB-N1 mode; or\nc)\tmoved from a tracking area in NR connected to 5GCN into a tracking area in NB-N1 mode;\nthe SMF shall, for each PDU session that is kept active, initiate the PDU session modification procedure (see subclause\u00a06.3.3.2) to delete every QoS rule that is not the default QoS rule, if any.\nWithin a PDU session:\na)\teach signalled QoS rule has a unique QRI;\nb)\tthere is at least one signalled QoS rule;\nc)\tone signalled QoS rule is the default QoS rule; and\nd)\tthere can be zero, one or more signalled QoS rules associated with a given QFI.\n6.2.5.1.1.3\tDerived QoS rules\nDerived QoS rules are applicable only for PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type.\nThe reflective QoS in the UE creates derived QoS rules associated with a PDU session based on DL user data packets received via the PDU session.\nEach derived QoS rule contains:\na)\ta QoS flow identifier (QFI);\nb)\ta packet filter for UL direction; and\nc)\ta precedence value of 80 (decimal).\nNOTE:\tOn the network side, the corresponding QoS rule can be associated with a different precedence value in the range from 70 to 99 (decimal).\nWithin a PDU session:\na)\tthere can be zero, one or more derived QoS rules associated with a given QFI; and\nb)\tthere can be up to one derived QoS rule associated with a given packet filter for UL direction.\nIn the UE, a timer T3583 runs for each derived QoS rule.\nReflective QoS is not supported in NB-N1 mode. Reflective QoS is not applicable for a PDU session with control plane only indication.\n6.2.5.1.1.4\tQoS flow descriptions\nThe network can also provide the UE with one or more QoS flow descriptions associated with a PDU session at the PDU session establishment or at the PDU session modification.\nEach QoS flow description contains:\na)\ta QoS flow identifier (QFI);\nb)\tif the flow is a GBR QoS flow:\n1)\tGuaranteed flow bit rate (GFBR) for UL;\n2)\tGuaranteed flow bit rate (GFBR) for DL;\n3)\tMaximum flow bit rate (MFBR) for UL;\n4)\tMaximum flow bit rate (MFBR) for DL; and\n5)\toptionally averaging window, applicable for both UL and DL;\nc)\t5QI, if the QFI is not the same as the 5QI of the QoS flow identified by the QFI; and\nd)\toptionally, an EPS bearer identity (EBI) if the QoS flow can be mapped to an EPS bearer as specified in subclause\u00a04.11.1 of 3GPP\u00a0TS\u00a023.502\u00a0[9].\nIf the averaging window is not included in a QoS flow description for a GBR QoS flow with a 5QI indicated in 3GPP\u00a0TS\u00a023.501\u00a0[8] table\u00a05.7.4-1, the averaging window associated with the 5QI in 3GPP\u00a0TS\u00a023.501\u00a0[8] table\u00a05.7.4-1 applies for the averaging window.\nIf the averaging window is not included in a QoS flow description for a GBR QoS flow with a 5QI not indicated in 3GPP\u00a0TS\u00a023.501\u00a0[8] table\u00a05.7.4-1, the standardized value of two seconds is used as the averaging window.\n6.2.5.1.2\tSession-AMBR\nThe NAS protocol enables the network to provide the UE with the session-AMBR associated with a PDU session.\nThe standardized value of two seconds is used as the averaging window for the UE's enforcement of the UL rate limitation indicated by the session-AMBR.\n6.2.5.1.2A\tVoid\n6.2.5.1.3\tUL user data packet matching\nFor PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type, upon receiving an UL user data packet from the upper layers for transmission via a PDU session, the UE shall attempt to associate the UL user data packet with:\na)\tthe QFI of a signalled QoS rule associated with the PDU session which has a set of packet filters containing a packet filter for UL direction matching the UL user data packet or containing a packet filter for both UL and DL directions matching the UL user data packet; or\nb)\tthe QFI of a derived QoS rule associated with the PDU session which has the packet filter for UL direction matching the UL user data packet;\nby evaluating the QoS rules in increasing order of their precedence values until the UL user data packet is associated with a QFI or all QoS rules are evaluated.\nFor PDU session of unstructured PDU session type, upon receiving an UL user data packet from the upper layers for transmission via a PDU session, the UE shall associate the UL user data packet with the QFI of the default QoS rule associated with the PDU session.\nIf the UL user data packet is associated with a QFI, the UE shall pass the QFI along the UL user data packet to the lower layers for transmission.\nNOTE:\tMarking of the UL user data packet with the QFI is performed by the lower layers.\nIf all QoS rules are evaluated and the UL user data packet is not associated with a QFI, the UE shall discard the UL user data packet.\n6.2.5.1.4\tReflective QoS\n6.2.5.1.4.1\tGeneral\nThe UE may support reflective QoS.\nIf the UE supports the reflective QoS, the UE shall support the procedures in the following subclauses.\nThe reflective QoS is applicable in a PDU session of IPv4, IPv6, IPv4v6 and Ethernet PDU session type. The reflective QoS is not applicable in a PDU session of Unstructured PDU session type. Reflective QoS is not applicable for a PDU session with control plane only indication.\nThe UE may request to revoke the usage of reflective QoS for an existing PDU session for which the UE had previously indicated support for reflective QoS.\n6.2.5.1.4.2\tDerivation of packet filter for UL direction from DL user data packet\nIf the UE needs to derive a packet filter for UL direction from the DL user data packet (see subclause\u00a06.2.5.1.4.3 and 6.2.5.1.4.4), the UE shall proceed as follows:\na)\tif the received DL user data packet belongs to a PDU session of IPv4 or IPv4v6 PDU session type and is an IPv4 packet and:\n1)\tthe protocol field of the received DL user data packet indicates TCP as specified in IETF\u00a0RFC\u00a0793\u00a0[33];\n2)\tthe protocol field of the received DL user data packet indicates UDP as specified in IETF\u00a0RFC\u00a0768\u00a0[32]; or\n3)\tthe protocol field of the received DL user data packet indicates ESP as specified in IETF\u00a0RFC\u00a04303\u00a0[38] and an uplink IPSec SA corresponding to a downlink IPSec SA indicated in the security parameters index field of the received DL user data packet exists;\n\tthen the packet filter for UL direction contains the following packet filter components:\n1)\tan IPv4 remote address component set to the value of the source address field of the received DL user data packet;\n2)\tan IPv4 local address component set to the value of the destination address field of the received DL user data packet;\n3)\ta protocol identifier/next header type component set to the value of the protocol field of the received DL user data packet;\n4)\tif the protocol field of the received DL user data packet indicates TCP as specified in IETF\u00a0RFC\u00a0793\u00a0[33] or UDP as specified in IETF\u00a0RFC\u00a0768\u00a0[32]:\ni)\ta single local port type component set to the value of the destination port field of the received DL user data packet; and\nii)\ta single remote port type component set to the value of the source port field of the received DL user data packet;\n5)\tif the protocol field of the received DL user data packet indicates ESP as specified in IETF\u00a0RFC\u00a04303\u00a0[38], an uplink IPSec SA corresponding to a downlink IPSec SA of the SPI in the DL user data packet exists and the SPI of the uplink IPSec SA is known to the NAS layer:\ni)\ta security parameter index type component set to the security parameters index of the uplink IPSec SA corresponding to the downlink IPSec SA indicated in the security parameters index field of the received DL user data packet; and\n6)\tif the protocol field of the received DL user data packet indicates UDP and the received DL user data packet contains a UDP-encapsulated ESP header as specified in IETF\u00a0RFC\u00a03948\u00a0[55], an uplink IPSec SA corresponding to a downlink IPSec SA of the SPI in the DL user data packet exists and the SPI of the uplink IPSec SA is known to the NAS layer:\ni)\ta security parameter index type component set to the security parameters index of the uplink IPSec SA corresponding to the downlink IPSec SA indicated in the security parameters index field of the ESP header field of the UDP-encapsulated ESP header as specified in IETF\u00a0RFC\u00a03948\u00a0[55] of the received DL user data packet;\n\totherwise it is not possible to derive a packet filter for UL direction from the DL user data packet;\nb)\tif the received DL user data packet belongs to a PDU session of IPv6 or IPv4v6 PDU session type and is an IPv6 packet and:\n1)\tthe last next header field of the received DL user data packet indicates TCP as specified in IETF\u00a0RFC\u00a0793\u00a0[33];\n2)\tthe last next header field of the received DL user data packet indicates UDP as specified in IETF\u00a0RFC\u00a0768\u00a0[32]; or\n3)\tthe last next header field of the received DL user data packet indicates ESP as specified in IETF\u00a0RFC\u00a04303\u00a0[38] and an uplink IPSec SA corresponding to a downlink IPSec SA indicated in the security parameters index field of the received DL user data packet exists;\n\tthen the packet filter for UL direction contains the following packet filter components:\n1)\tan IPv6 remote address/prefix length component set to the value of the source address field of the received DL user data packet;\n2)\tan IPv6 local address/prefix length component set to the value of the destination address field of the received DL user data packet;\n3)\ta protocol identifier/next header type component set to the value of the last next header field of the received DL user data packet;\n4)\tif the last next header field of the received DL user data packet indicates TCP as specified in IETF\u00a0RFC\u00a0793\u00a0[33] or UDP as specified in IETF\u00a0RFC\u00a0768\u00a0[32]:\ni)\ta single local port type component set to the value of the destination port field of the received DL user data packet; and\nii)\ta single remote port type component set to the value of the source port field of the received DL user data packet;\n5)\tif the last next header field of the received DL user data packet indicates ESP as specified in IETF\u00a0RFC\u00a04303\u00a0[38], an uplink IPSec SA corresponding to a downlink IPSec SA of the SPI in the DL user data packet exists and the SPI of the uplink IPSec SA is known to the NAS layer:\ni)\ta security parameter index type component set to the security parameters index of the uplink IPSec SA corresponding to the downlink IPSec SA indicated in the security parameters index field of the received DL user data packet; and\n6)\tif the last next header field of the received DL user data packet indicates UDP, and the received DL user data packet contains a UDP-encapsulated ESP header as specified in IETF\u00a0RFC\u00a03948\u00a0[55], an uplink IPSec SA corresponding to a downlink IPSec SA of the SPI in the DL user data packet exists and the SPI of the uplink IPSec SA is known to the NAS layer:\ni)\ta security parameter index type component set to the security parameters index of the uplink IPSec SA corresponding to the downlink IPSec SA indicated in the security parameters index field of the ESP header field of the UDP-encapsulated ESP header as specified in IETF\u00a0RFC\u00a03948\u00a0[55] of the received DL user data packet;\n\totherwise it is not possible to derive a packet filter for UL direction from the DL user data packet;\nc)\tif the received DL user data packet belongs to a PDU session of Ethernet PDU session type, the packet filter for UL direction contains the following packet filter components:\n1)\ta destination MAC address component set to the source MAC address of the received DL user data packet;\n2)\ta source MAC address component set to the destination MAC address of the received DL user data packet;\n3)\tif one or more 802.1Q C-TAG is included in the received DL user data packet, an 802.1Q C-TAG VID component set to the outermost 802.1Q C-TAG VID of the received DL user data packet and an 802.1Q C-TAG PCP/DEI component set to the outermost 802.1Q C-TAG PCP/DEI of the received DL user data packet;\n4)\tif one or more 802.1Q S-TAG is included in the received DL user data packet, an 802.1Q S-TAG VID component set to the outermost 802.1Q S-TAG VID of the received DL user data packet and an 802.1Q S-TAG PCP/DEI component set to the outermost 802.1Q S-TAG PCP/DEI of the received DL user data packet;\n5)\tIf the Ethertype field of the received DL user data packet is set to a value of 1536 or above, an Ethertype component set to the Ethertype of the received DL user data packet;\n6)\tif the Ethertype field of the Ethernet frame header indicates that the data carried in the Ethernet frame is IPv4 data, the UE shall also add to the packet filter for UL direction the IP-specific components based on the contents of the IP header of the received DL user data packet as described in bullet a) above; and\n7)\tif the Ethertype field of the Ethernet frame header indicates that the data carried in the Ethernet frame is IPv6 data, the UE shall also add to the packet filter for UL direction the IP-specific components based on the contents of the IP header of the received DL user data packet as described in bullet b) above; and\nd)\tif the received DL user data packet belongs to a PDU session of PDU session type other than Ethernet, IPv4, IPv6 and IPv4v6, it is not possible to derive a packet filter for UL direction from the DL user data packet.\n6.2.5.1.4.3\tCreating a derived QoS rule by reflective QoS in the UE\nIf the UE receives a DL user data packet marked with a QFI and an RQI, the DL user data packet belongs to a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type, and the UE does not have a derived QoS rule with the same packet filter for UL direction as the packet filter for UL direction derived from the DL user data packet as specified in subclause\u00a06.2.5.1.4.2, then the UE shall create a new derived QoS rule as follows:\na)\tthe QFI of the derived QoS rule is set to the received QFI;\nb)\tthe precedence value of the derived QoS rule is set to 80 (decimal); and\nc)\tthe packet filter for UL direction of the derived QoS rule is set to the derived packet filter for UL direction;\nand the UE shall start the timer T3583 associated with the derived QoS rule with the RQ timer value last received during the UE-requested PDU session establishment procedure of the PDU session (see subclause\u00a06.4.1) or the network-requested PDU session modification procedure of the PDU session (see subclause\u00a06.4.2). If the RQ timer value was received neither in the UE-requested PDU session establishment procedure of the PDU session nor in any network-requested PDU session modification procedure of the PDU session, the default standardized RQ timer value is used.\n6.2.5.1.4.4\tUpdating a derived QoS rule by reflective QoS in the UE\nIf the UE receives a DL user data packet associated with a QFI and an RQI, the DL user data packet belongs to a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type, and the UE has a derived QoS rule with the same packet filter for UL direction as the packet filter for UL direction derived from the DL user data packet as specified in subclause\u00a06.2.5.1.4.2:\na)\tthe UE shall re-start the timer T3583 associated with the derived QoS rule with the RQ timer value last received during the UE-requested PDU session establishment procedure of the PDU session (see subclause\u00a06.4.1) or the network-requested PDU session modification procedure of the PDU session (see subclause\u00a06.4.2). If the RQ timer value was received neither in the UE-requested PDU session establishment procedure of the PDU session nor in any network-requested PDU session modification procedure of the PDU session, the default standardized RQ timer value is used; and\nb)\tif the QFI value associated with the DL user data packet is different from the QFI value stored for the derived QoS rule, the UE shall replace the QFI value stored for the derived QoS rule with the new QFI value for the derived QoS rule.\n6.2.5.1.4.5\tDeleting a derived QoS rule in the UE\nUpon expiry of timer T3583 associated with a derived QoS rule, the UE shall remove the derived QoS rule.\nUpon release of the PDU session, the UE shall remove the derived QoS rule(s) associated with the PDU session.\nIf the network accepts the request from the UE to revoke the usage of reflective QoS and sets the value of the RQ timer to \"deactivated\" or zero, the UE shall remove the derived QoS rule(s) associated with the PDU session.\nUpon inter-system mobility from WB-N1 mode to NB-N1 mode or from NR connected to 5GCN to NB-N1 mode, the UE shall remove the derived QoS rule(s) associated with the PDU session that is kept active.\nWhen a derived QoS rule is deleted, the timer T3583 associated with the derived QoS rule shall be stopped.\n6.2.5.1.4.6\tIgnoring RQI in the UE\nIf the UE receives a DL user data packet marked with a QFI and an RQI and it is not possible to derive a packet filter for UL direction from the DL user data packet as specified in subclause\u00a06.2.5.1.4.2, the UE shall ignore the RQI and shall handle the received DL user data packet.\n6.2.5.2\tQoS in MA PDU session\nIn an MA PDU session, unless it :\na)\tis established over non-3GPP access; and\nb)\thas a PDN connection as a user-plane resource;\nthe UE shall have one set of QoS rules, one set of QoS flow descriptions and one session-AMBR. The network can provide the set of QoS rules, the set of QoS flow descriptions and the session-AMBR of the MA PDU session via either access of the MA PDU session. In an MA PDU session, the UE shall support:-\n-\tmodification or deletion via an access of a QoS rule or a QoS flow description; and\n-\tmodification via an access of the session-AMBR;\nof the MA PDU session created via the same or the other access.\nIn an MA PDU session:\na)\testablished over non-3GPP access; and\nb)\twith a PDN connection as a user-plane resource;\nthe UE shall have two sets of QoS rules, two sets of QoS flow descriptions and two session-AMBR values - one is maintained via non-3GPP access and the other is associated with EPS bearer contexts of the PDN connection and maintained via Extended protocol configuration options IE parameters received via the PDN connection.\n6.2.6\tLocal area data network (LADN)\nThe UE can receive the local area data network (LADN) information consisting of LADN DNNs and LADN service area information (a set of tracking areas that belong to the current registration area) during the registration procedure or the generic UE configuration update procedure (see subclause\u00a05.5.1 and subclause\u00a05.4.4).\nIf the UE supports LADN per DNN and S-NSSAI, the UE can additionally receive the extended local area data network (LADN) information consisting of LADN DNNs, S-NSSAIs and LADN service area information (a set of tracking areas configured per DNN and S-NSSAI that belong to the current registration area) during the registration procedure or the generic UE configuration update procedure (see subclause\u00a05.5.1 and subclause\u00a05.4.4).\nIf the UE is not operating in SNPN access operation mode, the UE considers the received LADN information or the extended LADN information to be valid only in the TAIs of the registered PLMN that are in the LADN service area information, and in the TAIs of the equivalent PLMNs if the LADN service area information includes TAIs for the equivalent PLMNs. When the AMF provides the UE with LADN service area information containing TAIs for the equivalent PLMNs, the AMF shall include these TAIs of the equivalent PLMNs in the UE's registration area.\nIf the UE is operating in SNPN access operation mode, the UE considers the received LADN information or the extended LADN information to be valid only in the TAIs of the registered SNPN that are in the LADN service area information.\nThe LADN DNN(s) received by the UE is also considered as LADN DNN(s) in the equivalent PLMNs.\nThe UE shall consider itself to be located inside the LADN service area based on the LADN service area information. If the UE does not have anLADN service area information for the LADN DNN, the UE shall consider itself to be located outside the LADN service area.\nWhen the UE is located in the LADN service area and the UE is in substate 5GMM-REGISTERED.NORMAL-SERVICE, the UE may initiate:\n-\tthe UE-requested PDU session establishment procedure with an LADN DNN to establish a PDU session for LADN;\n-\tthe UE-requested PDU session establishment procedure with an LADN DNN and an S-NSSAI associated with the LADN to establish a PDU session for LADN if the extended LADN information is available at the UE;\n-\tthe UE-requested PDU session modification procedure to modify the PDU session for LADN;\n-\tthe service request procedure to re-establish the user-plane resources for the PDU session for LADN; or\n-\tthe service request procedure or the UE-initiated NAS transport procedure to send CIoT user data via the control plane for a PDU session for LADN.\nNOTE\u00a01:\tIf the Service area list IE and at least one of the LADN information IE or the Extended LADN information IE was received by the UE, the Service area list IE is evaluated first.\nNOTE\u00a01A: \tIf the Extended LADN information IE was received with either the Partially allowed NSSAI IE or the Partially rejected NSSAI IE by the UE, the Partially allowed NSSAI IE or the Partially rejected NSSAI IE is evaluated first.\nWhen the UE is located outside the LADN service area, the UE is allowed:\n-\tto initiate the UE-requested PDU session release procedure to release a PDU session for LADN; or\n-\tto initiate the UE-requested PDU session modification procedure to indicate a change of 3GPP PS data off UE status.\nThe AMF shall determine the UE presence in LADN service area as out of the LADN service area in the following cases:\n-\tif the DNN used for the LADN is included in the LADN information and the UE is located outside the LADN service area indicated in the LADN information;\n-\tif the DNN and the S-NSSAI used for the LADN are included in the extended LADN information and the UE is located outside the LADN service area indicated in the extended LADN information;\n-\tif the DNN used for the LADN is included in the extended LADN information and there is no S-NSSAI provided by the UE to establish a PDU session for LADN; or\n-\tif the DNN used for the LADN is included in the extended LADN information and the S-NSSAI provided by the UE to establish a PDU session for LADN is not associated with that LADN.\nIf the UE has moved out of the LADN service area:\na)\tthe SMF shall:\n1)\trelease the PDU session for LADN; or\n2)\trelease the user-plane resources for the PDU session for LADN and maintain the PDU session for LADN;\naccording to operator's policy; and \nb)\tthe SMF shall not initiate the transfer of CIoT user data via the control plane to the UE for the PDU session for LADN.\nIn case a2) and b):\n-\tif the UE has returned to the LADN service area, and the network has downlink user data pending, the network re-establishes the user-plane resources for the PDU session for LADN; \n-\tif the UE has returned to the LADN service area, and the network has downlink CIoT user data pending, the SMF shall initiate the CIoT user data via the control plane transfer to the UE; and\n-\tif the UE has not returned to the LADN service area after a period of time according to operator's policy, the SMF may release the PDU session for LADN.\nWhen the UE moves to 5GMM-DEREGISTERED state, the UE shall delete the stored LADN information, if any, and the stored extended LADN information, if any.\nNOTE\u00a02:\tIn this release, LADNs apply only to 3GPP access.\nUpon inter-system change from N1 mode to S1 mode in EMM-IDLE mode, the UE shall not transfer a PDU session for LADN to EPS.\nIf:\nthe UE supports LADN per DNN and S-NSSAI;\nthe UE has a PDU session established using the DNN and S-NSSAI which are not associated with any LADN service area indicated in the extended LADN information;\nan LADN service area is configured in the extended LADN information which is associated with the DNN and S-NSSAI of the PDU session; and\nthe AMF determines the UE presence in LADN service area as out of the LADN service area configured in the extended LADN information as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9];\nthe AMF requests the SMF to release this PDU session.\nIf:\nthe UE supports LADN per DNN and S-NSSAI;\nthe UE has a PDU session for LADN established; and\nthe AMF determines that the LADN service area associated with the DNN and S-NSSAI of the PDU session for LADN is removed from the extended LADN information as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9];\nthe AMF requests the SMF to release this PDU session.\n6.2.7\tHandling of DNN based congestion control\nThe network may detect and start performing DNN based congestion control when one or more DNN congestion criteria as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8] are met. If the UE does not provide a DNN for a non-emergency PDU session, then the network uses the selected DNN.\nIn the UE, 5GS session management timers T3396 for DNN based congestion control are started and stopped on a per DNN basis except for an LADN DNN in case of PLMN. For an LADN DNN, 5GS session management timers T3396 for DNN based congestion control is applied to the registered PLMN and its equivalent PLMNs. In case of SNPN, if the UE does not support access to an SNPN using credentials from a credentials holder and equivalent SNPNs, in the UE, 5GS session management timers T3396 for DNN based congestion control are started and stopped on a per DNN and SNPN basis. If the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, in the UE 5GS session management timers T3396 for DNN based congestion control are started and stopped on a per DNN, SNPN and selected entry of the \"list of subscriber data\" or selected PLMN subscription basis. Upon receipt of a 5GMM message or 5GSM message from the network for which the UE needs to stop the running timers T3396 associated with an LADN DNN as specified in subclause\u00a06.3.2.3, 6.3.3.3, 6.4.1.4.2 and 6.4.2.4.2, only the running timer T3396 which is associated with the PLMN and equivalent PLMNs where the timer was started is stopped.\nIn an SNPN, if the UE supports equivalent SNPNs, the UE applies the timer T3396 for all the equivalent SNPNs, otherwise the UE applies the timer T3396 for the registered SNPN.\nThe DNN associated with T3396 is the DNN provided by the UE during the PDU session establishment. If no DNN is provided by the UE along the PDU SESSION ESTABLISHMENT REQUEST, then T3396 is associated with no DNN. For this purpose, the UE shall memorize the DNN provided to the network during the PDU session establishment. The timer T3396 associated with no DNN will never be started due to any 5GSM procedure related to an emergency PDU session. If the timer T3396 associated with no DNN is running, it does not affect the ability of the UE to request an emergency PDU session.\nIn a PLMN, if T3396 is running or is deactivated, then the UE is not allowed to initiate the:\na)\tPDU session establishment procedure;\nb)\tPDU session modification procedure; or\nc)\tNAS transport procedure for sending CIoT user data; \nfor the respective DNN or without a DNN unless the UE is a UE configured for high priority access in selected PLMN or to report a change of 3GPP PS data off UE status.\nIn an SNPN, if T3396 is running or is deactivated for the registered SNPN, is associated with a DNN or with no DNN, with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, then the UE is not allowed to initiate the\na)\tPDU session establishment procedure; or\nb)\tPDU session modification procedure;\nfor the respective DNN or without a DNN unless the UE is a UE configured for high priority access in the RSNPN or to report a change of 3GPP PS data off UE status.\nIn an SNPN, if the UE supports equivalent SNPNs, the timer T3396 is running or is deactivated for all the equivalent SNPNs, is associated with a DNN or no DNN, with the RSNPN or an equivalent SNPN, and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, then the UE is not allowed to initiate the:\na)\tPDU session establishment procedure; or\nb)\tPDU session modification procedure;\nfor the respective DNN or without a DNN unless the UE is a UE configured for high priority access in selected SNPN or to report a change of 3GPP PS data off UE status.\n6.2.8\tHandling of S-NSSAI based congestion control\nThe network may detect and start performing S-NSSAI based congestion control when one or more S-NSSAI congestion criteria as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8] are met. If the UE does not provide a DNN for a non-emergency PDU session, then the network uses the selected DNN. If the UE does not provide an S-NSSAI for a non-emergency PDU session, then the network uses the selected S-NSSAI.\nIn case of PLMN or SNPN, in the UE, 5GS session management timers T3584 for the S-NSSAI based congestion control are started and stopped on a per S-NSSAI, DNN and PLMN or SNPN basis. If the 5GSM congestion re-attempt indicator IE with the ABO bit set to \"The back-off timer is applied in all PLMNs or equivalent SNPNs \" is included in the 5GSM message with the 5GSM cause value #67 \"insufficient resources for specific slice and DNN\", then the UE applies the timer T3584 for all the PLMNs or all the equivalent SNPNs. Otherwise, the UE applies the timer T3584 for the registered PLMN or the registered SNPN. If the timer T3584 applies for all the PLMNs or all the equivalent SNPNs, the timer T3584 starts when the UE is registered in a VPLMN or an unsubscribed SNPN and the S-NSSAI is provided by the UE during the PDU session establishment, the timer T3584 is associated with the [mapped S-NSSAI, DNN] combination of the PDU session.\nIn case of PLMN or SNPN, in the UE, 5GS session management timers T3585 for the S-NSSAI based congestion control are started and stopped on a per S-NSSAI and PLMN or SNPN basis. If the 5GSM congestion re-attempt indicator IE with the ABO bit set to \"The back-off timer is applied in all PLMNs or all equivalent SNPNs \" is included in the 5GSM message with the 5GSM cause value #69 \"insufficient resources for specific slice\", then the UE applies the timer T3585 for all the PLMNs or all the equivalent SNPNs. Otherwise, the UE applies the timer T3585 for the registered PLMN or registered SNPN. If the timer T3585 applies for all the PLMNs or all the equivalent SNPNs, the timer T3585 starts when the UE is registered in a VPLMN or an unsubscribed SNPN and the S-NSSAI is provided by the UE during the PDU session establishment, the timer T3585 is associated with the mapped S-NSSAI of the PDU session. Additionally, if the 5GSM congestion re-attempt indicator IE with the CATBO bit set to \"The back-off timer is applied in the current access type\" is included in the 5GSM message with the 5GSM cause value #69 \"insufficient resources for specific slice\", then the UE applies the timer T3585 for the current access type. Otherwise, the UE applies the timer T3585 for both 3GPP access type and non-3GPP access type and the UE shall stop any running timer T3585 for the applied PLMN or SNPN and for the access different from the access from which the message is received.\nIn case of SNPN, if the UE does not support access to an SNPN using credentials from a credentials holder and equivalent SNPNs, in the UE 5GS session management timers T3584 for the S-NSSAI based congestion control are started and stopped on a per S-NSSAI, DNN and SNPN basis. If the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, in the UE 5GS session management timers T3584 for the S-NSSAI based congestion control are started and stopped on a per S-NSSAI, DNN, SNPN and selected entry of the \"list of subscriber data\" or selected PLMN subscription basis.\nIn case of SNPN, if the UE does not support access to an SNPN using credentials from a credentials holder and equivalent SNPNs, in the UE 5GS session management timers T3585 for the S-NSSAI based congestion control are started and stopped on a per S-NSSAI and SNPN basis. If the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, in the UE 5GS session management timers T3585 for the S-NSSAI based congestion control are started and stopped on a per S-NSSAI, SNPN and selected entry of the \"list of subscriber data\" or selected PLMN subscription basis.\nIf the timer T3584 or timer T3585 was provided during the PDU session establishment procedure, the S-NSSAI associated with T3584 or T3585, respectively is the S-NSSAI, including no S-NSSAI, provided by the UE during the PDU session establishment.\nIf the timer T3584 is provided during the PDU session modification or PDU session release procedure, the UE behaves as follows: The DNN associated with T3584 is the DNN provided by the UE during the PDU session establishment. If no S-NSSAI but DNN is provided by the UE along the PDU SESSION ESTABLISHMENT REQUEST message, then T3584 is associated with no S-NSSAI and the DNN provided to the network during the PDU session establishment. If the PDN connection was established when in the S1 mode, then T3584 is associated with no S-NSSAI. If no DNN but S-NSSAI is provided by the UE along the PDU SESSION ESTABLISHMENT REQUEST message, then T3584 is associated with no DNN and the S-NSSAI of the PDU session. If no DNN and no S-NSSAI is provided by the UE along the PDU SESSION ESTABLISHMENT REQUEST message, then T3584 is associated with no DNN and no S-NSSAI. For this purpose, the UE shall memorize the DNN and the S-NSSAI provided to the network during the PDU session establishment. The timer T3584 associated with no DNN and an S-NSSAI will never be started due to any 5GSM procedure related to an emergency PDU session. If the timer T3584 associated with no DNN and an S-NSSAI is running, it does not affect the ability of the UE to request an emergency PDU session.\nIf the timer T3585 was provided during the PDU session modification or PDU session release procedure, the UE behaves as follows: if an S-NSSAI was provided by the UE during the PDU session establishment, then T3585 is associated with the S-NSSAI of the PDU session. If no S-NSSAI is provided by the UE along the PDU SESSION ESTABLISHMENT REQUEST message, then T3585 is associated with no S-NSSAI. If the PDN connection was established when in the S1 mode, then T3585 is associated with no S-NSSAI.\nIf T3584 is running or is deactivated, then the UE is not allowed to initiate the:\na)\tPDU session establishment procedure;\nb)\tPDU session modification procedure; or\nc)\tNAS transport procedure for sending CIoT user data; \nfor the respective [S-NSSAI, no DNN] or [S-NSSAI, DNN] combination unless the UE is a UE configured for high priority access in selected PLMN or SNPN or to report a change of 3GPP PS data off UE status.\nIn a PLMN, if the timer T3584 is running or is deactivated for all the PLMNs and is associated with an S-NSSAI other than no S-NSSAI, then\na)\tthe UE registered in the HPLMN is not allowed to initiate the:\n1)\tPDU session establishment procedure;\n2)\tPDU session modification procedure; or\n3)\tNAS transport procedure for sending CIoT user data;\nwhen the [S-NSSAI, no DNN] or [S-NSSAI, DNN] combination provided by the UE during the PDU session establishment is the same as the [S-NSSAI, no DNN] or [S-NSSAI, DNN] combination associated with the timer T3584 unless the UE is a UE configured for high priority access in selected PLMN or to report a change of 3GPP PS data off UE status; and\nb)\tthe UE registered in a VPLMN is not allowed to initiate the:\n1)\tPDU session establishment procedure;\n2)\tPDU session modification procedure; or\n3)\tNAS transport procedure for sending CIoT user data;\nwhen the [mapped S-NSSAI, no DNN] or [mapped S-NSSAI, DNN] combination provided by the UE during the PDU session establishment is the same as the [S-NSSAI, no DNN] or [S-NSSAI, DNN] combination associated with the timer T3584 unless the UE is a UE configured for high priority access in selected PLMN or to report a change of 3GPP PS data off UE status.\nIn a PLMN, if the timer T3584 is running or is deactivated for all the PLMNs and is associated with [no S-NSSAI, no DNN] or [no S-NSSAI, DNN] combination, then the UE is not allowed to initiate the:\na)\tPDU session establishment procedure;\nb)\tPDU session modification procedure; or\nc)\tNAS transport procedure for sending CIoT user data;\nfor [no S-NSSAI, no DNN] or [no S-NSSAI, DNN] combination in any PLMN unless the UE is a UE configured for high priority access in selected PLMN or to report a change of 3GPP PS data off UE status.\nIn an SNPN, if the UE supports equivalent SNPNs, the timer T3584 is running or is deactivated for all the equivalent SNPNs, is associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, with an S-NSSAI other than no S-NSSAI, and with the RSNPN or an equivalent SNPN:\na)\tthe UE registered in the subscribed SNPN is not allowed to initiate the:\n1)\tPDU session establishment procedure; or\n2)\tPDU session modification procedure;\n\twhen the [S-NSSAI, no DNN] or [S-NSSAI, DNN] combination provided by the UE during the PDU session establishment is the same as the [S-NSSAI, no DNN] or [S-NSSAI, DNN] combination associated with the timer T3584 unless the UE is a UE configured for high priority access in the RSNPN or to report a change of 3GPP PS data off UE status; and\nb)\tthe UE registered in a non-subscribed is not allowed to initiate the:\n1)\tPDU session establishment procedure; or\n2)\tPDU session modification procedure;\n\twhen the [mapped S-NSSAI, no DNN] or [mapped S-NSSAI, DNN] combination provided by the UE during the PDU session establishment is the same as the [S-NSSAI, no DNN] or [S-NSSAI, DNN] combination associated with the timer T3584 unless the UE is a UE configured for high priority access in RSNPN or to report a change of 3GPP PS data off UE status.\nIn an SNPN, if the UE supports equivalent SNPNs, the timer T3584 is running or is deactivated for all the equivalent SNPNs, is associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, with [no S-NSSAI, no DNN] or [no S-NSSAI, DNN] combination, and with the RSNPN or an equivalent SNPN, then the UE is not allowed to initiate the:\na)\tPDU session establishment procedure; or\nb)\tPDU session modification procedure;\nfor [no S-NSSAI, no DNN] or [no S-NSSAI, DNN] combination unless the UE is a UE configured for high priority access in the RSPN or to report a change of 3GPP PS data off UE status.\nIf T3585 is running or is deactivated, then the UE is neither allowed to initiate the PDU session establishment procedure nor the PDU session modification procedure for the respective S-NSSAI unless the UE is a UE configured for high priority access in selected PLMN or SNPN or to report a change of 3GPP PS data off UE status.\nIn a PLMN, if the timer T3585 is running or is deactivated for all the PLMNs and is associated with an S-NSSAI other than no S-NSSAI, then\na)\tthe UE registered in the HPLMN is not allowed to initiate the:\n1)\tPDU session establishment procedure;\n2)\tPDU session modification procedure; or\n3)\tNAS transport procedure for sending CIoT user data;\nwhen the S-NSSAI provided by the UE during the PDU session establishment is the same as the S-NSSAI associated with timer T3585 unless the UE is a UE configured for high priority access in selected PLMNs or to report a change of 3GPP PS data off UE status; and\nb)\tthe UE registered in a VPLMN is not allowed to initiate the:\n1)\tPDU session establishment procedure;\n2)\tPDU session modification procedure; or\n3)\tNAS transport procedure for sending CIoT user data;\nwhen the mapped S-NSSAI provided by the UE during the PDU session establishment is the same as the S-NSSAI associated the timer T3585 unless the UE is a UE configured for high priority access in selected PLMN or to report a change of 3GPP PS data off UE status.\nIn a PLMN, if the timer T3585 is running or is deactivated for all the PLMNs and is associated with no S-NSSAI, then the UE is not allowed to initiate the:\na)\tPDU session establishment procedure;\nb)\tPDU session modification procedure;\nc)\tNAS transport procedure for sending CIoT user data;\nfor no S-NSSAI in any PLMN unless the UE is a UE configured for high priority access in selected PLMN or to report a change of 3GPP PS data off UE status.In an SNPN, if the UE supports equivalent SNPNs, the timer T3585 is running or is deactivated for all the equivalent SNPNs, is associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, with an S-NSSAI other than no S-NSSAI, and with the RSNPN or an equivalent SNPN:\na)\tthe UE registered in the subscribed SNPN is not allowed to initiate the:\n1)\tPDU session establishment procedure; or\n2)\tPDU session modification procedure;\n\twhen the S-NSSAI provided by the UE during the PDU session establishment is the same as the S-NSSAI associated with timer T3585 unless the UE is a UE configured for high priority access in the RSNPN or to report a change of 3GPP PS data off UE status; and\nb)\tthe UE registered in a non-subscribed SNPN is not allowed to initiate the:\n1)\tPDU session establishment procedure; or\n2)\tPDU session modification procedure;\n\twhen the mapped S-NSSAI provided by the UE during the PDU session establishment is the same as the S-NSSAI associated the timer T3585 unless the UE is a UE configured for high priority access in the RSNPN or to report a change of 3GPP PS data off UE status.\nIn an SNPN, if the UE supports equivalent SNPNs, the timer T3585 is running or is deactivated for all the equivalent SNPNs, is associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, with no S-NSSAI, and with the RSNPN or an equivalent SNPN, then the UE is not allowed to initiate the:\na)\tPDU session establishment procedure; or\nb)\tPDU session modification procedure;\nfor no S-NSSAI unless the UE is a UE configured for high priority access in RSNPN or to report a change of 3GPP PS data off UE status.\n6.2.9\tInteraction with upper layers\n6.2.9.1\tGeneral\nA 5GSM entity interacts with upper layers. Subclause\u00a06.2.9.2 describes how the 5GSM entity interacts with upper layers with respect to the URSP. Subclause\u00a06.2.9.3 describes how the 5GSM entity interacts with upper layers with respect to the ProSeP.\n6.2.9.2\tURSP\nThe URSP requires interaction between upper layers and the 5GSM entities in the UE (see 3GPP\u00a0TS\u00a024.526\u00a0[19] for further details). Each of the 5GSM entities in the UE shall indicate attributes (e.g. PDU session identity, SSC mode, S-NSSAI, DNN, PDU session type, access type, PDU address) of a newly established PDU session to the upper layers. If a PDU session is released, the 5GSM entity handling the PDU session shall inform the PDU session identity of the released PDU session to the upper layers. The upper layers may request a 5GSM entity:\na)\tto establish a PDU session indicating one or more PDU session attributes;\nb)\tto release an existing PDU session; or\nc)\tto establish a PDU session indicating one or more PDU session attributes, and to release an existing PDU session.\n6.2.9.3\tProSeP\nThe ProSeP requires interaction between upper layers and the 5GSM entities in the UE acting as a 5G ProSe layer-3 UE-to-network relay UE (see 3GPP\u00a0TS\u00a024.554\u00a0[19E] for further details). The upper layers may request the 5GSM entity:\na)\tto establish a PDU session indicating one or more PDU session attributes; or\nb)\tto release the existing PDU session; or\nc)\tto establish a PDU session indicating one or more PDU session attributes, and to release the existing PDU session.\nEach of the 5GSM entities in the UE acting as a 5G ProSe layer-3 UE-to-network relay UE shall indicate attributes (e.g. PDU session identity, SSC mode, S-NSSAI, DNN, PDU session type, access type, PDU address) of the newly established PDU session to the upper layers. If the PDU session is released, the 5GSM entity handling the PDU session shall inform the PDU session identity of the released PDU session to the upper layers.\n6.2.10\tHandling of 3GPP PS data off\nIn case of PLMN, a UE, which supports 3GPP PS data off (see 3GPP\u00a0TS\u00a023.501\u00a0[8]), can be configured with up to two lists of 3GPP PS data off exempt services as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] or in the EF3GPPPSDATAOFF USIM file as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22]:\na)\ta list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN; and\nb)\ta list of 3GPP PS data off exempt services to be used in the VPLMN.\nIf only the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN is configured at the UE, this list shall be also used in the VPLMN.\nIn case of SNPN, a UE, which supports 3GPP PS data off (see 3GPP\u00a0TS\u00a023.501\u00a0[8]), can be configured with:\na)\tup to two lists of 3GPP PS data off exempt services as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] for each subscribed SNPN whose entry exists in the \"list of subscriber data\":\n1)\ta list of 3GPP PS data off exempt services to be used in the subscribed SNPN; and\n2)\ta list of 3GPP PS data off exempt services to be used in the non-subscribed SNPN; and\nb)\tone list of 3GPP PS data off exempt services as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] for PLMN subscription:\n1)\ta list of 3GPP PS data off exempt services to be used in the non-subscribed SNPN.\nIf only the list of 3GPP PS data off exempt services to be used in the subscribed SNPN is configured for the selected entry of \"list of subscriber data\", this list shall be also used in the non-subscribed SNPN.\nIf the UE supports 3GPP PS data off, the UE shall provide the 3GPP PS data off UE status in the Extended protocol configuration options IE during UE-requested PDU session establishment procedure except for the transfer of a PDU session from non-3GPP access to 3GPP access and except for the establishment of user plane resources on the other access for the MA PDU session(see subclause\u00a06.4.1), and during UE-requested PDU session modification procedure (see subclause\u00a06.4.2), regardless of associated access type of the PDU session. If the UE requests a PDU session establishment procedure in order to transfer a PDU session from non-3GPP access to 3GPP access, or in order to establish user plane resources on the other access for the MA PDU session over 3GPP access or non-3GPP access, and:\na)\tif the 3GPP PS data off UE status has changed since the last providing to the network, the UE shall provide the 3GPP PS data off UE status in the Extended protocol configuration options IE; or\nb)\tif the 3GPP PS data off UE status has not changed since the last providing to the network, the UE need not provide the 3GPP PS data off UE status.\nThe network shall support of 3GPP PS data off.\nThe UE shall indicate change of the 3GPP PS data off UE status for the PDU session by using the UE-requested PDU session modification procedure as specified in subclause\u00a06.4.2.\nWhen the 3GPP PS data off UE status is \"activated\":\na)\tthe UE does not send uplink IP packets via 3GPP access except:\n1)\tfor those services indicated in the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] when the UE is in its HPLMN or EHPLMN;\n2)\tfor those services indicated in the list of 3GPP PS data off exempt services to be used in the subscribed SNPN, configured for the selected entry of \"list of subscriber data\", as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] when the UE is in the subscribed SNPN;\n3)\tfor those services indicated in the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN when the UE is in the VPLMN, if only the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN is configured to the UE as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17];\n4)\tfor those services indicated in the list of 3GPP PS data off exempt services to be used in the subscribed SNPN, configured for the selected entry of \"list of subscriber data\", when the UE is in a non-subscribed SNPN and only the list of 3GPP PS data off exempt services to be used in the subscribed SNPN is configured for the selected entry of \"list of subscriber data\" as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17];\n5)\tfor those services indicated in the list of 3GPP PS data off exempt services to be used in the VPLMN when the UE is in the VPLMN, if the list of 3GPP PS data off exempt services to be used in the VPLMN is configured to the UE as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17];\n6)\tfor those services indicated in the list of 3GPP PS data off exempt services to be used in the non-subscribed SNPN, configured for the selected entry of \"list of subscriber data\", when the UE is in a non-subscribed SNPN and the list of 3GPP PS data off exempt services to be used in the non-subscribed SNPN is configured for the selected entry of \"list of subscriber data\" as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17];\n7)\tfor those services indicated in the list of 3GPP PS data off exempt services to be used in the non-subscribed SNPN, configured for the selected PLMN subscription, when the UE is in the non-subscribed SNPN and the list of 3GPP PS data off exempt services to be used in the non-subscribed SNPN is configured for the selected PLMN subscription as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17];\n8)\tfor those services indicated in the EF3GPPPSDATAOFF USIM file as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22];\n9)\tany uplink traffic due to procedures specified in 3GPP\u00a0TS\u00a024.229\u00a0[14]; and\n10)\tany uplink traffic due to procedures specified in 3GPP\u00a0TS\u00a024.623\u00a0[20];\nb)\tthe UE does not send uplink Ethernet user data packets via 3GPP access; and\nc)\tthe UE does not send uplink Unstructured user data packets via 3GPP access.\nOtherwise the UE sends uplink user data packets without restriction.\nNOTE:\tIf the UE supports 3GPP PS data off, uplink IP packets are filtered as specified in 3GPP\u00a0TS\u00a024.229\u00a0[14] in U.3.1.5.\n3GPP PS data off does not restrict sending of uplink user data packets via non-3GPP access of a single access PDU session or an MA PDU session.\n6.2.11\tMulti-homed IPv6 PDU session\nThe UE supporting IPv6 may support multi-homed IPv6 PDU session.\nIf the UE supports the multi-homed IPv6 PDU session:\na)\tthe UE shall support acting as a type\u00a0C\u00a0host as specified in IETF\u00a0RFC\u00a04191\u00a0[36]; and\nb)\tthe UE indicates support of the multi-homed IPv6 PDU session:\n1)\tduring the UE-requested PDU session establishment of a PDU session of \"IPv6\" or \"IPv4v6\" PDU session type; and\n2)\tduring the UE-requested PDU session modification performed after an inter-system change from S1 mode to N1 mode, for a PDU session associated with a PDN connection established when in S1 mode, if the UE is a UE operating in single-registration mode in a network supporting N26 interface, the PDU session is of \"IPv6\" or \"IPv4v6\" PDU session type, and the UE has not previously successfully performed the UE-requested PDU session modification to provide this indication.\n6.2.12\tHandling of network rejection not due to congestion control\nThe network may include a back-off timer value in a 5GS session management reject message to regulate the time interval at which the UE may retry the same procedure for 5GSM cause values other than #26 \"insufficient resources\", #28 \"unknown PDU session type\", #39 \"reactivation requested\", #46 \"out of LADN service area\", #50 \"PDU session type IPv4 only allowed\", #51 \"PDU session type IPv6 only allowed\", #54 \"PDU session does not exist\", #57 \"PDU session type IPv4v6 only allowed\", #58 \"PDU session type Unstructured only allowed\", #61 \"PDU session type Ethernet only allowed\", #67 \"insufficient resources for specific slice and DNN\", #68 \"not supported SSC mode\" and #69 \"insufficient resources for specific slice\". For 5GSM cause values other than #26 \"insufficient resources\", #28 \"unknown PDU session type\", #39 \"reactivation requested\", #46 \"out of LADN service area\", #54 \"PDU session does not exist\", #67 \"insufficient resources for specific slice and DNN\", #68 \"not supported SSC mode\", and #69 \"insufficient resources for specific slice\", and #86 \"UAS services not allowed\", the network may also include the re-attempt indicator to indicate whether the UE is allowed to re-attempt the corresponding session management procedure for the same DNN in S1 mode after inter-system change.\nNOTE\u00a01:\tIn a PLMN, if the network includes this back-off timer value for 5GSM cause values other than #27 \"missing or unknown DNN\", then the UE is blocked from sending another 5GSM request for the same procedure for the same [PLMN, DNN, S-NSSAI], [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, S-NSSAI], or [PLMN, no DNN, no S-NSSAI] combination for the specified duration. If the network includes this back-off timer value for 5GSM cause value #27 \"missing or unknown DNN\", then the UE is blocked from sending another 5GSM request for the same procedure for the same [PLMN, DNN], or [PLMN, no DNN] combination for the specified duration. In an SNPN, if the network includes this back-off timer value for 5GSM cause values other than #27 \"missing or unknown DNN\", then the UE is blocked from sending another 5GSM request for the same procedure for the same [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, S-NSSAI], [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, S-NSSAI], or [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] combination for the specified duration. If the network includes this back-off timer value for 5GSM cause value #27 \"missing or unknown DNN\", then the UE is blocked from sending another 5GSM request for the same procedure for the same [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN], or [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] combination for the specified duration. Therefore, the operator needs to exercise caution in determining the use of this timer value.\nNOTE\u00a02:\tIf the re-attempt indicator is not provided by the network, a UE registered in its HPLMN or in an EHPLMN can use the configured SM_RetryAtRATChange value specified in the NAS configuration MO or in the USIM NASCONFIG file to derive the re-attempt indicator as specified in subclauses\u00a06.4.1.4.3 and 6.4.2.4.3.\nIf re-attempt in S1 mode is allowed for 5GSM cause values other than #27 \"missing or unknown DNN\", the UE shall consider the back-off timer to be applicable only to the 5GS session management in N1 mode for the rejected 5GS session management procedure and the given [PLMN, DNN, S-NSSAI], [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, S-NSSAI], or [PLMN, no DNN, no S-NSSAI] combination. If re-attempt in S1 mode is allowed for 5GSM cause value #27 \"missing or unknown DNN\", the UE shall consider the back-off timer to be applicable only to the 5GS session management in N1 mode for the rejected 5GS session management procedure and the given [PLMN, DNN], or [PLMN, no DNN] combination.If re-attempt in S1 mode is not allowed, the UE shall consider the back-off timer to be applicable to both NAS protocols, i.e. applicable to the 5GS session management in N1 mode for the rejected 5GS session management procedure and to the EPS session management in S1 mode for the corresponding session management procedure and the given [PLMN, DNN] or [PLMN, no DNN] combination.\nNOTE\u00a03:\tIn the present subclause the terms DNN and APN are referring to the same parameter.\nIn a PLMN, if the back-off timer was provided during the PDU session establishment procedure, the UE behaves as follows: for 5GSM cause values other than #27 \"missing or unknown DNN\", when the UE is registered in a HPLMN, the DNN and the S-NSSAI of the [PLMN, DNN, S-NSSAI] combination associated with the back-off timer is the DNN and the S-NSSAI provided by the UE when the PDU session is established. When the UE is registered in a VPLMN, the DNN and the S-NSSAI of the [PLMN, DNN, S-NSSAI] combination associated with the back-off timer is the DNN and the mapped S-NSSAI provided by the UE when the PDU session is established. For 5GSM cause value #27 \"missing or unknown DNN\", the DNN of the [PLMN, DNN] combination associated with the back-off timer is the DNN provided by the UE when the PDU session is established. If no DNN or no S-NSSAI was provided to the network during the PDU session establishment, then the back-off timer is associated with the [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, S-NSSAI], or [PLMN, no DNN, no S-NSSAI] combination, dependent on which parameters were provided for 5GSM cause values other than #27 \"missing or unknown DNN\". If no DNN was provided to the network during the PDU session establishment, then the back-off timer is associated with the [PLMN, no DNN] combination for 5GSM cause value #27 \"missing or unknown DNN\". For this purpose, the UE shall memorize the DNN and the S-NSSAI provided to the network during the PDU session establishment.\nIn a PLMN, if the back-off timer was provided during the PDU session modification procedure, the UE behaves as follows: the DNN associated with the back-off timer is the DNN, including no DNN, provided by the UE when the PDU session is established. If an S-NSSAI was provided by the UE during the PDU session establishment, when the UE is registered in a HPLMN, then the S-NSSAI associated with the back-off timer is the S-NSSAI of the PDU session. If an S-NSSAI was provided by the UE during the PDU session establishment, when the UE is registered in a VPLMN, then the S-NSSAI associated with the back-off timer is the mapped S-NSSAI of the PDU session. If no S-NSSAI was provided by the UE during the PDU session establishment, then the back-off timer is associated with no S-NSSAI. For this purpose, the UE shall memorize the DNN and the S-NSSAI provided to the network during the PDU session establishment.\nIn a PLMN, the back-off timer associated with the [PLMN, no DNN, no S-NSSAI], or [PLMN, no DNN] combination will never be started due to any 5GSM procedure related to an emergency PDU session. If the back-off timer associated with the [PLMN, no DNN, no S-NSSAI], or [PLMN, no DNN] combination is running, it does not affect the ability of the UE to request an emergency PDU session.\nIn an SNPN, the back-off timer associated with the [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI], or [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] combination will never be started due to any 5GSM procedure related to an emergency PDU session. If the back-off timer associated with the back-off timer associated with the [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI], or [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] combination, it does not affect the ability of the UE to request an emergency PDU session.\nIn a PLMN, the network may additionally indicate in the re-attempt indicator that a command to back-off is applicable not only for the PLMN in which the UE received the 5GS session management reject message, but for each PLMN included in the equivalent PLMN list at the time when the 5GS session management reject message was received.\nIn an SNPN, the network may additionally indicate in the re-attempt indicator that a command to back-off is applicable not only for the SNPN in which the UE received the 5GS session management reject message, but for each SNPN included in the equivalent SNPN list at the time when the 5GS session management reject message was received.\nIn a PLMN, if the back-off timer is running or is deactivated for a given [PLMN, DNN, S-NSSAI], [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, S-NSSAI], [PLMN, no DNN, no S-NSSAI], [PLMN, DNN], or [PLMN, no DNN] combination, and the UE is a UE configured for high priority access in selected PLMN, then the UE is allowed to initiate 5GSM procedures for the [PLMN, DNN, S-NSSAI], [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, S-NSSAI], [PLMN, no DNN, no S-NSSAI], [PLMN, DNN], or [PLMN, no DNN] combination.\nIn an SNPN, if the back-off timer is running or is deactivated for a given [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, S-NSSAI], [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, S-NSSAI], [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI], [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN], or [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] combination if the UE is a UE configured for high priority access in selected SNPN, then the UE is allowed to initiate 5GSM procedures for the [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, S-NSSAI], [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, S-NSSAI], [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI], [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN], or [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] combination.\nThe RATC bit in the re-attempt indicator IE and its derivation shall not be applicable in an SNPN.\n6.2.13\tHandling of Small data rate control\nSmall data rate control is applicable only to NB-N1 mode and WB-N1 mode.\nSmall data rate control controls the maximum number of uplink user data messages including uplink exception data reporting sent by the UE in a time interval for the PDU session in accordance with 3GPP\u00a0TS\u00a023.501\u00a0[8]. The UE shall limit the rate at which it generates uplink user data messages to comply with the small data rate control policy. The NAS shall provide the indicated rates to upper layers for enforcement. The indicated rates in a NAS procedure applies to the PDU session the NAS procedure corresponds to, and the indicated rates are valid until a new value is indicated or the PDU session is released.\nIf the UE indicates support for CIoT 5GS optimizations, the network may provide the small data rate control parameters to the UE and may provide the small data rate control parameters for exception data to the UE if and only if the small data rate control parameters is provided to the UE. Small data rate control parameters and small data rate control parameters for exception data can also be provided to the UE in S1 mode as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15].\nIf an allowed indication of additional exception reports is provided with the small data rate control parameters and:\n-\tthe additional small data rate control parameters for exception data is provided and the limit for additional rate for exception data reporting is not reached; or\n-\tthe additional small data rate control parameters for exception data is not provided,\nthe UE is allowed to send uplink exception reports even if the limit for the small data rate control has been reached.\nDuring a PDU session release procedure, if the small data rate control was applied to the PDU session that is being released, the network may store the small data rate control status for the released PDU session as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8].\nIf:\na)\tthe UE indicates support for CIoT 5GS optimizations; and\nb)\tthe small data rate control status was stored for the PDU session and is still valid,\nthe network may provide the remaining small data rate control status as initial small data rate control parameters to the UE and initial small data rate control parameters for exception data to the UE during a subsequent PDU session establishment procedure.\nIf received during the establishment of a PDU session, the UE shall apply the initial small data rate control parameters and the initial small data rate control parameters for exception data for the duration of the validity period. When the validity period expires the small data rate control parameters and the small data rate control parameters for exception data shall be applied (see 3GPP\u00a0TS\u00a023.501\u00a0[8]).\nNOTE\u00a01:\tThe HPLMN can discard or delay user data that exceeds the limit provided for small data rate control.\nUpon inter-system change from N1 mode to S1 mode, the UE shall store the current small data rate control status for PDU sessions to be transferred from N1 mode to S1 mode as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8].\nNOTE\u00a02:\tHow long the UE stores the current small data rate control status is implementation specific.\nUpon inter-system change from S1 mode to N1 mode, the UE shall use the stored small data rate control status, if any, to comply with the small data rate control policy for PDU sessions transferred from S1 mode to N1 mode as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8], if the validity period of the stored small data rate control status has not expired.\n6.2.14\tHandling of Serving PLMN rate control\nServing PLMN rate control is applicable only for PDU sessions established for control plane CIoT 5GS optimization.\nServing PLMN rate control protect its AMF from the load generated by user data over control plane.\nThe SMF can inform the UE of any local serving PLMN rate control during the PDU session establishment procedure (see subclause\u00a06.4.1) or the PDU session modification procedure (see subclause\u00a06.4.2). If serving PLMN rate control is enabled, the SMF shall start the serving PLMN rate control for the PDU session when the first control plane user data is received over the PDU session.The UE shall limit the rate at which it generates uplink control plane user data to comply with the serving PLMN policy provided by the network. The indicated rate in a NAS procedure applies to the PDU session the NAS procedure corresponds to, and the indicated rate is valid until the PDU session is released.\nAny Serving PLMN rate control information provided by the network to the UE is only applicable for the PLMN which provided this information. This serving PLMN rate control information shall be discarded when the UE successfully registers to another PLMN.\nNOTE:\tThe serving PLMN can discard or delay control plane user data that exceed the limit provided for Serving PLMN rate control.\n6.2.15\tHandling of Reliable Data Service\nIf the UE supports Reliable Data Service (see 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a024.250\u00a0[14A]), the UE may request data transfer using Reliable Data Service for a PDU session in the Extended protocol configuration options IE during UE-requested PDU session establishment procedure (see subclause\u00a06.4.1).\nThe Reliable Data Service may only be used with PDU sessions for which the \"Control Plane CIoT 5GS Optimisation\" indicator is set or with PDU sessions using the control plane CIoT 5GS optimization when the AMF does not move such PDU sessions to the user plane.\nThe network shall inform the UE about the acceptance of UE's request for Reliable Data Service usage during the PDU session establishment procedure (see subclause\u00a06.4.1) in the Extended protocol configuration options IE.\nIf the network accepts the use of Reliable Data Service to transfer data for the specified PDU session, the UE shall use this PDU session exclusively for data transfer using Reliable Data Service; otherwise the UE shall not use this PDU session for data transfer using Reliable Data Service.\n6.2.16\tHandling of header compression for control plane CIoT optimizations\nThe UE and the SMF may use:\n-\tIP header compression for PDU sessions of \"IPv4\", \"IPv6\" or \"IPv4v6\" PDU session type; and\n-\tEthernet header compression for PDU sessions of \"Ethernet\" PDU session type.\nBoth the UE and the AMF indicate whether header compression for control plane CIoT 5GS optimization is supported during registration procedures (see subclause\u00a05.5.1). If both the UE and the network support header compression, the header compression configuration for each PDU session is negotiated during the PDU session establishment procedure and PDU session modification procedure as specified in subclauses\u00a06.3.2, 6.4.1 and 6.4.2.\nFor IP header compression, ROHC protocol specified in IETF\u00a0RFC\u00a05795\u00a0[39B] is used. The IP header compression configuration used for IP header compression is (re-)negotiated between the UE and the SMF using the IP header compression configuration IE as specified in subclauses\u00a06.3.2.2, 6.4.1.2, 6.4.1.3 and 6.4.2.2, respectively.\nFor Ethernet header compression, Ethernet Header Compression (EHC) protocol specified in 3GPP TS 38.323 [29] is used. The Ethernet header compression configuration used for Ethernet header compression is (re-)negotiated between the UE and the SMF using the Ethernet header compression configuration IE as specified in subclauses\u00a06.3.2.2, 6.4.1.2, 6.4.1.3 and 6.4.2.2, respectively.\n6.2.17\tHandling of edge computing enhancements\nEAS discovery, EAS rediscovery and ECS address provisioning provide enhanced edge computing support in 5GS (see 3GPP\u00a0TS\u00a023.548\u00a0[10A]).\nIf the network supports the session breakout connectivity model or distributed anchor connectivity model to enable edge computing enhancements and the UE generated DNS message is to be handled by an edge application server discovery function (EASDF) for EAS discovery as specified in 3GPP\u00a0TS\u00a023.548\u00a0[10A], the SMF selects the EASDF and it provides its IP address to the UE as the DNS server to be used for the PDU session in the Extended protocol configuration options IE during the UE-requested PDU session establishment procedure as described in subclause\u00a06.4.1.3.\nNOTE\u00a01:\tEASDF selection is outside the scope of the present document.\nIf the network supports the session breakout connectivity model to enable edge computing enhancements and the UE generated DNS message is to be handled by a local DNS server for EAS discovery as specified in 3GPP\u00a0TS\u00a023.548\u00a0[10A], the SMF selects the local DNS server, obtains its IP address and can provide the IP address of the local DNS server to the UE as the DNS server to be used for the PDU session in the Extended protocol configuration options IE during the UE-requested PDU session establishment procedure or the network-requested PDU session modification procedure as described in subclauses\u00a06.4.1.3 and 6.3.2.2, respectively.\nNOTE\u00a02:\tLocal DNS server selection and the acquisition of its IP address is outside the scope of the present document.\nIf the UE supports EAS rediscovery and the SMF decides to trigger the EAS rediscovery as specified in 3GPP\u00a0TS\u00a023.548\u00a0[10A], the SMF initiates a network-requested PDU session modification procedure to provide the EAS rediscovery information to the UE as described in subclauses\u00a06.3.2.2. Upon receipt of the EAS rediscovery information, the UE provides the received information to the upper layers.\nNOTE\u00a03:\tThe upper layers of the UE uses the EAS rediscovery information to trigger the EAS discovery procedure to get the new EAS information as specified in 3GPP\u00a0TS\u00a023.548\u00a0[10A].\nIf the UE supports ECS address provisioning over NAS as specified in 3GPP\u00a0TS\u00a023.548\u00a0[10A], the UE indicates its support of ECS configuration information provisioning over NAS in the Extended protocol configuration options IE either during the UE-requested PDU session establishment procedure as described in subclause\u00a06.4.1.2 or while in S1 mode as described in 3GPP\u00a0TS\u00a024.301\u00a0[15], respectively.\nIf the UE indicated support of ECS configuration information address provisioning over NAS, the SMF can provide the ECS configuration information in the Extended protocol configuration options IE during the network-requested PDU session modification procedure, UE-requested PDU session establishment procedure or the UE-requested PDU session modification procedure as described in subclauses\u00a06.3.2.2, 6.4.1.3 and 6.4.2.3, respectively.\nNOTE\u00a04:\tThe SMF can obtain the ECS configuration information based on the local configuration, the UE's location, the UE's subscription information, or any combination of them.\nIf the UE supports the edge DNS client (EDC) as specified in 3GPP\u00a0TS\u00a023.548\u00a0[10A], the UE indicates its support of EDC in the Extended protocol configuration options IE during the UE-requested PDU session establishment procedure as described in subclause\u00a06.4.1.2 or the UE-requested PDU session modification procedure as described in subclause\u00a06.4.2.2.\nIf the UE indicates support of EDC, the SMF can indicate in the Extended protocol configuration options IE during the UE-requested PDU session establishment procedure as described in subclause\u00a06.4.1.3 or the network-requested PDU session modification procedure as described in subclause\u00a06.3.2.2, that the network allows the use of EDC for the applications which are mapped onto the PDU session and explicitly requested the use of EDC, or that the network requires the use of EDC for all applications mapped onto the PDU session.\n6.2.18\tSupport of redundant PDU sessions\nThe 5GSM sublayer may support establishment of redundant PDU sessions (see subclause\u00a05.33.2 of 3GPP\u00a0TS\u00a023.501\u00a0[8]).\nIn order to establish a set of two redundant PDU sessions, a UE can include a PDU session pair ID, an RSN, or both in a PDU SESSION ESTABLISHMENT REQUEST message for each of the two redundant PDU sessions (see subclause\u00a06.4.1.2). The UE can set the PDU session pair ID, the RSN, or both according to URSP or UE local configuration (see 3GPP\u00a0TS\u00a024.526\u00a0[19]).\nAn SMF receiving a PDU session pair ID, an RSN, or both via a PDU SESSION ESTABLISHMENT REQUEST message operates as specified in subclause\u00a05.33.2 of 3GPP\u00a0TS\u00a023.501\u00a0[8]. In addition, an SMF can handle two PDU sessions as redundant even if the UE provides neither a PDU session pair ID nor an RSN in a PDU SESSION ESTABLISHMENT REQUEST message for each of the PDU sessions (see subclause\u00a05.33.2 of 3GPP\u00a0TS\u00a023.501\u00a0[8]).\n6.2.19\tHandling of maximum group data rate limitation control\nThe network can perform maximum group data rate limitation control to 5G VN groups as specified in 3GPP\u00a0TS\u00a023.503\u00a0[10]. If the maximum data rate of PDU sessions associated within a 5G VN group has been exceeded the maximum group data rate of the 5G VN group, the SMF may reject the PDU SESSION ESTABLISHMENT REQUEST message against the 5G VN group using S-NSSAI based congestion control as specified in subclause\u00a06.2.8 and 6.4.1.4.2.\nNOTE\u00a01:\tThe maximum group data rate limitation control does not apply for emergency services or for a UE configured for high priority access in selected PLMN or SNPN.\nNOTE\u00a02:\tThe maximum group data rate limitation control is performed by the PCF.\n6.2.20\tSupport of UL PDU set handling\nIf the network supports PDU set handling (see subclause\u00a05.37.5 of 3GPP\u00a0TS\u00a023.501\u00a0[8]), based on operator policy, the SMF may provide the protocol description for UL PDU set handling in the PDU SESSION ESTABLISHMENT ACCEPT message or the PDU SESSION MODIFICATION COMMAND message to the UE.\nNOTE:\tWhether and how to use the protocol description to identify and process PDUs belonging to a PDU set in the uplink direction, is up to UE implementation.\n6.3\tNetwork-requested 5GSM procedures\n6.3.1\tPDU session authentication and authorization procedure\n6.3.1.1\tGeneral\nThe purpose of the PDU session authentication and authorization procedure is to enable the DN:\na)\tto authenticate the upper layers of the UE, when establishing the PDU session;\nb)\tto authorize the upper layers of the UE, when establishing the PDU session;\nc)\tboth of the above; or\nd)\tto re-authenticate the upper layers of the UE after establishment of the PDU session.\nThe PDU session authentication and authorization procedure can be performed only during or after the UE-requested PDU session procedure establishing a non-emergency PDU session. The PDU session authentication and authorization procedure shall not be performed during or after the UE-requested PDU session establishment procedure establishing an emergency PDU session.\nThe upper layers store the association between a DNN and corresponding credentials, if any, for the PDU session authentication and authorization.\nIf the UE is registered for onboarding services in SNPN the SMF may initiate the PDU session authentication and authorization procedure based on local policy with a DCS as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] subclause\u00a0I.9.2.4.1 or a DN-AAA server as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] subclause\u00a0I.9.2.4.2.\nIf the UE is registered for onboarding services in SNPN and the network initiates the PDU session authentication and authorization procedure, the UE shall use the default UE credentials for secondary authentication for the PDU session authentication and authorization procedure.\nThe network authenticates the UE using the Extensible Authentication Protocol (EAP) as specified in IETF\u00a0RFC\u00a03748\u00a0[34].\nEAP has defined four types of EAP messages:\na)\tan EAP-request message;\nb)\tan EAP-response message;\nc)\tan EAP-success message; and\nd)\tan EAP-failure message.\nThe EAP-request message is transported from the network to the UE using the PDU SESSION AUTHENTICATION COMMAND message of the PDU EAP message reliable transport procedure.\nThe EAP-response message to the EAP-request message is transported from the UE to the network using the PDU SESSION AUTHENTICATION COMPLETE message of the PDU EAP message reliable transport procedure.\nIf the PDU session authentication and authorization procedure is performed during the UE-requested PDU session establishment procedure:\na)\tand the DN authentication of the UE completes successfully, the EAP-success message is transported from the network to the UE as part of the UE-requested PDU session establishment procedure in the PDU SESSION ESTABLISHMENT ACCEPT message.\nb)\tand the DN authentication of the UE completes unsuccessfully, the EAP-failure message is transported from the network to the UE as part of the UE-requested PDU session establishment procedure in the PDU SESSION ESTABLISHMENT REJECT message.\nIf the PDU session authentication and authorization procedure is performed after the UE-requested PDU session establishment procedure:\na)\tand the DN authentication of the UE completes successfully, the EAP-success message is transported from the network to the UE using the PDU SESSION AUTHENTICATION RESULT message of the PDU EAP result message transport procedure.\nb)\tand the DN authentication of the UE completes unsuccessfully, the EAP-failure message is transported from the network to the UE using the PDU SESSION RELEASE COMMAND message of the network-requested PDU session release procedure.\nThere can be several rounds of exchange of an EAP-request message and a related EAP-response message for the DN to complete the authentication and authorization of the request for a PDU session (see example in figure\u00a06.3.1.1).\nThe SMF shall set the authenticator retransmission timer specified in IETF\u00a0RFC\u00a03748\u00a0[34] subclause\u00a04.3 to infinite value.\nNOTE:\tThe PDU session authentication and authorization procedure provides a reliable transport of EAP messages and therefore retransmissions at the EAP layer of the SMF do not occur.\n\nFigure\u00a06.3.1.1: PDU session authentication and authorization procedure\n6.3.1.2\tPDU EAP message reliable transport procedure\n6.3.1.2.1\tPDU EAP message reliable transport procedure initiation\nIn order to initiate the PDU EAP message reliable transport procedure, the SMF shall create a PDU SESSION AUTHENTICATION COMMAND message.\nThe SMF shall set the PTI IE of the PDU SESSION AUTHENTICATION COMMAND message to \"No procedure transaction identity assigned\".\nThe SMF shall set the EAP message IE of the PDU SESSION AUTHENTICATION COMMAND message to the EAP-request message provided by the DN or generated locally.\nThe SMF shall send the PDU SESSION AUTHENTICATION COMMAND message, and the SMF shall start timer T3590 (see example in figure\u00a06.3.1.1).\nUpon receipt of the PDU SESSION AUTHENTICATION COMMAND message, if the UE provided a DNN during the PDU session establishment, the UE shall stop timer T3396, if it is running for the DNN provided by the UE. If the UE did not provide a DNN during the PDU session establishment, the UE shall stop the timer T3396 associated with no DNN if it is running. In an SNPN, the timer T3396 to be stopped includes:\na)\tthe timer T3396 applied for all the equivalent SNPNs, associated with the RSNPN or an equivalent SNPN, and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nb)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN, and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\nUpon receipt of the PDU SESSION AUTHENTICATION COMMAND message, if the UE provided an S-NSSAI and a DNN during the PDU session establishment, the UE shall stop timer T3584, if it is running for the [S-NSSAI of the PDU session, DNN] combination. If the UE provided a DNN but did not provide an S-NSSAI during the PDU session establishment, the UE shall stop timer T3584, if it is running for the same [no S-NSSAI, DNN] combination provided by the UE. If the UE provided an S-NSSAI but did not provide a DNN during the PDU session establishment, the UE shall stop timer T3584, if it is running for the same [S-NSSAI, no DNN] combination provided by the UE. If the UE provided neither a DNN nor an S-NSSAI during the PDU session establishment, the UE shall stop timer T3584, if it is running for the same [no S-NSSAI, no DNN] combination provided by the UE. The timer T3584 to be stopped includes:\na)\tin a PLMN:\n1)\tthe timer T3584 applied for all the PLMNs, if running; and\n2)\tthe timer T3584 applied for the registered PLMN, if running; or\nb)\tin an SNPN:\n1)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\n2)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\nUpon receipt of the PDU SESSION AUTHENTICATION COMMAND message, if the UE provided an S-NSSAI during the PDU session establishment, the UE shall stop timer T3585, if it is running for the S-NSSAI of the PDU session. If the UE did not provide an S-NSSAI during the PDU session establishment, the UE shall stop the timer T3585 associated with no S-NSSAI if it is running. The timer T3585 to be stopped includes:\na)\tin a PLMN:\n1)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, if running;\n2)\tthe timer T3585 applied for all the PLMNs and for both 3GPP access type and non-3GPP access type, if running;\n3)\tthe timer T3585 applied for the registered PLMN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, if running; and\n4)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\nb)\tin an SNPN:\n1)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\n2)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\n3)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\n4)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\nNOTE\u00a01:\tUpon receipt of the PDU SESSION AUTHENTICATION COMMAND message for a PDU session, if the UE provided a DNN (or no DNN) and an S-NSSAI (or no S-NSSAI) when the PDU session is established, timer T3396 associated with the DNN (or no DNN, if no DNN was provided by the UE) is running, and timer T3584 associated with the DNN (or no DNN, if no DNN was provided by the UE) and the S-NSSAI (or no S-NSSAI, if no S-NSSAI was provided by the UE) is running, then the UE stops both the timer T3396 and the timer T3584.\nNOTE\u00a02:\tUpon receipt of the PDU SESSION AUTHENTICATION COMMAND message for a PDU session, if the UE provided a DNN (or no DNN) and an S-NSSAI (or no S-NSSAI) when the PDU session is established, timer T3585 associated with the S-NSSAI (or no S-NSSAI, if no S-NSSAI was provided by the UE) is running, and timer T3584 associated with the DNN (or no DNN, if no DNN was provided by the UE) and the S-NSSAI (or no S-NSSAI, if no S-NSSAI was provided by the UE) is running, then the UE stops both the timer T3585 and the timer T3584.\nUpon receipt of a PDU SESSION AUTHENTICATION COMMAND message and a PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5, the UE passes to the upper layers the EAP message received in the EAP message IE of the PDU SESSION AUTHENTICATION COMMAND message. Apart from this action and the stopping of timers T3396, T3584 and T3485 (if running), the authentication and authorization procedure initiated by the DN is transparent to the 5GSM layer of the UE.\n6.3.1.2.2\tPDU EAP message reliable transport procedure accepted by the UE\nThe UE shall create a PDU SESSION AUTHENTICATION COMPLETE message when the upper layers provide an EAP-response message responding to the received EAP-request message.\nThe UE shall set the EAP message IE of the PDU SESSION AUTHENTICATION COMPLETE message to the EAP-response message.\nThe UE shall transport the PDU SESSION AUTHENTICATION COMPLETE message and the PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5. Apart from this action, the authentication and authorization procedure initiated by the DN is transparent to the 5GSM layer of the UE.\nUpon receipt of a PDU SESSION AUTHENTICATION COMPLETE message, the SMF shall stop timer T3590 and provides the EAP message received in the EAP message IE of the PDU SESSION AUTHENTICATION COMPLETE message to the DN or handles it locally.\n6.3.1.2.3\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tT3590 expired.\n\tThe SMF shall, on the first expiry of the timer T3590, retransmit the PDU SESSION AUTHENTICATION COMMAND message and shall reset and start timer T3590. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3590, the SMF shall abort the procedure.\nb)\tCollision of UE-requested PDU session release procedure and a PDU session authentication and authorization procedure.\n\tWhen the SMF receives a PDU SESSION RELEASE REQUEST message during the PDU session authentication and authorization procedure, and the PDU session indicated in the PDU SESSION RELEASE REQUEST message is the PDU session that the SMF had requested to authenticate, the SMF shall abort the PDU session authentication and authorization procedure and proceed with the UE-requested PDU session release procedure.\n6.3.1.2.4\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tPDU session inactive for the received PDU session ID.\n\tIf the PDU session ID in the PDU SESSION AUTHENTICATION COMMAND message belongs to any PDU session in state PDU SESSION INACTIVE in the UE, the UE shall send a 5GSM STATUS message with the 5GSM cause IE set to #43 \"Invalid PDU session identity\".\nb)\tCollision of UE-requested PDU session release procedure and a PDU session authentication and authorization procedure.\n\tWhen the UE receives a PDU SESSION AUTHENTICATION COMMAND message during the UE-requested PDU session release procedure, and the PDU session indicated in PDU SESSION AUTHENTICATION COMMAND message is the PDU session that the UE had requested to release, the UE shall ignore the PDU SESSION AUTHENTICATION COMMAND message and proceed with the UE-requested PDU session release procedure.\n6.3.1.3\tPDU EAP result message transport procedure\n6.3.1.3.1\tPDU EAP result message transport procedure initiation\nPDU EAP result message transport procedure is initiated by the SMF if the PDU session authentication and authorization procedure is performed after the PDU session is established and the DN authentication of the UE completes successfully.\nIn order to initiate the PDU EAP result message transport procedure, the SMF shall create a PDU SESSION AUTHENTICATION RESULT message.\nThe SMF shall set the PTI IE of the PDU SESSION AUTHENTICATION RESULT message to \"No procedure transaction identity assigned\".\nThe SMF shall set the EAP message IE of the PDU SESSION AUTHENTICATION RESULT message to the EAP-success message provided by the DN.\nThe SMF shall send the PDU SESSION AUTHENTICATION RESULT message.\nUpon receipt of a PDU SESSION AUTHENTICATION RESULT message and a PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5, the UE passes to the upper layers the EAP message received in the EAP message IE of the PDU SESSION AUTHENTICATION RESULT message. Apart from this action, the authentication and authorization procedure initiated by the DN is transparent to the 5GSM layer of the UE.\n6.3.1.3.2\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tPDU session inactive for the received PDU session ID.\n\tIf the PDU session ID in the PDU SESSION AUTHENTICATION RESULT message belongs to any PDU session in state PDU SESSION INACTIVE in the UE, the UE shall send a 5GSM STATUS message with the 5GSM cause IE set to #43 \"Invalid PDU session identity\".\nb)\tCollision of UE-requested PDU session release procedure and a PDU EAP result message transport procedure.\n\tWhen the UE receives a PDU SESSION AUTHENTICATION RESULT message during the UE-requested PDU session release procedure, and the PDU session indicated in PDU SESSION AUTHENTICATION RESULT message is the PDU session that the UE had requested to release, the UE shall ignore the PDU SESSION AUTHENTICATION RESULT message and proceed with the UE-requested PDU session release procedure.\n6.3.1A\tService-level authentication and authorization procedure\n6.3.1A.1\tGeneral\nThe purpose of the service-level authentication and authorization (service-level-AA) procedure is to enable the DN using NEF services for authentication:\na)\tto authenticate the upper layers of the UE, when establishing the PDU session;\nb)\tto authorize the upper layers of the UE, when establishing the PDU session;\nc)\tboth of the above; or\nd)\tto re-authenticate the upper layers of the UE after establishment of the PDU session.\nThe service-level authentication and authorization procedure is used for UUAA as specified in 3GPP\u00a0TS\u00a023.256\u00a0[6AB].\nNOTE\u00a01:\tThe authentication protocol for UUAA is out of scope of 3GPP in this release of specification.\nThe service-level authentication and authorization procedure can be performed only during or after the UE-requested PDU session procedure establishing a non-emergency PDU session. The service-level authentication and authorization procedure shall not be performed during or after the UE-requested PDU session establishment procedure establishing an emergency PDU session.\nIf the service-level authentication and authorization procedure is performed during the UE-requested PDU session establishment procedure:\na)\tand the service-level-AA procedure of the UE completes successfully, the service-level-AA response is transported from the network to the UE as a part of the UE-requested PDU session establishment procedure in the PDU SESSION ESTABLISHMENT ACCEPT message; or\nb)\tand the service-level-AA procedure of the UE completes unsuccessfully, the service-level-AA response is transported from the network to the UE as a part of the UE-requested PDU session establishment procedure in the PDU SESSION ESTABLISHMENT REJECT message.\nNOTE\u00a02:\tIf the SMF receives the HTTP code set to \"4xx\" or \"5xx\" as specified in 3GPP\u00a0TS\u00a029.500\u00a0[20AA] or the SMF detects a UUAA-SM failure as specified in 3GPP\u00a0TS\u00a029.256\u00a0[21B], then the SMF considers that the UUAA-SM procedure has completed unsuccessfully.\nIf the service-level authentication and authorization procedure is performed for the established PDU session with re-authentication purpose:\na)\tand the service-level-AA procedure of the UE completes successfully, the service-level-AA response is transported from the network to the UE as a part of the network-requested PDU session modification procedure in the PDU SESSION MODIFICATION COMMAND message; or\nb)\tand the service-level-AA procedure of the UE completes unsuccessfully, the service-level-AA response is transported from the network to the UE as a part of the network-requested PDU session release procedure in the PDU SESSION RELEASE COMMAND message.\nThere can be several rounds of exchange of a service-level-AA payload for the service to complete the service-level authentication and authorization of the request for a PDU session (see example in figure\u00a06.3.1A.1-1).\nIf the UE receives the service-level-AA response in the PDU SESSION ESTABLISHMENT ACCEPT message or the PDU SESSION ESTABLISHMENT REJECT message, the UE passes it to the upper layer.\n\nFigure\u00a06.3.1A.1-1: Service-level authentication and authorization procedure\n6.3.1A.2\tService-level authentication and authorization procedure initiation\nIn order to initiate the service-level authentication and authorization procedure, the SMF shall create a SERVICE-LEVEL AUTHENTICATION COMMAND message.\nThe SMF shall set the PTI IE of the SERVICE-LEVEL AUTHENTICATION COMMAND message to \"No procedure transaction identity assigned\".\nThe SMF shall set the service-level-AA payload in the Service-level-AA container IE of the SERVICE-LEVEL AUTHENTICATION COMMAND message to the payload provided by the DN via the NEF. If a payload type associated with the payload is provided by the DN via the NEF, the SMF shall set the service-level-AA payload type with the value set to the payload type.\nNOTE\u00a01:\tIn case of UUAA, the service-level-AA payload is provided by the DN via the UAS-NF.\nThe SMF shall send the SERVICE-LEVEL AUTHENTICATION COMMAND message, and the SMF shall start timer T3594 (see example in figure\u00a06.3.1A.1-1).\nUpon receipt of the SERVICE-LEVEL AUTHENTICATION COMMAND message, if the UE provided a DNN during the PDU session establishment, the UE shall stop timer T3396, if it is running for the DNN provided by the UE. If the UE did not provide a DNN during the PDU session establishment, the UE shall stop the timer T3396 associated with no DNN if it is running. In an SNPN, the timer T3396 to be stopped includes:\na)\tthe timer T3396 applied for all the equivalent SNPNs, associated with the RSNPN or an equivalent SNPN, and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nb)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN, and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\nUpon receipt of the SERVICE-LEVEL AUTHENTICATION COMMAND message, if the UE provided an S-NSSAI and a DNN during the PDU session establishment, the UE shall stop timer T3584, if it is running for the [S-NSSAI of the PDU session, DNN] combination. If the UE provided a DNN but did not provide an S-NSSAI during the PDU session establishment, the UE shall stop timer T3584, if it is running for the same [no S-NSSAI, DNN] combination provided by the UE. If the UE provided an S-NSSAI but did not provide a DNN during the PDU session establishment, the UE shall stop timer T3584, if it is running for the same [S-NSSAI, no DNN] combination provided by the UE. If the UE provided neither a DNN nor an S-NSSAI during the PDU session establishment, the UE shall stop timer T3584, if it is running for the same [no S-NSSAI, no DNN] combination provided by the UE. The timer T3584 to be stopped includes:\na)\tin a PLMN:\n1)\tthe timer T3584 applied for all the PLMNs, if running, and \n2)\tthe timer T3584 applied for the registered PLMN, if running; or\nb)\tin an SNPN:\n1)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\n2)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\nUpon receipt of the SERVICE-LEVEL AUTHENTICATION COMMAND message, if the UE provided an S-NSSAI during the PDU session establishment, the UE shall stop timer T3585, if it is running for the S-NSSAI of the PDU session. If the UE did not provide an S-NSSAI during the PDU session establishment, the UE shall stop the timer T3585 associated with no S-NSSAI if it is running. The timer T3585 to be stopped includes:\na)\tin a PLMN:\n-\tthe timer T3585 applied for all the PLMNs and for the access over which the SERVICE-LEVEL AUTHENTICATION COMMAND message is received, if running;\n-\tthe timer T3585 applied for all the PLMNs and for both 3GPP access type and non-3GPP access type, if running;\n-\tthe timer T3585 applied for the registered PLMN and for the access over which the SERVICE-LEVEL AUTHENTICATION COMMAND message is received, if running; and\n-\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\nb)\tin an SNPN:\n1)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\n2)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\n3)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\n4)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\nNOTE\u00a02:\tUpon receipt of the SERVICE-LEVEL AUTHENTICATION COMMAND message for a PDU session, if the UE provided a DNN (or no DNN) and an S-NSSAI (or no S-NSSAI) when the PDU session is established, timer T3396 associated with the DNN (or no DNN, if no DNN was provided by the UE) is running, and timer T3584 associated with the DNN (or no DNN, if no DNN was provided by the UE) and the S-NSSAI (or no S-NSSAI, if no S-NSSAI was provided by the UE) is running, then the UE stops both the timer T3396 and the timer T3584.\nNOTE\u00a03:\tUpon receipt of the SERVICE-LEVEL AUTHENTICATION COMMAND message for a PDU session, if the UE provided a DNN (or no DNN) and an S-NSSAI (or no S-NSSAI) when the PDU session is established, timer T3585 associated with the S-NSSAI (or no S-NSSAI, if no S-NSSAI was provided by the UE) is running, and timer T3584 associated with the DNN (or no DNN, if no DNN was provided by the UE) and the S-NSSAI (or no S-NSSAI, if no S-NSSAI was provided by the UE) is running, then the UE stops both the timer T3585 and the timer T3584.\nUpon receipt of a SERVICE-LEVEL AUTHENTICATION COMMAND message and a PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5, the UE passes to the upper layers the service-level-AA payload received in the Service-level-AA container IE of the SERVICE-LEVEL AUTHENTICATION COMMAND message. Apart from this action, the service-level authentication and authorization procedure initiated by the DN is transparent to the 5GSM layer of the UE.\n6.3.1A.3\tService-level authentication and authorization procedure accepted by the UE\nWhen the upper layers provide a service-level-AA payload, the UE shall create a SERVICE-LEVEL AUTHENTICATION COMPLETE message and set the service-level-AA payload of the Service-level-AA container IE to the service-level-AA payload received from the upper layers, and if the service-level-AA payload type is received in the SERVICE-LEVEL AUTHENTICATION COMMAND message from the SMF, set the service-level-AA payload type of the Service-level-AA container IE to the service-level-AA payload type received from the SMF.\nThe UE shall transport the SERVICE-LEVEL AUTHENTICATION COMPLETE message and the PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5. Apart from this action, the service-level authentication and authorization procedure initiated by the DN is transparent to the 5GSM layer of the UE.\nUpon receipt of a SERVICE-LEVEL AUTHENTICATION COMPLETE message, the SMF shall stop timer T3594 and provides the service-level-AA payload received in the Service-level-AA container IE of the SERVICE-LEVEL AUTHENTICATION COMPLETE message to the DN.\n6.3.1A.4\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3594.\n\tOn the first expiry of the timer T3594, the SMF shall resend the SERVICE-LEVEL AUTHENTICATION COMMAND message and shall reset and restart timer T3594. This retransmission is repeated four times, i.e., on the fifth expiry of timer T3594, the SMF shall abort the procedure and send PDU SESSION ESTABLISHMENT REJECT message with the 5GSM cause #29 \"user authentication or authorization failed\" as specified in subclause\u00a06.4.1.4.1.\n6.3.1A.5\tAbnormal cases in the UE\nThe following abnormal case can be identified:\na)\tCollision of UE-requested PDU session release procedure and a service-level authentication and authorization procedure.\n\tWhen the UE receives a SERVICE-LEVEL AUTHENTICATION COMMAND message during the UE-requested PDU session release procedure, and the PDU session indicated in SERVICE-LEVEL AUTHENTICATION COMMAND message is the PDU session that the UE has requested to release, the UE shall ignore the SERVICE-LEVEL AUTHENTICATION COMMAND message and proceed with the UE-requested PDU session release procedure.\n6.3.2\tNetwork-requested PDU session modification procedure\n6.3.2.1\tGeneral\nThe purpose of the network-requested PDU session modification procedure is to enable the network to modify a PDU session, re-negotiate header compression configuration associated to a PDU session, convey a port management information container, to trigger EAS rediscovery, provide updated DNS server address(es) due to the newly selected local DNS server or the newly selected EASDF, provide updated ECS configuration information, remove joined UE from one or more multicast MBS sessions associated with a PDU session, update ATSSS parameters (e.g. ATSSS rules), update the MBS service area or the security information of multicast MBS session that the UE has joined or to inform about the result of service-level AA procedure or C2 authorization for UAS services.\n6.3.2.2\tNetwork-requested PDU session modification procedure initiation\nIn order to initiate the network-requested PDU session modification procedure, the SMF shall create a PDU SESSION MODIFICATION COMMAND message.\nIf the authorized QoS rules of the PDU session is modified or is marked as to be synchronised with the UE, the SMF shall set the Authorized QoS rules IE of the PDU SESSION MODIFICATION COMMAND message to the authorized QoS rules of the PDU session. The SMF shall ensure that the number of the packet filters used in the authorized QoS rules of the PDU Session does not exceed the maximum number of packet filters supported by the UE for the PDU session. The SMF may bind service data flows for which the UE has requested traffic segregation to a dedicated QoS flow for the PDU session, if possible. Otherwise the SMF may bind the service data flows to an existing QoS flow. The SMF shall use only one dedicated QoS flow for traffic segregation. If the UE has requested traffic segregation for multiple service data flows with different QoS handling, the SMF shall bind all these service data flows to a single QoS flow. If the SMF allows traffic segregation for service data flows in a QoS rule, then the SMF shall create a new authorized QoS rule for these service data flows and shall delete packet filters corresponding to these service data flows from the other authorized QoS rules.\nIf the authorized QoS flow descriptions of the PDU session is modified or is marked as to be synchronised with the UE, the SMF shall set the Authorized QoS flow descriptions IE of the PDU SESSION MODIFICATION COMMAND message to the authorized QoS flow descriptions of the PDU session.\nIf SMF creates a new authorized QoS rule for a new QoS flow, then SMF shall include the authorized QoS flow description for that QoS flow in the Authorized QoS flow descriptions IE of the PDU SESSION MODIFICATION COMMAND message, if:\na)\tthe newly created authorized QoS rules is for a new GBR QoS flow;\nb)\tthe QFI of the new QoS flow is not the same as the 5QI of the QoS flow identified by the QFI;\nc)\tthe new QoS flow can be mapped to an EPS bearer as specified in subclause\u00a04.11.1 of 3GPP\u00a0TS\u00a023.502\u00a0[9]; or\nd)\tthe new QoS flow is established for the PDU session used for relaying, as specified in subclause\u00a05.6.2.1 of 3GPP\u00a0TS\u00a023.304\u00a0[6E].\nNOTE\u00a00:\tIn cases other than above listed cases, it is up to the SMF implementation to include the authorized QoS flow description of the new QoS flow for the new authorized QoS rule in the Authorized QoS flow descriptions IE of the PDU SESSION MODIFICATION COMMAND message.\nIf the session-AMBR of the PDU session is modified, the SMF shall set the selected Session-AMBR IE of the PDU SESSION MODIFICATION COMMAND message to the session-AMBR of the PDU session.\nIf interworking with EPS is supported for the PDU session and if the mapped EPS bearer contexts of the PDU session is modified, the SMF shall set the Mapped EPS bearer contexts IE of the PDU SESSION MODIFICATION COMMAND message to the mapped EPS bearer contexts of the PDU session. If the association between a QoS flow and the mapped EPS bearer context is changed, the SMF shall set the EPS bearer identity parameter in Authorized QoS flow descriptions IE of the PDU SESSION MODIFICATION COMMAND message to the new EPS bearer identity associated with the QoS flow.\nNOTE\u00a00A:\tThe SMF can include multiple mapped EPS bearer context fields with the same EPS bearer identity in the Mapped EPS bearer contexts IE of the PDU SESSION MODIFICATION COMMAND message in cases, e.g. the packet filters need to be modified and the modification requires more than one TFT operation codes or the mapped traffic flow template needs to be modified and the modification exceeds the maximum size of the TFT IE.\nIf the network-requested PDU session modification procedure is triggered by a UE-requested PDU session modification procedure and the PDU SESSION MODIFICATION REQUEST message includes a 5GSM capability IE, the SMF shall:\na)\tif the RQoS bit is set to:\n1)\t\"Reflective QoS supported\", consider that the UE supports reflective QoS for this PDU session; or\n2)\t\"Reflective QoS not supported\", consider that the UE does not support reflective QoS for this PDU session; and;\nb)\tif the MH6-PDU bit is set to:\n1)\t\"Multi-homed IPv6 PDU session supported\", consider that this PDU session is supported to use multiple IPv6 prefixes; or\n2)\t\"Multi-homed IPv6 PDU session not supported\", consider that this PDU session is not supported to use multiple IPv6 prefixes.\nIf the SMF considers that reflective QoS is supported for QoS flows belonging to this PDU session, the SMF may include the RQ timer IE set to an RQ timer value in the PDU SESSION MODIFICATION COMMAND message.\nIf a port management information container needs to be delivered (see 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a023.502\u00a0[9]) and the UE has set the TPMIC bit to \"Transfer of port management information containers supported\" in the 5GSM capability IE, the SMF shall include a Port management information container IE in the PDU SESSION MODIFICATION COMMAND message.\nFor a PDN connection established when in S1 mode, upon an inter-system change from S1 mode to N1 mode, if the network-requested PDU session modification procedure is triggered by a UE-requested PDU session modification procedure and a UE-requested PDU session modification procedure has not been successfully performed yet, the PDU session type is \"IPv4\", \"IPv6\", \"IPv4v6\" or \"Ethernet\" and the PDU SESSION MODIFICATION REQUEST message includes a Maximum number of supported packet filters IE, the SMF shall consider this number as the maximum number of packet filters that can be supported by the UE for this PDU session. Otherwise the SMF considers that the UE supports 16 packet filters for this PDU session.\nFor a PDN connection established when in S1 mode, upon an inter-system change from S1 mode to N1 mode, if the network-requested PDU session modification procedure is triggered by a UE-requested PDU session modification procedure and a UE-requested PDU session modification procedure has not been successfully performed yet, the SMF shall consider that the maximum data rate per UE for user-plane integrity protection supported by the UE for uplink and the maximum data rate per UE for user-plane integrity protection supported by the UE for downlink are valid for the lifetime of the PDU session.\nFor a PDN connection established when in S1 mode, upon an inter-system change from S1 mode to N1 mode, if the network-requested PDU session modification procedure is triggered by a UE-requested PDU session modification procedure and a UE-requested PDU session modification procedure has not been successfully performed yet, and the SMF determines, based on local policies or configurations in the SMF and the Always-on PDU session requested IE in the PDU SESSION MODIFICATION REQUEST message (if available), that either:\na)\tthe requested PDU session needs to be an always-on PDU session, the SMF shall include the Always-on PDU session indication IE in the PDU SESSION MODIFICATION COMMAND message and shall set the value to \"Always-on PDU session required\"; or\nb)\tthe requested PDU session shall not be an always-on PDU session and:\n1)\tif the UE included the Always-on PDU session requested IE, the SMF shall include the Always-on PDU session indication IE in the PDU SESSION MODIFICATION COMMAND message and shall set the value to \"Always-on PDU session not allowed\"; or\n2)\tif the UE did not include the Always-on PDU session requested IE, the SMF shall not include the Always-on PDU session indication IE in the PDU SESSION MODIFICATION COMMAND message.\nFor a PDN connection established when in S1 mode, upon an inter-system change from S1 mode to N1 mode, if the network-requested PDU session modification procedure is triggered by a UE-requested PDU session modification procedure, a UE-requested PDU session modification procedure has not been successfully performed yet, the UE supports EDC and the network allows the use of EDC, then the SMF shall include the Extended protocol configuration options IE in the PDU SESSION MODIFICATION COMMAND message with the EDC usage allowed indicator.\nFor a PDN connection established when in S1 mode, upon an inter-system change from S1 mode to N1 mode, if the network-requested PDU session modification procedure is triggered by a UE-requested PDU session modification procedure, a UE-requested PDU session modification procedure has not been successfully performed yet, the UE supports EDC and the network requires the use of EDC, then the SMF shall include the Extended protocol configuration options IE in the PDU SESSION MODIFICATION COMMAND message with the EDC usage required indicator.\nIf a QoS flow for URLLC is created in a PDU session and the SMF has not provided the Always-on PDU session indication IE with the value set to \"Always-on PDU session required\" in the UE-requested PDU session establishment procedure or a network-requested PDU session modification procedure for the PDU session, the SMF shall include the Always-on PDU session indication IE in the PDU SESSION MODIFICATION COMMAND message and shall set the value to \"Always-on PDU session required\".\nIf the value of the RQ timer is set to \"deactivated\" or has a value of zero, the UE considers that RQoS is not applied for this PDU session and remove the derived QoS rule(s) associated with the PDU session, if any.\nIf the network-requested PDU session modification procedure is triggered by a UE-requested PDU session modification procedure, the SMF shall set the PTI IE of the PDU SESSION MODIFICATION COMMAND message to the PTI of the PDU SESSION MODIFICATION REQUEST message received as part of the UE-requested PDU session modification procedure.\nIf the network-requested PDU session modification procedure is triggered by a UE-requested PDU session modification procedure and the UE has included the Requested MBS container IE in the PDU SESSION MODIFICATION REQUEST message with the MBS operation set to \"Join multicast MBS session\", the SMF:\na)\tshall include the TMGI for the multicast MBS session IDs that the UE is allowed to join, if any, in the Received MBS container IE, shall set the MBS decision to \"MBS join is accepted\" for each of those Received MBS information, may include the MBS start time to indicate the time when the multicast MBS session starts, and shall include the MBS security container in each of those Received MBS information if security protection is applied for that multicast MBS session and the control plane security procedure is used as specified in annex\u00a0W.4.1.2 in 3GPP\u00a0TS\u00a033.501\u00a0[24], and shall use separate QoS flows dedicated for multicast by including the Authorized QoS flow descriptions IE if no separate QoS flows dedicated for multicast exist or if the SMF wants to establish new QoS flows dedicated for multicast;\nNOTE\u00a01:\tThe network determines whether security protection applies or not for the multicast MBS session as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nb)\tshall include the TMGI for multicast MBS session IDs that the UE is rejected to join, if any, in the Received MBS container IE, shall set the MBS decision to \"MBS join is rejected\" for each of those Received MBS information, shall set the Rejection cause for each of those Received MBS information with the reason of rejection and, if the Rejection cause is set to \"multicast MBS session has not started or will not start soon\", may include an MBS back-off timer value; and\nc)\tmay include in the Received MBS container IE the MBS service area for each multicast MBS session and include in it the MBS TAI list, the NR CGI list or both, that identify the service area(s) for the local MBS service;\nNOTE\u00a02:\tFor an multicast MBS session that has multiple MBS service areas, the MBS service areas are indicated to the UE using MBS service announcement as described in 3GPP\u00a0TS\u00a023.247\u00a0[53], which is out of scope of this specification.\nin the PDU SESSION MODIFICATION COMMAND message. If the UE has set the Type of multicast MBS session ID to \"Source specific IP multicast address\" in the Requested MBS container IE for certain multicast MBS session(s) in the PDU SESSION MODIFICATION REQUEST message, the SMF shall include the Source IP address information and Destination IP address information in the Received MBS information together with the TMGI for each of those multicast MBS sessions.\nNOTE\u00a03:\tIncluding the Source IP address information and Destination IP address information in the Received MBS information in that case is to allow the UE to perform the mapping between the requested multicast MBS session ID and the provided TMGI.\nNOTE\u00a04:\tIn SNPN, TMGI is used together with NID to identify an MBS Session.\nIf:\na)\tthe SMF wants to remove joined UE from one or more multicast MBS sessions; or\nb)\tthe network-requested PDU session modification procedure is triggered by a UE-requested PDU session modification procedure and the UE has included the Requested MBS container IE in the PDU SESSION MODIFICATION REQUEST message with the MBS operation set to \"Leave multicast MBS session\",\nthe SMF shall include the multicast MBS session IDs that the UE is removed from, if any, in the Received MBS container IE in the PDU SESSION MODIFICATION COMMAND message and shall set the MBS decision to \"Remove UE from multicast MBS session\" for each of those Received MBS information. The SMF may include the updated MBS service area in each of the Received MBS information, if any. The SMF may delete the QoS flows associated for the multicast by including the Authorized QoS flow descriptions IE in the PDU SESSION MODIFICATION COMMAND message. If the UE is removed from multicast MBS session due to the MBS session release, the SMF shall set the Rejection cause to \"multicast MBS session is released\". The SMF shall include the Rejection cause for each of the Received MBS information, if any, and set its value with the reason of removing the UE from the corresponding multicast MBS session.\nNOTE\u00a05:\tbased on operator's policy, e.g. after a locally configured time period, the SMF is allowed to trigger the removal of joined UE from an multicast MBS session when the UE moves outside all the MBS service area(s) of that multicast MBS session.\nIf the SMF wants to update the MBS security information of an multicast MBS session that the UE has joined, the SMF shall include the corresponding multicast MBS session ID and the MBS security container in the Received MBS container IE in the PDU SESSION MODIFICATION COMMAND message, and shall set the MBS Decision to \"MBS security information update\" in the Received MBS information.\nIf the SMF wants to update the MBS service area of an multicast MBS session that the UE has joined, the SMF shall include the corresponding multicast MBS session ID and the updated MBS service area in the Received MBS container IE in the PDU SESSION MODIFICATION COMMAND message, and shall set the MBS decision to \"MBS service area update\" in the Received MBS information.\nNOTE\u00a06:\tThe MBS service area of an multicast MBS session is also allowed to be updated to the UE using the MBS service announcement as described in 3GPP\u00a0TS\u00a023.247\u00a0[53], which is out of scope of this specification.\nIf the network needs to update ATSSS parameters (see subclause\u00a05.2.4 of 3GPP\u00a0TS\u00a024.193\u00a0[13B]), the SMF shall include the ATSSS container IE with the updates of ATSSS parameters in the PDU SESSION MODIFICATION COMMAND message.\nIf the network-requested PDU session modification procedure is not triggered by a UE-requested PDU session modification procedure, the SMF shall set the PTI IE of the PDU SESSION MODIFICATION COMMAND message to \"No procedure transaction identity assigned\".\nIf the selected SSC mode of the PDU session is \"SSC mode 3\" and the SMF requests the relocation of SSC mode 3 PDU session anchor with multiple PDU sessions as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9], the SMF shall include 5GSM cause #39\u00a0\"reactivation requested\", in the PDU SESSION MODIFICATION COMMAND message, and may include the PDU session address lifetime in a PDU session address lifetime parameter in the Extended protocol configuration options IE of the PDU SESSION MODIFICATION COMMAND message. If the selected SSC mode of the PDU session is \"SSC mode 3\", the S-NSSAI or the mapped S-NSSAI associated with the PDU session needs to be replaced and the SMF determines that the PDU session needs to be re-established on the alternative S-NSSAI, the SMF shall include the Alternative S-NSSAI IE and 5GSM cause #39\u00a0\"reactivation requested\" in the PDU SESSION MODIFICATION COMMAND message. If the selected SSC mode of the PDU session is \"SSC mode 3\", the S-NSSAI which has been replaced is available and the SMF determines that the PDU session needs to be re-established on the S-NSSAI which has been replaced, the SMF shall include and 5GSM cause #39\u00a0\"reactivation requested\" and include the S-NSSAI which has been replaced in the PDU SESSION MODIFICATION COMMAND message.\nNOTE\u00a07:\tThe relocation of SSC mode 3 PDU session anchor with multiple PDU sessions can also be initiated by the SMF in case of the SMF is requested by the AMF to release the PDU session due to the network slice instance of the PDU session is changed as specified in subclause\u00a05.15.5.3 of 3GPP\u00a0TS\u00a023.501\u00a0[8].\nThe SMF shall send the PDU SESSION MODIFICATION COMMAND message, and the SMF shall start timer T3591 (see example in figure\u00a06.3.2.2.1).\nNOTE\u00a08:\tIf the SMF requests the relocation of SSC mode 3 PDU session anchor with multiple PDU sessions as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9], the reallocation requested indication indicating whether the SMF is to be reallocated or the SMF is to be reused is provided to the AMF.\nIf the control plane CIoT 5GS optimization is enabled for a PDU session and the IP header compression configuration IE was included in the PDU SESSION ESTABLISHMENT REQUEST message or the PDU SESSION MODIFICATION REQUEST message, and the SMF supports control plane CIoT 5GS optimization and IP header compression for control plane CIoT 5GS optimization, the SMF may include the IP header compression configuration IE in the PDU SESSION MODIFICATION COMMAND message to re-negotiate IP header compression configuration associated to the PDU session.\nIf the control plane CIoT 5GS optimization is enabled for a PDU session and the Ethernet header compression configuration IE was included in the PDU SESSION ESTABLISHMENT REQUEST message or the PDU SESSION MODIFICATION REQUEST message, and the SMF supports control plane CIoT 5GS optimization and Ethernet header compression for control plane CIoT 5GS optimization, the SMF may include the Ethernet header compression configuration IE in the PDU SESSION MODIFICATION COMMAND message to re-configure Ethernet header compression configuration associated with the PDU session.\nIf the network-requested PDU session modification procedure is associated with C2 authorization procedure, the SMF shall send the PDU SESSION MODIFICATION COMMAND message by including the Service-level-AA container IE containing:\na)\tthe service-level-AA response with the value of C2AR field set to the \"C2 authorization was successful\";\nb)\tif a payload is provided from the UAS-NF, the service-level-AA payload with the value set to the payload; and\nc)\tif a payload type associated with the payload is provided from the UAS-NF, the service-level-AA payload type with the value set to the payload type; and\nd)\tif the CAA-level UAV ID is provided from the UAS-NF, the service-level device ID set to the CAA-level UAV ID.\nNOTE\u00a09:\tThe C2 authorization payload in the service-level-AA payload can include one, some or all of the pairing information for C2 communication, and the pairing information for direct C2 communication,\nNOTE 9A:\tThe C2 authorization payload in the service-level-AA payload can include the security information for C2 session as specified in TS 33.256 [24B].\nIf the service-level-AA procedure is triggered for the established PDU session for UAS services with re-authentication purpose, and the SMF is provided by the UAS-NF with the successful UUAA-SM result, the SMF shall transmit a PDU SESSION MODIFICATION COMMAND message to the UE, where the PDU SESSION MODIFICATION COMMAND message shall include the Service-level-AA container IE containing:\na)\tthe service-level-AA response with the value of SLAR field set to \"Service level authentication and authorization was successful\";\nb)\tif received the CAA-level UAV ID from the UAS-NF, the service-level device ID with the value set to the CAA-level UAV ID;\nc)\tif received a payload from the UAS-NF, the service-level-AA payload with the value set to the payload; and\nd)\tif received a payload type associated with the payload, the service-level-AA payload type with the value set to the payload type.\nIf the SMF needs to provide new ECS configuration information to the UE and the UE has indicated support for ECS configuration information provisioning in the PDU SESSION ESTABLISHMENT REQUEST message or while in S1 mode, then the SMF may include the Extended protocol configuration options IE in the PDU SESSION MODIFICATION COMMAND message with: \n-\tat least one of ECS IPv4 Address(es), ECS IPv6 Address(es), ECS FQDN(s);\n-\tat least one associated ECSP identifier;and\n-\toptionally, spatial validity conditions associated with the ECS address; \nNOTE\u00a010:\tThe IP address(es), FQDN(s), or both are associated with the ECSP identifier and replace previously provided ECS configuration information associated with the same ECSP identifier, if any.\nIf the SMF needs to provide DNS server address(es) to the UE and the UE has provided the DNS server IPv4 address request, the DNS server IPv6 address request or both of them, in the PDU SESSION ESTABLISHMENT REQUEST message or a PDU SESSION MODIFICATION REQUEST message, then the SMF shall include the Extended protocol configuration options IE in the PDU SESSION MODIFICATION COMMAND message with one or more DNS server IPv4 address(es), one or more DNS server IPv6 address(es) or both of them.\nIf the SMF needs to trigger EAS rediscovery and the UE has indicated support of the EAS rediscovery in the PDU SESSION ESTABLISHMENT REQUEST message or the PDU SESSION MODIFICATION REQUEST message, then the SMF shall include the Extended protocol configuration options IE in the PDU SESSION MODIFICATION COMMAND message:\na)\twith the EAS rediscovery indication without indicated impact; or\nb)\twith the following:\n1)\tone or more EAS rediscovery indication(s) with impacted EAS IPv4 address range, if the UE supports EAS rediscovery indication(s) with impacted EAS IPv4 address range;\n2)\tone or more EAS rediscovery indication(s) with impacted EAS IPv6 address range, if the UE supports EAS rediscovery indication(s) with impacted EAS IPv6 address range;\n3)\tone or more EAS rediscovery indication(s) with impacted EAS FQDN, if the UE supports EAS rediscovery indication(s) with impacted EAS FQDN; or\n4)\tany combination of the above.\nWhen UE has requested P-CSCF IPv6 address or P-CSCF IPv4 address and the SMF has provided P-CSCF address(es) during the PDU session establishment procedure, if the network-requested PDU session modification procedure is triggered for P-CSCF restoration, the SMF shall include the P-CSCF IP address(es) in the Extended protocol configuration options IE in the PDU SESSION MODIFICATION COMMAND message as specified in subclause\u00a05.8.2.2 of 3GPP\u00a0TS\u00a023.380\u00a0[54].\nIf the S-NSSAI or the mapped S-NSSAI of the PDU session needs to be replaced and the SMF determines that the PDU session needs to be retained, the SMF shall include the Alternative S-NSSAI IE in the PDU SESSION MODIFICATION COMMAND message. If the S-NSSAI which has been replaced is available and the SMF determines that the PDU session needs to be retained, the SMF include S-NSSAI which has been replaced in the PDU SESSION MODIFICATION COMMAND message.\nIf the SMF includes the authorized QoS flow descriptions and the SMF determines to provide the N3QAI to the UE, the SMF shall include the N3QAI IE in the PDU SESSION MODIFICATION COMMAND message.\nIf the PDU session was a single access PDU session established over 3GPP access with IP PDU session type and based on operator policy the SMF determines to provide the protocol description for UL PDU set handling to the UE, the SMF may include the Protocol description IE in the PDU SESSION MODIFICATION COMMAND message.\n\nFigure\u00a06.3.2.2.1: Network-requested PDU session modification procedure\n6.3.2.3\tNetwork-requested PDU session modification procedure accepted by the UE\nUpon receipt of the PDU SESSION MODIFICATION COMMAND message, if the UE provided a DNN during the PDU session establishment, the UE shall stop timer T3396, if it is running for the DNN provided by the UE. If the UE did not provide a DNN during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop the timer T3396 associated with no DNN if it is running. If the PDU SESSION MODIFICATION COMMAND message was received for an emergency PDU session, the UE shall not stop the timer T3396 associated with no DNN if it is running. In an SNPN, the timer T3396 to be stopped includes:\nb)\tthe timer T3396 applied for all the equivalent SNPNs, associated with the RSNPN or an equivalent SNPN, and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\na)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN, and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\nUpon receipt of the PDU SESSION MODIFICATION COMMAND message, if the UE provided an S-NSSAI and a DNN during the PDU session establishment, the UE shall stop timer T3584, if it is running for the [S-NSSAI of the PDU session, DNN] combination provided by the UE. If the UE provided a DNN and did not provide an S-NSSAI during the PDU session establishment, the UE shall stop timer T3584, if it is running for the same [no S-NSSAI, DNN] combination provided by the UE. If the UE provided an S-NSSAI and did not provide a DNN during the PDU session establishment, the UE shall stop timer T3584, if it is running for the same [S-NSSAI, no DNN] combination provided by the UE. If the UE provided neither a DNN nor an S-NSSAI during the PDU session establishment, the UE shall stop timer T3584, if it is running for the same [no S-NSSAI, no DNN] combination provided by the UE. The timer T3584 to be stopped includes:\na)\tin a PLMN:\n1)\tthe timer T3584 applied for all the PLMNs, if running; and\n2)\tthe timer T3584 applied for the registered PLMN, if running; or\nb)\tin an SNPN:\n1)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\n2)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\nUpon receipt of the PDU SESSION MODIFICATION COMMAND message, if the UE provided an S-NSSAI during the PDU session establishment, the UE shall stop timer T3585, if it is running for the S-NSSAI of the PDU session. If the UE did not provide an S-NSSAI during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop the timer T3585 associated with no S-NSSAI if it is running. The timer T3585 to be stopped includes:\na)\tin a PLMN:\n1)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION MODIFICATION COMMAND is received, if running;\n2)\tthe timer T3585 applied for all the PLMNs and for both 3GPP access type and non-3GPP access type, if running;\n3)\tthe timer T3585 applied for the registered PLMN and for the access over which the PDU SESSION MODIFICATION COMMAND is received, if running; and\n4)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\nb) in an SNPN:\n1)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\n2)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\n3)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\n4)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\nIf the PDU SESSION MODIFICATION COMMAND message was received for an emergency PDU session, the UE shall not stop the timer T3585 associated with no S-NSSAI if it is running.\nNOTE\u00a01:\tUpon receipt of the PDU SESSION MODIFICATION COMMAND message for a PDU session, if the UE provided a DNN (or no DNN) and an S-NSSAI (or no S-NSSAI) when the PDU session is established, timer T3396 associated with the DNN (or no DNN, if no DNN was provided by the UE) is running, and timer T3584 associated with the DNN (or no DNN, if no DNN was provided by the UE) and the S-NSSAI of the PDU session (or no S-NSSAI, if no S-NSSAI was provided by the UE) is running, then the UE stops both the timer T3396 and the timer T3584.\nNOTE\u00a02:\tUpon receipt of the PDU SESSION MODIFICATION COMMAND message for a PDU session, if the UE provided a DNN (or no DNN) and an S-NSSAI (or no S-NSSAI) when the PDU session is established, timer T3585 associated with the S-NSSAI of the PDU session (or no S-NSSAI, if no S-NSSAI was provided by the UE) is running, and timer T3584 associated with the DNN (or no DNN, if no DNN was provided by the UE) and the S-NSSAI of the PDU session (or no S-NSSAI, if no S-NSSAI was provided by the UE) is running, then the UE stops both the timer T3585 and the timer T3584.\nIf the PDU SESSION MODIFICATION COMMAND message includes the Authorized QoS rules IE, the UE shall process the QoS rules sequentially starting with the first QoS rule.\nIf the PDU SESSION MODIFICATION COMMAND message includes the Mapped EPS bearer contexts IE, the UE shall process the mapped EPS bearer contexts sequentially starting with the first mapped EPS bearer context.\nIf the PDU SESSION MODIFICATION COMMAND message includes the Authorized QoS flow descriptions IE, the UE shall process the QoS flow descriptions sequentially starting with the first QoS flow description.\nThe UE shall replace the stored authorized QoS rules, authorized QoS flow descriptions and session-AMBR of the PDU session with the received value(s), if any, in the PDU SESSION MODIFICATION COMMAND message.\nIf the PDU SESSION MODIFICATION COMMAND message includes a Mapped EPS bearer contexts IE, the UE shall check each mapped EPS bearer context for different types of errors as follows:\nNOTE\u00a03:\tAn error detected in a mapped EPS bearer context does not cause the UE to discard the Authorized QoS rules IE and Authorized QoS flow descriptions IE included in the PDU SESSION MODICATION COMMAND message, if any.\na)\tSemantic error in the mapped EPS bearer operation:\n1)\toperation code = \"Create new EPS bearer\" and there is already an existing mapped EPS bearer context with the same EPS bearer identity associated with any PDU session.\n2)\toperation code = \"Delete existing EPS bearer\" and there is no existing mapped EPS bearer context with the same EPS bearer identity associated with the PDU session that is being modified.\n3)\toperation code = \"Modify existing EPS bearer\" and there is no existing mapped EPS bearer context with the same EPS bearer identity associated with the PDU session that is being modified.\n4)\toperation code = \"Create new EPS bearer\" or \"Modify existing EPS bearer\" and the resulting mapped EPS bearer context has invalid mandatory parameters or missing mandatory parameters (e.g., mapped EPS QoS parameters or traffic flow template for a dedicated EPS bearer context).\n\tIn case 1, if the existing mapped EPS bearer context is associated with the PDU session that is being modified, the UE shall not diagnose an error, further process the create request and, if it was process successfully, delete the old EPS bearer context.\n\tIn case 2, the UE shall not diagnose an error, further process the delete request and, if it was processed successfully, consider the mapped EPS bearer context as successfully deleted.\n\tOtherwise, after sending the PDU SESSION MODIFICATION COMPLETE for the ongoing PDU session modification procedure, the UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #85 \"Invalid mapped EPS bearer identity\".\nb) if the mapped EPS bearer context includes a traffic flow template, the UE shall check the traffic flow template for different types of TFT IE errors as follows:\n1)\tSemantic errors in TFT operations:\ni)\tTFT operation = \"Create new TFT\" when there is already an existing TFT for the EPS bearer context.\nii)\tWhen the TFT operation is an operation other than \"Create a new TFT\" and there is no TFT for the EPS bearer context.\niii)\tTFT operation = \"Delete packet filters from existing TFT\" when it would render the TFT empty.\niv)\tTFT operation = \"Delete existing TFT\" for a dedicated EPS bearer context.\n\tIn case iv, after sending the PDU SESSION MODIFICATION COMPLETE for the ongoing PDU session modification procedure, the UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #41 \"semantic error in the TFT operation\".\n\tIn the other cases the UE shall not diagnose an error and perform the following actions to resolve the inconsistency:\n\tIn case i, the UE shall further process the new activation request to create a new TFT and, if it was processed successfully, delete the old TFT.\n\tIn case ii, the UE shall:\n-\tprocess the new request and if the TFT operation is \"Delete existing TFT\" or \"Delete packet filters from existing TFT\", and if no error according to items 2, 3, and 4 was detected, consider the TFT as successfully deleted;\n-\tprocess the new request as an activation request, if the TFT operation is \"Add packet filters in existing TFT\" or \"Replace packet filters in existing TFT\".\n\tIn case iii, if the packet filters belong to a dedicated EPS bearer context, the UE shall process the new deletion request and, if no error according to items 2, 3, and 4 was detected, after sending the PDU SESSION MODIFICATION COMPLETE for the ongoing PDU session modification procedure, the UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #41 \"semantic error in the TFT operation\".\n\tIn case iii, if the packet filters belong to the default EPS bearer context, the UE shall process the new deletion request and if no error according to items 2, 3, and 4 was detected then delete the existing TFT, this corresponds to using match-all packet filter for the default EPS bearer context.\n2)\tSyntactical errors in TFT operations:\ni)\tWhen the TFT operation = \"Create new TFT\", \"Add packet filters in existing TFT\", \"Replace packet filters in existing TFT\" or \"Delete packet filters from existing TFT\" and the packet filter list in the TFT IE is empty.\nii)\tTFT operation = \"Delete existing TFT\" or \"No TFT operation\" with a non-empty packet filter list in the TFT IE.\niii)\tTFT operation = \"Replace packet filters in existing TFT\" when the packet filter to be replaced does not exist in the original TFT.\niv)\tTFT operation = \"Delete packet filters from existing TFT\" when the packet filter to be deleted does not exist in the original TFT.\nv)\tVoid.\nvi)\tWhen there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.\n\tIn case iii, the UE shall not diagnose an error, further process the replace request and, if no error according to items 3 and 4 was detected, include the packet filters received to the existing TFT.\n\tIn case iv, the UE shall not diagnose an error, further process the deletion request and, if no error according to items 3 and 4 was detected, consider the respective packet filter as successfully deleted.\n\tOtherwise, after sending the PDU SESSION MODIFICATION COMPLETE for the ongoing PDU session modification procedure, the UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #42 \"syntactical error in the TFT operation\".\nNOTE\u00a03a:\tAn implementation that strictly follows packet filter list as defined in subclause\u00a010.5.6.12 in 3GPP\u00a0TS\u00a024.008\u00a0[12] might not detect case 2) ii).\n3)\tSemantic errors in packet filters:\ni)\tWhen a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.\nii)\tWhen the resulting TFT, which is assigned to a dedicated EPS bearer context, does not contain any packet filter applicable for the uplink direction among the packet filters created on request from the network.\n\tAfter sending the PDU SESSION MODIFICATION COMPLETE for the ongoing PDU session modification procedure, the UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #44 \"semantic errors in packet filter(s)\".\n4)\tSyntactical errors in packet filters:\ni)\tWhen the TFT operation = \"Create new TFT\", \"Add packet filters to existing TFT\", or \"Replace packet filters in existing TFT\" and two or more packet filters in the resultant TFT would have identical packet filter identifiers.\nii)\tWhen the TFT operation = \"Create new TFT\", \"Add packet filters to existing TFT\" or \"Replace packet filters in existing TFT\", and two or more packet filters among all TFTs associated with this PDN connection would have identical packet filter precedence values.\niii)\tWhen there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.\n\tIn case i, if two or more packet filters with identical packet filter identifiers are contained in the new request, after sending the PDU SESSION MODIFICATION COMPLETE for the ongoing PDU session modification procedure, the UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #45 \"syntactical error in packet filter(s)\". Otherwise, the UE shall not diagnose an error, further process the new request and, if it was processed successfully, delete the old packet filters which have the identical packet filter identifiers.\n\tIn case ii, if the old packet filters do not belong to the default EPS bearer context, the UE shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values.\n\tIn case ii, if one or more old packet filters belong to the default EPS bearer context, after sending the PDU SESSION MODIFICATION COMPLETE for the ongoing PDU session modification procedure, the UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #45 \"syntactical errors in packet filter(s)\".\n\tOtherwise, after sending the PDU SESSION MODIFICATION COMPLETE for the ongoing PDU session modification procedure, the UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #45 \"syntactical error in packet filter(s)\".\nAnd if a new EPS bearer identity parameter in Authorized QoS flow descriptions IE is received for a QoS flow which can be transferred to EPS, the UE shall update the association between the QoS flow and the mapped EPS bearer context, based on the new EPS bearer identity and the mapped EPS bearer contexts. If the \"Delete existing EPS bearer\" operation code in the Mapped EPS bearer contexts IE was received, the UE shall discard the association between the QoS flow and the corresponding mapped EPS bearer context and delete the corresponding mapped EPS bearer context.\nIf:\na)\tthe UE detects different errors in the mapped EPS bearer contexts as described above which requires sending a PDU SESSION MODIFICATION REQUEST message to delete the erroneous mapped EPS bearer contexts; and\nb)\toptionally, if the UE detects errors in QoS rules that require to delete at least one QoS rule as described in subclause\u00a06.3.2.4 which requires sending a PDU SESSION MODIFICATION REQUEST message to delete the erroneous QoS rules;\nthe UE, after sending the PDU SESSION MODIFICATION COMPLETE message for the ongoing PDU session modification procedure, may send a single PDU SESSION MODIFICATION REQUEST message to delete the erroneous mapped EPS bearer contexts, and optionally to delete the erroneous QoS rules. The UE shall include a 5GSM cause IE in the PDU SESSION MODIFICATION REQUEST message.\nNOTE\u00a04:\tThe 5GSM cause to use cannot be different from #41 \"semantic error in the TFT operation\", #42 \"syntactical error in the TFT operation\", #44 \"semantic error in packet filter(s)\", #45 \"syntactical errors in packet filter(s)\", #83 \"semantic error in the QoS operation\", #84 \"syntactical error in the QoS operation\", or #85 \"Invalid mapped EPS bearer identity\". The selection of a 5GSM cause is up to UE implementation.\nUpon receipt of a PDU SESSION MODIFICATION COMMAND message and a PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5, if the UE accepts the PDU SESSION MODIFICATION COMMAND message, the UE considers the PDU session as modified and the UE shall create a PDU SESSION MODIFICATION COMPLETE message.\nIf the PDU SESSION MODIFICATION COMMAND message contains the PTI value allocated in the UE-requested PDU session modification procedure, the UE shall stop the timer T3581. The UE should ensure that the PTI value assigned to this procedure is not released immediately.\nNOTE\u00a05:\tThe way to achieve this is implementation dependent. For example, the UE can ensure that the PTI value assigned to this procedure is not released during the time equal to or greater than the default value of timer T3591.\nWhile the PTI value is not released, the UE regards any received PDU SESSION MODIFICATION COMMAND message with the same PTI value as a network retransmission (see subclause\u00a07.3.1).\nIf the selected SSC mode of the PDU session is \"SSC mode 3\" and the PDU SESSION MODIFICATION COMMAND message includes 5GSM cause #39 \"reactivation requested\", the UE can provide to the upper layers the PDU session address lifetime if received in the PDU session address lifetime parameter of the Extended protocol configuration options IE of the PDU SESSION MODIFICATION COMMAND message. After the completion of the network-requested PDU session modification procedure:\na)\tif the PDU session is an MA PDU session:\n1)\testablished over both 3GPP access and non-3GPP access, and:\n-\tthe UE is registered over both 3GPP access and non-3GPP access in the same PLMN:\n-\tthe UE should re-initiate a UE-requested PDU session establishment procedure as specified in subclause\u00a06.4.1 over the access the PDU SESSION MODIFICATION COMMAND message is received; or\n-\tthe UE is registered over both 3GPP access and non-3GPP access in different PLMNs:\n-\tthe UE should re-initiate UE-requested PDU session establishment procedures as specified in subclause 6.4.1 over both accesses. The UE should re-initiate the UE-requested PDU session establishment procedure over the access the PDU SESSION MODIFICATION COMMAND message is received first; or\n2)\testablished over only single access:\n-\tthe UE should re-initiate a UE-requested PDU session establishment procedure as specified in subclause 6.4.1 over the access the user plane resources were established; or\nb)\tif the PDU session is a single access PDU session:\n-\tthe UE should re-initiate a UE-requested PDU session establishment procedure as specified in subclause 6.4.1 over the access the PDU session was associated with; and\nfor the re-initiated UE-requested PDU session establishment procedure(s) the UE should set a new PDU session ID different from the PDU session ID associated with the present PDU session and should set:\na)\tthe PDU session type to the PDU session type associated with the present PDU session;\nb)\tthe SSC mode to the SSC mode associated with the present PDU session;\nc)\tthe DNN to the DNN associated with the present PDU session;\nd)\tthe S-NSSAI to:\n1)\tthe S-NSSAI associated with (if available in roaming scenarios) a mapped S-NSSAI if provided in the UE-requested PDU session establishment procedure of the present PDU session; or\n2)\tthe S-NSSAI received in the PDU SESSION ESTABLISHMENT ACCEPT message of the existing PDU session if the UE received the Alternative S-NSSAI IE in the PDU SESSION MODIFICATION COMMAND message; and\ne)\tthe alternative S-NSSAI to the S-NSSAI associated with (if available in roaming scenarios) a mapped S-NSSAI if received in the Alternative S-NSSAI IE of the PDU SESSION MODIFICATION COMMAND message.\nIf the UE has indicated support for CIoT 5GS optimizations and receives a small data rate control parameters container in the Extended protocol configuration options IE in the PDU SESSION MODIFICATION COMMAND message, the UE shall store the small data rate control parameters value and use the stored small data rate control parameters value as the maximum allowed limit of uplink user data for the PDU session in accordance with 3GPP\u00a0TS\u00a023.501\u00a0[8]. If the UE has a previously stored small data rate control parameter value for the PDU session, the UE shall replace the stored small data rate control parameters value for the PDU session with the received small data rate control parameters value in the Extended protocol configuration options IE in the PDU SESSION MODIFICATION COMMAND message.\nIf the UE has indicated support for CIoT 5GS optimizations and receives an additional small data rate control parameters for exception data container in the Extended protocol configuration options IE in the PDU SESSION MODIFICATION COMMAND message, the UE shall store the additional small data rate control parameters for exception data value and use the stored additional small data rate control parameters for exception data value as the maximum allowed limit of uplink exception data for the PDU session in accordance with 3GPP\u00a0TS\u00a023.501\u00a0[8]. If the UE has a previously stored additional small data rate control parameters for exception data value for the PDU session, the UE shall replace the stored additional small data rate control parameters for exception data value for the PDU session with the received additional small data rate control parameters for exception data value in the Extended protocol configuration options IE in the PDU SESSION MODIFICATION COMMAND message.\nThe UE shall include the PDU session ID of the old PDU session which is about to get released in the old PDU session ID IE of the UL NAS TRANSPORT message that transports the PDU SESSION ESTABLISHMENT REQUEST message.\nNOTE\u00a06:\tThe UE is expected to maintain the PDU session for which the PDU SESSION MODIFICATION COMMAND message including 5GSM cause #39 \"reactivation requested\" is received during the time indicated by the PDU session address lifetime value or until receiving an indication from upper layers (e.g. that the old PDU session is no more needed).\nIf the selected PDU session type of the PDU session is \"Unstructured\", the UE supports inter-system change from N1 mode to S1 mode, the UE does not support establishment of a PDN connection for the PDN type set to \"non-IP\" in S1 mode, and the parameters list field of one or more authorized QoS flow descriptions received in the Authorized QoS flow descriptions IE of the PDU SESSION MODIFICATION COMMAND message contains an EPS bearer identity (EBI), then the UE shall locally remove the EPS bearer identity (EBI) from the parameters list field of such one or more authorized QoS flow descriptions. After sending the PDU SESSION MODIFICATION COMPLETE message for the ongoing PDU session modification procedure, the UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #85 \"Invalid mapped EPS bearer identity\".\nIf the selected PDU session type of the PDU session is \"Ethernet\", the UE supports inter-system change from N1 mode to S1 mode, the UE does not support establishment of a PDN connection for the PDN type set to \"non-IP\" in S1 mode, the UE, the network or both of them do not support Ethernet PDN type in S1 mode, and the parameters list field of one or more authorized QoS flow descriptions received in the Authorized QoS flow descriptions IE of the PDU SESSION MODIFICATION COMMAND message contains an EPS bearer identity (EBI), the UE shall locally remove the EPS bearer identity (EBI) from the parameters list field of such one or more authorized QoS flow descriptions. After sending the PDU SESSION MODIFICATION COMPLETE message for the ongoing PDU session modification procedure, the UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #85 \"Invalid mapped EPS bearer identity\".\nFor a UE which is registered for disaster roaming services and for a PDU session which is not a PDU session for emergency services:\na)\tif the parameters list field of one or more authorized QoS flow descriptions received in the Authorized QoS flow descriptions IE of the PDU SESSION MODIFICATION COMMAND message contains an EPS bearer identity (EBI), then the UE shall locally remove the EPS bearer identity (EBI) from the parameters list field of such one or more authorized QoS flow descriptions; and\nb)\tthe UE shall locally delete the contents of the Mapped EPS bearer contexts IE if it is received in the PDU SESSION MODIFICATION COMMAND message.\nIf the Always-on PDU session indication IE is included in the PDU SESSION MODIFICATION COMMAND message and:\na)\tthe value of the IE is set to \"Always-on PDU session required\", the UE shall consider the established PDU session as an always-on PDU session; or\nb)\tthe value of the IE is set to \"Always-on PDU session not allowed\", the UE shall not consider the established PDU session as an always-on PDU session.\nIf the UE does not receive the Always-on PDU session indication IE in the PDU SESSION MODIFICATION COMMAND message:\na)\tif the network-requested PDU session modification procedure is triggered by a UE-requested PDU session modification procedure upon an inter-system change from S1 mode to N1 mode for a PDN connection established when in S1 mode, the UE shall not consider the modified PDU session as an always-on PDU session; or\nb)\totherwise:\n1)\tif the UE has received the Always-on PDU session indication IE with the value set to \"Always-on PDU session required\" for this PDU session, the UE shall consider the PDU session as an always-on PDU session; or\n2)\totherwise the UE shall not consider the PDU session as an always-on PDU session.\nIf the PDU SESSION MODIFICATION COMMAND message contains a Port management information container IE, the UE shall forward the contents of the Port management information container IE to the DS-TT (see 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a023.502\u00a0[9]).\nIf the UE receives a Serving PLMN rate control IE in the PDU SESSION MODIFICATION COMMAND message, the UE shall store the Serving PLMN rate control IE value, replacing any existing value, and use the stored serving PLMN rate control value as the maximum allowed limit of uplink control plane user data for the corresponding PDU session in accordance with 3GPP\u00a0TS\u00a023.501\u00a0[8].\nIf the PDU SESSION MODIFICATION COMMAND message includes the Received MBS container IE, for each of the Received MBS informations:\na)\tif MBS decision is set to \"MBS join is accepted\", the UE shall consider that it has successfully joined the multicast MBS session. The UE shall store the received TMGI and shall use it for any further operation on that multicast MBS session. The UE shall store the received MBS service area associated with the received TMGI, if any, and provide the received TMGI to lower layers. The UE may provide the MBS start time if it is included in the Received MBS information to upper layers;\nb)\tif MBS decision is set to \"MBS join is rejected\", the UE shall consider the requested join as rejected. The UE shall store the received MBS service area associated with the received TMGI, if any. If the received Rejection cause is set to \"User is outside of local MBS service area\", the UE shall not request to join the same multicast MBS session if neither current TAI nor CGI of the current cell is part of the received MBS service area. If the received Rejection cause is set to \"multicast MBS session has not started or will not start soon\" and an MBS back-off timer value is included with value that indicates neither zero nor deactivated, the UE shall start a back-off timer T3587 with the value provided in the MBS back-off timer value for the received TMGI, and shall not attempt to join the multicast MBS session with the same TMGI, the Source IP address information of the TMGI, or the Destination IP address information of the TMGI until the expiry of T3587. If the MBS back-off timer value indicates that this timer is deactivated, the UE shall not attempt to join the multicast MBS session with the same TMGI until the UE is switched off, the USIM is removed, or the entry in the \"list of subscriber data\" for the current SNPN is updated. If the MBS back-off timer value indicates zero, the UE may attempt to join the MBS session with the same TMGI;\nc)\tif the MBS decision is set to \"Remove UE from multicast MBS session\", the UE shall consider that it has successfully left the multicast MBS session, and if the received Rejection cause is set to \"multicast MBS session is released\", the UE shall consider the multicast MBS session as released. Then the UE shall indicate to lower layers to delete the stored TMGI;\nd)\tif the MBS decision is set to \"MBS service area update\", the UE shall store the received MBS service area associated with the received TMGI and replace the current MBS service area with the received one. or\ne)\tif the MBS decision is set to \"MBS security information update\", the UE shall replace the current MBS security information with the MBS security information received in the MBS security container associated with the received TMGI.\nIf the UE has indicated support for ECS configuration information provisioning in the SESSION ESTABLISHMENT REQUEST message or while in S1 mode, then upon receiving \n-\tone or more ECS IPv4 address(es), ECS IPv6 address(es), ECS FQDN(s); \n-\tone or more associated ECSP identifier(s);and\n-\toptionally spatial validity conditions associated with the ECS address\nin the Extended protocol configuration options IE of the PDU SESSION MODIFICATION COMMAND message, then the UE shall pass them to the upper layers.\nIf the UE supports receiving DNS server addresses in protocol configuration options and receives one or more DNS server IPv4 address(es), one or more DNS server IPv6 address(es) or both of them, in the Extended protocol configuration options IE of the PDU SESSION MODIFICATION COMMAND message, then the UE shall pass the received DNS server IPv4 address(es), if any, and the received DNS server IPv6 address(es), if any, to upper layers.\nNOTE\u00a07:\tThe received DNS server address(es) replace previously provided DNS server address(es), if any.\nIf the UE supports the EAS rediscovery and receives:\na)\tthe EAS rediscovery indication without indicated impact; or\nb)\tthe following:\n1)\tone or more EAS rediscovery indication(s) with impacted EAS IPv4 address range, if supported by the UE;\n2)\tone or more EAS rediscovery indication(s) with impacted EAS IPv6 address range, if supported by the UE;\n3)\tone or more EAS rediscovery indication(s) with impacted EAS FQDN, if supported by the UE; or\n4)\tany combination of the above;\nin the Extended protocol configuration options IE of the PDU SESSION MODIFICATION COMMAND message, then the UE shall pass the EAS rediscovery indication and the received impacted EAS IPv4 address range(s), if supported and included, the received EAS IPv6 address range(s), if supported and included, and the received EAS FQDN(s), if supported and included, to upper layers.\nNOTE\u00a08:\tThe upper layers handle the EAS rediscovery indication and the impacted EAS IPv4 address range(s), if any, the impacted EAS IPv6 address range(s), if any, and the received EAS FQDN(s), if any, according to 3GPP\u00a0TS\u00a023.548\u00a0[10A].\nUpon receipt of PDU SESSION MODIFICATION COMMAND message, if the network-requested PDU session modification procedure is triggered by a UE-requested PDU session modification procedure, the Service-level-AA container IE is included, then the UE shall forward the service-level-AA contents of the Service-level-AA container IE to the upper layers.\nIf the UE supports EDC and receives the EDC usage allowed indicator in the Extended protocol configuration options IE of the PDU SESSION MODIFICATION COMMAND message, the UE shall indicate to upper layers that network allows the use of EDC.\nIf the UE supports EDC and receives the EDC usage required indicator in the Extended protocol configuration options IE of the PDU SESSION MODIFICATION COMMAND message, the UE shall indicate to upper layers that network requires the use of EDC.\nNOTE\u00a09:\tHandling of indication that network allows the use of EDC or that network requires the use of EDC is specified in 3GPP\u00a0TS\u00a023.548\u00a0[182].\nIf the Alternative S-NSSAI IE is included in the PDU SESSION MODIFICATION COMMAND message, the UE shall replace the S-NSSAI or the mapped S-NSSAI associated with the PDU session according to the Alternative S-NSSAI IE. The S-NSSAI for the established PDU session shall be the S-NSSAI to be replaced and the alternative S-NSSAI on the UE side.\nIf the Protocol description IE is included in the PDU SESSION MODIFICATION COMMAND message, the UE shall replace any stored Protocol description with the new received Protocol description, if any, and may use it to identify PDUs belong to PDU sets for the uplink direction.\nNOTE\u00a0YY:\tWhether and how to use the protocol description to identify PDU sets is up to the UE implementation.\nThe UE shall transport the PDU SESSION MODIFICATION COMPLETE message and the PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5.\nAfter sending the PDU SESSION MODIFICATION COMPLETE message, if the \"Create new EPS bearer\" operation code in the Mapped EPS bearer contexts IE was received in the PDU SESSION MODIFICATION COMMAND message and there is neither a corresponding Authorized QoS flow descriptions IE in the PDU SESSION MODIFICATION COMMAND message nor an existing QoS flow description corresponding to the EPS bearer identity included in the mapped EPS bearer context, the UE shall send a PDU SESSION MODIFICATION REQUEST message including a Mapped EPS bearer contexts IE to delete the mapped EPS bearer context.\nAfter sending the PDU SESSION MODIFICATION COMPLETE message, if for the PDU session being modified, there are mapped EPS bearer context(s) but none of them is associated with the default QoS rule, the UE shall locally delete the mapped EPS bearer context(s) and shall locally delete the stored EPS bearer identity (EBI) in all the QoS flow descriptions of the PDU session, if any.\nIf a port management information container needs to be delivered (see 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a023.502\u00a0[9]), the UE shall include a Port management information container IE in the PDU SESSION MODIFICATION COMPLETE message.\nUpon receipt of a PDU SESSION MODIFICATION COMPLETE message, the SMF shall stop timer T3591 and shall consider the PDU session as modified. If the selected SSC mode of the PDU session is \"SSC mode 3\" and the PDU SESSION MODIFICATION COMMAND message included 5GSM cause #39 \"reactivation requested\", the SMF shall start timer T3593. If the PDU Session Address Lifetime value is sent to the UE in the PDU SESSION MODIFICATION COMMAND message then timer T3593 shall be started with the same value, otherwise it shall use a default value. If the PDU SESSION MODIFICATION COMPLETE message contains a Port management information container IE, the SMF shall handle the contents of the Port management information container IE as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a023.502\u00a0[9].\n6.3.2.4\tNetwork-requested PDU session modification procedure not accepted by the UE\nUpon receipt of a PDU SESSION MODIFICATION COMMAND message and a PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5, if the UE rejects the PDU SESSION MODIFICATION COMMAND message, the UE shall create a PDU SESSION MODIFICATION COMMAND REJECT message.\nIf the PDU SESSION MODIFICATION COMMAND message contains the PTI value allocated in the UE-requested PDU session modification procedure, the UE shall stop the timer T3581. The UE should ensure that the PTI value assigned to this procedure is not released immediately.\nNOTE\u00a01:\tThe way to achieve this is implementation dependent. For example, the UE can ensure that the PTI value assigned to this procedure is not released during the time equal to or greater than the default value of timer T3591.\nWhile the PTI value is not released, the UE regards any received PDU SESSION MODIFICATION COMMAND message with the same PTI value as a network retransmission (see subclause\u00a07.3.1).\nThe UE shall set the 5GSM cause IE of the PDU SESSION MODIFICATION COMMAND REJECT message to indicate the reason for rejecting the PDU session modification.\nThe 5GSM cause IE typically indicates one of the following 5GSM cause values:\n#26\tinsufficient resources;\n#44\tsemantic error in packet filter(s);\n#45\tsyntactical error in packet filter(s);\n#83\tsemantic error in the QoS operation; or\n#84\tsyntactical error in the QoS operation.\nIf the selected SSC mode of the PDU session is \"SSC mode 3\" and the PDU SESSION MODIFICATION COMMAND messages includes 5GSM cause #39 \"reactivation requested\", while the UE does not have sufficient resources for initiating the PDU session establishment procedure as specified in subclause\u00a06.4.1 then the UE shall set cause IE to #26 \"insufficient resources\".\nIf the PDU SESSION MODIFICATION COMMAND message includes a request to add a new authorized QoS rule, or a request to modify the authorized QoS rules, or both, and the UE decides to reject the request due to e.g. the supported number of authorized QoS rules or number of packet filters associated with a PDU session having reached the maximum number, then the UE shall set the 5GSM cause IE to #26 \"insufficient resources\".\nNOTE\u00a02:\tThe maximum number of supported authorized QoS rules or packet filters associated with a PDU session is implementation specific.\nIf the PDU SESSION MODIFICATION COMMAND message includes a request to add a new authorized QoS flow description, or a request to modify the authorized QoS flow descriptions, or both and the UE decides to reject the request due to e.g. the supported number of authorized QoS flow descriptions, then the UE shall set the 5GSM cause IE to #26 \"insufficient resources\".\nNOTE\u00a03:\tThe maximum number of supported authorized QoS flow descriptions associated with a PDU session is implementation specific.\nIf the PDU SESSION MODIFICATION COMMAND message includes the Authorized QoS rules IE, the UE shall process the QoS rules sequentially starting with the first QoS rule. The UE shall check the QoS rule and the QoS flow description provided in the PDU SESSION MODIFICATION COMMAND message for different types of errors as follows:\nNOTE\u00a04:\tIf an error is detected in a QoS rule or a QoS flow description which requires rejecting the PDU SESSION MODIFICATION COMMAND message, then the Authorized QoS rules IE, the Authorized QoS flow descriptions IE, the Mapped EPS bearer contexts IE and any other IE (RQ timer value IE, Always-on PDU session indication IE, etc) included in the PDU SESSION MODIFICATION COMMAND message are discarded, if any.\na)\tSemantic errors in QoS operations:\n1)\tWhen the rule operation is \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters\" or \"Modify existing QoS rule without modifying packet filters\" on the default QoS rule and the DQR bit is set to \"the QoS rule is not the default QoS rule\".\n2)\tWhen the rule operation is \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters\" or \"Modify existing QoS rule without modifying packet filters\" on a QoS rule which is not the default QoS rule and the DQR bit is set to \"the QoS rule is the default QoS rule\".\n3)\tWhen the rule operation is \"Create new QoS rule\" and the DQR bit is set to \"the QoS rule is the default QoS rule\" when there's already a default QoS rule with different QoS rule identifier.\n4)\tWhen the rule operation is \"Delete existing QoS rule\" on the default QoS rule.\n5)\tWhen the rule operation is \"Create new QoS rule\", \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters \", or \"Modify existing QoS rule without modifying packet filters\" and two or more QoS rules associated with this PDU session would have identical precedence values, and the UE is not in NB-N1 mode.\n6)\tWhen the rule operation is \"Modify existing QoS rule and delete packet filters\", the QoS rule is a QoS rule of a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type, and the packet filter list in the resultant QoS rule is empty.\n7)\tWhen the rule operation is \"Create new QoS rule\", there is already an existing QoS rule with the same QoS rule identifier and the UE is not in NB-N1 mode.\n8)\tWhen the rule operation is \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters\" or \"Modify existing QoS rule without modifying packet filters\", the associated QoS rule does not exist and the UE is not in NB-N1 mode.\n9)\tWhen the rule operation is different than \"Delete existing QoS rule\", the DQR bit of the QoS rule is set to \"the QoS rule is not the default QoS rule\" and the UE is in NB-N1 mode.\n10)\tWhen the rule operation is \"Create new QoS rule\", the DQR bit is set to \"the QoS rule is not the default QoS rule\", and the PDU session type of the PDU session is \"Unstructured\".\n11)\tWhen the rule operation is \"Delete existing QoS rule\" and there is no existing QoS rule with the same QoS rule identifier.\n12)\tWhen the flow description operation is \"Create new QoS flow description\", there is already an existing QoS flow description with the same QoS flow identifier and the UE is not in NB-N1 mode.\n13)\tWhen the flow description operation is \"Modify existing QoS flow description\", the associated QoS flow description does not exist and the UE is not in NB-N1 mode.\n14)\tWhen the flow description operation is \"Delete existing QoS flow description\" and there is no existing QoS flow description with the same QoS flow identifier.\n15)\tWhen the flow description operation is different than \"Delete existing QoS flow description\", the QFI is not the same as the QFI of the default QoS rule and the UE is in NB-N1 mode.\n16)\tWhen the flow description operation is \"Create new QoS flow description\" or \"Modify existing QoS flow description\", the QFI associated with the QoS flow description is not the same as the QFI of the default QoS rule, and the PDU session type of the PDU session is \"Unstructured\".\n17)\tWhen the rule operation is \"Modify existing QoS rule and add packet filters\", the \"packet filter list\" field contains a match-all packet filter, the resultant QoS rule is the default QoS rule and there is already an existing match-all packet filter associated with the default QoS rule.\n18)\tWhen the rule operation is \"Create new QoS rule\" and the DQR bit is set to \"the QoS rule is not the default QoS rule\", or the rule operation is \"Modify existing QoS rule and add packet filters\" on a QoS rule which is not the default QoS rule or \"Modify existing QoS rule and replace all packet filters\" on a QoS rule which is not the default QoS rule, and one match-all packet filter is to be associated with the resultant QoS rule.\n\tIn case 4, the UE shall initiate a PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #83 \"semantic error in the QoS operation\".\n\tIn case 5, if the old QoS rule (i.e. the QoS rule that existed before the PDU SESSION MODIFICATION COMMAND message was received) is not the default QoS rule, the UE shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old QoS rule which has identical precedence value. Furthermore, after sending the PDU SESSION MODIFICATION COMPLETE for the ongoing PDU session modification procedure, the UE shall send a PDU SESSION MODIFICATION REQUEST message with 5GSM cause #83 \"semantic error in the QoS operation\" to delete the QoS rule.\n\tIn case 5, if the old QoS rule (i.e. the QoS rule that existed before the PDU SESSION MODIFICATION COMMAND message was received) is the default QoS rule, the UE shall initiate a PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #83 \"semantic error in the QoS operation\".\n\tIn case 6, if the QoS rule is not the default QoS rule, after sending the PDU SESSION MODIFICATION COMPLETE for the ongoing PDU session modification procedure, the UE shall send a PDU SESSION MODIFICATION REQUEST message with 5GSM cause #83 \"semantic error in the QoS operation\" to delete the QoS rule.\n\tIn case 6, if the QoS rule is the default QoS rule, the UE shall initiate a PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #83 \"semantic error in the QoS operation\".\n\tIn case 7, if the existing QoS rule is not the default QoS rule and the DQR bit of the new QoS rule is set to \"the QoS rule is not the default QoS rule\", the UE shall not diagnose an error, further process the create request and, if it was processed successfully, delete the old QoS rule (i.e. the QoS rule that existed when case 7 was detected). If the existing QoS rule is the default QoS rule or the DQR bit of the new QoS rule is set to \"the QoS rule is the default QoS rule\", the UE shall reject the PDU SESSION MODIFICATION COMMAND message with 5GSM cause #83 \"semantic error in the QoS operation\".\n\tIn case 9 or case 10, after sending the PDU SESSION MODIFICATION COMPLETE for the ongoing PDU session modification procedure, the UE shall send a PDU SESSION MODIFICATION REQUEST message with 5GSM cause #83 \"semantic error in the QoS operation\" to delete the QoS rule.\n\tIn case 11, the UE shall not diagnose an error, further process the delete request and, if it was processed successfully, consider the respective QoS rule as successfully deleted.\n\tIn case 12, the UE shall not diagnose an error, further process the create request and, if it was processed successfully, delete the old QoS flow description (i.e. the QoS flow description that existed when case 12 was detected).\n\tIn case 14, the UE shall not diagnose an error, further process the delete request and, if it was processed successfully, consider the respective QoS flow description as successfully deleted.\n\tIn case 15 or case 16, after sending the PDU SESSION MODIFICATION COMPLETE for the ongoing PDU session modification procedure, the UE shall send a PDU SESSION MODIFICATION REQUEST message with 5GSM cause #83 \"semantic error in the QoS operation\" to delete the QoS flow description.\n\tOtherwise, the UE shall reject the PDU SESSION MODIFICATION COMMAND message with 5GSM cause #83 \"semantic error in the QoS operation\".\nb)\tSyntactical errors in QoS operations:\n1)\tWhen the rule operation is \"Create new QoS rule\", \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\" or \"Modify existing QoS rule and delete packet filters\", the PDU session type of the PDU session is IPv4, IPv6, IPv4v6 or Ethernet PDU session type, and the packet filter list in the QoS rule is empty.\n2)\tWhen the rule operation is \"Delete existing QoS rule\" or \"Modify existing QoS rule without modifying packet filters\" with a non-empty packet filter list in the QoS rule.\n3)\tWhen the rule operation is \"Modify existing QoS rule and delete packet filters\" and the packet filter to be deleted does not exist in the original QoS rule.\n4)\tVoid.\n5)\tWhen there are other types of syntactical errors in the coding of the Authorized QoS rules IE or the Authorized QoS flow descriptions IE, such as: a mismatch between the number of packet filters subfield and the number of packet filters in the packet filter list when the rule operation is \"delete existing QoS rule\" or \"create new QoS rule\", or the number of packet filters subfield is larger than the maximum possible number of packet filters in the packet filter list (i.e., there is no QoS rule precedence subfield included in the QoS rule IE), the QoS Rule Identifier is set to \"no QoS rule identifier assigned\" when the rule operation is not \"delete existing QoS rule\", or the QoS flow identifier is set to \"no QoS flow identifier assigned\" when the flow description operation is not \"Delete existing QoS flow description\".\n6)\tWhen the rule operation is \"Modify existing QoS rule and add packet filters\" or \"Modify existing QoS rule and replace all packet filters\", the DQR bit is set to \"the QoS rule is the default QoS rule\", the PDU session type of the PDU session is \"Unstructured\", and the packet filter list in the QoS rule is not empty.\n7)\tWhen, the\nA)\trule operation is \"Create new QoS rule\", \"Modify existing QoS rule and add packet filters\", \"Modify existing QoS rule and replace all packet filters\", \"Modify existing QoS rule and delete packet filters\" or \"Modify existing QoS rule without modifying packet filters\", there is no QoS flow description with a QFI corresponding to the QFI of the resulting QoS rule and the UE determines, by using the QoS rule\u2019s QFI as the 5QI, that there is a resulting QoS rule for a GBR QoS flow (as described in 3GPP\u00a0TS\u00a023.501\u00a0[8] table\u00a05.7.4-1).\nB)\tflow description operation is \"Delete existing QoS flow description\", and the UE determines, by using the QoS rule\u2019s QFI as the 5QI, that there is a resulting QoS rule for a GBR QoS flow (as described in 3GPP\u00a0TS\u00a023.501\u00a0[8] table\u00a05.7.4-1) with a QFI corresponding to the QFI of the QoS flow description that is deleted (i.e. there is no associated QoS flow description with the same QFI).\n8)\tWhen the flow description operation is \"Create new QoS flow description\" or \"Modify existing QoS flow description\", and the UE determines that there is a QoS flow description of a GBR QoS flow (as described in 3GPP TS 23.501 [8] table 5.7.4-1) which lacks at least one of the mandatory parameters (i.e., GFBR uplink, GFBR downlink, MFBR uplink and MFBR downlink). If the QoS flow description does not include a 5QI, the UE determines this by using the QFI as the 5QI,\n\tIn case 3 the UE shall not diagnose an error, further process the deletion request and, if no error according to items c and d was detected, consider the respective packet filter as successfully deleted.\n\tIn case 6, after completion of the PDU session modification procedure, the UE shall send a PDU SESSION MODIFICATION REQUEST message with 5GSM cause #84 \"syntactical error in the QoS operations\" to delete all the packet filters for the default QoS rule.\n\tIn case 7, if the Authorized QoS rules IE contains at least one other valid QoS rule, the UE shall not diagnose an error and shall further process the request, if no error according to items c and d was detected. After completion of the PDU session modification procedure, if the resulting QoS rule for a GBR QoS flow which has no QoS flow description is the default QoS rule, the UE shall initiate a PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #84 \"syntactical error in the QoS operation\". Otherwise, the UE shall delete the QoS rule for which no corresponding QoS flow description is available and initiate UE-requested PDU session modification procedure with 5GSM cause #84 \"syntactical error in the QoS operation\" to delete the QoS rule for which it has deleted.\n\tIn case 8, if the default QoS rule is associated with the QoS flow description which lacks at least one of the mandatory parameters, the UE shall initiate a PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #84 \"syntactical error in the QoS operation\". Otherwise, if the Authorized QoS rules IE contains at least one other valid QoS rule or the QoS flow description IE contains at least one other valid QoS flow description, the UE shall not diagnose an error and shall further process the request, if no error according to items c and d was detected. After completion of the PDU session modification procedure, the UE shall delete the QoS flow description which lacks at least one of the mandatory parameters and the associated QoS rule(s), if any, and initiate UE-requested PDU session modification procedure with 5GSM cause #84 \"syntactical error in the QoS operation\" to delete the QoS flow description and the associated QoS rule(s), if any, which it has deleted.\n\tOtherwise the UE shall reject the PDU SESSION MODIFICATION COMMAND message with 5GSM cause #84 \"syntactical error in the QoS operation\".\nNOTE\u00a05:\tIt is not considered an error if the UE determines that after processing all QoS operations on QoS rules and QoS flow descriptions there is a QoS flow description that is not associated with any QoS rule and the UE is not in NB-N1 mode.\nNOTE\u00a05a:\tAn implementation that strictly follows QoS rule operation as defined in subclause\u00a09.11.4.13 might not detect case 2).\nc)\tSemantic errors in packet filters:\n1)\tWhen a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.\n\tThe UE shall reject the PDU SESSION MODIFICATION COMMAND message with 5GSM cause #44 \"semantic error in packet filter(s)\".\nd)\tSyntactical errors in packet filters:\n1)\tWhen the rule operation is \"Create new QoS rule\", \"Modify existing QoS rule and add packet filters\" or \"Modify existing QoS rule and replace all packet filters\", and two or more packet filters in the resultant QoS rule would have identical packet filter identifiers.\n2)\tWhen there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.\n\tIn case 1, if two or more packet filters with identical packet filter identifiers are contained in the PDU SESSION MODIFICATION COMMAND message, the UE shall reject the PDU SESSION MODIFICATION COMMAND with 5GSM cause #45 \"syntactical errors in packet filter(s)\". Otherwise, the UE shall not diagnose an error, further process the PDU SESSION MODIFICATION COMMAND message and, if it was processed successfully, replace the old packet filter with the new packet filter which have the identical packet filter identifiers.\n\tOtherwise the UE shall reject the PDU SESSION MODIFICATION COMMAND message with 5GSM cause #45 \"syntactical errors in packet filter(s)\".\nIf:\na)\tthe UE detects errors in QoS rules that require to delete at least one QoS rule as described above which requires sending a PDU SESSION MODIFICATION REQUEST message to delete the erroneous mapped EPS bearer contexts; and\nb)\toptionally, if the UE detects different errors in the mapped EPS bearer contexts as described in subclause\u00a06.3.2.3 which requires sending a PDU SESSION MODIFICATION REQUEST message to delete the erroneous QoS rules;\nthe UE, after sending the PDU SESSION MODIFICATION COMPLETE message for the ongoing PDU session modification procedure, may send a single PDU SESSION MODIFICATION REQUEST message to delete the erroneous QoS rules, and optionally to delete the erroneous mapped EPS bearer contexts. The UE shall include a 5GSM cause IE in the PDU SESSION MODIFICATION REQUEST message.\nNOTE\u00a06:\tThe 5GSM cause to use cannot be different from #41 \"semantic error in the TFT operation\", #42 \"syntactical error in the TFT operation\", #44 \"semantic error in packet filter(s)\", #45 \"syntactical errors in packet filter(s)\", #83 \"semantic error in the QoS operation\", #84 \"syntactical error in the QoS operation\", or #85 \"Invalid mapped EPS bearer identity\". The selection of a 5GSM cause is up to UE implementation.\nThe UE shall transport the PDU SESSION MODIFICATION COMMAND REJECT message and the PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5.\nUpon receipt of a PDU SESSION MODIFICATION COMMAND REJECT message with 5GSM cause value in state PDU SESSION MODIFICATION PENDING, the SMF shall stop timer T3591, enter the state PDU SESSION ACTIVE and abort the PDU session modification procedure.\n6.3.2.5\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3591.\n\tOn the first expiry of the timer T3591, the SMF shall resend the PDU SESSION MODIFICATION COMMAND message and shall reset and restart timer T3591. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3591, the SMF shall abort the procedure and enter the state PDU SESSION ACTIVE.\n\tThe SMF may continue to use the previous configuration of the PDU session or initiate the network-requested PDU session release procedure. If the SMF decides to continue to use the previous configuration of the PDU session and\ni)\tthe Authorized QoS rules IE is included in the PDU SESSION MODIFICATION COMMAND message, the SMF may mark the corresponding authorized QoS rule(s) of the PDU session as to be synchronised with the UE; and\nii)\tthe Authorized QoS flow descriptions IE is included in the PDU SESSION MODIFICATION COMMAND message, the SMF may mark the corresponding authorized QoS flow description(s) of the PDU session as to be synchronised with the UE.\nb)\tVoid.\nc)\tCollision of UE-requested PDU session release procedure and network-requested PDU session modification procedure.\n\tIf the SMF receives a PDU SESSION RELEASE REQUEST message during the network-requested PDU session modification procedure, and the PDU session indicated in the PDU SESSION RELEASE REQUEST message is the PDU session that the SMF had requested to modify, the SMF shall abort the PDU session modification procedure and proceed with the UE-requested PDU session release procedure.\nd)\tCollision of UE-requested PDU session modification procedure and network-requested PDU session modification procedure.\n\tIf the network receives a PDU SESSION MODIFICATION REQUEST message during the network-requested PDU session modification procedure, and the PDU session indicated in the PDU SESSION MODIFICATION REQUEST message is the PDU session that the network had requested to modify, the network shall:\ni)\tif the PDU SESSION MODIFICATION REQUEST message includes connection capabilities, ignore the PDU SESSION MODIFICATION REQUEST message received in the state PDU SESSION MODIFICATION PENDING except for the connection capabilities and proceed with the network-requested PDU session modification procedure; or\nii)\totherwise, ignore the PDU SESSION MODIFICATION REQUEST message received in the state PDU SESSION MODIFICATION PENDING and proceed with the network-requested PDU session modification procedure as if no PDU SESSION MODIFICATION REQUEST message was received from the UE.\ne)\t5G access network cannot forward the message.\n\tIf the SMF determines based on content of the n2SmInfo attribute specified in 3GPP\u00a0TS\u00a029.502\u00a0[20A] that the DL NAS TRANSPORT message carrying the PDU SESSION MODIFICATION COMMAND message was not forwarded to the UE by the 5G access network, then the SMF shall abort the procedure and enter the state PDU SESSION ACTIVE.\nf)\t5G access network cannot forward the message due to handover.\n\tIf the SMF determines based on content of the n2SmInfo attribute specified in 3GPP\u00a0TS\u00a029.502\u00a0[20A] that the DL NAS TRANSPORT message carrying the PDU SESSION MODIFICATION COMMAND message was not forwarded to the UE by the 5G access network due to handover, then the SMF shall abort the procedure and enter the state PDU SESSION ACTIVE.\n\tThe SMF may re-initiate, up to a pre-configured number of times, the network-requested PDU session modification procedure when the SMF detects that the handover is completed successfully or has failed or at the expiry of the configured guard timer as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9].\ng)\tCollision of re-establishment of the user-plane resources and network-requested PDU session modification procedure for the same PDU session.\n\tIf the SMF receives an indication from the AMF to re-establish the user-plane resources during the network-requested PDU session modification procedure for the same PDU session, the network shall abort the network-requested PDU session modification procedure and proceed with re-establishment of the user-plane resources for the PDU session as specified in 3GPP\u00a0TS\u00a029.502\u00a0[20A] subclause\u00a05.2.2.3.2.2.\nNOTE:\tAfter the completion of re-establishment of the user-plane resources for the PDU session, the SMF can re-initiate the network-requested PDU session modification procedure for the PDU session.\nh)\tCollision of UE-requested PDU session establishment procedure and network-requested PDU session modification procedure.\n\tIf the network receives a PDU SESSION ESTABLISHMENT REQUEST message with request type set to \"existing PDU session\" or \"existing emergency PDU session\" during the network-requested PDU session modification procedure, and the PDU session ID indicated in the PDU SESSION ESTABLISHMENT REQUEST message is the PDU session that the network had requested to modify, the network shall abort the network-requested PDU session modification procedure and proceed with the UE-requested PDU session establishment procedure.\n6.3.2.6\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tPDU session inactive for the received PDU session ID.\n\tIf the PDU session ID in the PDU SESSION MODIFICATION COMMAND message belongs to any PDU session in state PDU SESSION INACTIVE in the UE, the UE shall set the 5GSM cause IE to #43 \"Invalid PDU session identity\" in the 5GSM STATUS message, and set the PDU session ID to the received PDU session ID in the UL NAS TRANSPORT message as specified in subclause\u00a05.4.5.\nb)\tCollision of network-requested PDU session modification procedure and UE-requested PDU session modification procedure.\n\tIf the UE receives a PDU SESSION MODIFICATION COMMAND message during the UE-requested PDU session modification procedure, the PTI IE of the PDU SESSION MODIFICATION COMMAND message is set to \"No procedure transaction identity assigned\", and the PDU session indicated in the PDU SESSION MODIFICATION COMMAND message is the PDU session that the UE had requested to modify, the UE shall abort internally the UE-requested PDU session modification procedure, enter the state PDU SESSION ACTIVE and proceed with the network-requested PDU session modification procedure.\nc)\tA semantic error in QoS operations or a sematic error in packet filters is detected in a PDU SESSION MODIFICATION COMMAND message that contains other optional information elements.\n\tIf the UE diagnoses a semantic error in QoS operations or a semantic error in packet filters in the PDU SESSION MODIFICATION COMMAND, as specified in subclause\u00a06.3.2.4, and the message contains other optional information elements, the UE shall discard the other optional information elements and shall send the PDU SESSION MODIFICATION REJECT message as specified in subclause\u00a06.3.2.4. \n6.3.3\tNetwork-requested PDU session release procedure\n6.3.3.1\tGeneral\nThe purpose of the network-requested PDU session release procedure is to enable the network to release a PDU session or the user-plane resources on a single access of an MA PDU session.\n6.3.3.2\tNetwork-requested PDU session release procedure initiation\nIn order to initiate the network-requested PDU session release procedure, the SMF shall create a PDU SESSION RELEASE COMMAND message.\nThe SMF shall set the 5GSM cause IE of the PDU SESSION RELEASE COMMAND message to indicate the reason for releasing the PDU session.\nThe 5GSM cause IE typically indicates one of the following 5GSM cause values:\n#8\toperator determined barring;\n#26\tinsufficient resources;\n#29\tuser authentication or authorization failed;\n#36\tregular deactivation;\n#38\tnetwork failure;\n#39\treactivation requested;\n#46\tout of LADN service area;\n#67\tinsufficient resources for specific slice and DNN;\n#69\tinsufficient resources for specific slice.\nIf the selected SSC mode of the PDU session is \"SSC mode 2\" and the SMF requests the relocation of SSC mode 2 PDU session anchor with different PDU sessions as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9], the SMF shall include 5GSM cause #39\u00a0\"reactivation requested\". If the selected SSC mode of the PDU session is \"SSC mode 2\" or \"SSC mode 1\", the S-NSSAI or the mapped S-NSSAI of the PDU session needs to be replaced, the SMF shall include the Alternative S-NSSAI IE and 5GSM cause #39\u00a0\"reactivation requested\" in the PDU SESSION RELEASE COMMAND message. If the selected SSC mode of the PDU session is \"SSC mode 2\" or \"SSC mode 1\", S-NSSAI which has been replaced is available and the SMF determines that the PDU session needs to be re-established on the S-NSSAI which has been replaced, the SMF shall include and 5GSM cause #39\u00a0\"reactivation requested\" and S-NSSAI which has been replaced in the PDU SESSION RELEASE COMMAND.\nNOTE\u00a01:\tThe relocation of SSC mode 2 PDU session anchor with different PDU sessions can also be initiated by the SMF in case of the SMF is requested by the AMF to release the PDU session due to the network slice instance of the PDU session is changed as specified in subclause\u00a05.15.5.3 of 3GPP\u00a0TS\u00a023.501\u00a0[8]. \nIf the network-requested PDU session release procedure is triggered by a UE-requested PDU session release procedure, the SMF shall set the PTI IE of the PDU SESSION RELEASE COMMAND message to the PTI of the PDU SESSION RELEASE REQUEST message received as part of the UE-requested PDU session release procedure and shall not include the Access type IE in the PDU SESSION RELEASE COMMAND.\nIf the network-requested PDU session release procedure is not triggered by a UE-requested PDU session release procedure, the SMF shall set the PTI IE of the PDU SESSION RELEASE COMMAND message to \"No procedure transaction identity assigned\".\nIf the PDU session ID included in PDU SESSION RELEASE COMMAND message is associated with one or more multicast MBS sessions and either the Access type IE is not included or the Access type IE indicates \"3GPP access\", the SMF shall consider the UE as removed from the associated multicast MBS sessions.\nBased on the local policy and user's subscription data, if the SMF decides to release the PDU session after determining:\na)\tthe UE has moved between a tracking area in NB-N1 mode and a tracking area in WB-N1 mode;\nb)\tthe UE has moved between a tracking area in NB-S1 mode and a tracking area in WB-N1 mode;\nc)\tthe UE has moved between a tracking area in WB-S1 mode and a tracking area in NB-N1 mode; or\nd)\ta PDU session is not only for control plane CIoT 5GS optimization any more,\nthe SMF shall:\na)\tinclude the 5GSM cause value #39 \"reactivation requested\" in the 5GSM cause IE of the PDU SESSION RELEASE COMMAND message; or\nb)\tinclude a 5GSM cause value other than #39 \"reactivation requested\" in the 5GSM cause IE of the PDU SESSION RELEASE COMMAND message.\nNOTE\u00a02:\tThe included 5GSM cause value is up to the network implementation.\nIf the SMF receives UE presence in LADN service area from the AMF indicating that the UE is out of the LADN service area and the SMF decides to release the PDU session, the SMF shall include the 5GSM cause value #46 \"out of LADN service area\" in the 5GSM cause IE of the PDU SESSION RELEASE COMMAND message. Upon receipt of the 5GSM cause value #46 \"out of LADN service area\" in the 5GSM cause IE of the PDU SESSION RELEASE COMMAND message, the UE shall release the PDU session.\nThe SMF may include a Back-off timer value IE in the PDU SESSION RELEASE COMMAND message when the 5GSM cause value #26 \"insufficient resources\" is included in the PDU SESSION RELEASE COMMAND message. If the 5GSM cause value is #26 \"insufficient resources\" and the PDU SESSION RELEASE COMMAND message is sent to a UE configured for high priority access in selected PLMN or SNPN or the request type was set to \"initial emergency request\" or \"existing emergency PDU session\" for the establishment of the PDU session, the network shall not include a Back-off timer value IE.\nThe SMF may include a Back-off timer value IE in the PDU SESSION RELEASE COMMAND message when the 5GSM cause value #67 \"insufficient resources for specific slice and DNN\" is included in the PDU SESSION RELEASE COMMAND message. If the 5GSM cause value is #67 \"insufficient resources for specific slice and DNN\" and the PDU SESSION RELEASE COMMAND message is sent to a UE configured for high priority access in selected PLMN or SNPN or the request type was set to \"initial emergency request\" or \"existing emergency PDU session\" for the establishment of the PDU session, the network shall not include a Back-off timer value IE.\nThe SMF may include a Back-off timer value IE in the PDU SESSION RELEASE COMMAND message when the 5GSM cause #69 \"insufficient resources for specific slice\" is included in the PDU SESSION RELEASE COMMAND message. If the 5GSM cause value is #69 \"insufficient resources for specific slice\" and the PDU SESSION RELEASE COMMAND message is sent to a UE configured for high priority access in selected PLMN or SNPN or the request type was set to \"initial emergency request\" or \"existing emergency PDU session\" for the establishment of the PDU session, the network shall not include a Back-off timer value IE.\nThe SMF should include a Back-off timer value IE in the PDU SESSION RELEASE COMMAND message when the 5GSM cause value #29 \"user authentication or authorization failed\" is included in the PDU SESSION RELEASE COMMAND message.\nIf the service-level-AA procedure is triggered for the established PDU session for UAS services with re-authentication purpose, and the SMF is informed by the UAS-NF that UUAA-SM is unsuccessful or if the SMF receives UUAA revocation notification message from the UAS-NF as described in 3GPP\u00a0TS\u00a023.256\u00a0[6AB], the SMF shall transmit the PDU SESSION RELEASE COMMAND message to the UE, including:\na)\tthe service-level-AA response in the Service-level-AA container IE, with the SLAR field set to the value of \"Service level authentication and authorization was not successful or service level authorization is revoked\"; and\nb)\tthe 5GSM cause value #29 \"user authentication or authorization failed\" in the 5GSM cause IE of the PDU SESSION RELEASE COMMAND message.\nIf the PDU session was established for C2 communication and the SMF is informed by UAS-NF that C2 authorization is revoked, the SMF shall include:\na)\tthe service-level-AA response with the value of the C2AR field set to the \"C2 authorization was not successful or C2 authorization is revoked\" in the service-level-AA container IE of the PDU SESSION RELEASE COMMAND message, and\nb)\tthe 5GSM cause value #29 \"user authentication or authorization failed\" in the 5GSM cause IE of the PDU SESSION RELEASE COMMAND message.\nThe SMF shall send:\na)\tthe PDU SESSION RELEASE COMMAND message; and\nb)\tthe N1 SM delivery skip allowed indication:\n1)\tif the SMF allows the AMF to skip sending the N1 SM container to the UE and the 5GSM cause IE is not set to #39\u00a0\"reactivation requested\"; or\n2)\tif the SMF allows the AMF to skip sending the N1 SM container to the UE and the Access type IE is not included\ntowards the AMF, and the SMF shall start timer T3592 (see example in figure\u00a06.3.3.2.1).\n\nFigure\u00a06.3.3.2.1: Network-requested PDU session release procedure\n6.3.3.3\tNetwork-requested PDU session release procedure accepted by the UE\nFor a single access PDU session, upon receipt of a PDU SESSION RELEASE COMMAND message and a PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5, the UE considers the PDU session as released and the UE shall create a PDU SESSION RELEASE COMPLETE message.\nFor an MA PDU session, upon receipt of the PDU SESSION RELEASE COMMAND message, the UE shall behave as follows:\na)\tif the PDU SESSION RELEASE COMMAND message includes the Access type IE and the MA PDU session has user-plane resources established on both 3GPP access and non-3GPP access, the UE shall consider the user-plane resources on the access indicated in the Access type IE as released and shall create a PDU SESSION RELEASE COMPLETE message. If the Access type IE indicates \"3GPP access\" and there is one or more multicast MBS sessions associated with the MA PDU session, the UE shall locally leave these associated multicast MBS sessions;\nb)\tif the PDU SESSION RELEASE COMMAND message includes the Access type IE and the MA PDU session has user-plane resources established on only the access indicated in the Access type IE, the UE shall consider the MA PDU session as released and shall create a PDU SESSION RELEASE COMPLETE message; and\nc)\tif the PDU SESSION RELEASE COMMAND message does not include the Access type IE, the UE shall consider the MA PDU session as released and shall create a PDU SESSION RELEASE COMPLETE message.\nIf the UE supports network slice usage control:\na)\tall PDU session associated with an on-demand S-NSSAI are released and there is no MA PDU session associated with this on-demand S-NSSAI, the UE shall start the slice deregistration inactivity timer for this on-demand S-NSSAI over the corresponding access type;\nb)\tall MA PDU session associated with an on-demand S-NSSAI are released and there is no PDU session associated with this on-demand S-NSSAI, the UE shall start the slice deregistration inactivity timer for this on-demand S-NSSAI over both 3GPP access and non-3GPP access; or\nc)\tall PDU session and all MA PDU session associated with an on-demand S-NSSAI are released, the UE shall start the slice deregistration inactivity timer for this on-demand S-NSSAI over both 3GPP access and non-3GPP access.\nIf there is one or more multicast MBS sessions associated with the PDU session the UE considers as released, the UE shall locally leave these associated multicast MBS sessions.\nIf the PDU SESSION RELEASE COMMAND message contains the PTI value allocated in the UE-requested PDU session release procedure, the UE shall stop the timer T3582. The UE should ensure that the PTI value assigned to this procedure is not released immediately.\nNOTE\u00a01:\tThe way to achieve this is implementation dependent. For example, the UE can ensure that the PTI value assigned to this procedure is not released during the time equal to or greater than the default value of timer T3592.\nWhile the PTI value is not released, the UE regards any received PDU SESSION RELEASE COMMAND message with the same PTI value as a network retransmission (see subclause\u00a07.3.1).\nIf the PDU SESSION RELEASE COMMAND message includes 5GSM cause #39 \"reactivation requested\", then after completion of the network-requested PDU session release procedure, the UE should re-initiate the UE-requested PDU session establishment procedure as specified in subclause\u00a06.4.1 for:\na)\tthe PDU session type associated with the released PDU session;\nb)\tthe SSC mode associated with the released PDU session;\nc)\tthe DNN associated with the released PDU session; and\nd)\tthe S-NSSAI associated with (if available in roaming scenarios) a mapped S-NSSAI if provided in the UE-requested PDU session establishment procedure of the released PDU session. If the PDU SESSION RELEASE COMMAND message contains the Alternative S-NSSAI IE, the UE shall include both the S-NSSAI to be replaced and the alternative S-NSSAI during the UE-requested PDU session establishment procedure.\nNOTE\u00a02:\tUser interaction is necessary in some cases when the UE cannot re-initiate the UE-requested PDU session establishment procedure automatically.\nIf the PDU SESSION RELEASE COMMAND message is received without the Back-off timer value IE or includes 5GSM cause\u00a0#39 \"reactivation requested\", and the UE provided an S-NSSAI during the PDU session establishment, the UE shall stop timer T3585 if it is running for the S-NSSAI of the PDU session. If the UE did not provide an S-NSSAI during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop the timer T3585 associated with no S-NSSAI if it is running. If the PDU SESSION RELEASE COMMAND message was received for an emergency PDU session, the UE shall not stop the timer T3585 associated with no S-NSSAI if it is running. The timer T3585 to be stopped includes:\na)\tin a PLMN:\n1)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running;\n2)\tthe timer T3585 applied for all the PLMNs and for both 3GPP access type and non-3GPP access type, if running;\n3)\tthe timer T3585 applied for the registered PLMN and for the access over which the PDU SESSION RELEASE COMMAND is received, if running; and\n4)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\nb)\tin an SNPN:\n1)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\n2)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\n3)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\n4)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\nIf the PDU SESSION RELEASE COMMAND message is received without the Back-off timer value IE or includes 5GSM cause\u00a0#39 \"reactivation requested\", and the UE provided a DNN during the PDU session establishment, the UE shall stop timer T3396 if it is running for the DNN provided by the UE. If the UE did not provide a DNN during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop the timer T3396 associated with no DNN if it is running. If the PDU SESSION RELEASE COMMAND message was received for an emergency PDU session, the UE shall not stop the timer T3396 associated with no DNN if it is running. In an SNPN, the timer T3396 to be stopped includes:\na)\tthe timer T3396 applied for all the equivalent SNPNs, associated with the RSNPN or an equivalent SNPN, and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nb)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN, and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\nIf the PDU SESSION RELEASE COMMAND message is received without the Back-off timer value IE or includes 5GSM cause\u00a0#39 \"reactivation requested\", and the UE provided an S-NSSAI and a DNN during the PDU session establishment, the UE shall stop timer T3584 if it is running for the [S-NSSAI of the PDU session, DNN] combination provided by the UE. If the UE did not provide an S-NSSAI during the PDU session establishment, the UE shall stop the timer T3584 associated with [no S-NSSAI, DNN] if it is running. If the UE did not provide a DNN during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop the timer T3584 associated with [S-NSSAI of the PDU session, no DNN] combination, if it is running. If the PDU SESSION RELEASE COMMAND message was received for an emergency PDU session, the UE shall not stop the timer T3584 associated with [S-NSSAI of the PDU session, no DNN] if it is running. If the UE provided neither a DNN nor an S-NSSAI during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop the timer T3584 associated with [no S-NSSAI, no DNN] if it is running. If the PDU SESSION RELEASE COMMAND message was received for an emergency PDU session, the UE shall not stop the timer T3584 associated with [no S-NSSAI, no DNN] if it is running. The timer T3584 to be stopped includes:\na)\tin a PLMN:\n1)\tthe timer T3584 applied for all the PLMNs, if running; and\n2)\tthe timer T3584 applied for the registered PLMN, if running; or\nb)\tin an SNPN:\n1)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\n2)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\nNOTE\u00a03:\tIf the PDU SESSION RELEASE COMMAND message is received without the Back-off timer value IE or includes 5GSM cause\u00a0#39 \"reactivation requested\" for a PDU session, the UE provided a DNN (or no DNN) and an S-NSSAI (or no S-NSSAI) when the PDU session is established, timer T3396 associated with the DNN (or no DNN, if no DNN was provided by the UE) is running, and timer T3584 associated with the DNN (or no DNN, if no DNN was provided by the UE) and the S-NSSAI of the PDU session (or no S-NSSAI, if no S-NSSAI was provided by the UE) is running, then the UE stops both the timer T3396 and the timer T3584.\nNOTE\u00a04:\tIf the PDU SESSION RELEASE COMMAND message is received without the Back-off timer value IE or includes 5GSM cause\u00a0#39 \"reactivation requested\" for a PDU session, the UE provided a DNN (or no DNN) and an S-NSSAI of the PDU session (or no S-NSSAI) when the PDU session is established, timer T3585 associated with the S-NSSAI of the PDU session (or no S-NSSAI, if no S-NSSAI was provided by the UE) is running, and timer T3584 associated with the DNN (or no DNN, if no DNN was provided by the UE) and the S-NSSAI of the PDU session (or no S-NSSAI, if no S-NSSAI was provided by the UE) is running, then the UE stops both the timer T3585 and the timer T3584.\nIf the PDU SESSION RELEASE COMMAND message includes 5GSM cause\u00a0#26 \"insufficient resources\" and the Back-off timer value IE, the UE shall ignore the 5GSM congestion re-attempt indicator IE provided by the network, if any, and the UE shall take different actions depending on the timer value received for timer T3396 in the Back-off timer value:\na)\tIf the timer value indicates neither zero nor deactivated and a DNN was provided during the PDU session establishment, the UE shall stop timer T3396 associated with the corresponding DNN, if it is running. If the timer value indicates neither zero nor deactivated and no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3396 associated with no DNN if it is running. In an SNPN, the timer T3396 to be stopped includes:\n1)\tthe timer T3396 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\n2)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall then start timer T3396 with the value provided in the Back-off timer value IE and:\n1)\tshall not send a PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same DNN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and\n2)\tshall not send a PDU SESSION ESTABLISHMENT REQUEST message without an DNN and with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or a PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session established without an DNN provided by the UE, if no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", until timer T3396 expires or timer T3396 is stopped.\nThe UE shall not stop timer T3396 upon a PLMN change, SNPN change, or inter-system change;\nb)\tif the timer value indicates that this timer is deactivated and a DNN was provided during the PDU session establishment, the UE shall stop timer T3396 associated with the corresponding DNN, if it is running. If the timer value indicates that this timer is deactivated and no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3396 associated with no DNN if it is running. In an SNPN, the timer T3396 to be stopped includes:\n1)\tthe timer T3396 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\n2)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE:\n1)\tshall not send a PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same DNN until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives a PDU SESSION MODIFICATION COMMAND message for the same DNN from the network, or a PDU SESSION AUTHENTICATION COMMAND message for the same DNN, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE or including 5GSM cause\u00a0#39 \"reactivation requested\" for the same DNN from the network; and\n2)\tshall not send a PDU SESSION ESTABLISHMENT REQUEST message without a DNN and with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or a PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session established without a DNN provided by the UE, if no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives a PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU session established without an DNN provided by the UE, or a PDU SESSION AUTHENTICATION COMMAND message for a non-emergency PDU session established without a DNN provided by the UE, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE or including 5GSM cause\u00a0#39 \"reactivation requested\" for a non-emergency PDU session established without a DNN provided by the UE.\nThe timer T3396 remains deactivated upon a PLMN change, SNPN change, or inter-system change; and\nc)\tif the timer value indicates zero, the UE:\n1)\tshall stop timer T3396 associated with the corresponding DNN, if running. In an SNPN, the timer T3396 to be stopped includes:\ni)\tthe timer T3396 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nii)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send a PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same DNN; and\n2)\tif no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3396 associated with no DNN, if running. In an SNPN, the timer T3396 to be stopped includes:\ni)\tthe timer T3396 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nii)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send a PDU SESSION ESTABLISHMENT REQUEST message without a DNN, or a PDU SESSION MODIFICATION REQUEST message without an DNN provided by the UE.\nIn an SNPN, if the UE supports equivalent SNPNs, then the UE shall apply the timer T3396 for all the equivalent SNPNs. Otherwise, the UE shall apply the timer T3396 for the registered SNPN.\nIf the PDU SESSION RELEASE COMMAND message includes 5GSM cause\u00a0#26 \"insufficient resources\" and the Back-off timer value IE is not included, then the UE may send a PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same DNN or without a DNN.\nWhen the timer T3396 is running or the timer is deactivated, the UE is allowed to initiate a PDU session establishment procedure for emergency services.\nIf the timer T3396 is running when the UE enters state 5GMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" for the SNPN to which timer T3396 is associated (if any) is not updated, then timer T3396 is kept running until it expires or it is stopped.\nIf the UE is switched off when the timer T3396 is running, and if the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" for the SNPN to which timer T3396 is associated (if any) is not updated when the UE is switched on, the UE shall behave as follows:\n-\tlet t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\nIf the 5GSM cause value is #39 \"reactivation requested\", the UE shall ignore the Back-off timer value IE provided by the network, if any.\nIf the 5GSM cause value is #67 \"insufficient resources for specific slice and DNN\" and the Back-off timer value IE is included, the UE shall take different actions depending on the timer value received for timer T3584 in the Back-off timer value:\na)\tIf the timer value indicates neither zero nor deactivated, and both an S-NSSAI and a DNN were provided by the UE during the PDU session establishment the UE shall stop timer T3584 associated with the [S-NSSAI of the PDU session, DNN] combination, if it is running. If the timer value indicates neither zero nor deactivated, an S-NSSAI and no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3584 associated with [S-NSSAI of the PDU session, no DNN] combination, if it is running. If the timer value indicates neither zero nor deactivated, no S-NSSAI and a DNN was provided during the PDU session establishment, the UE shall stop timer T3584 associated with the [no S-NSSAI, DNN] combination, if it is running. If the timer value indicates neither zero nor deactivated and neither S-NSSAI nor DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3584 associated with the [no S-NSSAI, no DNN] combination, if it is running. The timer T3584 to be stopped includes:\n1)\tin a PLMN:\ni)\tthe timer T3584 applied for all the PLMNs, if running; and\nii)\tthe timer T3584 applied for the registered PLMN, if running; or\n2)\tin an SNPN:\ni)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nii)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall then start timer T3584 with the value provided in the Back-off timer value IE.\n1)\tThe UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or PDU SESSION MODIFICATION REQUEST message with the exception of those identified in subclause\u00a06.4.2.1, for the [S-NSSAI of the PDU session, DNN] combination, until timer T3584 expires or timer T3584 is stopped;\n2)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with the exception of those identified in subclause\u00a06.4.2.1, for the [S-NSSAI of the PDU session, no DNN] combination, if no DNN was provided during the PDU session establishment, until timer T3584 expires or timer T3584 is stopped;\n3)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message, or another PDU SESSION MODIFICATION REQUEST message with the exception of those identified in subclause\u00a06.4.2.1, for the same [no S-NSSAI, DNN] combination, if no S-NSSAI was provided during the PDU session establishment, until timer T3584 expires or timer T3584 is stopped; and\n4)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with the exception of those identified in subclause\u00a06.4.2.1, for the same [no S-NSSAI, no DNN] combination, if neither S-NSSAI nor DNN was provided during the PDU session establishment, until timer T3584 expires or timer T3584 is stopped.\nThe UE shall not stop timer T3584 upon a PLMN change, SNPN change, or inter-system change;\nb)\tif the timer value indicates that this timer is deactivated:\n1)\tif both S-NSSAI and DNN were provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [S-NSSAI of the PDU session, DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running. \n\tThe UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the [S-NSSAI of the PDU session, DNN] combination that was sent by the UE, until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives a PDU SESSION MODIFICATION COMMAND message for the [S-NSSAI of the PDU session, DNN] combination from the network, or a PDU SESSION AUTHENTICATION COMMAND message for the [S-NSSAI of the PDU session, DNN] combination from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE or including 5GSM cause\u00a0#39 \"reactivation requested\" for the [S-NSSAI of the PDU session, DNN] combination from the network;\n2)\tif an S-NSSAI was provided but a DNN was not provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [S-NSSAI of the PDU session, no DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall not send a PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or a PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the [S-NSSAI of the PDU session, no DNN] combination, if no DNN was provided during the PDU session establishment, until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives an PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU session established for the [S-NSSAI of the PDU session, no DNN] combination from the network, or a PDU SESSION AUTHENTICATION COMMAND message for a non-emergency PDU session established the [S-NSSAI of the PDU session, DNN] combination from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE or including 5GSM cause\u00a0#39 \"reactivation requested\" for a non-emergency PDU session established for the [S-NSSAI of the PDU session, no DNN] combination from the network;\n3)\tif an S-NSSAI was not provided but a DNN was provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [no S-NSSAI, DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall not send a PDU SESSION ESTABLISHMENT REQUEST message, or a PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the [no S-NSSAI, DNN], if no S-NSSAI was provided during the PDU session establishment, until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives an PDU SESSION MODIFICATION COMMAND message for the [no S-NSSAI, DNN] combination from the network, or a PDU SESSION AUTHENTICATION COMMAND message for the [no S-NSSAI, DNN] combination from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE or including 5GSM cause\u00a0#39 \"reactivation requested\" for the same [no S-NSSAI, DNN] combination from the network; and\n4)\tif neither S-NSSAI nor DNN were provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [no S-NSSAI, no DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall not send a PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or a PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the [no S-NSSAI, no DNN] combination, if neither S-NSSAI nor DNN was provided during the PDU session establishment, until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives an PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU session established for the [no S-NSSAI, no DNN] combination from the network, or a PDU SESSION AUTHENTICATION COMMAND message for a non-emergency PDU session established for the [no S-NSSAI, no DNN] combination from the network or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE or including 5GSM cause\u00a0#39 \"reactivation requested\" for a non-emergency PDU session established for the [no S-NSSAI, no DNN] combination from the network.\nThe timer T3584 remains deactivated upon a PLMN change, SNPN change, or inter-system change; and\nc)\tif the timer value indicates zero:\n1)\tif both S-NSSAI and DNN were provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [S-NSSAI of the PDU session, DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and \nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the [S-NSSAI of the PDU session, DNN] combination;\n2)\tif an S-NSSAI was provided but a DNN was not provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [S-NSSAI of the PDU session, no DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the [S-NSSAI of the PDU session, no DNN] combination if the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\";\n3)\tif an S-NSSAI was not provided but a DNN was provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [no S-NSSAI, DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message, or PDU SESSION MODIFICATION REQUEST message for the [no S-NSSAI, DNN] combination; and\n4)\tif neither S-NSSAI nor DNN were provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [no S-NSSAI, no DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message, or PDU SESSION MODIFICATION REQUEST message for the [no S-NSSAI, no DNN] combination if the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\".\nIf the 5GSM congestion re-attempt indicator IE with the ABO bit set to \"The back-off timer is applied in all PLMNs or all equivalent SNPNs \" is included in the PDU SESSION RELEASE COMMAND message with the 5GSM cause value #67 \"insufficient resources for specific slice and DNN\", then the UE shall apply the timer T3584 for all the PLMNs or all the equivalent SNPNs. Otherwise, the UE shall apply the timer T3584 for the registered PLMN or the registered SNPN.\nIf the 5GSM cause value is #67 \"insufficient resources for specific slice and DNN\" and the Back-off timer value IE is not included, then the UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same [S-NSSAI, DNN] combination.\nWhen the timer T3584 is running or the timer is deactivated, the UE is allowed to initiate a PDU session establishment procedure for emergency services.\nIf the timer T3584 is running when the UE enters state 5GMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" for the SNPN to which timer T3584 is associated (if any) is not updated, then timer T3584 is kept running until it expires or it is stopped.\nIf the UE is switched off when the timer T3584 is running, and if the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" for the SNPN to which timer T3584 is associated (if any) is not updated when the UE is switched on, the UE shall behave as follows:\n-\tlet t1 be the time remaining for T3584 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\nIf the 5GSM cause value is #69 \"insufficient resources for specific slice\" and the Back-off timer value IE is included, the UE shall take different actions depending on the timer value received for timer T3585 in the Back-off timer value:\na)\tIf the timer value indicates neither zero nor deactivated and an S-NSSAI was provided during the PDU session establishment, the UE shall stop timer T3585 associated with the S-NSSAI of the PDU session, if it is running. If the timer value indicates neither zero nor deactivated and no S-NSSAI was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3585 associated with no S-NSSAI if it is running. The timer T3585 to be stopped includes:\n1)\tin a PLMN:\ni)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running;\nii)\tthe timer T3585 applied for all the PLMNs and for both 3GPP access type and non-3GPP access type, if running;\niii)\tthe timer T3585 applied for the registered PLMN and for the access over which the PDU SESSION RELEASE COMMAND is received, if running; and\niv)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\n2)\tin an SNPN:\ni)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nii)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\niii)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\niv)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall then start timer T3585 with the value provided in the Back-off timer value IE and:\n1)\tif an S-NSSAI was provided by the UE during the PDU session establishment, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message, or PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the S-NSSAI of the PDU session, until timer T3585 expires or timer T3585 is stopped; and\n2)\tif the request type was different from \"initial emergency request\" and from \"existing emergency PDU session\", and an S-NSSAI was not provided by the UE during the PDU session establishment, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message without an S-NSSAI and with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session established without an S-NSSAI provided by the UE, until timer T3585 expires or timer T3585 is stopped.\nThe UE shall not stop timer T3585 upon a PLMN change, SNPN change, or inter-system change;\nb)\tif the timer value indicates that this timer is deactivated and an S-NSSAI was provided during the PDU session establishment, the UE shall stop timer T3585 associated with the S-NSSAI of the PDU session, if it is running. If the timer value indicates that this timer is deactivated and no S-NSSAI was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3585 associated with no S-NSSAI if it is running. The timer T3585 to be stopped includes:\n1)\tin a PLMN:\ni)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running;\nii)\tthe timer T3585 applied for all the PLMNs and for both 3GPP access type and non-3GPP access type, if running;\niii)\tthe timer T3585 applied for the registered PLMN and for current access type or both 3GPP access type and non-3GPP access type, if running; and\niv)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\n2)\tin an SNPN:\ni)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nii)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\niii)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\niv)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tIn addition:\n1)\tif an S-NSSAI was provided by the UE during the PDU session establishment, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST, or PDU SESSION MODIFICATION REQUEST with exception of those identified in subclause\u00a06.4.2.1, for the S-NSSAI of the PDU session until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or a PDU SESSION MODIFICATION COMMAND message for the S-NSSAI of the PDU session from the network, or a PDU SESSION AUTHENTICATION COMMAND message for the S-NSSAI of the PDU session from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE or including 5GSM cause\u00a0#39 \"reactivation requested\" for the S-NSSAI of the PDU session from the network; and\n2)\tif the request type was different from \"initial emergency request\" and from \"existing emergency PDU session\", and an S-NSSAI was not provided by the UE during the PDU session establishment, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message without an S-NSSAI and with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session established without an S-NSSAI provided by the UE, until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or a PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU session established without an S-NSSAI provided by the UE, or a PDU SESSION AUTHENTICATION COMMAND message for a non-emergency PDU session established without an S-NSSAI provided by the UE, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE or including 5GSM cause\u00a0#39 \"reactivation requested\" for a non-emergency PDU session established without an S-NSSAI provided by the UE.\nThe timer T3585 remains deactivated upon a PLMN change, SNPN change, or inter-system change; and\nc)\tif the timer value indicates zero:\n1)\tif an S-NSSAI was provided by the UE during the PDU session establishment, the UE shall stop timer T3585 associated with the S-NSSAI of the PDU session, if running. The timer T3585 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running;\nB)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running;\nC)\tthe timer T3585 applied for the registered PLMN and for current access type or both 3GPP access type and non-3GPP access type, if running; and\nD)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nB)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nC)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nD)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST, or PDU SESSION MODIFICATION REQUEST message for the S-NSSAI of the PDU session; and\n2)\tif no S-NSSAI was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3585 associated with no S-NSSAI\ni)\tin a PLMN:\nA)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running,;\nB)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running;\nC)\tthe timer T3585 applied for the registered PLMN and for current access type or both 3GPP access type and non-3GPP access type, if running; and\nD) the timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nB)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nC)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nD)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message without an S-NSSAI, or another PDU SESSION MODIFICATION REQUEST message without an S-NSSAI provided by the UE.\nIf the 5GSM congestion re-attempt indicator IE with the ABO bit set to \"The back-off timer is applied in all PLMNs or all equivalent SNPNs \" is included in the PDU SESSION RELEASE COMMAND message with the 5GSM cause value #69 \"insufficient resources for specific slice\", then the UE shall apply the timer T3585 for all the PLMNs or all the equivalent SNPNs. Otherwise, the UE shall apply the timer T3585 for the registered PLMN or the registered SNPN.\nIf the 5GSM cause value is #69 \"insufficient resources for specific slice\" and the Back-off timer value IE is not included, then the UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same S-NSSAI or without an S-NSSAI.\nWhen the timer T3585 is running or the timer is deactivated, the UE is allowed to initiate a PDU session establishment procedure for emergency services.\nIf the timer T3585 is running when the UE enters state 5GMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" for the SNPN to which timer T3585 is associated (if any) is not updated, then timer T3585 is kept running until it expires or it is stopped.\nIf the UE is switched off when the timer T3585 is running, and if the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" for the SNPN to which timer T3585 is associated (if any) is not updated when the UE is switched on, the UE shall behave as follows:\n-\tlet t1 be the time remaining for T3585 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\nNOTE\u00a05:\tAs described in this subclause, upon PLMN change, SNPN change or inter-system change, the UE does not stop the timer T3584 or T3585. This means the timer T3584 or T3585 can still be running or be deactivated for the given 5GSM procedure, the PLMN or SNPN, the S-NSSAI and optionally the DNN combination when the UE returns to the PLMN or SNPN or when it performs inter-system change back from S1 mode to N1 mode. Thus the UE can still be prevented from sending another PDU SESSION ESTABLISHMENT REQUEST or PDU SESSION MODIFICATION REQUEST message in the PLMN for the same S-NSSAI and optionally the same DNN.\nUpon PLMN change or SNPN change, if T3584 applied for the registered PLMN or the registered SNPN is running or is deactivated for an S-NSSAI, a DNN, and old PLMN or old SNPN, but T3584 is not running and is not deactivated for the S-NSSAI, the DNN, and new PLMN or new SNPN, then the UE is allowed to send a PDU SESSION ESTABLISHMENT REQUEST message for the same S-NSSAI and the same DNN in the new PLMN or new SNPN.\nUpon PLMN change or SNPN change, if T3585 applied for the registered PLMN or the registered SNPN is running or is deactivated for an S-NSSAI and old PLMN or old SNPN, but T3585 is not running and is not deactivated for the S-NSSAI and new PLMN or new SNPN, then the UE is allowed to send a PDU SESSION ESTABLISHMENT REQUEST message for the same S-NSSAI in the new PLMN or new SNPN.\nUpon SNPN change, if T3584 applied for all the equivalent SNPNs is running or is deactivated for an S-NSSAI, a DNN, and old SNPN, but T3584 is not running and is not deactivated for the S-NSSAI, the DNN, and new non-equivalent SNPN, then the UE is allowed to send a PDU SESSION ESTABLISHMENT REQUEST message for the same S-NSSAI and the same DNN in the new SNPN.\nUpon SNPN change, if T3585 applied for all the equivalent SNPNs is running or is deactivated for an S-NSSAI and old SNPN, but T3585 is not running and is not deactivated for the S-NSSAI and new non-equivalent SNPN, then the UE is allowed to send a PDU SESSION ESTABLISHMENT REQUEST message for the same S-NSSAI in the new SNPN.\nIf the PDU SESSION RELEASE COMMAND message includes 5GSM cause #29 \"user authentication or authorization failed\" and the Back-off timer value IE, the UE shall behave as follows:\na)\tif the timer value indicates neither zero nor deactivated and:\n1)\tif the UE provided a DNN and S-NSSAI to the network during the PDU session establishment, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDU session establishment procedure and:\ni)\tin a PLMN, [PLMN, DNN, (mapped) HPLMN S-NSSAI] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same DNN and (mapped) HPLMN S-NSSAI in the current PLMN, until the back-off timer expires, the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed SNPN S-NSSAI] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same DNN and (mapped) subscribed SNPN S-NSSAI in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the back-off timer expires, the UE is switched off, the USIM is removed, or the selected entry of the \"list of subscriber data\" is updated;\n2)\tif the UE provided a DNN to the network during the PDU session establishment, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDU session establishment procedure and:\ni)\tin a PLMN, [PLMN, DNN] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same DNN in the current PLMN, until the back-off timer expires, the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same DNN in the current PLMN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the back-off timer expires, the UE is switched off, the USIM is removed or the selected entry of the \"list of subscriber data\" is updated;\n3)\tif the UE did not provide a DNN or S-NSSAI or any of the two parameters to the network during the PDU session establishment, it shall start the back-off timer accordingly for the PDU session establishment procedure and:\ni)\tin a PLMN, the [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI] or [PLMN, no DNN, no S-NSSAI] combination. Dependent on the combination, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI] or [PLMN, no DNN, no S-NSSAI] combination in the current PLMN, until the back-off timer expires, the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI] or [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] combination. Dependent on the combination, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI] or [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] combination in the current PLMN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the back-off timer expires, the UE is switched off, the USIM is removed or the selected entry of the \"list of subscriber data\" is updated; or\n4)\tif the UE did not provide a DNN to the network during the PDU session establishment, it shall start the back-off timer accordingly for the PDU session establishment procedure and:\ni)\tin a PLMN, the [PLMN, no DNN] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same [PLMN, no DNN] in the current PLMN, until the back-off timer expires, the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the back-off timer expires, the UE is switched off, the USIM is removed, or the selected entry of the \"list of subscriber data\" is updated;\nb)\tif the timer value indicates that this timer is deactivated and:\n1)\tif the UE provided a DNN and S-NSSAI to the network during the PDU session establishment, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for:\ni)\tin a PLMN, the same DNN and (mapped) HPLMN S-NSSAI in the current PLMN, until the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, the same DNN and (mapped) subscribed SNPN S-NSSAI in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the UE is switched off, or the USIM is removed, or the selected entry of the \"list of subscriber data\" is updated;\n2)\tif the UE provided a DNN to the network during the PDU session establishment, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for:\ni)\tin a PLMN, the same DNN in the current PLMN, until the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, the same DNN in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the UE is switched off, or the USIM is removed, or the selected entry of the \"list of subscriber data\" is updated;\n3)\tif the UE did not provide a DNN or S-NSSAI or any of the two parameters to the network during the PDU session establishment, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for:\ni)\tin a PLMN, the same [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI] or [PLMN, no DNN, no S-NSSAI] combination in the current PLMN, until the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, the same [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI] or [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] combination in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the UE is switched off, or the USIM is removed, or the selected entry of the \"list of subscriber data\" is updated; or\n4)\tif the UE did not provide a DNN to the network during the PDU session establishment, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for:\ni)\tin a PLMN, the same [PLMN, no DNN] in the current PLMN, until the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, the same [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] combination in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the UE is switched off, or the USIM is removed, or the selected entry of the \"list of subscriber data\" is updated; and\nc)\tif the timer value indicates zero, the UE may send another PDU SESSION ESTABLISHMENT REQUEST message:\n1)\tin a PLMN, for the same combination of [PLMN, DNN, (mapped) HPLMN S-NSSAI], [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI], or [PLMN, no DNN, no S-NSSAI] in the current PLMN; or\n2)\tin an SNPN, for the same combination of [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed SNPN S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI], or [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] in the current SNPN.\nThe UE shall not stop any back-off timer:\na)\tupon a PLMN or SNPN change;\nb)\tupon an inter-system change; or\nc)\tupon registration over another access type.\nIf the PDU SESSION RELEASE COMMAND message includes:\na)\t5GSM cause #29 \"user authentication or authorization failed\"; and\nb)\tthe service-level-AA response in the Service-level-AA container IE with the SLAR field set to the value of \"Service level authentication and authorization was not successful or service level authorization is revoked\",\nthe UE shall forward the service-level-AA response to the upper layers, so the UUAA authorization data is deleted as specified in 3GPP\u00a0TS\u00a033.256\u00a0[24B].\nThe UE shall transport the PDU SESSION RELEASE COMPLETE message and the PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5.\nUpon receipt of a PDU SESSION RELEASE COMPLETE message, the SMF shall stop timer T3592 and shall consider the PDU session as released.\n6.3.3.4\tN1 SM delivery skipped\nIf the PDU SESSION RELEASE COMMAND message was sent along the N1 SM delivery skip allowed indication towards AMF, then upon receipt of an indication that N1 SM delivery was skipped, the SMF shall stop timer T3592 and shall consider the PDU session as released.\n6.3.3.5\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3592.\n\tThe SMF shall, on the first expiry of the timer T3592, retransmit the PDU SESSION RELEASE COMMAND message and shall reset and start timer T3592. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3592, the SMF shall abort the procedure.\nb)\tCollision of network-requested PDU session release procedure and UE-requested PDU session modification procedure.\n\tWhen the SMF receives a PDU SESSION MODIFICATION REQUEST message during the network-requested PDU session release procedure, and the PDU session indicated in PDU SESSION MODIFICATION REQUEST message is the PDU session that the SMF had requested to release, the SMF shall ignore the PDU SESSION MODIFICATION REQUEST message and proceed with the PDU session release procedure.\nc)\tCollision of network-requested PDU session release procedure and UE-requested PDU session release procedure.\n\tIf the SMF receives a PDU SESSION RELEASE REQUEST message after sending a PDU SESSION RELEASE COMMAND message with the PTI IE set to \"No procedure transaction identity assigned\" to the UE, and the PDU session ID in the PDU SESSION RELEASE REQUEST message is the same as the PDU session ID in the PDU SESSION RELEASE COMMAND message:\n-\tif the Access type IE is included in the PDU SESSION RELEASE COMMAND message and the PDU session is an MA PDU session and having user-plane resources established on the access different from the access indicated in the Access type IE in the PDU SESSION RELEASE COMMAND message, the SMF shall proceed both the UE-requested PDU session release procedure and network-requested PDU session release procedure;\n-\totherwise, the SMF shall ignore the PDU SESSION RELEASE REQUEST message and proceed with the network-requested PDU session release procedure.\nd)\tCollision of re-establishment of the user-plane resources and network-requested PDU session release procedure for the same PDU session.\n\tIf the SMF receives an indication from the AMF to re-establish the user-plane resources during the network-requested PDU session release procedure for the same PDU session, the SMF shall not re-establish the user-plane resources for the PDU session as specified in 3GPP\u00a0TS\u00a029.502\u00a0[20A] subclause\u00a05.2.2.3.2.2 and proceed with the network-requested PDU session release procedure.\n6.3.3.6\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tPDU session inactive for the received PDU session ID.\n\tIf the PDU session ID in the PDU SESSION RELEASE COMMAND message belongs to any PDU session in state PDU SESSION INACTIVE in the UE, the UE shall include the 5GSM cause #43 \"Invalid PDU session identity\" in the 5GSM STATUS message, and set the PDU session ID to the received PDU session ID in the UL NAS TRANSPORT message as specified in subclause\u00a05.4.5.\nb)\tUser-plane resources of the MA PDU session on the access indicated in the Access type IE not established.\n\tIf the PDU session is an MA PDU session and has user-plane resources established on a single access different from the access indicated in the Access type IE, the UE shall not diagnose an error, further process the release command and consider the user-plane resources of the MA PDU session on the access indicated in the Access type IE as successfully released.\n6.4\tUE-requested 5GSM procedures\n6.4.1\tUE-requested PDU session establishment procedure\n6.4.1.1\tGeneral\nThe purpose of the UE-requested PDU session establishment procedure is to establish a new PDU session with a DN, to perform handover of an existing PDU session between 3GPP access and non-3GPP access, to transfer an existing PDN connection in the EPS to the 5GS, to transfer an existing PDN connection in an untrusted non-3GPP access connected to the EPC to the 5GS, or to establish an MA PDU session to support ATSSS (see 3GPP\u00a0TS\u00a024.193\u00a0[13B]), or to relay the service associated with the RSC for 5G ProSe layer-3 UE-to-network relay (see 3GPP\u00a0TS\u00a024.554\u00a0[19E]). If accepted by the network, the PDU session enables exchange of PDUs between the UE and the DN.\nThe UE shall not request a PDU session establishment:\na)\tfor an LADN, if the DNN used for that LADN is included in the LADN information IE and the UE is located outside the LADN service area indicated in the LADN information IE;\na1)\tfor an LADN, if the DNN used for that LADN is included in the Extended LADN information IE and there is no S-NSSAI used for PDU session establishment;\na2)\tfor an LADN, if the DNN used for that LADN is included in the Extended LADN information IE and the S-NSSAI used for PDU session establishment is not associated with that LADN;\na3)\tfor an LADN, if the DNN and the S-NSSAI used for that LADN are included in the Extended LADN information IE and the UE is located outside the LADN service area indicated in the Extended LADN information IE;\nb)\tto transfer a PDU session from non-3GPP access to 3GPP access when the 3GPP PS data off UE status is \"activated\" and the UE is not using the PDU session to send uplink IP packets for any of the 3GPP PS data off exempt services (see subclause\u00a06.2.10);\nc)\twhen the UE is in NB-N1 mode, the UE has indicated preference for user plane CIoT 5GS optimization, the network has accepted the use of user plane CIoT 5GS optimization for the UE, and the number of PDU sessions that currently has user-plane resources established equals to the UE's maximum number of supported user-plane resources;\nd)\tto transfer a PDU session from 3GPP access to non-3GPP access when the UE has indicated preference for control plane CIoT 5GS optimization, the network has accepted the use of control plane CIoT 5GS optimization for the UE, and the Control plane only indication IE was received in the PDU SESSION ESTABLISHMENT ACCEPT message;\ne)\tto transfer a PDU session from the non-3GPP access to the 3GPP access when the UE is in NB-N1 mode, the UE has indicated preference for user plane CIoT 5GS optimization, the network has accepted the use of user plane CIoT 5GS optimization for the UE, and the number of PDU sessions that currently has user-plane resources established equals to the UE's maximum number of supported user-plane resources;\nf)\tassociated to an S-NSSAI when the UE is not in the NS-AoS of the S-NSSAI; or\ng)\tassociated to an S-NSSAI included in the partially allowed NSSAI when the current TA is not in the list of TAs where the S-NSSAI is allowed.\n6.4.1.2\tUE-requested PDU session establishment procedure initiation\nIn order to initiate the UE-requested PDU session establishment procedure, the UE shall create a PDU SESSION ESTABLISHMENT REQUEST message.\nNOTE\u00a00:\tWhen IMS voice is available over either 3GPP access or non-3GPP access, the \"voice centric\" UE in 5GMM-REGISTERED state will receive a request from upper layers to establish the PDU session for IMS signalling, if the conditions for performing an initial registration with IMS indicated in 3GPP\u00a0TS\u00a024.229\u00a0[14]\u00a0subclause\u00a0U.3.1.2 are satisfied.\nIf the UE requests to establish a new PDU session, the UE shall allocate a PDU session ID which is not currently being used by another PDU session over either 3GPP access or non-3GPP access. If the N5CW device supporting 3GPP access requests to establish a new PDU session via 3GPP access, the N5CW device supporting 3GPP access shall refrain from allocating \"PDU session identity value 15\". If the TWIF acting on behalf of the N5CW device requests to establish a new PDU session, the TWIF acting on behalf of the N5CW device shall allocate the \"PDU session identity value 15\".\nThe UE shall allocate a PTI value currently not used and shall set the PTI IE of the PDU SESSION ESTABLISHMENT REQUEST message to the allocated PTI value.\nIf the UE is registered for emergency services over the current access, the UE shall not request establishing a non-emergency PDU session over the current access. If the UE is registered for emergency services over the current access it shall not request establishing an emergency PDU session over the non-current access except if the request is for transferring the emergency PDU session to the non-current access. Before transferring an emergency PDU session from non-3GPP access to 3GPP access, or before transferring a PDN connection for emergency bearer services from untrusted non-3GPP access connected to EPC to 3GPP access, the UE shall check whether emergency services are supported in the NG-RAN cell (either an NR cell or an E-UTRA cell) on which the UE is camping.\nNOTE\u00a01:\tTransfer of an existing emergency PDU session or PDN connection for emergency bearer services between 3GPP access and non-3GPP access is needed e.g. if the UE determines that the current access is no longer available.\nIf the UE requests to establish a new emergency PDU session, the UE shall include the PDU session type IE in the PDU SESSION ESTABLISHMENT REQUEST message and shall set the IE to the IP version capability as specified in subclause\u00a06.2.4.2.\nIf the UE requests to establish a new non-emergency PDU session with a DN, the UE shall include the PDU session type IE in the PDU SESSION ESTABLISHMENT REQUEST message and shall set the IE to one of the following values: \"IPv4\", \"IPv6\", \"IPv4v6\", \"Ethernet\" or \"Unstructured\" based on the URSP rules or based on UE local configuration (see 3GPP\u00a0TS\u00a024.526\u00a0[19]) and based on the IP version capability as specified in subclause\u00a06.2.4.2.\nNOTE\u00a02:\tWhen the UE initiates the UE-requested PDU session establishment procedure to transfer an existing non-IP PDN connection in the EPS to the 5GS, the UE can use locally available information associated with the PDN connection to select the PDU session type between \"Ethernet\" and \"Unstructured\".\nIf the UE requests to establish a new non-emergency PDU session with a DN and the UE requests an SSC mode, the UE shall set the SSC mode IE of the PDU SESSION ESTABLISHMENT REQUEST message to the SSC mode. If the UE requests to establish a PDU session of \"IPv4\", \"IPv6\" or \"IPv4v6\" PDU session type, the UE shall either omit the SSC mode IE or set the SSC mode IE to \"SSC mode 1\", \"SSC mode 2\", or \"SSC mode 3\". If the UE requests to establish a PDU session of \"Ethernet\" or \"Unstructured\" PDU session type, the UE shall either omit the SSC mode IE or set the SSC mode IE to \"SSC mode 1\" or \"SSC mode 2\". If the UE requests transfer of an existing PDN connection in the EPS to the 5GS or the UE requests transfer of an existing PDN connection in an untrusted non-3GPP access connected to the EPC to the 5GS, the UE shall set the SSC mode IE to \"SSC mode 1\".\nIf the UE requests to establish a new emergency PDU session, the UE shall set the SSC mode IE of the PDU SESSION ESTABLISHMENT REQUEST message to \"SSC mode 1\".\nA UE supporting PDU connectivity service shall support SSC mode 1 and may support SSC mode 2 and SSC mode 3 as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8].\nIf the UE requests to establish a new non-emergency PDU session with a DN, the UE may include the SM PDU DN request container IE with a DN-specific identity of the UE complying with network access identifier (NAI) format as specified in IETF\u00a0RFC\u00a07542\u00a0[37].\nNOTE\u00a03:\tThe UE can avoid including both the SM PDU DN request container IE and the Extended protocol configuration options IE with PAP/CHAP protocol identifiers in the PDU SESSION ESTABLISHMENT REQUEST message. The way to achieve this is implementation dependent.\nIf the UE requests to:\na)\testablish a new PDU session;\nb)\tperform handover of an existing PDU session from non-3GPP access to 3GPP access;\nc)\ttransfer an existing PDN connection in the EPS to the 5GS according to subclause\u00a04.8.2.3.1;\nd)\ttransfer an existing PDN connection in untrusted non-3GPP access connected to the EPC to the 5GS; or\ne)\testablish user plane resources over 3GPP access of an MA PDU session established over non-3GPP access only;\nand the UE at the same time intends to join one or more multicast MBS sessions that is associated to the PDU session, the UE should include the Requested MBS container IE in the PDU SESSION ESTABLISHMENT REQUEST message. In that case, the UE shall set the MBS operation to \"Join multicast MBS session\" and include the multicast MBS session information(s) and shall set the Type of multicast MBS session ID for each of the multicast MBS session information to either \"Temporary Mobile Group Identity (TMGI)\" or \"Source specific IP multicast address\" depending on the type of the multicast MBS session ID available in the UE. Then the remaining values of each of the multicast MBS session information shall be set as following:\na)\tif the Type of multicast MBS session ID is set to \"Temporary Mobile Group Identity (TMGI)\", the UE shall set the multicast MBS session ID to the TMGI; or\nb)\tif the Type of multicast MBS session ID is set to \"Source specific IP multicast address for IPv4\" or \" Source specific IP multicast address for IPv6\", the UE shall set the Source IP address information and the Destination IP address information to the corresponding values.\nThe UE should not request to join a multicast MBS session for local MBS service if neither current TAI nor CGI of the current cell is part of the MBS service area(s) of the multicast MBS session, if the UE has valid information of the MBS service area(s) of the multicast MBS session.\nNOTE\u00a04:\tThe UE obtains the details of the MBS session ID(s) e.g., TMGI, Source IP address information and Destination IP address information as a pre-configuration in the UE or during the MBS service announcement, which is out of scope of this specification. Pre-configuration can be provided in one or more of the following ways:\na)\tin a UE implementation-specific way (e.g. factory configuration);\nb)\tin the USIM (see EF5MBSUECONFIG file in 3GPP\u00a0TS\u00a031.102\u00a0[22]); or\nc)\tin the UE pre-configuration MO for MBS (see 3GPP\u00a0TS\u00a024.575\u00a0[65).\nThe UE should set the RQoS bit to \"Reflective QoS supported\" in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message if the UE supports reflective QoS and:\na)\tthe UE requests to establish a new PDU session of \"IPv4\", \"IPv6\", \"IPv4v6\" or \"Ethernet\" PDU session type;\nb)\tthe UE requests to transfer an existing PDN connection in the EPS of \"IPv4\", \"IPv6\", \"IPv4v6\" or \"Ethernet\" PDN type or of \"Non-IP\" PDN type mapping to \"Ethernet\" PDU session type, to the 5GS; or\nc)\tthe UE requests to transfer an existing PDN connection in an untrusted non-3GPP access connected to the EPC of \"IPv4\", \"IPv6\" or \"IPv4v6\" PDN type to the 5GS.\nNOTE\u00a05:\tThe determination to not request the usage of reflective QoS by the UE for a PDU session is implementation dependent.\nThe UE shall indicate the maximum number of packet filters that can be supported for the PDU session in the Maximum number of supported packet filters IE of the PDU SESSION ESTABLISHMENT REQUEST message if:\na)\tthe UE requests to establish a new PDU session of \"IPv4\", \"IPv6\", \"IPv4v6\", or \"Ethernet\" PDU session type, and the UE can support more than 16 packet filters for this PDU session;\nb)\tthe UE requests to transfer an existing PDN connection in the EPS of \"IPv4\", \"IPv6\", \"IPv4v6\", or \"Ethernet\" PDN type or of \"Non-IP\" PDN type mapping to \"Ethernet\" PDU session type, to the 5GS and the UE can support more than 16 packet filters for this PDU session; or\nc)\tthe UE requests to transfer an existing PDN connection in an untrusted non-3GPP access connected to the EPC of \"IPv4\", \"IPv6\" or \"IPv4v6\" PDN type to the 5GS and the UE can support more than 16 packet filters for this PDU session.\nThe UE shall include the Integrity protection maximum data rate IE in the PDU SESSION ESTABLISHMENT REQUEST message to indicate the maximum data rate per UE for user-plane integrity protection supported by the UE for uplink and the maximum data rate per UE for user-plane integrity protection supported by the UE for downlink.\nThe UE shall set the MH6-PDU bit to \"Multi-homed IPv6 PDU session supported\" in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message if the UE supports multi-homed IPv6 PDU session and:\na)\tthe UE requests to establish a new PDU session of \"IPv6\" or \"IPv4v6\" PDU session type; or.\nb)\tthe UE requests to transfer an existing PDN connection of \"IPv6\" or \"IPv4v6\" PDN type in the EPS or in an untrusted non-3GPP access connected to the EPC to the 5GS.\nThe UE shall set the EPT-S1 bit to \"Ethernet PDN type in S1 mode supported\" in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message if the UE supports Ethernet PDN type in S1 mode and requests \"Ethernet\" PDU session type.\nIf the UE requests to establish a new PDU session as an always-on PDU session (e.g. because the PDU session is for time synchronization or TSC), the UE shall include the Always-on PDU session requested IE and set the value of the IE to \"Always-on PDU session requested\" in the PDU SESSION ESTABLISHMENT REQUEST message.\nNOTE\u00a06:\tDetermining whether a PDU session is for time synchronization or TSC is UE implementation dependent.\nIf the UE has an emergency PDU session, the UE shall not perform the UE-requested PDU session establishment procedure to establish another emergency PDU session. The UE may perform the UE-requested PDU session establishment procedure to transfer an existing emergency PDU session or an existing PDN connection for emergency services.\nIf:\na)\tthe UE requests to perform handover of an existing PDU session between 3GPP access and non-3GPP access;\nb)\tthe UE requests to perform transfer an existing PDN connection in the EPS to the 5GS; or\nc)\tthe UE requests to perform transfer an existing PDN connection in an untrusted non-3GPP access connected to the EPC to the 5GS;\nthe UE shall:\na)\tset the PDU session ID in the PDU SESSION ESTABLISHMENT REQUEST message and in the UL NAS TRANSPORT message to the stored PDU session ID corresponding to the PDN connection; and\nb)\tset the S-NSSAI in the UL NAS TRANSPORT message to the stored S-NSSAI associated with the PDU session ID of a non-emergency PDU session. The UE shall not request to perform handover of an existing non-emergency PDU session:\n1)\tbetween 3GPP access and non-3GPP access if the S-NSSAI is not included in the allowed NSSAI for the target access; or\n2)\tfrom non-3GPP access to 3GPP access:\ni)\tif the S-NSSAI is not in the partially allowed NSSAI for 3GPP access; or\nii)\tif the S-NSSAI is in the partially allowed NSSAI for 3GPP access but the TAI where the UE is currently camped on is not in the list of TAs for which the S-NSSAI is supported.\nIf the N5CW device supporting 3GPP access requests to perform handover of an existing PDU session from non-3GPP access to 3GPP access, the N5CW device supporting 3GPP access shall set the PDU session ID in the PDU SESSION ESTABLISHMENT REQUEST message and in the UL NAS TRANSPORT message to \"PDU session identity value 15\".\nIf the UE is registered to a network which supports ATSSS and the UE requests to establish a new PDU session the UE may allow the network to upgrade the requested PDU session to an MA PDU session. In order to allow the network to upgrade the requested PDU session to an MA PDU session, the UE shall set \"MA PDU session network upgrade is allowed\" in the MA PDU session information IE and shall set the request type to \"initial request\" in the UL NAS TRANSPORT message. If the UE is registered to a network which does not support ATSSS, the UE shall not perform the procedure to allow the network to upgrade the requested PDU session to an MA PDU session.\nIf the UE is registered to a network which supports ATSSS, the UE may request to establish an MA PDU session. If the UE requests to establish an MA PDU session, the UE shall set the request type to \"MA PDU request\" in the UL NAS TRANSPORT message. If the UE is registered to a network which does not support ATSSS, the UE shall not request to establish an MA PDU session.\nWhen the UE is registered over both 3GPP access and non-3GPP access in the same PLMN and the UE requests to establish a new MA PDU session, the UE may provide an S-NSSAI in the UL NAS TRANSPORT message only if the S-NSSAI is included in the allowed NSSAIs of both accesses.\nNOTE\u00a07:\tIf the UE requested DNN corresponds to an LADN DNN, the AMF does not forward the MA PDU session information IE to the SMF but sends the message back to the UE to inform of the unhandled request (see subclause\u00a05.4.5.2.5).\nIf the UE is registered to a network which supports ATSSS and the UE has already an MA PDU session established over one access, the UE may perform the UE-requested PDU session establishment procedure to establish user-plane resources over the other access for the MA PDU session as specified in subclause\u00a04.22 of 3GPP\u00a0TS\u00a023.502\u00a0[9] and the S-NSSAI associated with the MA PDU session is included in the allowed NSSAI of the other access. If the UE establishes user-plane resources over the other access for the MA PDU session, the UE shall:\na)\tset the request type to \"MA PDU request\" in the UL NAS TRANSPORT message;\nb)\tset the PDU session ID to the stored PDU session ID corresponding to the established MA PDU session in the PDU SESSION ESTABLISHMENT REQUEST message and in the UL NAS TRANSPORT message; and\nc)\tset the S-NSSAI in the UL NAS TRANSPORT message to the stored S-NSSAI associated with the PDU session ID.\nIf the UE requests to establish a new MA PDU session or if the UE requests to establish a new PDU session and the UE allows the network to upgrade the requested PDU session to an MA PDU session:\na)\tif the UE supports ATSSS Low-Layer functionality with any steering mode (i.e., any steering mode allowed for ATSSS Low-Layer functionality) as specified in subclause\u00a05.32.6 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the ATSSS-ST bits to \"ATSSS Low-Layer functionality with any steering mode allowed for ATSSS-LL supported\" in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message;\nNOTE\u00a08:\tThe ATSSS Low-Layer functionality cannot be used together with the redundant steering mode. When the UE indicates that it is capable of supporting the ATSSS Low-Layer functionality with any steering mode, it implies that the UE supports the ATSSS Low-Layer functionality with any steering mode except the redundant steering mode.\nb)\tif the UE supports MPTCP functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode as specified in subclause\u00a05.32.6 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the ATSSS-ST bits to \"MPTCP functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode supported\" in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message;\nc)\tif the UE supports MPTCP functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality) as specified in subclause\u00a05.32.6 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the ATSSS-ST bits to \"MPTCP functionality with any steering mode and ATSSS-LL functionality with any steering mode allowed for ATSSS-LL supported\" in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message; \nd)\tif a performance measurement function in the UE can perform access performance measurements using the QoS flow of the non-default QoS rule as specified in subclause\u00a05.32.5 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the APMQF bit to \"Access performance measurements per QoS flow supported\" in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message;\ne)\tif the UE supports MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode as specified in subclause\u00a05.32.6 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the ATSSS-ST bits to \"MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode supported\" in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message;\nf)\tif the UE supports MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality) as specified in subclause\u00a05.32.6 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the ATSSS-ST bits to \"MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode allowed for ATSSS-LL supported\" in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message;\ng)\tif the UE supports MPTCP functionality with any steering mode, MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode as specified in subclause\u00a05.32.6 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the ATSSS-ST bits to \"MPTCP functionality with any steering mode, MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode supported\" in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message; and\nh)\tif the UE supports MPTCP functionality with any steering mode, MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality) as specified in subclause\u00a05.32.6 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the ATSSS-ST bits to \"MPTCP functionality with any steering mode, MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode allowed for ATSSS-LL supported\" in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message.\nUpon receipt of a PDU SESSION ESTABLISHMENT REQUEST message for MA PDU session establishment, the SMF shall check if the 5GSM capability IE in the PDU SESSION ESTABLISHMENT REQUEST message, includes:\na)\tthe ATSSS-ST bits set to \"MPTCP functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode supported\" and:\ni)\tif the DNN configuration allows for the MPTCP functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality), the SMF shall ensure that the established PDU session has the capability of MPTCP with any steering mode and ATSSS-LL with any steering mode in the downlink and MPTCP with any steering mode and ATSSS-LL with only active-standby steering mode in the uplink; or\nii)\tif the DNN configuration allows for the MPTCP functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode, the SMF shall ensure that the established PDU session has the capability of MPTCP with any steering mode and ATSSS-LL with only active-standby steering mode in the downlink and the uplink;\nb)\tthe ATSSS-ST bits set to \"MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode supported\" and:\ni)\tif the DNN configuration allows for the MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality), the SMF shall ensure that the established PDU session has the capability of MPQUIC with any steering mode and ATSSS-LL with any steering mode in the downlink and MPQUIC with any steering mode and ATSSS-LL with only active-standby steering mode in the uplink; or\nii)\tif the DNN configuration allows for the MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode, the SMF shall ensure that the established PDU session has the capability of MPQUIC with any steering mode and ATSSS-LL with only active-standby steering mode in the downlink and the uplink;\nc)\tthe ATSSS-ST bits set to \"MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode allowed for ATSSS-LL supported\" and if the DNN configuration allows for the MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality), the SMF shall ensure that the established PDU session has the capability of MPQUIC with any steering mode and ATSSS-LL with any steering mode in the downlink and the uplink;\nd)\tthe ATSSS-ST bits set to \"ATSSS Low-Layer functionality with any steering mode allowed for ATSSS-LL supported\" and if the DNN configuration allows for the ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality), the SMF shall ensure that the established PDU session has the capability of ATSSS-LL with any steering mode in the downlink and the uplink;\ne)\tthe ATSSS-ST bits set to \"MPTCP functionality with any steering mode and ATSSS-LL functionality with any steering mode allowed for ATSSS-LL supported\" and if the DNN configuration allows for the MPTCP functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality), the SMF shall ensure that the established PDU session has the capability of MPTCP with any steering mode and ATSSS-LL with any steering mode in the downlink and the uplink;\nf)\tthe ATSSS-ST bits set to \"MPTCP functionality with any steering mode, MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode allowed for ATSSS-LL supported\" and if the DNN configuration allows for the MPTCP functionality with any steering mode, the MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality), the SMF shall ensure that the established PDU session has the capability of MPTCP with any steering mode, the MPQUIC with any steering mode and ATSSS-LL with any steering mode in the downlink and the uplink; or\ng)\tthe ATSSS-ST bits set to \"MPTCP functionality with any steering mode, MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode supported\" and\ni)\tif the DNN configuration allows for the MPTCP functionality with any steering mode, the MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality), the SMF shall ensure that the established PDU session has the capability of MPTCP with any steering mode, MPQUIC with any steering mode and ATSSS-LL with any steering mode in the downlink and MPTCP with any steering mode, MPQUIC with steering mode and ATSSS-LL with only active-standby steering mode in the uplink; or\nii)\tif the DNN configuration allows for the MPTCP functionality with any steering mode, the MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode, the SMF shall ensure that the established PDU session has the capability of MPTCP with any steering mode, MPQUIC with any steering mode and ATSSS-LL with only active-standby steering mode in the downlink and the uplink.\nIf the UE requests to establish a new MA PDU session and the UE supports to establish a PDN connection as the user plane resource of an MA PDU session, the UE shall include the ATSSS request parameter in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT REQUEST message.\nIf the UE is registered to a network which does not support ATSSS and the UE has already an MA PDU session established over one access, the UE shall not attempt to establish user-plane resources for the MA PDU session over the network which does not support ATSSS as specified in subclause\u00a04.22 of 3GPP\u00a0TS\u00a023.502\u00a0[9].\nIf the UE supports 3GPP PS data off, except for the transfer of a PDU session from non-3GPP access to 3GPP access and except for the establishment of user plane resources on the other access for the MA PDU session, the UE shall include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT REQUEST message and include the 3GPP PS data off UE status. The UE behaves as described in subclause\u00a06.2.10.\nIf the UE supports Reliable Data Service, the UE shall include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT REQUEST message and include the Reliable Data Service request indicator. The UE behaves as described in subclause\u00a06.2.15.\nIf the UE supports DNS over (D)TLS (see 3GPP\u00a0TS\u00a033.501\u00a0[24]), the UE shall include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT REQUEST message and include DNS server security information indicator and optionally, if the UE wishes to indicate which security protocol type(s) are supported by the UE, it may include the DNS server security protocol support.\nNOTE\u00a09:\tSupport of DNS over (D)TLS is based on the informative requirements as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nIf:\na)\tthe PDU session type value of the PDU session type IE is set to \"IPv4\", \"IPv6\" or \"IPv4v6\";\nb)\tthe UE indicates \"Control plane CIoT 5GS optimization supported\" and \"IP header compression for control plane CIoT 5GS optimization supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message; and\nc)\tthe network indicates \"Control plane CIoT 5GS optimization supported\" and \"IP header compression for control plane CIoT 5GS optimization supported\" in the 5GS network support feature IE of the REGISTRATION ACCEPT message;\nthe UE shall include the IP header compression configuration IE in the PDU SESSION ESTABLISHMENT REQUEST message.\nIf:\na)\tthe PDU session type value of the PDU session type IE is set to \"Ethernet\";\nb)\tthe UE indicates \"Control plane CIoT 5GS optimization supported\" and \"Ethernet header compression for control plane CIoT 5GS optimization supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message; and\nc)\tthe network indicates \"Control plane CIoT 5GS optimization supported\" and \"Ethernet header compression for control plane CIoT 5GS optimization supported\" in the 5GS network support feature IE of the REGISTRATION ACCEPT message;\nthe UE shall include the Ethernet header compression configuration IE in the PDU SESSION ESTABLISHMENT REQUEST message.\nIf the UE supports transfer of port management information containers, the UE shall:\na)\tset the TPMIC bit to \"Transfer of port management information containers supported\" in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message;\nb)\tif the UE requests to establish a PDU session of \"Ethernet\" PDU session type, include the DS-TT Ethernet port MAC address IE in the PDU SESSION ESTABLISHMENT REQUEST message and set its contents to the MAC address of the DS-TT Ethernet port used for the PDU session;\nc)\tif the UE-DS-TT residence time is available at the UE, include the UE-DS-TT residence time IE and set its contents to the UE-DS-TT residence time; and\nd)\tif a Port management information container is provided by the DS-TT, include the Port management information container IE in the PDU SESSION ESTABLISHMENT REQUEST message.\nNOTE\u00a010:\tOnly SSC mode 1 is supported for a PDU session which is for time synchronization or TSC.\nIf the UE supports secondary DN authentication and authorization over EPC, the UE shall set the SDNAEPC bit to \"Secondary DN authentication and authorization over EPC supported\" in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message.\nIf the UE supporting S1 mode supports receiving QoS rules with the length of two octets or QoS flow descriptions with the length of two octets via the Extended protocol configuration options IE, the UE shall include the QoS rules with the length of two octets support indicator or the QoS flow descriptions with the length of two octets support indicator, respectively, in the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT REQUEST message.\nIf the UE supports URSP provisioning in EPS, the UE shall include the URSP provisioning in EPS support indicator in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT REQUEST message.\nIf:\n-\tthe UE is operating in single-registration mode;\n-\tthe UE supports local IP address in traffic flow aggregate description and TFT filter in S1 mode; and\n-\tthe PDU session Type requested is different from \"Unstructured\".\nthe UE shall indicate the support of local address in TFT in S1 mode in the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT REQUEST message.\nIf the W-AGF acting on behalf of the FN-RG requests to establish a PDU session of \"IPv6\" or \"IPv4v6\" PDU session type, the W-AGF acting on behalf of the FN-RG may include in the PDU SESSION ESTABLISHMENT REQUEST message the Suggested interface identifier IE with the PDU session type value field set to \"IPv6\" and containing the interface identifier for the IPv6 link local address associated with the PDU session suggested to be allocated to the FN-RG.\nIf the UE supports provisioning of ECS configuration information to the EEC in the UE, then the UE shall include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT REQUEST message and shall include the ECS configuration information provisioning support indicator.\nIf the UE supports receiving DNS server addresses in protocol configuration options, the UE shall include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT REQUEST message and in the Extended protocol configuration options IE:\na)\tif the UE requests to establish a PDU session of \"IPv4\" or \"IPv4v6\" PDU session type, the UE shall include the DNS server IPv4 address request; and\nb)\tif the UE requests to establish a PDU session of \"IPv6\" or \"IPv4v6\" PDU session type, the UE shall include the DNS server IPv6 address request.\nIf the UE supporting UAS services requests to establish a PDU session for C2 communication, the UE shall include the Service-level-AA container IE in the PDU SESSION ESTABLISHMENT REQUEST message. In the Service-level-AA container IE, the UE shall include:\na)\tthe service-level device ID with the value set to the CAA-level UAV ID of the UE; and\nb)\tif available, the service-level-AA payload with the value set to the C2 authorization payload and the service-level-AA payload type with the value set to \"C2 authorization payload\".\nNOTE\u00a011:\tThe C2 authorization payload in the service-level-AA payload can include one, some or all of the pairing information for C2 communication, an indication of the request for direct C2 communication, pairing information for direct C2 communication, and the UAV flight authorization information.\nIf the UE supports the EAS rediscovery, the UE shall include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT REQUEST message and shall include the EAS rediscovery support indication in the Extended protocol configuration options IE.\nIf the UE needs to include a PDU session pair ID based on the matching URSP rule or UE local configuration, the UE shall include the PDU session pair ID IE in the PDU SESSION ESTABLISHMENT REQUEST message. If the UE needs to include an RSN based on the matching URSP rule or UE local configuration, the UE shall include the RSN IE in the PDU SESSION ESTABLISHMENT REQUEST message.\nIf the UE is not registered for onboarding services in SNPN and needs PVS information, the UE shall include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT REQUEST message and include the PVS information request in the Extended protocol configuration options IE. \nIf the UE supports the EDC, the UE shall include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT REQUEST message and shall include the EDC support indicator in the Extended protocol configuration options IE.\nIf the UE supports a \"destination MAC address range type\" packet filter component and a \"source MAC address range type\" packet filter component, the UE shall include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT REQUEST message and shall include the MS support of MAC address range in 5GS indicator in the Extended protocol configuration options IE.\nIf the UE supports reporting of URSP rule enforcement and is indicated to send URSP rule enforcement report to network based on the matching URSP rule which contains the URSP rule enforcement report indication set to \"URSP rule enforcement report is required\", the UE shall include the URSP rule enforcement reports IE in the PDU SESSION ESTABLISHMENT REQUEST message.\nThe UE shall transport:\na)\tthe PDU SESSION ESTABLISHMENT REQUEST message;\nb)\tthe PDU session ID of the PDU session being established, being handed over, being transferred, or been established as an MA PDU session;\nc)\tif the request type is set to:\n1)\t\"initial request\" or \"MA PDU request\" and the UE determined to establish a new PDU session or an MA PDU session based on either a URSP rule including one or more S-NSSAIs in the URSP (see subclause\u00a06.2.9) or UE local configuration, according to subclause\u00a04.2.2 of 3GPP\u00a0TS\u00a024.526\u00a0[19]:\ni)\tif the UE is in the HPLMN or the subscribed SNPN, an S-NSSAI in the allowed NSSAI which corresponds to one of the S-NSSAI(s) in the matching URSP rule, if any, or else to the S-NSSAI(s) in the UE local configuration or in the default URSP rule, if any, according to the conditions given in subclause\u00a04.2.2 of 3GPP\u00a0TS\u00a024.526\u00a0[19];\nii)\tif the UE is in a non-subscribed SNPN, the UE determined according to the conditions given in subclause\u00a04.2.2 of 3GPP\u00a0TS\u00a024.526\u00a0[19] to establish a new PDU session or an MA PDU session based on a URSP rule including one or more S-NSSAIs, and the URSP rule is a part of a non-subscribed SNPN signalled URSP (see 3GPP\u00a0TS\u00a024.526\u00a0[19]):\nA)\tan S-NSSAI in the allowed NSSAI, which is one of the S-NSSAI(s) in the URSP rule; and\nB)\ta mapped S-NSSAI associated with the S-NSSAI in A); or\niii)\totherwise:\nA)\tone of the mapped S-NSSAI(s) which is equal to one of the S-NSSAI(s) in the matching URSP rule, if any, or else to the S-NSSAI(s) in the UE local configuration or in the default URSP rule, if any, according to the conditions given in subclause\u00a04.2.2 of 3GPP\u00a0TS\u00a024.526\u00a0[19]; and\nB)\tthe S-NSSAI in the allowed NSSAI associated with the S-NSSAI in A); or\n1a)\t\"initial request\" and the UE determined to establish a new PDU session based on the PDU session parameters for 5G ProSe layer-3 UE-to-network relay UE including an S-NSSAI in the UE policies for 5G ProSe UE-to-network relay UE as defined in 3GPP\u00a0TS\u00a024.555\u00a0[19F]:\ni)\tin case of a non-roaming scenario, an S-NSSAI in the allowed NSSAI which corresponds to the S-NSSAI in the selected PDU session parameters for 5G ProSe layer-3 UE-to-network relay UE, if any; or\nii)\tin case of a roaming scenario:\nA)\tone of the mapped S-NSSAI(s) which corresponds to the S-NSSAI in the selected PDU session parameters for 5G ProSe layer-3 UE-to-network relay UE, if any; and\nB)\tthe S-NSSAI in the allowed NSSAI associated with the S-NSSAI in A);\nNOTE\u00a012:\tWhen the UE is roaming, an AMF compliant with earlier versions of the specification can omit providing to the UE a mapped S-NSSAI for one or more S-NSSAIs in the allowed NSSAI and the UE then locally sets the mapped S-NSSAI as described in subclause\u00a04.6.2.1.\n1b)\t\"initial request\" and the UE has the partially allowed NSSAI and determined to establish a new PDU session based on either a URSP rule including one or more S-NSSAIs in the URSP (see subclause\u00a06.2.9) or UE local configuration, according to subclause\u00a04.2.2 of 3GPP\u00a0TS\u00a024.526\u00a0[19]:\ni)\tif the UE is in the HPLMN or the subscribed SNPN and the current TA is in the list of TAs for which the S-NSSAI is allowed, an S-NSSAI in the partially allowed NSSAI which corresponds to one of the S-NSSAI(s) in the matching URSP rule, if any, or else to the S-NSSAI(s) in the UE local configuration or in the default URSP rule, if any, according to the conditions given in subclause\u00a04.2.2 of 3GPP\u00a0TS\u00a024.526\u00a0[19];\nii)\tif the UE is in the VPLMN or a non-subscribed SNPN, the UE determined according to the conditions given in subclause\u00a04.2.2 of 3GPP\u00a0TS\u00a024.526\u00a0[19] to establish a new PDU session based on a URSP rule including one or more S-NSSAIs, the URSP rule is a part of a non-subscribed SNPN signalled URSP (see 3GPP\u00a0TS\u00a024.526\u00a0[19]) and the current TA is in the list of TAs for which the S-NSSAI is allowed:\nA)\tan S-NSSAI in the partially allowed NSSAI, which is one of the S-NSSAI(s) in the URSP rule; and\nB)\ta mapped S-NSSAI associated with the S-NSSAI in A); or\n2)\t\"existing PDU session\", an S-NSSAI, which is an S-NSSAI in the allowed NSSAI associated with the PDU session and (in roaming scenarios) a mapped S-NSSAI, with exception when S-NSSAI is not provided by the network in subclause\u00a06.1.4.2;\nc1)\tthe alternative S-NSSAI associated with the S-NSSAI to be replaced, if an alternative S-NSSAI for the S-NSSAI or the mapped S-NSSAI exists;\nd)\tif the request type is set to:\n1)\t\"initial request\" or \"MA PDU request\" and the UE determined to establish a new PDU session or an MA PDU session based on either a URSP rule including one or more DNNs in the URSP (see subclause\u00a06.2.9) or UE local configuration, according to subclause\u00a04.2.2 of 3GPP\u00a0TS\u00a024.526\u00a0[19], a DNN which corresponds to one of the DNN(s) in the matching URSP rule, if any, or else to the DNN(s) in the UE local configuration or in the default URSP rule, if any, according to the conditions given in subclause\u00a04.2.2 of 3GPP\u00a0TS\u00a024.526\u00a0[19];\n1a)\t\"initial request\" and the UE determined to establish a new PDU session based on the PDU session parameters for 5G ProSe layer-3 UE-to-network relay UE including a DNN in the UE policies for 5G ProSe UE-to-network relay UE as defined in 3GPP\u00a0TS\u00a024.555\u00a0[19F], a DNN which corresponds to the DNN in the selected PDU session parameters for 5G ProSe layer-3 UE-to-network relay UE, if any; or\n2)\t\"existing PDU session\", a DNN which is a DNN associated with the PDU session;\ne)\tthe request type which is set to:\n1)\t\"initial request\", if the UE is not registered for emergency services and the UE requests to establish a new non-emergency PDU session;\n2)\t\"existing PDU session\", if the UE is not registered for emergency services and the UE requests:\ni)\thandover of an existing non-emergency PDU session between 3GPP access and non-3GPP access;\nii)\ttransfer of an existing PDN connection for non-emergency bearer services in the EPS to the 5GS; or\niii)\ttransfer of an existing PDN connection for non-emergency bearer services in an untrusted non-3GPP access connected to the EPC to the 5GS;\n3)\t\"initial emergency request\", if the UE requests to establish a new emergency PDU session;\n4)\t\"existing emergency PDU session\", if the UE requests:\ni)\thandover of an existing emergency PDU session between 3GPP access and non-3GPP access;\nii)\ttransfer of an existing PDN connection for emergency bearer services in the EPS to the 5GS; or\niii)\ttransfer of an existing PDN connection for emergency bearer services in an untrusted non-3GPP access connected to the EPC to the 5GS; or\n5)\t\"MA PDU request\", if:\ni)\tthe UE requests to establish an MA PDU session;\nii)\tthe UE requests to establish user plane resources over other access of an MA PDU session established over one access only; or\niii)\tthe UE performs inter-system change from S1 mode to N1 mode according to subclause\u00a04.8.2.3.1 and requests transfer of a PDN connection which is a user plane resource of an MA PDU session; and\nf)\tthe old PDU session ID which is the PDU session ID of the existing PDU session, if the UE initiates the UE-requested PDU session establishment procedure upon receiving the PDU SESSION MODIFICATION COMMAND messages with the 5GSM cause IE set to #39 \"reactivation requested\";\nNOTE\u00a013:\tIf the PDU SESSION MODIFICATION COMMAND message included alternative S-NSSAI, the UE includes alternative S-NSSAI in the PDU SESSION ESTABLISHMENT REQUEST message for PDU session re-establishment.\nusing the NAS transport procedure as specified in subclause\u00a05.4.5, and the UE shall start timer T3580 (see example in figure\u00a06.4.1.2.1).\nFor bullet c) 1), if the matching URSP rule does not have an associated S-NSSAI, or if the UE does not have any matching URSP rule and there is no S-NSSAI in the UE local configuration or in the default URSP rule, the UE shall not provide any S-NSSAI in a PDU session establishment procedure.\nFor bullet c) 1a), if the selected PDU session parameters for 5G ProSe layer-3 UE-to-network relay UE do not have an associated S-NSSAI, the UE shall not provide any S-NSSAI in a PDU session establishment procedure.\nFor bullet d) 1), \n-\tIf the matching non-default URSP rule does not have an associated DNN, then the UE shall not provide any DNN in a PDU session establishment procedure;\n-\tIf the UE does not have any matching non-default URSP rule, the UE requests a connectivity that requires PAP/CHAP and the UE is configured with the default DNN for the S-NSSAI in the UE local configuration corresponding to the request, then the UE should provide such DNN in a PDU session establishment procedure;\n-\tIf the UE does not have any matching non-default URSP rule, the UE requests a connectivity that requires PAP/CHAP, the UE is not configured with the default DNN for the S-NSSAI in the UE local configuration corresponding to the request, and the application provides the DNN, then the UE shall use such DNN in a PDU session establishment procedure;\n-\tIf the UE does not have any matching non-default URSP rule, the UE requests a connectivity that does not require PAP/CHAP, the UE is not configured with the DNN for the S-NSSAI in the UE local configuration corresponding to the request, and the application provides the DNN, then the UE shall use such DNN in a PDU session establishment procedure;\n-\tIf the UE does not have any matching non-default URSP rule, the UE requests a connectivity that requires PAP/CHAP, the UE is not configured with the default DNN for the S-NSSAI in the UE local configuration corresponding to the request, the application does not provide the DNN and there is no DNN in the default URSP rule, then the UE shall not provide any DNN in a PDU session establishment procedure; or\n-\tIf the UE does not have any matching non-default URSP rule, the UE requests a connectivity that does not require PAP/CHAP, the UE is not configured with the DNN for the S-NSSAI in the UE local configuration corresponding to the request, the application does not provide the DNN and there is no DNN in the default URSP rule, then the UE shall not provide any DNN in a PDU session establishment procedure.\nFor bullet d) 1a), if the selected the PDU session parameters for 5G ProSe layer-3 UE-to-network relay UE do not have an associated DNN, the UE shall not provide any DNN in a PDU session establishment procedure.\nIf the request type is set to \"initial emergency request\" or \"existing emergency PDU session\" or the UE is registered for onboarding services in SNPN, neither DNN nor S-NSSAI is transported by the UE using the NAS transport procedure as specified in subclause\u00a05.4.5.\n\nFigure\u00a06.4.1.2.1: UE-requested PDU session establishment procedure\nUpon receipt of a PDU SESSION ESTABLISHMENT REQUEST message, a PDU session ID, optionally an S-NSSAI associated with (in roaming scenarios) a mapped S-NSSAI, optionally a DNN determined by the AMF, optionally a DNN selected by the network (if different from the DNN determined by the AMF), the request type, and optionally an old PDU session ID, the SMF checks whether connectivity with the requested DN can be established. If the requested DNN is not included, the SMF shall use the default DNN.\nIf the PDU session being established is a non-emergency PDU session, the request type is not set to \"existing PDU session\" and the PDU session authentication and authorization by the external DN is required due to local policy, the SMF shall check whether the PDU SESSION ESTABLISHMENT REQUEST message includes the SM PDU DN request container IE or the Service-level-AA container IE.\nIf the PDU session being established is a non-emergency PDU session, the request type is not set to \"existing PDU session\", the SM PDU DN request container IE is included in the PDU SESSION ESTABLISHMENT REQUEST message, the PDU session authentication and authorization by the external DN is required due to local policy and user's subscription data, and:\na)\tthe information for the PDU session authentication and authorization by the external DN in the SM PDU DN request container IE is compliant with the local policy and user's subscription data, the SMF shall proceed with the EAP Authentication procedure specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] and refrain from accepting or rejecting the PDU SESSION ESTABLISHMENT REQUEST message until the EAP Authentication procedure finalizes; or\nb)\tthe information for the PDU session authentication and authorization by the external DN in the SM PDU DN request container IE is not compliant with the local policy and user's subscription data, the SMF shall consider it as an abnormal case and proceed as specified in subclause\u00a06.4.1.7.\nIf the PDU session being established is a non-emergency PDU session, the request type is not set to \"existing PDU session\", the SM PDU DN request container IE is not included in the PDU SESSION ESTABLISHMENT REQUEST message and the PDU session authentication and authorization by the external DN is required due to local policy and user's subscription data, the SMF shall proceed with the EAP Authentication procedure specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] and refrain from accepting or rejecting the PDU SESSION ESTABLISHMENT REQUEST message until the EAP Authentication procedure finalizes.\nIf the SMF receives the old PDU session ID from the AMF and a PDU session exists for the old PDU session ID, the SMF shall consider that the request for the relocation of SSC mode 3 PDU session anchor with multiple PDU sessions as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9] is accepted by the UE.\nIf the SMF receives the onboarding indication from the AMF, the SMF shall consider that the PDU session is established for onboarding services in SNPN.\nIf the UE has set the TPMIC bit to \"Transfer of port management information containers supported\" in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message and has included a DS-TT Ethernet port MAC address IE (if the PDU session type is \"Ethernet\"), the Port management information container IE, and, optionally, the UE-DS-TT residence time IE in the PDU SESSION ESTABLISHMENT REQUEST message, the SMF shall operate as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9] subclause\u00a04.3.2.2.1.\nIf requested by the upper layers, the UE supporting UAS services shall initiate a request to establish a PDU session for UAS services, where the UE:\na)\tshall include the service-level device ID with the value set to the CAA-level UAV ID;\nb)\tif provided by the upper layers, shall include the service-level-AA server address, with the value set to the USS address; and\nc)\tif provided by the upper layers, shall include:\ni)\tthe service-level-AA payload type, with the value set to \"UUAA payload\"; and\nii)\tthe service-level-AA payload, with the value set to UUAA payload,\nin the Service-level-AA container IE of the PDU SESSION ESTABLISHMENT REQUEST message.\nIf the PDU session being established is a non-emergency PDU session, the request type is not set to \"existing PDU session\", the Service-level-AA container IE is included in the PDU SESSION ESTABLISHMENT REQUEST message, and\na)\tthe service-level authentication and authorization by the external DN is required due to local policy;\nb)\tthere is a valid user's subscription information for the requested DNN or for the requested DNN and S-NSSAI; and\nc)\tthe information for the service-level authentication and authorization by the external DN in the Service-level-AA container IE includes CAA-level UAV ID,\nthen the SMF shall proceed with the UUAA-SM procedure as specified in 3GPP\u00a0TS\u00a023.256\u00a0[6AB] and refrain from accepting or rejecting the PDU SESSION ESTABLISHMENT REQUEST message until the service-level authentication and authorization procedure is completed.\nThe UE supporting UAS services shall not request a PDU session establishment procedure to the same DNN (or no DNN, if no DNN was indicated by the UE) and the same S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the UE) for which the UE has requested a service level authentication and authorization procedure which is ongoing.\nIf the PDU SESSION ESTABLISHMENT REQUEST message includes the PDU session pair ID IE, the RSN IE, or both, the SMF shall operate as specified in subclause\u00a05.33.2 of 3GPP\u00a0TS\u00a023.501\u00a0[8].\n6.4.1.3\tUE-requested PDU session establishment procedure accepted by the network\nIf the connectivity with the requested DN is accepted by the network, the SMF shall create a PDU SESSION ESTABLISHMENT ACCEPT message.\nIf the UE requests establishing an emergency PDU session, the network shall not check for service area restrictions or subscription restrictions when processing the PDU SESSION ESTABLISHMENT REQUEST message.\nThe SMF shall set the Authorized QoS rules IE of the PDU SESSION ESTABLISHMENT ACCEPT message to the authorized QoS rules of the PDU session and may include the authorized QoS flow descriptions IE of the PDU SESSION ESTABLISHMENT ACCEPT message set to the authorized QoS flow descriptions of the PDU session.\nNOTE\u00a01:\tThis is applicable also if the PDU session establishment procedure was initiated to perform handover of an existing PDU session between 3GPP access and non-3GPP access, and even if the authorized QoS rules and authorized QoS flow descriptions for source and target access of the handover are the same.\nThe SMF shall ensure that the number of the packet filters used in the authorized QoS rules of the PDU Session does not exceed the maximum number of packet filters supported by the UE for the PDU session. If the received request type is \"initial emergency request\", the SMF shall set the Authorized QoS flow descriptions IE according to the QoS parameters used for establishing emergency services as specified in subclause\u00a05.16.4 of 3GPP\u00a0TS\u00a023.501\u00a0[8].\nSMF shall set the Authorized QoS flow descriptions IE to the authorized QoS flow descriptions of the PDU session, if:\na)\tthe Authorized QoS rules IE contains at least one GBR QoS flow;\nb)\tthe QFI is not the same as the 5QI of the QoS flow identified by the QFI;\nc)\tthe QoS flow can be mapped to an EPS bearer as specified in subclause\u00a04.11.1 of 3GPP\u00a0TS\u00a023.502\u00a0[9]; or\nd)\tthe QoS flow is established for the PDU session used for relaying, as specified in subclause\u00a05.6.2.1 of 3GPP\u00a0TS\u00a023.304\u00a0[6E].\nNOTE\u00a02:\tIn cases other than above listed cases, it is up to the SMF implementation to include the authorized QoS flow description for the QoS flow in the Authorized QoS flow descriptions IE of the PDU SESSION ESTABLISHMENT ACCEPT message.\nIf interworking with EPS is supported for the PDU session, the SMF shall set in the PDU SESSION ESTABLISHMENT ACCEPT message:\na)\tthe Mapped EPS bearer contexts IE to the EPS bearer contexts mapped from one or more QoS flows of the PDU session; and\nb)\tthe EPS bearer identity parameter in the Authorized QoS flow descriptions IE to the EPS bearer identity corresponding to the QoS flow, for each QoS flow which can be transferred to EPS.\nIf the \"Create new EPS bearer\" operation code in the Mapped EPS bearer contexts IE was received, and there is no corresponding Authorized QoS flow descriptions IE in the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall send a PDU SESSION MODIFICATION REQUEST message including a Mapped EPS bearer contexts IE to delete the mapped EPS bearer context. If the EPS bearer identity parameter in the Authorized QoS flow descriptions IE was received, the operation code is \"Create new QoS flow description\" and there is no corresponding Mapped EPS bearer contexts IE in the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall not diagnose an error, and shall keep storing the association between the QoS flow and the corresponding EPS bearer identity.\nFurthermore, the SMF shall store the association between the QoS flow and the mapped EPS bearer context, for each QoS flow which can be transferred to EPS.\nThe SMF shall set the selected SSC mode IE of the PDU SESSION ESTABLISHMENT ACCEPT message to:\na)\tthe received SSC mode in the SSC mode IE included in the PDU SESSION ESTABLISHMENT REQUEST message based on one or more of the PDU session type, the subscription and the SMF configuration;\nb)\teither the default SSC mode for the data network listed in the subscription or the SSC mode associated with the SMF configuration, if the SSC mode IE is not included in the PDU SESSION ESTABLISHMENT REQUEST message.\nNOTE\u00a03:\tFor bullet b), to avoid issues for UEs not supporting all SSC modes, the network operator can, in the subscription data and local configuration, include at least SSC mode 1 in the allowed SSC modes, and set the default SSC mode to \"SSC mode 1\" as per 3GPP TS 23.501 [8].\nIf the PDU session is an emergency PDU session, the SMF shall set the Selected SSC mode IE of the PDU SESSION ESTABLISHMENT ACCEPT message to \"SSC mode 1\". If the PDU session is a non-emergency PDU session of \"Ethernet\" or \"Unstructured\" PDU session type, the SMF shall set the Selected SSC mode IE to \"SSC mode 1\" or \"SSC mode 2\". If the PDU session is a non-emergency PDU session of \"IPv4\", \"IPv6\" or \"IPv4v6\" PDU session type, the SMF shall set the selected SSC mode IE to \"SSC mode 1\", \"SSC mode 2\", or \"SSC mode 3\".\nIf the PDU session is a non-emergency PDU session and the UE is not registered for onboarding services in SNPN, the SMF shall set the S-NSSAI IE of the PDU SESSION ESTABLISHMENT ACCEPT message to:\na)\tthe S-NSSAI of the PDU session; and\nb)\tthe mapped S-NSSAI (in roaming scenarios).\nThe S-NSSAI or the mapped S-NSSAI (in roaming scenarios) of the PDU session shall be the alternative S-NSSAI if the SMF has received an alternative S-NSSAI from the AMF.\nThe SMF shall set the Selected PDU session type IE of the PDU SESSION ESTABLISHMENT ACCEPT message to the selected PDU session type, i.e. the PDU session type of the PDU session.\nIf the PDU SESSION ESTABLISHMENT REQUEST message includes a PDU session type IE set to \"IPv4v6\", the SMF shall select \"IPv4\", \"IPv6\" or \"IPv4v6\" as the Selected PDU session type. If the subscription, the SMF configuration, or both, are limited to IPv4 only or IPv6 only for the DNN selected by the network, the SMF shall include the 5GSM cause value #50 \"PDU session type IPv4 only allowed\", or #51 \"PDU session type IPv6 only allowed\", respectively, in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT ACCEPT message.\nIf the selected PDU session type is \"IPv4\", the SMF shall include the PDU address IE in the PDU SESSION ESTABLISHMENT ACCEPT message and shall set the PDU address IE to an IPv4 address is allocated to the UE in the PDU session.\nIf the selected PDU session type is \"IPv6\", the SMF shall include the PDU address IE in the PDU SESSION ESTABLISHMENT ACCEPT message and shall set the PDU address IE to an interface identifier for the IPv6 link local address allocated to the UE in the PDU session.\nIf the selected PDU session type is \"IPv4v6\", the SMF shall include the PDU address IE in the PDU SESSION ESTABLISHMENT ACCEPT message and shall set the PDU address IE to an IPv4 address and an interface identifier for the IPv6 link local address, allocated to the UE in the PDU session.\nIf the selected PDU session type of a PDU session established by the W-AGF acting on behalf of the FN-RG is \"IPv4v6\" or \"IPv6\", the SMF shall also indicate the SMF's IPv6 link local address in the PDU address IE of the PDU SESSION ESTABLISHMENT ACCEPT message.\nIf the PDU session is a non-emergency PDU session and the UE is not registered for onboarding services in SNPN, the SMF shall set the DNN IE of the PDU SESSION ESTABLISHMENT ACCEPT message to the DNN determined by the AMF of the PDU session.\nThe SMF shall set the Session-AMBR IE of the PDU SESSION ESTABLISHMENT ACCEPT message to the Session-AMBR of the PDU session.\nIf the selected PDU session type is \"IPv4\", \"IPv6\", \"IPv4v6\" or \"Ethernet\" and if the PDU SESSION ESTABLISHMENT REQUEST message includes a 5GSM capability IE with the RQoS bit set to \"Reflective QoS supported\", the SMF shall consider that reflective QoS is supported for QoS flows belonging to this PDU session and may include the RQ timer IE set to an RQ timer value in the PDU SESSION ESTABLISHMENT ACCEPT message.\nIf the selected PDU session type is \"IPv4\", \"IPv6\", \"IPv4v6\" or \"Ethernet\" and if the PDU SESSION ESTABLISHMENT REQUEST message includes a Maximum number of supported packet filters IE, the SMF shall consider this number as the maximum number of packet filters that can be supported by the UE for this PDU session. Otherwise the SMF considers that the UE supports 16 packet filters for this PDU session.\nThe SMF shall consider that the maximum data rate per UE for user-plane integrity protection supported by the UE for uplink and the maximum data rate per UE for user-plane integrity protection supported by the UE for downlink are valid for the lifetime of the PDU session.\nIf the value of the RQ timer is set to \"deactivated\" or has a value of zero, the UE considers that RQoS is not applied for this PDU session.\nNOTE\u00a04:\tIf the 5G core network determines that reflective QoS is to be used for a QoS flow, the SMF sends reflective QoS indication (RQI) to UPF to activate reflective QoS. If the QoS flow is established over 3GPP access, the SMF also includes reflective QoS Attribute (RQA) in QoS profile of the QoS flow during QoS flow establishment.\nIf the selected PDU session type is \"IPv6\" or \"IPv4v6\" and if the PDU SESSION ESTABLISHMENT REQUEST message includes a 5GSM capability IE with the MH6-PDU bit set to \"Multi-homed IPv6 PDU session supported\", the SMF shall consider that this PDU session is supported to use multiple IPv6 prefixes.\nIf the selected PDU session type is \"Ethernet\", the PDU SESSION ESTABLISHMENT REQUEST message includes a 5GSM capability IE with the EPT-S1 bit set to \"Ethernet PDN type in S1 mode supported\" and the network supports Ethernet PDN type in S1 mode, the SMF shall set the EPT-S1 bit of the 5GSM network feature support IE of the PDU SESSION ESTABLISHMENT ACCEPT message to \"Ethernet PDN type in S1 mode supported\".\nIf the AMF has indicated to the SMF that the UE supports the non-3GPP access path switching and the SMF supports the non-3GPP access path switching, the SMF shall set the NAPS bit of the 5GSM network feature support IE of the PDU SESSION ESTABLISHMENT ACCEPT message to \"non-3GPP access path switching supported\".\nIf the DN authentication of the UE was performed and completed successfully, the SMF shall set the EAP message IE of the PDU SESSION ESTABLISHMENT ACCEPT message to an EAP-success message as specified in IETF\u00a0RFC\u00a03748\u00a0[34], provided by the DN.\nBased on local policies or configurations in the SMF and the Always-on PDU session requested IE in the PDU SESSION ESTABLISHMENT REQUEST message (if available), if the SMF determines that either:\na)\tthe requested PDU session needs to be established as an always-on PDU session (e.g. because the PDU session is for time synchronization or TSC, for URLLC, or for both), the SMF shall include the Always-on PDU session indication IE in the PDU SESSION ESTABLISHMENT ACCEPT message and shall set the value to \"Always-on PDU session required\"; or\nb)\tthe requested PDU session shall not be established as an always-on PDU session and:\ni)\tif the UE included the Always-on PDU session requested IE, the SMF shall include the Always-on PDU session indication IE in the PDU SESSION ESTABLISHMENT ACCEPT message and shall set the value to \"Always-on PDU session not allowed\"; or\nii)\tif the UE did not include the Always-on PDU session requested IE, the SMF shall not include the Always-on PDU session indication IE in the PDU SESSION ESTABLISHMENT ACCEPT message.\nIf the PDU session is an MA PDU session, the SMF shall include the ATSSS container IE in the PDU SESSION ESTABLISHMENT ACCEPT message. The SMF shall set the content of the ATSSS container IE as specified in 3GPP\u00a0TS\u00a024.193\u00a0[13B]. If the UE requests to establish user plane resources over the second access of an MA PDU session which has already been established over the first access and the parameters associated with ATSSS previously provided to the UE are not to be updated, the \"ATSSS container contents\" shall not be included in the ATSSS container IE in the PDU SESSION ESTABLISHMENT ACCEPT message.\nIf the PDU session is a single access PDU session containing the MA PDU session information IE with the value set to \"MA PDU session network upgrade is allowed\" and:\na)\tif the SMF decides to establish a single access PDU session, the SMF shall not include the ATSSS container IE in the PDU SESSION ESTABLISHMENT ACCEPT message; or\nb)\tif the SMF decides to establish an MA PDU session, the SMF shall include the ATSSS container IE in the PDU SESSION ESTABLISHMENT ACCEPT message, which indicates to the UE that the requested single access PDU session was established as an MA PDU Session.\nIf the network decides that the PDU session is only for control plane CIoT 5GS optimization, the SMF shall include the control plane only indication in the PDU SESSION ESTABLISHMENT ACCEPT message.\nIf:\na)\tthe UE provided the IP header compression configuration IE in the PDU SESSION ESTABLISHMENT REQUEST message; and\nb)\tthe SMF supports IP header compression for control plane CIoT 5GS optimization;\nthe SMF shall include the IP header compression configuration IE in the PDU SESSION ESTABLISHMENT ACCEPT message.\nIf:\na)\tthe UE provided the Ethernet header compression configuration IE in the PDU SESSION ESTABLISHMENT REQUEST message; and\nb)\tthe SMF supports Ethernet header compression for control plane CIoT 5GS optimization;\nthe SMF shall include the Ethernet header compression configuration IE in the PDU SESSION ESTABLISHMENT ACCEPT message.\nIf the PDU SESSION ESTABLISHMENT REQUEST included the Requested MBS container IE with the MBS operation set to \"Join MBS session\", the SMF:\na)\tshall include the TMGI for the multicast MBS session IDs that the UE is allowed to join, if any, in the Received MBS container IE, shall set the MBS decision to \"MBS join is accepted\" for each of those Received MBS information, may include the MBS start time to indicate the time when the multicast MBS session starts and shall include the MBS security container in each of those Received MBS information if security protection is applied for that multicast MBS session and the control plane security procedure is used as specified in annex\u00a0W.4.1.2 in 3GPP\u00a0TS\u00a033.501\u00a0[24], and shall use separate QoS flows dedicated for multicast by including the Authorized QoS flow descriptions IE if no separate QoS flows dedicated for multicast exist or if the SMF wants to establish new QoS flows dedicated for multicast;\nNOTE\u00a05:\tThe network determines whether security protection applies or not for the multicast MBS session as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24].\nb)\tshall include the TMGI for multicast MBS session IDs that the UE is not allowed to join, if any, in the Received MBS container IE, shall set the MBS decision to \"MBS join is rejected\" for each of those Received MBS information, shall set the Rejection cause for each of those Received MBS information with the reason of rejection, and if the Rejection cause is set to \"multicast MBS session has not started or will not start soon\", may include an MBS back-off timer value; and\nc)\tmay include in the Received MBS container IE the MBS service area for each multicast MBS session and include in it the MBS TAI list, the NR CGI list or both, that identify the service area(s) for the local MBS service\nNOTE\u00a06:\tFor an multicast MBS session that has multiple MBS service areas, the MBS service areas are indicated to the UE using MBS service announcement as described in 3GPP\u00a0TS\u00a023.247\u00a0[53], which is out of scope of this specification.\nin the PDU SESSION ESTABLISHMENT ACCEPT message. If the UE has set the Type of multicast MBS session ID to \"Source specific IP multicast address\" in the Requested multicast MBS container IE for certain MBS session(s) in the PDU SESSION ESTABLISHMENT REQUEST message, the SMF shall include the Source IP address information and Destination IP address information in the Received MBS information together with the TMGI for each of those multicast MBS sessions.\nNOTE\u00a07:\tIncluding the Source IP address information and Destination IP address information in the Received MBS information in that case is to allow the UE to perform the mapping between the requested multicast MBS session ID and the provided TMGI.\nNOTE\u00a08:\tIn SNPN, TMGI is used together with NID to identify an MBS Session.\nIf the request type is \"existing PDU session\", the SMF shall not perform network slice admission control for the PDU session, except for the following cases:\na)\twhen EPS counting is not required for the S-NSSAI of the PDU session for network slice admission control and the PDU session is established due to transfer the PDN connection from S1 mode to N1 mode in case of inter-system change; or\nb)\thandover of an existing PDU session between 3GPP access and non-3GPP access is performed.\nThe SMF shall send the PDU SESSION ESTABLISHMENT ACCEPT message.\nUpon receipt of a PDU SESSION ESTABLISHMENT ACCEPT message and a PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5, the UE shall stop timer T3580, shall release the allocated PTI value and shall consider that the PDU session was established.\nIf the PDU session establishment procedure was initiated to perform handover of an existing PDU session between 3GPP access and non-3GPP access, then upon receipt of the PDU SESSION ESTABLISHMENT ACCEPT message the UE shall locally delete any authorized QoS rules, authorized QoS flow descriptions, the session-AMBR and the parameters provided in the Protocol configuration options IE when in S1 mode or the Extended protocol configuration options IE stored for the PDU session before processing the new received authorized QoS rules, authorized QoS flow descriptions, the session-AMBR and the parameters provided in the Extended protocol configuration options IE, if any.\nNOTE\u00a09:\tFor the case of handover from 3GPP access to non-3GPP access, deletion of the QoS flow descriptions implies deletion of the associated EPS bearer identities, if any, and according to subclause\u00a06.1.4.1 also deletion of the associated EPS bearer contexts. Regarding the reverse direction, for PDU sessions via non-3GPP access the network does not allocate associated EPS bearer identities (see 3GPP\u00a0TS\u00a023.502\u00a0[9], subclause\u00a04.11.1.4.1).\nIf the PDU session establishment procedure was initiated to perform handover of an existing PDU session from 3GPP access to non-3GPP access and that existing PDU session is associated with one or more multicast MBS sessions, the UE shall locally leave the associated multicast MBS sessions and the SMF shall consider the UE as removed from the associated multicast MBS sessions.\nFor an MA PDU session already established on a single access, except for all those MA PDU sessions with a PDN connection established as a user-plane resource, upon receipt of PDU SESSION ESTABLISHMENT ACCEPT message over the other access:\na)\tthe UE shall delete the stored authorized QoS rules and the stored session-AMBR;\nb)\tif the authorized QoS flow descriptions IE is included in the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall delete the stored authorized QoS flow descriptions; and\nc)\tif the mapped EPS bearer contexts IE is included in the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall delete the stored mapped EPS bearer contexts.\nIf the UE supports network slice usage control and:\na)\ta PDU session is successfully established for the on-demand S-NSSAI, the UE shall stop and reset the slice deregistration inactivity timer for the on-demand S-NSSAI over corresponding access type, if running; and\nb)\tan MA PDU session is successfully established for the on-demand S-NSSAI, the UE shall stop and reset the slice deregistration inactivity timer for the on-demand S-NSSAI over both 3GPP access and non-3GPP access, if running.\nThe UE shall store the authorized QoS rules, and the session-AMBR received in the PDU SESSION ESTABLISHMENT ACCEPT message for the PDU session. The UE shall also store the authorized QoS flow descriptions if it is included in the Authorized QoS flow descriptions IE of the PDU SESSION ESTABLISHMENT ACCEPT message for the PDU session.\nIf the number of the authorized QoS rules, the number of the packet filters, or the number of the authorized QoS flow descriptions associated with the PDU session have reached the maximum number supported by the UE upon receipt of a PDU SESSION ESTABLISHMENT ACCEPT message, then the UE may initiate the PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #26 \"insufficient resources\".\nFor a PDU session that is being established with the request type set to \"initial request\", \"initial emergency request\" or \"MA PDU request\", or a PDU session that is being transferred from EPS to 5GS and established with the request type set to \"existing PDU session\" or \"existing emergency PDU session\" or a PDU session that is being handed over between non-3GPP access and 3GPP access and established with the request type set to \"existing PDU session\" or \"existing emergency PDU session \", the UE shall verify the authorized QoS rules and the authorized QoS flow descriptions provided in the PDU SESSION ESTABLISHMENT ACCEPT message for different types of errors as follows:\na)\tSemantic errors in QoS operations:\n1)\tWhen the rule operation is \"Create new QoS rule\", and the DQR bit is set to \"the QoS rule is the default QoS rule\" when there's already a default QoS rule.\n2)\tWhen the rule operation is \"Create new QoS rule\", and there is no rule with the DQR bit set to \"the QoS rule is the default QoS rule\".\n3)\tWhen the rule operation is \"Create new QoS rule\" and two or more QoS rules associated with this PDU session would have identical precedence values.\n4)\tWhen the rule operation is an operation other than \"Create new QoS rule\".\n5)\tWhen the rule operation is \"Create new QoS rule\", the DQR bit is set to \"the QoS rule is not the default QoS rule\", and the UE is in NB-N1 mode.\n6)\tWhen the rule operation is \"Create new QoS rule\" and there is already an existing QoS rule with the same QoS rule identifier.\n7)\tWhen the rule operation is \"Create new QoS rule\", the DQR bit is set to \"the QoS rule is not the default QoS rule\", and the PDU session type of the PDU session is \"Unstructured\".\n8)\tWhen the flow description operation is an operation other than \"Create new QoS flow description\".\n8a)\tWhen the flow description operation is \"Create new QoS flow description\" and there is already an existing QoS flow description with the same QoS flow identifier.\n9)\tWhen the flow description operation is \"Create new QoS flow description\", the QFI associated with the QoS flow description is not the same as the QFI of the default QoS rule and the UE is NB-N1 mode.\n10)\tWhen the flow description operation is \"Create new QoS flow description\", the QFI associated with the QoS flow description is not the same as the QFI of the default QoS rule, and the PDU session type of the PDU session is \"Unstructured\".\n11)\tWhen the rule operation is \"Create new QoS rule\" and the DQR bit is set to \"the QoS rule is not the default QoS rule\" and one match-all packet filter is to be associated with the QoS rule.\n\tIn case 4, case 5, or case 7 if the rule operation is for a non-default QoS rule, the UE shall send a PDU SESSION MODIFICATION REQUEST message to delete the QoS rule with 5GSM cause #83 \"semantic error in the QoS operation\".\n\tIn case 6, if the existing QoS rule is not the default QoS rule and the DQR bit of the new QoS rule is set to \"the QoS rule is not the default QoS rule\", the UE shall not diagnose an error, further process the create request and, if it was processed successfully, delete the old QoS rule (i.e. the QoS rule that existed when case 6 was detected). If the existing QoS rule is the default QoS rule or the DQR bit of the new QoS rule is set to \"the QoS rule is the default QoS rule\", the UE shall initiate a PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #83 \"semantic error in the QoS operation\".\n\tIn case 8, case 9, or case 10, the UE shall send a PDU SESSION MODIFICATION REQUEST message to delete the QoS flow description with 5GSM cause #83 \"semantic error in the QoS operation\".\n\tIn case 8a, the UE shall not diagnose an error, further process the create request and, if it was processed successfully, delete the old QoS flow description (i.e. the QoS flow description that existed when case 8a was detected).\n\tOtherwise for all the cases above, the UE shall initiate a PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #83 \"semantic error in the QoS operation\".\nb)\tSyntactical errors in QoS operations:\n1)\tWhen the rule operation is \"Create new QoS rule\", the QoS rule is a QoS rule of a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type, and the packet filter list in the QoS rule is empty.\n2)\tWhen the rule operation is \"Create new QoS rule\", the DQR bit is set to \"the QoS rule is the default QoS rule\", the PDU session type of the PDU session is \"Unstructured\", and the packet filter list in the QoS rule is not empty.\n3)\tWhen there are other types of syntactical errors in the coding of the Authorized QoS rules IE or the Authorized QoS flow descriptions IE, such as: a mismatch between the number of packet filters subfield and the number of packet filters in the packet filter list when the rule operation is create new QoS rule\", or the number of packet filters subfield is larger than the maximum possible number of packet filters in the packet filter list (i.e., there is no QoS rule precedence subfield included in the QoS rule IE), the QoS Rule Identifier is set to \"no QoS rule identifier assigned\", or the QoS flow identifier is set to \"no QoS flow identifier assigned\".\n4)\tWhen, the rule operation is \"Create new QoS rule\", there is no QoS flow description with a QFI corresponding to the QFI of the resulting QoS rule and the UE determines, by using the QoS rule\u2019s QFI as the 5QI, that there is a resulting QoS rule for a GBR QoS flow (as described in 3GPP\u00a0TS\u00a023.501\u00a0[8] table\u00a05.7.4-1).\n5)\tWhen the\tflow description operation is \"Create new QoS flow description\", and the UE determines that there is a QoS flow description of a GBR QoS flow (as described in 3GPP TS 23.501 [8] table 5.7.4-1) which lacks at least one of the mandatory parameters (i.e., GFBR uplink, GFBR downlink, MFBR uplink and MFBR downlink). If the QoS flow description does not include a 5QI, the UE determines this by using the QFI as the 5QI.\n\tIn case 1, case 3 or case 4, if the QoS rule is the default QoS rule, the UE shall initiate a PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #84 \"syntactical error in the QoS operation\". Otherwise, the UE shall send a PDU SESSION MODIFICATION REQUEST message including a requested QoS rule IE, a requested QoS flow description IE or both to delete the QoS rule, the QoS flow description or both with 5GSM cause #84 \"syntactical error in the QoS operation\".\n\tIn case 2, if the QoS rule is the default QoS rule, the UE shall send a PDU SESSION MODIFICATION REQUEST message including a requested QoS rule IE to delete all the packet filters of the default QoS rule. The UE shall include the 5GSM cause #84 \"syntactical error in the QoS operation\".\n\tIn case 5, if the default QoS rule is associated with the QoS flow description which lacks at least one of the mandatory parameters, the UE shall initiate a PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #84 \"syntactical error in the QoS operation\". Otherwise, the UE shall send a PDU SESSION MODIFICATION REQUEST message to delete the QoS flow description which lacks at least one of the mandatory parameters and the associated QoS rule(s), if any, with 5GSM cause #84 \"syntactical error in the QoS operation\".\nNOTE\u00a010:\tIt is not considered an error if the UE determines that after processing all QoS operations on QoS rules and QoS flow descriptions there is a QoS flow description that is not associated with any QoS rule and the UE is not in NB-N1 mode.\nc)\tSemantic errors in packet filters:\n1)\tWhen a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.\n\tIf the QoS rule is the default QoS rule, the UE shall initiate a PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #44 \"semantic error in packet filter(s)\". Otherwise, the UE shall send a PDU SESSION MODIFICATION REQUEST message to delete the QoS rule with 5GSM cause #44 \"semantic error in packet filter(s)\".\nd)\tSyntactical errors in packet filters:\n1)\tWhen the rule operation is \"Create new QoS rule\" and two or more packet filters in the resultant QoS rule would have identical packet filter identifiers.\n2)\tWhen there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.\n\tIf the QoS rule is the default QoS rule, the UE shall initiate a PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #45 \"syntactical errors in packet filter(s)\". Otherwise, the UE shall send a PDU SESSION MODIFICATION REQUEST message to delete the QoS rule with 5GSM cause #45 \"syntactical errors in packet filter(s)\".\nIf the Always-on PDU session indication IE is included in the PDU SESSION ESTABLISHMENT ACCEPT message and:\na)\tthe value of the IE is set to \"Always-on PDU session required\", the UE shall consider the established PDU session as an always-on PDU session; or\nb)\tthe value of the IE is set to \"Always-on PDU session not allowed\", the UE shall not consider the established PDU session as an always-on PDU session.\nThe UE shall not consider the established PDU session as an always-on PDU session if the UE does not receive the Always-on PDU session indication IE in the PDU SESSION ESTABLISHMENT ACCEPT message.\nThe UE shall store the mapped EPS bearer contexts, if received in the PDU SESSION ESTABLISHMENT ACCEPT message. Furthermore, the UE shall also store the association between the QoS flow and the mapped EPS bearer context, for each QoS flow which can be transferred to EPS, based on the received EPS bearer identity parameter in Authorized QoS flow descriptions IE and the mapped EPS bearer contexts. The UE shall check each mapped EPS bearer context for different types of errors as follows:\nNOTE\u00a011:\tAn error detected in a mapped EPS bearer context does not cause the UE to discard the Authorized QoS rules IE and Authorized QoS flow descriptions IE included in the PDU SESSION ESTABLISHMENT ACCEPT, if any.\na)\tSemantic error in the mapped EPS bearer operation:\n1)\tWhen the operation code is an operation code other than \"Create new EPS bearer\".\n2)\tWhen the operation code is \"Create new EPS bearer\" and there is already an existing mapped EPS bearer context with the same EPS bearer identity associated with any PDU session.\n3)\tWhen the operation code is \"Create new EPS bearer\" and the resulting mapped EPS bearer context has invalid mandatory parameters or missing mandatory parameters (e.g., mapped EPS QoS parameters or traffic flow template for a dedicated EPS bearer context).\n\tIn case 2, if the existing mapped EPS bearer context is associated with the PDU session that is being established, the UE shall not diagnose an error, further process the create request and, if it was process successfully, delete the old EPS bearer context.\n\tOtherwise, the UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #85 \"Invalid mapped EPS bearer identity\".\nb)\tif the mapped EPS bearer context includes a traffic flow template, the UE shall check the traffic flow template for different types of TFT IE errors as follows:\n1)\tSemantic errors in TFT operations:\ni)\tWhen the TFT operation is an operation other than \"Create new TFT\"\n\tThe UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #41 \"semantic error in the TFT operation\".\n2)\tSyntactical errors in TFT operations:\ni)\tWhen the TFT operation = \"Create new TFT\" and the packet filter list in the TFT IE is empty.\nii)\tWhen there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.\n\tThe UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message with to delete the mapped EPS bearer context 5GSM cause #42 \"syntactical error in the TFT operation\".\n3)\tSemantic errors in packet filters:\ni)\tWhen a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.\nii)\tWhen the resulting TFT, which is assigned to a dedicated EPS bearer context, does not contain any packet filter which applicable for the uplink direction.\n\tThe UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #44 \"semantic errors in packet filter(s)\".\n4)\tSyntactical errors in packet filters:\ni)\tWhen the TFT operation = \"Create new TFT\" and two or more packet filters in the resultant TFT would have identical packet filter identifiers.\nii)\tWhen the TFT operation = \"Create new TFT\" and two or more packet filters in all TFTs associated with this PDN connection would have identical packet filter precedence values.\niii)\tWhen there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.\n\tIn case\u00a0ii, if the old packet filters do not belong to the default EPS bearer context, the UE shall not diagnose an error and shall delete the old packet filters which have identical filter precedence values.\n\tIn case\u00a0ii, if one or more old packet filters belong to the default EPS bearer context, the UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #45 \"syntactical errors in packet filter(s)\".\n\tIn cases\u00a0i and\u00a0iii the UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #45 \"syntactical error in packet filter(s)\".\nIf the UE detects different errors in the mapped EPS bearer contexts, QoS rules or QoS flow descriptions, the UE may send a single PDU SESSION MODIFICATION REQUEST message to delete the erroneous mapped EPS bearer contexts, QoS rules or QoS flow descriptions. In that case, the UE shall include a single 5GSM cause in the PDU SESSION MODIFICATION REQUEST message.\nNOTE\u00a012:\tThe 5GSM cause to use cannot be different from: #41 \"semantic error in the TFT operation\", #42 \"syntactical error in the TFT operation\", #44 \"semantic error in packet filter(s)\", #45 \"syntactical errors in packet filter(s)\", #83 \"semantic error in the QoS operation\", #84 \"syntactical error in the QoS operation\", and #85 \"Invalid mapped EPS bearer identity\". The selection of a 5GSM cause is up to the UE implementation.\nIf there are mapped EPS bearer context(s) associated with a PDU session, but none of them is associated with the default QoS rule, the UE shall initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context(s) with 5GSM cause #85 \"Invalid mapped EPS bearer identity\" and shall locally delete the stored EPS bearer identity (EBI) in all the QoS flow descriptions of the PDU session, if any.\nThe UE shall only use the Control plane CIoT 5GS optimization for this PDU session if the Control plane only indication is included in the PDU SESSION ESTABLISHMENT ACCEPT message.\nIf the UE requests the PDU session type \"IPv4v6\" and:\na)\tthe UE receives the selected PDU session type set to \"IPv4\" and does not receive the 5GSM cause value #50 \"PDU session type IPv4 only allowed\"; or\nb)\tthe UE receives the selected PDU session type set to \"IPv6\" and does not receive the 5GSM cause value #51 \"PDU session type IPv6 only allowed\";\nthe UE may subsequently request another PDU session for the other IP version using the UE-requested PDU session establishment procedure to the same DNN (or no DNN, if no DNN was indicated by the UE) and the same S-NSSAI associated with (in roaming scenarios) a mapped S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the UE) with a single address PDN type (IPv4 or IPv6) other than the one already activated.\nIf the UE requests the PDU session type \"IPv4v6\", receives the selected PDU session type set to \"IPv4\" and the 5GSM cause value #50 \"PDU session type IPv4 only allowed\", the UE shall not subsequently request another PDU session using the UE-requested PDU session establishment procedure to the same DNN (or no DNN, if no DNN was indicated by the UE) and the same S-NSSAI associated with (in roaming scenarios) a mapped S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the UE) to obtain a PDU session type different from the one allowed by the network until any of the following conditions is fulfilled:\na)\tthe UE is registered to a new PLMN;\nb)\tthe UE is switched off;\nc)\tthe USIM is removed; \nd)\tthe entry in the \"list of subscriber data\" for the current SNPN is updated if the UE does not support access to an SNPN using credentials from a credentials holder and equivalent SNPNs; or\ne)\tthe selected entry of the \"list of subscriber data\" is updated or USIM is removed for the selected PLMN subscription, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both.\nIf the UE requests the PDU session type \"IPv4v6\", receives the selected PDU session type set to \"IPv6\" and the 5GSM cause value #51 \"PDU session type IPv6 only allowed\", the UE shall not subsequently request another PDU session using the UE-requested PDU session establishment procedure to the same DNN (or no DNN, if no DNN was indicated by the UE) and the same S-NSSAI associated with (in roaming scenarios) a mapped S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the UE) to obtain a PDU session type different from the one allowed by the network until any of the following conditions is fulfilled:\na)\tthe UE is registered to a new PLMN;\nb)\tthe UE is switched off;\nc)\tthe USIM is removed\nd)\tthe entry in the \"list of subscriber data\" for the current SNPN is updated if the UE does not support access to an SNPN using credentials from a credentials holder and equivalent SNPNs; or\ne)\tthe selected entry of the \"list of subscriber data\" is updated or USIM is removed for the selected PLMN subscription, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both.\nNOTE\u00a013:\tFor the 5GSM cause values #50 \"PDU session type IPv4 only allowed\", and #51 \"PDU session type IPv6 only allowed\", re-attempt in S1 mode for the same DNN (or no DNN, if no DNN was indicated by the UE) is only allowed using the PDU session type(s) indicated by the network.\nIf the selected PDU session type of the PDU session is \"Unstructured\" or \"Ethernet\", the UE supports inter-system change from N1 mode to S1 mode, the UE does not support establishment of a PDN connection for the PDN type set to \"non-IP\" in S1 mode, and the parameters list field of one or more authorized QoS flow descriptions received in the Authorized QoS flow descriptions IE of the PDU SESSION ESTABLISHMENT ACCEPT message contains an EPS bearer identity (EBI), then the UE shall locally remove the EPS bearer identity (EBI) from the parameters list field of such one or more authorized QoS flow descriptions. Additionally the UE shall also initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #85 \"Invalid mapped EPS bearer identity\".\nIf the selected PDU session type of the PDU session is \"Ethernet\", the UE supports inter-system change from N1 mode to S1 mode, the UE does not support establishment of a PDN connection for the PDN type set to \"non-IP\" in S1 mode, the UE, the network or both of them do not support Ethernet PDN type in S1 mode, and the parameters list field of one or more authorized QoS flow descriptions received in the Authorized QoS flow descriptions IE of the PDU SESSION ESTABLISHMENT ACCEPT message contains an EPS bearer identity (EBI), then the UE shall locally remove the EPS bearer identity (EBI) from the parameters list field of such one or more authorized QoS flow descriptions. Additionally, the UE shall also initiate a PDU session modification procedure by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM cause #85 \"Invalid mapped EPS bearer identity\".\nFor a UE which is registered for disaster roaming services and for a PDU session which is not a PDU session for emergency services:\na)\tif the parameters list field of one or more authorized QoS flow descriptions received in the Authorized QoS flow descriptions IE of the PDU SESSION ESTABLISHMENT ACCEPT message contains an EPS bearer identity (EBI), then the UE shall locally remove the EPS bearer identity (EBI) from the parameters list field of such one or more authorized QoS flow descriptions; and\nb)\tthe UE shall locally delete the contents of the Mapped EPS bearer contexts IE if it is received in the PDU SESSION ESTABLISHMENT ACCEPT message.\nIf the UE receives an IPv4 Link MTU parameter, an Ethernet Frame Payload MTU parameter, an Unstructured Link MTU parameter, or a Non-IP Link MTU parameter in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall pass to the upper layer the received IPv4 link MTU size, the received Ethernet frame payload MTU size, the unstructured link MTU size, or the non-IP link MTU size.\nNOTE\u00a014:\tThe IPv4 link MTU size corresponds to the maximum length of user data packet that can be sent either via the control plane or via N3 interface for a PDU session of the \"IPv4\" PDU session type.\nNOTE\u00a015:\tThe Ethernet frame payload MTU size corresponds to the maximum length of a payload of an Ethernet frame that can be sent either via the control plane or via N3 interface for a PDU session of the \"Ethernet\" PDU session type.\nNOTE\u00a016:\tThe unstructured link MTU size correspond to the maximum length of user data packet that can be sent either via the control plane or via N3 interface for a PDU session of the \"Unstructured\" PDU session type.\nNOTE\u00a017:\tA PDU session of \"Ethernet\" or \"Unstructured\" PDU session type can be transferred to a PDN connection of \"non-IP\" PDN type, thus the UE can request the non-IP link MTU parameter in the PDU session establishment procedure. The non-IP link MTU size corresponds to the maximum length of user data that can be sent either in the user data container in the ESM DATA TRANSPORT message or via S1-U interface as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15].\nIf the 5G-RG receives an ACS information parameter in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT ACCEPT message, the 5G-RG shall pass the ACS URL in the received ACS information parameter to the upper layer.\nIf the UE has indicated support for CIoT 5GS optimizations and receives a small data rate control parameters container in the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall store the small data rate control parameters value and use the stored small data rate control parameters value as the maximum allowed limit of uplink user data for the PDU session in accordance with 3GPP\u00a0TS\u00a023.501\u00a0[8].\nIf the UE has indicated support for CIoT 5GS optimizations and receives an additional small data rate control parameters for exception data container in the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall store the additional small data rate control parameters for exception data value and use the stored additional small data rate control parameters for exception data value as the maximum allowed limit of uplink exception data for the PDU session in accordance with 3GPP\u00a0TS\u00a023.501\u00a0[8].\nIf the UE has indicated support for CIoT 5GS optimizations and receives an initial small data rate control parameters container or an initial additional small data rate control parameters for exception data container in the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall use these parameters for the newly established PDU Session. When the validity period of the initial parameters expire, the parameters received in a small data rate control parameters container or an additional small data rate control parameters for exception data container shall be used.\nIf the UE receives a Serving PLMN rate control IE in the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall store the Serving PLMN rate control IE value and use the stored serving PLMN rate control value as the maximum allowed limit of uplink control plane user data for the corresponding PDU session in accordance with 3GPP\u00a0TS\u00a023.501\u00a0[8].\nIf the UE receives an APN rate control parameters container or an additional APN rate control for exception data parameters container in the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall store these parameters and use them to limit the rate at which it generates uplink user data messages for the PDN connection corresponding to the PDU session if the PDU session is transferred to EPS upon inter-system change from N1 mode to S1 mode in accordance with 3GPP\u00a0TS\u00a024.301\u00a0[15]. The received APN rate control parameters and additional APN rate control for exception data parameters shall replace any previously stored APN rate control parameters and additional APN rate control for exception data parameters, respectively, for this PDN connection.\nIf the UE receives an initial APN rate control parameters container or an initial additional APN rate control for exception data parameters container in the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall store these parameters in the APN rate control status and use them to limit the rate at which it generates exception data messages for the PDN connection corresponding to the PDU session if the PDU session is transferred to EPS upon inter-system change from N1 mode to S1 mode in accordance with 3GPP\u00a0TS\u00a024.301\u00a0[15]. The received APN rate control status shall replace any previously stored APN rate control status for this PDN connection.\nNOTE\u00a018:\tIn the PDU SESSION ESTABLISHMENT ACCEPT message, the SMF provides either APN rate control parameters container, or initial APN rate control parameters container, in the Extended protocol configuration options IE, but not both.\nNOTE\u00a019:\tIn the PDU SESSION ESTABLISHMENT ACCEPT message, the SMF provides either additional APN rate control for exception data parameters container, or initial additional APN rate control for exception data parameters container, in the Extended protocol configuration options IE, but not both.\nIf the network accepts the use of Reliable Data Service to transfer data for the PDU session, the network shall include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message and include the Reliable Data Service accepted indicator. The UE behaves as described in subclause\u00a06.2.15.\nIf \n-\tthe UE indicates support of DNS over (D)TLS by providing DNS server security information indicator to the network;\n-\toptionally, the UE indicates which security protocol type(s) are supported by the UE, by providing the DNS server security protocol support to the network; and\n-\tthe network wants to enforce the use of DNS over (D)TLS,\nthe network may include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message and include the DNS server security information with length of two octets. Upon receiving the DNS server security information, the UE shall pass it to the upper layer. The UE shall use this information to send the DNS over (D)TLS (See 3GPP\u00a0TS\u00a033.501\u00a0[24]).\nNOTE\u00a020:\tSupport of DNS over (D)TLS is based on the informative requirements as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] and it is implemented based on the operator requirement.\nIf the PDU SESSION ESTABLISHMENT REQUEST message includes the Service-level-AA container IE with the service-level device ID set to the CAA-level UAV ID, and the SMF is provided by the UAS-NF the successful UUAA-SM result and the CAA-level UAV ID, the SMF shall store the successful result together with the authorized CAA-level UAV ID and transmit the PDU SESSION ESTABLISHMENT ACCEPT message to the UE, where the PDU SESSION ESTABLISHMENT ACCEPT message shall include the Service-level-AA container IE containing:\na)\tthe service-level-AA response, with the SLAR field set to \"Service level authentication and authorization was successful\";\nb)\t the service-level device ID with the value set to the CAA-level UAV ID; and\nc)\tif a payload is received from the UAS-NF,the service-level-AA payload, with the value set to the payload;\nd)\tif a payload type associated with the payload is received from the UAS-NF, the service-level-AA payload type with the values set to the associated payload type.\nNOTE\u00a021:\tUAS security information can be included in the UUAA payload by the USS as specified in 3GPP\u00a0TS\u00a033.256\u00a0[24B].\nIf the network accepts the request of the PDU session establishment for C2 communication, the network shall send the PDU SESSION ESTABLISHMENT ACCEPT message including the Service-level-AA container IE containing:\na)\tthe service-level-AA response with the value of C2AR field set to the \"C2 authorization was successful\";\nb)\tif a payload is provided from the UAS-NF, the service-level-AA payload with the value set to the payload;\nc)\tif a payload type associated with the payload is provided from the UAS-NF, the service-level-AA payload type with the value set to the payload type; and\nd)\tif the CAA-level UAV ID is provided from the UAS-NF, the service-level device ID with the value set to the CAA-level UAV ID.\nNOTE\u00a022:The C2 authorization payload in the service-level-AA payload can include one or both of the C2 session security information, and pairing information for direct C2 communication.\nUpon receipt of the PDU SESSION ESTABLISHMENT ACCEPT message of the PDU session for C2 communication, if the Service-level-AA container IE is included, the UE shall forward the service-level-AA contents of the Service-level-AA container IE to the upper layers.\nThe SMF may be configured with one or more PVS IP addresses or PVS names or both associated with the DNN and S-NSSAI used for onboarding services in SNPN, for configuration of SNPN subscription parameters in PLMN via the user plane, or for configuration of a UE via the user plane with credentials for NSSAA or PDU session authentication and authorization procedure. If the PDU session was established for onboarding services in SNPN, or the PVS information request is included in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT REQUEST message establishing a PDU session providing connectivity for configuration of SNPN subscription parameters in PLMN via the user plane, the network may include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message and include the PVS IP address(es) or the PVS name(s) or both associated with the DNN and S-NSSAI of the established PDU session, if available. If the PVS information request is included in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT REQUEST message establishing the PDU session providing connectivity for configuration of a UE via the user plane with credentials for PDU session authentication and authorization procedure, based on the subscribed DNN(s) and S-NSSAI(s) of the UE and the DNN and S-NSSAI of the established PDU session, the network should include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message and include the PVS IP address(es) or the PVS name(s) or both, which are associated with the established PDU session and per subscribed DNN(s) and S-NSSAI(s) of the UE, if available. If the PVS information request is included in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT REQUEST message establishing the PDU session providing connectivity for configuration of a UE via the user plane with credentials for NSSAA, based on the subscribed S-NSSAI(s) of the UE and the S-NSSAI of the established PDU session, the network should include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message and include the PVS IP address(es) or the PVS name(s) or both, which are associated with the established PDU session and per subscribed S-NSSAI(s) of the UE, if available.\nNOTE\u00a023: If the PVS information request is included in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT REQUEST message establishing a PDU session providing connectivity for configuration of SNPN subscription parameters in SNPN via the user plane by a UE which is not registered for onboarding services in SNPN, the SMF can include the PVS IP address(es) or the PVS name(s) or both, associated with the DNN and S-NSSAI of the established PDU session, if available, in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT ACCEPT message.\nNOTE\u00a024:\tThe PVS IP address(es) or the PVS name(s) or both in the SMF can either be locally configured or provided by DCS. The SMF can send the PVS IP address(es) or the PVS name(s) or both that are available in the SMF as the PVS IP address(es) or the PVS name(s) or both to the UE, respectively. If the PDU session was established for onboarding services in SNPN not supporting localized services in SNPN, the PVS IP address(es) or the PVS name(s) or both provided by DCS takes precedence over the PVS IP address(es) or the PVS name(s) or both locally configured, respectively. If the PDU session was established for onboarding services in SNPN supporting localized services in SNPN, the SMF can include both the DCS provided PVS IP address(es) or the PVS name(s) or both associated with the DNN and S-NSSAI of the established PDU session and the locally configured PVS IP address(es) or the PVS name(s) or both associated with the DNN and S-NSSAI of the established PDU session, if available.\nThe UE upon receiving one or more PVS IP address(es), if any, one or more the PVS name(s), if any, or both shall pass them to the upper layers.\nNOTE\u00a025:\tIf several PVS IP addresses, several PVS name(s), or one or more PVS IP addresses and one or more PVS name(s) are received, how the UE uses this information is up to UE implementation.\nIf the UE indicates support for ECS configuration information provisioning by providing the ECS configuration information provisioning support indicator in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT REQUEST message, then the SMF may include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message with\n-\tat least one of ECS IPv4 Address(es), ECS IPv6 Address(es), and ECS FQDN(s); \n-\tat least one associated ECSP identifier; and \n-\toptionally, spatial validity conditions associated with the ECS address.\nThe UE upon receiving one or more ECS IPv4 address(es), if any, ECS IPv6 address(es), if any, or ECS FQDN(s), if any, with the associated spatial validity condition, if any, and an ECSP identifier shall pass them to the upper layers.\nNOTE\u00a026:\tThe IP address(es), FQDN(s), or both are associated with the ECSP identifier and replace previously provided ECS configuration information associated with the same ECSP identifier, if any.\nIf the SMF needs to provide DNS server address(es) to the UE and the UE has provided the DNS server IPv4 address request, the DNS server IPv6 address request or both of them, in the PDU SESSION ESTABLISHMENT REQUEST message, then the SMF shall include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message with one or more DNS server IPv4 address(es), one or more DNS server IPv6 address(es) or both of them. If the UE supports receiving DNS server addresses in protocol configuration options and receives one or more DNS server IPv4 address(es), one or more DNS server IPv6 address(es) or both of them, in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT ACCEPT message, then the UE shall pass the received DNS server IPv4 address(es), if any, and the received DNS server IPv6 address(es), if any, to upper layers.\nNOTE\u00a027:\tThe received DNS server address(es) replace previously provided DNS server address(es), if any.\nIf the PDU SESSION ESTABLISHMENT ACCEPT message includes the Received MBS container IE, for each of the Received MBS information:\na)\tif MBS decision is set to \"MBS join is accepted\", the UE shall consider that it has successfully joined the multicast MBS session. The UE shall store the received TMGI and shall use it for any further operation on that multicast MBS session. The UE shall store the received MBS service area associated with the received TMGI, if any, and provide the received TMGI to lower layers. The UE may provide the MBS start time if it is included in the Received MBS information to upper layers; or\nb)\tif MBS decision is set to \"MBS join is rejected\", the UE shall consider the requested join as rejected. The UE shall store the received MBS service area associated with the received TMGI, if any. If the received Rejection cause is set to \"User is outside of local MBS service area\", the UE shall not request to join the same multicast MBS session if neither current TAI nor CGI of the current cell is part of the received MBS service area. If the received Rejection cause is set to \"multicast MBS session has not started or will not start soon\" and an MBS back-off timer value is included with value that indicates neither zero nor deactivated, the UE shall start a back-off timer T3587 with the value provided in the MBS back-off timer value for the received TMGI, and shall not attempt to join the multicast MBS session with the same TMGI until the expiry of T3587. If the MBS back-off timer value indicates that this timer is deactivated, the UE shall not attempt to join the multicast MBS session with the same TMGI, the Source IP address information of the TMGI, or the Destination IP address information of the TMGI until the UE is switched off, the USIM is removed, or the entry in the \"list of subscriber data\" for the current SNPN is updated. If the MBS back-off timer value indicates zero, the UE may attempt to join the multicast MBS session with the same TMGI.\nIf the PDU session is established for IMS signalling and the UE has requested P-CSCF IPv6 address or P-CSCF IPv4 address, the SMF shall include P-CSCF IP address(es) in the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message.\nNOTE\u00a028:\tThe P-CSCF selection functionality is specified in subclause\u00a05.16.3.11 of 3GPP\u00a0TS\u00a023.501\u00a0[8].\nUpon receipt of the PDU SESSION ESTABLISHMENT ACCEPT message, if the UE included the PDU session pair ID in the PDU SESSION ESTABLISHMENT REQUEST message, the UE shall associate the PDU session with the PDU session pair ID. If the UE included the RSN in the PDU SESSION ESTABLISHMENT REQUEST message, the UE shall associate the PDU session with the RSN.\nIf the PDU SESSION ESTABLISHMENT ACCEPT message include alternative S-NSSAI, the S-NSSAI for the established PDU session shall be the S-NSSAI to be replaced and the alternative S-NSSAI on the UE side.\nIf the UE supports EDC and the network allows the use of EDC, the SMF shall include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message with the EDC usage allowed indicator. If the UE supports EDC and receives the EDC usage allowed indicator in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall indicate to upper layers that network allows the use of EDC.\nIf the UE supports EDC and the network requires the use of EDC, the SMF shall include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message with the EDC usage required indicator. If the UE supports EDC and receives the EDC usage required indicator in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall indicate to upper layers that network requires the use of EDC.\nIf the PDU SESSION ESTABLISHMENT REQUEST message includes a MS support of MAC address range in 5GS indicator in the Extended protocol configuration options IE, the SMF:\na)\tshall consider that the UE supports a \"destination MAC address range type\" packet filter component and a \"source MAC address range type\" packet filter component; and\nb)\tif the SMF supports a \"destination MAC address range type\" packet filter component and a \"source MAC address range type\" packet filter component and enables the UE to request QoS rules with a \"destination MAC address range type\" packet filter component and a \"source MAC address range type\" packet filter component, shall include the Extended protocol configuration options IE in the PDU SESSION ESTABLISHMENT ACCEPT message and shall include the Network support of MAC address range in 5GS indicator in the Extended protocol configuration options IE.\nIf the UE receives the 5GSM network feature support IE in the PDU SESSION ESTABLISHMENT ACCEPT message with the non-3GPP access path switching bit set to \"non-3GPP access path switching supported\" during the PDU session establishment procedure of any PDU session, the UE may include the NSONR bit with value set to \"non-3GPP path switching while using old non-3GPP resources requested\" in the Non-3GPP path switching information IE in the REGISTRATION REQUEST message while performing the registration procedure for mobility registration update for non-3GPP access path switching.\nNOTE\u00a029:\tIf the UE is registered to different PLMNs over 3GPP and non-3GPP accesses, the UE uses the capability received over non-3GPP access to determine whether to initiate the registration procedure for mobility registration update for non-3GPP path switching.\nNOTE\u00a030:\tIf the AMF selects an SMF not supporting non-3GPP access path switching, the non-3GPP access path switching can still be performed with the AMF triggering release of the old user plane resources before new user plane resources are established.\nIf the PDU SESSION ESTABLISHMENT ACCEPT message includes a Network support of MAC address range in 5GS indicator in the Extended protocol configuration options IE, the UE shall consider that the network supports a \"destination MAC address range type\" packet filter component and a \"source MAC address range type\" packet filter component.\nNOTE\u00a031:\tHandling of indication that network allows the use of EDC or that network requires the use of EDC is specified in 3GPP\u00a0TS\u00a023.548\u00a0[182].\nIf the SMF includes the authorized QoS flow descriptions and the SMF determines to provide the N3QAI to the UE, the SMF shall include the N3QAI IE in the PDU SESSION ESTABLISHMENT ACCEPT message.\nIf the SMF supports URSP provisioning in EPS and the URSP provisioning in EPS support indicator is included in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT REQUEST message, the SMF shall insert the URSP provisioning in EPS support indicator in the Extended protocol configuration options IE of the PDU SESSION ESTABLISHMENT ACCEPT message.\nIf the PDU session to be established is a single access PDU session over 3GPP access with IP PDU session type and based on operator policy the SMF determines to provide the protocol description for UL PDU set handling to the UE, the SMF may include the Protocol description IE in the PDU SESSION ESTABLISHMENT ACCEPT message.\nIf the Protocol description IE is included in the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall store the received Protocol description and may use it to identify PDUs belong to PDU sets for the uplink direction.\nNOTE\u00a0YYY:\tWhether and how to use the protocol description to identify PDU sets is up to the UE implementation.\n6.4.1.4\tUE-requested PDU session establishment procedure not accepted by the network\n6.4.1.4.1\tGeneral\nIf the connectivity with the requested DN is rejected by the network, the SMF shall create a PDU SESSION ESTABLISHMENT REJECT message.\nThe SMF shall set the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message to indicate the reason for rejecting the PDU session establishment.\nThe 5GSM cause IE typically indicates one of the following SM cause values:\n#8\toperator determined barring;\n#26\tinsufficient resources;\n#27\tmissing or unknown DNN;\n#28\tunknown PDU session type;\n#29\tuser authentication or authorization failed;\n#31\trequest rejected, unspecified;\n#32\tservice option not supported;\n#33\trequested service option not subscribed;\n#35\tPTI already in use;\n#38\tnetwork failure;\n#39\treactivation requested;\n#46\tout of LADN service area;\n#50\tPDU session type IPv4 only allowed;\n#51\tPDU session type IPv6 only allowed;\n#54\tPDU session does not exist;\n#57:\tPDU session type IPv4v6 only allowed;\n#58:\tPDU session type Unstructured only allowed;\n#61:\tPDU session type Ethernet only allowed;\n#67\tinsufficient resources for specific slice and DNN;\n#68\tnot supported SSC mode;\n#69\tinsufficient resources for specific slice;\n#70\tmissing or unknown DNN in a slice;\n#82\tmaximum data rate per UE for user-plane integrity protection is too low;\n#86\tUAS services not allowed; or\n#95 \u2013 111\tprotocol errors.\nIf the PDU SESSION ESTABLISHMENT REQUEST message includes a PDU session type IE set to \"IPv6\", and the subscription, the SMF configuration, or both, are limited to IPv4 only for the requested DNN, the SMF shall include the 5GSM cause value #50 \"PDU session type IPv4 only allowed\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.\nIf the PDU SESSION ESTABLISHMENT REQUEST message includes a PDU session type IE set to \"IPv6\", and the subscription, the SMF configuration, or both, support none of \"IPv4\" and \"IPv6\" PDU session types for the requested DNN, the SMF shall include the 5GSM cause value #28 \"unknown PDU session type\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.\nIf the PDU SESSION ESTABLISHMENT REQUEST message includes a PDU session type IE set to \"IPv4\", and the subscription, the SMF configuration, or both, are limited to IPv6 only for the requested DNN, the SMF shall include the 5GSM cause value #51 \"PDU session type IPv6 only allowed\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.\nIf the PDU SESSION ESTABLISHMENT REQUEST message includes a PDU session type IE set to \"IPv4\", and the subscription, the SMF configuration, or both, support none of \"IPv4\" and \"IPv6\" PDU session types for the requested DNN, the SMF shall include the 5GSM cause value #28 \"unknown PDU session type\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.\nIf the PDU SESSION ESTABLISHMENT REQUEST message includes a PDU session type IE set to \"IPv4v6\", and the subscription, the SMF configuration, or both, support none of \"IPv4v6\", \"IPv4\" and \"IPv6\" PDU session types for the requested DNN, the SMF shall include the 5GSM cause value #28 \"unknown PDU session type\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.\nIf the PDU SESSION ESTABLISHMENT REQUEST message includes a PDU session type IE set to \"Unstructured\" or \"Ethernet\", and the subscription, the SMF configuration, or both, do not support the PDU session type for the requested DNN, the SMF shall include the 5GSM cause value #28 \"unknown PDU session type\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.\nIf the PDU SESSION ESTABLISHMENT REQUEST message is to establish an MA PDU session and includes a PDU session type IE set to \"Unstructured\", and the SMF configuration does not support the PDU session type, the SMF shall include the 5GSM cause value #28 \"unknown PDU session type\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.\nIf the PDU SESSION ESTABLISHMENT REQUEST message contains the SSC mode IE indicating an SSC mode not supported by the subscription, the SMF configuration, or both of them, and the SMF decides to rejects the PDU session establishment, the SMF shall include the 5GSM cause value #68 \"not supported SSC mode\" in the 5GSM cause IE and the SSC modes allowed by SMF in the Allowed SSC mode IE of the PDU SESSION ESTABLISHMENT REJECT message.\nIf the PDU SESSION ESTABLISHMENT REQUEST message is to establish an MA PDU session and MA PDU session is not allowed due to operator policy and subscription, and the SMF decides to reject the PDU session establishment, the SMF shall include the 5GSM cause value #33 \"requested service option not subscribed\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.\nIf the PDU SESSION ESTABLISHMENT REQUEST message is identified to be for C2 communication and:\na)\tdoes not include the Service-level-AA container IE with the service-level device ID set to the CAA-level UAV ID;\nb)\tdoes not include the Service-level-AA container IE with the service-level-AA payload and the Service-level-AA payload type; or\nc)\tthe SMF is informed by the UAS-NF that the UAS service is not allowed,\nthe SMF shall reject the PDU SESSION ESTABLISHMENT REQUEST message by transmitting a PDU SESSION ESTABLISHMENT REJECT message with 5GSM cause IE set to 5GSM cause value #86 \"UAS services not allowed\".\nIn 3GPP access, if the operator's configuration requires user-plane integrity protection for the PDU session and, the maximum data rate per UE for user-plane integrity protection supported by the UE for uplink or the maximum data rate per UE for user-plane integrity protection supported by the UE for downlink, or both, are lower than required by the operator's configuration, the SMF shall include the 5GSM cause value #82 \"maximum data rate per UE for user-plane integrity protection is too low\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.\nIf the UE requests a PDU session establishment for an LADN when the UE is located outside of the LADN service area, the SMF shall include the 5GSM cause value #46 \"out of LADN service area\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.\nIf the DN authentication of the UE was performed with the PDU session authentication and authorization procedure and completed unsuccessfully, the SMF shall include the 5GSM cause value #29 \"user authentication or authorization failed\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message and shall set the EAP message IE of the PDU SESSION ESTABLISHMENT REJECT message to an EAP-failure message as specified in IETF\u00a0RFC\u00a03748\u00a0[34], provided by the DN.\nIf the DN authentication of the UE was performed with the service-level authentication and authorization procedure and completed unsuccessfully, the SMF shall include the 5GSM cause value #29 \"user authentication or authorization failed\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message and shall include the service-level-AA response provided by DN in the Service-level-AA container IE of the PDU SESSION ESTABLISHMENT REJECT message.\nBased on the local policy and user's subscription data, if a PDU session is being established with the request type set to \"existing PDU session\" and the SMF determines the UE has:\na)\tmoved between a tracking area in NB-N1 mode and a tracking area in WB-N1 mode;\nb)\tmoved between a tracking area in NB-S1 mode and a tracking area in WB-N1 mode; or\nc)\tmoved between a tracking area in WB-S1 mode and a tracking area in NB-N1 mode,\nthe SMF may reject the PDU SESSION ESTABLISHMENT REQUEST message and:\na)\tinclude the 5GSM cause value #39 \"reactivation requested\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message; or\nb)\tinclude a 5GSM cause value other than #39 \"reactivation requested\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.\nNOTE\u00a01:\tThe included 5GSM cause value is up to the network implementation.\nIf the PDU session cannot be established due to resource unavailability in the UPF, the SMF shall include the 5GSM cause value #26 \"insufficient resources\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.\nBased on the user's subscription data and the operator policy, if the SMF determines that the UUAA-SM procedure needs to be performed for a UE but the SMF does not receives the service-level device ID set to the CAA-level UAV ID in the Service-level-AA container IE of the PDU SESSION ESTABLISHMENT REQUEST message from the UE, the SMF shall include the 5GSM cause value #86 \"UAS services not allowed\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.\nThe network may include a Back-off timer value IE in the PDU SESSION ESTABLISHMENT REJECT message.\nIf the 5GSM cause value is #26 \"insufficient resources\", #67 \"insufficient resources for specific slice and DNN\", or #69 \"insufficient resources for specific slice\" and the PDU SESSION ESTABLISHMENT REQUEST message was received from a UE configured for high priority access in selected PLMN or SNPN or the request type provided during the PDU session establishment is set to \"initial emergency request\" or \"existing emergency PDU session\", the network shall not include a Back-off timer value IE.\nIf the 5GSM cause value is #29 \"user authentication or authorization failed \", the network should include a Back-off timer value IE.\nIf the Back-off timer value IE is included and the 5GSM cause value is different from #26 \"insufficient resources\", #28 \"unknown PDU session type\", #46 \"out of LADN service area\", #50 \"PDU session type IPv4 only allowed\", #51 \"PDU session type IPv6 only allowed\", #54 \"PDU session does not exist\", #57 \"PDU session type IPv4v6 only allowed\", #58 \"PDU session type Unstructured only allowed\", #61 \"PDU session type Ethernet only allowed\", #67 \"insufficient resources for specific slice and DNN\", #68 \"not supported SSC mode\", and #69 \"insufficient resources for specific slice\", the network may include the Re-attempt indicator IE to indicate whether the UE is allowed to attempt a PDN connectivity procedure in the PLMN for the same DNN in S1 mode, whether another attempt in S1 mode or in N1 mode is allowed in an equivalent PLMN or whether another attempt in N1 mode is allowed in an equivalent SNPN.\nIf the 5GSM cause value is #50 \"PDU session type IPv4 only allowed\", #51 \"PDU session type IPv6 only allowed\", #57 \"PDU session type IPv4v6 only allowed\", #58 \"PDU session type Unstructured only allowed\", or #61 \"PDU session type Ethernet only allowed\", the network may include the Re-attempt indicator IE without Back-off timer value IE to indicate whether the UE is allowed to attempt a PDU session establishment procedure in an equivalent PLMN or equivalent SNPN in N1 mode using the same PDU session type for the same DNN (or no DNN, if no DNN was indicated by the UE) and the same S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the UE).\nThe SMF shall send the PDU SESSION ESTABLISHMENT REJECT message.\nUpon receipt of a PDU SESSION ESTABLISHMENT REJECT message and a PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5, the UE shall stop timer T3580 shall release the allocated PTI value and shall consider that the PDU session was not established.\nIf the PDU SESSION ESTABLISHMENT REQUEST message was sent with request type set to \"initial emergency request\" or \"existing emergency PDU session\" and the UE receives a PDU SESSION ESTABLISHMENT REJECT message, then the UE may:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE\u00a02:\tThis can result in the upper layers requesting another emergency call attempt using domain selection as specified in 3GPP\u00a0TS\u00a023.167\u00a0[6].\nb)\tde-register locally, if not de-registered already, attempt initial registration for emergency services.\nIf the PDU SESSION ESTABLISHMENT REJECT message includes 5GSM cause #39 \"reactivation requested\" and the PDU session is being transferred from EPS to 5GS and established with the request type set to \"existing PDU session\", the UE should re-initiate the UE-requested PDU session establishment procedure as specified in subclause\u00a06.4.1 for:\na)\tthe PDU session type associated with the transferred PDU session;\nb)\tthe SSC mode associated with the transferred PDU session;\nc)\tthe DNN associated with the transferred PDU session; and\nd)\tthe S-NSSAI associated with (if available in roaming scenarios) a mapped S-NSSAI if provided in the UE-requested PDU session establishment procedure of the transferred PDU session.\nIf the PDU SESSION ESTABLISHMENT REJECT message includes 5GSM cause #86 \"UAS services not allowed\" and the UE has not included the service-level device ID in the Service-level-AA container IE of the PDU SESSION ESTABLISHMENT REQUEST message and set the value to the CAA-level UAV ID:\na)\tthe UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for UAS services without including the CAA-level UAV ID in the service-level device ID of the Service-level-AA container IE; and\nb)\tupon receipt of the request from the upper layers to establish a PDU session for UAS services, the UE shall initiate the UE-requested PDU session establishment procedure by including the service-level device ID in the Service-level-AA container IE of the PDU SESSION ESTABLISHMENT REQUEST message and set the value to the CAA-level UAV ID as specified in subclause\u00a06.4.1.2.\nIf the 5GSM cause value is different from #26 \"insufficient resources\", #28 \"unknown PDU session type\", #39 \"reactivation requested\", #46 \"out of LADN service area\", #50 \"PDU session type IPv4 only allowed\", #51 \"PDU session type IPv6 only allowed\", #54 \"PDU session does not exist\", #57 \"PDU session type IPv4v6 only allowed\", #58 \"PDU session type Unstructured only allowed\", #61 \"PDU session type Ethernet only allowed\", #67 \"insufficient resources for specific slice and DNN\", #68 \"not supported SSC mode\", and #69 \"insufficient resources for specific slice\", #86 \"UAS services not allowed\", and #33 \"requested service option not subscribed\" and the PDU SESSION ESTABLISHMENT REQUEST message was received from a UE configured for high priority access in selected PLMN, the network shall not include a Back-off timer value IE.\n6.4.1.4.2\tHandling of network rejection due to congestion control\nIf:\n-\tthe 5GSM cause value #26 \"insufficient resources\" and the Back-off timer value IE are included in the PDU SESSION ESTABLISHMENT REJECT message; or\n-\tan indication that the 5GSM message was not forwarded due to DNN based congestion control is received along a Back-off timer value and a PDU SESSION ESTABLISHMENT REQUEST message with the PDU session ID IE set to the PDU session ID of the PDU session;\nthe UE shall ignore the 5GSM congestion re-attempt indicator or the Re-attempt indicator IE provided by the network, if any, and the UE shall take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE or depending on the Back-off timer value received from the 5GMM sublayer (if the UE is a UE configured for high priority access in selected PLMN or SNPN, exceptions are specified in subclause\u00a06.2.7):\na)\tIf the timer value indicates neither zero nor deactivated and a DNN was provided during the PDU session establishment, the UE shall stop timer T3396 associated with the corresponding DNN, if it is running. If the timer value indicates neither zero nor deactivated and no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3396 associated with no DNN if it is running. In an SNPN, the timer T3396 to be stopped includes:\n1)\tthe timer T3396 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\n2)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall then start timer T3396 with the value provided in the Back-off timer value IE or with the Back-off timer value received from the 5GMM sublayer and:\n1)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same DNN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and\n2)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message without a DNN and with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session established without a DNN provided by the UE, if no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", until timer T3396 expires or timer T3396 is stopped.\nThe UE shall not stop timer T3396 upon a PLMN change, SNPN change, or inter-system change;\nb)\tif the timer value indicates that this timer is deactivated and a DNN was provided during the PDU session establishment, the UE shall stop timer T3396 associated with the corresponding DNN, if it is running. If the timer value indicates that this timer is deactivated and no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3396 associated with no DNN if it is running. In an SNPN, the timer T3396 to be stopped includes:\n1)\tthe timer T3396 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\n2)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE:\n1)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same DNN until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated if the UE does not support access to an SNPN using credentials from a credentials holder, or the selected entry of the \"list of subscriber data\" is updated if the UE supports access to an SNPN using credentials from a credentials holder, or the UE receives a PDU SESSION MODIFICATION COMMAND message for the same DNN from the network, or a PDU SESSION AUTHENTICATION COMMAND message for the same DNN from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for the same DNN from the network; and\n2)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message without a DNN and with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session established without a DNN provided by the UE, if no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated if the UE does not support access to an SNPN using credentials from a credentials holder, or the selected entry of the \"list of subscriber data\" is updated if the UE supports access to an SNPN using credentials from a credentials holder, or the UE receives a PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU session established without a DNN provided by the UE, or a PDU SESSION AUTHENTICATION COMMAND message for a non-emergency PDU session established without a DNN provided by the UE, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for a non-emergency PDU session established without a DNN provided by the UE.\n\tThe timer T3396 remains deactivated upon a PLMN change, SNPN change, or inter-system change; and\nc)\tif the timer value indicates zero, the UE:\n1)\tshall stop timer T3396 associated with the corresponding DNN, if running. In an SNPN, the timer T3396 to be stopped includes:\ni)\tthe timer T3396 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nii)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same DNN; and\n2)\tif no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3396 associated with no DNN, if running. In an SNPN, the timer T3396 to be stopped includes:\ni)\tthe timer T3396 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nii)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message without a DNN, or another PDU SESSION MODIFICATION REQUEST message without a DNN provided by the UE.\nIn an SNPN, if the UE supports equivalent SNPNs, then the UE shall apply the timer T3396 for all the equivalent SNPNs. Otherwise, the UE shall apply the timer T3396 for the registered SNPN.\nIf the Back-off timer value IE is not included or no Back-off timer value is received from the 5GMM sublayer, then the UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same DNN or without a DNN.\nWhen the timer T3396 is running or the timer is deactivated, the UE is allowed to initiate a PDU session establishment procedure for emergency services.\nIf the timer T3396 is running when the UE enters state 5GMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" to which timer T3396 is associated (if any) is not updated, then timer T3396 is kept running until it expires or it is stopped.\nIf the UE is switched off when the timer T3396 is running, and if the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" to which timer T3396 is associated (if any) is not updated when the UE is switched on, the UE shall behave as follows:\n-\tlet t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\nIf:\n-\tthe 5GSM cause value #67 \"insufficient resources for specific slice and DNN\" and the Back-off timer value IE are included in the PDU SESSION ESTABLISHMENT REJECT message; or\n-\tan indication that the 5GSM message was not forwarded due to S-NSSAI and DNN based congestion control is received along a Back-off timer value and a PDU SESSION ESTABLISHMENT REQUEST message with the PDU session ID IE set to the PDU session ID of the PDU session;\nthe UE shall ignore the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3584 in the Back-off timer value IE or depending on the Back-off timer value received from the 5GMM sublayer (if the UE is a UE configured for high priority access in selected PLMN or SNPN, exceptions are specified in subclause\u00a06.2.8):\na)\tIf the timer value indicates neither zero nor deactivated, the UE shall stop timer T3584 associated with the same [S-NSSAI, DNN] combination as that the UE provided during the PDU session establishment, if it is running. If the timer value indicates neither zero nor deactivated and no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3584 associated with [S-NSSAI, no DNN] combination as that the UE provided during the PDU session establishment, if it is running. If the timer value indicates neither zero nor deactivated and no S-NSSAI was provided during the PDU session establishment, the UE shall stop timer T3584 associated with [no S-NSSAI, DNN] combination as that the UE provided during the PDU session establishment, if it is running. If the timer value indicates neither zero nor deactivated and neither S-NSSAI nor DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3584 associated with [no S-NSSAI, no DNN] combination as that the UE provided during the PDU session establishment, if it is running. The timer T3584 to be stopped includes:\n1)\tin a PLMN:\ni)\tthe timer T3584 applied for all the PLMNs, if running; and\nii)\tthe timer T3584 applied for the registered PLMN, if running; or\n2)\tin an SNPN:\ni)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nii)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall then start timer T3584 with the value provided in the Back-off timer value IE or with the Back-off timer value received from the 5GMM sublayer and:\n1)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message, or PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same [S-NSSAI, DNN] combination that was sent by the UE, until timer T3584 expires or timer T3584 is stopped;\n2)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST with exception of those identified in subclause\u00a06.4.2.1, message for the same [S-NSSAI, no DNN] combination that was sent by the UE, if no DNN was provided during the PDU session establishment, until timer T3584 expires or timer T3584 is stopped;\n3)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message, or another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same [no S-NSSAI, DNN] combination that was sent by the UE, if no S-NSSAI was provided during the PDU session establishment, until timer T3584 expires or timer T3584 is stopped; and\n4)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same [no S-NSSAI, no DNN] combination that was sent by the UE, if neither S-NSSAI nor DNN was provided during the PDU session establishment, until timer T3584 expires or timer T3584 is stopped.\n\tThe UE shall not stop timer T3584 upon a PLMN change, SNPN change, or inter-system change;\nb)\tif the timer value indicates that this timer is deactivated, the UE:\n1)\tshall stop timer T3584 associated with the same [S-NSSAI, DNN] combination as that the UE provided during the PDU session establishment, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running. \n\tThe UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message, or PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same [S-NSSAI, DNN] combination that was sent by the UE, until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated if the UE does not support access to an SNPN using credentials from a credentials holder, or the selected entry of the \"list of subscriber data\" is updated if the UE supports access to an SNPN using credentials from a credentials holder, or the UE receives a PDU SESSION MODIFICATION COMMAND message for the same [S-NSSAI, DNN] combination from the network, or a PDU SESSION AUTHENTICATION COMMAND message for the same [S-NSSAI, DNN] combination from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for the same [S-NSSAI, DNN] combination from the network;\n2)\tshall stop timer T3584 associated with the same [S-NSSAI, no DNN] combination as that the UE provided during the PDU session establishment, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running. \n\tThe UE shall not send a PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or a PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same [S-NSSAI, no DNN] combination that was sent by the UE, if no DNN was provided during the PDU session establishment, until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated if the UE does not support access to an SNPN using credentials from a credentials holder, or the selected entry of the \"list of subscriber data\" if the UE supports access to an SNPN using credentials from a credentials holder, or the UE receives an PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU session established for the same [S-NSSAI, no DNN] combination from the network, or a PDU SESSION AUTHENTICATION COMMAND message for a non-emergency PDU session established for the same [S-NSSAI, DNN] combination from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for a non-emergency PDU session established for the same [S-NSSAI, no DNN] combination from the network;\n3)\tshall stop timer T3584 associated with the same [no S-NSSAI, DNN] combination as that the UE provided during the PDU session establishment, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall not send a PDU SESSION ESTABLISHMENT REQUEST message, or a PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same [no S-NSSAI, DNN] combination that was sent by the UE, if no S-NSSAI was provided during the PDU session establishment, until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives a PDU SESSION MODIFICATION COMMAND message for the same [no S-NSSAI, DNN] combination from the network, or a PDU SESSION AUTHENTICATION COMMAND message for a non-emergency PDU session established for the same [no S-NSSAI, no DNN] combination from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for the same [no S-NSSAI, DNN] combination from the network; and\n4)\tshall stop timer T3584 associated with the same [no S-NSSAI, no DNN] combination as that the UE provided during the PDU session establishment , if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall not send a PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or a PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same [no S-NSSAI, no DNN] combination that was sent by the UE, if neither S-NSSAI nor DNN was provided during the PDU session establishment, until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated if the UE does not support access to an SNPN using credentials from a credentials holder, or the selected entry of the \"list of subscriber data\" is updated if the UE supports access to an SNPN using credentials from a credentials holder, or the UE receives an PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU session established for the same [no S-NSSAI, no DNN] combination from the network or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for a non-emergency PDU session established for the same [no S-NSSAI, no DNN] combination from the network.\n\tThe timer T3584 remains deactivated upon a PLMN change, SNPN change, or inter-system change; and\nc)\tif the timer value indicates zero, the UE:\n1)\tshall stop timer T3584 associated with the same [S-NSSAI, DNN] combination as that the UE provided during the PDU session establishment, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same [S-NSSAI, DNN] combination;\n2)\tshall stop timer T3584 associated with the same [S-NSSAI, no DNN] combination as that the UE provided during the PDU session establishment, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same [S-NSSAI, no DNN] combination if no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\";\n3)\tshall stop timer T3584 associated with the same [no S-NSSAI, DNN] combination as that the UE provided during the PDU session establishment, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message, or PDU SESSION MODIFICATION REQUEST message for the same [no S-NSSAI, DNN] combination if no NSSAI was provided during the PDU session establishment; and\n4)\tshall stop timer T3584 associated with the same [no S-NSSAI, no DNN] combination as that the UE provided during the PDU session establishment, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message, or PDU SESSION MODIFICATION REQUEST message for the same [no S-NSSAI, no DNN] combination if neither S-NSSAI nor DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\".\nIf the 5GSM congestion re-attempt indicator IE with the ABO bit set to \"The back-off timer is applied in all PLMNs or all equivalent SNPNs \" is included in the PDU SESSION ESTABLISHMENT REJECT message with the 5GSM cause value #67 \"insufficient resources for specific slice and DNN\", then the UE shall apply the timer T3584 for all the PLMNs or all the equivalent SNPNs. Otherwise, the UE shall apply the timer T3584 for the registered PLMN.\nIf the Back-off timer value IE is not included or no Back-off timer value is received from the 5GMM sublayer, then the UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same [S-NSSAI, DNN] combination, or for the same [S-NSSAI, no DNN] combination, or for the same [no S-NSSAI, DNN] combination, or for the same [no S-NSSAI, no DNN] combination.\nWhen the timer T3584 is running or the timer is deactivated, the UE is allowed to initiate a PDU session establishment procedure for emergency services.\nIf the timer T3584 is running when the UE enters state 5GMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" to which timer T3584 is associated (if any) is not updated, then timer T3584 is kept running until it expires or it is stopped.\nIf the UE is switched off when the timer T3584 is running, and if the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" to which timer T3584 is associated (if any) is not updated when the UE is switched on, the UE shall behave as follows:\n-\tlet t1 be the time remaining for T3584 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\nIf:\n-\tthe 5GSM cause value #69 \"insufficient resources for specific slice\" and the Back-off timer value IE are included in the PDU SESSION ESTABLISHMENT REJECT message; or\n-\tan indication that the 5GSM message was not forwarded due to S-NSSAI only based congestion control is received along a Back-off timer value and a PDU SESSION ESTABLISHMENT REQUEST message with the PDU session ID IE set to the PDU session ID of the PDU session;\nthe UE shall ignore the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3585 in the Back-off timer value IE or depending on the Back-off timer value received from the 5GMM sublayer (if the UE is a UE configured for high priority access in selected PLMN or SNPN, exceptions are specified in subclause\u00a06.2.8):\na)\tIf the timer value indicates neither zero nor deactivated and an S-NSSAI was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3585 associated with the corresponding S-NSSAI, if it is running. If the timer value indicates neither zero nor deactivated and no S-NSSAI was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3585 associated with no S-NSSAI if it is running. The timer T3585 to be stopped includes:\n1)\tin a PLMN:\ni)-\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION ESTABLISHMENT REJECT is received, if running;\nii)\tthe timer T3585 applied for all the PLMNs and for both 3GPP access type and non-3GPP access type, if running;\niii)\tthe timer T3585 applied for the registered PLMN and for the access over which the PDU SESSION ESTABLISHMENT REJECT is received, if running; and\niv)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\n2)\tin an SNPN:\ni)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nii)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\niii)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\niv)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall then start timer T3585 with the value provided in the Back-off timer value IE or with the Back-off timer value received from the 5GMM sublayer and:\n1)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session for the same S-NSSAI that was sent by the UE, until timer T3585 expires or timer T3585 is stopped; and\n2)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message without an S-NSSAI and with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session established without an S-NSSAI provided by the UE, if no S-NSSAI was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", until timer T3585 expires or timer T3585 is stopped.\n\tThe UE shall not stop timer T3585 upon a PLMN change, SNPN change, or inter-system change;\nb)\tif the timer value indicates that this timer is deactivated and an S-NSSAI was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3585 associated with the corresponding S-NSSAI, if it is running. If the timer value indicates that this timer is deactivated and no S-NSSAI was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3585 associated with no S-NSSAI if it is running. The timer T3585 to be stopped includes:\n1)\tin a PLMN:\ni)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION ESTABLISHMENT REJECT is received, if running;\nii)\tthe timer T3585 applied for all the PLMNs and for both 3GPP access type and non-3GPP access type, if running;\niii)\tthe timer T3585 applied for the registered PLMN and for the access over which the PDU SESSION ESTABLISHMENT REJECT is received, if running; and\niv)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\n2)\tin an SNPN:\ni)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nii)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\niii)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\niv)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE:\n1)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session for the same S-NSSAI until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated if the UE does not support access to an SNPN using credentials from a credentials holder, or the selected entry of the \"list of subscriber data\" is updated if the UE supports access to an SNPN using credentials from a credentials holder, or the UE receives a PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU session for the same S-NSSAI from the network, or a PDU SESSION AUTHENTICATION COMMAND message for a non-emergency PDU session for the same S-NSSAI from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for the same S-NSSAI from the network; and\n2)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message without an S-NSSAI and with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session established without an S-NSSAI provided by the UE, if no S-NSSAI was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated if the UE does not support access to an SNPN using credentials from a credentials holder, or the selected entry of the \"list of subscriber data\" is updated if the UE supports access to an SNPN using credentials from a credentials holder, or the UE receives a PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU session established without an S-NSSAI provided by the UE, or a PDU SESSION AUTHENTICATION COMMAND message for a non-emergency PDU session established without an S-NSSAI provided by the UE, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for a non-emergency PDU session established without an S-NSSAI provided by the UE.\n\tThe timer T3585 remains deactivated upon a PLMN change, SNPN change, or inter-system change; and\nc)\tif the timer value indicates zero, the UE:\n1)\tshall stop timer T3585 associated with the corresponding S-NSSAI, if running. The timer T3585 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running;\nB)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running;\nC)\tthe timer T3585 applied for the registered PLMN and for current access type or both 3GPP access type and non-3GPP access type, if running; and\nD)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nB)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nC)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nD)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same S-NSSAI; and\n2)\tif no S-NSSAI was provided during the PDU session establishment and the request type was different from \"initial emergency request \" and different from \"existing emergency PDU session\", the UE shall stop timer T3585 associated with no S-NSSAI, if running. The timer T3585 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running;\nB)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running;\nC)\tthe timer T3585 applied for the registered PLMN and for current access type or both 3GPP access type and non-3GPP access type, if running; and\nD)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nB)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nC)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nD)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message without an S-NSSAI, or another PDU SESSION MODIFICATION REQUEST message without an S-NSSAI provided by the UE.\nIf the 5GSM congestion re-attempt indicator IE with the ABO bit set to \"The back-off timer is applied in all PLMNs or equivalent SNPNs \" is included in the PDU SESSION ESTABLISHMENT REJECT message with the 5GSM cause value #69 \"insufficient resources for specific slice\", then the UE shall apply the timer T3585 for all the PLMNs or all the equivalent SNPNs. Otherwise, the UE shall apply the timer T3585 for the registered PLMN or the registered SNPN. Additionally, if the 5GSM congestion re-attempt indicator IE with the CATBO bit set to \"The back-off timer is applied in the current access type\" is included in the PDU SESSION ESTABLISHMENT REJECT message with the 5GSM cause value #69 \"insufficient resources for specific slice\", then the UE shall apply the timer T3585 for the current access type. Otherwise, the UE shall apply the timer T3585 for both 3GPP access type and non-3GPP access type and the UE shall stop any running timer T3585 for the applied PLMN or SNPN and for the access different from the access from which the PDU SESSION ESTABLISHMENT REJECT message is received.\nIf the Back-off timer value IE is not included or no Back-off timer value is received from the 5GMM sublayer, then the UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same S-NSSAI or without an S-NSSAI.\nWhen the timer T3585 is running or the timer is deactivated, the UE is allowed to initiate a PDU session establishment procedure for emergency services.\nIf the timer T3585 is running when the UE enters state 5GMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" to which timer T3585 is associated (if any) is not updated, then timer T3585 is kept running until it expires or it is stopped.\nIf the UE is switched off when the timer T3585 is running, and if the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" to which timer T3585 is associated (if any) is not updated when the UE is switched on, the UE shall behave as follows:\n\tlet t1 be the time remaining for T3585 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\nNOTE:\tAs described in this subclause, upon PLMN change, SNPN change or inter-system change, the UE does not stop the timer T3584 or T3585. This means the timer T3584 or T3585 can still be running or be deactivated for the given 5GSM procedure, the PLMN or SNPN, the S-NSSAI and optionally the DNN combination when the UE returns to the PLMN or SNPN or when it performs inter-system change back from S1 mode to N1 mode. Thus the UE can still be prevented from sending another PDU SESSION ESTABLISHMENT REQUEST or PDU SESSION MODIFICATION REQUEST message in the PLMN or SNPN for the same S-NSSAI and optionally the same DNN.\nUpon PLMN change or SNPN change, if T3584 applied for the registered PLMN or the registered SNPN is running or is deactivated for an S-NSSAI, a DNN, and old PLMN or old SNPN, but T3584 is not running and is not deactivated for the S-NSSAI, the DNN, and new PLMN or new SNPN, then the UE is allowed to send a PDU SESSION ESTABLISHMENT REQUEST message for the same S-NSSAI and the same DNN in the new PLMN or new SNPN.\nUpon PLMN change or SNPN change, if T3585 applied for the registered PLMN or the registered SNPN is running or is deactivated for an S-NSSAI and old PLMN or old SNPN, but T3585 is not running and is not deactivated for the S-NSSAI and new PLMN or new SNPN, then the UE is allowed to send a PDU SESSION ESTABLISHMENT REQUEST message for the same S-NSSAI in the new PLMN or new SNPN.\nUpon SNPN change, if T3585 applied for all the equivalent SNPNs is running or is deactivated for an S-NSSAI and old SNPN, but T3585 is not running and is not deactivated for the S-NSSAI and new non-equivalent SNPN, then the UE is allowed to send a PDU SESSION ESTABLISHMENT REQUEST message for the same S-NSSAI in the new SNPN.\n6.4.1.4.3\tHandling of network rejection not due to congestion control\nIf the 5GSM cause value is different from #26 \"insufficient resources\", #28 \"unknown PDU session type\", #39 \"reactivation requested\", #46 \"out of LADN service area\", #50 \"PDU session type IPv4 only allowed\", #51 \"PDU session type IPv6 only allowed\", #54 \"PDU session does not exist\", #57 \"PDU session type IPv4v6 only allowed\", #58 \"PDU session type Unstructured only allowed\", #61 \"PDU session type Ethernet only allowed\", #67 \"insufficient resources for specific slice and DNN\", #68 \"not supported SSC mode\", and #69 \"insufficient resources for specific slice\", #86 \"UAS services not allowed\", and #33 \"requested service option not subscribed\" upon sending PDU SESSION ESTABLISHMENT REQUEST to establish an MA PDU session, and the Back-off timer value IE is included, the UE shall behave as follows: (if the UE is a UE configured for high priority access in selected PLMN or SNPN, exceptions are specified in subclause\u00a06.2.12):\na)\tif the timer value indicates neither zero nor deactivated and:\n1)\tif the UE provided a DNN and S-NSSAI to the network during the PDU session establishment and the 5GSM cause value is different from #27 \"missing or unknown DNN\", the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDU session establishment procedure and:\ni)\tin a PLMN, [PLMN, DNN, (mapped) HPLMN S-NSSAI] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same DNN and (mapped) HPLMN S-NSSAI in the current PLMN, until the back-off timer expires, the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed SNPN S-NSSAI] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same DNN and (mapped) subscribed SNPN S-NSSAI in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the back-off timer expires, the UE is switched off, the USIM is removed, or the selected entry of the \"list of subscriber data\" is updated;\n2)\tif the UE provided a DNN to the network during the PDU session establishment and the 5GSM cause value is #27 \"missing or unknown DNN\", the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDU session establishment procedure and:\ni)\tin a PLMN, [PLMN, DNN] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same DNN in the current PLMN, until the back-off timer expires, the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same DNN in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the back-off timer expires, the UE is switched off, the USIM is removed, or the selected entry of the \"list of subscriber data\" is updated;\n3)\tif the UE did not provide a DNN or S-NSSAI or any of the two parameters to the network during the PDU session establishment and the 5GSM cause value is different from #27 \"missing or unknown DNN\", it shall start the back-off timer accordingly for the PDU session establishment procedure and:\ni)\tin a PLMN, [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI] or [PLMN, no DNN, no S-NSSAI] combination. Dependent on the combination, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI] or [PLMN, no DNN, no S-NSSAI] combination in the current PLMN, until the back-off timer expires, the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI] or [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] combination. Dependent on the combination, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI] or [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] combination in the current PLMN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the back-off timer expires, the UE is switched off, the USIM is removed or the selected entry of the \"list of subscriber data\" is updated; or\n4)\tif the UE did not provide a DNN to the network during the PDU session establishment and the 5GSM cause value is #27 \"missing or unknown DNN\", it shall start the back-off timer accordingly for the PDU session establishment procedure and:\ni)\tin a PLMN, [PLMN, no DNN] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same [PLMN, no DNN] in the current PLMN, until the back-off timer expires, the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] in the current PLMN, using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the back-off timer expires, the UE is switched off, the USIM is removed or the selected entry of the \"list of subscriber data\" is updated;\nb)\tif the timer value indicates that this timer is deactivated and:\n1)\tif the UE provided a DNN and S-NSSAI to the network during the PDU session establishment and the 5GSM cause value is different from #27 \"missing or unknown DNN\", the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for:\ni)\tin a PLMN, the same DNN and (mapped) HPLMN S-NSSAI in the current PLMN, until the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, the same DNN and (mapped) subscribed SNPN S-NSSAI in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the UE is switched off, the USIM is removed, or the selected entry of the \"list of subscriber data\" is updated;\n2)\tif the UE provided a DNN to the network during the PDU session establishment and the 5GSM cause value is #27 \"missing or unknown DNN\", the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for:\ni)\tin a PLMN, the same DNN in the current PLMN, until the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, the same DNN in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the UE is switched off, the USIM is removed, or the selected entry of the \"list of subscriber data\" is updated;\n3)\tif the UE did not provide a DNN or S-NSSAI or any of the two parameters to the network during the PDU session establishment and the 5GSM cause value is different from #27 \"missing or unknown DNN\", the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for:\ni)\tin a PLMN, the same [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI] or [PLMN, no DNN, no S-NSSAI] combination in the current PLMN, until the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, the same [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI] or [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] combination in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the UE is switched off, the USIM is removed, or the selected entry of the \"list of subscriber data\" is updated; or\n4)\tif the UE did not provide a DNN to the network during the PDU session establishment and the 5GSM cause value is #27 \"missing or unknown DNN\", the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for:\ni)\tin a PLMN, the same [PLMN, no DNN] in the current PLMN, until the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, the same [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the UE is switched off, the USIM is removed, or the selected entry of the \"list of subscriber data\" is updated; and\nc)\tif the timer value indicates zero and the 5GSM cause value is different from #27 \"missing or unknown DNN\", the UE may send another PDU SESSION ESTABLISHMENT REQUEST message for:\n1)\tin a PLMN, the same combination of [PLMN, DNN, (mapped) HPLMN S-NSSAI], [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI], or [PLMN, no DNN, no S-NSSAI] in the current PLMN. If the timer value indicates zero and the 5GSM cause value is #27 \"missing or unknown DNN\", the UE may send another PDU SESSION ESTABLISHMENT REQUEST message for the same combination of [PLMN, DNN], or [PLMN, no DNN] in the current PLMN; or\n2)\tin an SNPN, the same combination of [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed SNPN S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed S-NSSAI], or [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription. If the timer value indicates zero and the 5GSM cause value is #27 \"missing or unknown DNN\", the UE may send another PDU SESSION ESTABLISHMENT REQUEST message for the same combination of [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN], or [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription.\nIf the Back-off timer value IE is not included, then the UE shall ignore the Re-attempt indicator IE provided by the network in the PDU SESSION ESTABLISHMENT REJECT message, if any.\na)\tAdditionally, if the 5GSM cause value is #8 \"operator determined barring\", #32 \"service option not supported\", #33 \"requested service option not subscribed\" upon sending PDU SESSION ESTABLISHMENT REQUEST not to establish an MA PDU session, or #70 \"missing or unknown DNN in a slice\", then:\n1)\tthe UE not operating in SNPN access operation mode shall proceed as follows:\ni)\tif the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list, the UE shall behave as described above in the present subclause using the configured SM Retry Timer value as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] or in USIM file NASCONFIG as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], if available, as back-off timer value; and\nNOTE\u00a01:\tThe way to choose one of the configured SM Retry Timer values for back-off timer value is up to UE implementation if the UE is configured with:\n-\tan SM Retry Timer value in ME as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17]; and\n-\tan SM Retry Timer value in USIM file NASCONFIG as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22].\nii)\totherwise, if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, or if the SM Retry Timer value is not configured, the UE shall behave as described above in the present subclause, using the default value of 12 minutes for the back-off timer; or\n2)\tthe UE operating in SNPN access operation mode shall proceed as follows:\ni)\tif:\nA)\tthe SM Retry Timer value for the current SNPN as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] is available; or\nB)\tthe UE used the USIM for registration to the current SNPN and the SM Retry Timer value in USIM file NASCONFIG as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22] is available;\n\tthen the UE shall behave as described above in the present subclause using the configured SM Retry Timer value as back-off timer value; or\nNOTE\u00a02:\tThe way to choose one of the configured SM Retry Timer values for back-off timer value is up to UE implementation if both conditions in bullets A) and B) above are satisfied.\nii)\totherwise, the UE shall behave as described above in the present subclause, using the default value of 12 minutes for the back-off timer.\nb)\tFor 5GSM cause value #27 \"missing or unknown DNN\", then:\n1)\tthe UE not operating in SNPN access operation mode shall proceed as follows:\ni)\tif the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list, the UE shall start the back-off timer with the configured SM Retry Timer value as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] or in USIM file NASCONFIG as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], if available, as back-off timer value for the PDU session establishment procedure and the [PLMN, DNN] or [PLMN, no DNN] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same DNN in the current PLMN, until the back-off timer expires, the UE is switched off or the USIM is removed; and\nNOTE\u00a03:\tThe way to choose one of the configured SM Retry Timer values for back-off timer value is up to UE implementation if the UE is configured with:\n-\tan SM Retry Timer value in ME as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17]; and\n-\tan SM Retry Timer value in USIM file NASCONFIG as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22].\nii)\totherwise, if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, or if the SM Retry Timer value is not configured, the UE shall start the back-off timer with the default value of 12 minutes as back-off timer value for the PDU session establishment procedure and the [PLMN, DNN] or [PLMN, no DNN] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same DNN in the current PLMN, until the back-off timer expires, the UE is switched off or the USIM is removed; or\n2)\tthe UE operating in SNPN access operation mode shall proceed as follows:\ni)\tif:\nA)\tthe SM Retry Timer value for the current SNPN as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] is available; or\nB)\tthe UE used the USIM for registration to the current SNPN and the SM Retry Timer value in USIM file NASCONFIG as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22] is available;\n\tthen:\nthe UE shall start the back-off timer with the configured SM Retry Timer value as back-off timer value for the PDU session establishment procedure and the [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN] or [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same DNN in the current SNPN using the selected entry in the \"list of subscriber data\" or selected PLMN subscription, until the back-off timer expires, the UE is switched off, the UICC containing the USIM is removed or the selected entry of the \"list of subscriber data\" is updated; or\nNOTE\u00a04:\tThe way to choose one of the configured SM Retry Timer values for back-off timer value is up to UE implementation if both conditions in bullets A) and B) above are satisfied.\nii)\totherwise:\n-\tthe UE shall start the back-off timer with the default value of 12 min as back-off timer value for the PDU session establishment procedure and the [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN] or [SNPN, selected entry in the \"list of subscriber data\" or selected PLMN subscription, no DNN] combination. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message for the same DNN in the current SNPN using the selected entry of the \"list of subscriber data\", until the back-off timer expires, the UE is switched off, the UICC containing the USIM is removed or the selected entry of the \"list of subscriber data\" is updated; and\nc)\tFor 5GSM cause values different from #8 \"operator determined barring\", #27 \"missing or unknown DNN\", #32 \"service option not supported\", #33 \"requested service option not subscribed\" and #70 \"missing or unknown DNN in a slice\", the UE behaviour regarding the start of a back-off timer is unspecified.\nThe UE shall not stop any back-off timer:\na)\tupon a PLMN or SNPN change;\nb)\tupon an inter-system change; or\nc)\tupon registration over another access type.\nIf the network indicates that a back-off timer for the PDU session establishment procedure is deactivated, then it remains deactivated;\na)\tupon a PLMN or SNPN change;\nb)\tupon an inter-system change; or\nc)\tupon registration over another access type.\nNOTE\u00a05:\tThis means the back-off timer can still be running or be deactivated for the given 5GSM procedure when the UE returns to the PLMN or SNPN or when it performs inter-system change back from S1 mode to N1 mode. Thus, the UE can still be prevented from sending another PDU SESSION ESTABLISHMENT REQUEST message for the combination of [PLMN, DNN, (mapped) HPLMN S-NSSAI], [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI], [PLMN, no DNN, no S-NSSAI], [PLMN, DNN], or [PLMN, no DNN] in the PLMN, or for the combination of [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN], or [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] in the SNPN.\nIf the back-off timer is started upon receipt of a PDU SESSION ESTABLISHMENT REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, the UE behaves as follows:\na)\tafter a PLMN or SNPN change:\n1)\tthe UE may send a PDU SESSION ESTABLISHMENT REQUEST message for:\ni)\tin a PLMN, the combination of [new PLMN, DNN, (mapped) HPLMN S-NSSAI], [new PLMN, DNN, no S-NSSAI], [new PLMN, no DNN, (mapped) HPLMN S-NSSAI], or [new PLMN, no DNN, no S-NSSAI] in the new PLMN, if the back-off timer is not running and is not deactivated for the PDU session establishment procedure and the combination of [new PLMN, DNN, (mapped) HPLMN S-NSSAI], [new PLMN, DNN, no S-NSSAI], [new PLMN, no DNN, (mapped) HPLMN S-NSSAI], or [new PLMN, no DNN, no S-NSSAI]; or\nii)\tin an SNPN, the combination of [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed SNPN S-NSSAI], [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [new PLMN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI], or [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] in the new SNPN, if the back-off timer is not running and is not deactivated for the PDU session establishment procedure and the combination of [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed SNPN S-NSSAI], [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI], or [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI];\n2)\tas an implementation option, for the 5GSM cause value #8 \"operator determined barring\", #32 \"service option not supported\", #33 \"requested service option not subscribed\" and #70 \"missing or unknown DNN in a slice\", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another PDU SESSION ESTABLISHMENT REQUEST message for:\ni)\tin a PLMN, the same combination of [PLMN, DNN, (mapped) HPLMN S-NSSAI], [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI], or [PLMN, no DNN, no S-NSSAI] using the same PDU session type if the UE is registered to a new PLMN which is in the list of equivalent PLMNs; or\nii)\tin an SNPN, if the UE supports equivalent SNPNs, the same combination of [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed SNPN S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI], or [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] using the same PDU session type and using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, if the UE is registered to a new SNPN which is in the list of equivalent SNPNs; and\n3)\tas an implementation option, for the 5GSM cause value #27 \"missing or unknown DNN\", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another PDU SESSION ESTABLISHMENT REQUEST message for:\ni)\tin a PLMN, the same combination of [PLMN, DNN] or [PLMN, no DNN] using the same PDU session type if the UE is registered to a new PLMN which is in the list of equivalent PLMNs; or\nii)\tin an SNPN, if the UE supports equivalent SNPNs, the same combination of [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN] or [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN] using the same PDU session type if the UE is registered to a new SNPN which is in the list of equivalent SNPNs; or\nb)\tif the network does not include the Re-attempt indicator IE to indicate whether re-attempt in S1 mode is allowed, or the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, then:\n1)\tif the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list and the back-off timer is running for the combination of [PLMN, DNN, (mapped) HPLMN S-NSSAI] or [PLMN, DNN, no S-NSSAI], the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] or in USIM file NASCONFIG as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], if available, to determine whether the UE may attempt a PDN connectivity procedure for the same [PLMN, DNN] combination in S1 mode. If the back-off timer is running for the combination of [PLMN, no DNN, (mapped) HPLMN S-NSSAI] or [PLMN, no DNN, no S-NSSAI], the same applies for the PDN connectivity procedure for the [PLMN, no DNN] combination in S1 mode accordingly; and\nNOTE\u00a06:\tThe way to choose one of the configured SM_RetryAtRATChange values for back-off timer value is up to UE implementation if the UE is configured with:\n-\tan SM_RetryAtRATChange value in ME as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17]; and\n-\tan SM_RetryAtRATChange value in USIM file NASCONFIG as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22].\n2)\tif the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, or if the NAS configuration MO as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] is not available and the value for inter-system change is not configured in the USIM file NASCONFIG, then the UE behaviour regarding a PDN connectivity procedure for the same [PLMN, DNN] or [PLMN, no DNN] combination in S1 mode is unspecified; and\nc)\tif the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN or SNPN is not allowed, then depending on the timer value received in the Back-off timer value IE, for:\n1)\tin a PLMN, each combination of a PLMN from the equivalent PLMN list and the respective [DNN, (mapped) HPLMN S-NSSAI], [DNN, no S-NSSAI], [no DNN, (mapped) HPLMN S-NSSAI], or [no DNN, no S-NSSAI] combination, the UE shall start a back-off timer for the PDU session establishment procedure with the value provided by the network, or deactivate the respective back-off timer as follows:\ni)\tif the Re-attempt indicator IE additionally indicates that re-attempt in S1 mode is allowed, the UE shall start or deactivate the back-off timer for N1 mode only; and\nii)\totherwise, the UE shall start or deactivate the back-off timer for S1 and N1 mode; or\n2)\tin a SNPN, if the UE supports equivalent SNPNs, each combination of a SNPN from the equivalent SNPN list and the respective [the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed SNPN S-NSSAI], [the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI], or [the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] combination, the UE shall start a back-off timer for the PDU session establishment procedure with the value provided by the network, or deactivate the respective back-off timer, for N1 mode.\nIf the back-off timer for a [PLMN, DNN] or [PLMN, no DNN] combination, was started or deactivated in S1 mode upon receipt of PDN CONNECTIVITY REJECT message (see 3GPP\u00a0TS\u00a024.301\u00a0[15]) and the network indicated that re-attempt in N1 mode is allowed, then this back-off timer does not prevent the UE from sending a PDU SESSION ESTABLISHMENT REQUEST message in this PLMN for the same DNN, or without DNN, after inter-system change to N1 mode. If the network indicated that re-attempt in N1 mode is not allowed, the UE shall not send any PDU SESSION ESTABLISHMENT REQUEST message in this PLMN for the same DNN in combination with any S-NSSAI or without S-NSSAI, or in this PLMN without DNN in combination with any S-NSSAI or without S-NSSAI, after inter-system change to N1 mode until the timer expires, the UE is switched off or the USIM is removed.\nNOTE\u00a07:\tThe back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.\nNOTE\u00a08:\tReference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation.\nWhen the back-off timer is running or the timer is deactivated, the UE is allowed to initiate a PDU session establishment procedure if the procedure is for emergency services.\nIf the 5GSM cause value is #28 \"unknown PDU session type\" and the PDU SESSION ESTABLISHMENT REQUEST message contained a PDU session type IE indicating a PDU session type, the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any. The UE may send another PDU SESSION ESTABLISHMENT REQUEST message to establish a new PDU session with the PDU session type IE indicating another PDU session type, e.g. using another value which can be used for the rejected component in another route selection descriptor, if any, as specified in 3GPP\u00a0TS\u00a024.526\u00a0[19]. The behaviour of the UE for 5GSM cause value #28 also applies if the PDU session is a MA PDU Session.\nIf the 5GSM cause value is #39 \"reactivation requested\", the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any.\nNOTE\u00a09:\tFurther UE behaviour upon receipt of 5GSM cause value #39 is up to the UE implementation.\nIf the 5GSM cause value is #46 \"out of LADN service area\", the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any. If the UE is not located inside the LADN service area, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message or another PDU SESSION MODIFICATION REQUEST message except for indicating a change of 3GPP PS data off UE status for the LADN DNN provided by the UE during the PDU session establishment procedure until the LADN information for the specific LADN DNN or the extended LADN information for the specific LADN DNN and S-NSSAI is updated as described in subclause\u00a05.4.4 and subclause\u00a05.5.1. If the UE is not located inside the LADN service area, the UE shall not indicate the PDU session(s) for the LADN DNN provided by the UE during the PDU session establishment procedure in the Uplink data status IE included in the SERVICE REQUEST message until the LADN information for the specific LADN DNN or the extended LADN information for the specific LADN DNN and S-NSSAI is updated as described in subclause\u00a05.4.4 and subclause\u00a05.5.1.\nNOTE\u00a010:\tBased on UE implementation, the UE locating inside the LADN service area can send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the LADN DNN which was rejected with the 5GSM cause value #46 \"out of LADN service area\".\nNOTE\u00a010A:\tIf the UE does not receive a CONFIGURATION UPDATE COMMAND message with new LADN information within an implementation dependent time, the UE can request this information by initiating a registration procedure for mobility or periodic registration update (see subclause\u00a05.5.1.3.2, item\u00a0q).\nIf the 5GSM cause value is #50 \"PDU session type IPv4 only allowed\", #51 \"PDU session type IPv6 only allowed\", #57 \"PDU session type IPv4v6 only allowed\", #58 \"PDU session type Unstructured only allowed\", or #61 \"PDU session type Ethernet only allowed\", the UE shall ignore the Back-off timer value IE provided by the network, if any. The UE shall evaluate the URSP rules if available as specified in 3GPP\u00a0TS\u00a024.526\u00a0[19]. The UE shall not subsequently send another PDU SESSION ESTABLISHMENT REQUEST message for:\na)\tin a PLMN, the same DNN (or no DNN, if no DNN was indicated by the UE) and the same (mapped) HPLMN S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the UE) to obtain a PDU session type different from the one allowed by the network until any of the following conditions is fulfilled:\n1)\tthe UE is registered to a new PLMN which was not in the list of equivalent PLMNs at the time when the PDU SESSION ESTABLISHMENT REJECT message was received;\n2)\tthe UE is registered to a new PLMN which was in the list of equivalent PLMNs at the time when the PDU SESSION ESTABLISHMENT REJECT message was received, and either the network did not include a Re-attempt indicator IE in the PDU SESSION ESTABLISHMENT REJECT message or the Re-attempt indicator IE included in the message indicated that re-attempt in an equivalent PLMN is allowed;\n3)\tthe UE is switched off; or\n4)\tthe USIM is removed; or \nb)\tin an SNPN, the same DNN (or no DNN, if no DNN was indicated by the UE) and the same (mapped) subscribed SNPN S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the UE), using the selected entry of the \"list of subscriber data\" or selected PLMN subscription until any of the following conditions is fulfilled:\n1)\tthe UE is registered to a new SNPN which was not in the list of equivalent SNPNs at the time when the PDU SESSION ESTABLISHMENT REJECT message was received;\n2)\tthe UE is registered to a new SNPN which was in the list of equivalent SNPNs at the time when the PDU SESSION ESTABLISHMENT REJECT message was received, and either the network did not include a Re-attempt indicator IE in the PDU SESSION ESTABLISHMENT REJECT message or the Re-attempt indicator IE included in the message indicated that re-attempt in an equivalent SNPN is allowed;\n3)\tthe UE is switched off;\n4)\tthe USIM is removed; or\n5)\tthe selected entry of the \"list of subscriber data\" is updated.\nFor the 5GSM cause values #50 \"PDU session type IPv4 only allowed\", #51 \"PDU session type IPv6 only allowed\", #57 \"PDU session type IPv4v6 only allowed\", #58 \"PDU session type Unstructured only allowed\", and #61 \"PDU session type Ethernet only allowed\", the UE shall ignore the value of the RATC bit in the Re-attempt indicator IE provided by the network, if any.\nNOTE\u00a011:\tFor the 5GSM cause values #50 \"PDU session type IPv4 only allowed\", #51 \"PDU session type IPv6 only allowed\", #57 \"PDU session type IPv4v6 only allowed\", #58 \"PDU session type Unstructured only allowed\", and #61 \"PDU session type Ethernet only allowed\", re-attempt in S1 mode for the same DNN (or no DNN, if no DNN was indicated by the UE) is only allowed using the PDU session type(s) indicated by the network.\nIf the 5GSM cause value is #54 \"PDU session does not exist\", the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any. If the PDU session establishment procedure is to perform handover of an existing PDU session between 3GPP access and non-3GPP access, the UE shall release locally the existing PDU session with the PDU session ID included in the PDU SESSION ESTABLISHMENT REJECT message. The UE may initiate another UE-requested PDU session establishment procedure with the request type set to \"initial request\" in the subsequent PDU SESSION ESTABLISHMENT REQUEST message to establish a PDU session with:\na) in a PLMN, the same DNN (or no DNN, if no DNN was indicated by the UE) and the same (mapped) HPLMN S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the UE); or\nb)\tin an SNPN, the same DNN (or no DNN, if no DNN was indicated by the UE) and the same (mapped) subscribed SNPN S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the UE) using the selected entry of the \"list of subscriber data\" or selected PLMN subscription.\nNOTE\u00a012:\tUser interaction is necessary in some cases when the UE cannot re-establish the PDU session(s) automatically.\nIf the 5GSM cause value is #68 \"not supported SSC mode\", the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any. The UE shall evaluate the URSP rules if available as specified in 3GPP\u00a0TS\u00a024.526\u00a0[19]. The UE shall not subsequently send another PDU SESSION ESTABLISHMENT REQUEST message for:\na)\tin a PLMN, the same DNN (or no DNN, if no DNN was indicated by the UE) and the same (mapped) HPLMN S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the UE) using the same SSC mode or an SSC mode which was not included in the Allowed SSC mode IE until any of the following conditions is fulfilled:\n1)\tthe UE is registered to a new PLMN which was not in the list of equivalent PLMNs at the time when the PDU SESSION ESTABLISHMENT REJECT message was received;\n2)\tthe SSC mode which is used to access to the DNN (or no DNN, if no DNN was indicated by the UE) and the (mapped) HPLMN S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the UE) is changed by the UE which subsequently requests a new SSC mode in the Allowed SSC mode IE or no SSC mode;\n3)\tthe UE is switched off; or\n4)\tthe USIM is removed; or\nb)\tin an SNPN, the same DNN (or no DNN, if no DNN was indicated by the UE) and the same subscribed SNPN S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the UE) using the same SSC mode or an SSC mode which was not included in the Allowed SSC mode IE, using the selected entry of the \"list of subscriber data\" or selected PLMN subscription until any of the following conditions is fulfilled:\n1)\tthe UE is registered to a new SNPN which was not in the list of equivalent SNPNs at the time when the PDU SESSION ESTABLISHMENT REJECT message was received;\n2)\tthe SSC mode which is used to access to the DNN (or no DNN, if no DNN was indicated by the UE) and the (mapped) subscribed SNPN S-NSSAI (or no S-NSSAI, if no S-NSSAI was indicated by the UE) is changed by the UE which subsequently requests a new SSC mode in the Allowed SSC mode IE or no SSC mode;\n3)\tthe UE is switched off;\n4)\tthe USIM is removed, or\n5)\tthe selected entry of the \"list of subscriber data\" is updated.\nIf the UE receives the 5GSM cause value is #33 \"requested service option not subscribed\" upon sending PDU SESSION ESTABLISHMENT REQUEST to establish an MA PDU session, the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any. The UE shall evaluate URSP rules, if available, as specified in 3GPP\u00a0TS\u00a024.526\u00a0[19] and the UE may send PDU SESSION ESTABLISHMENT REQUEST after evaluating those URSP rules.\nIf the 5GSM cause value is #86 \"UAS services not allowed\", the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any, and shall behave as specified in subcluase\u00a06.4.1.4.1.\nUpon receipt of an indication from 5GMM sublayer that the 5GSM message was not forwarded because the DNN is not supported or not subscribed in a slice along with a PDU SESSION ESTABLISHMENT REQUEST message with the PDU session ID IE set to the PDU session ID of the PDU session, the UE shall stop timer T3580, shall abort the procedure and shall behave as follows:\na)\tif the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value received from the 5GMM sublayer for the PDU session establishment procedure and:\n1)\tin a PLMN, the [PLMN, DNN, S-NSSAI] combination or the [PLMN, DNN, no S-NSSAI] combination, if no S-NSSAI was provided during the PDU session establishment. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message in the PLMN for the same DNN and the same S-NSSAI that were sent by the UE, or for the same DNN and no S-NSSAI if S-NSSAI that was not sent by the UE, until:\ni)\tthe back-off timer expires;\nii)\tthe UE is switched off;\niii)\tthe USIM is removed; or\niv)\tthe DNN is included in the LADN information or extended LADN information and the network provides the LADN information or extended LADN information during the registration procedure or the generic UE configuration update procedure; or\n2)\tin an SNPN, the [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, S-NSSAI] combination or the [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI] combination, if no S-NSSAI was provided during the PDU session establishment. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message in the SNPN for the same DNN and the same S-NSSAI that were sent by the UE, or for the same DNN and no S-NSSAI if S-NSSAI that was not sent by the UE, using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until:\ni)\tthe back-off timer expires;\nii)\tthe UE is switched off;\niii)\tthe USIM is removed; or\niv) the selected entry of the \"list of subscriber data\" is updated; or\nv)\tthe DNN is included in the LADN information or extended LADN information and the network provides the LADN information or extended LADN information during the registration procedure or the generic UE configuration update procedure;\nb)\tif the timer value is not received from the 5GMM sublayer or the timer value indicates that this timer is deactivated, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message\n1)\tin the PLMN for the same DNN and the same S-NSSAI that were sent by the UE, or for the same DNN and no S-NSSAI if S-NSSAI that was not sent by the UE, until:\ni)\tthe UE is switched off;\nii)\tthe USIM is removed; or\niii)\tthe DNN is included in the LADN information or extended LADN information and the network provides the LADN information or extended LADN information during the registration procedure or the generic UE configuration update procedure; and\n2)\tin the SNPN, for the same DNN and the same S-NSSAI that were sent by the UE, or for the same DNN and no S-NSSAI if S-NSSAI that was not sent by the UE, using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until:\ni)\tthe UE is switched off;\nii)\tthe USIM is removed;\niii)\tthe selected entry of the \"list of subscriber data\" is updated; or\niii)\tthe DNN is included in the LADN information or extended LADN information and the network provides the LADN information or extended LADN information during the registration procedure or the generic UE configuration update procedure; and\nc)\tif the timer value indicates zero, the UE may send another PDU SESSION ESTABLISHMENT REQUEST message for:\n1)\tin a PLMN, the same combination of [PLMN, DNN, S-NSSAI], [PLMN, DNN, no S-NSSAI] in the current PLMN; or\n2)\tin an SNPN, the same combination of [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI] in the current SNPN.\n6.4.1.5\tHandling the maximum number of established PDU sessions\nThe maximum number of PDU sessions which a UE can establish in a PLMN or SNPN is limited by whichever is the lowest of: the maximum number of PDU session IDs allowed by the protocol (as specified in 3GPP\u00a0TS\u00a024.007\u00a0[11] subclause\u00a011.2.3.1b), the PLMN's or SNPN's maximum number of PDU sessions and the UE's implementation-specific maximum number of PDU sessions.\nIf during a UE-requested PDU session establishment procedure the 5GSM sublayer in the UE receives an indication that the 5GSM message was not forwarded because:\na)\tthe PLMN's maximum number of PDU sessions has been reached, then the UE determines the PLMN's maximum number of PDU sessions as the number of active PDU sessions it has; or\nb)\tthe SNPN's maximum number of PDU sessions has been reached, then the UE determines the SNPN's maximum number of PDU sessions as the number of active PDU sessions it has and associates the determined maximum number of PDU sessions with:\n1)\tthe entry in the \"list of subscriber data\" for the current SNPN if the UE does not support access to an SNPN using credentials from a credentials holder and equivalent SNPNs; or\n2)\tthe selected entry of the \"list of subscriber data\" or the selected PLMN subscription if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both.\nNOTE\u00a01:\tIn some situations, when attempting to establish multiple PDU sessions, the number of active PDU sessions that the UE has when 5GMM cause #65 is received is not equal to the maximum number of PDU sessions reached in the network.\nNOTE\u00a02:\tWhen the network supports emergency services, it is not expected that 5GMM cause #65 is returned by the network when the UE requests an emergency PDU session.\nNOTE\u00a03:\tThe network maintains only one maximum number of PDU sessions for a PLMN regardless of which access the PDU session exists in.\nNOTE\u00a03a:\tWhen the UE is registered on the same PLMN for both 3GPP access and non-3GPP access, the UE maintains single maximum number of PDU sessions for respective PLMN. When the UE is registered on two different PLMNs over 3GPP access and non-3GPP access, the UE maintains maximum number of PDU sessions for a PLMN separately for each PLMN.\nNOTE\u00a04:\tAn MA PDU session which (only) has a PDN connection established as a user-plane resource is counted as an active PDU session when determining the PLMN's maximum number of PDU sessions.\nThe PLMN's maximum number of PDU sessions applies to the PLMN in which the 5GMM cause #65 \"maximum number of PDU sessions reached\" is received. When the UE is switched off or when the USIM is removed, the UE shall clear all previous determinations representing PLMN's maximum number of PDU sessions.\nThe SNPN's maximum number of PDU sessions applies to the SNPN in which the 5GMM cause #65 \"maximum number of PDU sessions reached\" is received. When the UE is switched off, the UE shall clear all previous determinations representing SNPN's maximum number of PDU sessions. In addition:\na)\tif the UE does not support access to an SNPN using credentials from a credentials holder and equivalent SNPNs, and the entry in the \"list of subscriber data\" for the current SNPN is updated, then the UE shall clear all previous determinations representing SNPN's maximum number of PDU sessions associated with the entry in the \"list of subscriber data\" for the current SNPN; and\nb)\tif the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, and:\n1)\tthe selected entry of the \"list of subscriber data\" is updated, then UE shall clear all previous determinations representing SNPN's maximum number of PDU sessions associated with the selected entry in the \"list of subscriber data\"; or\n2)\tthe USIM associated with the selected PLMN subscription is removed, then UE shall clear all previous determinations representing SNPN's maximum number of PDU sessions associated with the selected PLMN subscription.\nUpon successful registration with a new PLMN or SNPN, the UE may clear previous determinations representing any PLMN's or SNPN's maximum number(s) of PDU sessions, if the previous PLMN or SNPN is not registered over both 3GPP access and non-3GPP access.\nIf the maximum number of established PDU sessions is reached at the UE and the upper layers of the UE request connectivity to a DNN the UE shall not send a PDU SESSION ESTABLISHMENT REQUEST message unless an established PDU session is released. If the UE needs to release an established PDU session, choosing which PDU session to release is implementation specific, however the UE shall not release the emergency PDU session.\nIf the UE needs to release a PDU session in order to request an emergency PDU session, it shall either perform a local release of a PDU session or release a PDU session via explicit signalling. If the UE performs a local release, the UE shall:\na)\tif the PDU session is an MA PDU session:\n1)\tperform a registration procedure for mobility and periodic registration update to indicate PDU session status to the network over each access that user plane resources have been established; and \n2)\tperform a normal and periodic tracking area updating to indicate EPS bearer context status to the network as specified in subclause\u00a05.5.3.2.2 of 3GPP\u00a0TS\u00a024.301\u00a0[15] when a PDN connection has been established as a user plance resource; or\nb)\tif the PDU session is a single access PDU session, perform a registration procedure for mobility and periodic registration update to indicate PDU session status to the network over the access the PDU session is associated with.\n6.4.1.5A\tHandling the maximum number of allowed active user-plane resources for PDU sessions of UEs in NB-N1 mode\nFor a UE in NB-N1 mode, the UE's maximum number of supported user-plane resources is two (as defined in 3GPP\u00a0TS\u00a036.300\u00a0[25B]) when the UE sets the Multiple user-plane resources support bit to \"Multiple user-plane resources supported\" during the registration procedure for initial registration or for mobility and periodic registration update, and one otherwise.\nFor a UE operating in NB-N1 mode, if:\na)\tthe UE's maximum number of supported user-plane resources is one, then only one PDU session can have active user-plane resources even though that UE might have established more than one PDU session; or\nb)\tthe UE's maximum number of supported user-plane resources is two, then only two PDU sessions can have active user-plane resources even though that UE might have established more than two PDU sessions.\nWhen the maximum number of active user-plane resources is reached and upper layers request for more user-plane resources for PDU sessions other than the PDU sessions with those active user-plane resources, the UE can choose to release one or more of the PDU sessions with active user-plane resources to cater for the upper layer request. The choice of which PDU sessions to be released is implementation specific. However if there is a PDU session with an active user-plane that is used for exception data reporting (see subclause\u00a06.2.13), that PDU session shall not be released.\nIf the maximum number of active user-plane resources is reached and the upper layers of the UE request user-plane resources for exception data reporting (see subclause\u00a06.2.13), the UE shall release a PDU session that has user-plane resources to cater for the request for exception data reporting. The choice of which PDU session to be released is implementation specific.\nIf the UE decides to release one or more active user-plane resources to cater for upper layer request, the UE shall release the PDU session via explicit 5GSM signalling.\n6.4.1.6\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3580\n\tThe UE shall, on the first expiry of the timer T3580:\n-\tif the PDU SESSION ESTABLISHMENT REQUEST message was sent with request type set to \"initial emergency request\" or \"existing emergency PDU session\", then the UE may:\na)\tinform the upper layers of the failure of the procedure; or\nNOTE\u00a01:\tThis can result in the upper layers requesting another emergency call attempt using domain selection as specified in 3GPP\u00a0TS\u00a023.167\u00a0[6].\nb)\tde-register locally, if not de-registered already, attempt initial registration for emergency services.\n\tIf the UE sent the PDU SESSION ESTABLISHMENT REQUEST message in order to perform a handover of an existing emergency PDU session between 3GPP access and non-3GPP access, the UE shall consider that the emergency PDU session is associated with the source access type.\n-\totherwise, retransmit the PDU SESSION ESTABLISHMENT REQUEST message and the PDU session information which was transported together with the initial transmission of the PDU SESSION ESTABLISHMENT REQUEST message and shall reset and start timer T3580, if still needed. This retransmission can be repeated up to four times, i.e. on the fifth expiry of timer T3580, the UE shall abort the procedure, release the allocated PTI and enter the state PROCEDURE TRANSACTION INACTIVE. If the UE sent the PDU SESSION ESTABLISHMENT REQUEST message in order to perform a handover of an existing non-emergency PDU session between 3GPP access and non-3GPP access, the UE shall consider that the PDU session is associated with the source access type.\nb)\tUpon receiving an indication that the 5GSM message was not forwarded due to routing failure along with a PDU SESSION ESTABLISHMENT REQUEST message with the PDU session ID IE set to the same value as the PDU session ID that was sent by the UE, the UE shall stop timer T3580 and shall abort the procedure. If the UE sent the PDU SESSION ESTABLISHMENT REQUEST message in order to perform a handover of an existing PDU session between 3GPP access and non-3GPP access, the UE shall consider that the PDU session is associated with the source access type.\nb1)\tUpon receiving an indication that the 5GSM message was not forwarded due to service area restrictions along with a PDU SESSION ESTABLISHMENT REQUEST message with the PDU session ID IE set to the same value as the PDU session ID that was sent by the UE, the UE shall stop timer T3580 and shall abort the procedure. If the UE sent the PDU SESSION ESTABLISHMENT REQUEST message in order to perform a handover of an existing PDU session between 3GPP access and non-3GPP access, the UE shall consider that the PDU session is associated with the source access type.\nb2)\tUpon receiving an indication that the 5GSM message was not forwarded because the UE is registered to a PLMN via a satellite NG-RAN cell that is not allowed to operate at the present UE location along with a PDU SESSION ESTABLISHMENT REQUEST message with the PDU session ID IE set to the same value as the PDU session ID that was sent by the UE, the UE shall stop timer T3580 and shall abort the procedure. \nb3)\tUpon receiving an indication that the 5GSM message was not forwarded because the UE is marked in the UE's 5GMM context that it is not allowed to request UAS services along with a PDU SESSION ESTABLISHMENT REQUEST message with the PDU session ID IE set to the same value as the PDU session ID that was sent by the UE, the UE shall stop timer T3580 and shall abort the procedure. The UE shall not trigger the PDU session establishment procedure until the UE is deregistered from the PLMN.\nb4)\tUpon receiving an indication that the 5GSM message was not forwarded because the PLMN's maximum number of PDU sessions has been reached along with a PDU SESSION ESTABLISHMENT REQUEST message with the PDU session ID IE set to the same value as the PDU session ID that was sent by the UE, the UE shall stop timer T3580 and shall abort the procedure.\nb5)\tUpon receiving an indication that the 5GSM message was not forwarded due to unexpected cause along with a PDU SESSION ESTABLISHMENT REQUEST message with the PDU session ID IE set to the same value as the PDU session ID that was sent by the UE, the UE shall stop timer T3580 and shall abort the procedure.\nc)\tCollision of UE-requested PDU session establishment procedure and network-requested PDU session release procedure.\n\tIf the UE receives a PDU SESSION RELEASE COMMAND message after sending a PDU SESSION ESTABLISHMENT REQUEST message to the network, and the PDU session ID in the PDU SESSION RELEASE COMMAND message is the same as the PDU session ID in the PDU SESSION ESTABLISHMENT REQUEST message:\ni)\tif the UE-requested PDU session establishment procedure was to request the establishment of user plane resources on the second access for an MA PDU session established on a first access and the Access type IE is not included in PDU SESSION RELEASE COMMAND or the Access type IE included in PDU SESSION RELEASE COMMAND indicates the first access, the UE shall proceed with the network-requested PDU session release procedure, abort the UE-requested PDU session establishment procedure, stop timer T3580, release the allocated PTI and enter the state PROCEDURE TRANSACTION INACTIVE;\nii)\tif the PDU SESSION ESTABLISHMENT REQUEST message was sent with request type set to \"existing PDU session\" or \"existing emergency PDU session\" in order to perform a handover of an existing PDU session between 3GPP access and non-3GPP access, the UE shall abort the PDU session establishment procedure and proceed with the network-requested PDU session release procedure; or\niii)\totherwise, the UE shall ignore the PDU SESSION RELEASE COMMAND message and proceed with the UE-requested PDU session establishment procedure.\nd)\tInter-system change from N1 mode to S1 mode triggered during UE-requested PDU session establishment procedure.\n\tIf the UE-requested PDU session establishment procedure is triggered for handover of an existing PDU session from non-3GPP access to 3GPP access, and the inter-system change from N1 mode to S1 mode is triggered by the NG-RAN and the UE did not receive response to PDU session establishment request, then the UE shall abort the procedure, stop timer T3580, and notify the upper layer of the handover failure.\nNOTE\u00a02:\tThis can result in the upper layer requesting re-initiation of handover from non-3GPP access to 3GPP access after the inter-system change is completed, if still required.\ne)\tFor an MA PDU session established on a single access, upon receipt of a PDU SESSION ESTABLISHMENT ACCEPT message over the other access, if any value of the selected PDU session type, selected SSC mode, 5GSM cause, PDU address, S-NSSAI, DNN IEs in the PDU SESSION ESTABLISHMENT ACCEPT message is different from the corresponding stored value, the UE shall perform a local release of the MA PDU session, and perform the registration procedure for mobility and periodic registration update with a REGISTRATION REQUEST message including the PDU session status IE over both accesses.\nf)\tFor an MA PDU session has a PDN connection as a user-plane resource, upon receipt of a PDU SESSION ESTABLISHMENT ACCEPT message over non-3GPP access, if any value of the selected PDU session type, selected SSC mode, 5GSM cause, PDU address, S-NSSAI, DNN IEs in the PDU SESSION ESTABLISHMENT ACCEPT message is different from the corresponding stored mapped value, the UE shall perform a local release of the MA PDU session, perform the registration procedure for mobility and periodic registration update with a REGISTRATION REQUEST message including the PDU session status IE over non-3GPP access, and perform the tracking area updating procedure as specified in subclause\u00a05.5.3.2.2 of 3GPP\u00a0TS\u00a024.301\u00a0[15] with a TRACKING AREA UPDATE REQUEST message including EPS bearer context status IE.\ng)\tCollision of UE-requested PDU session establishment procedure initiated to perform handover of an existing PDU session from non-3GPP access to 3GPP access and a notification from the network with access type indicating non-3GPP access.\n\tIf the UE receives a notification from the network with access type indicating non-3GPP access after sending a PDU SESSION ESTABLISHMENT REQUEST message to perform handover of an existing PDU session from non-3GPP access to 3GPP access, the UE shall abort the PDU session establishment procedure, stop timer T3580, proceed with the service request procedure to perform handover of existing PDU session(s) from non-3GPP access to 3GPP access.\nh)\tCollision of UE-requested PDU session establishment procedure and N1 NAS signalling connection release\n\tThe UE may immediately retransmit the PDU SESSION ESTABLISHMENT REQUEST message and stop, reset and restart timer T3580, if the following conditions apply:\n1)\tThe original UE-requested PDU session establishment procedure was initiated over an existing N1 NAS signalling connection;\n2)\tthe previous transmission of the PDU SESSION ESTABLISHMENT REQUEST message was not initiated due to timer T3580 expiry; and\n3)\tno 5GSM message related to the PDU session (e.g. PDU SESSION AUTHENTICATION COMMAND message) was received after the PDU SESSION ESTABLISHMENT REQUEST message was transmitted.\ni)\tCollision of UE-requested PDU session establishment procedure and network-requested PDU session modification procedure\n\tIf the UE receives a PDU SESSION MODIFICATION COMMAND message after sending a PDU SESSION ESTABLISHMENT REQUEST message to the network, and the PDU session ID in the PDU SESSION MODIFICATION COMMAND message is the same as the PDU session ID in the PDU SESSION ESTABLISHMENT REQUEST message:\ni)\tif the UE-requested PDU session establishment procedure was to request the establishment of user plane resources on the second access for an MA PDU session established on a first access, the UE shall proceed with both the UE-requested PDU session establishment procedure and the network-requested PDU session modification procedure; or\nii)\tif the PDU SESSION ESTABLISHMENT REQUEST message was sent with request type set to \"existing PDU session\" or \"existing emergency PDU session\" in order to perform a handover of an existing PDU session between 3GPP access and non-3GPP access, the UE shall proceed with the UE-requested PDU session establishment procedure and abort the network-requested PDU session modification procedure.\n6.4.1.7\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tIf the received request type is \"initial emergency request\" and there is an existing emergency PDU session for the UE, regardless whether the PDU session ID in the PDU SESSION ESTABLISHMENT REQUEST message is identical to the PDU session ID of the existing PDU session, the SMF shall locally release the existing emergency PDU session and proceed the new PDU SESSION ESTABLISHMENT REQUEST message\nb)\tThe information for the PDU session authentication and authorization by the external DN in the SM PDU DN request container IE is not compliant with local policy and user's subscription data\n\tIf the PDU session being established is a non-emergency PDU session, the request type is not set to \"existing PDU session\", the PDU session authentication and authorization by the external DN is required due to local policy and user's subscription data and the information for the PDU session authentication and authorization by the external DN in the SM PDU DN request container IE is not compliant with the local policy and user's subscription data, the SMF shall reject the PDU session establishment request including the 5GSM cause #29 \"user authentication or authorization failed\", in the PDU SESSION ESTABLISHMENT REJECT message.\nc)\tUE-requested PDU session establishment with request type set to \"initial request\" for an existing PDU session:\n\tIf the SMF receives a PDU SESSION ESTABLISHMENT REQUEST message with a PDU session ID identical to the PDU session ID of an existing PDU session and with request type set to \"initial request\", the SMF shall locally release the existing PDU session and proceed with the PDU session establishment procedure.\nd)\tUE-requested PDU session establishment with request type \"existing PDU session\" or \"existing emergency PDU session\" for a PDU session that does not exist:\n\tIf the SMF receives a PDU SESSION ESTABLISHMENT REQUEST message with request type set to \"existing PDU session\" or \"existing emergency PDU session\", and the SMF does not have any information about that PDU session, then the SMF shall reject the PDU session establishment procedure with the 5GSM cause set to #54 \"PDU session does not exist\" in the PDU SESSION ESTABLISHMENT REJECT message.\ne)\t5G access network cannot forward the message:\n\tIf the SMF determines based on content of the n2SmInfo attribute specified in 3GPP\u00a0TS\u00a029.502\u00a0[20A] that the DL NAS TRANSPORT message carrying the PDU SESSION ESTABLISHMENT ACCEPT was not forwarded to the UE by the 5G access network, then the SMF shall reject the PDU session establishment procedure with the 5GSM cause set to #26 \"insufficient resources\" in the PDU SESSION ESTABLISHMENT REJECT message.\n6.4.2\tUE-requested PDU session modification procedure\n6.4.2.1\tGeneral\nThe purpose of the UE-requested PDU session modification procedure is:\na)\tto enable the UE to request modification of a PDU session;\nb)\tto indicate a change of 3GPP PS data off UE status for a PDU session;\nc)\tto revoke the previously indicated support for reflective QoS;\nd)\tto request specific QoS handling and segregation of service data flows;\ne)\tto indicate to the network the relevant 5GSM parameters and capabilities (e.g. the UE's 5GSM capabilities, whether the UE supports more than 16 packet filters, the maximum data rate per UE for user-plane integrity protection supported by the UE for uplink, the maximum data rate per UE for user-plane integrity protection supported by the UE for downlink and whether the UE requests the PDU session to be an always-on PDU session in the 5GS) for a PDN connection established when in S1 mode, after an inter-system change from S1 mode to N1 mode, if the UE is a UE operating in single-registration mode in a network supporting N26 interface and the UE has not previously successfully performed the UE-requested PDU session modification to indicate to the network the relevant 5GSM parameters and capabilities;\nf)\tto delete one or more mapped EPS bearer contexts;\ng)\tto convey a port management information container;\nh)\tto re-negotiate header compression configuration associated to a PDU session using control plane CIoT 5GS optimization; or\ni)\tto enable the UE to request to join or leave one or more multicast MBS sessions associated with a PDU session.\nj)\tto send the URSP rule enforcement report to the network.\nNOTE\u00a01:\tThe case c), d), e), f) and g) do not apply to PDU sessions associated with the control plane only indication.\nNOTE\u00a02:\tFor case e), the procedure is attempted after the first inter-system change from S1 mode to N1 mode.\nWhen the UE-requested PDU session modification procedure is used to indicate a change of 3GPP PS data off UE status for a PDU session (see subclause\u00a06.2.10), the UE shall initiate the UE-requested PDU session modification procedure even if the UE is outside the LADN service area or the timer T3396, T3584, T3585 or the back-off timer is running or is deactivated.\nIf the UE needs to revoke the previously indicated support for reflective QoS for a PDU session and timer T3396, T3584, T3585 or the back-off timer is running or is deactivated, the UE shall not initiate the UE-requested PDU session modification procedure and shall instead initiate the UE-requested PDU session release procedure.\nIf the UE needs to initiate the UE-requested PDU session modification procedure to indicate to the network the relevant 5GSM parameters and capabilities (e.g. the UE's 5GSM capabilities, whether the UE supports more than 16 packet filters, the maximum data rate per UE for user-plane integrity protection supported by the UE for uplink, the maximum data rate per UE for user-plane integrity protection supported by the UE for downlink and whether the UE requests the PDU session to be an always-on PDU session in the 5GS) for a PDN connection established when in S1 mode, after an inter-system change from S1 mode to N1 mode, the UE is a UE operating in single-registration mode in the network supporting N26 interface, the UE has not previously successfully performed the UE-requested PDU session modification to indicate to the network the relevant 5GSM parameters and capabilities, and:\na)\ttimer T3396, T3584, T3585 or the back-off timer is running, the UE shall initiate the UE-requested PDU session modification procedure after expiry of timer T3396, T3584 or T3585 or after expiry of the back-off timer; or\nb)\tthe UE is in substate 5GMM-REGISTERED.NON-ALLOWED-SERVICE and has not performed the the UE-requested PDU session modification procedure (see subclause\u00a05.3.5), the UE shall initiate the UE-requested PDU session modification procedure after entering substate 5GMM-REGISTERED.NORMAL-SERVICE.\n6.4.2.2\tUE-requested PDU session modification procedure initiation\nIn order to initiate the UE-requested PDU session modification procedure, the UE shall create a PDU SESSION MODIFICATION REQUEST message.\nThe UE shall allocate a PTI value currently not used and shall set the PTI IE of the PDU SESSION MODIFICATION REQUEST message to the allocated PTI value.\nThe UE shall not perform the UE-requested PDU session modification procedure for an emergency PDU session, except for a procedure initiated according to subclause\u00a06.4.2.1, item e) only, and for the error cases described in subclause\u00a06.4.1.3 and subclause\u00a06.3.2.3.\nThe UE shall not perform the UE-requested PDU session modification procedure for a PDU session for LADN when the UE is located outside the LADN service area except for indicating a change of 3GPP PS data off UE status.\nIf the UE requests a specific QoS handling and the PDU session is not associated with the control plane only indication, the UE shall include the Requested QoS rules IE indicating requested QoS rules or the Requested QoS flow descriptions IE indicating requested QoS flow descriptions or both for the specific QoS handling. The Requested QoS rules IE includes the packet filters which describe the service data flows requested by the UE. The specific QoS parameters requested by the UE are specified in the Requested QoS flow descriptions IE. If the UE requests the network to bind specific service data flows to a dedicated QoS flow, the UE shall create a new QoS rule by setting the rule operation code to \"Create new QoS rule\" and shall set the segregation bit to \"Segregation requested\" for the corresponding QoS rule in the Requested QoS rules IE. The UE shall set the QRI values to \"no QoS rule identifier assigned\" in the Requested QoS rules IE, if the QoS rules are newly created; otherwise, the UE shall set the QRI values to those of the existing QoS rules for which the specific QoS handling applies. The UE shall set the QFI values to \"no QoS flow identifier assigned\" in the Requested QoS flow descriptions IE, if the QoS flow descriptions are newly created; otherwise, the UE shall set the QFI values to the QFIs of the existing QoS flow descriptions for which the specific QoS handling applies. The UE shall not request to create more than one QoS flow in a UE-requested PDU session modification procedure. If the SMF receives a PDU SESSION MODIFICATION REQUEST message with a Requested QoS rules IE containing more than one QoS rule with the rule operation code set to \"Create new QoS rule\", the SMF shall assign the same QFI to all the QoS rules which are created.\nIf the UE requests to join or leave one or more multicast MBS sessions associated with a PDU session, the UE shall include the Requested MBS container IE in the PDU SESSION MODIFICATION REQUEST message and shall set the MBS operation to \"Join multicast MBS session\" for the join case or to \"Leave MBS session\" for the leave case. The UE shall include the multicast MBS session information(s) and shall set the Type of multicast MBS session ID for each of the multicast MBS session information to either \"Temporary Mobile Group Identity (TMGI)\" or \"Source specific IP multicast address\" depending on the type of the multicast MBS session ID available in the UE. Then the remaining values of each of the multicast MBS session informations shall be set as following:\na)\tif the Type of multicast MBS session ID is set to \"Temporary Mobile Group Identity (TMGI)\", the UE shall set the multicast MBS session ID to the TMGI; or\nb)\tif the Type of multicast MBS session ID is set to \"Source specific IP multicast address for IPv4\" or \" Source specific IP multicast address for IPv6\", the UE shall set the Source IP address information and the Destination IP address information to the corresponding values.\nThe UE should not request to join a multicast MBS session for local MBS service if neither current TAI nor CGI of the current cell is part of the MBS service area(s) of the multicast MBS session, if the UE has valid information of the MBS service area(s) of the multicast MBS session.\nNOTE\u00a01:\tThe UE obtains the details of the multicast MBS session ID(s) e.g,TMGI, Source IP address information and Destination IP address information as a pre-configuration in the UE or during the MBS service announcement which is out of scope of this specification. Pre-configuration can be provided in one or more of the following ways:\na)\tin a UE implementation-specific way (e.g. factory configuration);\nb)\tin the USIM (see EF5MBSUECONFIG file in 3GPP\u00a0TS\u00a031.102\u00a0[22]); or\nc)\tin the UE pre-configuration MO for MBS (see 3GPP\u00a0TS\u00a024.575\u00a0[65]).\nFor a PDN connection established when in S1 mode, after an inter-system change from S1 mode to N1 mode, if the UE is a UE operating in single-registration mode in a network supporting N26 interface, the PDU session is of \"IPv4\", \"IPv6\", \"IPv4v6\", or \"Ethernet\" PDU session type, the PDU session is not associated with the control plane only indication:\na)\tthe UE is performing the PDU session modification procedure to indicate the support of reflective QoS and the UE has not previously successfully performed the UE-requested PDU session modification to provide this indication, the UE shall set the RQoS bit to \"Reflective QoS supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST message; or\nb)\tthe UE is performing the PDU session modification procedure to indicate that reflective QoS is not supported and the UE has not previously successfully performed the UE-requested PDU session modification to provide this indication, the UE shall set the RQoS bit to \"Reflective QoS not supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST message.\nIf the UE is performing the PDU session modification procedure to revoke the previously indicated support of reflective QoS and the PDU session is not associated with the control plane only indication, the UE shall set the RQoS bit to \"Reflective QoS not supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST message. The UE shall not indicate support for reflective QoS for this PDU Session for the remaining lifetime of the PDU Session.\nNOTE\u00a02:\tThe determination to revoke the usage of reflective QoS by the UE for a PDU session is implementation dependent.\nFor a PDN connection established when in S1 mode, after an inter-system change from S1 mode to N1 mode, if the UE is a UE operating in single-registration mode in a network supporting N26 interface, the PDU session is of \"IPv6\" or \"IPv4v6\" PDU session type, the PDU session is not associated with the control plane only indication:\na)\tthe UE is performing the PDU session modification procedure to indicate the support of Multi-homed IPv6 PDU session and the UE has not previously successfully performed the UE-requested PDU session modification to provide this indication, the UE shall set the MH6-PDU bit to \"Multi-homed IPv6 PDU session supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST message; or\nb)\tthe UE is performing the PDU session modification procedure to indicate that Multi-homed IPv6 PDU session is not supported and the UE has not previously successfully performed the UE-requested PDU session modification to provide this indication, the UE shall set the MH6-PDU bit to \"Multi-homed IPv6 PDU session not supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST message.\nFor a PDN connection established when in S1 mode, after an inter-system change from S1 mode to N1 mode, if the UE is a UE operating in single-registration mode in a network supporting N26 interface, the PDU session is of \"IPv4\", \"IPv6\", \"IPv4v6\", or \"Ethernet\" PDU session type, the PDU session is not associated with the control plane only indication, the UE supports more than 16 packet filters for this PDU session, and the UE has not previously successfully performed the UE-requested PDU session modification to provide this indication, the UE shall indicate the maximum number of packet filters supported for the PDU session in the Maximum number of supported packet filters IE of the PDU SESSION MODIFICATION REQUEST message.\nFor a PDN connection established when in S1 mode, after an inter-system change from S1 mode to N1 mode, if the UE is a UE operating in single-registration mode in a network supporting N26 interface, the PDU session is not associated with the control plane only indication, and the UE has not previously successfully performed the UE-requested PDU session modification to include the Integrity protection maximum data rate IE in the PDU SESSION MODIFICATION REQUEST message, the UE shall include the Integrity protection maximum data rate IE in the PDU SESSION MODIFICATION REQUEST message.\nIf the UE is performing the PDU session modification procedure\na)\tto request the deletion of a non-default QoS rule due to errors in QoS operations or packet filters;\nb)\tto request the deletion of a QoS flow description due to errors in QoS operations; or\nc)\tto request the deletion of a mapped EPS bearer context due to errors in mapped EPS bearer operation, TFT operation or packet filters,\nthe UE shall include the 5GSM cause IE in the PDU SESSION MODIFICATION REQUEST message as described in subclauses\u00a06.3.2.3, 6.3.2.4 and 6.4.1.3.\nWhen the UE-requested PDU session modification procedure is used to indicate a change of 3GPP PS data off UE status for a PDU session, the UE shall include the Extended protocol configuration options IE in the PDU SESSION MODIFICATION REQUEST message and setting the 3GPP PS data off UE status.\nFor a PDN connection established when in S1 mode, after an inter-system change from S1 mode to N1 mode, if the UE is a UE operating in single-registration mode in a network supporting N26 interface, the PDU session is not associated with the control plane only indication, the UE requests the PDU session to be an always-on PDU session in the 5GS and the UE has not previously successfully performed the UE-requested PDU session modification to request this, the UE shall include the Always-on PDU session requested IE and set the value of the IE to \"Always-on PDU session requested\" in the PDU SESSION MODIFICATION REQUEST message.\nIf the UE supports transfer of port management information containers, the UE shall set the TPMIC bit to \"Transfer of port management information containers supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST message.\nIf a port management information container needs to be delivered (see 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a023.502\u00a0[9]), the UE shall include a Port management information container IE in the PDU SESSION MODIFICATION REQUEST message.\nTo request re-negotiation of IP header compression configuration, the UE shall include the IP header compression configuration IE in the PDU SESSION MODIFICATION REQUEST message if the network indicated \"Control plane CIoT 5GS optimization supported\" and \"IP header compression for control plane CIoT 5GS optimization supported\" in the 5GS network support feature support IE.\nTo request re-negotiation of Ethernet header compression configuration, the UE shall include the Ethernet header compression configuration IE in the PDU SESSION MODIFICATION REQUEST message if the network indicated \"Control plane CIoT 5GS optimization supported\" and \"Ethernet header compression for control plane CIoT 5GS optimization supported\" in the 5GS network support feature support IE.\nAfter an inter-system change from S1 mode to N1 mode, if:\na)\tthe UE is operating in single-registration mode in the network supporting N26 interface;\nb)\tthe PDU session type value of the PDU session type IE is set to \"IPv4\", \"IPv6\" or \"IPv4v6\";\nc)\tthe UE indicates \"Control plane CIoT 5GS optimization supported\" and \"IP header compression for control plane CIoT 5GS optimization supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message; and\nd)\tthe network indicates \"Control plane CIoT 5GS optimization supported\" and \"IP header compression for control plane CIoT 5GS optimization supported\" in the 5GS network support feature IE of the REGISTRATION ACCEPT message;\nthe UE shall initiate the PDU session modification procedure to negotiate the IP header compression configuration and include the IP header compression configuration IE in the PDU SESSION MODIFICATION REQUEST message.\nThe UE shall include the Service-level-AA container IE in the PDU SESSION MODIFICATION REQUEST message, when requesting to modify an established PDU session for C2 communication. In the Service-level-AA container IE, the UE shall include:\na)\tthe service-level device ID with the value set to the CAA-level UAV ID of the UE; and\nb)\tif available, the service-level-AA payload with the value set to the C2 authorization payload and the service-level-AA payload type with the value set to \"C2 authorization payload\".\nNOTE\u00a03:\tThe C2 authorization payload in the service-level-AA payload can include one, some or all of the pairing information for C2 communication, an indication of the request for direct C2 communication, pairing information for direct C2 communication, and the UAV flight authorization information.\nThe UE may include the Non-3GPP delay budget IE in the PDU SESSION MODIFICATION REQUEST message, when requesting to modify an established PDU session for PIN-DN communication or PIN indirect commmunication.\nNOTE\u00a03A:\tThe Non-3GPP delay budget IE can assist the network in providing specific QoS handling for a set of packet filter(s) for the PDU session as specified in subclause\u00a05.44.3.4 of 3GPP\u00a0TS\u00a023.501\u00a0[8].\nAfter an inter-system change from S1 mode to N1 mode, if:\na)\tthe UE is operating in single-registration mode in a network that supports N26 interface;\nb)\tthe PDU session type value of the PDU session type IE is set to \"Ethernet\";\nc)\tthe UE indicates \"Control plane CIoT 5GS optimization supported\" and \"Ethernet header compression for control plane CIoT 5GS optimization supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message; and\nd)\tthe network indicates \"Control plane CIoT 5GS optimization supported\" and \"Ethernet header compression for control plane CIoT 5GS optimization supported\" in the 5GS network support feature IE of the REGISTRATION ACCEPT message;\nthe UE shall initiate the PDU session modification procedure to negotiate the Ethernet header compression configuration and include the Ethernet header compression configuration IE in the PDU SESSION MODIFICATION REQUEST message.\nFor a PDN connection established when in S1 mode, after an inter-system change from S1 mode to N1 mode, and if the UE is a UE operating in single-registration mode in a network supporting N26 interface, and the UE supports receiving DNS server addresses in protocol configuration options and the UE has not previously successfully performed the UE-requested PDU session modification to indicate this support, the UE shall include the Extended protocol configuration options IE in the PDU SESSION MODIFICATION REQUEST message and:\na)\tif the PDU session is of \"IPv4\" or \"IPv4v6\" PDU session type, the UE shall include the DNS server IPv4 address request; and\nb)\tif the PDU session is of \"IPv6\" or \"IPv4v6\" PDU session type, the UE shall include the DNS server IPv6 address request.\nFor a PDN connection established when in S1 mode, after an inter-system change from S1 mode to N1 mode, and if the UE is a UE operating in single-registration mode in a network supporting N26 interface, and the UE supports the EAS rediscovery and the UE has not previously successfully performed the UE-requested PDU session modification to indicate this support, the UE shall include the Extended protocol configuration options IE in the PDU SESSION MODIFICATION REQUEST message and shall include the EAS rediscovery support indication in the Extended protocol configuration options IE.\nFor a PDN connection established when in S1 mode, after an inter-system change from S1 mode to N1 mode, and if the UE is a UE operating in single-registration mode in a network supporting N26 interface, and the UE supports the EDC and the UE has not previously successfully performed the UE-requested PDU session modification to indicate this support, then the UE shall include the Extended protocol configuration options IE in the PDU SESSION MODIFICATION REQUEST message and shall include the EDC support indicator in the Extended protocol configuration options IE.\nIf the UE supports reporting of URSP rule enforcement and is indicated to send URSP rule enforcement report to network based on the matching URSP rule which contains the URSP rule enforcement report indication set to \"URSP rule enforcement report is required\", the UE shall include the URSP rule enforcement reports IE in the PDU SESSION MODIFICATION REQUEST message.\nThe UE shall transport:\na)\tthe PDU SESSION MODIFICATION REQUEST message;\nb)\tthe PDU session ID; and\nc)\tif the UE-requested PDU session modification:\n1)\tis not initiated to indicate a change of 3GPP PS data off UE status associated to a PDU session, then the request type set to \"modification request\"; and\n2)\tis initiated to indicate a change of 3GPP PS data off UE status associated to a PDU session, then without transporting the request type;\nusing the NAS transport procedure as specified in subclause\u00a05.4.5, and the UE shall start timer T3581 (see example in figure\u00a06.4.2.2.1).\nFor a PDN connection established when in S1 mode and not associated with the control plane only indication, after inter-system change from S1 mode to N1 mode, if the UE is registered in a network supporting the ATSSS,\na)\tthe UE may request to modify a PDU session to an MA PDU session; or\nb)\tthe UE may allow the network to upgrade the PDU session to an MA PDU session. In order for the UE to allow the network to upgrade the PDU session to an MA PDU session, the UE shall set \"MA PDU session network upgrade is allowed\" in the MA PDU session information IE and set the request type to \"modification request\" in the UL NAS TRANSPORT message.\nNOTE\u00a04:\tIf the DNN corresponds to an LADN DNN, the AMF does not forward the MA PDU session information IE to the SMF but sends the message back to the UE to inform of the unhandled request (see subclause\u00a05.4.5.2.5).\nIn case the UE executes case a) or b):\n1)\tif the UE supports ATSSS Low-Layer functionality with any steering mode (i.e., any steering mode allowed for ATSSS Low-Layer functionality) as specified in subclause\u00a05.32.6 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the ATSSS-ST bits to \"ATSSS Low-Layer functionality with any steering mode allowed for ATSSS-LL supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST message;\nNOTE\u00a05:\tThe ATSSS Low-Layer functionality cannot be used together with the redundant steering mode. When the UE indicates that it is capable of supporting the ATSSS Low-Layer functionality with any steering mode, it implies that the UE supports the ATSSS Low-Layer functionality with any steering mode except the redundant steering mode.\n2)\tif the UE supports MPTCP functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode as specified in subclause\u00a05.32.6 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the ATSSS-ST bits to \"MPTCP functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST message;\n3)\tif the UE supports MPTCP functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality)as specified in subclause\u00a05.32.6 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the ATSSS-ST bits to \"MPTCP functionality with any steering mode and ATSSS-LL functionality with any steering mode allowed for ATSSS-LL supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST message;\n4)\tif a performance measurement function in the UE can perform access performance measurements using the QoS flow of the non-default QoS rule as specified in subclause\u00a05.32.5 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the APMQF bit to \"Access performance measurements per QoS flow supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST message;\n5)\tif the UE supports MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode as specified in subclause\u00a05.32.6 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the ATSSS-ST bits to \"MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST message;\n6)\tif the UE supports MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality) as specified in subclause\u00a05.32.6 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the ATSSS-ST bits to \"MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode allowed for ATSSS-LL supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST message;\n7)\tif the UE supports MPTCP functionality with any steering mode, MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode as specified in subclause\u00a05.32.6 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the ATSSS-ST bits to \"MPTCP functionality with any steering mode, MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST message; and\n8)\tif the UE supports MPTCP functionality with any steering mode, MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality) as specified in subclause\u00a05.32.6 of 3GPP\u00a0TS\u00a023.501\u00a0[8], the UE shall set the ATSSS-ST bits to \"MPTCP functionality with any steering mode, MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode allowed for ATSSS-LL supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST message.\nUpon receipt of a PDU SESSION MODIFICATION REQUEST message for MA PDU session modification, the SMF shall check if the 5GSM capability IE in the PDU SESSION MODIFICATION REQUEST message, includes:\na)\tthe ATSSS-ST bits set to \"MPTCP functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode supported\" and:\ni)\tif the DNN configuration allows for the MPTCP functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality), the SMF shall ensure that the modified PDU session has the capability of MPTCP with any steering mode and ATSSS-LL with any steering mode in the downlink and MPTCP with any steering mode and ATSSS-LL with only active-standby steering mode in the uplink; or\nii)\tif the DNN configuration allows for the MPTCP functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode, the SMF shall ensure that the modified PDU session has the capability of MPTCP with any steering mode and ATSSS-LL with only active-standby steering mode in the downlink and the uplink;\nb)\tthe ATSSS-ST bits set to \"MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode supported\" and:\ni)\tif the DNN configuration allows for the MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality), the SMF shall ensure that the modified PDU session has the capability of MPQUIC with any steering mode and ATSSS-LL with any steering mode in the downlink and MPQUIC with any steering mode and ATSSS-LL with only active-standby steering mode in the uplink; or\nii)\tif the DNN configuration allows for the MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode, the SMF shall ensure that the modified PDU session has the capability of MPQUIC with any steering mode and ATSSS-LL with only active-standby steering mode in the downlink and the uplink;\nc)\tthe ATSSS-ST bits set to \"MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode allowed for ATSSS-LL supported\" and if the DNN configuration allows for the MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality), the SMF shall ensure that the modified PDU session has the capability of MPQUIC with any steering mode and ATSSS-LL with any steering mode in the downlink and the uplink;\nd)\tthe ATSSS-ST bits set to \"ATSSS Low-Layer functionality with any steering mode allowed for ATSSS-LL supported\" and if the DNN configuration allows for the ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality), the SMF shall ensure that the modified PDU session has the capability of ATSSS-LL with any steering mode in the downlink and the uplink;\ne)\tthe ATSSS-ST bits set to \"MPTCP functionality with any steering mode and ATSSS-LL functionality with any steering mode allowed for ATSSS-LL supported\" and if the DNN configuration allows for the MPTCP functionality with any steering mode and ATSSS-LL functionality with any steering mode, the SMF shall ensure that the modified PDU session has the capability of MPTCP with any steering mode and ATSSS-LL with any steering mode in the downlink and the uplink;\nf)\tthe ATSSS-ST bits set to \"MPTCP functionality with any steering mode, MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode allowed for ATSSS-LL supported\" and if the DNN configuration allows for the MPTCP functionality with any steering mode, the MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality), the SMF shall ensure that the modified PDU session has the capability of MPTCP with any steering mode, the MPQUIC with any steering mode and ATSSS-LL with any steering mode in the downlink and the uplink; or\ng)\tthe ATSSS-ST bits set to \"MPTCP functionality with any steering mode, MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode supported\" and\ni)\tif the DNN configuration allows for the MPTCP functionality with any steering mode, the MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode (i.e., any steering mode allowed for ATSSS-LL functionality), the SMF shall ensure that the modified PDU session has the capability of MPTCP with any steering mode, MPQUIC with any steering mode and ATSSS-LL with any steering mode in the downlink and MPTCP with any steering mode, MPQUIC with steering mode and ATSSS-LL with only active-standby steering mode in the uplink; or\nii)\tif the DNN configuration allows for the MPTCP functionality with any steering mode, the MPQUIC functionality with any steering mode and ATSSS-LL functionality with only active-standby steering mode, the SMF shall ensure that the modified PDU session has the capability of MPTCP with any steering mode, MPQUIC with any steering mode and ATSSS-LL with only active-standby steering mode in the downlink and the uplink.\n\nFigure\u00a06.4.2.2.1: UE-requested PDU session modification procedure\n6.4.2.3\tUE-requested PDU session modification procedure accepted by the network\nUpon receipt of a PDU SESSION MODIFICATION REQUEST message, if the SMF accepts the request to modify the PDU session, the SMF shall perform the network-requested PDU session modification procedure as specified in subclause\u00a06.3.2.\nIf the PDU SESSION MODIFICATION REQUEST message contains a Port management information container IE, the SMF shall handle the contents of the Port management information container IE as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8] and 3GPP\u00a0TS\u00a023.502\u00a0[9].\n6.4.2.4\tUE-requested PDU session modification procedure not accepted by the network\n6.4.2.4.1\tGeneral\nUpon receipt of a PDU SESSION MODIFICATION REQUEST message, if the SMF does not accepts the request to modify the PDU session, the SMF shall create a PDU SESSION MODIFICATION REJECT message.\nThe SMF shall set the 5GSM cause IE of the PDU SESSION MODIFICATION REJECT message to indicate the reason for rejecting the PDU session modification.\nThe 5GSM cause IE typically indicates one of the following SM cause values:\n#26\tinsufficient resources;\n#29\tuser authentication or authorization failed;\n#31\trequest rejected, unspecified;\n#32\tservice option not supported;\n#33\trequested service option not subscribed;\n#35\tPTI already in use;\n#37\t5GS QoS not accepted;\n#43\tInvalid PDU session identity;\n#44\tSemantic errors in packet filter(s);\n#45\tSyntactical error in packet filter(s);\n#46\tout of LADN service area;\n#59\tunsupported 5QI value;\n#67\tinsufficient resources for specific slice and DNN;\n#69\tinsufficient resources for specific slice;\n#83\tSemantic error in the QoS operation;\n#84\tSyntactical error in the QoS operation; or\n#95 \u2013 111\tprotocol errors.\nIf the UE requests a PDU session modification for an LADN when the UE is located outside of the LADN service area, the SMF shall include the 5GSM cause value #46 \"out of LADN service area\" in the 5GSM cause IE of the PDU SESSION MODIFICATION REJECT message.\nIf the Extended protocol configuration options IE of the PDU SESSION MODIFICATION REQUEST message indicates 3GPP PS data off UE status and the SMF detects the change of the 3GPP PS data off UE status, the SMF shall not include the 5GSM cause value #26 \"insufficient resources\", the 5GSM cause value #67 \"insufficient resources for specific slice and DNN\", the 5GSM cause value #69 \"insufficient resources for specific slice\" and the 5GSM cause value #46 \"out of LADN service area\" in the 5GSM cause IE of the PDU SESSION MODIFICATION REJECT message.\nIf the UE initiates UE-requested PDU session modification procedure to modify the PDU session transferred from EPS to an MA PDU session with the Request type IE set to \"MA PDU request\" in the UL NAS TRANSPORT message as specified in 3GPP\u00a0TS\u00a024.193\u00a0[13B] and the SMF determines, based on operator policy and subscription information, that the PDU SESSION MODIFICATION REQUEST message is to be rejected, the SMF shall include the 5GSM cause value #33 \"requested service option not subscribed\" in the 5GSM cause IE of the PDU SESSION MODIFICATION REJECT message.\nNOTE:\tIf the SMF determines, based on operator policy and subscription information, that the PDU SESSION MODIFICATION REQUEST message is to be accepted as single access PDU session, the ATSSS container IE cannot be included in the PDU SESSION MODIFICATION COMMAND message.\nThe network may include a Back-off timer value IE in the PDU SESSION MODIFICATION REJECT message.\nIf the 5GSM cause value is #26\"insufficient resources\", #67 \"insufficient resources for specific slice and DNN\", or #69 \"insufficient resources for specific slice\" and the PDU SESSION MODIFICATION REQUEST message was received from a UE configured for high priority access in selected PLMN or SNPN or the request type provided during the PDU session establishment is set to \"initial emergency request\" or \"existing emergency PDU session\", the network shall not include a Back-off timer value IE.\nThe SMF shall send the PDU SESSION MODIFICATION REJECT message.\nUpon receipt of a PDU SESSION MODIFICATION REJECT message and a PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5, the UE shall stop timer T3581, release the allocated PTI value, and enter the state PROCEDURE TRANSACTION INACTIVE.\nIf the PDU SESSION MODIFICATION REQUEST message was sent with the Requested MBS container IE included and the MBS operation set to \"Join MBS session\", and the UE receives a PDU SESSION MODIFICATION REJECT message, then the UE shall consider the requested MBS join as rejected.\nIf the PDU SESSION MODIFICATION REQUEST message was sent with the Requested MBS container IE included and the MBS operation set to \"Leave MBS session\", and the UE receives a PDU SESSION MODIFICATION REJECT message, then the UE shall locally leave the multicast MBS session(s) corresponding to the TMGI(s) in the Requested MBS container IE of the PDU SESSION MODIFICATION REQUEST message.\n6.4.2.4.2\tHandling of network rejection due to congestion control\nIf:\n-\tthe 5GSM cause value #26 \"insufficient resources\" and the Back-off timer value IE are included in the PDU SESSION MODIFICATION REJECT message; or\n-\tan indication that the 5GSM message was not forwarded due to DNN based congestion control is received along a Back-off timer value and a PDU SESSION MODIFICATION REQUEST message with the PDU session ID IE set to the PDU session ID of the PDU session;\nthe UE shall ignore the Re-attempt indicator IE or the 5GSM congestion re-attempt indicator IE provided by the network, if any, and the UE shall take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE or depending on the Back-off timer value received from the 5GMM sublayer (if the UE is a UE configured for high priority access in selected PLMN or SNPN, exceptions are specified in subclause\u00a06.2.7):\na)\tIf the timer value indicates neither zero nor deactivated and a DNN was provided during the PDU session establishment, the UE shall stop timer T3396 associated with the corresponding DNN, if it is running. If the timer value indicates neither zero nor deactivated and no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3396 associated with no DNN if it is running. In an SNPN, the timer T3396 to be stopped includes:\n1)\tthe timer T3396 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\n2)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall then start timer T3396 with the value provided in the Back-off timer value IE or with the Back-off timer value received from the 5GMM sublayer and:\n1)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message, or PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same DNN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and\n2)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message without a DNN and with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session established without a DNN provided by the UE, if no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", until timer T3396 expires or timer T3396 is stopped.\n\tThe UE shall not stop timer T3396 upon a PLMN change, SNPN change, or inter-system change.\nb)\tif the timer value indicates that this timer is deactivated and a DNN was provided during the PDU session establishment, the UE shall stop timer T3396 associated with the corresponding DNN, if it is running. If the timer value indicates that this timer is deactivated and no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3396 associated with no DNN if it is running. In an SNPN, the timer T3396 to be stopped includes:\n1)\tthe timer T3396 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\n2)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\nThe UE:\n1)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST with exception of those identified in subclause\u00a06.4.2.1, for the same DNN until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives a PDU SESSION MODIFICATION COMMAND message for the same DNN from the network, or a PDU SESSION AUTHENTICATION COMMAND message for the same DNN from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for the same DNN from the network; and\n2)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message without a DNN and with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session established without a DNN provided by the UE, if no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives a PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU session established without a DNN provided by the UE, a PDU SESSION AUTHENTICATION COMMAND message for a non-emergency PDU session established without a DNN provided by the UE, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for a non-emergency PDU session established without a DNN provided by the UE.\n\tThe timer T3396 remains deactivated upon a PLMN change, SNPN change, or inter-system change.\nc)\tif the timer value indicates zero, the UE:\n1)\tshall stop timer T3396 associated with the corresponding DNN, if running. In an SNPN, the timer T3396 to be stopped includes:\ni)\tthe timer T3396 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nii)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same DNN; and\n2)\tif no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3396 associated with no DNN, if running. In an SNPN, the timer T3396 to be stopped includes:\ni)\tthe timer T3396 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nii)\tthe timer T3396 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message without a DNN, or another PDU SESSION MODIFICATION REQUEST message without a DNN provided by the UE.\nIn an SNPN, if the UE supports equivalent SNPNs then the UE shall apply the timer T3396 for all the equivalent SNPNs. Otherwise, the UE shall apply the timer T3396 for the registered SNPN.\nIf the Back-off timer value IE is not included or no Back-off timer value is received from the 5GMM sublayer, then the UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same DNN or without a DNN.\nIf the timer T3396 is running when the UE enters state 5GMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" for the SNPN to which timer T3396 is associated (if any) is not updated, then timer T3396 is kept running until it expires or it is stopped\nWhen the timer T3396 is running or the timer is deactivated, the UE is allowed to initiate a PDU session establishment procedure for emergency services.\nIf the UE is switched off when the timer T3396 is running, and if the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" for the SNPN to which timer T3396 is associated (if any) is not updated when the UE is switched on, the UE shall behave as follows:\n-\tlet t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\nIf the UE is a UE operating in single-registration mode in a network supporting N26 interface and the PDU SESSION MODIFICATION REQUEST message was sent for a PDN connection established when in S1 mode after an inter-system change from S1 mode to N1 mode and timer T3396 associated with the corresponding DNN (or no DNN) is running, then the UE shall re-initiate the UE-requested PDU session modification procedure after expiry of timer T3396.\nIf:\n-\tthe 5GSM cause value #67 \"insufficient resources for specific slice and DNN\" and the Back-off timer value IE are included in the PDU SESSION MODIFICATION REJECT message; or\n-\tan indication that the 5GSM message was not forwarded due to S-NSSAI and DNN based congestion control is received along a Back-off timer value and a PDU SESSION MODIFICATION REQUEST message with the PDU session ID IE set to the PDU session ID of the PDU session;\nthe UE shall ignore the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3584 in the Back-off timer value IE or depending on the Back-off timer value received from the 5GMM sublayer (if the UE is a UE configured for high priority access in selected PLMN or SNPN, exceptions are specified in subclause\u00a06.2.8):\na)\tIf the timer value indicates neither zero nor deactivated, and both an S-NSSAI and a DNN were provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [S-NSSAI of the PDU session, DNN] combination, if it is running. If the timer value indicates neither zero nor deactivated, an S-NSSAI and no DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3584 associated with [S-NSSAI of the PDU session, no DNN] combination, if it is running. If the timer value indicates neither zero nor deactivated, no S-NSSAI and a DNN was provided during the PDU session establishment, the UE shall stop timer T3584 associated with the [no S-NSSAI, DNN] combination, if it is running. If the timer value indicates neither zero nor deactivated and neither S-NSSAI nor DNN was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3584 associated with the [no S-NSSAI, no DNN] combination, if it is running. The timer T3584 to be stopped includes:\n1)\tin a PLMN:\ni)\tthe timer T3584 applied for all the PLMNs, if running; and\nii)\t the timer T3584 applied for the registered PLMN, if running; or\n2)\tin an SNPN:\ni)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nii)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall then start timer T3584 with the value provided in the Back-off timer value IE or with the Back-off timer value received from the 5GMM sublayer and:\n1)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message with the exception of those identified in subclause\u00a06.4.2.1, for the [S-NSSAI, DNN] combination, until timer T3584 expires or timer T3584 is stopped;\n2)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with the exception of those identified in subclause\u00a06.4.2.1, for the [S-NSSAI of the PDU session, no DNN] combination, if no DNN was provided during the PDU session establishment, until timer T3584 expires or timer T3584 is stopped;\n3)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message, or another PDU SESSION MODIFICATION REQUEST message with the exception of those identified in subclause\u00a06.4.2.1, for the [no S-NSSAI, DNN] combination, if no S-NSSAI was provided during the PDU session establishment, until timer T3584 expires or timer T3584 is stopped; and\n4)\tshall not send another PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with the exception of those identified in subclause\u00a06.4.2.1, for the [no S-NSSAI, no DNN] combination, if neither S-NSSAI nor DNN was provided during the PDU session establishment, until timer T3584 expires or timer T3584 is stopped.\n\tThe UE shall not stop timer T3584 upon a PLMN change, SNPN change, or inter-system change;\nb)\tif the timer value indicates that this timer is deactivated:\n1)\tif both S-NSSAI and DNN were provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [S-NSSAI of the PDU session, DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the [S-NSSAI of the PDU session, DNN] combination that was sent by the UE, until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives a PDU SESSION MODIFICATION COMMAND message for the [S-NSSAI of the PDU session, DNN] combination from the network, or a PDU SESSION AUTHENTICATION COMMAND message for the [S-NSSAI of the PDU session, DNN] combination from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for the [S-NSSAI of the PDU session, DNN] combination from the network;\n2)\tif an S-NSSAI was provided but a DNN was not provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [S-NSSAI of the PDU session, no DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall not send a PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or a PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the [S-NSSAI of the PDU session, no DNN] combination, if no DNN was provided during the PDU session establishment, until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives a PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU session established for the [S-NSSAI of the PDU session, no DNN] combination from the network, or a PDU SESSION AUTHENTICATION COMMAND message for a non-emergency PDU session established for the [S-NSSAI of the PDU session, no DNN] combination from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for a non-emergency PDU session established for the [S-NSSAI of the PDU session, no DNN] combination from the network;\n3)\tif an S-NSSAI was not provided but a DNN was provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [no S-NSSAI, DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall not send a PDU SESSION ESTABLISHMENT REQUEST message, or a PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the [no S-NSSAI, DNN] combination, if no S-NSSAI was provided during the PDU session establishment, until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives a PDU SESSION MODIFICATION COMMAND message for the [no S-NSSAI, DNN] combination from the network, or a PDU SESSION AUTHENTICATION COMMAND message for the [no S-NSSAI, DNN] combination from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for the [no S-NSSAI, DNN] combination from the network; and\n4)\tif neither S-NSSAI nor DNN were provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [no S-NSSAI, no DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall not send a PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or a PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the [no S-NSSAI, no DNN] combination, if neither S-NSSAI nor DNN was provided during the PDU session establishment, until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives a PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU session established for the [no S-NSSAI, no DNN] combination from the network, or a PDU SESSION AUTHENTICATION COMMAND message for a non-emergency PDU session established for the [no S-NSSAI, no DNN] combination from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for a non-emergency PDU session established for the [no S-NSSAI, no DNN] combination from the network.\n\tThe timer T3584 remains deactivated upon a PLMN change, SNPN change, or inter-system change; and\nc)\tif the timer value indicates zero:\n1)\tif both S-NSSAI and DNN were provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [S-NSSAI of the PDU session, DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the [S-NSSAI of the PDU session, DNN] combination;\n2)\tif an S-NSSAI was provided but a DNN was not provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [S-NSSAI of the PDU session, no DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running. \n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message, or PDU SESSION MODIFICATION REQUEST message for the [S-NSSAI of the PDU session, no DNN] combination if the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\";\n3)\tif an S-NSSAI was not provided but a DNN was provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [no S-NSSAI, DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message, or PDU SESSION MODIFICATION REQUEST message for the [no S-NSSAI, DNN] combination; and\n4)\tif neither S-NSSAI nor DNN were provided by the UE during the PDU session establishment, the UE shall stop timer T3584 associated with the [no S-NSSAI, no DNN] combination, if running. The timer T3584 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3584 applied for all the PLMNs, if running; and\nB)\tthe timer T3584 applied for the registered PLMN, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3584 applied for all the equivalent SNPNs, and associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nB)\tthe timer T3584 applied for the registered SNPN, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message, or PDU SESSION MODIFICATION REQUEST message for the [no S-NSSAI, no DNN] combination and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\".\nIf the 5GSM congestion re-attempt indicator IE with the ABO bit set to \"The back-off timer is applied in all PLMNs or all equivalent SNPNs\" is included in the PDU SESSION MODIFICATION REJECT message with the 5GSM cause value #67 \"insufficient resources for specific slice and DNN\", then the UE shall apply the timer T3584 for all the PLMNs or all the equivalent SNPNs. Otherwise, the UE shall apply the timer T3584 for the registered PLMN or the registered SNPN.\nIf the Back-off timer value IE is not included or no Back-off timer value is received from the 5GMM sublayer, then the UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same [S-NSSAI, DNN] combination, or for the same [S-NSSAI, no DNN] combination, or for the same [no S-NSSAI, DNN] combination, or for the same [no S-NSSAI, no DNN] combination.\nWhen the timer T3584 is running or the timer is deactivated, the UE is allowed to initiate a PDU session establishment procedure for emergency services.\nIf the timer T3584 is running when the UE enters state 5GMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" for the SNPN to which timer T3584 is associated (if any) is not updated, then timer T3584 is kept running until it expires or it is stopped.\nIf the UE is switched off when the timer T3584 is running, and if the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" for the SNPN to which timer T3584 is associated (if any) is not updated when the UE is switched on, the UE shall behave as follows:\n-\tlet t1 be the time remaining for T3584 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\nIf the UE is a UE operating in single-registration mode in a network supporting N26 interface and the PDU SESSION MODIFICATION REQUEST message was sent for a PDN connection established when in S1 mode after an inter-system change from S1 mode to N1 mode and timer T3584 associated with the corresponding [no S-NSSAI, DNN] combination or [no S-NSSAI, no DNN] combination is running, then the UE shall re-initiate the UE-requested PDU session modification procedure after expiry of timer T3584.\nIf:\n-\tthe 5GSM cause value #69 \"insufficient resources for specific slice\" and the Back-off timer value IE are included in the PDU SESSION MODIFICATION REJECT message; or\n-\tan indication that the 5GSM message was not forwarded due to S-NSSAI only based congestion control is received along a Back-off timer value and a PDU SESSION MODIFICATION REQUEST message with the PDU session ID IE set to the PDU session ID of the PDU session;\nthe UE shall ignore the bit \"RATC\" and the bit \"EPLMNC\" in the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3585 in the Back-off timer value IE or depending on the Back-off timer value received from the 5GMM sublayer (if the UE is a UE configured for high priority access in selected PLMN or SNPN, exceptions are specified in subclause\u00a06.2.8):\na)\tIf the timer value indicates neither zero nor deactivated and an S-NSSAI was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3585 associated with the S-NSSAI of the PDU session, if it is running. If the timer value indicates neither zero nor deactivated and no S-NSSAI was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3585 associated with no S-NSSAI if it is running. The timer T3585 to be stopped includes:\n1)\tin a PLMN:\ni)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION MODIFICATION REJECT is received, if running;\nii)\tthe timer T3585 applied for all the PLMNs and for both 3GPP access type and non-3GPP access type, if running;\niii)\tthe timer T3585 applied for the registered PLMN and for the access over which the PDU SESSION MODIFICATION REJECT is received, if running; and\niv)-\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\n2)\tin an SNPN:\ni)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nii)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\niii)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\niv)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE shall then start timer T3585 with the value provided in the Back-off timer value IE or with the Back-off timer value received from the 5GMM sublayer and:\n1)\tif an S-NSSAI was provided by the UE during the PDU session establishment, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session for the S-NSSAI of the PDU session, until timer T3585 expires or timer T3585 is stopped; and\n2)\tif the request type was different from \"initial emergency request\" and from \"existing emergency PDU session\", and an S-NSSAI was not provided by the UE during the PDU session establishment, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message without an S-NSSAI and with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session established without an S-NSSAI provided by the UE, until timer T3585 expires or timer T3585 is stopped.\n\tThe UE shall not stop timer T3585 upon a PLMN change, SNPN change, or inter-system change;\nb)\tif the timer value indicates that this timer is deactivated and an S-NSSAI was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3585 associated with the S-NSSAI of the PDU session, if it is running. If the timer value indicates that this timer is deactivated and no S-NSSAI was provided during the PDU session establishment and the request type was different from \"initial emergency request\" and different from \"existing emergency PDU session\", the UE shall stop timer T3585 associated with no S-NSSAI if it is running. The timer T3585 to be stopped includes:\n1)\tin a PLMN:\ni)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION MODIFICATION REJECT is received, if running;\nii)\tthe timer T3585 applied for all the PLMNs and for both 3GPP access type and non-3GPP access type, if running;\niii)\tthe timer T3585 applied for the registered PLMN and for the access over which the PDU SESSION MODIFICATION REJECT is received, if running; and\niv)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\n2)\tin an SNPN:\ni)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nii)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\niii)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\niv)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tIn addition:\n1)\tif an S-NSSAI was provided by the UE during the PDU session establishment, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session for the S-NSSAI of the PDU session until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives a PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU session for the S-NSSAI of the PDU session from the network, or a PDU SESSION AUTHENTICATION COMMAND message for a non-emergency PDU session for the S-NSSAI of the PDU session from the network, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for the S-NSSAI of the PDU session from the network; and\n2)\tif the request type was different from \"initial emergency request\" and from \"existing emergency PDU session\", and an S-NSSAI was not provided by the UE during the PDU session establishment, the UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message without an S-NSSAI and with request type different from \"initial emergency request\" and different from \"existing emergency PDU session\", or another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for a non-emergency PDU session established without an S-NSSAI provided by the UE, until the UE is switched off, the USIM is removed, the entry in the \"list of subscriber data\" for the current SNPN is updated, or the UE receives a PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU session established without an S-NSSAI provided by the UE, or a PDU SESSION AUTHENTICATION COMMAND message for a non-emergency PDU session established without an S-NSSAI provided by the UE, or a PDU SESSION RELEASE COMMAND message without the Back-off timer value IE for a non-emergency PDU session established without an S-NSSAI provided by the UE.\n\tThe timer T3585 remains deactivated upon a PLMN change, SNPN change, or inter-system change; and\nc)\tif the timer value indicates zero:\n1)\tif an S-NSSAI was provided by the UE during the PDU session establishment, the UE shall stop timer T3585 associated with the S-NSSAI of the PDU session, if running. The timer T3585 to be stopped includes:\ni)\tin a PLMN:\nA)\tincluding the timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running;\nB)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running;\nC)\tthe timer T3585 applied for the registered PLMN and for current access type or both 3GPP access type and non-3GPP access type, if running; and\nD)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nB)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nC)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nD)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the S-NSSAI of the PDU session; and\n2)\tif no S-NSSAI was provided during the PDU session establishment and the request type was different from \u201cinitial emergency request \u201c and different from \u201cexisting emergency PDU session\u201d, the UE shall stop timer T3585 associated with no S-NSSAI The timer T3585 to be stopped includes:\ni)\tin a PLMN:\nA)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running;\nB)\tthe timer T3585 applied for all the PLMNs and for the access over which the PDU SESSION RELEASE COMMAND is received, if running;\nC)\tthe timer T3585 applied for the registered PLMN and for current access type or both 3GPP access type and non-3GPP access type, if running; and\nD)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, if running; or\nii)\tin an SNPN:\nA)\tthe timer T3585 applied for all the equivalent SNPNs and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nB)\tthe timer T3585 applied for all the equivalent SNPNs and for both 3GPP access type and non-3GPP access type, associated with the RSNPN or an equivalent SNPN and with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running;\nC)\tthe timer T3585 applied for the registered SNPN and for the access over which the PDU SESSION AUTHENTICATION COMMAND message is received, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running; and\nD)\tthe timer T3585 applied for the registered PLMN and for both 3GPP access type and non-3GPP access type, associated with the RSNPN and, if the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, associated with the selected entry of the \"list of subscriber data\" or the selected PLMN subscription, if running.\n\tThe UE may send another PDU SESSION ESTABLISHMENT REQUEST message without an S-NSSAI, or another PDU SESSION MODIFICATION REQUEST message without an S-NSSAI provided by the UE.\nIf the 5GSM congestion re-attempt indicator IE with the ABO bit set to \"The back-off timer is applied in all PLMNs or all SNPNs \" is included in the PDU SESSION MODIFICATION REJECT message with the 5GSM cause value #69 \"insufficient resources for specific slice\", then the UE shall apply the timer T3585 for all the PLMNs or all the equivalent SNPNs. Otherwise, the UE shall apply the timer T3585 for the registered PLMN or the registered SNPN.\nIf the Back-off timer value IE is not included or no Back-off timer value is received from the 5GMM sublayer, then the UE may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the same S-NSSAI or without an S-NSSAI.\nWhen the timer T3585 is running or the timer is deactivated, the UE is allowed to initiate a PDU session establishment procedure for emergency services.\nIf the timer T3585 is running when the UE enters state 5GMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" for the SNPN to which timer T3585 is associated (if any) is not updated, then timer T3585 is kept running until it expires or it is stopped.\nIf the UE is switched off when the timer T3585 is running, and if the USIM in the UE (if any) remains the same and the entry in the \"list of subscriber data\" for the SNPN to which timer T3585 is associated (if any) is not updated when the UE is switched on, the UE shall behave as follows:\n-\tlet t1 be the time remaining for T3585 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 \u2013 t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.\nIf the UE is a UE operating in single-registration mode in a network supporting N26 interface and the PDU SESSION MODIFICATION REQUEST message was sent for a PDN connection established when in S1 mode after an inter-system change from S1 mode to N1 mode and timer T3585 associated with no S-NSSAI is running, then the UE shall re-initiate the UE-requested PDU session modification procedure after expiry of timer T3585.\nNOTE\u00a03:\tAs described in this subclause, upon PLMN change, SNPN change, or inter-system change, the UE does not stop the timer T3584 or T3585. This means the timer T3584 or T3585 can still be running or be deactivated for the given 5GSM procedure, the PLMN, the S-NSSAI and optionally the DNN combination when the UE returns to the PLMN or when it performs inter-system change back from S1 mode to N1 mode. Thus the UE can still be prevented from sending another PDU SESSION ESTABLISHMENT REQUEST or PDU SESSION MODIFICATION REQUEST message in the PLMN for the same S-NSSAI and optionally the same DNN.\nUpon PLMN change or SNPN change, if T3584 applied for the registered PLMN or the registered SNPN is running or is deactivated for an S-NSSAI, a DNN, and old PLMN or old SNPN, but T3584 is not running and is not deactivated for the S-NSSAI, the DNN, and new PLMN or new SNPN, then the UE is allowed to send a PDU SESSION ESTABLISHMENT REQUEST message for the same S-NSSAI and the same DNN in the new PLMN or new SNPN.\nUpon PLMN change or SNPN change, if T3585 applied for the registered PLMN or the registered SNPN is running or is deactivated for an S-NSSAI and old PLMN or old SNPN, but T3585 is not running and is not deactivated for the S-NSSAI and new PLMN or new SNPN, then the UE is allowed to send a PDU SESSION ESTABLISHMENT REQUEST message for the same S-NSSAI in the new PLMN or new SNPN.\nUpon SNPN change, if T3585 applied for all the equivalent SNPNs is running or is deactivated for an S-NSSAI and old SNPN, but T3585 is not running and is not deactivated for the S-NSSAI and new non-equivalent SNPN, then the UE is allowed to send a PDU SESSION ESTABLISHMENT REQUEST message for the same S-NSSAI in the new SNPN.\n6.4.2.4.3\tHandling of network rejection not due to congestion control\nIf the 5GSM cause value is different from #26 \"insufficient resources\", #37 \"5GS QoS not accepted\", #44 \"Semantic errors in packet filter(s)\", #45 \"Syntactical error in packet filter(s)\", #46 \"out of LADN service area\", #59 \"unsupported 5QI value\", #67 \"insufficient resources for specific slice and DNN\", #69 \"insufficient resources for specific slice\", #83 \"Semantic error in the QoS operation\", and #84 \"Syntactical error in the QoS operation\", and the Back-off timer value IE is included, the UE shall behave as follows: (if the UE is a UE configured for high priority access in selected PLMN or SNPN, exceptions are specified in subclause\u00a06.2.12):\na)\tif the timer value indicates neither zero nor deactivated and:\n1)\tif the UE provided DNN and S-NSSAI to the network during the PDU session establishment, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDU session modification procedure and:\ni)\tin a PLMN, [PLMN, DNN, (mapped) HPLMN S-NSSAI of the PDU session] combination. The UE shall not send another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same DNN and the (mapped) HPLMN S-NSSAI of the PDU session in the current PLMN, until the back-off timer expires, the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed SNPN S-NSSAI] combination. The UE shall not send another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same DNN and (mapped) subscribed SNPN S-NSSAI of the PDU session in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the back-off timer expires, the UE is switched off, the USIM is removed, or the selected entry of the \"list of subscriber data\" is updated;\n2)\tif the UE did not provide a DNN or S-NSSAI or any of the two parameters to the network during the PDU session establishment, it shall start the back-off timer accordingly for the PDU session modification procedure and:\ni)\tin a PLMN, [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI of the PDU session] or [PLMN, no DNN, no S-NSSAI] combination. Dependent on the combination, the UE shall not send another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI of the PDU session] or [PLMN, no DNN, no S-NSSAI] combination in the current PLMN, until the back-off timer expires, the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI of the PDU session] or [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] combination. Dependent on the combination, the UE shall not send another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for the same [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI of the PDU session] or [SNPN, selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] combination in the current SNPN, until the back-off timer expires, the UE is switched off, the USIM is removed, or the selected entry in the \"list of subscriber data\" is updated;\nb)\tif the timer value indicates that this timer is deactivated and:\n1)\tif the UE provided DNN and S-NSSAI to the network during the PDU session establishment, the UE shall not send another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for:\ni)\tin a PLMN, the same DNN and the (mapped) HPLMN S-NSSAI of the PDU session in the current PLMN, until the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, the same DNN and the (mapped) subscribed SNPN S-NSSAI of the PDU session in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the UE is switched off, or the USIM is removed, or the selected entry in the \"list of subscriber data\";\n2)\tif the UE did not provide a DNN or S-NSSAI or any of the two parameters to the network during the PDU session establishment, the UE shall not send another PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, for:\ni)\tin a PLMN; the same [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI of the PDU session] or [PLMN, no DNN, no S-NSSAI] combination in the current PLMN, until the UE is switched off, or the USIM is removed; or\nii)\tin an SNPN, the same [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI of the PDU session] or [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] combination in the current SNPN using the selected entry of the \"list of subscriber data\" or selected PLMN subscription, until the UE is switched off, the USIM is removed, or the selected entry in the \"list of subscriber data\" is updated; and\nc)\tif the timer value indicates zero, the UE may send another PDU SESSION MODIFICATION REQUEST message for:\n1)\tin a PLMN, the same combination of [PLMN, DNN, (mapped) HPLMN S-NSSAI of the PDU session], [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI of the PDU session], or [PLMN, no DNN, no S-NSSAI] in the current PLMN; or\n2)\tin an SNPN, the same combination of [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed SNPN S-NSSAI of the PDU session], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI of the PDU session], or [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] in the current SNPN.\nIf the Back-off timer value IE is not included, then the UE shall ignore the Re-attempt indicator IE provided by the network in the PDU SESSION MODIFICATION REJECT message, if any.\na)\tAdditionally, if the 5GSM cause value is #32 \"service option not supported\", or #33 \"requested service option not subscribed\", then:\n1)\tthe UE not operating in SNPN access operation mode shall proceed as follows:\ni)\tif the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list, the UE shall behave as described above in the present subclause using the configured SM Retry Timer value as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] or in USIM file NASCONFIG as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], if available, as back-off timer value; and\nNOTE\u00a01:\tThe way to choose one of the configured SM Retry Timer values for back-off timer value is up to UE implementation if the UE is configured with:\n-\tan SM Retry Timer value in the ME as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17]; and\n-\tan SM Retry Timer value in USIM file NASCONFIG as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22].\nii)\totherwise, if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, or if the SM Retry Timer value is not configured, the UE shall behave as described above in the present subclause, using the default value of 12 minutes for the back-off timer; or\n2)\tthe UE operating in SNPN access operation mode shall proceed as follows:\ni)\tif:\nA)\tthe SM Retry Timer value for the current SNPN as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] is available; or\nB)\tthe SM Retry Timer value in USIM file NASCONFIG as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22] is available and the UE used the USIM for registration to the current SNPN;\n\tthen the UE shall behave as described above in the present subclause using the configured SM Retry Timer value as back-off timer value; or\nNOTE\u00a02:\tThe way to choose one of the configured SM Retry Timer values for back-off timer value is up to UE implementation if both conditions in bullets A) and B) above are satisfied.\nii)\totherwise, the UE shall behave as described above in the present subclause, using the default value of 12 minutes for the back-off timer.\nb)\tFor 5GSM cause values different from #32 \"service option not supported\", or #33 \"requested service option not subscribed\", the UE behaviour regarding the start of a back-off timer is unspecified.\nThe UE shall not stop any back-off timer:\na)\tupon a PLMN or SNPN change;\nb)\tupon an inter-system change; or\nc)\tupon registration over another access type.\nIf the network indicates that a back-off timer for the PDU session modification procedure is deactivated, then it remains deactivated:\na)\tupon a PLMN or SNPN change;\nb)\tupon an inter-system change; or\nc)\tupon registration over another access type.\nNOTE\u00a03:\tThis means the back-off timer can still be running or be deactivated for the given 5GSM procedure when the UE returns to the PLMN or SNPN or when it performs inter-system change back from S1 mode to N1 mode. Thus the UE can still be prevented from sending another PDU SESSION MODIFICATION REQUEST message for the combination of [PLMN, DNN, (mapped) HPLMN S-NSSAI of the PDU session], [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI of the PDU session], or [PLMN, no DNN, no S-NSSAI] in the PLMN, or for the combination of [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed S-NSSAI], or [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] in the SNPN.\nIf the back-off timer is started upon receipt of a PDU SESSION MODIFICATION REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, the UE behaves as follows:\na)\tafter a PLMN or SNPN change the UE may send a PDU SESSION MODIFICATION REQUEST message for:\n1)\tin a PLMN, the combination of [new PLMN, DNN, (mapped) HPLMN S-NSSAI of the PDU session], [new PLMN, DNN, no S-NSSAI], [new PLMN, no DNN, (mapped) HPLMN S-NSSAI of the PDU session], or [new PLMN, no DNN, no S-NSSAI] in the new PLMN, if the back-off timer is not running and is not deactivated for the PDU session modification procedure and the combination of [new PLMN, DNN, (mapped) HPLMN S-NSSAI of the PDU session], [new PLMN, DNN, no S-NSSAI], [new PLMN, no DNN, (mapped) HPLMN S-NSSAI of the PDU session], or [new PLMN, no DNN, no S-NSSAI]; or\n2)\tin an SNPN, the combination of [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed SNPN S-NSSAI of the PDU session], [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI of the PDU session], or [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] in the new SNPN, if the back-off timer is not running and is not deactivated for the PDU session modification procedure and the combination of [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed SNPN S-NSSAI of the PDU session], [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI of the PDU session], or [new SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI];\n\tFurthermore, as an implementation option, for the 5GSM cause value #32 \"service option not supported\" or #33 \"requested service option not subscribed\", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another PDU SESSION MODIFICATION REQUEST message:\n1)\tin a PLMN, the same combination of [PLMN, DNN, (mapped) HPLMN S-NSSAI of the PDU session], [PLMN, DNN, no S-NSSAI], [PLMN, no DNN, (mapped) HPLMN S-NSSAI of the PDU session], or [PLMN, no DNN, no S-NSSAI], if the UE is registered to a new PLMN which is in the list of equivalent PLMNs; or\n2)\tin an SNPN, if the UE supports equivalent SNPNs, the same combination of [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed SNPN S-NSSAI of the PDU session], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI of the PDU session], or [SNPN, the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI], if the UE is registered to a new SNPN which is in the list of equivalent SNPNs.\nb)\tif the network does not include the Re-attempt indicator IE to indicate whether re-attempt in S1 mode is allowed, or the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, then:\n1)\tif the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list and the back-off timer is running for the combination of [PLMN, DNN, (mapped) HPLMN S-NSSAI of the PDU session] or [PLMN DNN, no S-NSSAI], the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] or in USIM file NASCONFIG as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], if available, to determine whether the UE may attempt an EPS bearer resource allocation procedure or an EPS bearer resource modification procedure for the same [PLMN, DNN] combination in S1 mode; and\nNOTE\u00a04:\tThe way to choose one of the configured SM_RetryAtRATChange values for back-off timer value is up to UE implementation if the UE is configured with:\n-\tan SM_RetryAtRATChange value in ME as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17]; and\n-\tan SM_RetryAtRATChange value in USIM file NASCONFIG as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22].\n2)\tif the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, or if the NAS configuration MO as specified in 3GPP\u00a0TS\u00a024.368\u00a0[17] is not available and the value for inter-system change is not configured in the USIM file NASCONFIG, then the UE behaviour regarding an EPS bearer resource allocation procedure or an EPS bearer resource modification procedure for the same [PLMN, DNN] combination in S1 mode is unspecified; and\nc)\tif the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN or equivalent SNPN is not allowed, then depending on the timer value received in the Back-off timer value IE, for:\n1)\tin a PLMN, each combination of a PLMN from the equivalent PLMN list and the respective [DNN, (mapped) HPLMN S-NSSAI of the PDU session], [DNN, no S-NSSAI], [no DNN, (mapped) HPLMN S-NSSAI of the PDU session], or [no DNN, no S-NSSAI] combination, the UE shall start a back-off timer for the PDU session modification procedure with the value provided by the network, or deactivate the respective back-off timer as follows:\ni)\tif the Re-attempt indicator IE additionally indicates that re-attempt in S1 mode is allowed, the UE shall start or deactivate the back-off timer for N1 mode only; and\nii)\totherwise, the UE shall start or deactivate the back-off timer for S1 and N1 mode\n2)\tin a SNPN, if the UE supports equivalent SNPNs, each combination of a SNPN from the equivalent SNPN list and the respective [the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, (mapped) subscribed SNPN S-NSSAI of the PDU session], [the selected entry of the \"list of subscriber data\" or selected PLMN subscription, DNN, no S-NSSAI], [the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, (mapped) subscribed SNPN S-NSSAI of the PDU session], or [the selected entry of the \"list of subscriber data\" or selected PLMN subscription, no DNN, no S-NSSAI] combination, the UE shall start a back-off timer for the PDU session modification procedure with the value provided by the network, or deactivate the respective back-off timer, for N1 mode in an SNPN.\nIf the back-off timer for a [PLMN, DNN] or [PLMN, no DNN] combination was started or deactivated in S1 mode upon receipt of BEARER RESOURCE ALLOCATION REJECT message or BEARER RESOURCE MODIFICATION REJECT message (see 3GPP\u00a0TS\u00a024.301\u00a0[15]) and the network indicated that re-attempt in N1 mode is allowed, then this back-off timer does not prevent the UE from sending a PDU SESSION MODIFICATION REQUEST message in this PLMN for the same DNN after inter-system change to N1 mode. If the network indicated that re-attempt in N1 mode is not allowed, the UE shall not send any PDU SESSION MODIFICATION REQUEST message with exception of those identified in subclause\u00a06.4.2.1, in this PLMN for the same DNN in combination with any S-NSSAI or without S-NSSAI, after inter-system change to N1 mode until the timer expires, the UE is switched off or the USIM is removed.\nNOTE\u00a05:\tThe back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.\nNOTE\u00a06:\tReference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation.\nIf the 5GSM cause value is #46 \"out of LADN service area\", the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any. If the UE is not located inside the LADN service area, the UE shall not send another PDU SESSION MODIFICATION REQUEST message except for indicating a change of 3GPP PS data off UE status or another PDU SESSION ESTABLISHMENT REQUEST message for the LADN DNN provided by the UE during the PDU session establishment procedure until the LADN information for the specific LADN DNN or the extended LADN information for the specific LADN DNN and S-NSSAI is updated as described in subclause\u00a05.4.4 and subclause\u00a05.5.1. If the UE is not located inside the LADN service area, the UE shall not indicate the PDU session(s) for the LADN DNN provided by the UE during the PDU session establishment procedure in the Uplink data status IE included in the SERVICE REQUEST message until the LADN information for the specific LADN DNN or the extended LADN information for the specific LADN DNN and S-NSSAI is provided by network as described in subclause\u00a05.4.4 and subclause\u00a05.5.1.\nNOTE\u00a07:\tBased on UE implementation, the UE locating inside the LADN service area can send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for the LADN DNN which was rejected with the 5GSM cause value #46 \"out of LADN service area\".\nNOTE\u00a07A:\tIf the UE does not receive a CONFIGURATION UPDATE COMMAND message with new LADN information within an implementation dependent time, the UE can request this information by initiating a registration procedure for mobility or periodic registration update (see subclause\u00a05.5.1.3.2, item\u00a0q).\nIf the 5GSM cause value is #37 \"5GS QoS not accepted\", #44 \"Semantic errors in packet filter(s)\", #45 \"Syntactical error in packet filter(s)\", #59 \"unsupported 5QI value\", #83 \"Semantic error in the QoS operation\" or #84 \"Syntactical error in the QoS operation\", the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any. The UE should pass the corresponding error cause to the upper layers.\nNOTE\u00a08:\tHow to solve the issues of not accepted 5GS QoS and unsupported 5QI value in the upper layers is UE implementation specific.\n6.4.2.5\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3581.\n\tThe UE shall, on the first expiry of the timer T3581, retransmit the PDU SESSION MODIFICATION REQUEST message and the PDU session information which was transported together with the initial transmission of the PDU SESSION MODIFICATION REQUEST message and shall reset and start timer T3581. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3581, the UE shall abort the procedure and shall release the allocated PTI.\nb)\tInvalid PDU session identity.\n\tUpon receipt of the PDU SESSION MODIFICATION REJECT message including 5GSM cause #43 \"invalid PDU session identity\", the UE shall perform a local release of the existing PDU session and shall stop the timer T3581.\nc)\tCollision of network-requested PDU session release procedure and UE-requested PDU session modification procedure.\n\tIf the UE receives a PDU SESSION RELEASE COMMAND message during the UE-requested PDU session modification procedure, and the PDU session indicated in the PDU SESSION RELEASE COMMAND message is the PDU session that the UE had requested to modify, the UE shall abort the PDU session modification procedure and proceed with the network-requested PDU session release procedure.\nd)\tHandling DL user data packets marked with RQI when UE has already revoked the usage of reflective QoS\n\tIf the UE receives a DL user data packet marked with a RQI and the DL user data packet belongs to a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type for which the UE has already revoked the usage of reflective QoS, then the UE shall ignore the RQI and shall handle the received DL user data packet.\ne)\tCollision of network-requested PDU session modification procedure and UE-requested PDU session modification procedure.\n\tThe handling of the same abnormal case as described in subclause\u00a06.3.2.6 applies.\nf)\tUpon receiving an indication that the 5GSM message was not forwarded due to service area restrictions along with a PDU SESSION MODIFICATION REQUEST message with the PDU session ID IE set to the same value as the PDU session ID that was sent by the UE, the UE shall abort the procedure and shall stop the timer T3581.\ng)\tUpon receiving an indication that the 5GSM message was not forwarded due to routing failure along with a PDU SESSION MODIFICATION REQUEST message with the PDU session ID IE set to the same value as the PDU session ID that was sent by the UE, the UE shall stop timer T3581 and shall abort the procedure.\nga)\tUpon receiving an indication that the 5GSM message was not forwarded because the UE accessing via a satellite NG-RAN cell is informed that the PLMN is not allowed to operate at the present UE location along with a PDU SESSION MODIFICATION REQUEST message with the PDU session ID IE set to the same value as the PDU session ID that was sent by the UE, the UE shall stop timer T3581 and shall abort the procedure.\ngb)\tUpon receiving an indication that the 5GSM message was not forwarded due to unexpected cause along with a PDU SESSION MODIFICATION REQUEST message with the PDU session ID IE set to the same value as the PDU session ID that was sent by the UE, the UE shall stop timer T3581 and shall abort the procedure.\nh)\tCollision of UE-requested PDU session modification procedure and N1 NAS signalling connection release\n\tThe UE may immediately retransmit the PDU SESSION MODIFICATION REQUEST message and stop, reset and restart timer T3581, if the following conditions apply:\n1)\tThe original UE-requested PDU session modification procedure was initiated over an existing N1 NAS signalling connection; and\n2)\tthe previous transmission of the PDU SESSION MODIFICATION REQUEST message was not initiated due to timer T3581 expiry.\ni)\tRejection of a UE-requested PDU session modification procedure when the UE has initiated the procedure to delete one or more non-default QoS rules for the PDU session:\n\tUpon receipt of a PDU SESSION MODIFICATION REJECT message with 5GSM cause value #31 \"request rejected, unspecified\", if the UE had initiated deletion of one or more non-default QoS rules for the PDU session, as an implementation option, \n1)\tit may perform a local release of the PDU session and shall stop the timer T3581. In order to synchronize the PDU session context with the AMF, the UE shall perform the registration procedure for mobility and periodic registration update with a REGISTRATION REQUEST message including the PDU session status IE; or\n2)\tit shall stop the timer T3581 and initiate the UE-requested PDU session release procedure.\nNOTE:\tThe UE can delay the release of the PDU session until there is no pending data transferred through the other QoS flows of the PDU session.\n6.4.2.6\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tIf the PDU session is an emergency PDU session and the 5GSM cause IE is not included in the PDU SESSION MODIFICATION REQUEST message which is not triggered according to subclause\u00a06.4.2.1, item e), or is set to a 5GSM cause other than the 5GSM causes #41, #42, #44, #45, #83, #84, and #85, the SMF shall reject the PDU SESSION MODIFICATION REQUEST message with 5GSM cause #31 \"request rejected, unspecified\".\nb)\tPDU session inactive for the received PDU session identity.\n\tIf the PDU session ID in the PDU SESSION MODIFICATION REQUEST message belongs to any PDU session in state PDU SESSION INACTIVE in the SMF, the SMF shall set the 5GSM cause IE to #43 \"Invalid PDU session identity\" in the PDU SESSION MODIFICATION REJECT message.\nc)\tCollision of network-requested PDU session modification procedure and UE-requested PDU session modification procedure.\n\tThe handling of the same abnormal case as described in subclause\u00a06.3.2.5 applies.\nd)\tAMF provides a \"message was exempted from the DNN based congestion activated in the AMF\" but the UE-requested PDU session modification procedure is not exempt from DNN based congestion control.\n\tIf the SMF receives an exemptionInd attribute indicating \"message was exempted from the DNN based congestion activated in the AMF\" as specified in 3GPP\u00a0TS\u00a029.502\u00a0[20A], and the Extended protocol configuration options IE of the PDU SESSION MODIFICATION REQUEST message does not indicate 3GPP PS data off UE status, then the SMF shall set the 5GSM cause #26 \"insufficient resources\" in the PDU SESSION MODIFICATION REJECT message.\ne)\tAMF provides a \"message was exempted from the S-NSSAI and DNN based congestion activated in the AMF\" but the UE-requested PDU session modification procedure is not exempt from S-NSSAI only based congestion control.\n\tIf the SMF receives an exemptionInd attribute indicating \"message was exempted from the S-NSSAI and DNN based congestion activated in the AMF\" as specified in 3GPP\u00a0TS\u00a029.502\u00a0[20A], and the Extended protocol configuration options IE of the PDU SESSION MODIFICATION REQUEST message does not indicate 3GPP PS data off UE status, then the SMF shall set the 5GSM cause #67 \"insufficient resources for specific slice and DNN\" in the PDU SESSION MODIFICATION REJECT message.\nf)\tAMF provides a \"message was exempted from the S-NSSAI only based congestion activated in the AMF\" but the UE-requested PDU session modification procedure is not exempt from S-NSSAI only based congestion control.\n\tIf the SMF receives an exemptionInd attribute indicating \"message was exempted from the S-NSSAI only based congestion activated in the AMF\" as specified in 3GPP\u00a0TS\u00a029.502\u00a0[20A], and the Extended protocol configuration options IE of the PDU SESSION MODIFICATION REQUEST message does not indicate 3GPP PS data off UE status, then the SMF shall set the 5GSM cause #69 \"insufficient resources for specific slice\" in the PDU SESSION MODIFICATION REJECT message.\ng)\t5G access network cannot forward the message.\n\tIf the SMF determines based on content of the n2SmInfo attribute specified in 3GPP\u00a0TS\u00a029.502\u00a0[20A] that the DL NAS TRANSPORT message carrying the PDU SESSION MODIFICATION COMMAND message was not forwarded to the UE by the 5G access network due to a cause other than handover procedure in progress, then the SMF shall reject the UE-requested PDU session modification procedure with an appropriate 5GSM cause value in the PDU SESSION MODIFICATION REJECT message.\nNOTE:\tThe use of an appropriate 5GSM cause value is implementation specific.\n6.4.3\tUE-requested PDU session release procedure\n6.4.3.1\tGeneral\nThe purpose of the UE-requested PDU session release procedure is to enable by the UE to request a release of a PDU session.\nThe UE is allowed to initiate the PDU session release procedure even if the timer T3396 is running.\nThe UE is allowed to initiate the PDU session release procedure even if the timer T3584 is running.\nThe UE is allowed to initiate the PDU session release procedure even if the timer T3585 is running.\nThe UE is allowed to initiate the PDU session release procedure even if the UE is outside the LADN service area.\n6.4.3.2\tUE-requested PDU session release procedure initiation\nIn order to initiate the UE-requested PDU session release procedure, the UE shall create a PDU SESSION RELEASE REQUEST message.\nThe UE may set the 5GSM cause IE of the PDU SESSION RELEASE REQUEST message to indicate the reason for releasing the PDU session.\nThe 5GSM cause IE typically indicates one of the following 5GSM cause values:\n#26\tinsufficient resources;\n#36\tregular deactivation;\n#44\tSemantic errors in packet filter(s);\n#45\tSyntactical error in packet filter(s);\n#83\tSemantic error in the QoS operation;\n#84\tSyntactical error in the QoS operation;\n#96\tInvalid mandatory information.\nThe UE shall allocate a PTI value currently not used and shall set the PTI IE of the PDU SESSION RELEASE REQUEST message to the allocated PTI value.\nThe UE shall transport the PDU SESSION RELEASE REQUEST message and the PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5, and the UE shall start timer T3582 (see example in figure\u00a06.4.3.2.1).\nIf the UE is releasing the PDU session due to:\na)\terrors in QoS operations or packet filters; or\nb)\tthe number of the authorized QoS rules, the number of the packet filters, or the number of the authorized QoS flow descriptions associated with the PDU session have reached the maximum number supported by the UE,\nthe UE shall include the 5GSM cause IE in the PDU SESSION RELEASE REQUEST message as described in subclauses\u00a06.3.2.4 and 6.4.1.3.\n\nFigure\u00a06.4.3.2.1: UE-requested PDU session release procedure\n6.4.3.3\tUE-requested PDU session release procedure accepted by the network\nUpon receipt of a PDU SESSION RELEASE REQUEST message and a PDU session ID, if the SMF accepts the request to release the PDU session, and shall perform the network-requested PDU session release procedure as specified in subclause\u00a06.3.3.\n6.4.3.4\tUE-requested PDU session release procedure not accepted by the network\nUpon receipt of a PDU SESSION RELEASE REQUEST message, if the SMF does not accept the request to release the PDU session, the SMF shall create a PDU SESSION RELEASE REJECT message.\nThe SMF shall set the 5GSM cause IE of the PDU SESSION RELEASE REJECT message to indicate the reason for rejecting the PDU session release.\nThe 5GSM cause IE typically indicates one of the following SM cause values:\n#35\tPTI already in use; or\n#43\tInvalid PDU session identity; or\n#95 \u2013 111:\tprotocol errors.\nThe SMF shall send the PDU SESSION RELEASE REJECT message.\nUpon receipt of a PDU SESSION RELEASE REJECT message and a PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5, the UE shall stop timer T3582, release the allocated PTI value and locally release the PDU session. If there is one or more multicast MBS sessions associated with the PDU session, the UE shall locally leave the associated multicast MBS sessions.\n6.4.3.5\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3582.\n\tThe UE shall, on the first expiry of the timer T3582, retransmit the PDU SESSION RELEASE REQUEST message and the PDU session information which was transported together with the initial transmission of the PDU SESSION RELEASE REQUEST message and shall reset and start timer T3582. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3582, the UE shall abort the procedure, release the allocated PTI, perform a local release of the PDU session, and perform the registration procedure for mobility and periodic registration update by sending a REGISTRATION REQUEST message including the PDU session status IE over each access that user plane resources have been established if the PDU session is an MA PDU session, or over the access the PDU session is associated with if the PDU session is a single access PDU session. If there is one or more multicast MBS sessions associated with the PDU session, the UE shall locally leave the associated multicast MBS sessions.\nb)\tCollision of UE-requested PDU session release procedure and network-requested PDU session modification procedure.\n\tWhen the UE receives a PDU SESSION MODIFICATION COMMAND message during the UE-requested PDU session release procedure, and the PDU session indicated in PDU SESSION MODIFICATION COMMAND message is the PDU session that the UE had requested to release, the UE shall ignore the PDU SESSION MODIFICATION COMMAND message and proceed with the PDU session release procedure.\nc)\tCollision of UE-requested PDU session release procedure and network-requested PDU session release procedure.\n\tWhen the UE receives a PDU SESSION RELEASE COMMAND message with the PTI IE set to \"No procedure transaction identity assigned\" during the UE-requested PDU session release procedure, the PDU session indicated in the PDU SESSION RELEASE COMMAND message is the same as the PDU session that the UE requests to release:\n-\tif the Access type IE is included in the PDU SESSION RELEASE COMMAND message and the PDU session is an MA PDU session and having user-plane resources established on the access different from the access indicated in the Access type IE in the PDU SESSION RELEASE COMMAND message, the UE shall proceed both the UE-requested PDU session release procedure and network-requested PDU session release procedure; or\n-\totherwise, the UE shall abort the UE-requested PDU session release procedure and shall stop the timer T3582 and proceed with the network-requested PDU session release procedure.\nNOTE\u00a01:\tWhether the UE ignores the 5GSM cause #39\u00a0\"reactivation requested\" if received in the PDU SESSION RELEASE COMMAND is up to the UE implementation.\nd)\tReceipt of an indication that the 5GSM message was not forwarded due to routing failure\n\tUpon receiving an indication that the 5GSM message was not forwarded due to routing failure along with a PDU SESSION RELEASE REQUEST message with the PDU session ID IE set to the same value as the PDU session ID that was sent by the UE, the UE shall stop timer T3582, abort the procedure, release the allocated PTI, perform a local release of the PDU session, and perform the registration procedure for mobility and periodic registration update by sending a REGISTRATION REQUEST message including the PDU session status IE over each access that user plane resources have been established if the PDU session is an MA PDU session, or over the access the PDU session is associated with if the PDU session is a single access PDU session. If there is one or more multicast MBS sessions associated with the released PDU session, the UE shall locally leave the associated multicast MBS sessions.\ne)\tPDU session release signalling restricted due to service area restriction\n\tThe UE may delay the release of the PDU session until the UE is not restricted by service area restrictions, or it may release the allocated PTI, perform a local release of the PDU session, and include the PDU session status IE over each access that user plane resources have been established if the PDU session is an MA PDU session, or over the access the PDU session is associated with if the PDU session is a single access PDU when performing the next registration procedure. If the UE performs the local release of the PDU session and there is one or more multicast MBS sessions associated with the released PDU session, the UE shall locally leave the associated multicast MBS sessions.\nf)\tCollision of UE-requested PDU session release procedure and N1 NAS signalling connection release\n\tThe UE may immediately retransmit the PDU SESSION RELEASE REQUEST message and stop, reset and restart timer T3582, if the following conditions apply:\n1)\tThe original UE-requested PDU session release procedure was initiated over an existing N1 NAS signalling connection; and\n2)\tthe previous transmission of the PDU SESSION RELEASE REQUEST message was not initiated due to timer T3582 expiry.\ng)\tReceipt of an indication that the 5GSM message was not forwarded due to the PLMN is not allowed to operate at the present UE location\n\tUpon receiving an indication that the 5GSM message was not forwarded because the UE accessing via a satellite NG-RAN cell is informed that the PLMN is not allowed to operate at the present UE location along with a PDU SESSION RELEASE REQUEST message with the PDU session ID IE set to the same value as the PDU session ID that was sent by the UE, the UE shall stop timer T3582, abort the procedure and locally release the PDU session.\nga)\tUpon receiving an indication that the 5GSM message was not forwarded due to unexpected cause along with a PDU SESSION RELEASE REQUEST message with the PDU session ID IE set to the same value as the PDU session ID that was sent by the UE, the UE shall stop timer T3582, abort the procedure and locally release the PDU session.\n6.4.3.6\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tPDU session inactive for the received PDU session identity.\n\tIf the PDU session ID in the PDU SESSION RELEASE REQUEST message belongs to any PDU session in state PDU SESSION INACTIVE in the SMF, the SMF shall send the PDU SESSION RELEASE REJECT message to the UE with the 5GSM cause #43 \"Invalid PDU session identity\".\n6.5\t5GSM status procedure\n6.5.1\tGeneral\nThe purpose of the sending of the 5GSM STATUS message is to report at any time certain error conditions detected upon receipt of 5GSM protocol data. The 5GSM STATUS message can be sent by both the network and the UE (see example in figure\u00a06.5.1.1).\n\nFigure\u00a06.5.1.1: 5GSM status procedure\n6.5.2\t5GSM status received in the UE\nIf the 5GSM entity of the UE receives a 5GSM STATUS message the UE shall take different actions depending on the received 5GSM cause value:\n#47\tPTI mismatch.\n\tThe UE shall abort any ongoing 5GSM procedure related to the received PTI value and stop any related timer.\n#81\tinvalid PTI value.\n\tThe UE shall abort any ongoing 5GSM procedure related to the received PTI value and stop any related timer.\n#97\tMessage type non-existent or not implemented.\n\tThe UE shall abort any ongoing 5GSM procedure related to the PTI or PDU session ID and stop any related timer.\nOn receipt of a 5GSM STATUS message with any other 5GSM cause value no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible.\n6.5.3\t5GSM status received in the SMF\nIf the SMF receives a 5GSM STATUS message the SMF shall take different actions depending on the received 5GSM cause value:\n#43\tinvalid PDU session identity.\n\tThe SMF shall abort any ongoing 5GSM procedure related to the PTI or PDU session ID, stop any related timer and locally release the PDU session indicated in the 5GSM STATUS message.\n#47\tPTI mismatch.\n\tThe SMF shall abort any ongoing 5GSM procedure related to the received PTI value and stop any related timer.\n\tIf the PTI indicated in the 5GSM STATUS message is related to a PDU SESSION ESTABLISHMENT ACCEPT message, the SMF shall perform a local release of the PDU session indicated in the PDU SESSION ESTABLISHMENT ACCEPT message.\n#81\tinvalid PTI value.\n\tThe SMF shall abort any ongoing 5GSM procedure related to the received PTI value and stop any related timer.\n#96\tinvalid mandatory information.\n\tThe SMF shall abort any ongoing 5GSM procedure related to the PTI or PDU session ID and stop any related timer.\n#97\tmessage type non-existent or not implemented.\n\tThe SMF shall abort any ongoing 5GSM procedure related to the PTI or PDU session ID and stop any related timer.\nThe local actions to be taken by the SMF on receipt of a 5GSM STATUS message with any other 5GSM cause value are implementation dependent.\n6.6\tMiscellaneous procedures\n6.6.1\tExchange of extended protocol configuration options\nThe UE and the SMF can exchange protocol configuration options via 5GSM procedures.\nThe protocol configuration options shall be exchanged via the Extended protocol configuration options IE.\n6.6.2\tRemote UE report procedure\n6.6.2.1\tGeneral\nThe purpose of the 5G ProSe remote UE report procedure is for a UE acting as a 5G ProSe layer-3 UE-to-network UE relay to notify the network that a 5G ProSe remote UE is connected to the 5G ProSe layer-3 UE-to-network relay UE or disconnected from the 5G ProSe layer-3 UE-to-network relay UE as specified in 3GPP\u00a0TS\u00a023.304\u00a0[6E].\nThe UE does not initiate the remote UE report procedure if the timer T3396 is running.\nThe UE does not initiate the remote UE report procedure if the timer T3584 is running.\nThe UE does not initiate the remote UE report procedure if the timer T3585 is running.\n6.6.2.2\tRemote UE report procedure initiation\nIn order to initiate the 5G ProSe remote UE report procedure, the UE shall create a REMOTE UE REPORT message.\nThe UE shall include information of newly connected or disconnected 5G ProSe remote UEs to the network in the REMOTE UE REPORT message by setting the values of the Remote UE context connected IE or the Remote UE context disconnected IE to the 5G ProSe remote UE identities that are being connected or disconnected, respectively.\nThe UE shall set the Remote UE ID with:\na)\tthe UP-PRUK ID of the 5G ProSe remote UE, if the security for 5G ProSe communication via 5G ProSe UE-to-network relay is performed over user plane as specified in 3GPP\u00a0TS\u00a033.503\u00a0[56];\nb)\tthe CP-PRUK ID of the 5G ProSe remote UE, if the security for 5G ProSe communication via 5G ProSe UE-to-network relay is performed over control plane as specified in 3GPP\u00a0TS\u00a033.503\u00a0[56]; or\nc)\tthe PEI of the 5G ProSe remote UE, if the RSC is specific for emergency services as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E], and the 5G ProSe remote UE is identified by a PEI.\nIf the UE sets the Remote UE ID with the PRUK ID of the 5G ProSe remote UE and the UP-PRUK ID is in 64-bit string format, the UE shall include the HPLMN ID of the 5G ProSe remote UE.\nIf the UE allocated an IPv4 address to a 5G ProSe remote UE and enabled UDP usage to the 5G ProSe remote UE, the UE shall include in the REMOTE UE REPORT message the UDP port range assigned to the 5G ProSe remote UE in the NAT function of 5G ProSe layer-3 UE-to-network relay. If the UE allocated an IPv4 address to a 5G ProSe remote UE and enabled TCP usage to the 5G ProSe remote UE, the UE shall include in the REMOTE UE REPORT message the TCP port range assigned to the 5G ProSe remote UE in the NAT function of 5G ProSe layer-3 UE-to-network relay.\nThe UE shall set the PDU session ID IE to the value of the PDU session associated with the 5G ProSe remote UE connected to the 5G ProSe layer-3 UE-to-network relay UE or disconnected from the 5G ProSe layer-3 UE-to-network relay UE.\nThe UE shall allocate a PTI value currently not used and shall set the PTI IE of the REMOTE UE REPORT message to the allocated PTI value.\nThe UE shall transport the REMOTE UE REPORT message and the PDU session ID, using the NAS transport procedure as specified in subclause\u00a05.4.5, and the UE shall start timer T3586 (see example in figure\u00a06.6.2.2.1).\n\n\nFigure\u00a06.6.2.2.1: Remote UE report procedure\n6.6.2.3\tRemote UE report procedure accepted by the network\nUpon receipt of the REMOTE UE REPORT message, the SMF shall send a REMOTE UE REPORT RESPONSE message to the UE. The SMF shall include the PTI from the REMOTE UE REPORT message.\nThe SMF shall set the EAP message IE to an EAP-success message or an EAP-failure message to be sent to the 5G ProSe layer-3 remote UE if the EAP-success message or the EAP-failure message is received from the DN.\nUpon receipt of the REMOTE UE REPORT RESPONSE message, the UE shall stop timer T3586 and enter the state PROCEDURE TRANSACTION INACTIVE.\n6.6.2.4\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tExpiry of timer T3586:\n\tOn the first expiry of the timer T3586, the UE shall resend the REMOTE UE REPORT message and shall reset and restart timer T3586. This retransmission is repeated two times, i.e. on the third expiry of timer T3586, the UE shall abort the procedure and release any resources for this procedure.\nNOTE:\tAfter the abortion of the remote UE report procedure, the remote UE report procedure for the remote UE(s) can be restarted and how to restart the procedure is left to UE implementation.\nb)\tCollision of network-requested PDU session release procedure and remote UE report procedure:\n\tIf the UE receives a PDU SESSION RELEASE COMMAND message during the remote UE report procedure, and the PDU session indicated in the PDU SESSION RELEASE COMMAND message is the PDU session ID that the UE had indicated in the REMOTE UE REPORT message, the UE shall abort the remote UE report procedure and proceed with the network-requested PDU session release procedure.\nc)\tCollision of remote UE report procedure and N1 NAS signalling connection release:\n\tThe UE may immediately retransmit the REMOTE UE REPORT message and stop, reset and restart timer T3586, if following conditions apply:\n1)\tthe original REMOTE UE REPORT was initiated over an existing N1 NAS signalling connection; and\n2)\tthe previous transmission of the REMOTE UE REPORT message was not initiated due to timer T3586 expiry.\n6.6.2.5\tAbnormal cases on the network side\nThe following abnormal cases have been identified:\na)\tCollision of network-requested PDU session release procedure and remote UE report procedure:\n\tIf the SMF receives a REMOTE UE REPORT message during a network-requested PDU session release procedure, and the PDU session indicated in the PDU SESSION RELEASE COMMAND message is the PDU session ID that is in the REMOTE UE REPORT message, the SMF shall abort the remote UE report procedure and proceed with the network-requested PDU session release procedure.\nb)\tPDU session inactive for the received PDU session identity:\n\tIf the PDU session ID in the REMOTE UE REPORT message belongs to any PDU session in state PDU SESSION INACTIVE in the SMF, the SMF shall send the 5GSM STATUS message to the UE with the 5GSM cause #43 \"Invalid PDU session identity\".\n7\tHandling of unknown, unforeseen, and erroneous protocol data\n7.1\tGeneral\nThe procedures specified in the present document apply to those messages which pass the checks described in this subclause.\nThis subclause also specifies procedures for the handling of unknown, unforeseen, and erroneous protocol data by the receiving entity. These procedures are called \"error handling procedures\", but in addition to providing recovery mechanisms for error situations they define a compatibility mechanism for future extensions of the protocols.\nSubclauses\u00a07.1 to 7.8 shall be applied in order of precedence.\nDetailed error handling procedures in the network are implementation dependent and may vary from PLMN to PLMN. However, when extensions of this protocol are developed, networks are assumed to have the error handling which is indicated in this subclause as mandatory (\"shall\") and that is indicated as strongly recommended (\"should\").\nAlso, the error handling of the network is only considered as mandatory or strongly recommended when certain thresholds for errors are not reached during a dedicated connection.\nFor definition of semantical and syntactical errors see 3GPP\u00a0TS\u00a024.007\u00a0[11], subclause\u00a011.4.2.\n7.2\tMessage too short or too long\n7.2.1\tMessage too short\nWhen a message is received that is too short to contain a complete message type information element, that message shall be ignored, cf. 3GPP\u00a0TS\u00a024.007\u00a0[11].\n7.2.2\tMessage too long\nThe maximum size of a NAS message for NR connected to 5GCN is specified in 3GPP\u00a0TS\u00a038.323\u00a0[29].\nThe maximum size of a NAS message for E-UTRA connected to 5GCN is specified 3GPP\u00a0TS\u00a036.323\u00a0[25].\nThe maximum size of a NAS message for non-3GPP access connected to 5GCN is specified in 3GPP\u00a0TS\u00a024.502\u00a0[18]\n7.3\tUnknown or unforeseen procedure transaction identity or PDU Session identity\n7.3.1\tProcedure transaction identity\nThe following network procedures shall apply for handling an unknown, erroneous, or unforeseen PTI received in a 5GSM message:\na)\tIn case the network receives a PDU SESSION MODIFICATION COMPLETE, a PDU SESSION RELEASE COMPLETE message or a PDU SESSION MODIFICATION COMMAND REJECT message in which the PTI value is an assigned or unassigned value that does not match any PTI in use, the network shall respond with a 5GSM STATUS message including 5GSM cause #47 \"PTI mismatch\".\nb)\tIn case the network receives a PDU SESSION AUTHENTICATION COMPLETE message or a SERVICE-LEVEL AUTHENTICATION COMPLETE message in which the PTI value is an assigned value, the network shall respond with a 5GSM STATUS message including 5GSM cause #81 \"invalid PTI value\".\nc)\tIn case the network receives a PDU SESSION ESTABLISHMENT REQUEST message, a PDU SESSION MODIFICATION REQUEST message or a PDU SESSION RELEASE REQUEST message in which the PTI value is an unassigned value, the network shall respond with a 5GSM STATUS message including 5GSM cause #81 \"invalid PTI value\".\nd)\tIn case the network receives a 5GSM message in which the PTI value is a reserved value, the network shall ignore the message.\nThe following UE procedures shall apply for handling an unknown, erroneous, or unforeseen PTI received in a 5GSM message:\na)\tIn case the UE receives a PDU SESSION MODIFICATION COMMAND message or a PDU SESSION MODIFICATION REJECT message in which the PTI value is an assigned value that does not match any PTI in use:\n1)\tif the UE detects that this PDU SESSION MODIFICATION COMMAND message is a network retransmission of an already accepted request (see subclause\u00a06.3.2.3), the UE shall respond with a PDU SESSION MODIFICATION COMPLETE message;\n2)\tif the UE detects that this PDU SESSION MODIFICATION COMMAND message is a network retransmission of an already rejected request (see subclause\u00a06.3.2.4), the UE shall respond with a PDU SESSION MODIFICATION COMAND REJECT message; or\n3)\totherwise, the UE shall respond with a 5GSM STATUS message including 5GSM cause #47 \"PTI mismatch\".\nb)\tIn case the UE receives a PDU SESSION RELEASE COMMAND message or a PDU SESSION RELEASE REJECT message in which the PTI value is an assigned value that does not match any PTI in use:\n1)\tif the UE detects that this PDU SESSION RELEASE COMMAND message is a network retransmission of an already accepted request (see subclause\u00a06.3.3.3), the UE shall respond with a PDU SESSION RELEASE COMPLETE message; or\n2)\totherwise, the UE shall respond with a 5GSM STATUS message including 5GSM cause #47 \"PTI mismatch\".\nc)\tIn case the UE receives a PDU SESSION ESTABLISHMENT ACCEPT message or a PDU SESSION ESTABLISHMENT REJECT message in which the PTI value is an assigned value that does not match any PTI in use:\n1)\tthe UE shall respond with a 5GSM STATUS message including 5GSM cause #47 \"PTI mismatch\".\nd)\tIn case the UE receives a PDU SESSION AUTHENTICATION COMMAND message, a PDU SESSION AUTHENTICATION RESULT message or a SERVICE-LEVEL AUTHENTICATION COMMAND message in which the PTI value is an assigned value, the UE shall respond with a 5GSM STATUS message including 5GSM cause #81 \"invalid PTI value\".\ne)\tIn case the UE receives a PDU SESSION ESTABLISHMENT ACCEPT message, a PDU SESSION ESTABLISHMENT REJECT message, a PDU SESSION MODIFICATION REJECT message or a PDU SESSION RELEASE REJECT message in which the PTI value is an unassigned value, the UE shall ignore the message.\nf)\tIn case the UE receives a 5GSM message in which the PTI value is a reserved value, the UE shall ignore the message.\n7.3.2\tPDU Session identity\nThe following network procedures shall apply for handling an unknown, erroneous, or unforeseen PDU session identity received in the header of a 5GSM message (specified as the header of a standard L3 message, see 3GPP\u00a0TS\u00a024.007\u00a0[11]):\na)\tIf the network receives a PDU SESSION MODIFICATION REQUEST message which includes an unassigned or reserved PDU session identity value, the network shall respond with a PDU SESSION MODIFICATION REJECT message including 5GSM cause #43 \"invalid PDU session identity\".\nb)\tIf the network receives PDU SESSION RELEASE REQUEST message which includes an unassigned or reserved PDU session identity value, the network shall respond with a PDU SESSION RELEASE REJECT message including 5GSM cause #43 \"invalid PDU session identity\".\nc)\tUpon receipt of an UL NAS TRANSPORT message, the network takes the following actions:\n1)\tIf the Request type IE is set to \"initial request\" or \"initial emergency request\" and the message includes a reserved PDU session identity value, the network shall respond with a DL NAS TRANSPORT message with 5GMM cause #90 \"payload was not forwarded\";\n2)\totherwise, if the message includes an unassigned or reserved PDU session identity value, the network shall respond with a DL NAS TRANSPORT message with 5GMM cause #90 \"payload was not forwarded\".\nd)\tIf the network receives a 5GSM message other than those listed in items\u00a0a) through c) above in which the message includes a reserved PDU session identity value or an assigned value that does not match an existing PDU session, the network shall ignore the message.\nThe following UE procedures shall apply for handling an unknown, erroneous, or unforeseen PDU session identity received in the header of a 5GSM message:\na)\tIf the UE receives a 5GSM message which includes an unassigned or reserved PDU session identity value, the UE shall ignore the message.\nb)\tIf the UE receives a 5GSM message which includes a PDU session identity belonging to any PDU session in state PDU SESSION INACTIVE in the UE, the UE shall respond with a 5GSM STATUS message including 5GSM cause #43 \"invalid PDU session identity\".\n7.4\tUnknown or unforeseen message type\nIf UE receives a 5GMM message or 5GSM message with message type not defined for the extended protocol discriminator (EPD) or not implemented by the receiver, it shall return a status message (5GMM STATUS or 5GSM STATUS depending on the EPD) with cause #97 \"message type non-existent or not implemented\".\nIf the network receives a 5GMM or 5GSM message with message type not defined for the EPD or not implemented by the receiver in a protocol state where reception of an unsolicited message with the given EPD from the UE is not foreseen in the protocol, the network actions are implementation dependent. Otherwise, if the network receives a message with message type not defined for the EPD or not implemented by the receiver, it shall ignore the message except that it should return a status message (5GMM STATUS or 5GSM STATUS depending on the EPD) with cause #97 \"message type non-existent or not implemented\".\nNOTE:\tA message type not defined for the EPD in the given direction is regarded by the receiver as a message type not defined for the EPD, see 3GPP\u00a0TS\u00a024.007\u00a0[11].\nIf the UE receives a message not compatible with the protocol state, the UE shall return a status message (5GMM STATUS or 5GSM STATUS depending on the EPD) with cause #98 \"message type not compatible with protocol state\".\nIf the network receives a message not compatible with the protocol state, the network actions are implementation dependent.\n7.5\tNon-semantical mandatory information element errors\n7.5.1\tCommon procedures\nWhen on receipt of a message,\na)\tan \"imperative message part\" error; or\nb)\ta \"missing mandatory IE\" error\nis diagnosed or when a message containing:\na)\ta syntactically incorrect mandatory IE;\nb)\tan IE with an IEI unknown in the message, but encoded as \"comprehension required\" (see 3GPP\u00a0TS\u00a024.007\u00a0[11]); or\nc)\tan out of sequence IE encoded as \"comprehension required\" (see 3GPP\u00a0TS\u00a024.007\u00a0[11]) is received,\nthe UE shall proceed as follows:\n\tIf the message is not one of the messages listed in the UE procedures in subclause\u00a07.5.3, item a), b) or c), the UE shall return a status message (5GMM STATUS or 5GSM STATUS depending on the EPD) with cause #96 \"invalid mandatory information\";\nthe network shall proceed as follows:\n\tIf the message is not one of the messages listed in the network procedures in subclause\u00a07.5.3, item a), b) or c), the network shall either:\n1)\ttry to treat the message (the exact further actions are implementation dependent); or\n2)\tignore the message except that it should return a status message (5GMM STATUS or 5GSM STATUS depending on the EPD) with cause #96 \"invalid mandatory information\".\n7.5.2\t5GS mobility management\nNo exceptional cases are described for 5GS mobility management messages.\nNo semantical or syntactical diagnosis other than presence and length shall be performed on the EPS NAS message container information element in the REGISTRATION REQUEST message.\n7.5.3\t5GS session management\nThe following UE procedures shall apply for handling an error encountered with a mandatory information element in a 5GSM message:\na)\tIf the message is a PDU SESSION ESTABLISHMENT ACCEPT, the UE shall initiate PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #96 \"invalid mandatory information\".\nb)\tVoid.\nc)\tIf the message is a PDU SESSION RELEASE COMMAND, a PDU SESSION RELEASE COMPLETE message with 5GSM cause #96 \"invalid mandatory information\" shall be returned.\nThe following network procedures shall apply for handling an error encountered with a mandatory information element in a 5GSM message:\na)\tIf the message is a PDU SESSION ESTABLISHMENT REQUEST, a PDU SESSION ESTABLISHMENT REJECT message with 5GSM cause #96 \"invalid mandatory information\" shall be returned.\nb)\tIf the message is a PDU SESSION MODIFICATION REQUEST, a PDU SESSION MODIFICATION REJECT message with 5GSM cause #96 \"invalid mandatory information\" shall be returned.\nc)\tIf the message is a PDU SESSION RELEASE REQUEST, a PDU SESSION RELEASE REJECT message with 5GSM cause #96 \"invalid mandatory information\" shall be returned.\n7.6\tUnknown and unforeseen IEs in the non-imperative message part\n7.6.1\tIEIs unknown in the message\nThe UE shall ignore all IEs with an IEI unknown in a message which are not encoded as \"comprehension required\" (see 3GPP\u00a0TS\u00a024.007\u00a0[11]).\nThe network shall take the same approach.\n7.6.2\tOut of sequence IEs\nThe UE shall ignore all out of sequence IEs in a message which are not encoded as \"comprehension required\" (see 3GPP\u00a0TS\u00a024.007\u00a0[11]).\nThe network should take the same approach.\n7.6.3\tRepeated IEs\nIf an information element with format T, TV, TLV, or TLV-E is repeated in a message in which repetition of the information element is not specified in clause\u00a08 and clause\u00a09 of the present document, the UE shall handle only the contents of the information element appearing first and shall ignore all subsequent repetitions of the information element. When repetition of information elements is specified, the UE shall handle only the contents of specified repeated information elements. If the limit on repetition of information elements is exceeded, the UE shall handle the contents of information elements appearing first up to the limit of repetitions and shall ignore all subsequent repetitions of the information element.\nThe network should follow the same procedures.\n7.6.4\tUnknown and unforeseen IEs in a Type 6 IE container information element\n7.6.4.1\tIEIs unknown in the Type 6 IE container information element\nThe UE shall ignore all IEs with an IEI unknown in a Type 6 IE container information element which are not encoded as \"comprehension required\" (see 3GPP\u00a0TS\u00a024.007\u00a0[11]).\nThe network shall take the same approach.\nNOTE:\tThe set of IEIs defined for a Type 6 IE container information element is independent of the set of IEIs defined for other parts of the message. Therefore, an IE can be unknown in a Type 6 IE container information element, even if an IE with the same IEI is known in other parts of the message, and vice versa.\n7.6.4.2\tOut of sequence IEs\nThe UE shall ignore all out of sequence IEs in a Type 6 IE container information element which are not encoded as \"comprehension required\" (see 3GPP\u00a0TS\u00a024.007\u00a0[11]).\nThe network should take the same approach.\n7.6.4.3\tRepeated IEs\nIf an information element with format TLV-E is repeated in a Type 6 IE container information element in which repetition of the information element is not specified in clause\u00a08 and clause\u00a09 of the present document, the UE shall handle only the contents of the information element appearing first and shall ignore all subsequent repetitions of the information element. When repetition of information elements in the Type 6 IE container information element is specified, the UE shall handle only the contents of specified repeated information elements. If the limit on repetition of information elements is exceeded, the UE shall handle the contents of information elements appearing first up to the limit of repetitions and shall ignore all subsequent repetitions of the information element.\nThe network should follow the same procedures.\n7.7\tNon-imperative message part errors\nThis category includes:\na)\tsyntactically incorrect optional IEs; and\nb)\tconditional IE errors.\n7.7.1\tSyntactically incorrect optional IEs\nThe UE shall treat all optional IEs that are syntactically incorrect in a message as not present in the message.\nThe network shall take the same approach.\n7.7.2\tConditional IE errors\nWhen upon receipt of a 5GMM or 5GSM message the UE diagnoses a \"missing conditional IE\" error or an \"unexpected conditional IE\" error, or when it receives a 5GMM or 5GSM message containing at least one syntactically incorrect conditional IE, the UE shall ignore the message and shall return a status message (5GMM STATUS or 5GSM STATUS depending on the EPD) with cause #100 \"conditional IE error\".\nWhen the network receives a message and diagnoses a \"missing conditional IE\" error or an \"unexpected conditional IE\" error or when it receives a message containing at least one syntactically incorrect conditional IE, the network shall either:\na)\ttry to treat the message (the exact further actions are implementation dependent); or\nb)\tignore the message except that it should return a status message (5GMM STATUS or 5GSM STATUS depending on the EPD) with cause #100 \"conditional IE error\".\n7.7.3\tErrors in a Type 6 IE container information element\n7.7.3.1\tSyntactically incorrect optional IEs\nThe UE shall treat all optional IEs that are syntactically incorrect in a Type 6 IE container information element as not present in the Type 6 IE container information element.\nThe network shall take the same approach.\nEXAMPLE\u00a01:\tIf the Type 6 IE container information element includes 2 type 6 information elements, and the first one is syntactically incorrect, the receiver ignores the first information element and continues with the processing of the second one.\nEXAMPLE\u00a02:\tIf the remaining value part of a Type 6 IE container information element is too short to contain a complete type 6 information element, the receiver ignores these octets and continues with the processing of the octets following the Type 6 IE container information element, if there are any.\n7.7.3.2\tConditional IE errors\nWhen upon receipt of a 5GMM or 5GSM message the UE diagnoses a \"missing conditional IE\" error or an \"unexpected conditional IE\" error for the contents of a Type 6 IE container information element, or when it receives a 5GMM or 5GSM message with a Type 6 IE container information element containing at least one syntactically incorrect conditional IE, the UE shall ignore the message and shall return a status message (5GMM STATUS or 5GSM STATUS depending on the EPD) with cause #100 \"conditional IE error\".\nWhen the network receives a message and diagnoses a \"missing conditional IE\" error or an \"unexpected conditional IE\" error for the contents of a Type 6 IE container information element or when it receives a message with a Type 6 IE container information element containing at least one syntactically incorrect conditional IE, the network shall either:\na)\ttry to treat the message (the exact further actions are implementation dependent); or\nb)\tignore the message except that it should return a status message (5GMM STATUS or 5GSM STATUS depending on the EPD) with cause #100 \"conditional IE error\".\n7.8\tMessages with semantically incorrect contents\nWhen a message with semantically incorrect contents is received, the UE shall perform the foreseen reactions of the procedural part of the present document (i.e. of clauses\u00a05, 6). If, however no such reactions are specified, the UE shall ignore the message except that it shall return a status message (5GMM STATUS or 5GSM STATUS depending on the EPD) with cause #95 \"semantically incorrect message\".\nThe network should follow the same procedure except that a status message is not normally transmitted.\n8\tMessage functional definitions and contents\n8.1\tOverview\nThis clause defines the structure of the messages of the Layer\u00a03 (L3) protocols defined in the present document. These are standard L3 messages as defined in 3GPP\u00a0TS\u00a024.007\u00a0[12].\nEach definition given in the present clause includes:\na)\ta brief description of the message direction and use, including whether the message has:\n1.\tLocal significance, i.e. relevant only on the originating or terminating access;\n2.\tAccess significance, i.e. relevant in the originating and terminating access, but not in the network;\n3.\tDual significance, i.e. relevant in either the originating or terminating access and in the network; or\n4.\tGlobal significance, i.e. relevant in the originating and terminating access and in the network.\nb)\ta table listing the Information Elements (IE) known in the message and the order of their appearance in the message. All IEs that may be repeated are explicitly indicated (The V, LV and LV-E formatted IEs, which compose the imperative part of the message, occur before the T, TV, TLV and TLV-E formatted IEs which compose the non-imperative part of the message, see 3GPP\u00a0TS\u00a024.007\u00a0[12]). In a (maximal) sequence of consecutive IEs with half octet length, the first IE with half octet length occupies bits 1 to 4 of octet N, the second IE bits 5 to 8 of octet N, the third IE bits 1 to 4 of octet N+1 etc. Such a sequence always has an even number of elements. \n\tFor each information element the table indicates:\n1.\tThe Information Element Identifier (IEI), in hexadecimal notation, if the IE has format T, TV, TLV or TLV-E. If the IEI has half octet length, it is specified by a notation representing the IEI as a hexadecimal digit followed by a \"-\" (example: B-).\nNOTE\u00a01:\tThe same IEI can be used for different information element types in different messages of the same protocol.\nNOTE\u00a02:\tIf a message includes a Type 6 IE container information element, then the same IEI can be used for different information element types in the Type 6 IE container information element and in other parts of the same message.\n2.\tThe name of the information element (which may give an idea of the semantics of the element). The name of the information element followed by \"IE\" or \"information element\" is used in this technical report as reference to the information element within a message.\n3.\tThe name of the type of the information element (which indicates the coding of the value part of the IE), and generally, the referenced subclause of clause\u00a09 of the present document describing the value part of the information element.\n4.\tThe presence requirement indication (M, C, or O) for the IE as defined in 3GPP\u00a0TS\u00a024.007\u00a0[12].\n5.\tThe format of the information element (T, V, TV, LV, TLV, LV-E or TLV-E) as defined in 3GPP\u00a0TS\u00a024.007\u00a0[12].\n6.\tThe length of the information element (or permissible range of lengths), in octets, in the message, where \"?\" means that the maximum length of the IE is only constrained by link layer protocol. This indication is non-normative.\nc)\tsubclauses specifying, where appropriate, conditions for IEs with presence requirement C or O in the relevant message which together with other conditions specified in the present document define when the information elements shall be included or not, what non-presence of such IEs means, and \u2013 for IEs with presence requirement C \u2013 the static conditions for presence or non-presence of the IEs or for both cases (see 3GPP\u00a0TS\u00a024.007\u00a0[12]).\n8.2\t5GS mobility management messages\n8.2.1\tAuthentication request\n8.2.1.1\tMessage definition\nThe AUTHENTICATION REQUEST message is sent by the AMF to the UE to initiate authentication of the UE identity. See table\u00a08.2.1.1.1.\nMessage type:\tAUTHENTICATION REQUEST\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.1.1.1: AUTHENTICATION REQUEST message content\n\n8.2.1.2\tAuthentication parameter RAND\nAuthentication parameter RAND IE is included if the AUTHENTICATION REQUEST message is used in a 5G AKA authentication procedure.\n8.2.1.3\tAuthentication parameter AUTN\nAuthentication parameter AUTN IE is included if the AUTHENTICATION REQUEST message is used in a 5G AKA authentication procedure.\n8.2.1.4\tVoid\n8.2.1.5\tEAP message\nEAP message IE is included if the AUTHENTICATION REQUEST message is used in an EAP based primary authentication and key agreement procedure.\n8.2.2\tAuthentication response\n8.2.2.1\tMessage definition\nThe AUTHENTICATION RESPONSE message is sent by the UE to the AMF to deliver a calculated authentication response to the network. See table\u00a08.2.2.1.1.\nMessage type:\tAUTHENTICATION RESPONSE\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.2.1.1: AUTHENTICATION RESPONSE message content\n\n8.2.2.2\tAuthentication response parameter\nThis IE is included if the message is sent in a 5G AKA based primary authentication and key agreement procedure.\n8.2.2.3\tEAP message\nEAP message IE is included if the EAP message received in a related AUTHENTICATION REQUEST message was an EAP-request.\n8.2.3\tAuthentication result\n8.2.3.1\tMessage definition\nThe AUTHENTICATION RESULT message is sent by the AMF to the UE to provide result of EAP authentication of the UE identity. See table\u00a08.2.3.1.1.\nMessage type:\tAUTHENTICATION RESULT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.3.1.1: AUTHENTICATION RESULT message content\n\nNOTE:\tIt is possible for AMFs compliant with version 18.3.0 or 18.3.1 of this specification to send the AUN3 device security key IE with a fixed length of 66 octets.\n8.2.3.2\tABBA\nThis IE shall be included if the message contains an EAP message IE with an EAP-success message.\n8.2.3.3\tAUN3 device security key\nThis IE shall be included when the AUTHENTICATION RESULT message is provided to a 5G-RG that is acting on behalf of an AUN3 device if the EAP message IE is set to an EAP-success message.\n8.2.4\tAuthentication failure\n8.2.4.1\tMessage definition\nThe AUTHENTICATION FAILURE message is sent by the UE to the AMF to indicate that authentication of the network has failed. See table\u00a08.2.4.1.1.\nMessage type:\tAUTHENTICATION FAILURE\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.4.1.1: AUTHENTICATION FAILURE message content\n\n8.2.4.2\tAuthentication failure parameter\nThis IE shall be included in a 5G AKA based primary authentication and key agreement procedure if and only if the 5GMM cause was #21 \"synch failure\". It shall include the response to the authentication challenge from the USIM, which is made up of the AUTS parameter (see 3GPP\u00a0TS\u00a033.501\u00a0[24]).\n8.2.5\tAuthentication reject\n8.2.5.1\tMessage definition\nThe AUTHENTICATION REJECT message is sent by the AMF to the UE to indicate that the authentication procedure has failed and that the UE shall abort all activities. See table\u00a08.2.5.1.1.\nMessage type:\tAUTHENTICATION REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.5.1.1: AUTHENTICATION REJECT message content\n\n8.2.5.2\tEAP message\nEAP message IE is included if the AUTHENTICATION REJECT message is used to convey EAP-failure message.\n8.2.6\tRegistration request\n8.2.6.1\tMessage definition\nThe REGISTRATION REQUEST message is sent by the UE to the AMF. See table\u00a08.2.6.1.1.\nMessage type:\tREGISTRATION REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.6.1.1: REGISTRATION REQUEST message content\n\n8.2.6.2\tNon-current native NAS key set identifier\nThe UE shall include this IE if the UE has a valid non-current native 5G NAS security context when the UE performs an inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode and the UE uses a mapped 5G NAS security context to protect the REGISTRATION REQUEST message.\n8.2.6.3\t5GMM capability\nThe UE shall include this IE, unless the UE performs a periodic registration updating procedure.\n8.2.6.4\tUE security capability\nThe UE shall include this IE, unless the UE performs a periodic registration updating procedure.\n8.2.6.5\tRequested NSSAI\nThis IE shall be included by the UE when performing the registration procedure if the 5GS registration type IE indicates:\na)\t\"initial registration\", according to the conditions specified in subclause\u00a05.5.1.2.2; or\nb)\t\"mobility registration updating\", according to the conditions specified in subclause\u00a05.5.1.3.2.\n8.2.6.6\tLast visited registered TAI\nThis IE shall be included if the UE holds a valid last visited registered TAI.\n8.2.6.7\tS1 UE network capability\nA UE supporting S1 mode shall include this IE, unless the UE performs a periodic registration updating procedure.\n8.2.6.8\tUplink data status\nThis IE shall be included if the UE has uplink user data pending to be sent or the UE has active multicast MBS session(s), unless the UE performs a periodic registration updating procedure.\n8.2.6.9\tPDU session status\nThis IE shall be included when the UE needs to indicate the PDU sessions that are associated with the access type that the message is sent over, that are active within the UE.\n8.2.6.10\tMICO indication\nThe UE may include this IE to request the use of MICO mode.\n8.2.6.11\tUE status\nThis IE shall be included if the UE in single-registration mode performs the registration procedure due to inter-system change from S1 mode to N1 mode or if the UE in dual-registration mode and EMM state EMM-REGISTERED performs initial registration.\n8.2.6.12\tAdditional GUTI\nThis IE shall be included:\na)\t if the UE performs the registration procedure due to inter-system change from S1 mode to N1 mode, the UE operates in single-registration mode and the UE has a valid 5G-GUTI; or\nb)\tthe UE holds two valid native 5G-GUTIs and one of the valid native 5G-GUTI was assigned by the PLMN with which the UE is performing the registration.\n8.2.6.13\tAllowed PDU session status\nThis IE shall be included if the REGISTRATION REQUEST message is sent as a response to paging with the access type indicating non-3GPP access.\n8.2.6.14\tUE's usage setting\nThis IE shall be included if the UE supports IMS voice.\n8.2.6.15\tRequested DRX parameters\nIf the UE wants to use or change the UE specific DRX parameters, the UE shall include the Requested DRX parameters IE in the REGISTRATION REQUEST message.\n8.2.6.16\tEPS NAS message container\nThe UE operating in the single-registration mode shall include this information element as specified in subclause\u00a05.5.1.3.2 if the UE performs mobility from S1 mode to N1 mode in 5GMM-IDLE mode. The content of this message container is the complete integrity protected TRACKING AREA UPATE REQUEST message, using EPS security context.\nThe UE performing initial registration shall include this information element if\na)\tthe UE:\n1)\twas previously registered in S1 mode before entering state EMM-DEREGISTERED; and\n2)\thas received an \"interworking without N26 interface not supported\" indication from the network; and\nb)\tEPS security context and a valid 4G-GUTI are available.\nThe content of this message container is the complete integrity protected ATTACH REQUEST message, using EPS security context.\n8.2.6.17\tLADN indication\nThe UE shall include this information element when the UE needs to request LADN information for specific LADN DNN(s) or to indicate a request for LADN information.\n8.2.6.17A\tPayload container type\nThis IE shall be included if the UE includes the Payload container IE.\nNOTE:\tIn this version of the protocol, the Payload container type IE in the REGISTRATION REQUEST message is set to \"UE policy container\" as described in subclauses\u00a05.5.1.2.2 and 5.5.1.3.2.\n8.2.6.18\tPayload container\nWithin a PLMN, this IE shall be included if:\na)\tthe UE has one or more stored UE policy sections identified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN for the registration procedure for mobility and periodic registration update due to inter-system change from S1 mode to N1 mode of a UE operating in the single-registration mode or for the registration procedure for initial registration; or\nb)\tthe UE does not have any stored UE policy section identified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN for the registration procedure for mobility and periodic registration update due to inter-system change from S1 mode to N1 mode of a UE operating in the single-registration mode or for the registration procedure for initial registration and the UE needs to send a UE policy container to the network.\nWithin an SNPN, this IE shall be included if:\na)\tthe UE has one or more stored UE policy sections for the selected SNPN for the registration procedure for initial registration; or\nb)\tthe UE does not have any UE policy section for the selected SNPN for the registration procedure for initial registration and the UE needs to send a UE policy container to the network.\n8.2.6.19\tNetwork slicing indication\nThis IE shall be included when a requested NSSAI is included in the REGISTRATION REQUEST message and the requested NSSAI is created from the default configured NSSAI.\n8.2.6.20\t5GS update type\nThis IE shall be included when the UE is performing the registration procedure to indicate any of the following:\na)\tthe UE requests the use of SMS over NAS or there is a change in the UE's requirements to use SMS over NAS;\nb)\ta change in the UE's radio capability for NG-RAN; or\nc)\tthe UE requests CIoT 5GS optimizations.\n8.2.6.21\tNAS message container\nThis IE shall be included if the UE is sending a REGISTRATION REQUEST message as an initial NAS message, the UE has a valid 5G NAS security context and the UE needs to send non-cleartext IEs.\n8.2.6.22\tRequested extended DRX parameters\nThe UE shall include this IE if the UE needs to use extended DRX or change the extended DRX parameters.\n8.2.6.23\tEPS bearer context status\nThe UE shall include this IE if the UE operating in the single-registration mode performs inter-system change from S1 mode to N1 mode and the UE has locally deactivated EPS bearer context(s) for which interworking to 5GS is supported while the UE was in S1 mode without notifying the network.\n8.2.6.24\tT3324 value\nThe UE may include this IE during the registration update procedure if it requests to use MICO mode and use the active time timer.\n8.2.6.25\tMobile station classmark 2\nThis IE shall be included if the UE supports 5G-SRVCC from NG-RAN to UTRAN (see 3GPP\u00a0TS\u00a023.216\u00a0[6A]).\n8.2.6.26\tSupported codecs\nThis IE shall be included if the UE supports 5G-SRVCC from NG-RAN to UTRAN.\n8.2.6.27\tUE radio capability ID\nThis IE shall be included if the UE is not in NB-N1 mode, the UE supports RACS and the UE needs to signal a UE radio capability ID to the network.\n8.2.6.28\tRequested mapped NSSAI\nThis IE shall be included by the UE when the UE has a PDN connection or a PDU session to transfer to visited PLMN associated only with an S-NSSAI that is applicable in the HPLMN as specified in subclause\u00a05.5.1.3.2.\n8.2.6.29\tAdditional information requested\nThe UE shall include this IE if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys for ciphered broadcast assistance data.\n8.2.6.30\tRequested WUS assistance information\nThe UE may include this IE if:\n-\tthe UE supports WUS assistance information;\n-\tthe UE is not performing initial registration for emergency services; and\n-\tthe UE does not have an active emergency PDU session.\n8.2.6.31\tVoid\n8.2.6.32\tN5GC indication\nThis IE shall be included in the REGISTRATION REQUEST message when the W-AGF is acting on behalf of an N5GC device.\n8.2.6.33\tRequested NB-N1 mode DRX parameters\nThe UE shall include this IE if the UE wants to use or change the UE specific DRX parameters for NB-N1 mode.\n8.2.6.34\tUE request type\nThe UE shall include this IE if the MUSIM UE requests the release of the NAS signalling connection.\n8.2.6.35\tPaging restriction\nThe UE shall include this IE if the Request type is set to \"NAS signalling connection release\" in the UE request type IE and the UE requests the network to restrict paging.\n8.2.6.35\tService-level-AA container\nThe UE shall include this IE if the UE supporting UAS services requests a registration for UAS services.\n8.2.6.36\tNID\nThe UE shall include this IE if the 5G-GUTI in the 5GS mobile identity IE was assigned by an SNPN other than the SNPN with which the UE is registering.\n8.2.6.37\tMS determined PLMN with disaster condition\nThe UE shall include this IE when the UE needs to indicate the MS determined PLMN with disaster condition determined as specified in 3GPP\u00a0TS\u00a023.122\u00a0[5].\n8.2.6.38\tRequested PEIPS assistance information\nThe UE may include this IE if the UE supports NR paging subgrouping, the UE is not performing initial registration for emergency services, is not registered for emergency services and does not have an active emergency PDU session.\n8.2.6.39\tRequested T3512 value\nThe UE may include this IE during the registration procedure if it requests to use MICO mode and T3324 IE is included, to request a particular T3512 timer value.\n8.2.6.40\tUnavailability information\nThis IE shall be included if an event is triggered in the UE that would make the UE unavailable for a certain period.\n8.2.6.41\tNon-3GPP path switching information\nThe UE may include this IE during the registration procedure for mobility registration update if it requests from the network to keep using the user plane resources of the old non-3GPP access during path switching to the new non-3GPP access.\n8.2.6.42\tAUN3 indication\nThis IE shall be included in the REGISTRATION REQUEST message when the 5G-RG is acting on behalf of an AUN3 device.\n8.2.7\tRegistration accept\n8.2.7.1\tMessage definition\nThe REGISTRATION ACCEPT message is sent by the AMF to the UE. See table\u00a08.2.7.1.1.\nMessage type:\tREGISTRATION ACCEPT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.7.1.1: REGISTRATION ACCEPT message content\n8.2.7.2\t5G-GUTI\nThis IE may be included to assign a 5G-GUTI to a UE.\n8.2.7.3\tEquivalent PLMNs\nThis IE may be included in order to assign an equivalent PLMNs list to a UE.\n8.2.7.4\tTAI list\nThis IE may be included to assign a TAI list to a UE.\n8.2.7.5\tAllowed NSSAI\nThis IE shall be included:\na)\tif:\n1)\tone or more S-NSSAIs in the requested NSSAI of the REGISTRATION REQUEST message are allowed by the AMF for a network not supporting NSSAA;\n2)\tone or more S-NSSAIs in the requested NSSAI of the REGISTRATION REQUEST message are not subject to network slice-specific authentication and authorization and are allowed by the AMF; or\n3)\tthe network slice-specific authentication and authorization has been successfully performed for one or more S-NSSAIs in the requested NSSAI of the REGISTRATION REQUEST message; or\nb)\tif the initial registration request is not for onboarding services in SNPN or the UE is not registered for onboarding services in SNPN, the requested NSSAI was not included in the REGISTRATION REQUEST message or none of the requested NSSAI are allowed; and\n1)\tthe network does not support NSSAA; or\n2)\tthe network has one or more default S-NSSAIs which are not subject to network slice-specific authentication and authorization.\n8.2.7.6\tRejected NSSAI\nThe network may include this IE to inform the UE of one or more S-NSSAIs that were included in the requested NSSAI in the REGISTRATION REQUEST message but were rejected by the network.\n8.2.7.7\tConfigured NSSAI\nThe network may include this IE if the network needs to provide the UE with a new configured NSSAI for the current PLMN or SNPN and the UE is neither registering nor registered for onboarding services in SNPN.\n8.2.7.8\t5GS network feature support\nThe network may include this IE to inform the UE of the support of certain features. If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.\n8.2.7.9\tPDU session status\nThis IE shall be included when the network needs to indicate the PDU sessions that are associated with the access type the message is sent over, that are active in the network.\n8.2.7.10\tPDU session reactivation result\nThis IE shall be included:\n-\tif the Uplink data status IE is included in the REGISTRATION REQUEST message; or\n-\tif the Allowed PDU session status IE is included in the REGISTRATION REQUEST message and there is at least one PDU session indicated in the Allowed PDU session status IE for which the user-plane resources can be re-established over 3GPP access.\n8.2.7.11\tPDU session reactivation result error cause\nThis IE may be included, if the PDU session reactivation result IE is included and there exist one or more PDU sessions for which the user-plane resources cannot be re-established, to indicate the cause of failure to re-establish the user-plane resources.\n8.2.7.12\tLADN information\nThe network shall include this IE if there are valid LADN service area(s) for the subscribed DNN(s) of the UE in the current registration area.\n8.2.7.13\tMICO indication\nThe network shall include the MICO indication IE if:\na)-\tthe UE included the MICO indication IE in the REGISTRATION REQUEST message; and\nb)\tthe network supports and accepts the use of MICO mode.\n8.2.7.14\tNetwork slicing indication\nThis IE shall be included if the user's network slicing subscription has changed in the UDM of a PLMN or an SNPN.\n8.2.7.15\tService area list\nThis IE may be included to assign new service area restrictions to the UE.\n8.2.7.16\tT3512 value\nThe AMF shall include this IE during a registration procedure over 3GPP access when the 5GS registration type IE does not indicate \"periodic registration updating\". The AMF may include this IE during the mobility and periodic registration update procedure over 3GPP access when the 5GS registration type IE indicates \"periodic registration updating\".\n8.2.7.17\tNon-3GPP de-registration timer value\nThis IE may be included if the network needs to indicate to the UE registered over non-3GPP access the value of a non-3GPP de-registration timer value.\n8.2.7.18\tT3502 value\nThis IE may be included to indicate a value for timer T3502.\n8.2.7.19\tEmergency number list\nThis IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers valid within the same country as in the PLMN from which this IE is received.\n8.2.7.20\tExtended emergency number list\nThis IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers (with URN information) valid within the same country as in the PLMN from which this IE is received or valid only in the PLMN or SNPN from which this IE is received.\n8.2.7.21\tSOR transparent container\nThis IE may be sent by the network.\n8.2.7.22\tEAP message\nEAP message IE is included if the REGISTRATION ACCEPT message is sent as part of registration for emergency services and is used to convey EAP-failure message.\n8.2.7.23\tNSSAI inclusion mode\nThis IE shall be included if required by operatory policy.\n8.2.7.24\tOperator-defined access category definitions\nThis IE may be included to assign new operator-defined access category definitions to the UE or delete the operator-defined access category definitions at the UE side.\n8.2.7.25\tNegotiated DRX parameters\nThe network shall include this IE if the Requested DRX parameters IE was included in the REGISTRATION REQUEST message.\n8.2.7.26\tNon-3GPP NW policies\nThe AMF shall not include this IE during a registration procedure over non-3GPP access.\nThis IE is included if the network needs to indicate whether emergency numbers provided via non-3GPP access can be used to initiate UE detected emergency calls (see 3GPP\u00a0TS\u00a024.302\u00a0[16]). If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.\nNOTE:\tIn this version of the specification, this IE is applicable in case the UE is connected to a PLMN using an ePDG as specified in 3GPP\u00a0TS\u00a024.302\u00a0[16].\n8.2.7.27\tNegotiated extended DRX parameters\nThe network shall include the Negotiated extended DRX parameters IE if:\n-\tthe UE included the Requested extended DRX parameters IE in the REGISTRATION REQUEST message; and\n-\tthe network supports eDRX and accepts the use of eDRX.\n8.2.7.28\tT3447 value\nThe network may include T3447 value IE if:\n-\tthe UE has indicated support for service gap control in the REGISTRATION REQUEST message; and\n-\tthe 5GMM context contains a service gap time value.\n8.2.7.29\tT3448 value\nThe network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports the control plane CIoT 5GS optimizations.\n8.2.7.30\tT3324 value\nThe AMF shall include this IE if the UE has requested active time value in the REGISTRATION REQEUST message and the AMF decides to accept the use of MICO mode and the use of the active time.\n8.2.7.31\tEPS bearer context status\nThis IE shall be included when the network generated an EPS bearer context status information for the UE during the inter-system change from S1 mode to N1 mode and the network supports N26 interface.\n8.2.7.32\tUE radio capability ID\nThis IE may be included if the UE is not in NB-N1 mode, both the UE and the network support RACS and the network needs to assign a network-assigned UE radio capability ID to the UE.\n8.2.7.33\tUE radio capability ID deletion indication\nThis IE may be included if the UE is not in NB-N1 mode, both the UE and the network support RACS and the network needs to trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving PLMN or SNPN.\n8.2.7.34\tPending NSSAI\nThe network may include this IE to inform the UE of one or more S-NSSAIs that are pending as the network slice-specific authentication and authorization procedure is not completed.\n8.2.7.35\tCiphering key data\nThis IE is included if the network needs to send ciphering key data to the UE for ciphered broadcast assistance data.\n8.2.7.36\tCAG information list\nThis IE may be included to assign a new \"CAG information list\" to the UE or delete the \"CAG information list\" at the UE side.\n8.2.7.37\tTruncated 5G-S-TMSI configuration\nThe network shall include this IE if:\n-\tthe UE is in NB-N1 mode;\n-\tthe UE requests \"control plane CIoT 5GS optimization\" in the 5GS update type IE of REGISTRATION REQUEST message;\n-\tthe AMF decides to accept the requested CIoT 5GS optimization; and\n-\tthe network is configured to provide the truncated 5G-S-TMSI configuration for control plane CIoT 5GS optimizations.\n8.2.7.38\tNegotiated NB-N1 mode DRX parameters\nThe network shall include the Negotiated NB-N1 mode DRX parameters IE if the requested NB-N1 mode DRX parameters IE was included in the REGISTRATION REQUEST message.\n8.2.7.39\tNegotiated WUS assistance information\nThe network shall include the Negotiated WUS assistance information IE if:\n-\tthe UE supports WUS assistance information;\n-\tthe AMF supports and accepts the use of WUS assistance information;\n-\tthe UE is not performing the initial registration for emergency services; and\n-\tthe UE does not have an active emergency PDU session.\n8.2.7.40\tExtended rejected NSSAI\nIf the UE supports Extended rejected NSSAI, the network may include this IE to inform the UE of one or more S-NSSAIs that were included in the requested NSSAI in the REGISTRATION REQUEST message but were rejected by the network.\n8.2.7.41\tService-level-AA container\nThe network shall include this IE if the UUAA procedure is triggered for the UE supporting UAS services. The network may include this IE if there is a valid successful UUAA result for the UE in the UE 5GMM context upon a registration for UAS services is requested from the UE.\n8.2.7.42\tNegotiated PEIPS assistance information\nThe network shall include the Negotiated PEIPS assistance information IE if:\n-\tthe UE supports NR paging subgrouping;\n-\tthe AMF supports and accepts the use of PEIPS assistance information for the UE; and\n-\tthe UE is not performing initial registration for emergency services and does not have an active emergency PDU session.\n8.2.7.43\t5GS additional request result\nThe network may include this IE to inform the UE about the result of additional request.\n8.2.7.44\tNSSRG information\nThis IE may be included to provide NSSRG information associated with the configured NSSAI.\n8.2.7.45\tDisaster roaming wait range\nThis IE may be included to assign a new disaster roaming wait range to the UE.\n8.2.7.46\tDisaster return wait range\nThis IE may be included to assign a new disaster return wait range to the UE.\n8.2.7.47\tList of PLMNs to be used in disaster condition\nThis IE may be included by an allowed PLMN to assign a new \"list of PLMN(s) to be used in disaster condition\" associated with the serving PLMN to the UE.\n8.2.7.48\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\"\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"5GS forbidden tracking areas for roaming\". This IE is included only if the message is sent via satellite NG-RAN access. \n8.2.7.49\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for\u00a0regional provision of service\"\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"5GS forbidden tracking areas for regional provision of service\". This IE is included only if the message is sent via satellite NG-RAN access.\n8.2.7.50\tExtended CAG information list\nIf the UE supports Extended CAG information list, the network may include this IE to assign a new \"CAG information list\" to the UE or delete the \"CAG information list\" at the UE side.\n8.2.7.51\tNSAG information\nIf the UE has set the NSAG bit to \"NSAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message over 3GPP access, the network may include this IE to provide NSAG information to the UE. Otherwise, the network shall not include this IE (see the 'comprehension required' scheme in subclause\u00a011.2.5 of 3GPP\u00a0TS\u00a024.007\u00a0[11]).\n8.2.7.52\tEquivalent SNPNs\nThis IE may be included in order to assign an equivalent SNPNs list to a UE, by an AMF of an SNPN.\n8.2.7.53\tNID\nThis IE shall be included if the UE supports equivalent SNPNs and the serving SNPN changes.\n8.2.7.54\tRegistration accept type 6 IE container\n8.2.7.54.1\tGeneral\nThis information element may be included only if the network knows that the UE will not treat this IE as unknown 'comprehension required' IE. Otherwise, the network shall not include this IE (see the 'comprehension required' scheme in subclause\u00a011.2.5 of 3GPP\u00a0TS\u00a024.007\u00a0[11]).\nIn this version of the specification, only the transfer of the information elements specified in table\u00a08.2.7.54.1.1 is supported in the Registration accept type 6 IE container information element in the present message. For the handling of an information element with an IEI not listed in table\u00a08.2.7.54.1.1, i.e., with an IEI unknown in the Registration accept type 6 IE container information element, see subclause\u00a07.6.4.1.\nTable\u00a08.2.7.54.1.1: Information elements and IEIs for the Registration accept type 6 IE container\n 8.2.7.54.2\tExtended LADN information\nThe network shall include this IE if the UE supports LADN per DNN and S-NSSAI and there are valid LADN service area(s) for the subscribed DNN(s) of the UE and S-NSSAI associated with the LADN in the current registration area.\n8.2.7.54.3\tS-NSSAI location validity information\nThe network may include this IE to update the S-NSSAI location validity information.\n8.2.7.54.4\tVoid\nVoid.\n8.2.7.54.5\tPartially allowed NSSAI\nThe network may include this IE to assign a partially allowed NSSAI to the UE.\n8.2.7.54.6\tPartially rejected NSSAI\nThe network may include this IE to assign a partially rejected NSSAI to the UE.\n8.2.7.55\tRAN timing synchronization\nThis IE may be included to provide information related to the RAN timing synchronization to a UE which has set the Reconnection to the network due to RAN timing synchronization status change (RANtiming) bit to \"Reconnection to the network due to RAN timing synchronization status change supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\n8.2.7.56\tAlternative NSSAI\nThe network may include this IE to provide the alternative NSSAI to the UE.\n8.2.7.57\tMaximum time offset \nThis IE may be included to provide the UE with a maximum waiting time after return from discontinuous coverage.\nEditor's note (WI: 5GSAT_ph2, CR 5240):\tThe criterion for inclusion will be aligned based on SA2 agreements.\n8.2.7.58\tS-NSSAI time validity information\nIf the UE supports S-NSSAI time validity information, the network may include this IE to update the S-NSSAI time validity information.\n8.2.7.59\tUnavailability configuration\nThe network should include this IE if the network needs to provide parameters related to unavailability period to the UE.\n8.2.7.60\tFeature authorization indication\nThe network may include this IE to inform to the UE about the authorization status of the UE whether to operate as an MBSR or to operate not as an MBSR but to operate as a UE. \n8.2.7.61\tOn-demand NSSAI\nThe network may include this IE to provide the on-demand NSSAI to the UE.\n8.2.8\tRegistration complete\n8.2.8.1\tMessage definition\nThe REGISTRATION COMPLETE message is sent by the UE to the AMF. See table\u00a08.2.8.1.1.\nMessage type:\tREGISTRATION COMPLETE\nSignificance:\tdual\nDirection:\tUE to network\nTable 8.2.8.1.1: REGISTRATION COMPLETE message content\n\n8.2.8.2\tSOR transparent container\nThis IE may be sent by the UE. If this IE is sent, the contents of this IE indicates the UE acknowledgement of successful reception of the SOR transparent container IE in the REGISTRATION ACCEPT message. This IE shall indicate the ME support of SOR-CMCI.\n8.2.9\tRegistration reject\n8.2.9.1\tMessage definition\nThe REGISTRATION REJECT message is sent by the AMF to the UE. See table\u00a08.2.9.1.1.\nMessage type:\tREGISTRATION REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.9.1.1: REGISTRATION REJECT message content\n\nNOTE:\tIt is possible for AMFs compliant with version 17.7.0 or 17.8.0 of this specification to send the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE with IEI of value \"3B\" for this message or the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for\u00a0regional provision of service\" IE with IEI of value \"3C\" for this message.\n8.2.9.2\tT3346 value\nThe AMF may include this IE when the general NAS level mobility management congestion control is active\n8.2.9.3\tT3502 value\nThis IE may be included to indicate a value for timer T3502 during the initial registration.\n8.2.9.4\tEAP message\nEAP message IE is included if the REGISTRATION REJECT message is used to convey EAP-failure message.\n8.2.9.5\tRejected NSSAI\nThe network may include this IE to inform the UE of one or more S-NSSAIs that were included in the requested NSSAI in the REGISTRATION REQUEST message but were rejected by the network.\n8.2.9.6\tCAG information list\nThis IE may be included to assign a new \"CAG information list\" to the UE or delete the \"CAG information list\" at the UE side.\n8.2.9.7\tExtended rejected NSSAI\nIf the UE supports Extended rejected NSSAI, the network may include this IE to inform the UE of one or more S-NSSAIs that were included in the requested NSSAI in the REGISTRATION REQUEST message but were rejected by the network.\n8.2.9.8\tDisaster return wait range\nThis IE may be included to assign a new disaster return wait range to the UE.\n8.2.9.9\tExtended CAG information list\nIf the UE supports Extended CAG information list, the network may include this IE to assign a new \"CAG information list\" to the UE or delete the \"CAG information list\" at the UE side.\n8.2.9.10\tLower bound timer value\nThe AMF may include this IE when the 5GMM cause is set to #78 \"PLMN not allowed to operate at the present UE location\", to provide a minimum time value for an entry added to the list of \"PLMNs not allowed to operate at the present UE location\".\n8.2.9.11\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\"\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"5GS forbidden tracking areas for roaming\". This IE is included only if the message is sent via satellite NG-RAN access. \n8.2.9.12\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for\u00a0regional provision of service\"\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"5GS forbidden tracking areas for regional provision of service\". This IE is included only if the message is sent via satellite NG-RAN access.\n8.2.9.13\tN3IWF identifier\nThe network may include this IE if the UE supports slice-based N3IWF selection over non-3GPP access network.\n8.2.9.14\tTNAN information\nThe network may include this IE if the UE supports slice-based TNGF selection over trusted non-3GPP access network.\n\n8.2.10\tUL NAS transport\n8.2.10.1\tMessage definition\nThe UL NAS TRANSPORT message transports message payload and associated information to the AMF. See table\u00a08.2.10.1.1.\nMessage type:\tUL NAS TRANSPORT\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.10.1.1: UL NAS TRANSPORT message content\n\n8.2.10.2\tPDU session ID\nThe UE shall include this IE when the Payload container type IE is set to \"N1 SM information\" or \"CIoT user data.\n8.2.10.3\tOld PDU session ID\nThe UE shall include this IE if the UL NAS TRANSPORT message transports a PDU SESSION ESTABLISHMENT REQUEST message upon receiving the PDU SESSION MODIFICATION COMMAND message with the 5GSM cause IE set to #39 \"reactivation requested\" and the Payload container type IE is set to \"N1 SM information\".\n8.2.10.4\tRequest type\nThe UE shall include this IE when the PDU session ID IE is included and the Payload container IE contains the PDU SESSION ESTABLISHMENT REQUEST message or the PDU SESSION MODIFICATION REQUEST which is not initiated to indicate a change of 3GPP PS data off UE status associated to a PDU session.\n8.2.10.5\tS-NSSAI\nThe UE may include this IE when the Request type IE is set to \"initial request\", \"existing PDU session\" or \"MA PDU request\", the Payload container type IE is set to \"N1 SM information\" and the UE is not registered for onboarding services in SNPN.\n8.2.10.6\tDNN\nThe UE may include this IE when the Request type IE is set to \"initial request\", \"existing PDU session\" or \"MA PDU request\", the Payload container type IE is set to \"N1 SM information\" and the UE is not registered for onboarding services in SNPN.\n8.2.10.7\tAdditional information\nThis IE is included when the Payload container type IE is set to \"LTE Positioning Protocol (LPP) message container\", \"UPP-CMI container\", \"SLPP message container\", or \"Location services (LCS) message container\".\n8.2.10.8\tMA PDU session information\nThe UE may include this IE if the Request type IE is included and is not set to \"initial emergency request \" or \"existing emergency PDU session\" in the UL NAS TRANSPORT message.\n8.2.10.9\tRelease assistance indication\nThe UE may include this IE to inform the network whether:\n-\tno further uplink and no further downlink data transmission is expected; or\n-\tonly a single downlink data transmission (e.g. acknowledgement or response to uplink data) and no further uplink data transmission subsequent to the uplink data transmission is expected.\n8.2.10.10\tNon-3GPP access path switching indication\nThe UE may include this IE when the Payload container type IE is set to \"N1 SM information\" to indicate whether the UE supports the non-3GPP access path switching for the PDU session.\n8.2.10.11\tAlternative S-NSSAI\nThe UE shall include this IE if the UE can provide alternative S-NSSAI associated with the S-NSSAI to be replaced to the network.\n8.2.10.12\tPayload container information\nThe UE may include this IE when the Payload container type IE is set to \"Location services (LCS) message container\".\n8.2.11\tDL NAS transport\n8.2.11.1\tMessage definition\nThe DL NAS TRANSPORT message transports message payload and associated information to the UE. See table\u00a08.2.11.1.1.\nMessage type:\tDL NAS TRANSPORT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.11.1.1: DL NAS TRANSPORT message content\n\n8.2.11.2\tPDU session ID\nThe AMF shall include this IE when the Payload container type IE is set to \"N1 SM information\" or \"CIoT user data container\".\n8.2.11.3\tAdditional information\nThis IE is included when the Payload container type IE is set to \"LTE Positioning Protocol (LPP) message container\", \"UPP-CMI container\", \"SLPP message container\", or \"Location services (LCS) message container\".\n8.2.11.4\t5GMM cause\nThe AMF shall include this IE when the Payload container IE contains an uplink payload which was not forwarded and the Payload container type IE is not set to \"Multiple payloads\".\n8.2.11.5\tBack-off timer value\nThe AMF may include this IE to indicate the back-off timer value when the Payload container IE is included and the Payload container type IE is not set to \"Multiple payloads\".\n8.2.11.6\tLower bound timer value\nThe AMF may include this IE when the 5GMM cause is set to #78 \"PLMN not allowed to operate at the present UE location\", to provide a minimum time value for an entry added to the list of \"PLMNs not allowed to operate at the present UE location\".\n8.2.12\tDe-registration request (UE originating de-registration)\n8.2.12.1\tMessage definition\nThe DEREGISTRATION REQUEST message is sent by the UE to the AMF. See table\u00a08.2.12.1.1.\nMessage type:\tDEREGISTRATION REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.12.1.1: DEREGISTRATION REQUEST message content\n\n8.2.12.2\tUnavailability information\nThe UE may include this IE when an event is triggered in the UE that would make the UE unavailable for a certain period.\n8.2.12.3\tNAS message container\nThis IE shall be included if the UE is sending a DEREGISTRATION REQUEST message as an initial NAS message and the UE needs to send non-cleartext IEs.\n8.2.13\tDe-registration accept (UE originating de-registration)\n8.2.13.1\tMessage definition\nThe DEREGISTRATION ACCEPT message is sent by the AMF to the UE. See table\u00a08.2.13.1.1.\nMessage type:\tDEREGISTRATION ACCEPT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.13.1.1: DEREGISTRATION ACCEPT message content\n\n8.2.14\tDe-registration request (UE terminated de-registration)\n8.2.14.1\tMessage definition\nThe DEREGISTRATION REQUEST message is sent by the AMF to the UE. See table\u00a08.2.14.1.1.\nMessage type:\tDEREGISTRATION REQUEST\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.14.1.1: DEREGISTRATION REQUEST message content\n\nNOTE:\tIt is possible for AMFs compliant with version 17.7.0 or 17.8.0 of this specification to send the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE with IEI of value \"3B\" for this message or the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for\u00a0regional provision of service\" IE with IEI of value \"3C\" for this message.\n8.2.14.2\t5GMM cause\nThis information element is included if a 5GMM cause is provided.\n8.2.14.3\tT3346 value\nThe AMF may include this IE when the general NAS level mobility management congestion control is active.\n8.2.14.4\tRejected NSSAI\nThe AMF may include this IE to inform the UE of one or more S-NSSAIs that were rejected by the network.\n8.2.14.5\tCAG information list\nThis IE may be included to assign a new \"CAG information list\" to the UE or delete the \"CAG information list\" at the UE side.\n8.2.14.6\tExtended rejected NSSAI\nIf the UE supports Extended rejected NSSAI, the AMF may include this IE to inform the UE of one or more S-NSSAIs that were rejected by the network.\n8.2.14.7\tDisaster return wait range\nThis IE may be included to assign a new disaster return wait range to the UE.\n8.2.14.7A\tExtended CAG information list\nIf the UE supports Extended CAG information list, the network may include this IE to assign a new \"CAG information list\" to the UE or delete the \"CAG information list\" at the UE side.\n8.2.14.8\tLower bound timer value\nThe AMF may include this IE when the 5GMM cause is set to #78 \"PLMN not allowed to operate at the present UE location\", to provide a minimum time value for an entry added to the list of \"PLMNs not allowed to operate at the present UE location\".\n8.2.14.9\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\"\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"5GS forbidden tracking areas for roaming\". This IE is included only if the message is sent via satellite NG-RAN access. \n8.2.14.10\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for\u00a0regional provision of service\"\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"5GS forbidden tracking areas for regional provision of service\". This IE is included only if the message is sent via satellite NG-RAN access.\n8.2.15\tDe-registration accept (UE terminated de-registration)\n8.2.15.1\tMessage definition\nThe DEREGISTRATION ACCEPT message is sent by the UE to the AMF. See table\u00a08.2.15.1.1.\nMessage type:\tDEREGISTRATION ACCEPT\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.15.1.1.1: DEREGISTRATION ACCEPT message content\n\n8.2.16\tService request\n8.2.16.1\tMessage definition\nThe SERVICE REQUEST message is sent by the UE to the AMF in order to request the establishment of an N1 NAS signalling connection, to request the establishment of user-plane resources for PDU sessions which are established without user-plane resources, or both. See table\u00a08.2.16.1.1.\nMessage type:\tSERVICE REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.16.1.1: SERVICE REQUEST message content\n\n8.2.16.2\tUplink data status\nThis IE shall be included if the UE has uplink user data pending to be sent.\n8.2.16.3\tPDU session status\nThis IE shall be included when the UE needs to indicate the PDU sessions that are associated with the access type that the message is sent over, that are active within the UE.\n8.2.16.4\tAllowed PDU session status\nThis IE shall be included if the SERVICE REQUEST message is sent as a response to paging with the access type indicating non-3GPP access or notification via 3GPP access for PDU session(s) associated with non-3GPP access.\n8.2.16.5\tNAS message container\nThis IE shall be included if the UE is sending a SERVICE REQUEST message as an initial NAS message and the UE needs to send non-cleartext IEs.\n8.2.16.6\tUE request type\nThe UE shall include this IE if the MUSIM UE requests the release of the NAS signalling connection or rejects the paging request from the network.\n8.2.16.7\tPaging restriction\nThe UE shall include this IE if the Request type is set to \"NAS signalling connection release\" or to \"Rejection of paging\" in the UE request type IE and the UE requests the network to restrict paging.\n8.2.17\tService accept\n8.2.17.1\tMessage definition\nThe SERVICE ACCEPT message is sent by the AMF to the UE in order to accept the service request procedure. See table\u00a08.2.17.1.1.\nMessage type:\tSERVICE ACCEPT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.17.1.1: SERVICE ACCEPT message content\n\n8.2.17.2\tPDU session status\nThis IE shall be included when the network needs to indicate the PDU sessions that are associated with the access type that the message is sent over that are active within the network.\n8.2.17.3\tPDU session reactivation result\nThis IE shall be included:\n-\tif the Uplink data status IE is included in the SERVICE REQUEST message; or\n-\tif the Allowed PDU session status IE is included in the SERVICE REQUEST message and there is at least one PDU session indicated in the Allowed PDU session status IE for which user-plane resources can be re-established over 3GPP access.\n8.2.17.4\tPDU session reactivation result error cause\nThis IE may be included if the PDU session reactivation result IE is included and there exist one or more PDU sessions for which the user-plane resources cannot be re-established, to indicate the cause of failure to re-establish the user-plane resources.\n8.2.17.5\tEAP message\nEAP message IE is included if the SERVICE ACCEPT message is sent to a UE registered for emergency services and is used to convey EAP-failure message.\n8.2.17.6\tT3448 value\nThe network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports the control plane CIoT 5GS optimizations.\n8.2.17.7\t5GS additional request result\nThe network may include this IE to inform the UE about the result of additional request.\n8.2.17.8\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\"\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"5GS forbidden tracking areas for roaming\". This IE is included only if the message is sent via satellite NG-RAN access. \n8.2.17.9\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for\u00a0regional provision of service\"\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"5GS forbidden tracking areas for regional provision of service\". This IE is included only if the message is sent via satellite NG-RAN access.\n8.2.18\tService reject\n8.2.18.1\tMessage definition\nThe SERVICE REJECT message is sent by the AMF to the UE in order to reject the service request procedure. See table\u00a08.2.18.1.1.\nMessage type:\tSERVICE REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.18.1.1: SERVICE REJECT message content\n\nNOTE:\tIt is possible for AMFs compliant with version 17.7.0 or 17.8.0 of this specification to send the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\" IE with IEI of value \"3B\" for this message or the Forbidden TAI(s) for the list of \"5GS forbidden tracking areas for\u00a0regional provision of service\" IE with IEI of value \"3C\" for this message.\n8.2.18.2\tPDU session status\nThis IE shall be included when the network needs to indicate the PDU sessions that are associated with the access type that the message is sent over, that are active within the network.\n8.2.18.3\tT3346 value\nThe AMF may include this IE when the general NAS level mobility management congestion control is active.\n8.2.18.4\tEAP message\nEAP message IE is included if the SERVICE REJECT message is used to convey EAP-failure message.\n8.2.18.5\tT3448 value\nThe network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports the control plane CIoT 5GS optimizations.\n8.2.18.6\tCAG information list\nThis IE may be included to assign a new \"CAG information list\" to the UE or delete the \"CAG information list\" at the UE side.\n8.2.18.7\tDisaster return wait range\nThis IE may be included to assign a new disaster return wait range to the UE.\n8.2.18.8\tExtended CAG information list\nIf the UE supports Extended CAG information list, the network may include this IE to assign a new \"CAG information list\" to the UE or delete the \"CAG information list\" at the UE side.\n8.2.18.9\tLower bound timer value\nThe AMF may include this IE when the 5GMM cause is set to #78 \"PLMN not allowed to operate at the present UE location\", to provide a minimum time value for an entry added to the list of \"PLMNs not allowed to operate at the present UE location\".\n8.2.18.10\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for roaming\"\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"5GS forbidden tracking areas for roaming\". This IE is included only if the message is sent via satellite NG-RAN access. \n8.2.18.11\tForbidden TAI(s) for the list of \"5GS forbidden tracking areas for\u00a0regional provision of service\"\nThis IE is included to indicate the forbidden TAI(s) to be stored in the list of \"5GS forbidden tracking areas for regional provision of service\". This IE is included only if the message is sent via satellite NG-RAN access.\n8.2.19\tConfiguration update command\n8.2.19.1\tMessage definition\nThe CONFIGURATION UPDATE COMMAND message is sent by the AMF to the UE. See table\u00a08.2.19.1.1.\nMessage type:\tCONFIGURATION UPDATE COMMAND\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.19.1.1: CONFIGURATION UPDATE COMMAND message content\n\n8.2.19.2\tConfiguration update indication\nThe AMF shall include this IE if the AMF needs to request an acknowledgement or a registration procedure from the UE.\n8.2.19.3\t5G-GUTI\nThis IE may be included to assign a new 5G GUTI to the UE.\n8.2.19.4\tTAI list\nThis IE may be included to assign a new TAI list to the UE.\n8.2.19.5\tAllowed NSSAI\nThis IE may be included to assign a new allowed NSSAI to the UE not registered for onboarding services in SNPN.\n8.2.19.6\tService area list\nThis IE may be included to assign a new service area list to the UE.\n8.2.19.7\tFull name for network\nThis IE may be included to assign a new full name for network to the UE.\n8.2.19.8\tShort name for network\nThis IE may be included to assign a new short name for network to the UE.\n8.2.19.9\tLocal time zone\nThis IE may be included to assign a new local time zone to the UE.\n8.2.19.10\tUniversal time and local time zone\nThis IE may be included to assign new universal time and local time zone to the UE.\n8.2.19.11\tNetwork daylight saving time\nThis IE may be included to assign new network daylight saving time to the UE.\n8.2.19.12\tLADN information\nThis IE may be included to assign new LADN information to the UE or delete the LADN information at the UE side.\n8.2.19.13\tMICO indication\nThis IE may be included to request the UE to re-negotiate MICO mode.\n8.2.19.14\tNetwork slicing indication\nThis IE shall be included if the user's network slicing subscription has changed in the UDM of a PLMN or an SNPN.\n8.2.19.15\tConfigured NSSAI\nThe AMF shall include this IE when the AMF needs to provide the UE with a new configured NSSAI for the current PLMN or SNPN and the UE is neither registering nor registered for onboarding services in SNPN.\n8.2.19.16\tRejected NSSAI\nThe network may include this IE to inform the UE of one or more S-NSSAIs that were previously sent to the UE in the allowed NSSAI or the pending NSSAI, but are now considered rejected by the network.\n8.2.19.17\tOperator-defined access category definitions\nThis IE may be included to assign new operator-defined access category definitions to the UE or delete the operator-defined access category definitions at the UE side.\n8.2.19.18\tSMS indication\nThis IE may be included to indicate that the ability for the UE to use SMS over NAS has changed.\n8.2.19.19\tT3447 value\nThis IE may be included to assign a new T3447 value to the UE.\n8.2.19.20\tCAG information list\nThis IE may be included to assign new \"CAG information list\" to the UE or delete the \"CAG information list\" at the UE side.\n8.2.19.21\tUE radio capability ID\nThis IE may be included if the UE is not in NB-N1 mode, both the UE and the network support RACS and the network needs to assign a network-assigned UE radio capability ID to the UE.\n8.2.19.22\tUE radio capability ID deletion indication\nThis IE may be included if the UE is not in NB-N1 mode, both the UE and the network support RACS and the network needs to trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving PLMN or serving SNPN.\n8.2.19.23\t5GS registration result\nThis IE shall be included if the network wants to indicate to the UE that the UE is registered for emergency services.\n8.2.19.24\tTruncated 5G-S-TMSI configuration\nThis IE may be included to provide a new truncated 5G-S-TMSI configuration to the UE in NB-N1 mode if the network is configured to provide the truncated 5G-S-TMSI configuration for control plane CIoT 5GS optimizations.\n8.2.19.25\tAdditional configuration indication\nThe network may include this IE when requesting the UE to register without the release of the N1 NAS signalling connection.\n8.2.19.26\tExtended rejected NSSAI\nIf the UE supports Extended rejected NSSAI, the network may include this IE to inform the UE of one or more S-NSSAIs that were previously sent to the UE in the allowed NSSAI or the pending NSSAI, but are now considered rejected by the network.\n8.2.19.27\tService-level-AA container\nThe network shall include this IE when the AMF receives the Service-level-AA payload or the UUAA-MM result from the UAS-NF during the UUAA-MM procedure or the UUAA revocation procedure. The network shall also include this IE if the AMF receives from the UAS-NF, the CAA-Level UAV ID as part of the UUAA-MM procedure.\n8.2.19.28\tNSSRG information\nThis IE may be included to provide NSSRG information associated with the configured NSSAI.\n8.2.19.29\tDisaster roaming wait range\nThis IE may be included to assign a new disaster roaming wait range to the UE.\n8.2.19.30\tDisaster return wait range\nThis IE may be included to assign a new disaster return wait range to the UE.\n8.2.19.31\tList of PLMNs to be used in disaster condition\nThis IE may be included by an allowed PLMN to assign a new \"list of PLMN(s) to be used in disaster condition\" associated with the serving PLMN to the UE.\n8.2.19.32\tExtended CAG information list\nIf the UE supports Extended CAG information list, the network may include this IE to assign a new \"CAG information list\" to the UE or delete the \"CAG information list\" at the UE side.\n8.2.19.33\tUpdated PEIPS assistance information\nThe AMF may include this IE if the UE supports NR paging subgrouping, the AMF supports and accepts the use of PEIPIS assistance information for the UE, the UE is not registered for emergency services, the UE does not have an active emergency PDU session, and the network needs to update PEIPS assistance information for the UE.\n8.2.19.34\tNSAG information\nIf the UE has set the NSAG bit to \"NSAG supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message and the CONFIGURATION UPDATE COMMAND message is sent over 3GPP access, the network may include this IE to provide NSAG information to the UE.\n8.2.19.35\tPriority indicator\nThe network shall include this IE when it needs to inform the UE that the use of access identity 1 is valid or is no longer valid.\n8.2.19.36\tRAN timing synchronization\nThis IE may be included to provide information related to the RAN timing synchronization to a UE which has set the Reconnection to the network due to RAN timing synchronization status change (RANtiming) bit to \"Reconnection to the network due to RAN timing synchronization status change supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.\n8.2.19.37\tExtended LADN information\nThis IE may be included to assign new extended LADN information to the UE or delete the extended LADN information at the UE side.\n8.2.19.38\tAlternative NSSAI\nThe network may include this IE to provide the mapping information between the S-NSSAI to be replaced and the alternative S-NSSAI to the UE.\n8.2.19.39\tS-NSSAI location validity information\nThe network may include this IE to update the S-NSSAI location validity information.\n8.2.19.40\tS-NSSAI time validity information\nThe network may include this IE to update the S-NSSAI time validity information.\n8.2.19.41\tMaximum time offset \nThis IE may be included to provide the UE with a maximum time offset after return from discontinuous coverage.\nEditor's note (WI: 5GSAT_ph2, CR 5240):\tThe criterion for inclusion will be aligned based on SA2 agreements.\n8.2.19.42\tPartially allowed NSSAI\nThe network may include this IE to assign a partially allowed NSSAI to the UE.\n8.2.19.43\tPartially rejected NSSAI\nThe network may include this IE to assign a partially rejected NSSAI to the UE.\n8.2.19.44\tFeature authorization indication\nThe network may include this IE to inform to the UE about the authorization status of the UE whether to operate as an MBSR or to operate not as an MBSR but to operate as a UE.\n8.2.19.45\tOn-demand NSSAI\nThe network may include this IE to provide the on-demand NSSAI to the UE.\n8.2.20\tConfiguration update complete\n8.2.20.1\tMessage definition\nThe CONFIGURATION UPDATE COMPLETE message is sent by the UE to the AMF. See table\u00a08.2.20.1.1.\nMessage type:\tCONFIGURATION UPDATE COMPLETE\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.20.1.1: CONFIGURATION UPDATE COMPLETE message content\n\n8.2.20.2\tVoid\n8.2.21\tIdentity request\n8.2.21.1\tMessage definition\nThe IDENTITY REQUEST message is sent by the AMF to the UE to request the UE to provide specified identity. See table\u00a08.2.21.1.1\nMessage type:\tIDENTITY REQUEST\nSignificance:\tdual\nDirection:\tAMF to UE\nTable\u00a08.2.21.1.1: IDENTITY REQUEST message content\n\n8.2.22\tIdentity response\n8.2.22.1\tMessage definition\nThe IDENTITY RESPONSE message is sent by the UE to the AMF to provide the requested identity. See table\u00a08.2.22.1.\nMessage type:\tIDENTITY RESPONSE\nSignificance:\tdual\nDirection:\tUE to AMF\nTable\u00a08.2.22.1.1: IDENTITY RESPONSE message content\n\n8.2.23\tNotification\n8.2.23.1\tMessage definition\nThe NOTIFICATION message is sent by the AMF to the UE to notify the UE to initiate a service request procedure. See table\u00a08.2.23.1.1.\nMessage type:\tNOTIFICATION\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.23.1.1: NOTIFICATION message content\n\n8.2.24\tNotification response\n8.2.24.1\tMessage definition\nThe NOTIFICATION RESPONSE message is sent by the UE to the AMF to notify the failure to initiate the service request procedure as a response of notification. See table\u00a08.2.24.1.1.\nMessage type:\tNOTIFICATION RESPONSE\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.2341.1: NOTIFICATION RESPONSE message content\n\n8.2.24.2\tPDU session status\nThis information element shall be included when the UE needs to indicate over non-3GPP access the PDU sessions that are associated with the 3GPP access type that are active within the UE.\n8.2.25\tSecurity mode command\n8.2.25.1\tMessage definition\nThe SECURITY MODE COMMAND message is sent by the AMF to the UE to establish NAS signalling security. See table\u00a08.2.25.1.1.\nMessage type:\tSECURITY MODE COMMAND\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.25.1.1: SECURITY MODE COMMAND message content\n\nNOTE:\tIt is possible for AMFs compliant with version 18.3.0 or 18.3.1 of this specification to send the AUN3 device security key IE with a fixed length of 66 octets.\n8.2.25.2\tIMEISV request\nThe AMF may include this information element to request the UE to send its IMEISV with the corresponding SECURITY MODE COMPLETE message.\n8.2.25.3\tVoid\n8.2.25.4\tSelected EPS NAS security algorithms\nThis IE shall be included if the AMF supports N26 interface, the UE set the S1 mode bit to \"S1 mode supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, and the AMF needs to provide the selected EPS NAS security algorithms to the UE.\n8.2.25.5\tAdditional 5G security information\nThe network shall include this IE if:\na)\tthe network needs to provide the UE with horizontal derivation parameter; or\nb)\tthe applicable initial NAS message (i.e. REGISTRATION REQUEST, CONTROL PLANE SERVICE REQUEST or SERVICE REQUEST) does not successfully pass the integrity check at the AMF (see subclause\u00a05.4.2.2).\n8.2.25.6\tEAP message\nThis IE is included when the EAP Success message is sent as part of the EAP based primary authentication and key agreement procedure, as specified in subclause\u00a05.4.1.2.\n8.2.25.7\tABBA\nThis IE shall be included if the message contains an EAP message IE with an EAP-success message.\n8.2.25.8\tReplayed S1 UE security capabilities\nThis IE shall be included if the Selected EPS NAS security algorithms information element is included.\n8.2.25.9\tAUN3 device security key\nThis IE shall be included when the SECURITY MODE COMMAND message is provided to a 5G-RG that is acting on behalf of an AUN3 device if the EAP message IE is set to an EAP-success message.\n8.2.26\tSecurity mode complete\n8.2.26.1\tMessage definition\nThe SECURITY MODE COMPLETE message is sent by the UE to the AMF in response to a SECURITY MODE COMMAND message. See table\u00a08.2.26.1.1.\nMessage type:\tSECURITY MODE COMPLETE\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.26.1.1: SECURITY MODE COMPLETE message content\n\n8.2.26.2\tIMEISV\nThe UE shall include this information element, if the IMEISV was requested within the corresponding SECURITY MODE COMMAND message.\n8.2.26.3\tNAS message container\nThe UE shall include this information element:\na)\tif during an ongoing registration procedure or service request procedure, the AMF included the Additional 5G security information with the RINMR bit set to \"Retransmission of the initial NAS message requested\" in the SECURITY MODE COMMAND message as described in 3GPP\u00a0TS\u00a033.501\u00a0[24]; or\nb)\tif during an ongoing registration procedure, the UE does not have a valid 5G NAS security context.\n8.2.26.4\tnon-IMEISV PEI\nThe 5G-RG or the W-AGF acting on behalf of the FN-RG (or on behalf of the N5GC device) shall include this information element, if the IMEISV was requested within the corresponding SECURITY MODE COMMAND message, the IMEISV is not available but MAC address is available.\nThe UE shall include this information element, if the IMEISV was requested within the corresponding SECURITY MODE COMMAND message, the IMEISV is not available but EUI-64 is available.\n8.2.27\tSecurity mode reject\n8.6.27.1\tMessage definition\nThe SECURITY MODE REJECT message is sent by the UE to the AMF to indicate that the corresponding security mode command has been rejected. See table\u00a08.2.27.1.1.\nMessage type:\tSECURITY MODE REJECT\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.27.1.1: SECURITY MODE REJECT message content\n\n8.2.28\tSecurity protected 5GS NAS message\n8.2.28.1\tMessage definition\nThis message is sent by the UE or the network to transfer a plain 5GS NAS message as specified in subclause\u00a08.2 together with the sequence number and the message authentication code protecting the message. See table\u00a08.2.28.1.1.\nMessage type:\tSECURITY PROTECTED 5GS NAS MESSAGE\nSignificance:\tdual\nDirection:\tboth\nTable\u00a08.2.28.1.1: SECURITY PROTECTED 5GS NAS MESSAGE message content\n\nNOTE:\tThe minimum length of Plain 5GS NAS message IE can be 2 octets if it includes a Test Mode Control message specified in 3GPP\u00a0TS\u00a038.509\u00a0[31AA].\n8.2.29\t5GMM status\n8.2.29.1\tMessage definition\nThe 5GMM STATUS message is sent by the UE or by the AMF at any time to report certain error conditions. See table\u00a08.2.29.1.1.\nMessage type:\t5GMM STATUS\nSignificance:\tlocal\nDirection:\tboth\nTable\u00a08.2.29.1.1: 5GMM STATUS message content\n\n8.2.30\tControl Plane Service request\n8.2.30.1\tMessage definition\nThe CONTROL PLANE SERVICE REQUEST message is sent by the UE to the AMF when the UE is using 5GS services with control plane CIoT 5GS optimization. See table\u00a08.2.30.1.1.\nMessage type:\tCONTROL PLANE SERVICE REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.30.1.1: CONTROL PLANE SERVICE REQUEST message content\n\n8.2.30.2\tCIoT small data container\nThis IE shall be included if the UE needs to send uplink small user data, SMS or location services message that is not more than 254 bytes, and there is no other optional IE to be sent.\nNOTE:\tWhen the UE determines to use the CIoT small data container IE to send uplink data in this message, there is no other optional IEs in this message.\n8.2.30.3\tPayload container type\nThis IE shall be included if the UE includes the Payload container IE.\n8.2.30.4\tPayload container\nThis IE shall be included if the UE needs to send uplink CIoT user data, SMS or location services message.\n8.2.30.5\tPDU session ID\nThe UE shall include this IE when the Payload container type IE is set to \"CIoT user data container\".\n8.2.30.6\tPDU session status\nThis IE shall be included when the UE needs to indicate the PDU sessions that are associated with the access type that the message is sent over, that are active within the UE.\n8.2.30.7\tRelease assistance indication\nThe UE may include this IE to inform the network whether:\n-\tno further uplink and no further downlink data transmission is expected; or\n-\tonly a single downlink data transmission (e.g. acknowledgement or response to uplink data) and no further uplink data transmission subsequent to the uplink data transmission is expected.\n8.2.30.8\tUplink data status\nThis IE shall be included if the UE has uplink user data pending to be sent over the user plane.\n8.2.30.9\tNAS message container\nThis IE shall be included if the UE is sending a CONTROL PLANE SERVICE REQUEST message as an initial NAS message and the UE needs to send non-cleartext IEs.\n8.2.30.10\tAdditional information\nThe UE may include this IE when the Payload container type IE is set to \"Location services message container\".\n8.2.30.11\tAllowed PDU session status\nThis IE shall be included if the CONTROL PLANE SERVICE REQUEST message is sent as a response to paging with the access type indicating non-3GPP access or notification via 3GPP access for PDU session(s) associated with non-3GPP access.\n8.2.30.12\tUE request type\nThe UE shall include this IE if the MUSIM UE requests the release of the NAS signalling connection or rejects the paging request from the network.\n8.2.30.13\tPaging restriction\nThe UE shall include this IE if the Request type is set to \"NAS signalling connection release\" or to \"Rejection of paging\" in the UE request type IE and the UE requests the network to restrict paging.\n8.2.31\tNetwork slice-specific authentication command\n8.2.31.1\tMessage definition\nThe NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message is sent by the AMF to the UE for authentication of the upper layers of the UE. See table\u00a08.2.31.1.1.\nMessage type:\tNETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.31.1.1: NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message content\n\n8.2.32\tNetwork slice-specific authentication complete\n8.2.32.1\tMessage definition\nThe NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message is sent by the UE to the AMF in response to the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message and indicates acceptance of the NETWORK SLICE-SPECIFIC AUTHENTICATION COMMAND message. See table\u00a08.2.32.1.1.\nMessage type:\tNETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.32.1.1: NETWORK SLICE-SPECIFIC AUTHENTICATION COMPLETE message content\n\n8.2.33\tNetwork slice-specific authentication result\n8.2.33.1\tMessage definition\nThe NETWORK SLICE-SPECIFIC AUTHENTICATION RESULT message is sent by the AMF to the UE for indicating the result of the network slice-specific authentication and authorization procedure. See table\u00a08.2.33.1.1.\nMessage type:\tNETWORK SLICE-SPECIFIC AUTHENTICATION RESULT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.33.1.1: NETWORK SLICE-SPECIFIC AUTHENTICATION RESULT message content\n\n8.2.34\tRelay key request\n8.2.34.1\tMessage definition\nThe RELAY KEY REQUEST message is sent by the UE to the AMF for initiation of PC5 keys establishment with the 5G ProSe remote UE or the 5G ProSe end UE as specified in 3GPP\u00a0TS\u00a033.503\u00a0[56]. See table\u00a08.2.34.1.\nMessage type:\tRELAY KEY REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.34.1: RELAY KEY REQUEST message content\n8.2.35\tRelay key accept\n8.2.35.1\tMessage definition\nThe RELAY KEY ACCEPT message is sent by the AMF to the UE as specified in 3GPP\u00a0TS\u00a033.503\u00a0[56]. See table\u00a08.2.35.1.\nMessage type:\tRELAY KEY ACCEPT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.35.1: RELAY KEY ACCEPT message content\n\n8.2.36\tRelay key reject\n8.2.36.1\tMessage definition\nThe RELAY KEY REJECT message is sent by the AMF to the UE to indicate the rejection of the relay key request. See table\u00a08.2.36.1.\nMessage type:\tRELAY KEY REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.2.36.1: RELAY KEY REJECT message content\n\n8.2.36.2\tEAP message\nEAP message IE is included if the RELAY KEY REJECT message is used to convey EAP-failure message.\n8.2.37\tRelay authentication request\n8.2.37.1\tMessage definition\nThe RELAY AUTHENTICATION REQUEST message is sent by the network to the UE to initiate authentication of the 5G ProSe remote UE or the 5G ProSe end UE as specified in 3GPP\u00a0TS\u00a033.503\u00a0[56]. See table\u00a08.2.37.1.\nMessage type:\tRELAY AUTHENTICATION REQUEST\nSignificance:\tdual\nDirection:\tNetwork to UE\nTable\u00a08.2.37.1: RELAY AUTHENTICATION REQUEST message content\n\n8.2.38\tRelay authentication response\n8.2.38.1\tMessage definition\nThe RELAY AUTHENTICATION RESPONSE message is sent by the UE to the network to forward the authentication response from the 5G ProSe remote UE or the 5G ProSe end UE as specified in 3GPP\u00a0TS\u00a033.503\u00a0[56]. See table\u00a08.2.38.1.\nMessage type:\tRELAY AUTHENTICATION RESPONSE\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.2.38.1: RELAY AUTHENTICATION RESPONSE message content\n\n8.3\t5GS session management messages\n8.3.1\tPDU session establishment request\n8.3.1.1\tMessage definition\nThe PDU SESSION ESTABLISHMENT REQUEST message is sent by the UE to the SMF to initiate establishment of a PDU session. See table\u00a08.3.1.1.1.\nMessage type:\tPDU SESSION ESTABLISHMENT REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.3.1.1.1: PDU SESSION ESTABLISHMENT REQUEST message content\n\n8.3.1.2\tPDU session type\nThis IE shall be included in the message when the UE requests to establish a new PDU session.\n8.3.1.3\tSSC mode\nThis IE is included in the message when the UE requests to establish a new PDU session with a DN and requests an SSC mode.\n8.3.1.4\tMaximum number of supported packet filters\nThis IE shall be included in the message when the selected PDU session type is \"IPv4\", \"IPv6\", \"IPv4v6\" or \"Ethernet\" and the UE can support more than 16 packet filters for this PDU session.\n8.3.1.5\t5GSM capability\nThis IE is included in the message when the UE requests to establish a new PDU session or to transfer an existing PDN connection and any of the 5GSM capabilities supported by the UE is relevant for the PDU session.\n8.3.1.6\tVoid\n8.3.1.7\tAlways-on PDU session requested\nThe UE shall include this IE if the UE requests to establish a PDU session as an always-on PDU session.\n8.3.1.8\tSM PDU DN request container\nThis IE is included in the message when the UE requests to establish a new PDU session with a DN and needs to provide information for the PDU session authentication and authorization by the external DN.\n8.3.1.9\tExtended protocol configuration options\nThis IE is included in the message when the UE needs to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network.\n8.3.1.10\tIP header compression configuration\nThe UE shall include the IP header compression configuration IE if:\n-\tthe PDU session type value of the PDU session type IE is set to \"IPv4\", \"IPv6\" or \"IPv4v6\";\n-\tthe UE indicates \"Control Plane CIoT 5GS optimization supported\" and \"IP header compression for control plane CIoT 5GS optimization supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message; and\n-\tthe network indicates \"Control plane CIoT 5GS optimization supported\" and \"IP header compression for control plane CIoT 5GS optimization supported\" in the 5GS network support feature IE of the REGISTRATION ACCEPT message.\n8.3.1.11\tDS-TT Ethernet port MAC address\nThis IE shall be included in the message if the UE supports transfer of port management information containers and the UE requests to establish a new PDU session of \"Ethernet\" PDU session type.\n8.3.1.12\tUE-DS-TT residence time\nThis IE shall be included in the message if:\na)\tthe UE supports transfer of port management information containers; and\nb)\tthe UE-DS-TT residence time is available at the UE.\n8.3.1.13\tPort management information container\nThis IE shall be included in the message if the UE supports transfer of port management information containers.\n8.3.1.14\tEthernet header compression configuration\nThe UE shall include the Ethernet header compression configuration IE if:\n-\tthe PDU session type value of the PDU session type IE is set to \"Ethernet\";\n-\tthe UE indicated \"Control Plane CIoT 5GS optimization supported\" and \"Ethernet header compression for control plane CIoT 5GS optimization supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message; and\n-\tthe network indicated \"Control plane CIoT 5GS optimization supported\" and \"Ethernet header compression for control plane CIoT 5GS optimization supported\" in the 5GS network support feature IE of the REGISTRATION ACCEPT message.\n8.3.1.15\tSuggested interface identifier\nThis IE may be included by the W-AGF acting on behalf of the FN-RG.\n8.3.1.16\tService-level-AA container\nThis IE shall be included in the message when the UE needs to establish a PDU session for the UAS services.\n8.3.1.17\tRequested MBS container\nThis IE is included in the message when the UE requests to join one or more multicast MBS sessions that are associated with the PDU session.\n8.3.1.18\tPDU session pair ID\nThis IE shall be included in the message when the UE needs to include a PDU session pair ID.\n8.3.1.19\tRSN\nThis IE shall be included in the message when the UE needs to include an RSN.\n8.3.1.20\tURSP rule enforcement reports\nThis IE is included in the message when the UE sends one or more URSP rule enforcement reports to the network.\n8.3.2\tPDU session establishment accept\n8.3.2.1\tMessage definition\nThe PDU SESSION ESTABLISHMENT ACCEPT message is sent by the SMF to the UE in response to PDU SESSION ESTABLISHMENT REQUEST message and indicates successful establishment of a PDU session. See table\u00a08.3.2.1.1.\nMessage type:\tPDU SESSION ESTABLISHMENT ACCEPT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.3.2.1.1: PDU SESSION ESTABLISHMENT ACCEPT message content\n\n8.3.2.2\t5GSM cause\nThis IE is included when the selected PDU session type is different from the PDU session type requested by the UE.\n8.3.2.3\tPDU address\nThis IE is included when the selected PDU session type is \"IPv4\", \"IPv6\" or \"IPv4v6\".\n8.3.2.4\tRQ timer value\nThis IE is included when the network needs to provide the RQ timer value.\n8.3.2.5\tS-NSSAI\nThis IE shall be included in the message when the SMF received from the AMF an S-NSSAI together with the PDU SESSION ESTABLISHMENT REQUEST message, the PDU session is a non-emergency PDU session and the UE is not registered for onboarding services in SNPN.\n8.3.2.6\tAlways-on PDU session indication\nThe network shall include this IE if the network decides to inform the UE whether the PDU session is established as an always-on PDU session.\n8.3.2.7\tMapped EPS bearer contexts\nThis IE is included when interworking with EPS is supported for the PDU session.\n8.3.2.8\tEAP message\nThis IE is included when the external DN successfully performed authentication and authorization of the UE using EAP.\n8.3.2.9\tAuthorized QoS flow descriptions\nThis IE is included when the network needs to provide authorized QoS flow descriptions.\n8.3.2.10\tExtended protocol configuration options\nThis IE is included in the message when the network needs to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE.\n8.3.2.11\tDNN\nThe IE shall be included in the message when the PDU session is a non-emergency PDU session and the UE is not registered for onboarding services in SNPN.\n8.3.2.12\t5GSM network feature support\nThis IE is included when the network needs to indicate support of 5GSM network features.\n8.3.2.13\tVoid\n8.3.2.14\tServing PLMN rate control\nThis IE shall be included when the network needs to indicate the maximum uplink control plane user data the UE is allowed to send per 6 minute interval.\n8.3.2.15\tATSSS container\nThe IE shall be included in the message when the PDU session is an MA PDU session.\n8.3.2.16\tControl plane only indication\nThe network shall include the control plane only indication IE if the network determines that the associated PDU session is only for control plane CIoT 5GS optimization.\n8.3.2.17\tIP header compression configuration\nThe SMF may include the IP header compression configuration IE if:\n-\tthe network accepts an IP PDU session type;\n-\tcontrol plane CIoT 5GS optimization is selected; and\n-\tthe UE provided the IP header compression configuration IE in the PDU SESSION ESTABLISHMENT REQUEST message.\n8.3.2.18\tEthernet header compression configuration\nThe SMF may include the Ethernet header compression configuration IE if:\n-\tthe network accepts an Ethernet PDU session type;\n-\tcontrol plane CIoT 5GS optimization is selected; and\n-\tthe UE provided the Ethernet header compression configuration IE in the PDU SESSION ESTABLISHMENT REQUEST message.\n8.3.2.19\tService-level-AA container\nThe SMF shall include the Service-level-AA container IE if the service-level authentication and authorization procedure is completed successfully by the external DN.\n8.3.2.20\tReceived MBS container\nThe network shall include this IE if the UE has requested to join one or more multicast MBS sessions.\n8.3.2.21\tN3QAI\nThis IE is included when the network needs to provide the N3QAI to the UE.\n8.3.2.22\tProtocol description\nThis IE is included when the network needs to indicate the protocol description to the UE.\n8.3.3\tPDU session establishment reject\n8.3.3.1\tMessage definition\nThe PDU SESSION ESTABLISHMENT REJECT message is sent by the SMF to the UE in response to PDU SESSION ESTABLISHMENT REQUEST message and indicates unsuccessful establishment of a PDU session. See table\u00a08.3.3.1.1.\nMessage type:\tPDU SESSION ESTABLISHMENT REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.3.3.1.1: PDU SESSION ESTABLISHMENT REJECT message content\n\n8.3.3.2\tBack-off timer value\nThe network may include this IE if the 5GSM cause is not #28 \"unknown PDU session type\", #39 \"reactivation requested\", #46 \"out of LADN service area\", #50 \"PDU session type IPv4 only allowed\", #51 \"PDU session type IPv6 only allowed\", #54 \"PDU session does not exist\", #57 \"PDU session type IPv4v6 only allowed\", #58 \"PDU session type Unstructured only allowed\", #61 \"PDU session type Ethernet only allowed\", or #68 \"not supported SSC mode\", to request a minimum time interval before procedure retry is allowed.\n8.3.3.3\tAllowed SSC mode\nThis IE is included when the network rejects the PDU SESSION ESTABLISHMENT REQUEST with cause #68 \"not supported SSC mode.\n8.3.3.4\tEAP message\nThis IE is included when the external DN unsuccessfully performed authentication and authorization of the UE using EAP.\n8.3.3.4A\t5GSM congestion re-attempt indicator\nThe network may include this IE only if it includes the Back-off timer value IE and the 5GSM cause value is either #67 \"insufficient resources for specific slice and DNN\" or #69 \"insufficient resources for specific slice\".\n8.3.3.5\tExtended protocol configuration options\nThis IE is included in the message when the network needs to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE.\n8.3.3.6\tRe-attempt indicator\nThe network may include this IE if the network includes the Back-off timer value IE and the 5GSM cause value is not #26 \"insufficient resources\", #28 \"unknown PDU session type\", #39 \"reactivation requested\", #46 \"out of LADN service area\", #54 \"PDU session does not exist\", #67 \"insufficient resources for specific slice and DNN\", #68 \"not supported SSC mode\", or #69 \"insufficient resources for specific slice\".\n8.3.3.7\tService-level-AA container\nThe network shall include this IE if the service-level authentication and authorization procedure has completed unsuccessfully and the 5GSM cause is #29 \"user authentication or authorization failed\". The network shall include the service-level-AA response if provided by the DN in the service-level-AA container.\n8.3.4\tPDU session authentication command\n8.3.4.1\tMessage definition\nThe PDU SESSION AUTHENTICATION COMMAND message is sent by the SMF to the UE for authentication of the UE establishing the PDU session or of the UE participating in the PDU session. See table\u00a08.3.4.1.1.\nMessage type:\tPDU SESSION AUTHENTICATION COMMAND\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.3.4.1.1: PDU SESSION AUTHENTICATION COMMAND message content\n\n8.3.4.2\tExtended protocol configuration options\nThis IE is included in the message when the network needs to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE.\nNOTE:\tHow the Extended protocol configuration options IE is used by the network and the UE during the PDU session authentication and authorization procedure is not specified in this release of the specification.\n8.3.4.3\tVoid\n8.3.5\tPDU session authentication complete\n8.3.5.1\tMessage definition\nThe PDU SESSION AUTHENTICATION COMPLETE message is sent by the UE to the SMF in response to the PDU SESSION AUTHENTICATION COMMAND message and indicates acceptance of the PDU SESSION AUTHENTICATION COMMAND message. See table\u00a08.3.5.1.1.\nMessage type:\tPDU SESSION AUTHENTICATION COMPLETE\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.3.5.1.1: PDU SESSION AUTHENTICATION COMPLETE message content\n\n8.3.5.2\tExtended protocol configuration options\nThis IE is included in the message when the UE needs to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network.\nNOTE:\tHow the Extended protocol configuration options IE is used by the network and the UE during the PDU session authentication and authorization procedure is not specified in this release of the specification.\n8.3.5.3\tVoid\n8.3.6\tPDU session authentication result\n8.3.6.1\tMessage definition\nThe PDU SESSION AUTHENTICATION RESULT message is sent by the SMF to the UE for indication of successful result of authentication of the UE participating in the PDU session. See table\u00a08.3.6.1.1.\nMessage type:\tPDU SESSION AUTHENTICATION RESULT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.3.6.1.1: PDU SESSION AUTHENTICATION RESULT message content\n\n8.3.6.2\tEAP message\nThis IE shall be included when the external DN performs authentication and authorization of the UE using EAP and it completes successfully.\n8.3.6.3\tExtended protocol configuration options\nThis IE is included in the message when the network needs to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE.\nNOTE:\tHow the Extended protocol configuration options IE is used by the network and the UE during the PDU session authentication and authorization procedure is not specified in this release of the specification.\n8.3.7\tPDU session modification request\n8.3.7.1\tMessage definition\nThe PDU SESSION MODIFICATION REQUEST message is sent by the UE to the SMF to request a modification of a PDU session. See table\u00a08.3.7.1.1.\nMessage type:\tPDU SESSION MODIFICATION REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.3.7.1.1: PDU SESSION MODIFICATION REQUEST message content\n\nNOTE:\tIt is possible for UEs compliant with version 15.2.1 or earlier versions of this specification to send the Mapped EPS bearer contexts IE with IEI of value \"7F\" for this message.\n8.3.7.2\t5GSM capability\nThis IE is included in the message:\n1)\tfor a PDN connection established when in S1 mode, after an inter-system change from S1 mode to N1 mode, if the UE is a UE operating in single-registration mode in a network supporting N26 interface, the UE has not previously successfully performed the UE-requested PDU session modification to provide this capability, and:\na)\tif the PDU session is of \"IPv4\", \"IPv6\", \"IPv4v6\" or \"Ethernet\" PDU session type, and the UE supports reflective QoS; or\nb)\tif the PDU session is of \"IPv6\" or \"IPv4v6\" PDU session type, and the UE supports multi-homed IPv6 PDU session; or\n2)\tif the UE needs to revoke the previously indicated support of reflective QoS.\n8.3.7.3\t5GSM cause\nThis IE is included in the message to indicate the reason for the deletion of one or more non-default QoS rules, QoS flow descriptions or mapped EPS bearer contexts.\n8.3.7.4\tMaximum number of supported packet filters\nThis IE shall be included in the message for a PDN connection established when in S1 mode, after an inter-system change from S1 mode to N1 mode, if the UE is a UE operating in single-registration mode in a network supporting N26 interface, the UE has not previously successfully performed the UE-requested PDU session modification to provide this capability, the PDU session type is \"IPv4\", \"IPv6\", \"IPv4v6\" or \"Ethernet\", and the UE can support more than 16 packet filters for this PDU session.\n8.3.7.5\tAlways-on PDU session requested\nThis IE shall be included in the message for a PDN connection established when in S1 mode, after an inter-system change from S1 mode to N1 mode, if the UE is a UE operating in single-registration mode in a network supporting N26 interface, the UE has not previously successfully performed the UE-requested PDU session modification to provide this capability, and the UE requests the PDU session to be an always-on PDU session in the 5GS.\n8.3.7.6\tIntegrity protection maximum data rate\nThis IE shall be included in the message for a PDN connection established when in S1 mode, after an inter-system change from S1 mode to N1 mode, if the UE is a UE operating in single-registration mode in a network supporting N26 interface, and the UE has not previously successfully performed the UE-requested PDU session modification to provide this capability.\n8.3.7.7\tRequested QoS rules\nThis IE is included in the message when the UE requests a specific QoS handling.\n8.3.7.8\tRequested QoS flow descriptions\nThis IE is included in the message when the UE requests a specific QoS flow descriptions.\n8.3.7.9\tExtended protocol configuration options\nThis IE is included in the message when the UE needs to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network.\n8.3.7.10\tMapped EPS bearer contexts\nThis IE is included when the UE requests to delete one or more mapped EPS bearer contexts.\n8.3.7.11\tPort management information container\nThis IE shall be included when the UE needs to convey a port management information container.\n8.3.7.12\tIP header compression configuration\nThis IE is included in the message:\na)\tif the UE wishes to re-negotiate IP header compression configuration associated to a PDU session and both the UE and the network supports Control plane CIoT 5GS optimization and IP header compression; or\nb)\tto negotiate IP header compression configuration associated to a PDU session after an inter-system change from S1 mode to N1 mode when both the UE and the network support control plane CIoT 5GS optimization and IP header compression, and the UE is operating in single-registration mode in the network supporting N26 interface.\n8.3.7.13\tEthernet header compression configuration\nThis IE is included in the message:\na)\tif the UE wishes to re-negotiate Ethernet header compression configuration associated to a PDU session and both the UE and the network support Control plane CIoT 5GS optimization and Ethernet header compression; or\nb)\tto negotiate Ethernet header compression configuration associated to a PDU session after an inter-system change from S1 mode to N1 mode.\n8.3.7.14\tRequested MBS container\nThis IE is included in the message when the UE requests to join or leave one or more multicast MBS sessions that are associated with the PDU session.\n8.3.7.15\tService-level-AA container\nThis IE shall be included in the message when the UE needs to modify an established PDU session for C2 communication.\n8.3.7.16\tNon-3GPP delay budget\nThis IE is included in the message when the UE requests a specific QoS handling for the PDU session established for PIN.\n8.3.7.17\tURSP rule enforcement reports\nThis IE is included in the message when the UE sends one or more URSP rule enforcement reports to the network.\n8.3.8\tPDU session modification reject\n8.3.8.1\tMessage definition\nThe PDU SESSION MODIFICATION REJECT message is sent by the SMF to the UE to indicate rejection of the PDU SESSION MODIFICATION REQUEST. See table\u00a08.3.8.1.1.\nMessage type:\tPDU SESSION MODIFICATION REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.3.8.1.1: PDU SESSION MODIFICATION REJECT message content\n\n8.3.8.2\tBack-off timer value\nThe network may include this IE if the 5GSM cause is not #26 \"insufficient resources\", #37 \"5GS QoS not accepted\", #44 \"Semantic errors in packet filter(s)\", #45 \"Syntactical error in packet filter(s)\", #46 \"out of LADN service area\", #59 \"unsupported 5QI value\", #67 \"insufficient resources for specific slice and DNN\", #69 \"insufficient resources for specific slice\", #83 \"Semantic error in the QoS operation\", or #84 \"Syntactical error in the QoS operation\" to request a minimum time interval before procedure retry is allowed.\n8.3.8.2A\t5GSM congestion re-attempt indicator\nThe network may include this IE only if it includes the Back-off timer value IE and the 5GSM cause value is either #67 \"insufficient resources for specific slice and DNN\" or #69 \"insufficient resources for specific slice\".\n8.3.8.3\tExtended protocol configuration options\nThis IE is included in the message when the network needs to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE.\n8.3.8.4\tRe-attempt indicator\nThe network may include this IE only if it includes the Back-off timer value IE and the 5GSM cause value is not #26 \"insufficient resources\", #37 \"5GS QoS not accepted\", #44 \"Semantic errors in packet filter(s)\", #45 \"Syntactical error in packet filter(s)\", #46 \"out of LADN service area\", #59 \"unsupported 5QI value\", #67 \"insufficient resources for specific slice and DNN\", #69 \"insufficient resources for specific slice\", #83 \"Semantic error in the QoS operation\", or #84 \"Syntactical error in the QoS operation\".\n8.3.9\tPDU session modification command\n8.3.9.1\tMessage definition\nThe PDU SESSION MODIFICATION COMMAND message is sent by the SMF to the UE to indicate a modification of a PDU session. See table\u00a08.3.9.1.1.\nMessage type:\tPDU SESSION MODIFICATION COMMAND\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.3.9.1.1: PDU SESSION MODIFICATION COMMAND message content\n\nNOTE:\tIt is possible for networks compliant with version 15.2.1 or earlier versions of this specification to send the Mapped EPS bearer contexts IE with IEI of value \"7F\" for this message.\n8.3.9.2\t5GSM cause\nThis IE is included when the network performs the PDU session anchor relocation for SSC mode 3.\n8.3.9.3\tSession-AMBR\nThis IE is included when the session-AMBR of the PDU session is modified.\n8.3.9.4\tRQ timer value\nThis IE is included when the network needs to provide the RQ timer value.\n8.3.9.5\tAlways-on PDU session indication\nThe network shall include this IE if the network decides to inform the UE whether the PDU session is an always-on PDU session.\n8.3.9.6\tAuthorized QoS rules\nThis IE is included when the authorized QoS rules of the PDU session are modified.\n8.3.9.7\tMapped EPS bearer contexts\nThis IE is included when interworking with EPS is supported for the PDU session and the mapped EPS bearer contexts is modified.\n8.3.9.8\tAuthorized QoS flow descriptions\nThis IE is included when the authorized QoS flow descriptions of the PDU session are modified.\n8.3.9.9\tExtended protocol configuration options\nThis IE is included in the message when the network needs to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE.\n8.3.9.10\tVoid\n8.3.9.11\tATSSS container\nThe IE is included in the message when the network needs to indicate that the ATSSS parameters of the MA PDU session are modified.\n8.3.9.12\tIP header compression configuration\nThis IE is included in the message if the network wishes to re-negotiate IP header compression configuration associated to a PDU session and both the UE and the network support Control plane CIoT 5GS optimization and IP header compression.\n8.3.9.13\tPort management information container\nThis IE shall be included when the network needs to convey a port management information container.\n8.3.9.14\tServing PLMN rate control\nThis IE shall be included when the network needs to indicate the maximum uplink control plane user data the UE is allowed to send per 6 minute interval.\n8.3.9.15\tEthernet header compression configuration\nThis IE is included in the message if the network wishes to re-negotiate Ethernet header compression configuration associated to a PDU session and both the UE and the network support Control plane CIoT 5GS optimization and Ethernet header compression.\n8.3.9.16\tReceived MBS container\nThe network shall include this IE if:\n-\tthe UE has requested to join or leave one or more multicast MBS sessions;\n-\tthe network wants to remove joined UE from one or more multicast MBS sessions; or\n-\tthe network wants to update the MBS service area of multicast MBS session that the UE has joined; or\n-\tthe network wants to update the MBS security information of multicast MBS session that the UE has joined.\n8.3.9.17\tService-level-AA container\nThe SMF shall include the service-level-AA container IE if the service-level authentication and authorization procedure for re-authentication purpose is completed successfully by the external DN.\n8.3.9.18\tAlternative S-NSSAI\nThis IE shall be included when the network needs to provide the alternative S-NSSAI to replace the S-NSSAI of the SSC mode 1 or SSC mode 3 PDU session.\n8.3.9.19\tN3QAI\nThis IE is included when the network needs to provide the N3QAI to the UE.\n8.3.9.20\tProtocol description\nThis IE is included when the network needs to provide the protocol description for UL PDU set handling to the UE.\n8.3.10\tPDU session modification complete\n8.3.10.1\tMessage definition\nThe PDU SESSION MODIFICATION COMPLETE message is sent by the UE to the SMF in response to the PDU SESSION MODIFICATION COMMAND message and indicates an acceptance of the PDU SESSION MODIFICATION COMMAND message. See table\u00a08.3.10.1.1.\nMessage type:\tPDU SESSION MODIFICATION COMPLETE\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.3.10.1.1: PDU SESSION MODIFICATION COMPLETE message content\nNOTE:\tIt is possible for UEs compliant with version 15.3.0 of this specification to include the 5GSM cause IE with IEI 59 in the PDU SESSION MODIFICATION COMPLETE message, and therefore the IEI 59 cannot be used for other optional IEs other than the 5GSM cause IE for future extensions of the PDU SESSION MODIFICATION COMPLETE message.\n8.3.10.2\tExtended protocol configuration options\nThis IE is included in the message when the UE needs to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network.\n8.3.10.3\tPort management information container\nThis IE shall be included when the UE needs to convey a port management information container.\n8.3.11\tPDU session modification command reject\n8.3.11.1\tMessage definition\nThe PDU SESSION MODIFICATION COMMAND REJECT message is sent by the UE to the SMF to indicate rejection of the PDU SESSION MODIFICATION COMMAND message. See table\u00a08.3.11.1.1.\nMessage type:\tPDU SESSION MODIFICATION COMMAND REJECT\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.3.11.1.1: PDU SESSION MODIFICATION COMMAND REJECT message content\n\n8.3.11.2\tExtended protocol configuration options\nThis IE is included in the message when the UE needs to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network.\n8.3.12\tPDU session release request\n8.3.12.1\tMessage definition\nThe PDU SESSION RELEASE REQUEST message is sent by the UE to the SMF to request a release of a PDU session. See table\u00a08.3.12.1.1.\nMessage type:\tPDU SESSION RELEASE REQUEST\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.3.12.1.1: PDU SESSION RELEASE REQUEST message content\n\n8.3.12.2\t5GSM cause\nThis IE is included in the message to indicate the reason for releasing the PDU session.\n8.3.12.3\tExtended protocol configuration options\nThis IE is included in the message when the UE needs to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network.\n8.3.13\tPDU session release reject\n8.3.13.1\tMessage definition\nThe PDU SESSION RELEASE REJECT message is sent by the SMF to the UE to indicate rejection of request a release of a PDU session. See table\u00a08.3.13.1.1.\nMessage type:\tPDU SESSION RELEASE REJECT\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.3.13.1.1: PDU SESSION RELEASE REJECT message content\n\n8.3.13.2\tExtended protocol configuration options\nThis IE is included in the message when the network needs to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE.\n8.3.14\tPDU session release command\n8.3.14.1\tMessage definition\nThe PDU SESSION RELEASE COMMAND message is sent by the SMF to the UE to indicate a release of a PDU session. See table\u00a08.3.14.1.1.\nMessage type:\tPDU SESSION RELEASE COMMAND\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.3.14.1.1: PDU SESSION RELEASE COMMAND message content\n\n8.3.14.2\tBack-off timer value\nThe network may include this IE to request a minimum time interval before procedure retry is allowed.\n8.3.14.3\tEAP message\nThis IE is included when the external DN performs re-authentication and re-authorization of the UE using EAP and it completes unsuccessfully.\n8.3.14.4\tExtended protocol configuration options\nThis IE is included in the message when the network wants to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE.\n8.3.14.5\t5GSM congestion re-attempt indicator\nThe network may include this IE only if it includes the Back-off timer value IE and the 5GSM cause value is either #67 \"insufficient resources for specific slice and DNN\" or #69 \"insufficient resources for specific slice\".\n8.3.14.6\tAccess type\nThis IE is included in the message when the network releases user-plane reources of an MA PDU session specifically over either 3GPP access or non-3GPP access.\n8.3.14.7\tService-level-AA container\nThe SMF shall include the service-level-AA container IE if the service-level authentication and authorization procedure for re-authentication purpose is completed unsuccessfully by the external DN.\n8.3.14.8\tAlternative S-NSSAI\nThis IE shall be included when the network needs to trigger the re-establishment of the PDU Session with the alternative S-NSSAI in SSC mode 2 or SSC mode 1.\n8.3.15\tPDU session release complete\n8.3.15.1\tMessage definition\nThe PDU SESSION RELEASE COMPLETE message is sent by the UE to the SMF in response to the PDU SESSION RELEASE COMMAND message and indicates an acceptance of a release of the PDU session. See table\u00a08.3.15.1.1.\nMessage type:\tPDU SESSION RELEASE COMPLETE\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.3.15.1.1: PDU SESSION RELEASE COMPLETE message content\n\n8.3.15.2\t5GSM cause\nThis IE is included in the message when the UE needs to indicate to the network that an error encountered with a mandatory information element in the PDU SESSION RELEASE COMMAND message.\n8.3.15.3\tExtended protocol configuration options\nThis IE is included in the message when the UE needs to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network.\n8.3.16\t5GSM status\n8.3.16.1\tMessage definition\nThe 5GSM STATUS message is sent by the SMF or the UE to pass information on the status of the indicated PDU session and report certain error conditions. See table\u00a08.3.16.1.1.\nMessage type:\t5GSM STATUS\nSignificance:\tdual\nDirection:\tboth\nTable\u00a08.3.16.1.1: 5GSM STATUS message content\n\n8.3.17\tService-level authentication command\n8.3.17.1\tMessage definition\nThe SERVICE-LEVEL AUTHENTICATION COMMAND message is sent by the SMF to the UE for service-level authentication and authorization procedure. See table\u00a08.3.17.1.1.\nMessage type:\tSERVICE-LEVEL AUTHENTICATION COMMAND\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.3.17.1.1: SERVICE-LEVEL AUTHENTICATION COMMAND message content\n\n8.3.18\tService-level authentication complete\n8.3.18.1\tMessage definition\nThe SERVICE-LEVEL AUTHENTICATION COMPLETE message is sent by the UE to the SMF in response to the SERVICE-LEVEL AUTHENTICATION COMMAND message and indicates acceptance of the SERVICE-LEVEL AUTHENTICATION COMMAND message. See table\u00a08.3.18.1.1.\nMessage type:\tSERVICE-LEVEL AUTHENTICATION COMPLETE\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.3.18.1.1: SERVICE-LEVEL AUTHENTICATION COMPLETE message content\n\n8.3.19\tRemote UE report\n8.3.19.1\tMessage definition\nThe REMOTE UE REPORT message is sent by the UE to the network to report connection or disconnection of 5G ProSe remote UE(s). See table\u00a08.3.19.1.\nMessage type:\tREMOTE UE REPORT\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a08.3.19.1: REMOTE UE REPORT message content\n\n8.3.19.2\tRemote UE context connected\nThis IE is included in the message by the UE acting as a 5G ProSe layer-3 UE-to-network UE relay to provide the network with newly connected 5G ProSe remote UE information as specified in 3GPP\u00a0TS\u00a023.304\u00a0[6E].\n8.3.19.3\tRemote UE context disconnected\nThis IE is included in the message by the UE acting as a 5G ProSe layer-3 UE-to-network UE relay to provide the network with disconnected 5G ProSe remote UE information as specified in 3GPP\u00a0TS\u00a023.304\u00a0[6E].\n8.3.20\tRemote UE report response\n8.3.20.1\tMessage definition\nThe REMOTE UE REPORT RESPONSE message is sent by the network to the UE to acknowledge receipt of a remote UE report message. See table\u00a08.3.20.1.\nMessage type:\tREMOTE UE REPORT RESPONSE\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a08.3.20.1: REMOTE UE REPORT RESPONSE message content\n\n8.3.20.2\tVoid\n8.3.20.3\tVoid\n8.3.20.4\tVoid\n9\tGeneral message format and information elements coding\n9.1\tOverview\n9.1.1\tNAS message format\nWithin the protocols defined in the present document, every 5GS NAS message is a standard L3 message as defined in 3GPP\u00a0TS\u00a024.007\u00a0[11]. This means that the message consists of the following parts:\n1)\tif the message is a plain 5GS NAS message:\na)\textended protocol discriminator;\nb)\tsecurity header type associated with a half spare octet or PDU session identity;\nc)\tprocedure transaction identity;\nd)\tmessage type;\ne)\tother information elements, as required.\n2)\tif the message is a security protected 5GS NAS message:\na)\textended protocol discriminator;\nb)\tsecurity header type associated with a half spare octet;\nc)\tmessage authentication code;\nd)\tsequence number;\ne)\tplain 5GS NAS message, as defined in item\u00a01\nThe organization of a plain 5GS NAS message is illustrated in the example shown in figure\u00a09.1.1.1.\n\nFigure\u00a09.1.1.1: General message organization example for a plain 5GS NAS message\nThe PDU session identity and the procedure transaction identity are only used in messages with extended protocol discriminator 5GS session management. Octet 2a with the procedure transaction identity shall only be included in these messages.\nThe organization of a security protected 5GS NAS message is illustrated in the example shown in figure\u00a09.1.1.2.\n\nFigure\u00a09.1.1.2: General message organization example for a security protected 5GS NAS message\nUnless specified otherwise in the message descriptions of clause\u00a08 and annex\u00a0D, a particular information element shall not be present more than once in a given message.\n9.1.2\tField format and mapping\nWhen a field is contained within a single octet, the lowest numbered bit of the field represents the least significant bit.\nWhen a field extends over more than one octet, the order of bit values progressively decreases as the octet number increases. In that part of the field contained in a given octet, the lowest numbered bit represents the least significant bit. The most significant bit of the field is represented by the highest numbered bit of the lowest numbered octet of the field. The least significant bit of the field is represented by the lowest numbered bit of the highest numbered octet of the field.\nFor example, a bit number can be identified as a couple (o,\u00a0b) where o is the octet number and b is the relative bit number within the octet. Figure\u00a09.1.2.1 illustrates a field that spans from bit (1,\u00a03) to bit (2,\u00a07). The most significant bit of the field is mapped on bit (1,\u00a03) and the least significant bit is mapped on bit (2,\u00a07).\nFigure\u00a09.1.2.1: Field mapping convention\n9.2\tExtended protocol discriminator\nBits 1 to 8 of the first octet of every 5GS NAS message contain the Extended protocol discriminator (EPD) IE. The EPD and its use are defined in 3GPP\u00a0TS\u00a024.007\u00a0[11]. The extended protocol discriminator in the header (see 3GPP\u00a0TS\u00a024.007\u00a0[11]) of a security protected 5GS NAS message is encoded as \"5GS mobility management messages\".\n9.3\tSecurity header type\nBits 1 to 4 of the second octet of every 5GMM message contain the Security header type IE. This IE includes control information related to the security protection of a 5GMM message. The total size of the Security header type IE is 4 bits.\nThe Security header type IE can take the values shown in table\u00a09.3.1.\nTable\u00a09.3.1: Security header type\n\nA 5GMM message received with the security header type encoded as 0000 shall be treated as not security protected, plain 5GS NAS message. A protocol entity sending a not security protected 5GMM message shall send the message as plain 5GS NAS message and encode the security header type as 0000.\n9.4\tPDU session identity\nBits 1 to 8 of the second octet of every 5GSM message contain the PDU session identity IE. The PDU session identity and its use to identify a message flow are defined in 3GPP\u00a0TS\u00a024.007\u00a0[11].\n9.5\tSpare half octet\nThis element is used in the description of 5GMM and 5GSM messages when an odd number of half octet type 1 information elements are used. This element is filled with spare bits set to zero and is placed in bits 5 to 8 of the octet unless otherwise specified.\n9.6\tProcedure transaction identity\nBits 1 to 8 of the third octet of every 5GSM message contain the procedure transaction identity. Bits 1 to 8 of the first octet of every UE policy delivery message contain the procedure transaction identity. The procedure transaction identity and its use are defined in 3GPP\u00a0TS\u00a024.007\u00a0[11].\n9.7\tMessage type\nThe Message type IE and its use are defined in 3GPP\u00a0TS\u00a024.007\u00a0[11]. Tables\u00a09.7.1 and 9.7.2 define the value part of the message type IE used in the 5GS mobility management protocol and 5GS session management protocol.\nTable\u00a09.7.1: Message types for 5GS mobility management\n\nTable\u00a09.7.2: Message types for 5GS session management\n\n9.8\tMessage authentication code\nThe message authentication code (MAC) information element contains the integrity protection information for the message. The MAC IE shall be included in the SECURITY PROTECTED 5GS NAS MESSAGE message if a valid 5G NAS security context exists and security functions are started.\nThe message authentication code (MAC) is also included in the Intra N1 mode NAS transparent container IE and in the S1 mode to N1 mode NAS transparent container IE.\nThe usage of MAC is specified in subclause\u00a04.4.3.3.\n9.9\tPlain 5GS NAS message\nThis IE includes a complete plain 5GS NAS message as specified in subclauses\u00a08.2 and 8.3. The SECURITY PROTECTED 5GS NAS MESSAGE (see subclause\u00a08.2.28) includes a complete plain 5GS NAS message as specified in subclauses\u00a08.2. The SECURITY PROTECTED 5GS NAS MESSAGE message (see subclause\u00a08.2.28) is not plain 5GS NAS messages and shall not be included in this IE.\n9.10\tSequence number\nThis IE includes the NAS message sequence number (SN) which consists of the eight least significant bits of the NAS COUNT for a SECURITY PROTECTED 5GS NAS MESSAGE message.\nThe NAS message sequence number (SN) with the eight least significant bits of the NAS COUNT is also included in the Intra N1 mode NAS transparent container IE and in the N1 mode to S1 mode NAS transparent container IE.\nThe usage of SN is specified in subclause\u00a04.4.3.\n9.11\tOther information elements\n9.11.1\tGeneral\nThe different formats (V, LV, T, TV, TLV, LV-E, TLV-E) and the five categories of information elements (type 1, 2, 3, 4 and 6) are defined in 3GPP\u00a0TS\u00a024.007\u00a0[11].\nThe first octet of an information element in the non-imperative part contains the IEI of the information element. If this octet does not correspond to an IEI known in the message, the receiver shall determine whether this IE is of type 1 or 2 (i.e. it is an information element of one octet length) or an IE of type 4 or 6 (i.e. that the next octet is the length indicator or, for a type 6 IE, the next 2 octets are the length indicator indicating the length of the remaining of the information element) (see 3GPP\u00a0TS\u00a024.007\u00a0[11]).\nNOTE:\tThis requirement for the receiver is not applicable for information elements included in a Type 6 IE container information element. Any IE in the Type 6 IE container information element is of type 6 with format TLV-E; therefore, the rules for the IEI value encoding defined in 3GPP\u00a0TS\u00a024.007\u00a0[11], subclause\u00a011.2.4, are not applicable.\nThis allows the receiver to jump over unknown information elements and to analyse any following information elements of a particular message.\nThe definitions of information elements which are:\na)\tcommon for the 5GMM and 5GSM protocols;\nb)\tused by access stratum protocols; or\nc)\tsent to upper layers\nare described in subclause\u00a09.11.2.\nThe information elements of the 5GMM or 5GSM protocols can be defined by reference to an appropriate specification which provides the definition of the information element, e.g., \"see subclause\u00a010.5.6.3A in 3GPP\u00a0TS\u00a024.008\u00a0[12]\".\n9.11.2\tCommon information elements\n9.11.2.1\tAdditional information\nThe purpose of the Additional information information element is to provide additional information to upper layers in relation to the NAS transport mechanism.\nThe Additional information information element is coded as shown in figure\u00a09.11.2.1.1 and table\u00a09.11.2.1.1.\nThe Additional information is a type 4 information element with a minimum length of 3 octets.\n\nFigure\u00a09.11.2.1.1: Additional information information element\nTable\u00a09.11.2.1.1\u00a0: Additional information information element\n\n9.11.2.1A\tAccess type\nThe purpose of the access type information element is to indicate the access type over which the signalling or user data is pending to be sent to the UE.\nThe access type is a type 1 information element.\nThe access type information element is coded as shown in figure\u00a09.11.2.1A.1 and table\u00a09.11.2.1A.1.\nFigure\u00a09.11.2.1A.1: Access type information element\nTable\u00a09.11.2.1A.1: Access type information element\n\n9.11.2.1B\tDNN\nThe purpose of the DNN information element is to identify the data network.\nThe DNN information element is coded as shown in figure\u00a09.11.2.1B.1.\nThe DNN is a type 4 information element with a minimum length of 3 octets and a maximum length of 102 octets.\nFigure\u00a09.11.2.1B.1: DNN information element\nA DNN value field contains an APN as defined in 3GPP\u00a0TS\u00a023.003\u00a0[4].\n9.11.2.2\tEAP message\nThe purpose of the EAP message information element is to transport an EAP message as specified in IETF\u00a0RFC\u00a03748\u00a0[34].\nThe EAP message information element is coded as shown in figure\u00a09.11.2.2.1 and table\u00a09.11.2.2.1.\nThe EAP message is a type 6 information element with minimum length of 7 octets and maximum length of 1503 octets.\nFigure\u00a09.11.2.2.1: EAP message information element\nTable\u00a09.11.2.2.1: EAP message information element\n\n9.11.2.3\tGPRS timer\nSee subclause\u00a010.5.7.3 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.2.4\tGPRS timer 2\nSee subclause\u00a010.5.7.4 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.2.5\tGPRS timer 3\nSee subclause\u00a010.5.7.4a in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.2.6\tIntra N1 mode NAS transparent container\nThe purpose of the Intra N1 mode NAS transparent container information element is to provide the UE with parameters that enable the UE to handle the 5G NAS security context after N1 mode to N1 mode handover.\nThe Intra N1 mode NAS transparent container information element is coded as shown in figure\u00a09.11.2.6.1 and table\u00a09.11.2.6.1.\nThe Intra N1 mode NAS transparent container is a type 4 information element with a length of 9 octets.\nThe value part of the Intra N1 mode NAS transparent container information element is included in specific information elements within some RRC messages sent to the UE.\nNOTE:\tFor these cases the coding of the information element identifier and length information of RRC is defined in 3GPP\u00a0TS\u00a038.331\u00a0[30].\nFigure\u00a09.11.2.6.1: Intra N1 mode NAS transparent container information element\nTable\u00a09.11.2.6.1: Intra N1 mode NAS transparent container information element\n\n9.11.2.7\tN1 mode to S1 mode NAS transparent container\nThe purpose of the N1 mode to S1 mode NAS transparent container information element is to provide the UE with information that enables the UE to create a mapped EPS security context.\nThe N1 mode to S1 mode NAS transparent container information element is coded as shown in figure\u00a09.11.2.7.1 and table\u00a09.11.2.7.1.\nThe N1 mode to S1 mode NAS transparent container is a type 3 information element with a length of 2 octets.\nThe value part of the N1 mode to S1 mode NAS transparent container information element is included in specific information elements within some RRC messages sent to the UE; see 3GPP\u00a0TS\u00a038.331\u00a0[30]. For these cases the coding of the information element identifier and length information is defined in 3GPP\u00a0TS\u00a038.331\u00a0[30]. \nFigure\u00a09.11.2.7.1: N1 mode to S1 mode NAS transparent container information element\nTable\u00a09.11.2.7.1: N1 mode to S1 mode NAS transparent container information element\n\n9.11.2.8\tS-NSSAI\nThe purpose of the S-NSSAI information element is to identify a network slice.\nThe S-NSSAI information element is coded as shown in figure\u00a09.11.2.8.1 and table\u00a09.11.2.8.1.\nThe S-NSSAI is a type 4 information element with a minimum length of 3 octets and a maximum length of 10 octets.\nFigure\u00a09.11.2.8.1: S-NSSAI information element\nTable\u00a09.11.2.8.1: S-NSSAI information element\n\n9.11.2.9\tS1 mode to N1 mode NAS transparent container\nThe purpose of the S1 mode to N1 mode NAS transparent container information element is to provide the UE with parameters that enable the UE to create a mapped 5G NAS security context and take this context into use after inter-system change to N1 mode in 5GMM-CONNECTED mode.\nThe S1 mode to N1 mode NAS transparent container information element is coded as shown in figure\u00a09.11.2.9.1 and table\u00a09.11.2.9.1.\nThe S1 mode to N1 mode NAS transparent container is a type 4 information element with a length of 10 octets.\nThe value part of the S1 mode to N1 mode NAS transparent container information element is included in specific information elements within some RRC messages sent to the UE.\nNOTE:\tFor these cases the coding of the information element identifier and length information of RRC is defined in 3GPP\u00a0TS\u00a038.331\u00a0[30].\n\n\nFigure\u00a09.11.2.9.1: S1 mode to N1 mode NAS transparent container information element\nTable\u00a09.11.2.9.1: S1 mode to N1 mode NAS transparent container information element\n\n9.11.2.10\tService-level-AA container\nThe purpose of the Service-level-AA container information element is to transfer upper layer information for authentication and authorization between the UE and the network.\nThe Service-level-AA container information element is coded as shown in figure\u00a09.11.2.10.1, figure\u00a09.11.2.10.2, figure\u00a09.11.2.10.3, figure\u00a09.11.2.10.4 and table\u00a09.11.2.10.1.\nThe Service-level-AA container information element is a type 6 information element with a minimum length of 4 octets and a maximum length of 65538 octets.\nFigure\u00a09.11.2.10.1: Service-level-AA container information element\n\nFigure\u00a09.11.2.10.2: Service-level-AA container contents\n\nFigure\u00a09.11.2.10.3: Service-level-AA parameter (when the type of service-level-AA parameter field contains an IEI of a type\u00a04 information element as specified in 3GPP\u00a0TS\u00a024.007\u00a0[11])\n\nFigure\u00a09.11.2.10.4: Service-level-AA parameter (when the type of service-level-AA parameter field contains an IEI of a type\u00a06 information element as specified in 3GPP\u00a0TS\u00a024.007\u00a0[11])\nFigure\u00a09.11.2.10.5: Service-level-AA parameter (when Service-level-AA payload type and its associated Service-level-AA payload are included in the Service-level-AA container contents)\n\nFigure\u00a09.11.2.10.6: Service-level-AA parameter (when the type of service-level-AA parameter field contains an IEI of a type\u00a01 information element as specified in 3GPP\u00a0TS\u00a024.007\u00a0[11])\n\nTable\u00a09.11.2.10.1: Service-level-AA container information element\n\n9.11.2.11\tService-level device ID\nThe purpose of the Service-level device ID information element is to carry the necessary identity for authentication and authorization by the external DN.\nThe Service-level device ID information element is coded as shown in figure\u00a09.11.2.11.1 and table\u00a09.11.2.11.1.\nThe Service-level device ID information element is a type 4 information element with minimum length of 3 octets and maximum length of 257 octets.\nFigure\u00a09.11.2.11.1: Service-level device ID information element\nTable\u00a09.11.2.11.1: Service-level device ID information element\n\n9.11.2.12\tService-level-AA server address\nThe purpose of the Service-level-AA server address information element is to carry the address of the service level authentication and authorization server.\nThe Service-level-AA server address information element is coded as shown in figure\u00a09.11.2.12.1 and table\u00a09.11.2.12.1.\nThe Service-level-AA server address information element is a type 4 information element with minimum length of 4 octets and maximum length of 257 octets.\nFigure\u00a09.11.2.12.1: Service-level-AA server address information element\nTable\u00a09.11.2.12.1: Service-level-AA server address information element\n\n9.11.2.13\tService-level-AA payload\nThe purpose of the Service-level-AA payload information element is to carry the upper layer payload for authentication and authorization between the UE and the service-level-AA server.\nThe Service-level-AA payload information element is coded as shown in figure\u00a09.11.2.13.1 and table\u00a09.11.2.13.1.\nThe Service-level-AA payload information element is a type 6 information element with minimum length of 4 octets and maximum length of 65538 octets.\nFigure\u00a09.11.2.13.1: Service-level-AA payload information element\nTable\u00a09.11.2.13.1: Service-level-AA payload information element\n\n9.11.2.14\tService-level-AA response\nThe purpose of the Service-level-AA response information element is to provide information regarding the service level authentication and authorization request, e.g. to indicate that the authentication and authorization request to the service level authentication server was successful, or to notify that service level authorization is revoked.\nThe Service-level-AA response information element is coded as shown in figure\u00a09.11.2.14.1 and table\u00a09.11.2.14.1.\nThe Service-level-AA response information element is a type 4 information element with length of 3 octets.\nFigure\u00a09.11.2.14.1: Service-level-AA response information element\nTable\u00a09.11.2.14.1: Service-level-AA response information element\n\n9.11.2.15\tService-level-AA payload type\nThe purpose of the Service-level-AA payload type information element is to indicates type of payload included in the Service-level-AA payload information element.\nThe Service-level-AA payload type information element is coded as shown in figure\u00a09.11.2.15.1 and table\u00a09.11.2.15.1.\nThe Service-level-AA payload type information element is a type 4 information element with length of 3 octets.\nFigure\u00a09.11.2.15.1: Service-level-AA payload type information element\nTable\u00a09.11.2.15.1: Service-level-AA payload type information element\n\n9.11.2.16\tVoid\n9.11.2.17\tService-level-AA pending indication\nThe purpose of the Service-level-AA pending indication information element is to provide an indication that the service level authentication and authorization procedure is to be performed.\nThe Service-level-AA pending indication information element is coded as shown in figure\u00a09.11.2.17.1 and table\u00a09.11.2.17.1.\nThe Service-level-AA pending indication information element is a type 1 information element.\nFigure\u00a09.11.2.17.1: Service-level-AA pending indication\nTable\u00a09.11.2.17.1: Service-level-AA pending indication\n\n9.11.2.18\tService-level-AA service status indication\nThe purpose of the Service-level-AA service status indication information element is to provide an indication of the service availability to the UE.\nThe Service-level-AA service status indication information element is coded as shown in figure\u00a09.11.2.18.1 and table\u00a09.11.2.18.1.\nThe Service-level-AA service status indication information element is a type 4 information element with a length of 3 octets.\nFigure\u00a09.11.2.18.1: Service-level-AA-service-status indication information element\nTable\u00a09.11.2.18.1: Service-level-AA-service-status indication information element\n\n9.11.2.19\tTime duration\nSee subclause\u00a09.9.3.68 in 3GPP\u00a0TS\u00a024.301\u00a0[15].\n9.11.2.20\tUnavailability information\nSee subclause\u00a09.9.3.69 in 3GPP\u00a0TS\u00a024.301\u00a0[15].\n9.11.2.21\tUnavailability configuration\nSee subclause\u00a09.9.3.70 in 3GPP\u00a0TS\u00a024.301\u00a0[15].\n9.11.3\t5GS mobility management (5GMM) information elements\n9.11.3.1\t5GMM capability\nThe purpose of the 5GMM capability information element is to provide the network with information concerning aspects of the UE related to the 5GCN or interworking with the EPS. The contents might affect the manner in which the network handles the operation of the UE.\nThe 5GMM capability information element is coded as shown in figure\u00a09.11.3.1.1 and table\u00a09.11.3.1.1.\nThe 5GMM capability is a type 4 information element with a minimum length of 3 octets and a maximum length of 15 octets. \nFigure\u00a09.11.3.1.1: 5GMM capability information element\n\nTable\u00a09.11.3.1.1: 5GMM capability information element\n\n9.11.3.2\t5GMM cause\nThe purpose of the 5GMM cause information element is to indicate the reason why a 5GMM request is rejected.\nThe 5GMM cause information element is coded as shown in figure\u00a09.11.3.2.1 and table\u00a09.11.3.2.1.\nThe 5GMM cause is a type 3 information element with length of 2 octets.\nFigure\u00a09.11.3.2.1: 5GMM cause information element\nTable\u00a09.11.3.2.1: 5GMM cause information element\n\n9.11.3.2A\t5GS DRX parameters\nThe purpose of the 5GS DRX parameters information element is to indicate that the UE wants to use DRX and for the network to indicate the DRX cycle value to be used at paging.\nThe 5GS DRX parameters is a type 4 information element with a length of 3 octets.\nThe 5GS DRX parameters information element is coded as shown in figure\u00a09.11.3.2A.1 and table\u00a09.11.3.2A.1.\nThe value part of a DRX parameter information element is coded as shown in table\u00a09.11.3.2A.1.\nFigure\u00a09.11.3.2A.1: 5GS DRX parameters information element\nTable\u00a09.11.3.2A.1: 5GS DRX parameters information element\n\n9.11.3.3\t5GS identity type\nThe purpose of the 5GS identity type information element is to specify which identity is requested.\nThe 5GS identity type is a type 1 information element.\nThe 5GS identity type information element is coded as shown in figure\u00a09.11.3.3.1 and table\u00a09.11.3.3.1.\n\nFigure\u00a09.11.3.3.1: 5GS identity type information element\nTable\u00a09.11.3.3.1: 5GS identity type information element\n\n9.11.3.4\t5GS mobile identity\nThe purpose of the 5GS mobile identity information element is to provide either the SUCI, the 5G-GUTI, the IMEI, the IMEISV, the 5G-S-TMSI, the MAC address or the EUI-64.\nThe 5GS mobile identity information element is coded as shown in figures\u00a09.11.3.4.1, 9.11.3.4.2, 9.11.3.4.3, 9.11.3.4.4, 9.11.3.4.5, 9.11.3.4.6, 9.11.3.4.8 and 9.11.3.4.7, and table\u00a09.11.3.4.1.\nThe 5GS mobile identity is a type 6 information element with a minimum length of 4.\n\nFigure\u00a09.11.3.4.1: 5GS mobile identity information element for type of identity \"5G-GUTI\"\nFigure\u00a09.11.3.4.2: 5GS mobile identity information element for type of identity \"IMEI\" or \"IMEISV\"\nFigure\u00a09.11.3.4.3: 5GS mobile identity information element for type of identity \"SUCI\" and SUPI format \"IMSI\"\nFigure\u00a09.11.3.4.3a: Scheme output for type of identity \"SUCI\", SUPI format \"IMSI\" and Protection scheme Id \"Null scheme\"\nFigure\u00a09.11.3.4.4: 5GS mobile identity information element for type of identity \"SUCI\" and SUPI format \"Network specific identifier\", \"GCI\" or \"GLI\"\nFigure\u00a09.11.3.4.5: 5GS mobile identity information element for type of identity \"5G-S-TMSI\"\nFigure\u00a09.11.3.4.6: 5GS mobile identity information element for type of identity \"No identity\"\nFigure\u00a09.11.3.4.7: 5GS mobile identity information element for type of identity \"MAC address\"\nFigure\u00a09.11.3.4.8: 5GS mobile identity information element for type of identity \"EUI-64\"\nTable\u00a09.11.3.4.1: 5GS mobile identity information element\n\n9.11.3.5\t5GS network feature support\nThe purpose of the 5GS network feature support information element is to indicate whether certain features are supported by the network.\nThe 5GS network feature support information element is coded as shown in figure\u00a09.11.3.5.1 and table\u00a09.11.3.5.1.\nThe 5GS network feature support is a type 4 information element with a minimum length of 3 octets and a maximum length of 6 octets.\nIf:\n-\tthe length of 5GS network feature support contents field is set to one, then the UE shall interpret this as a receipt of an information element with all bits of octet 4, octet 5 and octet 6 coded as zero.\n-\tthe length of 5GS network feature support contents field is set to two, the UE shall interpret this as a receipt of an information element with all bits of octet 5 and octet 6 coded as zero.\n-\tthe length of 5GS network feature support contents field is set to three, the UE shall interpret this as a receipt of an information element with all bits of octet 6 coded as zero.\nFigure\u00a09.11.3.5.1: 5GS network feature support information element\nTable\u00a09.11.3.5.1: 5GS network feature support information element\n\n9.11.3.6\t5GS registration result\nThe purpose of the 5GS registration result information element is to specify the result of a registration procedure.\nThe 5GS registration result information element is coded as shown in figure\u00a09.11.3.6.1 and table\u00a09.11.3.6.1.\nThe 5GS registration result is a type 4 information element with a length of 3 octets.\n\nFigure\u00a09.11.3.6.1: 5GS registration result information element\nTable\u00a09.11.3.6.1: 5GS registration result information element\n\n9.11.3.7\t5GS registration type\nThe purpose of the 5GS registration type information element is to indicate the type of the requested registration.\nThe 5GS registration type information element is coded as shown in figure\u00a09.11.3.7.1 and table\u00a09.11.3.7.1.\nThe 5GS registration type is a type 1 information element with a length of 1 octet.\n\nFigure\u00a09.11.3.7.1: 5GS registration type information element\nTable\u00a09.11.3.7.1: 5GS registration type information element\n\n9.11.3.8\t5GS tracking area identity\nThe purpose of the 5GS tracking area identity information element is to provide an unambiguous identification of tracking areas within the area covered by the 5GS.\nThe 5GS tracking area identity information element is coded as shown in figure\u00a09.11.3.8.1 and table\u00a09.11.3.8.1.\nThe 5GS tracking area identity is a type 3 information element with a length of 7 octets.\n\n\nFigure\u00a09.11.3.8.1: 5GS tracking area identity information element\nTable\u00a09.11.3.8.1: 5GS tracking area identity information element\n\n9.11.3.9\t5GS tracking area identity list\nThe purpose of the 5GS tracking area identity list information element is to transfer a list of tracking areas from the network to the UE.\nThe coding of the information element allows combining different types of lists. The lists of type \"00\" and \"01\" allow a more compact encoding, when the different TAIs are sharing the PLMN identity.\nThe 5GS tracking area identity list information element is coded as shown in figure\u00a09.11.3.8.1, figure\u00a09.11.3.8.2, figure\u00a09.11.3.9.3, figure\u00a09.11.3.9.4 and table\u00a09.11.3.9.1.\nThe 5GS tracking area identity list is a type 4 information element, with a minimum length of 9 octets and a maximum length of 114 octets. The list can contain a maximum of 16 different tracking area identities.\n\n\nFigure\u00a09.11.3.9.1: 5GS tracking area identity list information element\n\n\nFigure\u00a09.11.3.9.2: Partial tracking area identity list \u2013 type of list = \"00\"\n\n\nFigure\u00a09.11.3.9.3: Partial tracking area identity list \u2013 type of list = \"01\"\n\n\nFigure\u00a09.11.3.9.4: Partial tracking area identity list \u2013 type of list = \"10\"\nTable\u00a09.11.3.9.1: Tracking area identity list information element\n\n9.11.3.9A\t5GS update type\nThe purpose of the 5GS update type IE is to allow the UE to provide additional information to the network when performing a registration procedure.\nThe 5GS update type information element is coded as shown in figure\u00a09.11.3.9A.1 and table\u00a09.11.3.9A.1.\nThe 5GS update type is a type 4 information element with a length of 3 octects.\nFigure\u00a09.11.3.9A.1: 5GS update type information element\nTable\u00a09.11.3.9A.1: 5GS update type information element\n\n9.11.3.10\tABBA\nThe purpose of the ABBA information element is to enable the bidding down protection of security features.\nThe ABBA information element is coded as shown in figure\u00a09.11.3.10.1 and table\u00a09.11.3.10.1.\nThe ABBA is a type 4 information element with a minimum length of 4 octets and maximum length of 257 octets.\nFigure\u00a09.11.3.10.1: ABBA information element\nTable\u00a09.11.3.10.1: ABBA information element\n\n9.11.3.11\tVoid\n9.11.3.12\tAdditional 5G security information\nThe purpose of the Additional 5G security information information element is to provide the UE with additional security parameters (e.g. horizontal derivation parameter) or to request the UE to retransmit an initial NAS message during a security mode control procedure as defined in 3GPP\u00a0TS\u00a033.501\u00a0[24]. The UE uses these parameters for completion of security mode control procedure.\nThe Additional 5G security information information element is coded as shown in figure\u00a09.11.3.12.1 and table\u00a09.11.3.12.1.\nThe Additional 5G security information is a type 4 information element with a length of 3 octets.\nFigure\u00a09.11.3.12.1: Additional 5G security information information element\nTable\u00a09.11.3.12.1: Additional 5G security information information element\n\n9.11.3.12A\tAdditional information requested\nThe purpose of the Additional information requested information element is to enable the UE to request ciphering keys for deciphering of ciphered broadcast assistance data.\nThe Additional information requested information element is coded as shown in figure\u00a09.11.3.12A.1 and table\u00a09.11.3.12A.1.\nThe Additional information requested is a type 4 information element with a length of 3 octets.\n\n\nFigure\u00a09.11.3.12A.1: Additional information requested information element\nTable\u00a09.11.3.12A.1: Additional information requested information element\n\n9.11.3.13\tAllowed PDU session status\nThe purpose of the Allowed PDU session status information element is to indicate to the network user-plane resources of PDU sessions associated with non-3GPP access that are allowed to be re-established over 3GPP access or if there is no PDU session(s) for which the UE allows the user-plane resources to be re-established over 3GPP access.\nNOTE:\tAllowed PDU session status IE is not applicable for MA PDU session(s) in this release of specification.\nThe Allowed PDU session status information element is coded as shown in figure\u00a09.11.3.13.1 and table\u00a09.11.3.13.1.\nThe Allowed PDU session status is a type 4 information element with minimum length of 4 octets and maximum length of 34 octets.\nFigure\u00a09.11.3.13.1: Allowed PDU session status information element\nTable\u00a09.11.3.13.1: Allowed PDU session status information element\n\n9.11.3.14\tAuthentication failure parameter\nSee subclause 10.5.3.2.2 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.3.15\tAuthentication parameter AUTN\nSee subclause\u00a010.5.3.1.1 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.3.16\tAuthentication parameter RAND\nSee subclause\u00a010.5.3.1 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.3.17\tAuthentication response parameter\nSee subclause\u00a09.9.3.4 in 3GPP\u00a0TS\u00a024.301\u00a0[15].\n9.11.3.18\tConfiguration update indication\nThe purpose of the Configuration update indication information element is to indicate the additional information associated with the generic UE configuration update procedure.\nThe Configuration update indication information element is coded as shown in figure\u00a09.11.3.18.1 and table\u00a09.11.3.18.1.\nThe Configuration update indication is a type 1 information element.\nFigure\u00a09.11.3.18.1: Configuration update indication\nTable\u00a09.11.3.18.1: Configuration update indication\n\n9.11.3.18A\tCAG information list\nThe purpose of the CAG information list information element is to provide \"CAG information list\" or to delete the \"CAG information list\" at the UE.\nThe CAG information list information element is coded as shown in figures\u00a09.11.3.18A.1 and 9.11.3.18A.2 and table\u00a09.11.3.18A.1.\nThe CAG information list is a type 6 information element, with a minimum length of 3 octets.\nFigure\u00a09.11.3.18A.1: CAG information list information element\nFigure\u00a09.11.3.18A.2: Entry n\nTable\u00a09.11.3.18A.1: CAG information list information element\n\n9.11.3.18B\tCIoT small data container\nThis information element is used to encapsulate the CIoT user data, SMS, or location services message with a size that is not more than 254 octets between the UE and the AMF when the UE is using control plane CIoT 5GS optimization. The CIoT small data container information element is coded as shown in figure\u00a09.11.3.18B.1, figure\u00a09.11.3.18B.2, figure\u00a09.11.3.18B.3, figure\u00a09.11.3.18B.4 and table\u00a09.11.3.18B.1.\nThe CIoT small data container is a type 4 information element with a minimum length of 4 octets and a maximum length of 257 octets.\n\nFigure\u00a09.11.3.18B.1: CIoT small data container information element\nFigure\u00a09.11.3.18B.2: CIoT small data container contents for Data type \"Control plane user data\"\nFigure\u00a09.11.3.18B.3: CIoT small data container contents for Data type \"Location services message container\"\nFigure\u00a09.11.3.18B.4: CIoT small data container contents for Data type \"SMS\"\nTable\u00a09.11.3.18B.1: CIoT small data container information element\n\n9.11.3.18C\tCiphering key data\nThe purpose of the Ciphering key data information element is to transfer a list of ciphering data sets from the network to the UE for deciphering of ciphered assistance data.\nThe Ciphering key data information element is coded as shown in figure\u00a09.11.3.18C.1, figure\u00a09.11.3.18C.2 and table\u00a09.11.3.18C.1.\nThe Ciphering key data is a type 6 information element, with a minimum length of 34 octets and a maximum length of 2675 octets. The list can contain a maximum of 16 ciphering data sets.\n\n\nFigure\u00a09.11.3.18C.1: Ciphering key data information element\n\nFigure\u00a09.11.3.18C.2: Ciphering data set\nTable\u00a09.11.3.18C.1: Ciphering key data information element\n\n9.11.3.18D\tControl plane service type\nThe purpose of the Control plane service type information element is to specify the purpose of the CONTROL PLANE SERVICE REQUEST message.\nThe Control plane service type information element is coded as shown in figure\u00a09.11.3.18D.1 and table\u00a09.11.3.18D.1.\nThe Control plane service type is a type 1 information element.\n\n\nFigure 9.9.3.18D.1: Control plane service type information element\nTable 9.9.3.18D.1: Control plane service type information element\n\n\n9.11.3.19\tDaylight saving time\nSee subclause\u00a010.5.3.12 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.3.20\tDe-registration type\nThe purpose of the De-registration type information element is to indicate the type of de-registration.\nThe De-registration type information element is coded as shown in figure\u00a09.11.3.20.1 and table\u00a09.11.3.20.1.\nThe De-registration type is a type 1 information element.\nFigure\u00a09.11.3.20.1: Deregistration type information element\nTable\u00a09.11.3.20.1: Deregistration type information element\n\n9.11.3.21\tVoid\n9.11.3.22\tVoid\n9.11.3.23\tEmergency number list\nSee subclause\u00a010.5.3.13 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.3.23A\tEPS bearer context status\nSee subclause\u00a09.9.2.1 in 3GPP\u00a0TS\u00a024.301\u00a0[15].\n9.11.3.24\tEPS NAS message container\nThe purpose of the EPS NAS message container information element is to transport an EPS NAS message as specified in 3GPP\u00a0TS\u00a024.301\u00a0[15].\nThe EPS NAS message container information element is coded as shown in figure\u00a09.11.3.24.1 and table\u00a09.11.3.24.1.\nThe EPS NAS message container is a type 6 information element.\nFigure\u00a09.11.3.24.1: EPS NAS message container information element\nTable\u00a09.11.3.24.1: EPS NAS message container information element\n\n9.11.3.25\tEPS NAS security algorithms\nSee subclause\u00a09.9.3.23 in 3GPP\u00a0TS\u00a024.301\u00a0[15].\n9.11.3.26\tExtended emergency number list\nSee subclause\u00a09.9.3.37A in 3GPP\u00a0TS\u00a024.301\u00a0[15].\n9.11.3.26A\tExtended DRX parameters\nSee subclause\u00a010.5.5.32 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.3.27\tVoid\n9.11.3.28\tIMEISV request\nSee subclause\u00a010.5.5.10 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.3.29\tLADN indication\nThe purpose of the LADN indication information element is to request the network for LADN information for specific LADN DNN(s) or to indicate a request for LADN information.\nThe LADN indication information element is coded as shown in figure\u00a09.11.3.29.1 and table\u00a09.11.3.29.1.\nThe LADN indication is a type 6 information element with a minimum length of 3 octets and a maximum length of 811 octets.\nThe LADN indication information element can contain a minimum of 0 and a maximum of 8 different LADN DNN values.\nFigure\u00a09.11.3.29.1: LADN indication information element\nTable\u00a09.11.3.29.1: LADN indication information element\n\n9.11.3.30\tLADN information\nThe purpose of the LADN information information element is to provide the UE with the LADN service area for each available LADN in the current registration area or to delete the LADN information at the UE.\nThe LADN information information element is coded as shown in figure\u00a09.11.3.30.1, figure\u00a09.11.3.30.2 and table\u00a09.11.3.30.1.\nThe LADN information is a type 6 information element with a minimum length of 3 octets and a maximum length of 1715 octets.\nThe LADN information information element can contain a minimum of 0 and a maximum of 8 different LADNs each including a DNN and a 5GS tracking area identity list.\nFigure\u00a09.11.3.30.1: LADN information information element\nFigure\u00a09.11.3.30.2: LADN\nTable\u00a09.11.3.30.1: LADN information information element\n\n9.11.3.31\tMICO indication\nThe purpose of the MICO indication information element is to indicate the use of MICO mode or the re-negotiation of MICO mode.\nThe MICO indication information element is coded as shown in figure\u00a09.11.3.31.1 and table\u00a09.11.3.31.1.\nThe MICO indication is a type 1 information element.\nFigure\u00a09.11.3.31.1: MICO indication\nTable\u00a09.11.3.31.1: MICO indication\n\n9.11.3.31A\tMA PDU session information\nThe purpose of the MA PDU session information information element is to convey the MA-related information for the PDU session.\nThe MA PDU session information information element is coded as shown in figure\u00a09.11.3.31A.1 and table\u00a09.11.3.31A.1.\nThe MA PDU session information is a type 1 information element.\nFigure\u00a09.11.3.31A.1: MA PDU session information information element\nTable\u00a09.11.3.31A.1: MA PDU session information information element\n\n9.11.3.31B\tMapped NSSAI\nThe purpose of the Mapped NSSAI information element is to transfer S-NSSAI(s) applicable in the HPLMN to the visited PLMN.\nThe Mapped NSSAI information element is coded as shown in figure\u00a09.11.3.31B.1, figure\u00a09.11.3.31B.2 and table\u00a09.11.3.31B.1.\nThe Mapped NSSAI is a type 4 information element with a minimum length of 4 octets and a maximum length of 42 octets.\nNOTE\u00a01:\tThe total number of S-NSSAI values in a requested mapped NSSAI cannot exceed eight.\nFigure\u00a09.11.3.31B.1: Mapped NSSAI information element\nFigure\u00a09.11.3.31B.2: Mapped S-NSSAI content\nTable\u00a09.11.3.31B.1: Mapped NSSAI information element\n\n9.11.3.31C\tMobile station classmark 2\nSee subclause\u00a010.5.1.6 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.3.32\tNAS key set identifier\nThe NAS key set identifier is allocated by the network.\nThe NAS key set identifier information element is coded as shown in figure\u00a09.11.3.32.1 and table\u00a09.11.3.32.1.\nThe NAS key set identifier is a type 1 information element.\nFigure\u00a09.11.3.32.1: NAS key set identifier information element\nTable\u00a09.11.3.32.1: NAS key set identifier information element\n\n9.11.3.33\tNAS message container\nThe purpose of the NAS message container IE is to encapsulate a plain 5GS NAS REGISTRATION REQUEST, DEREGISTRATION REQUEST, or SERVICE REQUEST message, or to encapsulate non-cleartext IEs of a CONTROL PLANE SERVICE REQUEST message.\nThe NAS message container information element is coded as shown in figure\u00a09.11.3.33.1 and table\u00a09.11.3.33.1.\nThe NAS message container is a type 6 information element.\nFigure\u00a09.11.3.33.1: NAS message container information element\nTable\u00a09.11.3.33.1: NAS message container information element\n\n9.11.3.34\tNAS security algorithms\nThe purpose of the NAS security algorithms information element is to indicate the 5G algorithms to be used for ciphering and integrity protection.\nThe NAS security algorithms information element is coded as shown in figure\u00a09.11.3.34.1 and table\u00a09.11.3.34.1.\nThe NAS security algorithms is a type 3 information element with a length of 2 octets.\nFigure\u00a09.11.3.34.1: NAS security algorithms information element\nTable\u00a09.11.3.34.1: NAS security algorithms information element\n\n9.11.3.35\tNetwork name\nSee subclause\u00a010.5.3.5a in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.3.36\tNetwork slicing indication\nThe purpose of the Network slicing indication information element is to indicate additional information associated with network slicing in the generic UE configuration update procedure and the registration procedure, other than the user's configured NSSAI, allowed NSSAI, pending NSSAI and rejected NSSAI information.\nThe Network slicing indication information element is coded as shown in figure\u00a09.11.3.36.1 and table\u00a09.11.3.36.1.\nThe Network slicing indication is a type 1 information element.\nFigure\u00a09.11.3.36.1: Network slicing indication\nTable\u00a09.11.3.36.1: Network slicing indication\n\n9.11.3.36A\tNon-3GPP NW provided policies\nSee subclause\u00a010.5.5.37 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.3.37\tNSSAI\nThe purpose of the NSSAI information element is to identify a collection of S-NSSAIs\nThe NSSAI information element is coded as shown in figure\u00a09.11.3.37.1 and table\u00a09.11.3.37.1.\nThe NSSAI is a type 4 information element with a minimum length of 4 octets and a maximum length of 146 octets.\nNOTE:\tMore than one S-NSSAIs in an NSSAI can have the same SST values, and optionally same SD values, which are associated with different mapped HPLMN SST values and optionally mapped HPLMN SD values.\nFigure\u00a09.11.3.37.1: NSSAI information element\nTable\u00a09.11.3.37.1: NSSAI information element\n\n9.11.3.37A\tNSSAI inclusion mode\nThe purpose of the NSSAI inclusion mode information element is to indicate the NSSAI inclusion mode in which the UE shall operate.\nThe NSSAI inclusion mode is a type 1 information element.\nThe NSSAI inclusion mode information element is coded as shown in figure\u00a09.11.3.37A.1 and table\u00a09.11.3.37A.1.\nFigure\u00a09.11.3.37A.1: NSSAI inclusion mode information element\nTable\u00a09.11.3.37A.1: NSSAI inclusion mode information element\n\n9.11.3.38\tOperator-defined access category definitions\nThe purpose of the Operator-defined access category definitions information element is to provide the UE with the operator-defined access category definitions or to delete the operator-defined access category definitions at the UE.\nThe Operator-defined access category definitions information element is coded as shown in figure\u00a09.11.3.38.1, figure\u00a09.11.3.38.2 and table\u00a09.11.3.38.1.\nThe Operator-defined access category definitions is a type 6 information element with a minimum length of 3 octets, and maximum length of 8323 octets.\nFigure\u00a09.11.3.38.1: Operator-defined access category definitions information element\nFigure\u00a09.11.3.38.2: Operator-defined access category definition\nTable\u00a09.11.3.38.1: Operator-defined access category definitions information element\n\n9.11.3.39\tPayload container\nThe purpose of the Payload container information element is to transport one or multiple payloads. If multiple payloads are transported, the associated information of each payload are also transported together with the payload.\nThe Payload container information element is coded as shown in figure\u00a09.11.3.39.1, figure 9.11.3.39.1A, figure 9.11.3.39.1B, figure\u00a09.11.3.39.2, figure\u00a09.11.3.39.3, figure\u00a09.11.3.39.4 and table\u00a09.11.3.39.1.\nThe Payload container information element is a type 6 information element with a minimum length of 4 octets and a maximum length of 65538 octets.\nFigure\u00a09.11.3.39.1: Payload container information element\nFigure\u00a09.11.3.39.1A: Payload container contents with Payload container type \"Event notification\"\nFigure\u00a09.11.3.39.1B: Even notification indicator n\n\nFigure\u00a09.11.3.39.2: Payload container contents with Payload container type \"Multiple payloads\"\nFigure\u00a09.11.3.39.3: Payload container entry\nFigure\u00a09.11.3.39.4: Optional IE\nTable\u00a09.11.3.39.1: Payload container information element\n\n9.11.3.40\tPayload container type\nThe purpose of the Payload container type information element indicates type of payload included in the payload container information element.\nThe Payload container type information element is coded as shown in figure\u00a09.11.3.40.1 and table\u00a09.11.3.40.1.\nThe Payload container type information element is a type 1 information element.\nFigure\u00a09.11.3.40.1: Payload container type information element\nTable\u00a09.11.3.40.1: Payload container type information element\n\n9.11.3.41\tPDU session identity 2\nThe purpose of the PDU session identity 2 information element is to indicate the identity of a PDU session in a 5GMM message.\nThe PDU session identity 2 information element is coded as shown in figure\u00a09.11.3.41.1 and table\u00a09.11.3.41.1.\nThe PDU session identity 2 is a type 3 information element with a length of 2 octets .\nFigure\u00a09.11.3.41.1: PDU session identity 2 information element\nTable\u00a09.11.3.41.1: PDU session identity 2 information element\n\n9.11.3.42\tPDU session reactivation result\nThe purpose of the PDU session reactivation result information element is to indicate the result of establishments of user-plane resources of PDU sessions.\nThe PDU session reactivation result information element is coded as shown in figure\u00a09.11.3.42.1 and table\u00a09.11.3.42.1.\nThe PDU session reactivation result is a type 4 information element with minimum length of 4 octets and maximum length of 34 octets.\nFigure\u00a09.11.3.42.1: PDU session reactivation result information element\nTable\u00a09.11.3.42.1: PDU session reactivation result information element\n\n9.11.3.43\tPDU session reactivation result error cause\nThe purpose of the PDU session reactivation result error cause information element is to indicate error causes for PDU session ID(s) where there was a failure to establish the user-plane resources.\nThe PDU session reactivation result error cause information element is coded as shown in figure\u00a09.11.3.43.1 and table\u00a09.11.3.43.1.\nThe PDU session reactivation result error cause is a type 6 information element with a minimum length of 5 octets and a maximum length of 515 octets.\n\nFigure\u00a09.11.3.43.1: PDU session reactivation result error cause information element\nTable\u00a09.11.3.43.1: PDU session reactivation result error cause information element\n\n9.11.3.44\tPDU session status\nThe purpose of the PDU session status information element is to indicate the state of each PDU session that can be identified by a PDU session identity.\nThe PDU session status information element is coded as shown in figure\u00a09.11.3.44.1 and table\u00a09.11.3.44.1.\nThe PDU session status information element is a type 4 information element with minimum length of 4 octets and a maximum length of 34 octets.\nFigure\u00a09.11.3.44.1: PDU session status information element\nTable\u00a09.11.3.44.1: PDU session status information element\n\n9.11.3.45\tPLMN list\nSee subclause\u00a010.5.1.13 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.3.46\tRejected NSSAI\nThe purpose of the Rejected NSSAI information element is to identify a collection of rejected S-NSSAIs.\nThe Rejected NSSAI information element is coded as shown in figure\u00a09.11.3.46.1, figure\u00a09.11.3.46.2 and table\u00a09.11.3.46.1.\nThe Rejected NSSAI is a type 4 information element with a minimum length of 4 octets and a maximum length of 42 octets.\n\nFigure\u00a09.11.3.46.1: Rejected NSSAI information element\nFigure\u00a09.11.3.46.2: Rejected S-NSSAI\nTable\u00a09.11.3.46.1: Rejected NSSAI information element\n\n9.11.3.46A\tRelease assistance indication\nSee subclause\u00a09.9.4.25 in 3GPP\u00a0TS\u00a024.301\u00a0[15].\n9.11.3.47\tRequest type\nThe purpose of the Request type information element is to indicate the type of the 5GSM message.\nThe Request type information element is coded as shown in figure\u00a09.11.3.47.1 and table\u00a09.11.3.47.1.\nThe Request type is a type 1 information element.\nFigure\u00a09.11.3.47.1: Request type information element\nTable\u00a09.11.3.47.1: Request type information element\n\n9.11.3.48\tS1 UE network capability\nSee subclause\u00a09.9.3.34 in 3GPP\u00a0TS\u00a024.301\u00a0[15].\n9.11.3.48A\tS1 UE security capability\nSee subclause\u00a09.9.3.36 in 3GPP\u00a0TS\u00a024.301\u00a0[15].\n9.11.3.49\tService area list\nThe purpose of the Service area list information element is to transfer a list of allowed tracking areas for an allowed area or a list of non-allowed tracking areas for a non-allowed area from the network to the UE.\nThe coding of the information element allows combining different types of lists. The lists of type \"00\" and \"01\" allow a more compact encoding, when the different TAIs are sharing the PLMN identity. The lists of type \"11\" indicate all TAIs of the PLMNs in the registration area are allowed area.\nThe Service area list information element is coded as shown in figure\u00a09.11.3.49.1, figure\u00a09.11.3.49.2, figure\u00a09.11.3.49.3, figure\u00a09.11.3.49.4, figure\u00a09.11.3.49.5 and table\u00a09.11.3.49.1.\nThe Service area list is a type 4 information element with a minimum length of 6 octets and a maximum length of 114 octets. The list can contain a maximum of 16 different tracking area identities.\nFigure\u00a09.11.3.49.1: Service area list information element\nFigure\u00a09.11.3.49.2: Partial service area list \u2013 type of list = \"00\"\n\nFigure\u00a09.11.3.49.3: Partial service area list \u2013 type of list = \"01\"\n\nFigure\u00a09.11.3.49.4: Partial service area list \u2013 type of list = \"10\"\n\nFigure\u00a09.11.3.49.5: Partial service area list \u2013 type of list = \"11\"\nTable\u00a09.11.3.49.1: Service area list information element\n\n9.11.3.50\tService type\nThe purpose of the service type information element is to specify the purpose of the service request procedure.\nThe service type is a type 1 information element.\nThe service type information element is coded as shown in figure\u00a09.11.3.50.1 and table\u00a09.11.3.50.1.\nFigure\u00a09.11.3.50.1: Service type information element\nTable\u00a09.11.3.50.1: Service type information element\n\n9.11.3.50A\tSMS indication\nThe purpose of the SMS indication information element is to indicate that the ability for the UE to use SMS over NAS has changed.\nThe SMS indication information element is coded as shown in figure\u00a09.11.3.50A.1 and table\u00a09.11.3.50A.1.\nThe SMS indication is a type 1 information element.\nFigure\u00a09.11.3.50A.1: SMS indication\nTable\u00a09.11.3.50A.1: SMS indication\n\n9.11.3.51\tSOR transparent container\nThe purpose of the SOR transparent container information element in the REGISTRATION ACCEPT message is to provide the list of preferred PLMN/access technology combinations (or HPLMN indication that 'no change of the \"Operator Controlled PLMN Selector with Access Technology\" list stored in the UE is needed and thus no list of preferred PLMN/access technology combinations is provided'), or a secured packet (see 3GPP\u00a0TS\u00a023.122\u00a0[5] annex\u00a0C) and optional indication of an acknowledgement request, SOR-CMCI, request the storage of the received SOR-CMCI in the ME, SOR-SNPN-SI (or subscribed SNPN or HPLMN indication that 'no change of the SOR-SNPN-SI stored in the UE is needed and thus no SOR-SNPN-SI is provided'), and SOR-SNPN-SI-LS. The purpose of the SOR transparent container information element in the REGISTRATION COMPLETE message is to indicate the UE acknowledgement of successful reception of the SOR transparent container IE in the REGISTRATION ACCEPT message as well as to indicate the ME support of SOR-CMCI, the ME support of SOR-SNPN-SI and the ME support of SOR-SNPN-SI-LS.\nNOTE\u00a01:\tWhen used in NAS transport procedure, the contents of the SOR transparent container information element in the Payload container IE of the DL NAS TRANSPORT message are used to provide the list of preferred PLMN/access technology combinations and optional indication of an acknowledgement request, SOR-CMCI, request the storage of the received SOR-CMCI in the ME, SOR-SNPN-SI, and SOR-SNPN-SI-LS. The contents of the SOR transparent container information element in the Payload container IE of the UL NAS TRANSPORT message are used to indicate the UE acknowledgement of successful reception of the SOR transparent container IE in the DL NAS TRANSPORT message as well as to indicate the ME support of SOR-CMCI, the ME support of SOR-SNPN-SI and the ME support of SOR-SNPN-SI-LS.\nNOTE\u00a02:\tThe \"Operator controlled signal threshold per access technology\" content to update the USIM file EFOCST (see 3GPP\u00a0TS\u00a031.102\u00a0[22]) can be included in the secured packet of the SOR transparent container.\nThe SOR transparent container information element is coded as shown in figure\u00a09.11.3.51.1, figure\u00a09.11.3.51.2, figure\u00a09.11.3.51.3, figure\u00a09.11.3.51.4, figure\u00a09.11.3.51.5, figure\u00a09.11.3.51.6, figure\u00a09.11.3.51.7, figure\u00a09.11.3.51.8, figure\u00a09.11.3.51.9, figure\u00a09.11.3.51.9A, figure\u00a09.11.3.51.10, figure\u00a09.11.3.51.11, figure\u00a09.11.3.51.11A, figure\u00a09.11.3.51.11B, figure\u00a09.11.3.51.11C, figure\u00a09.11.3.51.11D, figure\u00a09.11.3.51.11E, figure\u00a09.11.3.51.11F, figure\u00a09.11.3.51.11G, figure\u00a09.11.3.51.11H, figure\u00a09.11.3.51.11I, figure\u00a09.11.3.51.12, figure\u00a09.11.3.51.13, table\u00a09.11.3.51.1, table\u00a09.11.3.51.2, table\u00a09.11.3.51.3, table\u00a09.11.3.51.4, table\u00a09.11.3.51.4A, table\u00a09.11.3.51.5 and table\u00a09.11.3.51.6.\nThe SOR transparent container is a type 6 information element with a minimum length of 20 octets.\nFigure\u00a09.11.3.51.1: SOR transparent container information element for list type with value \"0\" and SOR data type with value \"0\"\nFigure\u00a09.11.3.51.2: SOR transparent container information element for list type with value \"1\", SOR data type with value \"0\", and additional parameters with value \"0\"\nFigure\u00a09.11.3.51.2A: SOR transparent container information element for list type with value \"1\", SOR data type with value \"0\", additional parameters with value \"1\"\nFigure\u00a09.11.3.51.3: PLMN ID and access technology list (m=22+5*n)\nFigure\u00a09.11.3.51.4: SOR transparent container information element for SOR data type with value \"1\"\nFigure\u00a09.11.3.51.5: SOR header for SOR data type with value \"0\"\nFigure\u00a09.11.3.51.6: SOR header for SOR data type with value \"1\"\nTable\u00a09.11.3.51.1: SOR transparent container information element\n\nFigure\u00a09.11.3.51.7: SOR-CMCI\nTable\u00a09.11.3.51.2: SOR-CMCI\n\nFigure\u00a09.11.3.51.8: SOR-CMCI rule\nTable\u00a09.11.3.51.3: SOR-CMCI rule\n\nFigure\u00a09.11.3.51.9: SOR-SNPN-SI\nTable\u00a09.11.3.51.4: SOR-SNPN-SI\n\nFigure\u00a09.11.3.51.9A: SOR-SNPN-SI-LS\nTable\u00a09.11.3.51.4A: SOR-SNPN-SI-LS\n\nFigure\u00a09.11.3.51.10: CH controlled prioritized list of preferred SNPNs\n\nFigure\u00a09.11.3.51.10A: CH controlled prioritized list of preferred SNPNs for access for localized services in SNPN\n\nFigure\u00a09.11.3.51.10B: SNPN info\nFigure\u00a09.11.3.51.11: SNPN identity\nFigure\u00a09.11.3.51.11A: Time validity information\nFigure\u00a09.11.3.51.11B: Location assistance information\nFigure\u00a09.11.3.51.11C: Geographical area descriptions\nFigure\u00a09.11.3.51.11D: Tracking area information of PLMNs\nFigure\u00a09.11.3.51.11E: Tracking area information of PLMN\nFigure\u00a09.11.3.51.11F: TAC list\nFigure\u00a09.11.3.51.11G: Tracking area information of SNPNs\nFigure\u00a09.11.3.51.11H: Tracking area information of SNPN\nFigure\u00a09.11.3.51.11I: Location validity information\nTable\u00a09.11.3.51.5: CH controlled prioritized list of preferred SNPNs and CH controlled prioritized list of preferred SNPNs for access for localized services in SNPN\n\nFigure\u00a09.11.3.51.12: CH controlled prioritized list of GINs\n\nFigure\u00a09.11.3.51.12A: CH controlled prioritized list of preferred GINs for access for localized services in SNPN\n\nFigure\u00a09.11.3.51.12B: GIN info\nFigure\u00a09.11.3.51.13: GIN\nTable\u00a09.11.3.51.6: CH controlled prioritized list of GINs and CH controlled prioritized list of preferred GINs for access for localized services in SNPN\n9.11.3.51A\tSupported codec list\nSee subclause\u00a010.5.4.32 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.3.52\tTime zone\nSee subclause\u00a010.5.3.8 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.3.53\tTime zone and time\nSee subclause\u00a010.5.3.9 in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.3.53A\tUE parameters update transparent container\nThe purpose of the UE parameters update transparent container when sent from the network to the UE is to provide UE parameters update data, optional acknowledgement request and optional re-registration request. The purpose of the UE parameters update transparent container when sent from the UE to the network is to indicate the UE acknowledgement of successful reception of the UE parameters update transparent container.\nThe UE parameters update transparent container information element is coded as shown in figure\u00a09.11.3.53A.1, figure\u00a09.11.3.53A.2, figure\u00a09.11.3.53A.3, figure\u00a09.11.3.53A.4, figure\u00a09.11.3.53A.4B, figure\u00a09.11.3.53A.5, figure\u00a09.11.3.53A.6, figure\u00a09.11.3.53A.7 and table\u00a09.11.3.53A.1.\nThe UE parameters update transparent container is a type 6 information element with a minimum length of 20 octets.\nFigure\u00a09.11.3.53A.1: UE parameters update transparent container information element for UE parameters update data type with value \"0\"\nFigure\u00a09.11.3.53A.2: UE parameters update list\nFigure\u00a09.11.3.53A.3: UE parameters update data set for UE parameters update data set type with value \"0001\"\nFigure\u00a09.11.3.53A.4: UE parameters update data set for UE parameters update data set type with value \"0010\"\nFigure\u00a09.11.3.53A.4A: UE parameters update data set for UE parameters update data set type with value \"0011\"\nFigure\u00a09.11.3.53A.4B: UE parameters update data set for UE parameters update data set type with value \"0100\"\nFigure\u00a09.11.3.53A.5: UE parameters update transparent container information element for UE parameters update data type with value \"1\"\nFigure\u00a09.11.3.53A.6: UE parameters update header for UE parameters update data type with value \"0\"\nFigure\u00a09.11.3.53A.7: UE parameters update header for UE parameters update data type with value \"1\"\nTable\u00a09.11.3.53A.1: UE parameters update transparent container information element\n\n9.11.3.54\tUE security capability\nThe UE security capability information element is used by the UE and by the network to indicate which security algorithms are supported by the UE in N1 mode for NAS security as well as which security algorithms are supported over NR and E-UTRA connected to 5GCN for AS security.\nThe UE security capability information element is coded as shown in figure\u00a09.11.3.54.1 and table\u00a09.11.3.54.1.\nThe UE security capability is a type 4 information element with a minimum length of 4 octets and a maximum length of 10 octets.\nOctets 5 to 10 are optional. If octet 5 is included, then also octet 6 shall be included.\nIf the UE does not support any security algorithm for AS security over E-UTRA connected to 5GCN, it shall not include octets 5 and 6. The UE shall not include octets 7 to 10.\nIf the UE does not support any security algorithm for AS security over E-UTRA connected to 5GCN, and if the network includes octets 7 to 10, then the network shall also include octets 5 to 6.\nIf the network includes octet 7, then it shall include also octet 8. If the network includes octet 9, then it shall include also octet 10.\n\nFigure\u00a09.11.3.54.1: UE security capability information element\nTable\u00a09.11.3.54.1: UE security capability information element\n\n9.11.3.55\tUE's usage setting\nThe purpose of the UE's usage setting information element is to provide the network with the UE's usage setting as defined in 3GPP\u00a0TS\u00a024.301\u00a0[15]. The network uses the UE's usage setting to select the RFSP index.\nThe UE's usage setting information element is coded as shown in figure\u00a09.11.3.55.1 and table\u00a09.11.3.55.1.\nThe UE's usage setting is a type 4 information element with a length of 3 octets.\nFigure\u00a09.11.3.55.1: UE's usage setting information element\nTable\u00a09.11.3.55.1: UE's usage setting information element\n\n9.11.3.56\tUE status\nThe purpose of the UE status information element is to provide the network with information concerning aspects of the current UE registration status which is used for interworking with EPS.\nThe UE status information element is coded as shown in figure\u00a09.11.3.56.1 and table\u00a09.11.3.56.1.\nThe UE status is a type 4 information element with a length of 3 octets.\nFigure\u00a09.11.3.56.1: UE status information element\nTable\u00a09.11.3.56.1: UE status information element\n\n9.11.3.57\tUplink data status\nThe purpose of the Uplink data status information element is to indicate to the network which preserved PDU session(s) have uplink data pending or which preserved PDU session(s) are associated with active multicast MBS session(s).\nThe Uplink data status information element is coded as shown in figure\u00a09.11.3.57.1 and table\u00a09.11.3.57.1.\nThe Uplink data status information element is a type 4 information element with minimum length of 4 octets a maximum length of 34 octets.\nFigure\u00a09.11.3.57.1: Uplink data status information element\nTable\u00a09.11.3.57.1: Uplink data status information element\n\n9.11.3.58\tVoid\n9.11.3.59\tVoid\n9.11.3.60\tVoid\n9.11.3.61\tVoid\n9.11.3.62\tVoid\n9.11.3.63\tVoid\n9.11.3.64\tVoid\n9.11.3.65\tVoid\n9.11.3.66\tVoid\n9.11.3.67\tVoid\n9.11.3.68\tUE radio capability ID\nThe purpose of the UE radio capability ID information element is to carry a UE radio capability ID.\nThe UE radio capability ID information element is coded as shown in figure\u00a09.11.3.68.1 and table\u00a09.11.3.68.1.\nThe UE radio capability ID is a type 4 information element with a length of n octets.\n\nFigure\u00a09.11.3.68.1: UE radio capability ID information element\nTable\u00a09.11.3.68.1: UE radio capability ID information element\n\n9.11.3.69\tUE radio capability ID deletion indication\nThe purpose of the UE radio capability ID deletion indication information element is to indicate to the UE that deletion of UE radio capability IDs is requested.\nThe UE radio capability ID deletion indication is a type 1 information element.\nThe UE radio capability ID deletion indication information element is coded as shown in figure\u00a09.11.3.69.1 and table\u00a09.11.3.69.1.\n\nFigure\u00a09.11.3.69.1: UE radio capability ID deletion indication information element\nTable\u00a09.11.3.69.1: UE radio capability ID deletion indication information element\n\n9.11.3.70\tTruncated 5G-S-TMSI configuration\nThe purpose of the Truncated 5G-S-TMSI configuration information element is to provide the size of the components of the truncated 5G-S-TMSI to the UE in NB-N1 mode to create the truncated 5G-S-TMSI.\nThe Truncated 5G-S-TMSI configuration information element is coded as shown in figure\u00a09.11.3.70.1 and table\u00a09.11.3.70.1.\nThe Truncated 5G-S-TMSI configuration is a type 4 information element with 3 octets length.\nFigure\u00a09.11.3.70.1: Truncated 5G-S-TMSI configuration information element\nTable\u00a09.11.3.70.1: Truncated 5G-S-TMSI configuration information element\n\n9.11.3.71\tWUS assistance information\nSee subclause\u00a09.9.3.62 in 3GPP\u00a0TS\u00a024.301\u00a0[15].\n9.11.3.72\tN5GC indication\nThe purpose of the N5GC indication information element is to indicate to the network that the registration request by the W-AGF is on behalf of an N5GC device.\nThe N5GC indication information element is coded as shown in figure\u00a09.11.3.72.1.\nThe N5GC indication is a type 1 information element.\nFigure\u00a09.11.3.72.1: N5GC indication\nTable\u00a09.11.3.72.1: N5GC indication\n\n9.11.3.73\tNB-N1 mode DRX parameters\nThe purpose of the NB-N1 mode DRX parameters information element is to indicate that the UE wants to use DRX in NB-N1 mode and for the network to indicate the DRX cycle value to be used at paging in NB-N1 mode.\nThe NB-N1 mode DRX parameters is a type 4 information element with a length of 3 octets.\nThe NB-N1 mode DRX parameters information element is coded as shown in figure\u00a09.11.3.73.1 and table\u00a09.11.3.73.1.\nThe value part of a DRX parameter information element is coded as shown in table\u00a09.11.3.73.1.\nFigure\u00a09.11.3.73.1: NB-N1 mode DRX parameters information element\nTable\u00a09.11.3.73.1: NB-N1 mode DRX parameters information element\n\n9.11.3.74\tAdditional configuration indication\nThe purpose of the Additional configuration indication information element is to indicate additional information associated with the generic UE configuration update procedure.\nThe Additional configuration indication information element is coded as shown in figure\u00a09.11.3.74.1 and table\u00a09.11.3.74.1.\nThe Additional configuration indication is a type 1 information element.\nFigure\u00a09.11.3.74.1: Additional configuration indication\nTable\u00a09.11.3.74.1: Additional configuration indication\n\n9.11.3.75\tExtended rejected NSSAI\nThe purpose of the Extended rejected NSSAI information element is to identify a collection of rejected S-NSSAIs if UE supports extended rejected NSSAI.\nThe Extended rejected NSSAI information element is coded as shown in figure\u00a09.11.3.75.1, figure\u00a09.11.3.75.2 and table\u00a09.11.3.75.1.\nThe Extended rejected NSSAI is a type 4 information element with a minimum length of 5 octets and a maximum length of 90 octets.\n\nFigure\u00a09.11.3.75.1: Extended rejected NSSAI information element\nFigure 9.11.3.75.2: Partial extended rejected NSSAI list \u2013 type of list = 000\nFigure 9.11.3.75.3: Partial extended rejected NSSAI list \u2013 type of list = 001\n\nFigure\u00a09.11.3.75.4: Rejected S-NSSAI\nTable\u00a09.11.3.75.1: Extended rejected NSSAI information element\n\n9.11.3.76\tUE request type\nSee subclause\u00a09.9.3.65 in 3GPP\u00a0TS\u00a024.301\u00a0[15].\n9.11.3.77\tPaging restriction\nThe purpose of the Paging restriction information element is to request the network to restrict paging.\nThe Paging restriction information element is coded as shown in figure\u00a09.11.3.77.1, figure\u00a09.11.3.77.2 and table\u00a09.11.3.77.1.\nThe Paging restriction is a type 4 information element with a minimum length of 3 octets and a maximum length of 35 octets.\nFigure\u00a09.11.3.77.1:\tPaging restriction information element for Paging restriction type = \"All paging is restricted\" and for Paging restriction type = \"All paging is restricted except voice\"\nFigure\u00a09.11.3.77.2:\tPaging restriction information element for Paging restriction type = \"All paging is restricted except for specified PDU session(s)\" and for Paging restriction type = \"All paging is restricted except for voice service and specified PDU session(s)\"\nTable\u00a09.11.3.77.1:\tPaging restriction information element\n\n9.11.3.78\tVoid\n9.11.3.79\tNID\nSee subclause\u00a09.2.7 in 3GPP\u00a0TS\u00a024.502\u00a0[18].\n9.11.3.80\tPEIPS assistance information\nThe purpose of the PEIPS assistance information, information element is to transfer the required assistance information to indicate the paging subgroup used when paging the UE.\nThe coding of the information element allows combining different types of PEIPS assistance information.\nThe PEIPS assistance information, information element is coded as shown in figure\u00a09.11.3.80.1, figure\u00a09.11.3.80.2, figure\u00a09.11.3.80.3 and table\u00a09.11.3.80.1.\nThe PEIPS assistance information is a type 4 information element, with a minimum length of 3 octets.\n\n\nFigure 9.11.3.80.1: PEIPS assistance information information element\n\nFigure 9.11.3.80.2: PEIPS assistance information type \u2013type of information= \"000\"\n\nFigure 9.11.3.80.3: PEIPS assistance information type \u2013type of information= \"001\"\nTable 9.11.3.80.1: PEIPS assistance information information element\n\n\n9.11.3.81\t5GS additional request result\nThe purpose of the 5GS additional request result information element is to inform the UE about the result of additional request.\nThe 5GS additional request result information element is coded as shown in figure\u00a09.11.3.81.1 and table\u00a09.11.3.81.1.\nThe 5GS additional request result is a type 4 information element with a length of 3 octets.\n\n\nFigure\u00a09.11.3.81.1: 5GS additional request result information element\nTable\u00a09.11.3.81.1: 5GS additional request result information element\n\n9.11.3.82\tNSSRG information\nThe purpose of the NSSRG information information element is to identify one or more NSSRG values associated with each of the HPLMN S-NSSAIs in a configured NSSAI.\nThe NSSRG information information element is coded as shown in figure\u00a09.11.3.82.1, figure\u00a09.11.3.82.2 and table\u00a09.11.3.82.1.\nThe NSSRG information is a type 6 information element with minimum length of 7 octets and maximum length of 4099 octets.\nFigure\u00a09.11.3.82.1: NSSRG information information element\nFigure\u00a09.11.3.82.2: NSSRG values for S-NSSAI\nTable\u00a09.11.3.82.1: NSSRG information information element\n\n9.11.3.83\tList of PLMNs to be used in disaster condition\nThe purpose of the list of PLMNs to be used in disaster condition information element is to provide the \"list of PLMN(s) to be used in disaster condition\" associated with the serving PLMN to the UE.\nThe list of PLMNs to be used in disaster condition information element is coded as shown in figures\u00a09.11.3.83.1 and 9.11.3.83.2 and table\u00a09.11.3.83.1.\nThe list of PLMNs to be used in disaster condition is a type 4 information element, with a minimum length of 2 octets.\nFigure\u00a09.11.3.83.1: List of PLMNs to be used in disaster condition information element\nFigure\u00a09.11.3.83.2: PLMN ID n\nTable\u00a09.11.3.83.1: List of PLMNs to be used in disaster condition information element\n\n9.11.3.84\tRegistration wait range\nThe purpose of the registration wait range information element is to provide the disaster roaming wait range or the disaster return wait range to the UE.\nThe registration wait range information element is coded as shown in figure\u00a09.11.3.84.1 and table\u00a09.11.3.84.1.\nThe registration wait range is a type 4 information element, with a length of 4 octets.\nFigure\u00a09.11.3.84.1: Registration wait range information element\nTable\u00a09.11.3.84.1: Registration wait range information element\n\n9.11.3.85\tPLMN identity\nThe purpose of the PLMN identity information element is to provide a PLMN identity.\nThe PLMN identity information element is coded as shown in figure\u00a09.11.3.85.1, and table\u00a09.11.3.85.1.\nThe PLMN identity is a type 4 information element.\n\nFigure\u00a09.11.3.85.1: PLMN identity information element\nTable\u00a09.11.3.85.1: PLMN identity information element\n\n9.11.3.86\tExtended CAG information list\nThe purpose of the Extended CAG information list information element is to provide \"CAG information list\" or to delete the \"CAG information list\" at the UE.\nThe Extended CAG information list information element is coded as shown in figures\u00a09.11.3.86.1, figure 9.11.3.86.2, figure\u00a09.11.3.86.3, figure\u00a09.11.3.86.4, figure\u00a09.11.3.86.5 and table\u00a09.11.3.86.1.\nThe Extended CAG information list is a type 6 information element, with a minimum length of 3 octets.\nFigure\u00a09.11.3.86.1: Extended CAG information list information element\n\nNOTE:\tThe field is placed immediately after the last present preceding field.\n\nFigure\u00a09.11.3.86.2: Entry n\nFigure\u00a09.11.3.86.3: CAG-ID with additional information list\n\nNOTE:\tThe field is placed immediately after the last present preceding field.\n\nFigure\u00a09.11.3.86.4: CAG-ID with additional information\nFigure\u00a09.11.3.86.5: Time validity infomation\nTable\u00a09.11.3.86.1: Extended CAG information list information element\n\n9.11.3.87\tNSAG information\nThe purpose of the NSAG information information element is to provide the NSAG information to the UE.\nThe NSAG information information element is coded as shown in figures\u00a09.11.3.87.1, 9.11.3.87.2 and 9.11.3.87.3, and table\u00a09.11.3.87.1.\nThe NSAG information information element can contain a maximum of 32 NSAG entries.\nIn the NSAG information information element, at most 4 NSAG entries can contain a TAI list.\nThe NSAG information is a type 6 information element, with a minimum length of 9 octets and a maximum length of 3143 octets.\nFigure\u00a09.11.3.87.1: NSAG information information element\nFigure\u00a09.11.3.87.2: NSAG\nFigure\u00a09.11.3.87.3: S-NSSAI list of NSAG\nTable\u00a09.11.3.87.1: NSAG information information element\n\n9.11.3.88\tProSe relay transaction identity\nThe purpose of the ProSe relay transaction identity (PRTI) information element is to uniquely identify an authentication and key agreement procedure for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay. The PRTI allows distinguishing up to 254 different bi-directional messages.\nThe ProSe relay transaction identity information element is coded as shown in figure\u00a09.11.3.88.1 and table\u00a09.11.3.88.1.\nThe ProSe relay transaction identity is a type 3 information element with a length of 2 octets.\nFigure\u00a09.11.3.88.1: ProSe relay transaction identity information element\nTable\u00a09.11.3.88.1: ProSe relay transaction identity information element\n\n9.11.3.89\tRelay key request parameters\nThe purpose of the relay key request parameters information element is to transport the parameters of the key request for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay as specified in 3GPP\u00a0TS\u00a033.503\u00a0[56].\nThe relay key request parameters information element is coded as shown in figure\u00a09.11.3.89.1, figure\u00a09.11.3.89.2 and table\u00a09.11.3.89.1.\nThe relay key request parameters is a type 6 information element.\nFigure\u00a09.11.3.89.1: Relay key request parameters information element\nFigure\u00a09.11.3.89.2: UE identity\nTable\u00a09.11.3.89.1: Relay key request parameters information element\n\n9.11.3.90\tRelay key response parameters\nThe purpose of the relay key response parameters information element is to transport the parameters of the key response for 5G ProSe UE-to-network relay or 5G ProSe UE-to-UE relay as specified in 3GPP\u00a0TS\u00a033.503\u00a0[56].\nThe relay key response parameters information element is coded as shown in figure\u00a09.11.3.90.1 and table\u00a09.11.3.90.1.\nThe relay key response parameters is a type 6 information element.\nFigure\u00a09.11.3.90.1: Relay key response parameters information element\nTable\u00a09.11.3.90.1: Relay key response parameters information element\n\n9.11.3.91\tPriority indicator\nThe purpose of the Priority indicator information element is to convey a priority indication to the UE.\nThe Priority indicator information element is coded as shown in figure\u00a09.11.3.91.1 and table\u00a09.11.3.91.1.\nThe Priority indicator is a type 1 information element.\nFigure\u00a09.11.3.91.1: Priority indicator\nTable\u00a09.11.3.91.1: Priority indicator\n9.11.3.92\tSNPN list\nThe purpose of the SNPN list information element is to provide a list of SNPN identities.\nThe SNPN list information element is coded as shown in figure\u00a09.11.3.92.1, table\u00a09.11.3.92.1, figure\u00a09.11.3.92.2 and table\u00a09.11.3.92.2.\nThe SNPN list is a type 4 information element with a minimum length of 11 octets and a maximum length of 137 octets.\nFigure\u00a09.11.3.92.1: SNPN list information element\nTable\u00a09.11.3.92.1: SNPN list information element\n\nFigure\u00a09.11.3.92.2: SNPN identity i\nTable\u00a09.11.3.92.2: SNPN identity i\n\n9.11.3.93\tN3IWF identifier\nThe purpose of the N3IWF identifier information element is to enable the network to assign the UE, a suitable N3IWF for the requested NSSAI.\nThe N3IWF identifier information element is coded as shown in figure\u00a09.11.3.93.1, figure\u00a09.11.3.93.2, figure\u00a09.11.3.93.3 and table\u00a09.11.3.93.1.\nThe N3IWF identifier information element is a type 4 information element with a minimum length of 7 octets.\n\nFigure\u00a09.11.3.93.1: N3IWF identifier information element\n\nFigure\u00a09.11.3.93.2: N3IWF address entry (N3IWF identifier type = \"IPv4\", \"IPv6\" or \"IPv4v6\")\n\nFigure\u00a09.11.3.93.3: N3IWF identifier entry (N3IWF identifiertype =\"FQDN\")\n\nTable\u00a09.11.3.93.1: N3IWF address entry\n\n9.11.3.94\tTNAN information\nThe purpose of the TNAN information information element is to enable the network to assign the UE, a suitable TNAN information (SSID and TNGF identifier) for the requested NSSAI.\nThe TNAN information information element is coded as shown in figure\u00a09.11.3.94.1 and table\u00a09.11.3.94.1.\nThe TNAN information information element is a type 4 information element with a minimum length of 3 octets.\nFigure\u00a09.11.3.94.1: TNAN information information element\nTable\u00a09.11.3.94.1: TNAN information information element\n\n9.11.3.95\tRAN timing synchronization\nThe purpose of the RAN timing synchronization IE is to provide information related to the RAN timing synchronization.\nThe RAN timing synchronization information element is coded as shown in figure\u00a09.11.3.95.1 and table\u00a09.11.3.95.1.\nThe RAN timing synchronization is a type 4 information element with a length of 3 octets.\nFigure\u00a09.11.3.95.1: RAN timing synchronization information element\nTable\u00a09.11.3.95.1: RAN timing synchronization information element\n\n9.11.3.96\tExtended LADN information\nThe purpose of the Extended LADN information information element is to provide the UE with the LADN service area for each available LADN associated for an LADN DNN and an S-NSSAI in the current registration area or to delete the Extended LADN information at the UE.\nThe Extended LADN information information element is coded as shown in figure\u00a09.11.3.96.1, figure\u00a09.11.3.96.2 and table\u00a09.11.3.96.1.\nThe Extended LADN information is a type 6 information element with a minimum length of 3 octets and a maximum length of 1787 octets.\nThe Extended LADN information information element can contain a minimum of 0 and a maximum of 8 different LADNs each including a DNN, an S-NSSAI and a 5GS tracking area identity list.\nFigure\u00a09.11.3.96.1: Extended LADN information information element\nFigure\u00a09.11.3.96.2: LADN\nTable\u00a09.11.3.96.1: Extended LADN information information element\n\n9.11.3.97\tAlternative NSSAI\nThe purpose of the Alternative NSSAI information element is to identify a list of mapping information between the S-NSSAI to be replaced and the alternative S-NSSAI.\nThe Alternative NSSAI information element is coded as shown in figure\u00a09.11.3.97.1, figure\u00a09.11.3.97.2 and table\u00a09.11.3.97.1.\nThe Alternative NSSAI is a type 4 information element with minimum length of 2 octets and maximum length of 146 octets.\nFigure\u00a09.11.3.97.1: Alternative NSSAI information element\nFigure\u00a09.11.3.97.2: Entry\nTable\u00a09.11.3.97.1: Alternative NSSAI information element\n\n9.11.3.98\tType 6 IE container\nThe purpose of the Type 6 IE container information element is to transfer type 6 IEs of format TLV-E explicitly specified for inclusion in this information element for the respective message.\nNOTE:\tUse of this information element is intended only for type 6 IEs added to a message in Rel-18 or later.\nThe rules for the IEI value encoding specified in 3GPP\u00a0TS\u00a024.007\u00a0[11], subclause\u00a011.2.4, are not applicable for the IEIs of the type 6 IEs within the Type 6 IE container information element. These IEIs can take any value in the range 00 to FF (hexadecimal).\nThe type 6 IE container information element is coded as shown in figure\u00a09.11.3.98.1, figure\u00a09.11.3.98.2 and table\u00a09.11.3.98.1.\nThe type 6 IE container is a type 6 information element with a minimum length of 6 octets.\nFigure\u00a09.11.3.98.1: Type 6 IE container information element\n\nFigure\u00a09.11.3.98.2: Type 6 IE container contents\nTable\u00a09.11.3.98.1: Type 6 IE container contents\n\n9.11.3.99\tNon-3GPP access path switching indication\nThe purpose of the Non-3GPP access path switching indication information element is to indicate whether the UE supports the non-3GPP access path switching for the PDU session.\nThe Non-3GPP access path switching indication information element is coded as shown in figure\u00a09.11.3.99.1 and table\u00a09.11.3.99.1.\nThe Non-3GPP access path switching indication is a type 4 information element with a length of 3 octets.\nFigure\u00a09.11.3.99.1: Non-3GPP access path switching indication information element\nTable\u00a09.11.3.99.1\u00a0: Non-3GPP access path switching indication information element\n\n9.11.3.100\tS-NSSAI location validity information\nThe purpose of the S-NSSAI location validity information information element is to provide the S-NSSAI location validity information to the UE.\nThe S-NSSAI location validity information information element is coded as shown in figures\u00a09.11.3.100.1, 9.11.3.100.2, 9.11.3.100.3, and 9.11.3.100.4 and table\u00a09.11.3.100.1.\nThe S-NSSAI location validity information information element can contain per-S-NSSAI location validity information for maximum 8 S-NSSAIs.\nThe S-NSSAI location validity information information is a type 6 information element with a minimum length of 25 octets and a maximum length of 19307 octets.\nFigure\u00a09.11.3.100.1: S-NSSAI location validity information information element\nFigure\u00a09.11.3.100.2: Per-S-NSSAI location validity information for S-NSSAI\n\nFigure\u00a09.11.3.100.3: NS-AoS\n\nFigure\u00a09.11.3.100.4: NR CGI\nTable\u00a09.11.3.100.1: S-NSSAI location validity information information element\n\n9.11.3.101\tS-NSSAI time validity information\nThe purpose of the S-NSSAI time validity information information element is to provide S-NSSAI time validity information of one or more S-NSSAIs to the UE.\nThe S-NSSAI time validity information information element is coded as shown in figures\u00a09.11.3.101.1 and 9.11.3.101.2 and table\u00a09.11.3.101.1.\nThe S-NSSAI time validity information information element can contain per-S-NSSAI time validity information for maximum 16 S-NSSAIs.\nThe S-NSSAI time validity information information is a type 4 information element with a minimum length of 23 octets and a maximum length of 257 octets.\nFigure\u00a09.11.3.101.1: S-NSSAI time validity information information element\nFigure\u00a09.11.3.101.2: Per-S-NSSAI time validity information for S-NSSAI 1\nFigure\u00a09.11.3.101.3: Per-S-NSSAI time validity information for the S-NSSAI\nFigure\u00a09.11.3.101.4: Time window 1\nTable\u00a09.11.3.101.1: S-NSSAI time validity information information element\n\n9.11.3.102\tNon-3GPP path switching information\nThe purpose of the Non-3GPP path switching information information element is to request from the network to keep using the user plane resources of the old non-3GPP access during path switching to the new non-3GPP access.\nThe Non-3GPP path switching information information element is coded as shown in figure\u00a09.11.3.102.1 and table\u00a09.11.3.102.1.\nThe Non-3GPP path switching information is a type 4 information element with a length of 3 octets.\n\nFigure\u00a09.11.3.102.1: Non-3GPP path switching information information element\nTable\u00a09.11.3.102.1: Non-3GPP path switching information information element\n\n9.11.3.103\tPartial NSSAI\nThe purpose of the Partial NSSAI information element is to deliver one or more S-NSSAIs in a set of tracking areas of a registration area from the network to the UE.\nThe Partial NSSAI information element is coded as shown in figure\u00a09.11.3.103.1, and table\u00a09.11.3.103.1.\nThe Partial NSSAI information element is a type 6 information element, with a minimum length of 3 octets and a maximum length of 808 octets.\n\nFigure\u00a09.11.3.103.1: Partial NSSAI information element\nTable\u00a09.11.3.103.1: Partial NSSAI information element\n\n9.11.3.104\tAUN3 indication\nThe purpose of the AUN3 indication information element is to indicate to the network that the registration request by the 5G-RG is on behalf of an AUN3 device.\nThe AUN3 indication information element is coded as shown in figure\u00a09.11.3.104.1 and table\u00a09.11.3.104.1.\nThe AUN3 indication is a type 4 information element with a length of 3 octets.\nFigure\u00a09.11.3.104.1: AUN3 indication information element\nTable\u00a09.11.3.104.1: AUN3 indication information element\n9.11.3.105\tFeature authorization indication\nThe purpose of the Feature authorization indication information element is to indicate whether the UE that is authorized to operate certain feature.\nThe Feature authorization indication is a type 4 information element with a minimum length of 3 octets and maximum length of 257 octets.\nThe Feature authorization indication information element is coded as shown in Figure\u00a09.11.3.105.1 and Table\u00a09.11.3.105.1.\nFigure\u00a09.11.3.105.1: Feature authorization indication information element\nTable\u00a09.11.3.105.1: Feature authorization indication information element\n\n9.11.3.106\tPayload container information\nThe purpose of the Payload container information information element is to provide information related to a payload container.\nThe Payload container information is a type 1 information element.\nThe Payload container information information element is coded as shown in figure\u00a09.11.3.106.1 and table\u00a09.11.3.106.1.\n\nFigure\u00a09.11.3.106.1: Payload container information information element\nTable\u00a09.11.3.106.1: Payload container information information element\n\n9.11.3.107\tAUN3 device security key\nThe purpose of the AUN3 device security key information element is to provide the security keys to the 5G-RG that is acting on behalf of an AUN3 device.\nThe AUN3 device security key information element is coded as shown in figure\u00a09.11.3.107.1 and table\u00a09.11.3.107.1.\nThe AUN3 device security key is a type 4 information element with a minimum length of 36 octets.\nFigure\u00a09.11.3.107.1: AUN3 device security key information element\nTable\u00a09.11.3.107.1: AUN3 device security key information element\n9.11.3.108\tOn-demand NSSAI\nThe purpose of the On-demand NSSAI information element is to provide a list of one or more on-demand S-NSSAIs and the associated slice deregistration inactivity timer value per the on-demand S-NSSAI to the UE.\nThe On-demand NSSAI information element is coded as shown in figure\u00a09.11.3.108.1, figure\u00a09.11.3.108.2, and table\u00a09.11.3.108.1.\nThe On-demand NSSAI is a type 4 information element with a minimum length of 5 octets and a maximum length of 210 octets.\nFigure\u00a09.11.3.108.1: On-demand NSSAI information element\nFigure\u00a09.11.3.108.2: Information of on-demand S-NSSAI\nTable\u00a09.11.3.108.1: On-demand NSSAI information element\n\n9.11.4\t5GS session management (5GSM) information elements\n9.11.4.1\t5GSM capability\nThe purpose of the 5GSM capability information element is to indicate UE capability related to the PDU session management.\nThe 5GSM capability information element is coded as shown in figure\u00a09.11.4.1.1 and table\u00a09.11.4.1.1.\nThe 5GSM capability is a type 4 information element with a minimum length of 3 octets and a maximum length of 15 octets.\nFigure\u00a09.11.4.1.1: 5GSM capability information element\nTable\u00a09.11.4.1.1: 5GSM capability information element\n\n9.11.4.2\t5GSM cause\nThe purpose of the 5GSM cause information element is to indicate the reason why a 5GSM request is rejected.\nThe 5GSM cause information element is coded as shown in figure\u00a09.11.4.2.1 and table\u00a09.11.4.2.1.\nThe 5GSM cause is a type 3 information element with a length of 2 octets.\nFigure\u00a09.11.4.2.1: 5GSM cause information element\nTable\u00a09.11.4.2.1: 5GSM cause information element\n\n9.11.4.3\tAlways-on PDU session indication\nThe purpose of the Always-on PDU session indication information element is to indicate whether a PDU session is established as an always-on PDU session.\nThe Always-on PDU session indication information element is coded as shown in figure\u00a09.11.4.3.1 and table\u00a09.11.4.3.1.\nThe Always-on PDU session indication is a type 1 information element.\nFigure\u00a09.11.4.3.1: Always-on PDU session indication\nTable\u00a09.11.4.3.1: Always-on PDU session indication\n\n9.11.4.4\tAlways-on PDU session requested\nThe purpose of the Always-on PDU session requested information element is to indicate whether a PDU session is requested to be established as an always-on PDU session.\nThe Always-on PDU session requested information element is coded as shown in figure\u00a09.11.4.4.1 and table\u00a09.11.4.4.1.\nThe Always-on PDU session requested is a type 1 information element.\nFigure\u00a09.11.4.4.1: Always-on PDU session requested\nTable\u00a09.11.4.4.1: Always-on PDU session requested\n\n9.11.4.5\tAllowed SSC mode\nThe purpose of the Allowed SSC mode information element is to indicate the SSC modes allowed to be used by the UE for the PDU session.\nThe Allowed SSC mode information element is coded as shown in figure\u00a09.11.4.5.1 and table\u00a09.11.4.5.1.\nThe Allowed SSC mode is a type 1 information element.\nFigure\u00a09.11.4.5.1: Allowed SSC mode information element\nTable\u00a09.11.4.5.1: Allowed SSC mode information element\n\n9.11.4.6\tExtended protocol configuration options\nSee subclause\u00a010.5.6.3A in 3GPP\u00a0TS\u00a024.008\u00a0[12].\n9.11.4.7\tIntegrity protection maximum data rate\nThe purpose of the integrity protection maximum data rate information element is for the UE to indicate to the network the maximum data rate per UE for user-plane integrity protection for uplink and the maximum data rate per UE for user-plane integrity protection for downlink that are supported by the UE.\nThe integrity protection maximum data rate is coded as shown in figure\u00a09.11.4.7.1 and table\u00a09.11.4.7.2.\nThe integrity protection maximum data rate is a type 3 information element with a length of 3 octets.\nFigure\u00a09.11.4.7.1: Integrity protection maximum data rate information element\nTable\u00a09.11.4.7.2: Integrity protection maximum data rate information element\n\n9.11.4.8\tMapped EPS bearer contexts\nThe purpose of the mapped EPS bearer contexts information element is to indicate a set of EPS bearer contexts for a PDU session, as described in subclause\u00a06.1.4.1.\nThe mapped EPS bearer contexts information element is a type 6 information element with a minimum length of 7 octet and a maximum length of 65538 octets.\nThe mapped EPS bearer contexts information element is coded as shown in figure\u00a09.11.4.8.1, figure\u00a09.11.4.8.2, figure\u00a09.11.4.8.3 and table\u00a09.11.4.8.1.\nFigure\u00a09.11.4.8.1: Mapped EPS bearer contexts\nFigure\u00a09.11.4.8.2: Mapped EPS bearer context\n\nFigure\u00a09.11.4.8.3: EPS parameters list\nTable\u00a09.11.4.8.1: Mapped EPS bearer contexts information element\n\n9.11.4.9\tMaximum number of supported packet filters\nThe purpose of the Maximum number of supported packet filters information element is for the UE to indicate to the network the maximum number of packet filters, associated with signaled QoS rules, that can be supported by the UE for the PDU session that is being established, when the PDU session type \"IPv4\", \"IPv6\", \"IPv4v6\" or \"Ethernet\".\nThe Maximum number of supported packet filters is coded as shown in figure\u00a09.11.4.9.1 and table\u00a09.11.4.9.1.\nThe Maximum number of supported packet filters is a type 3 information element with a length of 3 octets.\nFigure\u00a09.11.4.9.1: Maximum number of supported packet filters information element\nTable\u00a09.11.4.9.1: Maximum number of supported packet filters information element\n\n9.11.4.10\tPDU address\nThe purpose of the PDU address information element is to assign to the UE:\n-\tan IPv4 address associated with a PDU session;\n-\tan interface identifier for the IPv6 link local address associated with the PDU session; or\n-\tan IPv4 address and an interface identifier for the IPv6 link local address, associated with the PDU session.\nThis purpose of the PDU address information element is also to enable the W-AGF acting on behalf of the FN-RG to provide an interface identifier for the IPv6 link local address associated with the PDU session suggested to be allocated to the FN-RG, and to enable the SMF to provide SMF's IPv6 link local address to the W-AGF acting on behalf of the FN-RG.\nThe PDU address information element is coded as shown in figure\u00a09.11.4.10.1 and table\u00a09.11.4.10.1.\nThe PDU address is a type 4 information element with minimum length of 7 octets and a maximum length of 31 octets.\nFigure\u00a09.11.4.10.1: PDU address information element\nTable\u00a09.11.4.10.1: PDU address information element\n\n9.11.4.11\tPDU session type\nThe purpose of the PDU session type information element is to indicate type of the PDU session.\nThe PDU session type information element is coded as shown in figure\u00a09.11.4.11.1 and table\u00a09.11.4.11.1.\nThe PDU session type is a type 1 information element.\nFigure\u00a09.11.4.11.1: PDU session type information element\nTable\u00a09.11.4.11.1: PDU session type information element\n\n9.11.4.12\tQoS flow descriptions\nThe purpose of the QoS flow descriptions information element is to indicate a set of QoS flow descriptions to be used by the UE, where each QoS flow description is a set of parameters as described in subclause 6.2.5.1.1.4.\nThe QoS flow descriptions information element is a type 6 information element with a minimum length of 6 octets. The maximum length for the information element is 65538 octets.\nThe QoS flow descriptions information element is coded as shown in figure\u00a09.11.4.12.1, figure\u00a09.11.4.12.2, figure\u00a09.11.4.12.3, figure\u00a09.11.4.12.4, and table\u00a09.11.4.12.1.\nFigure\u00a09.11.4.12.1: QoS flow descriptions information element\n\nFigure\u00a09.11.4.12.2: QoS flow description \nFigure\u00a09.11.4.12.3: Parameters list\nFigure\u00a09.11.4.12.4: Parameter\nTable\u00a09.11.4.12.1: QoS flow descriptions information element\n\n9.11.4.13\tQoS rules\nThe purpose of the QoS rules information element is to indicate a set of QoS rules to be used by the UE, where each QoS rule is a set of parameters as described in subclause\u00a06.2.5.1.1.2:\na)\tfor classification and marking of uplink user traffic; and\nb)\tfor identification of a QoS flow which the network is to use for a particular downlink user traffic.\nNOTE:\tThe UE needs to be aware of a QoS flow which the network is to use for a particular downlink user traffic e.g. to determine whether a resource is available for downlink media of a media stream of an SDP media description provided by the UE in an IMS session.\nThe QoS rules may contain a set of packet filters consisting of zero or more packet filters for UL direction, zero or more packet filters for DL direction, zero or more packet filters for both UL and DL directions or any combinations of these. The set of packet filters determine the traffic mapping to QoS flows.\nThe QoS rules information element is a type 6 information element with a minimum length of 7 octets. The maximum length for the information element is 65538 octets.\nThe QoS rules information element is coded as shown in figure\u00a09.11.4.13.1, figure\u00a09.11.4.13.2, figure\u00a09.11.4.13.3, figure\u00a09.11.4.13.4 and table\u00a09.11.4.13.1.\nFigure\u00a09.11.4.13.1: QoS rules information element\n\nFigure\u00a09.11.4.13.2: QoS rule (u=m+2)\n\nFigure\u00a09.11.4.13.3: Packet filter list when the rule operation is \"modify existing QoS rule and delete packet filters\" (m=N+7)\n\nFigure\u00a09.11.4.13.4: Packet filter list when the rule operation is \"create new QoS rule\", or \"modify existing QoS rule and add packet filters\" or \"modify existing QoS rule and replace all packet filters\"\nTable\u00a09.11.4.13.1: QoS rules information element\n\n9.11.4.14\tSession-AMBR\nThe purpose of the Session-AMBR information element is to indicate the initial subscribed PDU session aggregate maximum bit rate when the UE establishes a PDU session or to indicate the new subscribed PDU session aggregate maximum bit rate if it is changed by the network.\nThe Session-AMBR information element is coded as shown in figure\u00a09.11.4.14.1 and table\u00a09.11.4.14.1.\nThe Session-AMBR is a type 4 information element with a length of 8 octets.\nFigure\u00a09.11.4.14.1: Session-AMBR information element\nTable\u00a09.11.4.14.1: Session-AMBR information element\n\n9.11.4.15\tSM PDU DN request container\nThe purpose of the SM PDU DN request container information element is to carry a DN-specific identity of the UE in the network access identifier (NAI) format.\nThe SM PDU DN request container information element is coded as shown in figure\u00a09.11.4.15.1 and table\u00a09.11.4.15.1.\nThe SM PDU DN request container is a type 4 information element with minimal length of 3 octets and maximum length of 255 octets.\n\nFigure\u00a09.11.4.15.1: SM PDU DN request container information element\nTable\u00a09.11.4.15.1: SM PDU DN request container information element\n\n9.11.4.16\tSSC mode\nThe purpose of the SSC mode information element is to indicate SSC mode.\nThe SSC mode information element is coded as shown in figure\u00a09.11.4.16.1 and table\u00a09.11.4.16.1.\nThe SSC mode is a type 1 information element.\nFigure\u00a09.11.4.16.1: SSC mode information element\nTable\u00a09.11.4.16.1: SSC mode information element\n\n9.11.4.17\tRe-attempt indicator\nThe purpose of the Re-attempt indicator information element is to indicate a condition under which the UE is allowed in the current PLMN or its equivalent PLMN(s) or the current SNPN or its equivalent SNPNs for the same DNN, to re-attempt a session management procedure (see 3GPP\u00a0TS\u00a024.301\u00a0[15]) corresponding to the 5GS session management procedure which was rejected by the network.\nThe Re-attempt indicator information element is coded as shown in figure\u00a09.11.4.17.1 and table\u00a09.11.4.17.1.\nThe Re-attempt indicator is a type 4 information element with a length of 3 octets.\nFigure\u00a09.11.4.17.1: Re-attempt indicator\nTable\u00a09.11.4.17.1: Re-attempt indicator\n\n9.11.4.18\t5GSM network feature support\nThe purpose of the 5GSM network feature support information element is to indicate whether certain session management related features are supported by the network.\nThe 5GSM network feature support information element is coded as shown in figure\u00a09.11.4.18.1 and table\u00a09.11.4.18.1.\nThe 5GSM network feature support is a type 4 information element with a minimum length of 3 octets and a maximum length of 15 octets.\nFigure\u00a09.11.4.18.1: 5GSM network feature support information element\nTable\u00a09.11.4.18.1: 5GSM network feature support information element\n\n9.11.4.19\tVoid\n9.11.4.20\tServing PLMN rate control\nSee subclause\u00a09.9.4.28 in 3GPP\u00a0TS\u00a024.301\u00a0[15].\n9.11.4.21\t5GSM congestion re-attempt indicator\nThe purpose of the 5GSM congestion re-attempt indicator information element is to indicate whether the back-off timer is applied in the registered PLMN or all PLMNs or in the registered SNPN or all equivalent SNPNs, and additionally to indicate whether the back-off timer is applied in the current access type or both 3GPP access type and non-3GPP access type.\nThe 5GSM congestion re-attempt indicator information element is coded as shown in figure\u00a09.11.4.21.1 and table\u00a09.11.4.21.1.\nThe 5GSM congestion re-attempt indicator is a type 4 information element with a length of 3 octets.\nFigure\u00a09.11.4.21.1: 5GSM congestion re-attempt indicator\nTable\u00a09.11.4.21.1: 5GSM congestion re-attempt indicator\n\n9.11.4.22\tATSSS container\nThe purpose of the ATSSS container information element is to transfer parameters associated with ATSSS.\nThe ATSSS container information element is coded as shown in figure\u00a09.11.4.22.1 and table\u00a09.11.4.22.1.\nThe ATSSS container is a type 6 information element with a minimum length of 3 octets and a maximum length of 65538 octets.\nFigure\u00a09.11.4.22.1: ATSSS container information element\nTable\u00a09.11.4.22.1: ATSSS container information element\n\n9.11.4.23\tControl plane only indication\nThe purpose of the control plane only indication information element is to indicate that a PDU session is only for control plane CIoT 5GS optimization.\nThe control plane only indication information element is coded as shown in figure\u00a09.11.4.23.1.\nThe control plane only indication is a type 1 information element.\n\nFigure 9.11.4.23.1: Control plane only indication information element\nTable 9.11.4.23.1: Control plane only indication information element\n\n9.11.4.24\tIP header compression configuration\nThe purpose of the IP header compression configuration information element is to negotiate ROHC channel setup parameters specified in IETF\u00a0RFC\u00a05795\u00a0[39B] and, optionally, provide additional header compression context setup parameters.\nThe IP header compression configuration information element is coded as shown in figure\u00a09.11.4.24.1 and table\u00a09.11.4.24.1.\nThe IP header compression configuration is a type 4 information element with a minimum length of 5 octets and a maximum length of 257 octets.\nThe optional Additional IP header compression parameters container field conveys the additional header compression context setup parameters as specified in 3GPP\u00a0TS\u00a023.501\u00a0[8] in a generic container. This field corresponds to the profile-specific information in the header of the ROHC IR packet type in IETF\u00a0RFC\u00a05795\u00a0[39B].\n\n\nFigure\u00a09.11.4.24.1: IP header compression configuration information element\n\nTable\u00a09.11.4.24.1: IP header compression configuration information element\n\n9.11.4.25\tDS-TT Ethernet port MAC address\nThe purpose of the DS-TT Ethernet port MAC address information element is to signal the MAC address of the DS-TT Ethernet port used for a PDU session of \"Ethernet\" PDU session type.\nThe DS-TT Ethernet port MAC address information element is coded as shown in figure\u00a09.11.4.25.1 and table\u00a09.11.4.25.1.\nThe DS-TT Ethernet port MAC address is a type 4 information element with a length of 8 octets.\nFigure\u00a09.11.4.25.1: DS-TT Ethernet port MAC address information element\nTable\u00a09.11.4.25.1: DS-TT Ethernet port MAC address information element\n\n9.11.4.26\tUE-DS-TT residence time\nThe purpose of the UE-DS-TT residence time information element is to signal the time taken within the UE and the DS-TT to forward a packet i.e. between the ingress of the UE and the DS-TT port in the DL direction, or between the DS-TT port and the egress of the UE in the UL direction.\nThe UE- DS-TT residence time information element is coded as shown in figure\u00a09.11.4.26.1 and table\u00a09.11.4.26.1.\nThe UE-DS-TT residence time is a type 4 information element with a length of 10 octets.\nFigure\u00a09.11.4.26.1: UE-DS-TT residence time information element\nTable\u00a09.11.4.26.1: UE-DS-TT residence time information element\n\n9.11.4.27\tPort management information container\nThe purpose of the Port management information container information element is to transport a port management service message as specified in clause\u00a08 of 3GPP\u00a0TS\u00a024.539\u00a0[19BA].\nThe Port management information container information element is coded as shown in figure\u00a09.11.4.27.1 and table\u00a09.11.4.27.1.\nThe Port management information container is a type 6 information element with a minimum length of 4 octets and a maximum length of 65538 octets.\nFigure\u00a09.11.4.27.1: Port management information container information element\nTable\u00a09.11.4.27.1: Port management information container information element\n\n9.11.4.28\tEthernet header compression configuration\nThe purpose of the Ethernet header compression configuration information element is to negotiate the use of EHC and the length of the CID field in the EHC packet\u00a0(see 3GPP TS 38.323 [29]).\nThe Ethernet header compression configuration information element is coded as shown in figure\u00a09.11.4.28.1 and table\u00a09.11.4.28.1.\nThe Ethernet header compression configuration is a type 4 information element with the length of 3 octets.\n\n\nFigure\u00a09.11.4.28.1: Ethernet header compression configuration information element\nTable\u00a09.11.4.28.1: Ethernet header compression configuration information element\n\n9.11.4.29\tRemote UE context list\nThe purpose of the Remote UE context list information element is to provide identity and optionally IP address of a 5G ProSe remote UE connected to, or disconnected from, a UE acting as a 5G ProSe layer-3 UE-to-network relay.\nThe Remote UE context list information element is coded as shown in figure\u00a09.11.4.29.1, figure\u00a09.11.4.29.2, table\u00a09.11.4.29.1 and table\u00a09.11.4.29.2.\nThe Remote UE context list is a type 6 information element with a minimum length of 16 octets and a maximum length of 65538 octets.\n\nFigure\u00a09.11.4.29.1: Remote UE context list\nTable\u00a09.11.4.29.1: Remote UE context list\n\n\nFigure\u00a09.11.4.29.2: Remote UE context\nTable\u00a09.11.4.29.2: Remote UE context\n\n9.11.4.30\tRequested MBS container\nThe purpose of the Requested MBS container information element is for UE to request to join or leave one or more multicast MBS sessions.\nThe Requested MBS container information element is coded as shown in figure\u00a09.11.4.30.1, figure\u00a09.11.4.30.2, figure\u00a09.11.4.30.3, figure\u00a09.11.4.30.4 and table\u00a09.11.4.30.1.\nThe Requested MBS container is a type 6 information element with a minimum length of 8 octets and a maximum length of 65538 octets.\n\n\nFigure\u00a09.11.4.30.1: Requested MBS container information element\n\n\nFigure\u00a09.11.4.30.2: multicast MBS session information\n\n\nFigure\u00a09.11.4.30.3: multicast MBS session ID for Type of multicast MBS session ID = \"Temporary Mobile Group Identity (TMGI)\"\n\n\nFigure\u00a09.11.4.30.4: multicast MBS session ID for Type of multicast MBS session ID = \"Source specific IP multicast address for IPv4\" or \"Source specific IP multicast address for IPv6\"\nTable\u00a09.11.4.30.1: Requested MBS container information element\n\n9.11.4.31\tReceived MBS container\nThe purpose of the Received MBS container information element is to indicate to the UE the information of the multicast MBS sessions that the network accepts or rejects the UE to join, the information of the multicast MBS sessions that the UE is removed from, or the information of the updated MBS service area.\nThe Received MBS container information element is coded as shown in figure\u00a09.11.4.31.1, figure\u00a09.11.4.31.2, figure\u00a09.11.4.31.3, figure\u00a09.11.4.31.4, figure\u00a09.11.4.31.5, figure\u00a09.11.4.31.6, figure\u00a09.11.4.31.7, figure\u00a09.11.4.31.8, figure\u00a09.11.4.31.9, figure\u00a09.11.4.31.10, figure\u00a09.11.4.31.11 and table\u00a09.11.4.31.1.\nThe Received MBS container is a type 6 information element with a minimum length of 9 octets and a maximum length of 65538 octets.\n\n\nFigure\u00a09.11.4.31.1: Received MBS container information element\n\n\nFigure\u00a09.11.4.31.2: Received MBS information\n\n\nFigure\u00a09.11.4.31.3: MBS service area for MBS service area indication = \"MBS service area included as MBS TAI list\"\n\n\nFigure\u00a09.11.4.31.4: MBS service area for MBS service area indication = \"MBS service area included as NR CGI list\"\n\n\nFigure\u00a09.11.4.31.5: MBS service area for MBS service area indication = \"MBS service area included as MBS TAI list and NR CGI list\"\n\n\nFigure\u00a09.11.4.31.6: NR CGI list\n\n\nFigure\u00a09.11.4.31.7: NR CGI\n\n\nFigure\u00a09.11.4.31.8: MBS timers for MBS timer indication = \"MBS start time\"\n\n\nFigure\u00a09.11.4.31.9: MBS timers for MBS timer indication = \"MBS back-off timer\"\n\n\nFigure\u00a09.11.4.31.10: MBS security container\n\n\nFigure\u00a09.11.4.31.11: MBS security keys set\nTable\u00a09.11.4.31.1: Received MBS container information element\n\n9.11.4.32\tPDU session pair ID\nThe purpose of the PDU session pair ID information element is to indicate a PDU session pair ID.\nThe PDU session pair ID information element is coded as shown in figure\u00a09.11.4.32.1 and table\u00a09.11.4.32.1.\nThe PDU session pair ID is a type 4 information element with a length of 3 octets.\nFigure\u00a09.11.4.32.1: PDU session pair ID information element\nTable\u00a09.11.4.32.1: PDU session pair ID information element\n\n9.11.4.33\tRSN\nThe purpose of the RSN information element is to indicate an RSN.\nThe RSN information element is coded as shown in figure\u00a09.11.4.33.1 and table\u00a09.11.4.33.1.\nThe RSN is a type 4 information element with a length of 3 octets.\nFigure\u00a09.11.4.33.1: RSN information element\nTable\u00a09.11.4.33.1: RSN information element\n\n9.11.4.34\tECS address\nThe purpose of the ECS address information element is to indicate the ECS address (either IPv4 address, IPv6 address, or FQDN) and the associated spatial validity condition.\nThe ECS address information element is coded as shown in figure\u00a09.11.4.34.1, figure\u00a09.11.4.34.2, table\u00a09.11.4.34.1, and table\u00a09.11.4.34.2.\nThe ECS address information element is a type 6 information element with minimum length of 8 octets and a maximum length of 65538 octets.\n\nFigure\u00a09.11.4.34.1: ECS address information element \nFigure\u00a09.11.4.34.2: Spatial validity condition contents\n\nTable\u00a09.11.4.34.1: ECS address information element \n\nTable\u00a09.11.4.34.2: Spatial validity condition contents\n\n9.11.4.35\tVoid\n9.11.4.36\tN3QAI\nThe purpose of the N3QAI information element is to indicate a set of QoS parameters to be used by the UE for non-3GPP access network resource management behind the UE.\nThe N3QAI information element is a type 6 information element with a minimum length of 9 octets. The maximum length for the information element is 65538 octets.\nThe N3QAI information element is coded as shown in figure\u00a09.11.4.36.1, figure\u00a09.11.4.36.2, figure\u00a09.11.4.36.3, figure\u00a09.11.4.36.4, and table\u00a09.11.4.36.1.\nFigure\u00a09.11.4.36.1: N3QAI information element\n\nFigure\u00a09.11.4.36.2: N3QAI \nFigure\u00a09.11.4.36.3: N3QAI parameters list\nFigure\u00a09.11.4.36.4: N3QAI parameter\nTable\u00a09.11.4.36.1: N3QAI information element\n\n9.11.4.37\tNon-3GPP delay budget\nThe purpose of the Non-3GPP delay budget information element is to indicate the non-3GPP delay budget for the non-3GPP network behind the UE to the network.\nThe Non-3GPP delay budget information element is a type 6 information element with a minimum length of 8 octets. The maximum length for the information element is 65538 octets.\nThe Non-3GPP delay budget information element is coded as shown in figure\u00a09.11.4.37.1.\nFigure\u00a09.11.4.37.1: Non-3GPP delay budget information element\nFigure\u00a09.11.4.37.2: Non-3GPP delay budget\nTable\u00a09.11.4.37.1: Non-3GPP delay budget information element\n\n9.11.4.38\tURSP rule enforcement reports\nThe purpose of the URSP rule enforcement reports information element is to provide one or more URSP rule enforcement reports to the network. Each URSP rule enforcement report includes all the connection capabilities contained in the traffic descriptor of each URSP rule associated to the PDU session.\nThe URSP rule enforcement reports information element is coded as shown in figure\u00a09.11.4.38.1, figure\u00a09.11.4.38.2, and table\u00a09.11.4.38.1.\nThe URSP rule enforcement reports is a type 4 information element with a minimum length of 4 octets.\nFigure\u00a09.11.4.38.1: URSP rule enforcement reports information element\nFigure\u00a09.11.4.38.2: URSP rule enforcement report\nTable\u00a09.11.4.38.1: URSP rule enforcement reports information element\n\n9.11.4.39\tProtocol description\nThe purpose of the Protocol description information element is to provide protocol description for UL PDU set handling to the UE.\nThe Protocol description information element is a type 6 information element with a minimum length of 7 octets.\nThe Protocol description information element is coded as shown in figure\u00a09.11.4.39.1, figure\u00a09.11.4.39.2, figure\u00a09.11.4.39.3, figure\u00a09.11.4.39.4, and table\u00a09.11.4.39.1.\nFigure\u00a09.11.4.39.1: Protocol description information element\n\nFigure\u00a09.11.4.39.2: Protocol description\n\nFigure\u00a09.11.4.39.3: RTP payload information list\n\nFigure\u00a09.11.4.39.4: RTP payload information\n\nTable\u00a09.11.4.39.1: Protocol description information element\n\n9.12\t3GPP specific coding information defined within present document\n9.12.1\tServing network name (SNN)\nThe serving network name (SNN) is used:\n-\tin the Network name field of the AT_KDF_INPUT attribute defined in IETF\u00a0RFC\u00a05448\u00a0[40];\n-\tin KAUSF derivation function as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] annex\u00a0A; and\n-\tin RES* and XRES* derivation function as specified in 3GPP\u00a0TS\u00a033.501\u00a0[24] annex\u00a0A.\nSNN shall contain a UTF-8 string without terminating null characters.\nSNN is of maximum length of 1020 octets.\nSNN consists of SNN-service-code and SNN-network-identifier, delimited by a colon.\nSNN-network-identifier identifies the serving PLMN or the serving SNPN.\nMCC and MNC in the SNN-PLMN-ID are MCC and MNC of the serving PLMN. If the MNC of the serving PLMN has two digits, then a zero is added at the beginning.\nMCC and MNC in the SNN-SNPN-ID are MCC and MNC of the serving SNPN. If the MNC of the serving SNPN has two digits, then a zero is added at the beginning.\nSNN-NID contains an NID in hexadecimal digits.\nABNF syntax of SNN is specified in table\u00a09.12.1.1\nTable\u00a09.12.1.1: ABNF syntax of SNN\nSNN = SNN-service-code \":\" SNN-network-identifier\n\nSNN-service-code = %x35.47 ; \"5G\"\n\nSNN-network-identifier = SNN-PLMN-ID / SNN-SNPN-ID\n\nSNN-PLMN-ID = SNN-mnc-string SNN-mnc-digits \".\" SNN-mcc-string SNN-mcc-digits \".\" SNN-3gppnetwork-string \".\" SNN-org-string ; applicable when not operating in SNPN access operation mode.\n\nSNN-SNPN-ID = SNN-mnc-string SNN-mnc-digits \".\" SNN-mcc-string SNN-mcc-digits \".\" SNN-3gppnetwork-string \".\" SNN-org-string \":\" SNN-NID ; applicable when operating in SNPN access operation mode.\n\n\nSNN-mnc-digits = DIGIT DIGIT DIGIT ; MNC of the PLMN ID\n\nSNN-mcc-digits = DIGIT DIGIT DIGIT ; MCC of the PLMN ID\n\nSNN-mnc-string = %x6d.6e.63 ; \"mnc\" in lower case\n\nSNN-mcc-string = %x6d.63.63 ; \"mcc\" in lower case\n\nSNN-3gppnetwork-string = %x33.67.70.70.6e.65.74.77.6f.72.6b ; \"3gppnetwork\" in lower case\n\nSNN-org-string = %x6f.72.67 ; \"org\" in lower case\n\nSNN-NID = 11SNN-hexadecimal-digit ; NID in hexadecimal digits\n\nSNN-hexadecimal-digit = DIGIT / %x41 / %x42 / %x43 / %x44 / %x45 / %x46\n\nNOTE:\tSNN-service-code allows for distinguishing of ANID specified in 3GPP\u00a0TS\u00a024.302\u00a0[16] and SNN as either of SNN or ANID can be carried in the AT_KDF_INPUT attribute.\nEXAMPLE\u00a01:\tIn case of a PLMN, if PLMN ID contains MCC = 234 and MNC = 15, SNN is 5G:mnc015.mcc234.3gppnetwork.org.\nEXAMPLE\u00a02:\tIn case of an SNPN, if SNPN ID contains a PLMN ID of MCC = 234 and MNC = 15 and an NID of 123456ABCDEH, SNN is 5G:mnc015.mcc234.3gppnetwork.org:123456ABCDE.\n10\tList of system parameters\n10.1\tGeneral\nThe description of timers in the following tables should be considered a brief summary. The precise details are found in clauses\u00a04 to 6, which should be considered the definitive descriptions.\n10.2\tTimers of 5GS mobility management\nTimers of 5GS mobility management are shown in table\u00a010.2.1 and table\u00a010.2.2.\nNOTE:\tTimers T3324, T3346, T3245 and T3247 are defined in 3GPP\u00a0TS\u00a024.008\u00a0[12]. Timers T3444, T3445, T3447 and T3448 are defined in 3GPP\u00a0TS\u00a024.301\u00a0[15].\nTable\u00a010.2.1: Timers of 5GS mobility management \u2013 UE side\nTable\u00a010.2.2: Timers of 5GS mobility management \u2013 AMF side\n\n10.3\tTimers of 5GS session management\nTimers of 5GS session management are shown in table\u00a010.3.1 and table\u00a010.3.2.\nNOTE:\tTimer T3396 is defined in 3GPP\u00a0TS\u00a024.008\u00a0[12].\nTable\u00a010.3.1: Timers of 5GS session management \u2013 UE side\n\nNOTE\u00a01:\tThe back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer of timestamp.\nNOTE\u00a02:\tReference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation.\nTable\u00a010.3.2: Timers of 5GS session management \u2013 SMF side\n\n10.4\tVoid\n\nAnnex A (informative):\nCause values for 5GS mobility management\nA.1\tCauses related to UE identification\nCause #3 \u2013 Illegal UE\n\tThis 5GMM cause is sent to the UE when the network refuses service to the UE either because an identity of the UE is not acceptable to the network or because the UE does not pass the authentication check.\nCause #6 \u2013 Illegal ME\n\tThis 5GMM cause is sent to the UE if the ME used is not acceptable to the network, e.g. on the prohibited list.\nCause #9 \u2013 UE identity cannot be derived by the network.\n\tThis 5GMM cause is sent to the UE when the network cannot derive the UE's identity from the 5G-GUTI or 5G-S-TMSI because of e.g. no matching identity/context in the network, failure to validate the UE's identity due to integrity check failure of the received message.\nCause #10 \u2013 Implicitly de-registered\n\tThis 5GMM cause is sent to the UE either if the network has implicitly de-registered the UE, e.g. after the implicit de-registration timer has expired, or if the 5GMM context data related to the subscription does not exist in the AMF e.g. because of a AMF restart, or because of a registration request for mobility or registration update is routed to a new AMF.\nA.2\tCause related to subscription options\nCause #5 \u2013 PEI not accepted\n\tThis cause is sent to the UE if the network does not accept an initial registration procedure for emergency services using a PEI.\nCause #7 \u2013 5GS services not allowed\n\tThis 5GMM cause is sent to the UE when it is not allowed to operate 5GS services.\nCause #11 \u2013 PLMN not allowed\n\tThis 5GMM cause is sent to the UE if it requests service, or if the network initiates a de-registration request, in a PLMN where the UE, by subscription or due to operator determined barring, is not allowed to operate.\n\tThis 5GMM cause can also be sent to the UE when the disaster condition is no longer being applicable in the current location of the UE.\nCause #12 \u2013 Tracking area not allowed\n\tThis 5GMM cause is sent to the UE if it requests service, or if the network initiates a de-registration request, in a tracking area where the HPLMN or SNPN determines that the UE, by subscription, is not allowed to operate.\nNOTE\u00a01:\tIf 5GMM cause #12 is sent to a roaming subscriber the subscriber is denied service even if other PLMNs are available on which registration was possible.\nCause #13 \u2013 Roaming not allowed in this tracking area\n\tThis 5GMM cause is sent to a UE which requests service, or if the network initiates a de-registration request, in a tracking area of a PLMN or SNPN which by subscription offers roaming to that UE but not in that tracking area.\n\tThis 5GMM cause can also be sent to the UE when the disaster condition is no longer being applicable in the current location of the UE.\nCause #15 \u2013 No suitable cells in tracking area\n\tThis 5GMM cause is sent to the UE if it requests service, or if the network initiates a de-registration request, in a tracking area where the UE, by subscription, is not allowed to operate, but when it should find another allowed tracking area in the same PLMN or an equivalent PLMN or the same SNPN or an equivalent SNPN.\nNOTE\u00a02:\tCause #15 and cause #12 differ in the fact that cause #12 does not trigger the UE to search for another allowed tracking area on the same PLMN or SNPN.\nCause #27 \u2013 N1 mode not allowed\n\tThis 5GMM cause is sent to the UE if it requests service, or if the network initiates a de-registration request, in a PLMN or SNPN where the UE by subscription or operator policy, is not allowed to operate in N1 mode.\nCause #31 \u2013 Redirection to EPC required\n\tThis 5GMM cause is sent to the UE if it requests service in a PLMN where the UE by operator policy, is not allowed in 5GCN and redirection to EPC is required.\nCause #36 \u2013 IAB-node operation not authorized\n\tThis 5GMM cause is sent to the UE if a UE operating as an IAB-node requests service, or if the network initiates a de-registration procedure, in a PLMN or SNPN where the UE by subscription is not authorized for IAB operation.\nCause #72 \u2013 Non-3GPP access to 5GCN not allowed\n\tThis 5GMM cause is sent to the UE if it requests accessing 5GCN over non-3GPP access in a PLMN or SNPN, where the UE by subscription, is not allowed to access 5GCN over non-3GPP access.\nCause #74 \u2013 Temporarily not authorized for this SNPN\n\tThis 5GMM cause is sent to the UE if it requests access, or if the network initiates a de-registration procedure, in a cell belonging to an SNPN for which the UE has no subscription to operate or for which the UE is not allowed to operate onboarding services.\nCause #75 \u2013 Permanently not authorized for this SNPN\n\tThis 5GMM cause is sent to the UE if it requests access, or if the network initiates a de-registration procedure, in a cell belonging to an SNPN with a globally-unique SNPN identity for which the UE either has no subscription to operate, the UE's subscription has expired or the UE is not allowed to operate onboarding services.\nCause #76 \u2013 Not authorized for this CAG or authorized for CAG cells only\n\tThis 5GMM cause is sent to the UE if the UE requests access or de-registration:\ni)\tin a CAG cell with a CAG-ID which is not authorized based on the UE's \"allowed CAG list\" for the PLMN; or\nii)\tin a non-CAG cell, wherein the UE is only allowed to access 5GS via CAG cells\nCause #77 \u2013 Wireline access area not allowed\n\tThis 5GMM cause is sent to the 5G-RG or the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device) if the 5G-RG or the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device) request accessing 5GCN over a wireline access network belonging to a wireline access area, where the 5G-RG or the W-AGF acting on behalf of the FN-CRG (or on behalf of the N5GC device) are not allowed by subscription to access the 5GCN over the wireline access.\nCause #79 \u2013 UAS services not allowed\n\tThis 5GMM cause is sent to the UE to indicate that the request of UAS services is not allowed.\nCause #80 \u2013 Disaster roaming for the determined PLMN with disaster condition not allowed\n\tThis 5GMM cause is sent by the network in a PLMN where the UE has requested registration for disaster roaming service for the determined PLMN with disaster condition, but the AMF determines that it does not support providing disaster roaming services to the UE for the determined PLMN with disaster condition as roaming agreement for disaster roaming services with HPLMN of the UE does not exist, or the determined PLMN with disaster condition is a forbidden PLMN of the UE.\nCause #94 \u2013 User plane positioning not authorized\n\tThis 5GMM cause is sent to the UE if it requests the user plane positioning, where the UE by subscription is not authorized for user plane positioning.\nA.3\tCauses related to PLMN or SNPN specific network failures and congestion/authentication failures\nCause #20 \u2013 MAC failure\n\tThis 5GMM cause is sent to the network if the USIM detects that the MAC in the AUTHENTICATION REQUEST message is not fresh.\nCause #21 \u2013 Synch failure\n\tThis 5GMM cause is sent to the network if the USIM detects that the SQN in the AUTHENTICATION REQUEST message is out of range.\nCause #22 \u2013 Congestion\n\tThis 5GMM cause is sent to the UE because of congestion in the network (e.g. no channel, facility busy/congested etc.).\nCause #23 \u2013 UE security capabilities mismatch\n\tThis 5GMM cause is sent to the network if the UE detects that the UE security capability does not match the one sent back by the network.\nCause #24 \u2013 Security mode rejected, unspecified\n\tThis 5GMM cause is sent to the network if the security mode command is rejected by the UE for unspecified reasons.\nCause #26 \u2013 Non-5G authentication unacceptable\n\tThis 5GMM cause is sent to the network in N1 mode if the \"separation bit\" in the AMF field of AUTN is set to 0 in the AUTHENTICATION REQUEST message (see 3GPP\u00a0TS\u00a033.501\u00a0[24]).\nCause #28 \u2013 Restricted service area\n\tThis 5GMM cause is sent to the UE if it requests service in a tracking area of the 3GPP access or in an area of the wireline access, which is a part of the UE's non-allowed area or is not a part of the UE's allowed area.\nCause #43 \u2013 LADN not available\n\tThis 5GMM cause is sent to the UE if the user-plane resources of the PDU session are not established when the UE is located outside the LADN service area.\nCause #62 \u2013 No network slices available\n\tThis 5GMM cause is sent by the network if there are no available network slices allowed for use by the UE.\nNOTE:\tNetwork does not send this cause in REGISTRATION REJECT message if the UE does not include a requested NSSAI in the REGISTRATION REQUEST message. In that case, if the UE is not registered for onboarding services in SNPN, the network uses other causes (e.g. #13, #15, etc.) based on the subscription.\nCause #65 \u2013 Maximum number of PDU sessions reached\n\tThis 5GMM cause is used by the network to indicate that the procedure requested by the UE was rejected as the network has reached the maximum number of simultaneously active PDU sessions for the UE.\nCause #67 \u2013 Insufficient resources for specific slice and DNN\n\tThis 5GMM cause is sent by the network to indicate that the requested service cannot be provided due to insufficient resources for specific slice and DNN.\nCause #69 \u2013 Insufficient resources for specific slice\n\tThis 5GMM cause is sent by the network to indicate that the requested service cannot be provided due to insufficient resources for specific slice.\nCause #71 \u2013 ngKSI already in use\n\tThis 5GMM cause is sent to the network in N1 mode if the ngKSI value received in the AUTHENTICATION REQUEST message is already associated with one of the 5G security contexts stored in the UE.\nCause #73 \u2013 Serving network not authorized\n\tThis 5GMM cause is sent to the UE if the UE initiates registration towards a serving network and the serving network fails to be authorized by the UE's home network.\nCause #78 \u2013PLMN not allowed to operate at the present UE location\n\tThis 5GMM cause is sent to the UE to indicate that the PLMN is not allowed to operate at the present UE location.\nNOTE:\tThis cause is only applicable for satellite NG-RAN access.\nCause #81 \u2013 Selected N3IWF is not compatible with the allowed NSSAI\n\tThis 5GMM cause is sent by the network to indicate that the requested service cannot be provided due to the selected N3IWF is not compatible with the allowed NSSAI.\nCause #82 \u2013 Selected TNGF is not compatible with the allowed NSSAI\n\tThis 5GMM cause is sent by the network to indicate that the requested service cannot be provided due to the selected TNGF is not compatible with the allowed NSSAI.\nCause #90 \u2013 Payload was not forwarded\n\tThis 5GMM cause is sent by the network to indicate that the requested service cannot be provided because payload could not be forwarded by AMF.\nCause #91 \u2013 DNN not supported or not subscribed in the slice\n\tThis 5GMM cause is sent by the network to indicate that the requested service cannot be provided because payload could not be forwarded by AMF because the DNN is not supported or not subscribed in the slice selected by the network if the UE did not indicate a slice, or the DNN is not supported or not subscribed in the slice indicated by the UE.\nCause #92 \u2013 Insufficient user-plane resources for the PDU session\n\tThis 5GMM cause is sent by the network to indicate that the requested service cannot be provided due to insufficient user-plane resources for the PDU session.\nCause #93 \u2013 Onboarding services terminated\n\tThis 5GMM cause is sent by the network if the network initiates a de-registration procedure because the onboarding services are terminated.\nA.4\tCauses related to invalid messages\nCause #95 \u2013 Semantically incorrect message\n\tThis 5GMM cause is used to report receipt of a message with semantically incorrect contents.\nCause #96 \u2013 Invalid mandatory information\n\tThis cause 5GMM indicates that the equipment sending this 5GMM cause has received a message with a non-semantical mandatory IE error.\nCause #97 \u2013 Message type non-existent or not implemented\n\tThis 5GMM cause indicates that the equipment sending this 5GMM cause has received a message with a message type it does not recognize either because this is a message not defined, or defined but not implemented by the equipment sending this 5GMM cause.\nCause #98 \u2013 Message type not compatible with protocol state\n\tThis 5GMM cause indicates that the equipment sending this 5GMM cause has received a message not compatible with the protocol state.\nCause #99 \u2013 Information element non-existent or not implemented\n\tThis 5GMM cause indicates that the equipment sending this 5GMM cause has received a message which includes information elements not recognized because the information element identifier is not defined or it is defined but not implemented by the equipment sending the 5GMM cause. However, the information element is not required to be present in the message in order for the equipment sending the 5GMM cause to process the message.\nCause #100 \u2013 Conditional IE error\n\tThis 5GMM cause indicates that the equipment sending this cause has received a message with conditional IE errors.\nCause #101 \u2013 Message not compatible with protocol state\n\tThis 5GMM cause indicates that a message has been received which is incompatible with the protocol state.\nCause #111 \u2013 Protocol error, unspecified\n\tThis 5GMM cause is used to report a protocol error event only when no other 5GMM cause in the protocol error class applies.\nAnnex B (informative):\nCause values for 5GS session management\nB.1\tCauses related to nature of request\nCause #8 \u2013 Operator Determined Barring\n\tThis 5GSM cause is used by the network to indicate that the requested service was rejected by the SMF due to Operator Determined Barring.\nCause #26 \u2013 Insufficient resources\n\tThis 5GSM cause is used by the UE or by the network to indicate that the requested service cannot be provided due to insufficient resources.\nCause #27 \u2013 Missing or unknown DNN\n\tThis 5GSM cause is used by the network to indicate that the requested service was rejected by the external DN because the DNN was not included although required or if the DNN could not be resolved.\nCause #28 \u2013 Unknown PDU session type\n\tThis 5GSM cause is used by the network to indicate that the requested service was rejected by the external DN because the requested PDU session type could not be recognised or is not allowed.\nCause #29 \u2013 User authentication or authorization failed\n\tThis 5GSM cause is used by the network to indicate that the requested service was rejected by the external DN due to a failed user authentication, revoked by the external DN, or rejected by 5GCN due to a failed user authentication or authorization.\nCause #31 \u2013 Request rejected, unspecified\n\tThis 5GSM cause is used by the network or by the UE to indicate that the requested service or operation or the request for a resource was rejected due to unspecified reasons.\nCause #32 \u2013 Service option not supported\n\tThis 5GSM cause is used by the network when the UE requests a service which is not supported by the PLMN.\nCause #33 \u2013 Requested service option not subscribed\n\tThis 5GSM cause is sent when the UE requests a service option for which it has no subscription.\nCause #35 \u2013 PTI already in use\n\tThis 5GSM cause is used by the network to indicate that the PTI included by the UE is already in use by another active UE requested procedure for this UE.\nCause #36 \u2013 Regular deactivation\n\tThis 5GSM cause is used to indicate a regular UE or network initiated release of PDU session resources.\nCause #37 \u2013 5GS QoS not accepted\n\tThis 5GSM cause is used by the network if the new 5GS QoS that was indicated in the UE request cannot be accepted.\nCause #38 \u2013 Network failure\n\tThis 5GSM cause is used by the network to indicate that the requested service was rejected due to an error situation in the network.\nCause #39 \u2013 Reactivation requested\n\tThis 5GSM cause is used by the network to request a PDU session reactivation.\nCause #41 \u2013 Semantic error in the TFT operation\n\tThis 5GSM cause is used by the UE to indicate a semantic error in the TFT operation included in the request.\nCause #42 \u2013 Syntactical error in the TFT operation\n\tThis 5GSM cause is used by the UE to indicate a syntactical error in the TFT operation included in the request.\nCause #43 \u2013 Invalid PDU session identity\n\tThis 5GSM cause is used by the network or the UE to indicate that the PDU session identity value provided to it is not a valid value or the PDU session identified by the PDU session identity IE in the request or the command is not active.\nCause #44 \u2013 Semantic errors in packet filter(s)\n\tThis 5GSM cause is used by the network or the UE to indicate that the requested service was rejected due to one or more semantic errors in packet filter(s) of the QoS rule included in the request.\nCause #45 \u2013 Syntactical error in packet filter(s)\n\tThis 5GSM cause is used by the network or the UE to indicate that the requested service was rejected due to one or more syntactical errors in packet filter(s) of the QoS rule included in the request.\nCause #46 \u2013 Out of LADN service area\n\tThis 5GSM cause is used by the network to indicate the UE is out of the LADN service area.\nCause #47 \u2013 PTI mismatch\n\tThis 5GSM cause is used by the network or UE to indicate that the PTI provided to it does not match any PTI in use.\nCause #50 \u2013 PDU session type IPv4 only allowed\n\tThis 5GSM cause is used by the network to indicate that only PDU session type IPv4 is allowed for the requested IP connectivity.\nCause #51 \u2013 PDU session type IPv6 only allowed\n\tThis 5GSM cause is used by the network to indicate that only PDU session type IPv6 is allowed for the requested IP connectivity.\nCause #54 \u2013 PDU session does not exist\n\tThis 5GSM cause is used by the network at handover of a PDU session between non-3GPP access and 3GPP access, or at interworking of a PDN connection from non-3GPP access network connected to EPC or from E-UTRAN connected to EPC to a PDU session, to indicate that the network does not have any information about the requested PDU session.\nCause #57 \u2013 PDU session type IPv4v6 only allowed\n\tThis 5GSM cause is used by the network to indicate that only PDU session types IPv4, IPv6 or IPv4v6 are allowed for the requested IP connectivity.\nCause #58 \u2013 PDU session type Unstructured only allowed\n\tThis 5GSM cause is used by the network to indicate that only PDU session type Unstructured is allowed for the requested DN connectivity.\nCause #59 \u2013 Unsupported 5QI value\n\tThis 5GSM cause is used by the network if the 5QI indicated in the UE request cannot be supported.\nCause #61 \u2013 PDU session type Ethernet only allowed\n\tThis 5GSM cause is used by the network to indicate that only PDU session type Ethernet is allowed for the requested DN connectivity.\nCause #67 \u2013 Insufficient resources for specific slice and DNN\n\tThis 5GSM cause is by the network to indicate that the requested service cannot be provided due to insufficient resources for specific slice and DNN or maximum group data rate on a 5G VN group identified by a specific slice and DNN has been exceeded.\nCause #68 \u2013 Not supported SSC mode\n\tThis 5GSM cause is used by the network to indicate that the requested SSC mode is not supported.\nCause #69 \u2013 Insufficient resources for specific slice\n\tThis 5GSM cause is used by the network to indicate that the requested service cannot be provided due to insufficient resources for specific slice, maximum number of PDU sessions on a specific slice has been already reached, data rate on a specific slice has been exceeded, or UE-Slice-MBR has been exceeded.\nCause #70 \u2013 Missing or unknown DNN in a slice\n\tThis 5GSM cause is used by the network to indicate that the requested service was rejected by the external DN because the DNN was not included although required or if the DNN could not be resolved, in the slice.\nCause #81 \u2013 Invalid PTI value\n\tThis 5GSM cause is used by the network or UE to indicate that the PTI provided to it is invalid for the specific 5GSM message.\nCause #82 \u2013 Maximum data rate per UE for user-plane integrity protection is too low\n\tThis 5GSM cause is used by the network to indicate that the requested service cannot be provided because the maximum data rate per UE for user-plane integrity protection is too low.\nCause #83 \u2013 Semantic error in the QoS operation\n\tThis 5GSM cause is used by the network or the UE to indicate that the requested service was rejected due to a semantic error in the QoS operation included in the request.\nCause #84 \u2013 Syntactical error in the QoS operation\n\tThis 5GSM cause is used by the network or the UE to indicate that the requested service was rejected due to a syntactical error in the QoS operation included in the request.\nCause #85 \u2013 Invalid mapped EPS bearer identity\n\tThis 5GSM cause is used by the network or the UE to indicate that the mapped EPS bearer identity value provided to it is not a valid value or the mapped EPS bearer identified by the mapped EPS bearer identity does not exist.\nCause #86 \u2013 UAS services not allowed\n\tThis 5GSM cause is used by the network to indicate that the requested UAS services are not allowed.\nB.2\tProtocol errors (e.g., unknown message)\nCause #95 \u2013 Semantically incorrect message\n\tThis 5GSM cause is used to report receipt of a message with semantically incorrect contents.\nCause #96 \u2013 Invalid mandatory information\n\tThis 5GSM cause indicates that the equipment sending this 5GSM cause has received a message with a non-semantical mandatory IE error.\nCause #97 \u2013 Message type non-existent or not implemented\n\tThis 5GSM cause indicates that the equipment sending this 5GSM cause has received a message with a message type it does not recognize either because this is a message not defined, or defined but not implemented by the equipment sending this 5GSM cause.\nCause #98 \u2013 Message type not compatible with protocol state\n\tThis 5GSM cause indicates that the equipment sending this 5GSM cause has received a message not compatible with the protocol state.\nCause #99 \u2013 Information element non-existent or not implemented\n\tThis 5GSM cause indicates that the equipment sending this 5GSM cause has received a message which includes information elements not recognized because the information element identifier is not defined or it is defined but not implemented by the equipment sending the 5GSM cause. However, the information element is not required to be present in the message in order for the equipment sending the 5GSM cause to process the message.\nCause #100 \u2013 Conditional IE error\n\tThis 5GSM cause indicates that the equipment sending this cause has received a message with conditional IE errors.\nCause #101 \u2013 Message not compatible with protocol state\n\tThis 5GSM cause indicates that a message has been received which is incompatible with the protocol state.\nCause #111 \u2013 Protocol error, unspecified\n\tThis 5GSM cause is used to report a protocol error event only when no other 5GSM cause in the protocol error class applies.\nAnnex C (normative):\nStorage of 5GMM information\nC.1\tStorage of 5GMM information for UEs not operating in SNPN access operation mode\nThe following 5GMM parameters shall be stored on the USIM if the corresponding file or file extension is present:\na)\t5G-GUTI;\nb)\tlast visited registered TAI;\nc)\t5GS update status;\nd)\t5G NAS security context parameters from a full native 5G NAS security context (see 3GPP\u00a0TS\u00a033.501\u00a0[24]);\ne)\tKAUSF and KSEAF (see 3GPP\u00a0TS\u00a033.501\u00a0[24]);\nf)\tSOR counter (see subclause\u00a09.11.3.51); and\ng)\tUE parameter update counter (see subclause\u00a09.11.3.53A);\nThe UE may support multiple records of NAS security context storage for multiple registration (see 3GPP\u00a0TS\u00a031.102\u00a0[22]). If the UE supports multiple records of NAS security context storage for multiple registration, the first 5G security context of one access shall be stored in record 1 of the 5G NAS Security Context USIM file for that access and the second 5G security context of that access shall be stored in record 2 of the same file. The presence and format of corresponding files on the USIM is specified in 3GPP\u00a0TS\u00a031.102\u00a0[22].\nIf the corresponding file or file extension is not present on the USIM, these 5GMM parameters are stored in a non-volatile memory in the ME together with the SUPI from the USIM. These 5GMM parameters can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory; else the UE shall delete the 5GMM parameters.\nUpon power up or when a USIM is inserted if KAUSF is stored on the USIM but the SOR counter and the UE parameter update counter are not present on the USIM the UE may delete the KAUSF and associated 5G security context that are stored at the USIM and set the KSI value of ngKSI to '111' (see 3GPP\u00a0TS\u00a033.501\u00a0[24]).\nNOTE: \tThe above handling can be used to prevent a stored CounterSoR and CounterUPU being associated with the wrong KAUSF. Further criteria for deleting the security information are left to the UE implementation.\nThe following 5GMM parameters shall be stored in a non-volatile memory in the ME together with the SUPI from the USIM:\n-\tconfigured NSSAI(s);\n-\tNSSRG information;\n-\tS-NSSAI time validity information;\n-\tS-NSSAI location validity information;\n-\ton-demand NSSAI;\n-\tNSSAI inclusion mode(s);\n-\tMPS indicator;\n-\tMCS indicator;\n-\toperator-defined access category definitions;\n-\tnetwork-assigned UE radio capability IDs;\n-\t\"CAG information list\", if the UE supports CAG;\n-\tsignalled URSP (see 3GPP TS 24.526 [19]);\n-\tSOR-CMCI;\n-\tone or more lists of type \"list of PLMN(s) to be used in disaster condition\", if the UE supports MINT;\n-\tdisaster roaming wait range, if the UE supports MINT; \n-\tdisaster return wait range, if the UE supports MINT;\n-\tindication of whether disaster roaming is enabled in the UE; \n-\tindication of 'applicability of \"lists of PLMN(s) to be used in disaster condition\" provided by a VPLMN';\n-\tVPS URSP configuration; and\n-\tindication of whether interworking without N26 interface is supported.\nThe following 5GMM parameters should be stored in a non-volatile memory in the ME together with the SUPI from the USIM:\n-\tallowed NSSAI(s); and\n-\tpartially allowed NSSAI(s).\nEach configured NSSAI consists of S-NSSAI(s) stored together with a PLMN identity, if it is associated with a PLMN. The UE shall store the S-NSSAI(s) of the HPLMN. If the UE is in the VPLMN, the UE shall also store the configured NSSAI for the current PLMN and any necessary mapped S-NSSAI(s). The configured NSSAI(s) can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the configured NSSAI(s). A configured NSSAI may be associated with NSSRG information, S-NSSAI location validity information, S-NSSAI time validity information, NSAG information and on-demand NSSAI.\nEach NSSAI inclusion mode is associated with a PLMN identity and access type. The NSSAI inclusion mode(s) can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the NSSAI inclusion mode(s).\nThe MPS indicator is stored together with a PLMN identity of the PLMN that provided it, and is valid in that RPLMN or equivalent PLMN. The MPS indicator can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME, else the UE shall delete the MPS indicator.\nThe MCS indicator is stored together with a PLMN identity of the PLMN that provided it, and is valid in that RPLMN or equivalent PLMN. The MCS indicator can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME, else the UE shall delete the MCS indicator.\nOperator-defined access category definitions are stored together with a PLMN identity of the PLMN that provided them, and is valid in that PLMN or equivalent PLMN. The operator-defined access category definitions can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME, else the UE shall delete the operator-defined access category definitions. The maximum number of stored operator-defined access category definitions is UE implementation dependent.\nEach network-assigned UE radio capability ID is stored together with a PLMN identity of the PLMN that provided it as well as a mapping to the corresponding UE radio configuration, and is valid in that PLMN. A network-assigned UE radio capability ID can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME, else the UE shall delete the network-assigned UE radio capability ID. The UE shall be able to store at least the last 16 received network-assigned UE radio capability IDs. There shall be only one network-assigned UE radio capability ID stored for a given combination of PLMN identity and UE radio configuration and any existing UE radio capability ID shall be deleted when a new UE radio capability ID is added for the same combination of PLMN identity and UE radio configuration. If the UE receives a network-assigned UE radio capability ID with a Version ID value different from the value included in the network-assigned UE radio capability ID(s) stored at the UE for the serving PLMN, the UE may delete these stored network-assigned UE radio capability ID(s).\nThe allowed NSSAI(s) can be stored in a non-volatile memory in the ME together with the SUPI from the USIM. Allowed NSSAI consists of S-NSSAI(s) stored together with a PLMN identity, if it is associated with a PLMN. If the allowed NSSAI is stored, then the UE shall store the S-NSSAI(s) of the HPLMN. If the UE is in the VPLMN, the UE shall also store the allowed NSSAI for the serving PLMN and any necessary mapping of the allowed NSSAI for the serving PLMN to the S-NSSAI(s) of the HPLMN. The allowed NSSAI(s) can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the allowed NSSAI(s).\nThe partially allowed NSSAI(s) can be stored as allowed NSSAI(s) in a non-volatile memory in the ME together with the SUPI from the USIM. Partially allowed NSSAI consists of allowed S-NSSAI(s) and for each S-NSSAI a list of TAs for which the S-NSSAI is allowed, together with a PLMN identity.\nIf the UE is registered for emergency services, the UE shall not store the 5GMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE is deregistered from emergency services (e.g. before registering for normal service).\nIf the UE is configured for eCall only mode as specified in 3GPP\u00a0TS\u00a031.102\u00a0[22], the UE shall not store the 5GMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE enters 5GMM-DEREGISTERED.eCALL-INACTIVE state, the UE is switched-off or the USIM is removed.\nThe \"CAG information list\" can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the \"CAG information list\".\nThe handling of the SOR-CMCI stored in the non-volatile memory in the ME is specified in 3GPP\u00a0TS\u00a023.122\u00a0[5].\nEach \"list of PLMN(s) to be used in disaster condition\" is stored together with the PLMN identity of the PLMN that provided it. The stored lists of type \"list of PLMN(s) to be used in disaster condition\" can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the lists of type \"list of PLMN(s) to be used in disaster condition\". The UE shall store at least the \"list of PLMN(s) to be used in disaster condition\" provided by the HPLMN or EHPLMN. If the 'applicability of \"lists of PLMN(s) to be used in disaster condition\" provided by a VPLMN' is set to \"true\", the UE should also store the \"list of PLMN(s) to be used in disaster condition\" provided by the VPLMN. The maximum number of stored lists of type \"list of PLMN(s) to be used in disaster condition\" provided by a PLMN other than the HPLMN or EHPLMN is UE implementation dependent.\nThe disaster roaming wait range can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the disaster roaming wait range.\nThe disaster return wait range can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the disaster return wait range.\nThe indication of whether disaster roaming is enabled in the UE can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the indication of whether disaster roaming is enabled in the UE.\nThe indication of 'applicability of \"lists of PLMN(s) to be used in disaster condition\" provided by a VPLMN' can only be used if the SUPI from the USIM matches the SUPI stored in the non-volatile memory of the ME; else the UE shall delete the indication of 'applicability of \"lists of PLMN(s) to be used in disaster condition\" provided by a VPLMN'.\nC.2\tStorage of 5GMM information for UEs operating in SNPN access operation mode\nThe 5GMM information for UEs operating in SNPN access operation mode and not registering or registered for the onboarding service in SNPN are stored according to the following conditions:\n-\tif the UE does not support access to an SNPN using credentials from a credentials holder and equivalent SNPNs, the following 5GMM parameters shall be stored per subscribed SNPN in a non-volatile memory in the ME together with the subscriber identifier associated with the SNPN identity of the SNPN in the \"list of subscriber data\" configured in the ME (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) or with the SUPI from the USIM if no subscriber identifier is configured in the entry of the \"list of subscriber data\" associated with the SNPN identity and the UE has a valid USIM;and\n-\tif the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the following 5GMM parameters shall be stored in a non-volatile memory in the ME per:\ni)\tthe subscribed SNPN together with the subscriber identifier associated with the selected entry in the \"list of subscriber data\" configured in the ME (see 3GPP TS 23.122 [5]) or with the SUPI from the USIM if no subscriber identifier is configured in the selected entry of the \"list of subscriber data\" configured in the ME and the UE has a valid USIM; or\nii)\tif the UE supports access to an SNPN using credentials from a credentials holder, the PLMN subscription together with the SUPI from the USIM which is associated with the PLMN subscription:\na)\t5G-GUTI;a1)\tNID of the registered SNPN;\nb)\tlast visited registered TAI;\nc)\t5GS update status;\nd)\t5G NAS security context parameters from a full native 5G NAS security context (see 3GPP\u00a0TS\u00a033.501\u00a0[24]);\ne)\tKAUSF and KSEAF (see 3GPP\u00a0TS\u00a033.501\u00a0[24]);\nf)\tUE parameter update counter (see subclause\u00a09.11.3.53A);\ng)\tconfigured NSSAI(s);\ng1)\tNSSRG information;\ng2)\tS-NSSAI time validity information;\ng3) S-NSSAI location validity information;\ng4)\ton-demand NSSAI;\nh)\tNSSAI inclusion mode(s);\ni)\tMPS indicator;\nj)\tMCS indicator;\nk)\toperator-defined access category definitions;\nl)\tnetwork-assigned UE radio capability IDs;\nm)\tzero or more instances of signalled URSP (see 3GPP\u00a0TS\u00a024.526\u00a0[19]), each associated with a non-subscribed SNPN, the subscribed SNPN or the HPLMN, which provided the URSP;\nm1)\tzero or more instances of pre-configured URSP rules (see 3GPP\u00a0TS\u00a024.526\u00a0[19]), each associated with the subscribed SNPN or the HPLMN, which provided the URSP;\nn)\toptionally a non-subscribed SNPN signalled URSP handling indication indicating whether the UE is allowed to accept URSP signalled by non-subscribed SNPNs;\no)\tpermanently forbidden SNPNs list;\no1)\tpermanently forbidden SNPNs for access for localized services in SNPN;\np)\ttemporarily forbidden SNPNs;\np1)\ttemporarily forbidden SNPNs for access for localized services in SNPN;\nq)\tSOR counter (see subclause\u00a09.11.3.51);\nr)\tSOR-CMCI; and\ns)\toptionally, the SNPN selection parameters associated with the PLMN subscription (see 3GPP\u00a0TS\u00a023.122\u00a0[5] subclause\u00a04.9.3.0).\nThe 5GMM information for UEs operating in SNPN access operation mode and registering or registered for the onboarding service in SNPN are stored as follows:\na)\t5G-GUTI;\nb)\tlast visited registered TAI;\nc)\t5GS update status;\nd)\t5G NAS security context parameters from a full native 5G NAS security context (see 3GPP\u00a0TS\u00a033.501\u00a0[24]);\ne)\tKAUSF and KSEAF (see 3GPP\u00a0TS\u00a033.501\u00a0[24]);\nf)\tUE parameter update counter (see subclause\u00a09.11.3.53A);\ng)\tnetwork-assigned UE radio capability IDs;\nh)\t\"permanently forbidden SNPNs\" list for onboarding services; and\ni)\t\"temporarily forbidden SNPNs\" list for onboarding services.\nThe 5GMM information for UEs operating in SNPN access operation mode are stored according to the following conditions:\n-\tif the UE does not support access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the following 5GMM parameters should be stored per subscribed SNPN in a non-volatile memory in the ME together with the subscriber identifier associated with the SNPN identity of the SNPN in the \"list of subscriber data\" configured in the ME (see 3GPP\u00a0TS\u00a023.122\u00a0[5]) or with the SUPI from the USIM if no subscriber identifier is configured in the entry of the \"list of subscriber data\" associated with the SNPN identity and the UE has a valid USIM; and\n-\tif the UE supports access to an SNPN using credentials from a credentials holder, equivalent SNPNs or both, the following 5GMM parameters should be stored in a non-volatile memory in the ME per:\ni)\tthe subscribed SNPN together with the subscriber identifier associated with the selected entry in the \"list of subscriber data\" configured in the ME (see 3GPP TS 23.122 [5]) or with the SUPI from the USIM if no subscriber identifier is configured in the selected entry of the \"list of subscriber data\" configured in the ME and the UE has a valid USIM; or\nii)\tif the UE supports access to an SNPN using credentials from a credentials holder, the PLMN subscription together with the SUPI from the USIM which is associated with the PLMN subscription:\na)\tallowed NSSAI(s).\nIf the 5GMM parameters are associated with the PLMN subscription, then the 5GMM parameters can only be used if the SUPI from the USIM which is associated with the selected PLMN subscription matches the SUPI stored in the non-volatile memory; else the UE shall delete the 5GMM parameters.\nIf the 5GMM parameters are associated with the subscribed SNPN of the entry in the \"list of subscriber data\", then the 5GMM parameters can only be used if the subscriber identifier of the selected entry of the \"list of subscriber data\" matches the subscriber identifier stored in the non-volatile memory or if the subscriber identifier from the USIM matches the subscriber identifier stored in the non volatile memory, no subscriber identifier is configured in the selected entry of the \"list of subscriber data\" configured in the ME and the UE has a valid USIM.\nEach configured NSSAI consists of S-NSSAI(s) stored together with an SNPN identity, if it is associated with an SNPN. A configured NSSAI may be associated with NSSRG information, S-NSSAI time validity information, S-NSSAI location validity information, NSAG information and on-demand NSSAI.\nEach NSSAI inclusion mode is associated with an SNPN identity and access type.\nThe MPS indicator is stored together with an SNPN identity of the SNPN that provided it, and is valid in that registered SNPN or equivalent SNPN.\nThe MCS indicator is stored together with an SNPN identity of the SNPN that provided it, and is valid in that registered SNPN or equivalent SNPN.\nOperator-defined access category definitions are stored together with an SNPN identity of the SNPN that provided them, and are valid in that SNPN or equivalent SNPN. The maximum number of stored operator-defined access category definitions is UE implementation dependent.\nEach network-assigned UE radio capability ID is stored together with an SNPN identity of the SNPN that provided it as well as a mapping to the corresponding UE radio configuration, and is valid in that SNPN. The UE shall be able to store at least the last 16 received network-assigned UE radio capability IDs. There shall be only one network-assigned UE radio capability ID stored for a given combination of SNPN identity and UE radio configuration and any existing UE radio capability ID shall be deleted when a new UE radio capability ID is added for the same combination of SNPN identity and UE radio configuration. If the UE receives a network-assigned UE radio capability ID with a Version ID value different from the value included in the network-assigned UE radio capability ID(s) stored at the UE for the serving SNPN, the UE may delete these stored network-assigned UE radio capability ID(s).\nThe handling of the SOR-CMCI stored in the non-volatile memory in the ME is specified in 3GPP\u00a0TS\u00a023.122\u00a0[5].\nThe allowed NSSAI(s) can be stored in a non-volatile memory in the ME. Allowed NSSAI consists of S-NSSAI(s) stored together with an SNPN identity, if it is associated with an SNPN.\nThe partially allowed NSSAI(s) can be stored as allowed NSSAI(s) in a non-volatile memory in the ME. Partially allowed NSSAI consists of S-NSSAI(s) and a list of TAs for which the S-NSSAI is allowed, stored together with an SNPN identity, if it is associated with an SNPN.\nAnnex D (normative):\nUE policy delivery service\nD.1\tGeneral\nD.1.1\tOverview\nThe UE provides the PCF with a list of one or more stored UE policy section identifiers (UPSIs) during the UE-initiated UE state indication procedure. The UPSI is composed of two parts:\na)\ta PLMN ID part containing:\n1)\tthe PLMN ID for the PLMN; or\n2)\tthe PLMN ID part of the SNPN identity for the SNPN;\n\tof the PCF which provides the UE policies; and\nb)\ta UE policy section code (UPSC) containing a value assigned by the PCF.\nDuring the UE-initiated UE state indication procedure, the UE also provides the PCF with the UE policy related capabilities such as the UE's support for ANDSP, the UE's support for URSP provisioning in EPS, and the UE's OS\u00a0Id.\nDuring the network-requested UE policy management procedure, the PCF provides the UE with one or more UE policy sections containing UE policies. The UE processes the received UE policy sections, each identified by the UPSI, received from the PCF and informs the PCF of the result.\nIn the present annex, the condition that the PLMN ID part of the UPSI is referring to the HPLMN shall be considered as fulfilled only if the PLMN ID is equal to the HPLMN code derived from the IMSI.\nNOTE:\tThis is also applicable if the UE has a non-empty EHPLMN list, even if the EHPLMN list does not include the PLMN ID derived from the IMSI.\nThe UE can also request the PCF to provide V2XP as specified in 3GPP\u00a0TS\u00a024.587\u00a0[19B].\nThe UE can also request the PCF to provide ProSeP as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E].\nThe UE can also request the PCF to provide A2XP as specified in 3GPP\u00a0TS\u00a024.577\u00a0[60].\nThe UE can also request the PCF to provide RSLPP as specified in 3GPP\u00a0TS\u00a024.514\u00a0[62].\nD.1.2\tPrinciples of PTI handling for UE policy delivery service procedures\nWhen the PCF or the UE initiates a procedure, it shall include a valid PTI value in the message header of the command message or the request message. When the UE initiates a procedure, the UE shall use a PTI value in range between 01H and 77H. When the PCF initiates a procedure, the PCF shall use a PTI value in range between 80H and FEH.\nWhen the PCF initiates a transaction related procedure (i.e. a procedure consisting of more than one message and the messages are related), it shall include a valid PTI value in the message header of the command message.\nIf a response message is sent as result of a received command or request message, the UE or the PCF shall include in the response message the PTI value received within the received command or request message (see examples in figure\u00a0D.1.2.1, figure\u00a0D.1.2.2 and figure\u00a0D.1.2.3).\nIf a command message is sent as result of a received request message, the PCF shall include in the command message the PTI value received with the request message (see examples in figure\u00a0D.1.2.3).\n\n\nFigure\u00a0D.1.2.1: Network-requested transaction related procedure\n\nFigure\u00a0D.1.2.2: UE-requested transaction related procedure rejected by the network\n\nFigure\u00a0D.1.2.3: UE-requested transaction related procedure triggering a network-requested transaction related procedure\nNOTE:\tIn earlier versions of this protocol, the UE can include in the response message a PTI value which is not the same as the one received within the command message, and therefore the PCF could not associate the response message from the UE to the command message sent.\nD.2\tProcedures\nD.2.1\tNetwork-requested UE policy management procedure\nD.2.1.1\tGeneral\nThe purpose of the network-requested UE policy management procedure is to enable the network to:\na)\tadd one or more new UE policy sections to the UE;\nb)\tmodify one or more UE policy sections stored at the UE; or\nc)\tdelete one or more UE policy sections stored at the UE;\nand optionally to enable the HPLMN or the subscribed SNPN to provide a UE accessing the subscribed SNPN or the HPLMN with a non-subscribed SNPN signalled URSP handling indication indicating whether the UE is allowed to accept URSP signalled by non-subscribed SNPNs.\nD.2.1.2\tNetwork-requested UE policy management procedure initiation\nIn order to initiate the network-requested UE policy management procedure, the PCF shall:\na)\tif the network-requested UE policy management procedure is triggered by the UE-requested V2X policy provisioning procedure as specified in 3GPP\u00a0TS\u00a024.587\u00a0[19B], the UE-requested ProSe policy provisioning procedure as specified in 3GPP\u00a0TS\u00a024.554\u00a0[19E] or the UE-requested A2X policy provisioning procedure as specified in 3GPP\u00a0TS\u00a024.577\u00a0[60], then set the PTI IE to the PTI value of the received UE POLICY PROVISIONING REQUEST message of the UE-requested V2X policy provisioning procedure, the UE-requested ProSe policy provisioning procedure or the UE-requested A2X policy provisioning procedure, otherwise allocate a PTI value currently not used and set the PTI IE to the allocated PTI value;\nb)\tencode the information about the UE policy sections to be added, modified or deleted in a UE policy section management list IE as specified in subclause\u00a0D.6.2 and include it in a MANAGE UE POLICY COMMAND message;\nc)\tif the PCF is a PCF of the HPLMN or the subscribed SNPN, optionally include the UE policy network classmark IE in a MANAGE UE POLICY COMMAND message and set the non-subscribed SNPN signalled URSP handling indication of the UE policy network classmark IE to \"UE is not allowed to accept URSP signalled by non-subscribed SNPNs\", or \"UE is allowed to accept URSP signalled by non-subscribed SNPNs\";\nc1)\tif the UE supports VPS URSP, optionally encode the information about entries of VPS URSP configuration to be added, modified or deleted in the VPS URSP configuration IE as specified in subclause\u00a0D.6.8 and include it in a MANAGE UE POLICY COMMAND message;\nd)\tsend the MANAGE UE POLICY COMMAND message to the UE via the AMF as specified in 3GPP\u00a0TS\u00a023.502\u00a0[9]; and\ne)\tstart timer T3501 (see example in figure\u00a0D.2.1.2.1).\nNOTE:\tThe PCF starts a different timer T3501 for each PTI value.\n\nFigure\u00a0D.2.1.2.1: Network-requested UE policy management procedure\nUpon receipt of the MANAGE UE POLICY COMMAND message with a PTI value currently not used by a network-requested UE policy management procedure, for each instruction included in the UE policy section management list IE, the UE shall:\na)\tstore the received UE policy section of the instruction, if the UE has no stored UE policy section associated with the same UPSI as the UPSI associated with the instruction;\nb)\treplace the stored UE policy section with the received UE policy section of the instruction, if the UE has a stored UE policy section associated with the same UPSI as the UPSI associated with the instruction; or\nc)\tdelete the stored UE policy section, if the UE has a stored UE policy section associated with the same UPSI as the UPSI associated with the instruction and the UE policy section of the instruction is empty;\nadditionally, if the UE policy network classmark IE is included in the MANAGE UE POLICY COMMAND message, and\na)\tthe UE has an empty EHPLMN list or the EHPLMN list is not present, and the UE's RPLMN is the HPLMN; \nb)\tthe UE has a non-empty EHPLMN list, and the UE's RPLMN is an EHPLMN; or \nc)\tthe UE's RSNPN is the subscribed SNPN, \nthe UE shall delete the non-subscribed SNPN signalled URSP handling indication stored for the selected entry of \"list of subscriber data\" or the selected PLMN subscription, if any, and store the non-subscribed SNPN signalled URSP handling indication received in the UE policy network classmark IE, for the selected entry of \"list of subscriber data\" or the selected PLMN subscription.\nIf the UE supports the VPS URSP, and the VPS URSP configuration is included in the MANAGE UE POLICY COMMAND message:\na)\tif the replacement type field of the received VPS URSP configuration indicates \"full list of tuples\", the UE shall delete the stored VPS URSP configuration, if any; and\nb)\tif the received VPS URSP configuration contains one or more tuples:\n1)\tif the UE does not have the stored VPS URSP configuration, the UE shall store the received VPS URSP configuration except zero or more tuples with no UPSCs; or\n2)\totherwise:\ni)\tfor each tuple with a tuple ID in the stored VPS URSP configuration:\nA)\tif a tuple with the tuple ID is in the received VPS URSP configuration and contains:\n-\tno UPSCs, the UE shall delete the tuple with the tuple ID from the stored VPS URSP configuration; or\n-\tone or more UPSCs, the UE shall replace the tuple with the tuple ID in the stored VPS URSP configuration with the tuple with the tuple ID from the received VPS URSP configuration; or\nB)\tif no tuple with the tuple ID is in the received VPS URSP configuration, the UE shall keep the tuple with the tuple ID in the stored VPS URSP configuration; and\nii)\tfor each tuple with a tuple ID in the received VPS URSP configuration, if no tuple with the tuple ID is in the stored VPS URSP configuration and:\nA)\tthe tuple with the tuple ID in the received VPS URSP configuration contains no UPSCs, the UE shall ignore the tuple with the tuple ID in the received VPS URSP configuration; or\nB)\tthe tuple with the tuple ID in the received VPS URSP configuration contains one or more UPSCs, the UE shall add the tuple with the tuple ID from the received VPS URSP configuration to the stored VPS URSP configuration.\nThe UE may continue storing a received UE policy section for a PLMN or SNPN when the UE registers in another PLMN or SNPN. If necessary, the UE may delete UE policy sections stored for a PLMN other than the RPLMN and the HPLMN or for an SNPN other than the registered SNPN and the subscribed SNPN, before storing the new received UE policy sections.\nWhen storing a UE policy section received from an SNPN, the UE shall associate the NID of that SNPN with the UPSI of the stored UE policy section.\nNOTE:\tThe maximum number of UE policy sections for PLMNs or SNPNs other than the HPLMN and the RPLMN or the registered SNPN and the subscribed SNPN that the UE can store and how the UE selects the UE policy sections to be deleted are up to the UE implementation.\nD.2.1.3\tNetwork-requested UE policy management procedure accepted by the UE\nIf all instructions included in the UE policy section management list IE were executed successfully by the UE, the UE shall:\na)\tcreate a MANAGE UE POLICY COMPLETE message including the PTI value received within the MANAGE UE POLICY COMMAND message; and\nb)\ttransport the MANAGE UE POLICY COMPLETE message using the NAS transport procedure as specified in subclause\u00a05.4.5.\nUpon receipt of the MANAGE UE POLICY COMPLETE message, the PCF shall stop timer T3501. The PCF should ensure that the PTI value assigned to this procedure is not released immediately.\nNOTE:\tThe way to achieve this is implementation dependent. For example, the PCF can ensure that the PTI value assigned to this procedure is not released during the time equal to or greater than the default value of timer T3501.\nD.2.1.4\tNetwork-requested UE policy management procedure not accepted by the UE\nIf the UE could not execute all instructions included in the UE policy section management list IE successfully, the UE shall:\na)\tset the PTI IE to the PTI value received within the MANAGE UE POLICY COMMAND message and encode the results by including:\n1)\tthe UPSI associated with the instructions which could not be executed successfully;\n2)\t the failed instruction order set to order of the instruction in the UE policy section management sublist of the received UE policy section management list IE which could not be executed successfully; and\n3)\tthe cause of the failure,\n\tin the UE policy section management result IE as specified in subclause\u00a0D.5.3 and include it in a MANAGE UE POLICY COMMAND REJECT message, and\nb)\ttransport the MANAGE UE POLICY COMMAND REJECT message using the NAS transport procedure as specified in subclause\u00a05.4.5.\nUpon receipt of the MANAGE UE POLICY COMMAND REJECT message, the PCF shall stop timer T3501. Any instruction that was included in the UE policy section management list IE but not indicatedin the UE policy section management result IE of the received MANAGE UE POLICY COMMAND REJECT message, shall be considered as successfully executed.\nThe PCF should ensure that the PTI value assigned to this procedure is not released immediately.\nNOTE:\tThe way to achieve this is implementation dependent. For example, the PCF can ensure that the PTI value assigned to this procedure is not released during the time equal to or greater than the default value of timer T3501.\nUpon receipt of the notification from the AMF that the UE is not reachable, the PCF shall stop the T3501.\nD.2.1.5\tAbnormal cases on the network side\nThe following abnormal cases can be identified:\na)\tT3501 expired.\n\tThe PCF shall, on the first expiry of the timer T3501, retransmit the MANAGE UE POLICY COMMAND message and shall reset and start timer T3501. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3501, the PCF shall abort the procedure and release the allocated PTI.\nD.2.1.6\tAbnormal cases in the UE\nThe following abnormal cases can be identified:\na)\tReceipt of an instruction associated with a UPSI which has a PLMN ID part that is not equal to the PLMN ID of the UE's HPLMN and the instruction contains a UE policy part with a UE policy part type set to \"URSP\" for a UE not operating in SNPN access operation mode, or receipt of an instruction associated with a UPSI which has a PLMN ID part that is not equal to the PLMN ID part of the selected SNPN and the instruction contains a UE policy part with a UE policy part type set to \"URSP\" for a UE operating in SNPN access operation mode.\n\tThe UE shall set the UE policy delivery service cause to #111 \u201cProtocol error, unspecified\u201d for the instruction in the UE policy section management result IE of the MANAGE UE POLICY COMMAND REJECT message.\nb)\tReceipt of an instruction associated with a UPSI which has a PLMN ID part that is not equal to the PLMN ID of the UE's HPLMN or the UE's RPLMN and the instruction contains a UE policy part with a UE policy part type set to \"ANDSP\" for a UE not operating in SNPN access operation mode or receipt of an instruction associated with a UPSI which has a PLMN ID part that is not equal to the PLMN ID part of the subscribed SNPN or the UE's RSNPN and the instruction contains a UE policy part with a UE policy part type set to \"ANDSP\" for a UE operating in SNPN access operation mode.\n\tThe UE shall set the UE policy delivery service cause to #111 \u201cProtocol error, unspecified\u201d for the instruction in the UE policy section management result IE of the MANAGE UE POLICY COMMAND REJECT message.\nc)\tTransmission failure of the MANAGE UE POLICY COMPLETE message indication from lower layers.\n\tThe UE shall not diagnose an error and consider the network-requested UE policy management procedure is complete.\nNOTE\u00a01:\tConsidering the network-requested UE policy management procedure is complete as the result of this abnormal case, does not cause the UE to revert the execution of the successfully executed instructions included in the MANAGE UE POLICY COMMAND message.\nd)\tTransmission failure of the MANAGE UE POLICY COMMAND REJECT message indication from lower layers.\n\tThe UE shall not diagnose an error and consider the network-requested UE policy management procedure is complete.\nNOTE\u00a02:\tConsidering the network-requested UE policy management procedure is complete as the result of this abnormal case, does not cause the UE to revert the execution of the successfully executed instructions included in the MANAGE UE POLICY COMMAND message.\ne)\tReceipt of a MANAGE UE POLICY COMMAND message with a PTI set to the same value as the PTI of a previously received MANAGE UE POLICY COMMAND message.\n\tThe UE shall discard the message and retransmit the MANAGE UE POLICY COMMAND COMPLETE or MANAGE UE POLICY COMMAND REJECT message transmitted in response to the previously received MANAGE UE POLICY COMMAND message.\nNOTE\u00a03:\tThe way to achieve this is UE implementation dependent. For example, the UE can assume that on the fifth expiry of timer T3501, the PCF will abort the procedure and that the PTI value assigned to the procedure will be released.\nf)\tReceipt of an instruction associated with a UPSI which has a PLMN ID part that is equal to the PLMN ID part of the selected SNPN, the instruction contains a UE policy part with a UE policy part type set to \"URSP\", UE's RSNPN is a non-subscribed SNPN and:\n1)\tthe UE has a stored non-subscribed SNPN signalled URSP handling indication for the selected entry of \"list of subscriber data\" or the selected PLMN subscription indicating that the UE is not allowed to accept URSP signalled by non-subscribed SNPNs; or\n2)\tthe UE does not have a stored non-subscribed SNPN signalled URSP handling indication for the selected entry of \"list of subscriber data\" or the selected PLMN subscription, and the non-subscribed SNPN signalled URSP handling indication preconfigured in the selected entry of \"list of subscriber data\" or the selected PLMN subscription indicates that the UE is not allowed to accept URSP signalled by non-subscribed SNPNs;\n\tfor a UE operating in SNPN access operation mode.\n\tThe UE shall set the UE policy delivery service cause to #111 \u201cProtocol error, unspecified\u201d for the instruction in the UE policy section management result IE of the MANAGE UE POLICY COMMAND REJECT message.\nD.2.2\tUE-initiated UE state indication procedure\nD.2.2.1\tGeneral\nThe purpose of the UE-initiated UE state indication procedure is:\na)\tto deliver the UPSI(s) of the UE policy section(s) which are:\n-\tidentified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN, and stored in the UE, if any; or\n-\tidentified by a UPSI with the PLMN ID part indicating the PLMN ID part of the SNPN identity of the selected SNPN and associated with the NID of the selected SNPN, and stored in the UE, if any;\nb)\tto indicate whether UE supports ANDSP;\nc)\tto indicate whether UE supports URSP provisioning in EPS; \nc1)\tto indicate whether UE supports VPS URSP;\nd)\tto indicate whether UE supports reporting URSP rule enforcement; and\ne)\tto deliver the UE's one or more OS IDs;\nto the PCF.\nD.2.2.2\tUE-initiated UE state indication procedure initiation\nIn order to initiate the UE-initiated UE state indication procedure, the UE shall create a UE STATE INDICATION message. The UE:\na)\tshall allocate a PTI value currently not used and set the PTI IE to the allocated PTI value;\nb)\tif not operating in SNPN access operation mode, shall include the UPSI(s) of the UE policy section(s) which are identified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN available in the UE in the UPSI list IE, if any;\nNOTE\u00a01:\tIf the UE does not have any UE policy section which is identified by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN, the UE sets the Length of UPSI list contents field in the UPSI list IE to zero.\nc)\tif operating in SNPN access operation mode, shall include UPSI(s) of the UE policy section(s) which are identified by a UPSI:\n-\twith the PLMN ID part indicating the MCC and MNC of the selected SNPN; and\n-\tassociated with the NID of the selected SNPN;\n\tavailable in the UE in the UPSI list IE, if any;\nNOTE\u00a02:\tIf the UE does not have any UE policy section which is identified by a UPSI with the PLMN ID part indicating the MCC and MNC of the selected SNPN and associated with the NID of the selected SNPN, the UE sets the Length of UPSI list contents field in the UPSI list IE to zero.\nd)\tshall specify whether the UE supports ANDSP in the UE policy classmark IE; \ne)\tshall specify whether the UE supports URSP provisioning in EPS in the UE policy classmark IE; \ne1)\tif the UE supports VPS URSP, shall set the SVPSU bit to \"VPS URSP supported by the UE\" in the UE policy classmark IE;\nf)\tif the UE supports reporting URSP rule enforcement, shall set the SupportRURE bit to \"Reporting URSP rule enforcement supported by the UE\"; and\ng)\tmay include the UE's one or more OS IDs in the UE OS Id IE.\nThe UE shall send the UE STATE INDICATION message (see example in figure\u00a0D.2.2.2.1). The UE shall transport the created UE STATE INDICATION message using the registration procedure (see subclause\u00a05.5.1).\n\nFigure\u00a0D.2.2.2.1: UE-initiated UE state indication procedure\nD.2.2.3\tUE-initiated UE state indication procedure accepted by the network\nUpon receipt of the UE STATE INDICATION message, the PCF shall operate as described in 3GPP\u00a0TS\u00a023.502\u00a0[9] and 3GPP\u00a0TS\u00a029.525\u00a0[21].\nD.2.2.4\tAbnormal cases on the network side\nApart from the case described in subclause\u00a0D.2.2.3, no abnormal cases have been identified.\nD.3\tUE policy re-assembly at the UE\nWhen the UE needs to apply ANDSP as specified in 3GPP\u00a0TS\u00a024.502\u00a0[18], the UE shall consider all UE policy parts with ANDSP contents currently stored at the UE.\nWhen the UE needs to apply URSP as specified in 3GPP\u00a0TS\u00a024.526\u00a0[19], the UE shall consider all UE policy parts with URSP contents currently stored at the UE.\na)\tif the UE supports VPS URSP then:\n1)\tthe UE shall consider as VPS URSP of the RPLMN all UE policy parts with URSP contents currently stored at the UE, which are a part of one or more UE policy sections identified by a UPSI:\ni)\twith the PLMN ID part indicating the HPLMN; and\nii)\twith UPSC indicated in a tuple of the stored VPS URSP configuration, such that the tuple contains the network descriptor with a network descriptor entry containing:\nA)\tthe network descriptor entry type field set to \"one or more VPLMNs\" and the network descriptor entry value field containing PLMN ID of the RPLMN of an access, if the UE is registered via one or both accesses and the RPLMN of each access is a VPLMN;\nB)\tthe network descriptor entry type field set to \"one or more MCCs\" and the network descriptor entry value field containing MCC of the PLMN ID of the RPLMN of an access, if the UE is registered via one or both accesses and the RPLMN of each access is a VPLMN; or\nC)\tthe network descriptor entry type field set to \"any VPLMN\", if the UE is registered via one or both accesses and the RPLMN of each access is a VPLMN;\n2)\tthe UE shall consider as VPS URSP of the equivalent PLMN of the RPLMN all UE policy parts with URSP contents currently stored at the UE, which are a part of one or more UE policy sections identified by a UPSI:\ni)\twith the PLMN ID part indicating the HPLMN; and\nii)\twith UPSC indicated in a tuple of the stored VPS URSP configuration, such that the tuple contains the network descriptor with a network descriptor entry containing:\nA)\tthe network descriptor entry type field set to \"one or more VPLMNs\" and the network descriptor entry value field containing PLMN ID of an equivalent PLMN, if the UE is registered via one or both accesses, the RPLMN of each access is a VPLMN and the equivalent PLMN is a VPLMN;\nB)\tthe network descriptor entry type field set to \"one or more MCCs\" and the network descriptor entry value field containing MCC of the PLMN ID of an equivalent PLMN, if the UE is registered via one or both accesses, the RPLMN of each access is a VPLMN and the equivalent PLMN is a VPLMN; or\nC)\tthe network descriptor entry type field set to \"any VPLMN\", if the UE is registered via one or both accesses, the RPLMN of each access is a VPLMN and an equivalent PLMN is a VPLMN; and\n3)\tthe UE shall consider as PG URSP all UE policy parts with URSP contents currently stored at the UE except zero or more UE policy parts, if any, which are a part of one or more UE policy sections identified by a UPSI:\ni)\twith the PLMN ID part indicating the HPLMN; and\nii)\twith UPSC indicated in any tuple of the stored VPS URSP configuration; and\nb)\tthe UE shall consider all UE policy parts with URSP contents currently stored at the UE as the signalled URSP.\nWhen the UE needs to apply V2XP as specified in 3GPP\u00a0TS\u00a024.588\u00a0[19C], the UE shall consider all UE policy parts with V2XP contents currently stored at the UE.\nWhen the UE needs to apply ProSeP as specified in 3GPP\u00a0TS\u00a024.555\u00a0[19F], the UE shall consider all UE policy parts with ProSeP contents currently stored at the UE.\nWhen the UE needs to apply A2XP as specified in 3GPP\u00a0TS\u00a024.578\u00a0[61], the UE shall consider all UE policy parts with A2XP contents currently stored at the UE.\nWhen the UE needs to apply RSLPP as specified in 3GPP\u00a0TS\u00a024.514\u00a0[62], the UE shall consider all UE policy parts with RSLPP contents currently stored at the UE.\nD.4\tVoid\nD.5\tMessage functional definition and contents\nD.5.1\tManage UE policy command\nD.5.1.1\tMessage definition\nThe MANAGE UE POLICY COMMAND message is sent by the PCF to the UE to request the UE to manage UE policy sections, see table\u00a0D.5.1.1.1\nMessage type:\tMANAGE UE POLICY COMMAND\nSignificance:\tdual\nDirection:\tnetwork to UE\nTable\u00a0D.5.1.1.1: MANAGE UE POLICY COMMAND message content\n\nD.5.1.2\tUE policy network classmark\nThe UE policy network classmark is included when the PCF of a PLMN or an SNPN intends to provide the UE with information about the policy aspects of the network.\nD.5.1.3\tVPS URSP configuration\nThe VPS URSP configuration IE is included when the PCF of a PLMN intends to provide the UE with the VPS URSP configuration.\nD.5.2\tManage UE policy complete\nD.5.2.1\tMessage definition\nThe MANAGE UE POLICY COMPLETE message is sent by the UE to the PCF to report that all received instructions have been successfully executed at the UE, see table\u00a0D.5.2.1.1\nMessage type:\tMANAGE UE POLICY COMPLETE\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a0D.5.2.1.1: MANAGE UE POLICY COMPLETE message content\n\nD.5.3\tManage UE policy command reject\nD.5.3.1\tMessage definition\nThe MANAGE UE POLICY COMMAND REJECT message is sent by the UE to the PCF to report that one or more instructions could not be successfully executed at the UE, see table\u00a0D.5.3.1.1\nMessage type:\tMANAGE UE POLICY COMMAND REJECT\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a0D.5.3.1.1: MANAGE UE POLICY COMMAND REJECT message content\n\nD.5.4\tUE state indication\nD.5.4.1\tMessage definition\nThe UE STATE INDICATION message is sent by the UE to the PCF:\na)\tto deliver the UPSI(s) of the UE policy section(s) stored in the UE;\nb)\tto indicate whether the UE supports ANDSP; \nc)\tto indicate whether the UE supports URSP provisioning in EPS in the UE policy classmark IE;\nc1)\tto indicate whether the UE supports VPS URSP;\nc2)\tto indicate whether the UE supports reporting URSP rule enforcement; and\nd)\tto deliver the UE's one or more OS IDs;\nsee table\u00a0D.5.4.1.1.\nMessage type:\tUE STATE INDICATION\nSignificance:\tdual\nDirection:\tUE to network\nTable\u00a0D.5.4.1.1: UE STATE INDICATION message content\n\nD.6\tInformation elements coding\nD.6.1\tUE policy delivery service message type\nTable\u00a0D.6.1.1: UE policy delivery service message type\n\nD.6.2\tUE policy section management list\nThe purpose of the UE policy section management list information element is to transfer from the PCF to the UE a list of instructions to be performed at the UE for management of UE policy section stored at the UE.\nThe UE policy section management list information element is coded as shown in figure\u00a0D.6.2.1, figure\u00a0D.6.2.2, figure\u00a0D.6.2.3, figure\u00a0D.6.2.4, figure\u00a0D.6.2.5, figure\u00a0D.6.2.6, figure\u00a0D.6.2.7 and table\u00a0D.6.2.1.\nThe UE policy section management list information element has a minimum length of 12 octets and a maximum length of 65534 octets.\nFigure\u00a0D.6.2.1: UE policy section management list information element\n\nFigure\u00a0D.6.2.2: UE policy section management list contents\n\nFigure\u00a0D.6.2.3: UE policy section management sublist\n\nFigure\u00a0D.6.2.4: UE policy section management sublist contents\n\nFigure\u00a0D.6.2.5: Instruction\n\nFigure\u00a0D.6.2.6: UE policy section contents\n\nFigure\u00a0D.6.2.7: UE policy part\n\nTable D.6.2.1: UE policy section management list information element\nD.6.3\tUE policy section management result\nThe purpose of the UE policy section management result information element is to transfer from the UE to the PCF information about instructions for UE policy section management which the UE could not execute successfully.\nThe UE policy section management result information element is coded as shown in figure\u00a0D.6.3.1, figure\u00a0D.6.3.2, figure\u00a0D.6.3.3, figure\u00a0D.6.3.4, figure\u00a0D.6.3.5 and table\u00a0D.6.3.1.\nThe UE policy section management result information element has a minimum length of 12 octets and a maximum length of 65534 octets.\nFigure\u00a0D.6.3.1: UE policy section management result information element\n\nFigure\u00a0D.6.3.2: UE policy section management result contents\n\nFigure\u00a0D.6.3.3: UE policy section management subresult\n\nFigure\u00a0D.6.3.4: UE policy section management subresult contents\n\nFigure\u00a0D.6.3.5: Result\n\nTable D.6.3.1: UE policy section management result information element\n\nD.6.4\tUPSI list\nThe purpose of the UPSI list information element is to transfer from the UE to the PCF a list of UPSIs.\nThe UPSI list information element is coded as shown in figure\u00a0D.6.4.1, figure\u00a0D.6.4.2, and table\u00a0D.6.4.1.\nThe UPSI list information element has a minimum length of 3 octets and a maximum length of 65532 octets.\nNOTE:\tA PCF implementing a previous version of the present specification will expect the UPSI list information element to have a minimum length of 10 octets and could be unable to decode a UPSI list information element with a length of 3 octets i.e. a UPSI list information element not containing any UPSI.\nFigure\u00a0D.6.4.1: UPSI list information element\nFigure\u00a0D.6.4.2: UPSI sublist\nTable D.6.4.1: UPSI list information element\n\nD.6.5\tUE policy classmark\nThe purpose of the UE policy classmark information element is to provide the network with information about the policy aspects of the UE.\nThe UE policy classmark information element is coded as shown in figure\u00a0D.6.5.1 and table\u00a0D.6.5.1.\nThe UE policy classmark is a type 4 information element with a minimum length of 3 octets and a maximum length of 5 octets.\nFigure\u00a0D.6.5.1: UE policy classmark information element\nTable\u00a0D.6.5.1: UE policy classmark information element\n\nD.6.6\tUE OS Id\nThe purpose of the UE OS Id information element is to provide the network with information about the OS of the UE.\nThe UE OS Id information element is coded as shown in figure\u00a0D.6.6.1 and table\u00a0D.6.6.1.\nThe UE OS Id is a type 4 information element with a minimum length of 18 octet and a maximum length of 242 octets.\nFigure\u00a0D.6.6.1: UE OS Id information element\nTable\u00a0D.6.6.1: UE OS Id information element\n\nD.6.7\tUE policy network classmark\nThe purpose of the UE policy network classmark information element is to provide the UE with information about the policy aspects of the network.\nThe UE policy network classmark information element is coded as shown in figure\u00a0D.6.7.1 and table\u00a0D.6.7.1.\nThe UE policy network classmark is a type 4 information element with a minimum length of 3 octets and a maximum length of 5 octets.\nFigure\u00a0D.6.7.1: UE policy network classmark information element\nTable\u00a0D.6.7.1: UE policy network classmark information element\n\nD.6.8\tVPS URSP configuration\nThe purpose of the VPS URSP configuration information element is to transfer the VPS URSP configuration from the PCF to the UE. The VPS URSP configuration contains zero or more tuples. Each tuple contains the tuple ID identifying the tuple, the network descriptor identifying one or more VPLMNs, and zero or more UPSCs of HPLMN's UE policy sections which contain solely one or more UE policy parts with the UE policy part type set to \"URSP\", such that the URSP rules in those one or more UE policy parts are applicable to the VPLMN and its equivalent PLMN.\nThe VPS URSP configuration information element is coded as shown in figure\u00a0D.6.8.1, figure\u00a0D.6.8.2, figure\u00a0D.6.8.3, figure\u00a0D.6.8.4, figure\u00a0D.6.8.5, figure\u00a0D.6.8.6, figure\u00a0D.6.8.7, figure\u00a0D.6.8.8, figure\u00a0D.6.8.9, and table\u00a0D.6.8.1.\nThe VPS URSP configuration is type 6 information element with a minimum length of 3 octets and a maximum length of 65533 octets.\n\nFigure\u00a0D.6.8.1: VPS URSP configuration information element\nFigure\u00a0D.6.8.2: Tuple\nFigure\u00a0D.6.8.3: Network descriptor\nFigure\u00a0D.6.8.4: Network descriptor entry\nFigure\u00a0D.6.8.5: Network descriptor entry value for network descriptor entry type set to \"one or more VPLMNs\"\nFigure\u00a0D.6.8.6: PLMN ID\nFigure\u00a0D.6.8.7: Network descriptor entry value for network descriptor entry type set to \"one or more MCCs\"\nFigure\u00a0D.6.8.8: MCC pair\nFigure\u00a0D.6.8.9: Odd MCC\nTable D.6.8.1: VPS URSP configuration information element\n\nD.7\tTimers of UE policy delivery service\nTimers of UE policy delivery service are shown in table\u00a0D.7.1.\nTable\u00a0D.7.1: Timers of UE policy delivery service \u2013 PCF side\n\nD.8\tHandling of unknown, unforeseen, and erroneous UPDS data\nD.8.1\tGeneral\nThe procedures specified in the subclause apply to those messages which pass the checks described in this subclause.\nThis subclause also specifies procedures for the handling of unknown, unforeseen, and erroneous UPDS data by the receiving entity. These procedures are called \"error handling procedures\", but in addition to providing recovery mechanisms for error situations they define a compatibility mechanism for future extensions of the UPDS.\nSubclauses\u00a0D.8.1 to D.8.8 shall be applied in order of precedence.\nDetailed error handling procedures in the network are implementation dependent and may vary from PLMN to PLMN. However, when extensions of UPDS are developed, networks are assumed to have the error handling which is indicated in this subclause as mandatory (\"shall\") and that is indicated as strongly recommended (\"should\").\nAlso, the error handling of the network is only considered as mandatory or strongly recommended when certain thresholds for errors are not reached during a dedicated connection.\nFor definition of semantical and syntactical errors see 3GPP\u00a0TS\u00a024.007\u00a0[11], subclause\u00a011.4.2.\nD.8.2\tMessage too short or too long\nD.8.2.1\tMessage too short\nWhen a message is received that is too short to contain a complete message type information element, that message shall be ignored, c.f. 3GPP\u00a0TS\u00a024.007\u00a0[11].\nD.8.2.2\tMessage too long\nThe maximum size of a UE policy delivery service message is 65535 octets.\nD.8.3\tUnknown or unforeseen procedure transaction identity\nD.8.3.1\tProcedure transaction identity\nThe following network procedures shall apply for handling an unknown, erroneous, or unforeseen PTI received in a UPDS message:\na)\tIn case the network receives a MANAGE UE POLICY COMPLETE message or MANAGE UE POLICY COMMAND REJECT message in which the PTI value is an assigned or unassigned value that does not match any PTI in use, the network shall ignore the UPDS message.\nb)\tIn case the network receives a UPDS message in which the PTI value is a reserved value, the network shall ignore the UPDS message.\nThe following UE procedures shall apply for handling an unknown, erroneous, or unforeseen PTI received in a UPDS message:\na)\tIn case the UE receives a UPDS message in which the PTI value is a reserved value, the UE shall ignore the UPDS message.\nD.8.4\tUnknown or unforeseen message type\nIf the UE or the network receives a UPDS message with message type not defined for the UPDS or not implemented by the receiver, it shall ignore the UPDS message.\nNOTE:\tA message type not defined for the UPDS in the given direction is regarded by the receiver as a message type not defined for the UPDS, see 3GPP\u00a0TS\u00a024.007\u00a0[11].\nIf the UE receives a message not compatible with the UPDS state, the UE shall ignore the UPDS message.\nIf the network receives a message not compatible with the UPDS state, the network actions are implementation dependent.\nD.8.5\tNon-semantical mandatory information element errors\nD.8.5.1\tCommon procedures\nWhen on receipt of a message,\na)\tan \"imperative message part\" error; or\nb)\ta \"missing mandatory IE\" error\nis diagnosed or when a message containing:\na)\ta syntactically incorrect mandatory IE;\nb)\tan IE with an IEI unknown in the message, but encoded as \"comprehension required\" (see 3GPP\u00a0TS\u00a024.007\u00a0[11]); or\nc)\tan out of sequence IE encoded as \"comprehension required\" (see 3GPP\u00a0TS\u00a024.007\u00a0[11]) is received,\nthe UE shall ignore the UPDS message;\nthe network shall proceed as follows:\n\tthe network shall:\n1)\ttry to treat the message (the exact further actions are implementation dependent); or\n2)\tignore the message.\nD.8.6\tUnknown and unforeseen IEs in the non-imperative message part\nD.8.6.1\tIEIs unknown in the message\nThe UE shall ignore all IEs unknown in a message which are not encoded as \"comprehension required\" (see 3GPP\u00a0TS\u00a024.007\u00a0[11]).\nThe network shall take the same approach.\nD.8.6.2\tOut of sequence IEs\nThe UE shall ignore all out of sequence IEs in a message which are not encoded as \"comprehension required\" (see 3GPP\u00a0TS\u00a024.007\u00a0[11]).\nThe network should take the same approach.\nD.8.6.3\tRepeated IEs\nIf an information element with format T, TV, TLV, or TLV-E is repeated in a message in which repetition of the information element is not specified in subclause\u00a0D.5, the UE shall handle only the contents of the information element appearing first and shall ignore all subsequent repetitions of the information element. When repetition of information elements is specified, the UE shall handle only the contents of specified repeated information elements. If the limit on repetition of information elements is exceeded, the UE shall handle the contents of information elements appearing first up to the limit of repetitions and shall ignore all subsequent repetitions of the information element.\nThe network should follow the same procedures.\nD.8.7\tNon-imperative message part errors\nThis category includes:\na)\tsyntactically incorrect optional IEs; and\nb)\tconditional IE errors.\nD.8.7.1\tSyntactically incorrect optional IEs\nThe UE shall treat all optional IEs that are syntactically incorrect in a message as not present in the message.\nThe network shall take the same approach.\nD.8.7.2\tConditional IE errors\nWhen upon receipt of a UPDS message the UE diagnoses a \"missing conditional IE\" error or an \"unexpected conditional IE\" error, or when it receives a UPDS message containing at least one syntactically incorrect conditional IE, the UE shall ignore the message.\nWhen the network receives a message and diagnoses a \"missing conditional IE\" error or an \"unexpected conditional IE\" error or when it receives a message containing at least one syntactically incorrect conditional IE, the network shall either:\na)\ttry to treat the message (the exact further actions are implementation dependent); or\nb)\tignore the message.\nD.8.8\tMessages with semantically incorrect contents\nWhen a message with semantically incorrect contents is received, the UE shall perform the foreseen reactions of the procedural part of subclauses\u00a0D.2. If, however no such reactions are specified, the UE shall ignore the message.\nThe network should follow the same procedure.\nAnnex E (informative):\nVoid\nAnnex F (informative):\nChange history\n",
    "metadata": {
        "title0": "3GPP TS 24.501",
        "title1": "Technical Specification Group Core Network and Terminals",
        "title2": "Non-Access-Stratum(NAS) protocol for 5G System(5GS); Stage 3;",
        "title3": "Physical layer procedures for control",
        "Release": 18,
        "Version": "V18.5.0",
        "Publish_time": "2023-12"
    }
}