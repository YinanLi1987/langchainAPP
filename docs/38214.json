{
    "page_content": "3GPP TS 38.214 V18.2.0 (2024-03)\nTechnical Specification\n3rd Generation Partnership Project;\nTechnical Specification Group Radio Access Network;\nNR;\nPhysical layer procedures for data\n(Release 18)\n\t\n\t\n\nThe present document has been developed within the 3rd Generation Partnership Project (3GPP TM) and may be further elaborated for the purposes of 3GPP..\nThe present document has not been subject to any approval process by the 3GPP Organizational Partners and shall not be implemented.\nThis Specification is provided for future development work within 3GPP only. The Organizational Partners accept no liability for any use of this Specification.\nSpecifications and Reports for implementation of the 3GPP TM system should be obtained via the 3GPP Organizational Partners' Publications Offices.\n\n\n\nKeywords\n3GPP, New Radio, Layer 1\n\n3GPP\nPostal address\n\n3GPP support office address\n650 Route des Lucioles - Sophia Antipolis\nValbonne - FRANCE\nTel.: +33 4 92 94 42 00 Fax: +33 4 93 65 47 16\nInternet\nhttp://www.3gpp.org\n\nCopyright Notification\nNo part may be reproduced except as authorized by written permission.\nThe copyright and the foregoing restriction extend to reproduction in all media.\n\n\u00a9 2024, 3GPP Organizational Partners (ARIB, ATIS, CCSA, ETSI, TSDSI, TTA, TTC).\nAll rights reserved.\n\nUMTS\u2122 is a Trade Mark of ETSI registered for the benefit of its members\n3GPP\u2122 is a Trade Mark of ETSI registered for the benefit of its Members and of the 3GPP Organizational Partners\nLTE\u2122 is a Trade Mark of ETSI registered for the benefit of its Members and of the 3GPP Organizational Partners\nGSM\u00ae and the GSM logo are registered and owned by the GSM Association\nContents\nForeword\t7\n1\tScope\t8\n2\tReferences\t8\n3\tDefinitions of terms, symbols and abbreviations\t9\n3.1\tTerms\t9\n3.2\tSymbols\t9\n3.3\tAbbreviations\t9\n4\tPower control\t10\n4.1\tPower allocation for downlink\t10\n5\tPhysical downlink shared channel related procedures\t11\n5.1\tUE procedure for receiving the physical downlink shared channel\t11\n5.1.1\tTransmission schemes\t17\n5.1.1.1\tTransmission scheme 1\t17\n5.1.2\tResource allocation\t17\n5.1.2.1\tResource allocation in time domain\t17\n5.1.2.1.1\tDetermination of the resource allocation table to be used for PDSCH\t22\n5.1.2.2\tResource allocation in frequency domain\t26\n5.1.2.2.1\tDownlink resource allocation type 0\t26\n5.1.2.2.2\tDownlink resource allocation type 1\t27\n5.1.2.2.3\tDownlink resource allocation type 1 for multicast/broadcast\t28\n5.1.2.3\tPhysical resource block (PRB) bundling\t29\n5.1.3\tModulation order, target code rate, redundancy version and transport block size determination\t30\n5.1.3.1\tModulation order and target code rate determination\t32\n5.1.3.2\tTransport block size determination\t38\n5.1.4\tPDSCH resource mapping\t42\n5.1.4.1\tPDSCH resource mapping with RB symbol level granularity\t42\n5.1.4.2\tPDSCH resource mapping with RE level granularity\t43\n5.1.5\tAntenna ports quasi co-location\t46\n5.1.6\tUE procedure for receiving reference signals\t54\n5.1.6.1\tCSI-RS reception procedure\t54\n5.1.6.1.1\tCSI-RS for tracking\t55\n5.1.6.1.1.1\tAperiodic CSI-RS for tracking for fast SCell activation\t57\n5.1.6.1.2\tCSI-RS for L1-RSRP and L1-SINR computation\t57\n5.1.6.1.3\tCSI-RS for mobility\t58\n5.1.6.2\tDM-RS reception procedure\t58\n5.1.6.3\tPT-RS reception procedure\t62\n5.1.6.4\tSRS reception procedure for CLI\t64\n5.1.6.5\tPRS reception procedure\t64\n5.1.6.5.1\tPRS receiver frequency hopping\t71\n5.1.6.5.2\tPRS for carrier phase positioning\t72\n5.1.6.5.3\tPRS bandwidth aggregation for positioning measurements\t72\n5.1.7\tCode block group based PDSCH transmission\t73\n5.1.7.1\tUE procedure for grouping of code blocks to code block groups\t73\n5.1.7.2\tUE procedure for receiving code block group based transmissions\t73\n5.2\tUE procedure for reporting channel state information (CSI)\t74\n5.2.1\tChannel state information framework\t74\n5.2.1.1\tReporting settings\t74\n5.2.1.2\tResource settings\t75\n5.2.1.3\t(void)\t76\n5.2.1.4\tReporting configurations\t76\n5.2.1.4.1\tResource Setting configuration\t79\n5.2.1.4.2\tReport quantity configurations\t81\n5.2.1.4.3\tL1-RSRP Reporting\t88\n5.2.1.4.4\tL1-SINR Reporting\t88\n5.2.1.4.5\tTDCP Reporting\t89\n5.2.1.5\tTriggering/activation of CSI Reports and CSI-RS\t90\n5.2.1.5.1\tAperiodic CSI Reporting/Aperiodic CSI-RS when the triggering PDCCH and the CSI-RS have the same numerology\t90\n5.2.1.5.1a\tAperiodic CSI Reporting/Aperiodic CSI-RS when the triggering PDCCH and the CSI-RS have different numerologies\t95\n5.2.1.5.2\tSemi-persistent CSI/Semi-persistent CSI-RS\t97\n5.2.1.5.3\tAperiodic CSI-RS for tracking for fast SCell activation\t99\n5.2.1.6\tCSI processing criteria\t99\n5.2.2\tChannel state information\t102\n5.2.2.1\tChannel quality indicator (CQI)\t102\n5.2.2.1.1\t(void)\t104\n5.2.2.2\tPrecoding matrix indicator (PMI)\t104\n5.2.2.2.1\tType I Single-Panel Codebook\t104\n5.2.2.2.2\tType I Multi-Panel Codebook\t111\n5.2.2.2.3\tType II Codebook\t115\n5.2.2.2.4\tType II Port Selection Codebook\t121\n5.2.2.2.5\tEnhanced Type II Codebook\t124\n5.2.2.2.6\tEnhanced Type II Port Selection Codebook\t131\n5.2.2.2.7\tFurther enhanced Type II port selection codebook\t132\n5.2.2.2.8\tEnhanced Type II codebook for CJT\t137\n5.2.2.2.9\tFurther enhanced Type II port selection codebook for CJT\t143\n5.2.2.2.10\tEnhanced Type II codebook for predicted PMI\t149\n5.2.2.2.11\tFurther enhanced Type II port selection codebook for predicted PMI\t153\n5.2.2.3\tReference signal (CSI-RS)\t154\n5.2.2.3.1\tNZP CSI-RS\t154\n5.2.2.4\tChannel State Information \u2013 Interference Measurement (CSI-IM)\t155\n5.2.2.5\tCSI reference resource definition\t155\n5.2.2.5.1\tUE assumptions for CQI/PMI/RI calculation\t158\n5.2.2.5.1a\tUE assumptions for CQI/PMI/RI calculation for NCJT\t159\n5.2.2.5.1b\tUE assumptions for CQI/PMI/RI calculation for CJT\t159\n5.2.2.5.1c\tUE assumptions for CQI/PMI/RI calculation for predicted CSI\t160\n5.2.3\tCSI reporting using PUSCH\t160\n5.2.4\tCSI reporting using PUCCH\t166\n5.2.5\tPriority rules for CSI reports\t167\n5.3\tUE PDSCH processing procedure time\t168\n5.3.1\tApplication delay of the minimum scheduling offset restriction\t170\n5.4\tUE CSI computation time\t171\n5.5\tUE PDSCH reception preparation time with cross carrier scheduling with different subcarrier spacings for PDCCH and PDSCH\t173\n6\tPhysical uplink shared channel related procedure\t174\n6.1\tUE procedure for transmitting the physical uplink shared channel\t174\n6.1.1\tTransmission schemes\t177\n6.1.1.1\tCodebook based UL transmission\t178\n6.1.1.2\tNon-Codebook based UL transmission\t181\n6.1.2\tResource allocation\t183\n6.1.2.1\tResource allocation in time domain\t183\n6.1.2.1.1\tDetermination of the resource allocation table to be used for PUSCH\t194\n6.1.2.2\tResource allocation in frequency domain\t197\n6.1.2.2.1\tUplink resource allocation type 0\t198\n6.1.2.2.2\tUplink resource allocation type 1\t198\n6.1.2.2.3\tUplink resource allocation type 2\t199\n6.1.2.3\tResource allocation for uplink transmission with configured grant\t201\n6.1.2.3.1\tTransport Block repetition for uplink transmissions of PUSCH repetition Type A with a configured grant\t203\n6.1.2.3.2\tTransport Block repetition for uplink transmissions of PUSCH repetition Type B with a configured grant\t205\n6.1.2.3.3\tTransport Block repetition for uplink transmissions of TB processing over multiple slots with a configured grant\t206\n6.1.3\tUE procedure for applying transform precoding on PUSCH\t206\n6.1.4\tModulation order, redundancy version and transport block size determination\t207\n6.1.4.1\tModulation order and target code rate determination\t209\n6.1.4.2\tTransport block size determination\t214\n6.1.5\tCode block group based PUSCH transmission\t215\n6.1.5.1\tUE procedure for grouping of code blocks to code block groups\t216\n6.1.5.2\tUE procedure for transmitting code block group based transmissions\t216\n6.1.6\tUplink switching\t216\n6.1.6.1\tUplink switching for EN-DC\t217\n6.1.6.2\tUplink switching for carrier aggregation\t218\n6.1.6.2.0\tUplink switching with two uplink bands\t218\n6.1.6.2.1\tvoid\t219\n6.1.6.2.2\tUplink switching with 3 or 4 uplink bands\t219\n6.1.6.3\tUplink switching with two uplink bands for supplementary uplink\t220\n6.1.7\tUE procedure for determining time domain windows for bundling DM-RS\t220\n6.2\tUE reference signal (RS) procedure\t223\n6.2.1\tUE sounding procedure\t223\n6.2.1.1\tUE SRS frequency hopping procedure\t231\n6.2.1.2\tUE sounding procedure for DL CSI acquisition\t231\n6.2.1.3\tUE sounding procedure between component carriers\t237\n6.2.1.4\tUE sounding procedure for positioning purposes\t239\n6.2.1.4.1\tSRS frequency hopping for positioning\t240\n6.2.1.4.2\tSRS bandwidth aggregation for positioning measurements\t241\n6.2.2\tUE DM-RS transmission procedure\t242\n6.2.3\tUE PT-RS transmission procedure\t244\n6.2.3.1\tUE PT-RS transmission procedure when transform precoding is not enabled\t244\n6.2.3.2\tUE PT-RS transmission procedure when transform precoding is enabled\t247\n6.3\tUE PUSCH frequency hopping procedure\t248\n6.3.1\tFrequency hopping for PUSCH repetition Type A and for TB processing over multiple slots\t248\n6.3.2\tFrequency hopping for PUSCH repetition Type B\t250\n6.4\tUE PUSCH preparation procedure time\t250\n7\tUE procedures for transmitting and receiving on a carrier with intra-cell guard bands\t252\n8\tPhysical sidelink shared channel related procedures\t252\n8.1\tUE procedure for transmitting the physical sidelink shared channel\t254\n8.1.1\tTransmission schemes\t256\n8.1.2\tResource allocation\t256\n8.1.2.1\tResource allocation in time domain\t256\n8.1.2.2\tResource allocation in frequency domain\t258\n8.1.3\tModulation order, target code rate, redundancy version and transport block size determination\t258\n8.1.3.1\tModulation order and target code rate determination\t258\n8.1.3.2\tTransport block size determination\t258\n8.1.4\tUE procedure for determining the subset of resources to be reported to higher layers in PSSCH resource selection in sidelink resource allocation mode 2\t260\n8.1.4A\tUE procedure for determining a set of preferred or non-preferred resources for another UE's transmission\t267\n8.1.4B\tVoid\t268\n8.1.4C\tUE procedure for using a received non-preferred resource set\t268\n8.1.5\tUE procedure for determining slots and resource blocks for PSSCH transmission associated with an SCI format 1-A\t269\n8.1.5A\tUE procedure for determining slots and resource blocks indicated by a preferred or non-preferred resource set\t271\n8.1.6\tSidelink congestion control in sidelink resource allocation mode 2\t271\n8.1.7\tUE procedure for determining the number of logical slots for a reservation period\t272\n8.2\tUE procedure for transmitting sidelink reference signals\t272\n8.2.1\tCSI-RS transmission procedure\t272\n8.2.2\tPSSCH DM-RS transmission procedure\t273\n8.2.3\tPT-RS transmission procedure\t273\n8.2.4\tSL PRS transmission procedure\t273\n8.2.4.1\tResource allocation\t273\n8.2.4.1.1\tResource allocation in time domain\t274\n8.2.4.1.2\tResource allocation in frequency domain\t274\n8.2.4.2\tUE procedure for determining the subset of resources to be reported to higher layers in SL PRS resource selection in a dedicated SL PRS resource pool in sidelink resource allocation mode 2\t275\n8.2.4.2A\tUE procedure for determining slots and SL PRS resource(s) associated with an SCI format 1-B in a dedicated SL PRS resource pool\t276\n8.2.4.3\tSidelink congestion control in a dedicated SL PRS resource pool in sidelink resource allocation mode 2\t277\n8.3\tUE procedure for receiving the physical sidelink shared channel\t277\n8.4\tUE procedure for receiving reference signals\t277\n8.4.1\tCSI-RS reception procedure\t277\n8.4.2\tDM-RS reception procedure for RSRP computation\t277\n8.4.3\tPT-RS reception procedure\t277\n8.4.4\tSL PRS reception procedure\t278\n8.5\tUE procedure for reporting channel state information (CSI)\t278\n8.5.1\tChannel state information framework\t278\n8.5.1.1\tReporting configurations\t278\n8.5.1.2\tTriggering of sidelink CSI reports\t279\n8.5.2\tChannel state information\t279\n8.5.2.1\tCSI reporting quantities\t279\n8.5.2.1.1\tChannel quality indicator (CQI)\t279\n8.5.2.2\tReference signal (CSI-RS)\t279\n8.5.2.3\tCSI reference resource definition\t280\n8.5.3\tCSI reporting\t280\n8.6\tUE PSSCH preparation procedure time\t280\n9\tUE procedures for transmitting and receiving for RTT-based propagation delay compensation\t281\n9.1\tPRS reception procedure for RTT-based propagation delay compensation\t282\nAnnex <A> (informative):\tChange history\t284\n\nForeword\nThis Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n\n1\tScope\nThe present document specifies and establishes the characteristics of the physicals layer procedures of data channels for 5G-NR.\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n[1]\t3GPP\u00a0TR\u00a021.905: \"Vocabulary for 3GPP Specifications\"\n[2]\t3GPP TS 38.201: \" NR; Physical Layer \u2013 General Description\"\n[3]\t3GPP TS 38.202: \"NR; Services provided by the physical layer\"\n[4]\t3GPP TS 38.211: \"NR; Physical channels and modulation\"\n[5]\t3GPP TS 38.212: \"NR; Multiplexing and channel coding\"\n[6]\t3GPP TS 38.213: \"NR; Physical layer procedures for control\"\n[7]\t3GPP TS 38.215: \"NR; Physical layer measurements\"\n[8]\t3GPP TS 38.101-1: \"NR; User Equipment (UE) radio transmission and reception; Part 1: Range 1 Standalone\"\n[9]\t3GPP TS 38.104: \"NR; Base Station (BS) radio transmission and reception\"\n[10]\t3GPP TS 38.321: \"NR; Medium Access Control (MAC) protocol specification\"\n[11]\t3GPP TS 38.133: \"NR; Requirements for support of radio resource management\"\n[12]\t3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol specification\"\n[13]\t3GPP TS 38.306: \"NR; User Equipment (UE) radio access capabilities\"\n[14]\t3GPP TS 38.423: \"NG-RAN; Xn Application Protocol (XnAP)\"\n[15]\t3GPP TS 36.211: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Physical channels and modulation\"\n[16]\t3GPP TS 37.213: \"Physical layer procedures for shared spectrum channel access\"\n[17]\t3GPP TS 37.355: \"LTE Positioning Protocol (LPP)\"\n[18]\t3GPP TS 38.822: \"NR; User Equipment (UE) feature list\"\n[19]\t3GPP TS 36.213: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Physical layer procedures\"\n[20]\t3GPP TS 38.305: \"NG Radio Access Network (NG-RAN); Stage 2 functional specification of User Equipment (UE) positioning in NG-RAN\"\n\n3\tDefinitions of terms, symbols and abbreviations\n3.1\tTerms\nFor the purposes of the present document, the terms and definitions given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].\n3.2\tSymbols\nFor the purposes of the present document, the following symbols apply:\n3.3\tAbbreviations\nFor the purposes of the present document, the abbreviations given in TR\u00a021.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR\u00a021.905\u00a0[1].\nARP\tAntenna Reference Point\nBWP\tBandwidth Part\nCBG\tCode Block Group\nCJT\tCoherent Joint Transmission\nCLI\tCross Link Interference\nCP\tCyclic Prefix\nCQI\tChannel Quality Indicator\nCPU\tCSI Processing Unit \nCRB\tCommon Resource Block\nCRC\tCyclic Redundancy Check\nCRI\tCSI-RS Resource Indicator\nCSI\tChannel State Information\nCSI-RS\tChannel State Information Reference Signal\nCSI-RSRP\tCSI Reference Signal Received Power\nCSI-RSRQ\tCSI Reference Signal Received Quality\nCSI-SINR\tCSI Signal-to-Interference-plus-Noise Ratio\nCW\tCodeword\nDCI\tDownlink Control Information\nDL\tDownlink\nDM-RS\tDemodulation Reference Signal\nDRX\tDiscontinuous Reception\nEPRE\tEnergy Per Resource Element\nIAB-MT\tIntegrated Access and Backhaul \u2013 Mobile Termination\nL1-RSRP\tLayer 1 Reference Signal Received Power\nLI\tLayer Indicator\nLoS\tLine of Sight \nMCS\tModulation and Coding Scheme\nNCJT\tNon-Coherent Joint Transmission\nNCR\tNetwork-controlled Repeater\nNCR-MT\tNetwork controlled repeater \u2013 Mobile Termination\nNLoS\tNon-Line of Sight \nPDCCH\tPhysical Downlink Control Channel\nPDSCH\tPhysical Downlink Shared Channel\nPSS\tPrimary Synchronisation Signal\nPUCCH\tPhysical Uplink Control Channel\nQCL\tQuasi Co-Location\nPMI\tPrecoding Matrix Indicator\nPRB\tPhysical Resource Block\nPRG\tPrecoding Resource block Group\nPRS\tPositioning Reference Signal\nPT-RS\tPhase-Tracking Reference Signal\nRB\tResource Block\nRBG\tResource Block Group\nRI\tRank Indicator\nRIV\tResource Indicator Value\nRS\tReference Signal \nSCI\tSidelink Control Information\nSL PRS\tSidelink Positioning Reference Signal\nSLIV\tStart and Length Indicator Value \nSR\tScheduling Request\nSRS\tSounding Reference Signal\nSS\tSynchronisation Signal\nSSS\tSecondary Synchronisation Signal\nSS-RSRP\tSS Reference Signal Received Power\nSS-RSRQ\tSS Reference Signal Received Quality\nSS-SINR\tSS Signal-to-Interference-plus-Noise Ratio\nTB\tTransport Block\nTCI\tTransmission Configuration Indicator\nTDCP\tTime Domain Channel Properties\nTDM\tTime Division Multiplexing\nUE\tUser Equipment\nUL\tUplink\n4\tPower control \nThroughout this specification, unless otherwise noted, statements using the term \"UE\" in clauses 4, 5, or 6 are equally applicable to the IAB-MT part of an IAB node and to the NCR-MT part of an NCR node.\n4.1\tPower allocation for downlink \nThe gNB determines the downlink transmit EPRE.\nFor the purpose of SS-RSRP, SS-RSRQ and SS-SINR measurements, the UE may assume downlink EPRE is constant across the bandwidth. For the purpose of SS-RSRP, SS-RSRQ and SS-SINR measurements, the UE may assume downlink EPRE is constant over SSS carried in different SS/PBCH blocks. For the purpose of SS-RSRP, SS-RSRQ and SS-SINR measurements, the UE may assume that the ratio of SSS EPRE to PBCH DM-RS EPRE is 0 dB. \nFor the purpose of CSI-RSRP, CSI-RSRQ and CSI-SINR measurements, the UE may assume downlink EPRE of a port of CSI-RS resource configuration is constant across the configured downlink bandwidth and constant across all configured OFDM symbols.\nThe downlink SS/PBCH SSS EPRE can be derived from the SS/PBCH downlink transmit power given by the parameter ss-PBCH-BlockPower provided by higher layers. The downlink SSS transmit power is defined as the linear average over the power contributions (in [W]) of all resource elements that carry the SSS within the operating system bandwidth. \nThe downlink CSI-RS EPRE can be derived from the SS/PBCH block downlink transmit power given by the parameter ss-PBCH-BlockPower and CSI-RS power offset given by the parameter powerControlOffsetSS provided by higher layers if the SS/PBCH block is associated with serving cell PCI, or derived from ss-PBCH-BlockPower-r17 in SSB-MTC-AdditionalPCI-r17 and powerControlOffsetSS provided by higher layers if the SS/PBCH block is associated with additional PCI different from serving cell PCI, where the CSI-RS is QCLed with the SS/PBCH block. The downlink reference-signal transmit power is defined as the linear average over the power contributions (in [W]) of the resource elements that carry the configured CSI-RS within the operating system bandwidth.\nFor downlink DM-RS associated with PDSCH, the UE may assume the ratio of PDSCH EPRE to DM-RS EPRE ( [dB]) is given by Table 4.1-1 according to the number of DM-RS CDM groups without data as described in Clause 5.1.6.2. The DM-RS scaling factor  specified in Clause 7.4.1.1.2 of [4, TS 38.211] is given by .\nTable 4.1-1: The ratio of PDSCH EPRE to DM-RS EPRE\n\nWhen the UE is scheduled with one or two PT-RS ports associated with the PDSCH, \n-\tif the UE is configured with the higher layer parameter epre-Ratio, the ratio of PT-RS EPRE to PDSCH EPRE per layer per RE for each PT-RS port () is given by Table 4.1-2 or Table 4.1-2A according to the epre-Ratio, the PT-RS scaling factor specified in clause 7.4.1.2.2 of [4, TS 38.211] is given by.\n-\totherwise, the UE shall assume epre-Ratio is set to state '0' in Table 4.1-2 if not configured.\nTable 4.1-2: PT-RS EPRE to PDSCH EPRE per layer per RE (), if [enhanced-dmrs-Type_r18] is not configured in DMRS-DownlinkConfig \n\nTable 4.1-2A: PT-RS EPRE to PDSCH EPRE per layer per RE (), if [enhanced-dmrs-Type_r18] is configured in DMRS-DownlinkConfig\n\nFor link recovery, as described in clause 6 of [6, TS 38.213] the ratio of the PDCCH EPRE to NZP CSI-RS EPRE is assumed as 0 dB.\n5\tPhysical downlink shared channel related procedures\n5.1\tUE procedure for receiving the physical downlink shared channel\nFor downlink, a maximum of 16 HARQ processes per cell are supported by the UE, or subject to UE capability, a maximum of 32 HARQ processes per cell as defined in [13, TS 38.306]. The number of processes the UE may assume will at most be used for the downlink is configured to the UE for each cell separately by higher layer parameter nrofHARQ-ProcessesForPDSCH or nrofHARQ-ProcessesForPDSCH-v1700, and when no configuration is provided the UE may assume a default number of 8 processes.\nA UE shall upon detection of a PDCCH with a configured DCI format 1_0, 1_1, 1_2, 1_3, 4_0, 4_1, or 4_2 decode the corresponding PDSCHs as indicated by that DCI. When the UE is scheduled with multiple PDSCHs on a serving cell by a DCI, HARQ process ID indicated by this DCI applies to the first PDSCH not overlapping with a UL symbol indicated by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated if provided, HARQ process ID is then incremented by 1 for each subsequent PDSCH(s) in the scheduled order, with modulo operation of nrofHARQ-ProcessesForPDSCH applied if nrofHARQ-ProcessesForPDSCH is provided, or with modulo operation of nrofHARQ-ProcessesForPDSCH-v1700 applied if or nrofHARQ-ProcessesForPDSCH-v1700 is provided, or with modulo operation of 8 applied, otherwise. HARQ process ID is not incremented for PDSCH(s) not received if at least one of the symbols indicated by the indexed row of the used resource allocation table in the slot overlaps with a UL symbol indicated by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated if provided. When a UE is configured by the higher layer parameter repetitionScheme set to 'tdmSchemeA', the PDSCH includes two PDSCH transmission occasions. For each PDSCH, if either PDSCH occasion overlaps with a UL symbol indicated by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated if provided, the PDSCH is not received and HARQ process ID is not increment for the PDSCH. For any HARQ process ID(s) in a given scheduled cell, the UE is not expected to receive a PDSCH that overlaps in time with another PDSCH if the UE is not capable of receiving FDMed unicast and multicast PDSCH per slot per carrier. When HARQ feedback for the HARQ process ID is not disabled, or for the HARQ process associated with the first SPS PDSCH when HARQ-feedbackEnablingforSPSactive is provided and enabled, the UE is not expected to receive another PDSCH for a given HARQ process until after the end of the expected transmission of HARQ-ACK for that HARQ process, where the timing is given by Clause 9.2.3 of [6, TS 38.213]. For HARQ-ACK subject to HARQ-ACK deferral described in Clause 9.2.5.4 of [6 TS 38.213], the expected transmission of HARQ-ACK corresponds to the expected transmission HARQ-ACK in a first slot. When HARQ feedback for the HARQ process ID is disabled, the UE is not expected to receive another PDCCH carrying a DCI scheduling a PDSCH or set of slot-aggregated PDSCH scheduled for the given HARQ process or to receive another PDSCH without corresponding PDCCH for the given HARQ process that starts until Tproc,1 after the end of the reception of the last PDSCH or slot-aggregated PDSCH for that HARQ process. Except for the case when a UE is configured by higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet and PDCCHs that schedule two PDSCHs are associated to different ControlResourceSets having different values of coresetPoolIndex, in a given scheduled cell, the UE is not expected to receive a first PDSCH and a second PDSCH, starting later than the first PDSCH, with its corresponding HARQ-ACK assigned to be transmitted on a resource ending before the start of a different resource for the HARQ-ACK assigned to be transmitted for the first PDSCH, where the two resources are in different slots for the associated HARQ-ACK transmissions, each slot is composed of symbols [4] or a number of symbols indicated by subslotLengthForPUCCH if provided, and the HARQ-ACK for the two PDSCHs are associated with the HARQ-ACK codebook of the same priority. Except for the case when a UE is configured by higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet and PDCCHs that schedule two PDSCHs are associated to different ControlResourceSets having different values of coresetPoolIndex, in a given scheduled cell, the UE is not expected to receive a first PDSCH, and a second PDSCH, starting later than the first PDSCH, with its corresponding HARQ-ACK assigned to be transmitted on a resource ending before the start of a different resource for the HARQ-ACK assigned to be transmitted for the first PDSCH if the HARQ-ACK for the two PDSCHs are associated with HARQ-ACK codebooks of different priorities. For any two HARQ process IDs in a given scheduled cell, if the UE is scheduled to start receiving a first PDSCH starting in symbol j by a PDCCH ending in symbol i on a scheduling cell, the UE is not expected to be scheduled to receive a PDSCH starting earlier than the end of the first PDSCH with a PDCCH that ends later than symbol i of a scheduling cell,. When the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], the PDCCH ending in symbol i is determined based on the PDCCH candidate that ends later in time. In a given scheduled cell, for any PDSCH corresponding to SI-RNTI, the UE is not expected to decode a re-transmission of an earlier PDSCH with a starting symbol less than N symbols after the last symbol of that PDSCH, where the value of N depends on the PDSCH subcarrier spacing configuration , with N=13 for =0, N=13 for =1, N=20 for =2, N=24 for =3, N=96 for m=5, and N=192 for m=6.\nWhen receiving PDSCH scheduled with SI-RNTI, P-RNTI, G-RNTI for broadcast, MCCH-RNTI, G-RNTI for multicast in RRC_INACTIVE state or multicast-MCCH-RNTI, the UE may assume that the DM-RS port of PDSCH is quasi co-located with the associated SS/PBCH block with respect to Doppler shift, Doppler spread, average delay, delay spread, spatial RX parameters when applicable.\nWhen receiving PDSCH scheduled with RA-RNTI, or MSGB-RNTI, the UE may assume that the DM-RS port of PDSCH is quasi co-located with the SS/PBCH block or the CSI-RS resource the UE used for RACH association as applicable, and transmission with respect to Doppler shift, Doppler spread, average delay, delay spread, spatial RX parameters when applicable. When receiving a PDSCH scheduled with RA-RNTI in response to a random access procedure triggered by a PDCCH order which triggers contention-free random access procedure for the SpCell [10, TS 38.321], the UE may assume that the DM-RS port of the received PDCCH order and the DM-RS ports of the corresponding PDSCH scheduled with RA-RNTI are quasi co-located with the same SS/PBCH block or CSI-RS with respect to Doppler shift, Doppler spread, average delay, delay spread, spatial RX parameters when applicable. If a UE is configured with SSB-MTC-AddtionalPCI and with PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet, and if the UE is configured with [twoTAGs] for the SpCell, if the UE attempts to detect the DCI format 1_0 with CRC scrambled by the corresponding RA-RNTI or when receiving a PDSCH scheduled with RA-RNTI in response to a random access procedure triggered by a PDCCH order which triggers contention-free random access procedure for the SpCell [10, TS 38.321], and if the CORESET used for the PDCCH order transmission is not associated with the serving cell physical cell ID, the UE may assume that the DM-RS ports of the received PDSCH are quasi co-located with the DM-RS antenna port associated with PDCCH receptions in the CORESET for Type1-PDCCH CSS set with respect to Doppler shift, Doppler spread, average delay, delay spread, and spatial RX parameters when applicable.\nWhen receiving PDSCH in response to a PUSCH transmission scheduled by a RAR UL grant or corresponding PUSCH retransmission, or when receiving PDSCH in response to a PUSCH for Type-2 random access procedure, or a PUSCH scheduled by a fallbackRAR UL grant or corresponding PUSCH retransmission, the UE may assume that the DM-RS port of PDSCH is quasi co-located with the SS/PBCH block the UE selected for RACH association and transmission with respect to Doppler shift, Doppler spread, average delay, delay spread, spatial RX parameters when applicable.\nIf the UE is not configured for PUSCH/PUCCH transmission for at least one serving cell configured with slot formats comprised of DL and UL symbols, and if the UE is not capable of simultaneous reception and transmission on serving cell c1 and serving cell c2, the UE is not expected to receive PDSCH on serving cell c1 if the PDSCH overlaps in time with SRS transmission (including any interruption due to uplink or downlink RF retuning time [10]) on serving cell c2 not configured for PUSCH/PUCCH transmission.\nThe UE is not expected to decode a PDSCH in a serving cell scheduled by a PDCCH with C-RNTI, CS-RNTI, MCS-C-RNTI, G-RNTI, G-CS-RNTI or MCCH-RNTI and one or multiple PDSCH(s) required to be received according to this Clause in the same serving cell without a corresponding PDCCH transmission if the PDSCHs partially or fully overlap in time except if the PDCCH scheduling the PDSCH ends at least 14 symbols before the earliest starting symbol of the PDSCH(s) without the corresponding PDCCH transmission, where m and the symbol duration are based on the smallest numerology between the scheduling PDCCH and the PDSCH, in which case the UE shall decode the PDSCH scheduled by the PDCCH. When the PDCCH reception incudes two PDCCH candidates from two respective search space sets, as described in clause 10 of [6, TS 38.213], for the purpose of determining the\u00a0PDCCH with C-RNTI, CS-RNTI or MCS-C-RNTI scheduling the PDSCH ends at least 14 symbols before the earliest starting symbol of the PDSCH(s) without the corresponding PDCCH transmission, the PDCCH candidate that ends later in time is used.\nThe UE is not expected to decode a PDSCH scheduled with C-RNTI, MCS-C-RNTI, G-RNTI for multicast or broadcast, MCCH-RNTI, multicast-MCCH-RNTI, G-CS-RNTI or CS-RNTI if another PDSCH in the same cell scheduled with RA-RNTI or MSGB-RNTI partially or fully overlap in time. \nFurthermore, a UE indicating supportOfRedCap-r18 capability but not indicating FG 48-2 is not expected to decode a PDSCH scheduled with C-RNTI, MCS-C-RNTI, G-RNTI for multicast or broadcast, MCCH-RNTI, multicast-MCCH-RNTI, G-CS-RNTI or CS-RNTI in the same or next slot if another PDSCH in the same cell is scheduled with RA-RNTI or MSGB-RNTI, when the PDSCH scheduled with RA-RNTI or MSGB-RNTI is allocated more than 25 PRBs when configured with SCS m = 0 or more than 12 PRBs when configured with SCS m = 1.\nThe UE in RRC_IDLE and RRC_INACTIVE modes shall be able to decode two PDSCHs each scheduled with SI-RNTI, P-RNTI, RA-RNTI or TC-RNTI, where the PDSCH scheduled with TC-RNTI for a reduced capability UE \nthat indicates supportOfRedCap-r18 is allocated no more than 25 PRBs when configured with SCS m = 0 or no more than 12 PRBs when configured with SCS m = 1, with the two PDSCHs partially or fully overlapping in time in non-overlapping PRBs.\nThe UE:\n-\tis expected to decode PDSCH scheduled with MCCH-RNTI or multicast-MCCH-RNTI, and PBCH in PCell that partially or fully overlaps in time in non-overlapping PRBs in PCell.\n-\tis not expected to decode PDSCH scheduled with G-RNTI for broadcast and PBCH in PCell that partially or fully overlaps in time in non-overlapping PRBs in PCell.\n-\tis not expected to decode PDSCH scheduled with G-RNTI for multicast and PBCH in PCell that partially or fully overlaps in time in non-overlapping PRBs in PCell.\nOn a frequency range 1 cell, the UE shall be able to decode a PDSCH scheduled with C-RNTI, MCS-C-RNTI, or CS-RNTI and, during a process of P-RNTI triggered SI acquisition, another PDSCH scheduled with SI-RNTI that partially or fully overlap in time in non-overlapping PRBs, unless the PDSCH scheduled with C-RNTI, MCS-C-RNTI, or CS-RNTI requires Capability 2 processing time according to clause 5.3 in which case the UE may skip decoding of the scheduled PDSCH with C-RNTI, MCS-C-RNTI, or CS-RNTI. \nOn a frequency range 2 cell, the UE is not expected to decode a PDSCH scheduled with C-RNTI, MCS-C-RNTI, or CS-RNTI if in the same cell, during a process of P-RNTI triggered SI acquisition, another PDSCH scheduled with SI-RNTI partially or fully overlap in time. \nA UE that indicates supportOfRedCap-r18 capability but does not indicate FG 48-2, during a process of P-RNTI triggered SI acquisition, when the total number of PRBs for the PDSCH scheduled with SI-RNTI and the PDSCH scheduled with C-RNTI, MCS-C-RNTI, or CS-RNTI scheduled in the slot is larger than 25 PRBs if configured with SCS \u00b5 = 0 or larger than 12 PRBs if configured with SCS \u00b5 = 1, the UE may skip decoding of the scheduled PDSCH with C-RNTI, MCS-C-RNTI, or CS-RNTI.\nThe UE is expected to decode a PDSCH scheduled with C-RNTI, MCS-C-RNTI, or CS-RNTI during a process of autonomous SI acquisition. \nThe maximum number of PDSCHs scheduled per slot per component carrier with C-RNTI/CS-RNTI and G-RNTI/G-CS-RNTI/MCCH-RNTI/multicast-MCCH-RNTI that the UE shall be able to decode is the same as the indicated UE capability for the number of unicast PDSCHs per slot per component carrier. If the UE is capable of receiving FDMed unicast and multicast PDSCH per slot per carrier, the UE shall be able to decode a PDSCH scheduled by a DCI format with C-RNTI or a PDSCH scheduled for a retransmission of a TB by a DCI format with CS-RNTI and a PDSCH scheduled by a DCI format with G-RNTI for multicast or a PDSCH scheduled for a retransmission of a TB by a DCI format with G-CS-RNTI that partially or fully overlap in time in non-overlapping PRBs. If the UE is capable of receiving FDMed unicast and broadcast PDSCH per slot per carrier, the UE shall be able to decode a PDSCH scheduled by a DCI format with C-RNTI or a PDSCH scheduled for a retransmission of a TB by a DCI format with CS-RNTI and a PDSCH scheduled with G-RNTI for broadcast/MCCH-RNTI that partially or fully overlap in time in non-overlapping PRBs. For a reduced capability UE that indicates supportOfRedCap-r18 but not indicating FG 48-2, if the UE is capable of receiving FDMed unicast and multicast/broadcast PDSCH per slot, the UE can decode the two PDSCHs, with the two PDSCHs partially or fully overlapping in time in non-overlapping PRBs,\n-\tif the total number of PRBs allocated is no more than 25 PRBs when configured with SCS m = 0 or no more than 12 PRBs when configured with SCS m = 1,\n-\totherwise, the UE may skip decoding one of the two PDSCHs.\nIf the UE is configured by higher layers to decode a PDCCH with its CRC scrambled by a CS-RNTI or G-CS-RNTI, the UE shall receive PDSCH transmissions without corresponding PDCCH transmissions using the higher-layer-provided PDSCH configuration for those PDSCHs.\nThe UE is not expected to support reception of:\n-\tFDMed broadcast MCCH PDSCH and broadcast MTCH PDSCH in PCell or SCell, or \n-\tFDMed multiple broadcast MTCH PDSCHs in PCell or SCell, or \n-\tFDMed broadcast MCCH/broadcast MTCH/multicast PDSCH and SIB PDSCH in PCell, or \n-\tFDMed multicast PDSCHs in PCell or SCell, or \n-\tFDMed multicast PDSCH and MCCH/broadcast MTCH PDSCH in PCell or SCell, or \n-\tFDMed broadcast MCCH/broadcast MTCH/multicast PDSCH and paging PDSCH.\nThe UE in RRC_INACTIVE state is not expected to support reception of: \n-\tFDMed multicast MCCH PDSCH and multicast MTCH PDSCH in Pcell, or \n-\tFDMed multiple multicast MTCH PDSCHs in Pcell, or \n-\tFDMed broadcast MCCH/broadcast MTCH/multicast MCCH/multicast MTCH and SIB PDSCH in Pcell, or \n-\tFDMed multicast MCCH/multicast MTCH and broadcast MCCH/broadcast MTCH in Pcell, or\n-\tFDMed multicast MCCH/multicast MTCH and paging PDSCH in Pcell.\nIf a UE is configured by higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet, the UE may expect to receive multiple PDCCHs scheduling fully/partially/non-overlapped PDSCHs in time and frequency domain. The UE may expect the reception of full/partially-overlapped PDSCHs in time, only when PDCCHs that schedule two PDSCHs are associated to different ControlResourceSets having different values of coresetPoolIndex. For a ControlResourceSet without coresetPoolIndex, the UE may assume that the ControlResourceSet is assigned with coresetPoolIndex as 0. When the UE is configured with SSB-MTC-AdditionalPCI, ControlResourceSets corresponding to different coresetPoolIndex values may be associated with different physical cell IDs via activated TCI states of the ControlResourceSets, where ControlResourceSets corresponding to one coresetPoolIndex is associated with the serving cell physical cell ID and ControlResourceSets corresponding to another coresetPoolIndex can be associated with another physical cell ID. When the UE is scheduled with full/partially/non-overlapped PDSCHs in time and frequency domain, the full scheduling information for receiving a PDSCH is indicated and carried only by the corresponding PDCCH, the UE is expected to be scheduled with the same active BWP and the same SCS. When the UE is scheduled with full/partially-overlapped PDSCHs in time and frequency domain, the UE can be scheduled with at most two codewords simultaneously. When PDCCHs that schedule two PDSCHs are associated to different ControlResourceSets having different values of coresetPoolIndex, the following operations are allowed: \n-\tFor any two HARQ process IDs in a given scheduled cell, if the UE is scheduled to start receiving a first PDSCH starting in symbol j by a PDCCH associated with a value of coresetPoolIndex ending in symbol i, the UE can be scheduled to receive a PDSCH starting earlier than the end of the first PDSCH with a PDCCH associated with a different value of coresetPoolIndex that ends later than symbol i. \n-\tIn a given scheduled cell, the UE can receive a first PDSCH in slot i, with the corresponding HARQ-ACK assigned to be transmitted in slot j, and a second PDSCH associated with a value of coresetPoolIndex different from that of the first PDSCH starting later than the first PDSCH with its corresponding HARQ-ACK assigned to be transmitted in a slot before slot j.\nIf PDCCHs that schedule corresponding PDSCHs are associated to the same or different ControlResourceSets having the same value of coresetPoolIndex, the UE procedure for receiving the PDSCH upon detection of a PDCCH follows Clause 5.1. \nA UE does not expect to be configured with repetitionScheme if the UE is configured with higher layer parameter repetitionNumber for the same PDSCH. \nWhen a UE is configured by higher layer parameter repetitionScheme set to one of 'fdmSchemeA', 'fdmSchemeB', 'tdmSchemeA', if the UE not configured with dl-OrJointTCI-StateList is indicated with two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication' or if the UE configured with dl-OrJointTCI-StateList is having two indicated TCI States to be applied to PDSCH and the UE is indicated with DM-RS port(s) within one CDM group in the DCI field 'Antenna Port(s)'.\n-\tWhen the UE is set to 'fdmSchemeA', the UE shall receive a single PDSCH transmission occasion of the TB with each TCI state associated to a non-overlapping frequency domain resource allocation as described in Clause 5.1.2.3. \n-\tWhen the UE is set to 'fdmSchemeB', the UE shall receive two PDSCH transmission occasions of the same TB with each TCI state associated to a PDSCH transmission occasion which has non-overlapping frequency domain resource allocation with respect to the other PDSCH transmission occasion as described in Clause 5.1.2.3. \n-\tWhen the UE is set to 'tdmSchemeA', the UE shall receive two PDSCH transmission occasions of the same TB with each TCI state associated to a PDSCH transmission occasion which has non-overlapping time domain resource allocation with respect to the other PDSCH transmission occasion and both PDSCH transmission occasions shall be received within a given slot as described in Clause 5.1.2.1. \nWhen a UE is configured by the higher layer parameter repetitionNumber in PDSCH-TimeDomainResourceAllocation, the UE not configured with dl-OrJointTCI-StateList may expect to be indicated with one or two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication' or when the UE configured with dl-OrJointTCI-StateList may expect to apply one or two indicated TCI states to the PDSCH, together with the DCI field 'Time domain resource assignment' indicating an entry which contains repetitionNumber in PDSCH-TimeDomainResourceAllocation and DM-RS port(s) within one CDM group in the DCI field 'Antenna Port(s)'. \n-\tWhen two TCI states are indicated in a DCI with 'Transmission Configuration Indication' field for the UE not configured with dl-OrJointTCI-StateList, or when the UE configured with dl-OrJointTCI-StateList is having two indicated TCI States to be applied to PDSCH, the UE may expect to receive multiple slot level PDSCH transmission occasions of the same TB with two TCI states used across multiple PDSCH transmission occasions in the repetitionNumber consecutive slots as defined in Clause 5.1.2.1. \n-\tWhen one TCI state is indicated in a DCI with 'Transmission Configuration Indication' field for the UE not configured with dl-OrJointTCI-StateList, or when the UE configured with dl-OrJointTCI-StateList is having one indicated TCI states to be applied to PDSCH, the UE may expect to receive multiple slot level PDSCH transmission occasions of the same TB with one TCI state used across multiple PDSCH transmission occasions in the repetitionNumber consecutive slots as defined in Clause 5.1.2.1. \nWhen a UE is not indicated with a DCI that DCI field 'Time domain resource assignment' indicating an entry which contains repetitionNumber in PDSCH-TimeDomainResourceAllocation, and it is indicated with two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication' for the UE not configured with dl-OrJointTCI-StateList, or when the UE configured with dl-OrJointTCI-StateList is having two indicated TCI States to be applied to PDSCH, and is indicated with DM-RS port(s) within two CDM groups in the DCI field 'Antenna Port(s)' and it is not configured with higher layer parameter sfnSchemePDSCH, the UE may expect to receive a single PDSCH where the association between the DM-RS ports and the TCI states are as defined in Clause 5.1.6.2. \nWhen a UE is not indicated with a DCI that DCI field 'Time domain resource assignment' indicating an entry which contains repetitionNumber in PDSCH-TimeDomainResourceAllocation, and it is not configured with dl-OrJointTCI-StateList and is indicated with one TCI states in a codepoint of the DCI field 'Transmission Configuration Indication', or it is configured with dl-OrJointTCI-StateList and is expected to apply one indicated TCI states to PDSCH, the UE procedure for receiving the PDSCH upon detection of a PDCCH follows Clause 5.1. \nWhen a UE is configured with higher layer parameter sfnSchemePDSCH set to either 'sfnSchemeA' or 'sfnSchemeB' and \n-\tif the UE reports its capability of sfn-SchemeA-DynamicSwitching or sfn-SchemeB-DynamicSwitching, the UE not configured with dl-OrJointTCI-StateList is indicated with one or two TCI state(s) in a codepoint of the DCI field 'Transmission Configuration Indication' in DCI format 1_1/1_2, or the UE configured with dl-OrJointTCI-StateList is having one or two indicated TCI States to be applied to PDSCH\n-\totherwise, the UE not configured with dl-OrJointTCI-StateList is not expected to be indicated with one TCI state per any of TCI codepoint by MAC CE, and the UE is indicated with two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication' in DCI format 1_1/1_2, or the UE configured with dl-OrJointTCI-StateList is having two indicated TCI States to be applied to PDSCH\nthe UE procedure for receiving the PDSCH upon detection of a PDCCH follows clause 5.1 and the QCL assumption for the PDSCH as defined in clause 5.1.5.\nWhen a UE is configured with both sfnSchemePDSCH and sfnSchemePDCCH, the UE shall expect that sfnSchemePDSCH and sfnSchemePDCCH are set to the same scheme, either 'sfnSchemeA' or 'sfnSchemeB'.\nIf a UE not configured with dl-OrJointTCI-StateList is configured with sfnSchemePDCCH set to 'sfnSchemeA' and activated with two TCI states by MAC CE, and the UE does not report its capability of sfn-SchemeA-PDCCH-only, the UE is expected to be configured with sfnSchemePDSCH set to 'sfnSchemeA' and indicated with two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication', if the PDSCH is scheduled by DCI format 1_1/1_2.\nIf a UE configured with dl-OrJointTCI-StateList and having two indicated TCI-States is configured with sfnSchemePdcch set to 'sfnSchemeA' for a DL BWP and signaled by the higher layer parameter [applyIndicatedTCIState] to apply both indicated TCI-States to a PDCCH on a CORESET, and the UE does not report its capability of sfn-SchemeA-PDCCH-only, the UE is expected to be configured with sfnSchemePdsch set to 'sfnSchemeA' and both indicated TCI-States are applicable to PDSCH, if the PDSCH is scheduled by DCI format 1_1/1_2 on the PDCCH.\nIf a UE not configured with dl-OrJointTCI-StateList is configured with sfnSchemePDCCH set to 'sfnSchemeB' and activated with two TCI states by MAC CE, the UE is expected to be configured with sfnSchemePDSCH set to 'sfnSchemeB' and indicated with two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication', if the PDSCH is scheduled by DCI format 1_1/1_2.\nIf a UE configured with dl-OrJointTCI-StateList and having two indicated TCI-States is configured with sfnSchemePdcch set to 'sfnSchemeB' for a DL BWP, and signaled by the higher layer parameter [applyIndicatedTCIState] to apply both indicated TCI-States to a PDCCH on a CORESET, the UE is expected to be configured with sfnSchemePdsch set to 'sfnSchemeB' and both indicated TCI-States are applicable to PDSCH, if the PDSCH is scheduled by DCI format 1_1/1_2 on the PDCCH.\nWhen a UE is configured with sfnSchemePDSCH and/or sfnSchemePDCCH, the UE shall expect that the sfnSchemePDSCH and/or sfnSchemePDCCH configuration are the same within a CC, and the UE shall expect that the sfnSchemePDSCH and/or sfnSchemePDCCH configuration are the same in all CCs in a same frequency band if the UE is configured with CA, where the UE does not expect to be configured with sfnSchemePDSCH and/or sfnSchemePDCCH in initial BWP in each CC. \nIf more than one PDSCH on a serving cell each without a corresponding PDCCH transmission are in a slot, after resolving overlapping with symbols in the slot indicated as uplink by tdd-UL-DL-ConfigurationCommon, or by tdd-UL-DL-ConfigurationDedicated, or determined as non-active periods of cell DTX, if the serving cell is activated with cell DTX, based on [10, TS 38.321], a UE receives one or more PDSCHs without corresponding PDCCH transmissions in the slot as specified below.\n\u2012\tStep 0: set j=0, where j is the number of selected PDSCH(s) for decoding. Q is the set of activated PDSCHs without corresponding PDCCH transmissions within the slot\n\u2012\tStep 1: A UE receives one PDSCH with the lowest configured sps-ConfigIndex within Q, set j=j+1. Designate the received PDSCH as survivor PDSCH.\n\u2012\tStep 2: The survivor PDSCH in step 1 and any other PDSCH(s) overlapping (even partially) with the survivor PDSCH in step 1 are excluded from Q. \n\u2012\tStep 3: Repeat step 1 and 2 until Q is empty or j is equal to the number of unicast/multicast PDSCHs in a slot supported by the UE.\nFor a cell detected in cell search procedure with synchronization raster defined in Table 5.4.3.1-2 or Table 5.4.3.1-3 of [8, TS 38.101-1], the size of CORESET 0 for the cell in this clause refers to the size of punctured CORESET 0 as defined in clause 7.3.2.2 of [4, TS 38.211] if any. \n5.1.1\tTransmission schemes\nOnly one transmission scheme is defined for the PDSCH, and is used for all PDSCH transmissions.\n5.1.1.1\tTransmission scheme 1\nFor transmission scheme 1 of the PDSCH, the UE may assume that a gNB transmission on the PDSCH would be performed with up to 8 transmission layers on antenna ports 1000-1023 as defined in Clause 7.3.1.4 of [4, TS 38.211], subject to the DM-RS reception procedures in Clause 5.1.6.2. \n5.1.2\tResource allocation\n5.1.2.1\tResource allocation in time domain\nWhen the UE is scheduled to receive PDSCH by a DCI, the Time domain resource assignment field value m for the scheduled PDSCH on the serving cell provides a row index m + 1 to a resource allocation table. The determination of the used resource allocation table is defined in Clause 5.1.2.1.1. The indexed row defines the slot offset K0, the start and length indicator SLIV, or directly the start symbol S and the allocation length L, and the PDSCH mapping type to be assumed in the PDSCH reception.\nGiven the parameter values of the indexed row:\n-\tThe slot allocated for the PDSCH is Ks, where , if UE is configured with ca-SlotOffset for at least one of the scheduled and scheduling cell, and Ks = , otherwise, and where n is the slot with the scheduling DCI, and K0 is based on the numerology of PDSCH, and  and are the subcarrier spacing configurations for PDSCH and PDCCH, respectively, and\n-\t and  are the  and the, respectively, which are determined by higher-layer configured ca-SlotOffset, for the cell receiving the PDCCH respectively, and  are the  and the, respectively, which are determined by higher-layer configured ca-SlotOffset for the cell receiving the PDSCH, as defined in clause 4.5 of [4, TS 38.211].\n-\tThe reference point S0 for starting symbol S is defined as: \n-\tif configured with referenceOfSLIVDCI-1-2, and when receiving PDSCH scheduled by DCI format 1_2 with CRC scrambled by C-RNTI, MCS-C-RNTI, CS-RNTI with K0=0, and PDSCH mapping Type B, the starting symbol S is relative to the starting symbol S0 of the PDCCH monitoring occasion where DCI format 1_2 is detected; when the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], the PDCCH candidate that starts later in time is used for the purpose of determining the starting symbol S0;\n-\totherwise, the starting symbol S is relative to the start of the slot using S0=0.\n-\tThe number of consecutive symbols L counting from the starting symbol S allocated for the PDSCH are determined from the start and length indicator SLIV:\nif  then\n\nelse \n\nwhere, and\n-\tthe PDSCH mapping type is set to Type A or Type B as defined in Clause 7.4.1.1.2 of [4, TS 38.211].\nThe UE shall consider the S and L combinations defined in table 5.1.2.1-1 satisfying  for normal cyclic prefix and  for extended cyclic prefix as valid PDSCH allocations:\nTable 5.1.2.1-1: Valid S and L combinations\n\nWhen configured with SCS m = 5 or m = 6, the UE does not expect to be scheduled with more than one unicast PDSCH in a slot, by a single DCI scheduling multiple PDSCHs or by multiple DCIs, where multiple DCIs are not associated with CORESETs having different coresetpoolIndex.\nWhen receiving PDSCH scheduled by DCI format 1_1, 1_2 or 1_3 in PDCCH with CRC scrambled by C-RNTI, MCS-C-RNTI, or scheduled by DCI format 1_1 or 1_2 in PDCCH with CRC scrambled by CS-RNTI with NDI=1, if the UE is configured with pdsch-AggregationFactor in pdsch-config, the same symbol allocation is applied across the pdsch-AggregationFactor consecutive slots. When receiving PDSCH scheduled by DCI format 1_1 or 1_2 in PDCCH with CRC scrambled by CS-RNTI with NDI=0, or PDSCH scheduled without corresponding PDCCH transmission using sps-Config and activated by DCI format 1_1 or 1_2, the same symbol allocation is applied across the pdsch-AggregationFactor, in sps-Config if configured, or across the pdsch-AggregationFactor in pdsch-config otherwise, consecutive slots. The UE may expect that the TB is repeated within each symbol allocation among each of the pdsch-AggregationFactor consecutive slots and the PDSCH is limited to a single transmission layer. For PDSCH scheduled by DCI format 1_1 or 1_2 in PDCCH with CRC scrambled by CS-RNTI with NDI=0, or PDSCH scheduled without corresponding PDCCH transmission using sps-Config and activated by DCI format 1_1 or 1_2, the UE is not expected to be configured with the time duration for the reception of pdsch-AggregationFactor repetitions, in sps-Config if configured, or across the pdsch-AggregationFactor in pdsch-config otherwise, larger than the time duration derived by the periodicity P obtained from the corresponding sps-Config. The redundancy version to be applied on the nth transmission occasion of the TB, where n = 0, 1, \u2026pdsch-AggregationFactor -1, is determined according to table 5.1.2.1-2 and \"rvid indicated by the DCI scheduling the PDSCH\" in table 5.1.2.1-2 is assumed to be 0 for PDSCH scheduled without corresponding PDCCH transmission using sps-Config and activated by DCI format 1_1 or 1_2. \nWhen receiving PDSCH scheduled by DCI format 4_1, or 4_2 in PDCCH with CRC scrambled by G-RNTI for multicast, if the UE is configured with pdsch-AggregationFactor in the MBS-RNTI-SpecificConfig associated with the corresponding G-RNTI for multicast, the same symbol allocation is applied across the pdsch-AggregationFactor consecutive slots. When receiving PDSCH scheduled by DCI format 4_1 or 4_2 for multicast reception in PDCCH with CRC scrambled by G-CS-RNTI, or PDSCH without corresponding PDCCH transmission using associated SPS-Config and activated by the DCI format 4_1 or 4_2 in PDCCH with CRC scrambled by G-CS-RNTI, the same symbol allocation is applied across the pdsch-AggregationFactor in associated SPS-Config if configured, or across repetitionNumber in PDSCH-TimeDomainResourceAllocation in pdsch-ConfigMulticast if provided by an entry indicated by the 'Time domain resource assignment' field of the activating DCI, or 1 otherwise, consecutive slots. The redundancy version to be applied on the nth transmission occasion of the TB, where n = 0, 1, \u2026pdsch-AggregationFactor -1, is determined according to table 5.1.2.1-2 and \"rvid indicated by the DCI scheduling the PDSCH\" in table 5.1.2.1-2 is assumed to be 0 for PDSCH scheduled without corresponding PDCCH transmission using SPS-Config and activated by DCI format 4_1 or 4_2. When receiving PDSCH scheduled by DCI format 4_1 in PDCCH with CRC scrambled by G-RNTI for multicast in RRC_INACTIVE state, if the UE is configured with pdsch-AggregationFactor in the PDSCH-ConfigPTM-r18 for multicast in RRC_INACTIVE state, the same symbol allocation is applied across the pdsch-AggregationFactor consecutive slots, and the redundancy version to be applied on the nth transmission occasion of the TB, where n = 0, 1, \u2026pdsch-AggregationFactor -1, is determined according to table 5.1.2.1-2. When receiving PDSCH scheduled by DCI format 4_0 in PDCCH with CRC scrambled by G-RNTI for broadcast, if the UE is configured with pdsch-AggregationFactor in the PDSCH-ConfigPTM, the same symbol allocation is applied across the pdsch-AggregationFactor consecutive slots, and the redundancy version to be applied on the nth transmission occasion of the TB, where n = 0, 1, \u2026pdsch-AggregationFactor -1, is determined according to table 5.1.2.1-2.\nWhen receiving PDSCH scheduled by DCI in PDCCH with CRC scrambled by G-CS-RNTI for multicast reception or G-RNTI, if the DCI field 'Time domain resource assignment' indicates an entry which contains repetitionNumber in PDSCH-TimeDomainResourceAllocation in the pdsch-ConfigMulticast, or pdsch-Config-MTCH, or PDSCH-Config-Broadcast, the same SLIV is applied for all PDSCH transmission occasions across the repetitionNumber consecutive slots. When receiving PDSCH scheduled without corresponding PDCCH transmission using associated SPS-Config and activated by DCI in PDCCH with CRC scrambled by G-CS-RNTI for multicast reception, if the DCI field 'Time domain resource assignment' of the activating DCI indicates an entry which contains repetitionNumber in PDSCH-TimeDomainResourceAllocation in the pdsch-ConfigMulticast, the same SLIV is applied for all PDSCH transmission occasions across the repetitionNumber consecutive slots. The redundancy version to be applied on the nth transmission occasion of the TB, where n = 0, 1, \u2026repetitionNumber -1, is determined according to table 5.1.2.1-2 and \"rvid indicated by the DCI scheduling the PDSCH\" in table 5.1.2.1-2 is assumed to be 0 for PDSCH scheduled without corresponding PDCCH transmission using sps-Config and activated by DCI format with CRC scrambled by G-CS-RNTI.\nIf a UE is configured with higher layer parameter repetitionNumber or if the UE is configured by repetitionScheme set to one of ' fdmSchemeA', ' fdmSchemeB' and 'tdmSchemeA', the UE does not expect to be configured with pdsch-AggregationFactor for the same PDSCH.\nIf a UE is configured with pdsch-TimeDomainAllocationListForMultiPDSCH in which one or more rows contain multiple SLIVs for PDSCH, the UE does not expect to be configured with higher layer parameter repetitionNumber in pdsch-TimeDomainAllocationListForMultiPDSCH.\nIf a UE is configured with pdsch-TimeDomainAllocationListForMultiPDSCH in which one or more rows contain multiple SLIVs for PDSCH on a DL BWP of a serving cell, the UE does not apply pdsch-AggregationFactor in PDSCH-config, if configured, to DCI format 1_1 on the DL BWP of the serving cell.\nIf a UE is configured with pdsch-TimeDomainAllocationListForMultiPDSCH in which one or more rows contain multiple SLIVs for PDSCH on a DL BWP of a serving cell, when any two DL DCIs end in the same symbol and at least one of the DCIs schedules multiple PDSCHs, the UE does not expect that the scheduled PDSCH(s) by the two DCIs  have overlapping spans, where the span associated with a DCI is defined from the beginning of the first scheduled PDSCH or up to the end of the last scheduled PDSCH.\nIf a UE is configured with pdsch-TimeDomainAllocationListForMultiPDSCH in which one or more rows contain multiple SLIVs for PDSCH on a DL BWP of a serving cell within a PUCCH group, the UE does not expect to be configured with higher layer parameter ScheduledCell-ListDCI-1-3 on any serving cell within the PUCCH group.\nTable 5.1.2.1-2: Applied redundancy version when pdsch-AggregationFactor or repetitionNumber is present\n\nA PDSCH reception in a slot of a multi-slot PDSCH reception is omitted according to the conditions in clause 11.1 and clause 17.2 of [6, TS38.213].\nThe UE is not expected to receive a PDSCH with mapping type A in a slot, if the PDCCH scheduling the PDSCH was received in the same slot and was not contained within the first three symbols of the slot. When the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], if the two PDCCH candidates scheduling the PDSCH with mapping Type A were received in the same slot as the PDSCH, both PDCCH candidates are expected to be contained within the first three symbols of the slot.\nThe UE is not expected to receive a PDSCH with mapping type B in a slot, if the first symbol of the PDCCH scheduling the PDSCH was received in a later symbol than the first symbol indicated in the PDSCH time domain resource allocation. When the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], the UE is not expected to receive a PDSCH with mapping type B in a slot, if the first symbol of the PDCCH candidate that starts later in time scheduling the PDSCH was received in a later symbol than the first symbol indicated in the PDSCH time domain resource allocation.\nWhen the UE is configured with minimumSchedulingOffsetK0 in an active DL BWP it applies a minimum scheduling offset restriction indicated by the 'Minimum applicable scheduling offset indicator' field in DCI format 0_1, 0_3, 1_1 or 1_3, if the same field is available. When the UE is configured with minimumSchedulingOffsetK0 in an active DL BWP and it has not received 'Minimum applicable scheduling offset indicator' field in DCI format 0_1, 0_3, 1_1 or 1_3, the UE shall apply a minimum scheduling offset restriction indicated based on 'Minimum applicable scheduling offset indicator' value '0'. When the minimum scheduling offset restriction is applied the UE is not expected to be scheduled with a DCI in slot n to receive a PDSCH scheduled with C-RNTI, CS-RNTI or MCS-C-RNTI with K0 smaller than , where K0min and  are the applied minimum scheduling offset restriction and the numerology of the active DL BWP of the scheduled cell when receiving the DCI in slot n, respectively, and  is the numerology of the new active DL BWP in case of active DL BWP change in the scheduled cell and is equal to , otherwise. The minimum scheduling offset restriction is not applied when PDSCH transmission is scheduled with C-RNTI, CS-RNTI or MCS-C-RNTI in common search space associated with CORESET0 and default PDSCH time domain resource allocation is used, in the search space set provided by recoverySearchSpaceId when monitoring PDCCH as described in [6, TS 38.213] or when PDSCH transmission is scheduled with SI-RNTI, MSGB-RNTI or RA-RNTI. The application delay of the change of the minimum scheduling offset restriction is determined in Clause 5.3.1.\nThe UE is not expected to be configured with referenceOfSLIVDCI-1-2 for serving cells configured for cross-carrier scheduling with a scheduling cell of a different downlink SCS configuration.\nWhen a UE is configured by the higher layer parameter repetitionScheme set to 'tdmSchemeA' and indicated DM-RS port(s) within one CDM group in the DCI field 'Antenna Port(s)', the number of PDSCH transmission occasions is derived by the number of TCI states indicated by the DCI field 'Transmission Configuration Indication' of the scheduling DCI for the UE not configured with dl-OrJointTCI-StateList, or by the number of indicated TCI states when the UE configured with dl-OrJointTCI-StateList. \n-\tIf two TCI states are indicated by the DCI field 'Transmission Configuration Indication' for a UE not configured with dl-OrJointTCI-StateList, or both indicated TCI states applicable to PDSCH for a UE configured with dl-OrJointTCI-StateList, the UE is expected to receive two PDSCH transmission occasions, where the first TCI state is applied to the first PDSCH transmission occasion and resource allocation in time domain for the first PDSCH transmission occasion follows Clause 5.1.2.1. The second TCI state is applied to the second PDSCH transmission occasion, and the second PDSCH transmission occasion shall have the same number of symbols as the first PDSCH transmission occasion. If the UE is configured by the higher layers with a value in StartingSymbolOffsetK, it shall determine that the first symbol of the second PDSCH transmission occasion starts after  symbols from the last symbol of the first PDSCH transmission occasion. If the value is not configured via the higher layer parameter StartingSymbolOffsetK,   = 0 shall be assumed by the UE. The UE is not expected to receive more than two PDSCH transmission layers for each PDSCH transmission occasion. For two PDSCH transmission occasions, the redundancy version to be applied is derived according to Table 5.1.2.1-2, where  applied respectively to the first and second TCI state. The UE expects the PDSCH mapping type indicated by DCI field 'Time domain resource assignment' to be mapping type B, and the indicated PDSCH mapping type is applied to both PDSCH transmission occasions.\n-\tOtherwise, the UE is expected to receive a single PDSCH transmission occasion, and the resource allocation in the time domain follows Clause 5.1.2.1. \nWhen a UE configured by the higher layer parameter PDSCH-config that indicates at least one entry contains repetitionNumber in PDSCH-TimeDomainResourceAllocation, \n-\tIf two TCI states are indicated by the DCI field 'Transmission Configuration Indication' for a UE not configured with dl-OrJointTCI-StateList, or both indicated TCI states applicable to PDSCH for a UE configured with dl-OrJointTCI-StateList, together with the DCI field 'Time domain resource assignment' indicating an entry which contains repetitionNumber in PDSCH-TimeDomainResourceAllocation and DM-RS port(s) within one CDM group in the DCI field 'Antenna Port(s)', the same SLIV is applied for all PDSCH transmission occasions across the repetitionNumber consecutive slots, the first TCI state is applied to the first PDSCH transmission occasion and resource allocation in time domain for the first PDSCH transmission occasion follows Clause 5.1.2.1. \n\tWhen the value indicated by repetitionNumber in PDSCH-TimeDomainResourceAllocation equals to two, the second TCI state is applied to the second PDSCH transmission occasion. When the value indicated by repetitionNumber in PDSCH-TimeDomainResourceAllocation is larger than two, the UE may be further configured to enable cyclicMapping or sequenticalMapping in tciMapping. \n-\tWhen cyclicMapping is enabled, the first and second TCI states are applied to the first and second PDSCH transmission occasions, respectively, and the same TCI mapping pattern continues to the remaining PDSCH transmission occasions. \n-\tWhen sequenticalMapping is enabled, first TCI state is applied to the first and second PDSCH transmission occasions, and the second TCI state is applied to the third and fourth PDSCH transmission occasions, and the same TCI mapping pattern continues to the remaining PDSCH transmission occasions. \nThe UE may expect that each PDSCH transmission occasion is limited to two transmission layers. For all PDSCH transmission occasions associated with the first TCI state, the redundancy version to be applied is derived according to Table 5.1.2.1-2, where  is counted only considering PDSCH transmission occasions associated with the first TCI state. The redundancy version for PDSCH transmission occasions associated with the second TCI state is derived according to Table 5.1.2.1-3, where additional shifting operation for each redundancy version is configured by higher layer parameter sequenceOffsetforRV and  is counted only considering PDSCH transmission occasions associated with the second TCI state. \nTable 5.1.2.1-3: Applied redundancy version for the second TCI state when sequenceOffsetforRV is present\n\n-\tIf one TCI state is indicated by the DCI field 'Transmission Configuration Indication' for a UE not configured with dl-OrJointTCI-StateList, or one indicated TCI states applicable to PDSCH for a UE configured with dl-OrJointTCI-StateList, together with the DCI field 'Time domain resource assignment' indicating an entry which contains repetitionNumber in PDSCH-TimeDomainResourceAllocation and DM-RS port(s) within one CDM group in the DCI field 'Antenna Port(s)', the same SLIV is applied for all PDSCH transmission occasions across the repetitionNumber consecutive slots, the first PDSCH transmission occasion follows Clause 5.1.2.1, the same TCI state is applied to all PDSCH transmission occasions. The UE may expect that each PDSCH transmission occasion is limited to two transmission layers. For all PDSCH transmission occasions, the redundancy version to be applied is derived according to Table 5.1.2.1-2, where  is counted considering PDSCH transmission occasions. \n-\tOtherwise, the UE is expected to receive a single PDSCH transmission occasion, and the resource allocation in the time domain follows Clause 5.1.2.1. \nFor pdsch-TimeDomainAllocationListForMultiPDSCH in pdsch-Config each PDSCH has a separate SLIV, mapping type and K0. The number of scheduled PDSCHs is signalled by the number of indicated SLIVs in the row of the pdsch-TimeDomainAllocationListForMultiPDSCH signalled in DCI format 1_1.\nIf a UE is configured with pdsch-TimeDomainAllocationListForMultiPDSCH in which one or more rows contain multiple SLIVs for PDSCH on a DL BWP of a serving cell, and the UE is indicated re-transmission of PDSCH corresponding to a DL SPS by DCI format 1_1, the UE does not expect that the number of indicated SLIVs in the row of the pdsch-TimeDomainAllocationListForMultiPDSCH by the DCI is more than one.\nIf a UE is configured with pdsch-TimeDomainAllocationListForMultiPDSCH in which one or more rows contain multiple SLIVs for PDSCH on a DL BWP of a serving cell, the UE does not expect to be scheduled with one or multiple PDSCH receptions by a single DCI format 1_1, where each PDSCH reception overlaps with a UL symbol indicated by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated if provided.\n5.1.2.1.1\tDetermination of the resource allocation table to be used for PDSCH\nTable 5.1.2.1.1-1 and Table 5.1.2.1.1-1A define which PDSCH time domain resource allocation configuration to apply. Either a default PDSCH time domain allocation A, B or C according to tables 5.1.2.1.1-2, 5.1.2.1.1-3, 5.1.2.1.1-4 and 5.1.2.1.1-5 is applied, or the higher layer configured pdsch-TimeDomainAllocationList or pdsch-TimeDomainAllocationListForMultiPDSCH or pdsch-TimeDomainAllocationListDCI-1-2 is applied. For operation with shared spectrum channel access in frequency range 1, as described in [16, TS 37.213], UE reinterprets S and L in row 9 of Table 5.1.2.1.1-2 as S=6 and L=7.\nTable 5.1.2.1.1-1: Applicable PDSCH time domain resource allocation for DCI formats 1_0, 1_1, 1_3, 4_0, 4_1 and 4_2\n\nTable 5.1.2.1.1-1A: Applicable PDSCH time domain resource allocation for DCI format 1_2\n\nTable 5.1.2.1.1-2: Default PDSCH time domain resource allocation A for normal CP \n\nTable 5.1.2.1.1-3: Default PDSCH time domain resource allocation A for extended CP \n\nTable 5.1.2.1.1-4: Default PDSCH time domain resource allocation B\n\nTable 5.1.2.1.1-5: Default PDSCH time domain resource allocation C \n\n5.1.2.2\tResource allocation in frequency domain\nTwo downlink resource allocation schemes, type 0 and type 1, are supported. The UE shall assume that when the scheduling grant is received with DCI format 1_0, 4_0 or 4_1 then downlink resource allocation type 1 is used.\nIf the scheduling DCI is configured to indicate the downlink resource allocation type as part of the 'Frequency domain resource assignment' field by setting a higher layer parameter resourceAllocation in PDSCH-Config to 'dynamicSwitch', for DCI format 1_1 or setting a higher layer parameter resourceAllocationDCI-1-2 in PDSCH-Config to 'dynamicSwitch' for DCI format 1_2 or setting a higher layer parameter resourceAllocationDCI-1-3 in PDSCH-ConfigDCI-1-3 to 'dynamicSwitch' for DCI format 1_3 or setting a higher layer parameter resourceAllocation in pdsch-ConfigMulticast to 'dynamicSwitch' for DCI format 4_2, the UE shall use downlink resource allocation type 0 or type 1 as defined by this DCI field. Otherwise the UE shall use the downlink frequency resource allocation type as defined by the higher layer parameter resourceAllocation in PDSCH-Config for DCI format 1_1 or by the higher layer parameter resourceAllocationDCI-1-2 for DCI format 1_2 or by the higher layer parameter resourceAllocationDCI-1-3 for DCI format 1_3 or by the higher layer parameter resourceAllocation in pdsch-ConfigMulticast for DCI format 4_2.\nIf a bandwidth part indicator field is not configured in the scheduling DCI or the UE does not support active BWP change via DCI, the RB indexing for downlink type 0 and type 1 resource allocation is determined within the UE's active bandwidth part. If a bandwidth part indicator field is configured in the scheduling DCI and the UE supports active BWP change via DCI, the RB indexing for downlink type 0 and type 1 resource allocation is determined within the UE's bandwidth part indicated by bandwidth part indicator field value in the DCI. The UE shall upon detection of PDCCH intended for the UE determine first the downlink bandwidth part and then the resource allocation within the bandwidth part.\nFor a PDSCH scheduled with a DCI format 1_0 in any type of PDCCH common search space, regardless of which bandwidth part is the active bandwidth part, RB numbering starts from the lowest RB of the CORESET in which the DCI was received; otherwise RB numbering starts from the lowest RB in the determined downlink bandwidth part. When the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the purpose of determining the downlink RB set of a PDSCH when scheduled by DCI format 1_0, the CORESET with lower ID among two CORESETs associated with two PDCCH candidates is used.\n5.1.2.2.1\tDownlink resource allocation type 0\nIn downlink resource allocation of type 0, the resource block assignment information includes a bitmap indicating the Resource Block Groups (RBGs) that are allocated to the scheduled UE where a RBG is a set of consecutive virtual resource blocks defined by higher layer parameter rbg-Size configured by PDSCH-Config for DCI format 1_1 or 1_2 or by higher layer parameter rbg-SizeDCI-1-3 configured by PDSCH-ConfigDCI-1-3 for DCI format 1_3 and the size of the bandwidth part as defined in Table 5.1.2.2.1-1.\nTable 5.1.2.2.1-1: Nominal RBG size P\n\nThe total number of RBGs () for a downlink bandwidth part i of size  PRBs is given by , where\n-\tthe size of the first RBG is ,\n-\tthe size of last RBG is  if  and P otherwise,\n-\tthe size of all other RBGs is P.\nIn downlink resource allocation of type 0 scheduled using a DCI with CRC scrambled by G-RNTI for multicast or G-CS-RNTI, the resource block assignment information bitmap is calculated based on the description above with the following changes: the parameter  is the starting PRB of the CFR,  is the size of the common frequency resource (CFR) and the value of the higher layer parameter rbg-Size is configured by pdsch-ConfigMulticast.\nThe bitmap is of size bits with one bitmap bit per RBG such that each RBG is addressable. The RBGs shall be indexed in the order of increasing frequency and starting at the lowest frequency of the bandwidth part. The order of RBG bitmap is such that RBG 0 to RBG are mapped from MSB to LSB. The RBG is allocated to the UE if the corresponding bit value in the bitmap is 1, the RBG is not allocated to the UE otherwise.\n5.1.2.2.2\tDownlink resource allocation type 1\nIn downlink resource allocation of type 1, the resource block assignment information indicates to a scheduled UE a set of contiguously allocated non-interleaved or interleaved virtual resource blocks within the active bandwidth part of size  PRBs except for the case when DCI format 1_0 is decoded in any common search space in which case the size of CORESET 0 shall be used if CORESET 0 is configured for the cell and the size of initial DL bandwidth part shall be used if CORESET 0 is not configured for the cell.\nA downlink type 1 resource allocation field consists of a resource indication value (RIV) corresponding to a starting virtual resource block () and a length in terms of contiguously allocated resource blocks. The resource indication value is defined by\nif  then\n\nelse \n\nwhere 1 and shall not exceed . \nWhen the DCI size for DCI format 1_0 in USS is derived from the size of DCI format 1_0 in CSS but applied to an active BWP with size of , a downlink type 1 resource block assignment field consists of a resource indication value (RIV) corresponding to a starting resource block and a length in terms of virtually contiguously allocated resource blocks , where  is given by \n-\tthe size of CORESET 0 if CORESET 0 is configured for the cell;\n-\tthe size of initial DL bandwidth part if CORESET 0 is not configured for the cell. \nThe resource indication value is defined by:\nif  then\n\nelse \n\nwhere, and where shall not exceed .\nIf , K is the maximum value from set {1, 2, 4, 8} which satisfies ; otherwise K = 1. \nWhen the scheduling grant is received with DCI format 1_2 or 1_3, a downlink type 1 resource allocation field consists of a resource indication value (RIV) corresponding to a starting resource block group RBGstart=0, 1, \u2026, NRBG-1 and a length in terms of virtually contiguously allocated resource block groups LRBGs=1, \u2026, NRBG, where the resource block groups are defined as in 5.1.2.2.1 with P defined by resourceAllocationType1GranularityDCI-1-2 for DCI format 1_2 and resourceAllocationType1GranularityDCI-1-3 for DCI format 1_3 if the UE is configured with higher layer parameter resourceAllocationType1GranularityDCI-1-2 or resourceAllocationType1GranularityDCI-1-3, and P=1 otherwise. The resource indication value is defined by\nif  then\n\nelse \n\nwhere 1 and shall not exceed .\n5.1.2.2.3\tDownlink resource allocation type 1 for multicast/broadcast\nIn downlink resource allocation of type 1 scheduled using DCI format 4_0 or DCI format 4_1 with CRC scrambled by G-RNTI, G-CS-RNTI, MCCH-RNTI or multicast-MCCH-RNTI, the resource block assignment information indicates to a scheduled UE a set of contiguously allocated non-interleaved or interleaved virtual resource blocks. \nA downlink type 1 resource block assignment field in the DCI format 4_0 or DCI format 4_1 consists of a RIV corresponding to a starting resource block in reference to the lowest RB of the CFR and a length in terms of virtually contiguously allocated resource blocks LRBs, where  is given by \n-\tthe size of CORESET 0 if CORESET 0 is configured for the cell;\n-\tthe size of initial DL bandwidth part if CORESET 0 is not configured for the cell. \nThe resource indication value is defined by:\nif  then\n\nelse \n\nwhere, and where shall not exceed .\nIf , K is the maximum value from set {1, 2, 4, 6, 8, 10, 12} which satisfies ; otherwise K = 1. \nIn downlink resource allocation of type 1 scheduled using DCI format 4_2 with CRC scrambled by G-RNTI for multicast or G-CS-RNTI, the description in clause 5.1.2.2.2 with the following changes:  corresponds to a starting resource block in reference to the lowest RB of the CFR and  is the size of the CFR.\n5.1.2.3\tPhysical resource block (PRB) bundling\nThe PRB bundling procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 1_2, by applying the parameters of prb-BundlingTypeDCI-1-2 instead of prb-BundlingType as well as vrb-ToPRB-InterleaverDCI-1-2 instead of vrb-ToPRB-Interleaver. The PRB bundling procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 1_3. The PRB bundling procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 4_2, by applying the parameters of prb-BundlingType given by pdsch-ConfigMulticast as well as vrb-ToPRB-Interleaver given by pdsch-ConfigMulticast.\nA UE may assume that precoding granularity is  consecutive resource blocks in the frequency domain.  can be equal to one of the values among {2, 4, wideband}.\nIf  is determined as \"wideband\", the UE is not expected to be scheduled with non-contiguous PRBs and the UE may assume that the same precoding is applied to the allocated resource associated with a same TCI state or a same QCL assumption.\nIf  is determined as one of the values among {2, 4}, Precoding Resource Block Group (PRGs) partitions the bandwidth part i with  consecutive PRBs. Actual number of consecutive PRBs in each PRG could be one or more. \nThe first PRG size is given by  and the last PRG size given by  if , and the last PRG size is if . For PDSCH scheduled by PDCCH with DCI scrambled using G-RNTI or G-CS-RNTI,  is the starting PRB of the CFR and  is the CFR.\nThe UE may assume the same precoding is applied for any downlink contiguous allocation of PRBs in a PRG.\nFor PDSCH carrying SIB1 scheduled by PDCCH with CRC scrambled by SI-RNTI, a PRG is partitioned from the lowest numbered resource block of CORESET 0 if the corresponding PDCCH is associated with CORESET 0 and Type0-PDCCH common search space and is addressed to SI-RNTI; otherwise, a PRG is partitioned from common resource block 0.\nIf a UE is scheduled a PDSCH with DCI format 1_0 or 4_0 for broadcast or 4_1 for multicast, the UE shall assume that  is equal to 2 PRBs.\nWhen receiving PDSCH scheduled by PDCCH with DCI format 1_1 with CRC scrambled by C-RNTI, MCS-C-RNTI, or CS-RNTI,  for bandwidth part is equal to 2 PRBs unless configured by the higher layer parameter prb-BundlingType given by PDSCH-Config. \nWhen receiving PDSCH scheduled by PDCCH with DCI format 1_1 with CRC scrambled by C-RNTI, MCS-C-RNTI, or CS-RNTI, if the higher layer parameter prb-BundlingType is set to 'dynamicBundling', the higher layer parameters bundleSizeSet1 and bundleSizeSet2 configure two sets of  values, the first set can take one or two  values among {2, 4, wideband}, and the second set can take one  value among {2, 4, wideband}. \nIf the PRB 'bundling size indicator' signalled in DCI format 1_1 as defined in Clause 7.3.1.2.2 of [5, TS 38.212]\n-\tis set to '0', the UE shall use the  value from the second set of  values when receiving PDSCH scheduled by the same DCI.\n-\tis set to '1' and one value is configured for the first set of  values, the UE shall use this  value when receiving PDSCH scheduled by the same DCI\n-\tis set to '1' and two values are configured for the first set of  values as 'n2-wideband' (corresponding to two  values 2 and wideband) or 'n4-wideband' (corresponding to two  values 4 and wideband), the UE shall use the value when receiving PDSCH scheduled by the same DCI as follows:\n-\tIf the scheduled PRBs are contiguous and the size of the scheduled PRBs is larger than ,  is the same as the scheduled bandwidth, otherwise  is set to the remaining configured value of 2 or 4, respectively.\nWhen receiving PDSCH scheduled by PDCCH with DCI format 1_1 with CRC scrambled by C-RNTI, MCS-C-RNTI, or CS-RNTI, if the higher layer parameter prb-BundlingType is set to 'staticBundling', the  value is configured with the single value indicated by the higher layer parameter bundleSize. \nWhen a UE is configured with nominal RBG size  for bandwidth part i according to Clause 5.1.2.2.1, or when a UE is configured with interleaving unit of 2 for VRB to PRB mapping provided by the higher layer parameter vrb-ToPRB-Interleaver given by PDSCH-Config for bandwidth part i, the UE is not expected to be configured with = 4.\nFor a UE configured by the higher layer parameter repetitionScheme set to 'fdmSchemeA' or 'fdmSchemeB', and when the UE not configured with dl-OrJointTCI-StateList is indicated with two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication', or when the UE configured with dl-OrJointTCI-StateList and having two indicated TCI States to be applied to PDSCH, and the UE is indicated with DM-RS port(s) within one CDM group in the DCI field 'Antenna Port(s)', \n-\tIf  is determined as \"wideband\", the first  PRBs are assigned to the first TCI state and the remaining  PRBs are assigned to the second TCI state, where is the total number of allocated PRBs for the UE. \n-\tIf  is determined as one of the values among {2, 4}, even PRGs within the allocated frequency domain resources are assigned to the first TCI state and odd PRGs within the allocated frequency domain resources are assigned to the second TCI state, wherein the PRGs are numbered continuously in increasing order with the first PRG index equal to 0. \n-\tThe UE is not expected to receive more than two PDSCH transmission layers for each PDSCH transmission occasion.\nFor a UE configured by the higher layer parameter repetitionScheme set to 'fdmSchemeB', and when the UE not configured with dl-OrJointTCI-StateList is indicated with two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication', or when the UE configured with dl-OrJointTCI-StateList and having two indicated TCI States to be applied to PDSCH, and the UE is indicated with DM-RS port(s) within one CDM group in the DCI field 'Antenna Port(s)', each PDSCH transmission occasion shall follow the Clause 7.3.1 of [4, TS 38.211] with the mapping to resource elements determined by the assigned PRBs for corresponding TCI state of the PDSCH transmission occasion, and the UE shall only expect at most two code blocks per PDSCH transmission occasion when a single transmission layer is scheduled and a single code block per PDSCH transmission occasion when two transmission layers are scheduled. For two PDSCH transmission occasions, the redundancy version to be applied is derived according to Table 5.1.2.1-2, where  are applied to the first and second TCI state, respectively.\n5.1.3\tModulation order, target code rate, redundancy version and transport block size determination\nTo determine the modulation order, target code rate, and transport block size(s) in the physical downlink shared channel, the UE shall first \n-\tread the 5-bit modulation and coding scheme field (IMCS) in the DCI to determine the modulation order (Qm) and target code rate (R) based on the procedure defined in Clause 5.1.3.1, and\n-\tread 'redundancy version' field (rv) in the DCI to determine the redundancy version.\nand second \n-\tthe UE shall use the number of layers (\u028b), the total number of allocated PRBs before rate matching (nPRB) to determine to the transport block size based on the procedure defined in Clause 5.1.3.2.\nThe UE may skip decoding a transport block in an initial transmission if the effective channel code rate is higher than 0.95, where the effective channel code rate is defined as the number of downlink information bits (including CRC bits) divided by the number of physical channel bits on PDSCH. \nWhen the UE is scheduled with multiple PDSCHs on a serving cell by a DCI, as described in clause 5.1.2.1, the bits of rv field and NDI field, respectively, in the DCI are one-to-one mapped to the scheduled PDSCH(s) indicated by the TDRA information field with the corresponding transport block(s) in the scheduled order, where the LSB bits of the rv field and NDI field, respectively, correspond to the last scheduled PDSCH indicated by the TDRA information field. \nThe UE is not expected to handle any transport blocks (TBs) in a 14 consecutive-symbol duration for normal CP (or 12 for extended CP) ending at the last symbol of the latest PDSCH transmission within an active BWP on a serving cell whenever\n\nwhere, for the serving cell,\n-\tS is the set of TBs belonging to PDSCH(s) that are partially or fully contained in the consecutive-symbol duration\n-\tfor the ith TB\n-\tCi' is the number of scheduled code blocks for as defined in [5, 38.212]. \n-\tLi is the number of OFDM symbols assigned to the PDSCH\n-\txi is the number of OFDM symbols of the PDSCH contained in the consecutive-symbol duration\n-\t based on the values defined in Clause 5.4.2.1 [5, TS 38.212]\n-\t is the starting location of RV for the th transmission\n-\tof the scheduled code blocks for the  transmission\n-\t is the circular buffer length \n-\t is the current (re)transmission for the ith TB \n-\t corresponds to the subcarrier spacing of the BWP (across all configured BWPs of a carrier) that has the largest configured number of PRBs\n-\tin case there is more than one BWP corresponding to the largest configured number of PRBs, \u00b5' follows the BWP with the largest subcarrier spacing.\n-\t corresponds to the subcarrier spacing of the active BWP \n-\tRLBRM = 2/3 as defined in Clause 5.4.2.1 [5, TS 38.212]\n-\tTBSLBRM as defined based on the parameters for unicast in Clause 5.4.2.1 [5, TS 38.212] \n-\tX as defined for downlink max MIMO layer for unicast in Clause 5.4.2.1 [5, TS 38.212].\nIf the UE skips decoding, the physical layer indicates to higher layer that the transport block is not successfully decoded. \nWithin a cell group, a UE is not required to handle PDSCH(s) transmissions including unicast and/or multicast/broadcast in slot sj in serving cell-j, and for j = 0,1,2.. J-1, slot sj overlapping with any given point in time, if the following condition is not satisfied at that point in time: \n\nwhere, \n-\tJ is the number of configured serving cells belonging to a frequency range\n-\tfor the j-th serving cell,\n-\tM is the number of TB(s) transmitted in slot sj. If there are two PDSCH transmission occasions of the same TB (in time domain or in frequency domain) in the slot sj, each transmission occasion is counted separately.\n-\tTslot(j) =10-3/2(j), where (j) is the numerology for PDSCH(s) in slot sj of the j-th serving cell. \n-\tfor the m-th TB, \n-\tA is the number of bits in the transport block as defined in Clause 7.2.1 [5, TS 38.212] \n-\tC is the total number of code blocks for the transport block defined in Clause 5.2.2 [5, TS 38.212].\n-\t is the number of scheduled code blocks for the transport block as defined in Clause 5.4.2.1 [5, TS 38.212] \n-\t [Mbps] is computed as the maximum data rate summed over all the carriers in the frequency range for any signaled band combination and feature set consistent with the configured servings cells, where the data rate value is given by the formula in Clause 4.1.2 in [13, TS 38.306], including the scaling factor f(i).\nFor a j-th serving cell, if higher layer parameter processingType2Enabled of PDSCH-ServingCellConfig is configured for the serving cell and set to 'enable', or if at least one IMCS > W for a PDSCH for unicast or multicast, where W = 28 for MCS tables 5.1.3.1-1 and 5.1.3.1-3, and W = 27 for MCS table 5.1.3.1-2, and W = 26 for MCS table 5.1.3.1-4, or for a j-th serving cell where UE supports FDM-ed unicast and MBS PDSCH, the UE is not required to handle PDSCH transmissions, if the following condition is not satisfied:\n\nwhere\n-\tis the number of symbols assigned to the PDSCH(s). For a PDSCH that consists of two PDSCH transmission occasions in time domain in one slot,  is the number of symbols of one transmission occasion. For FDMed unicast and MBS PDSCHs in one slot,  is the total number of symbols of the unicast and MBS PDSCHs with fully or partially-overlapped in time domain.\n-\tM is the number of TB(s) in the PDSCH(s)\n-\t where  is the numerology of the PDSCH(s) \n-\tfor the m-th TB, \n-\tA is the number of bits in the transport block as defined in Clause 7.2.1 [5, TS 38.212] \n-\tC is the total number of code blocks for the transport block defined in Clause 5.2.2 [5, TS 38.212]\n-\t is the number of scheduled code blocks for the transport block as defined in Clause 5.4.2.1 [5, TS 38.212] \n-\t [Mbps] is computed as the maximum data rate for a carrier in the frequency band of the serving cell for any signaled band combination and feature set consistent with the serving cell, where the data rate value is given by the formula in Clause 4.1.2 in [13, TS 38.306], including the scaling factor f(i).\n5.1.3.1\tModulation order and target code rate determination\nFor the PDSCH scheduled by a PDCCH with DCI format 1_0, format 1_1, format 1_2, format 1_3, format 4_0, format 4_1 or format 4_2 with CRC scrambled by C-RNTI, MCS-C-RNTI, TC-RNTI, CS-RNTI, SI-RNTI, RA-RNTI, MSGB-RNTI, G-RNTI, G-CS-RNTI, multicast-MCCH-RNTI, MCCH-RNTI or P-RNTI, or for the PDSCH scheduled without corresponding PDCCH transmissions using the higher-layer-provided PDSCH configuration SPS-Config, \nif the higher layer parameter mcs-Table-r17 given by PDSCH-Config is set to 'qam1024', and the PDSCH is scheduled by a PDCCH with DCI format 1_1 or 1_3 with CRC scrambled by C-RNTI\n-\tthe UE shall use IMCS and Table 5.1.3.1-4 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel. \nelseif mcs-TableDCI-1-2-r17 given by PDSCH-Config is set to 'qam1024', and the PDSCH is scheduled by a PDCCH with DCI format 1_2 with CRC scrambled by C-RNTI\n-\tthe UE shall use IMCS and Table 5.1.3.1-4 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel.\nelseif the higher layer parameter mcs-TableDCI-1-2 given by PDSCH-Config is set to 'qam256', and the PDSCH is scheduled by a PDCCH with DCI format 1_2 with CRC scrambled by C-RNTI\n-\tthe UE shall use IMCS and Table 5.1.3.1-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel. \nelseif the UE is not configured with MCS-C-RNTI, the higher layer parameter mcs-TableDCI-1-2 given by PDSCH-Config is set to 'qam64LowSE', and the PDSCH is scheduled by a PDCCH with DCI format 1_2 scrambled by C-RNTI\n-\tthe UE shall use IMCS and Table 5.1.3.1-3 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel. \nelseif the higher layer parameter mcs-Table given by PDSCH-Config is set to 'qam256', and the PDSCH is scheduled by a PDCCH with DCI format 1_1 or 1_3 with CRC scrambled by C-RNTI\n-\tthe UE shall use IMCS and Table 5.1.3.1-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel. \nelseif the higher layer parameter mcs-Table given by pdsch-ConfigMulticast is set to 'qam256', and the PDSCH is scheduled by a PDCCH with DCI format 4_1 or 4_2 with CRC scrambled by G-RNTI for multicast\n-\tthe UE shall use IMCS and Table 5.1.3.1-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel. \nelseif the higher layer parameter mcs-Table given by pdsch-ConfigMCCH and pdsch-ConfigMTCH for MBS boardcast is set to 'qam256', and the PDSCH is scheduled by a PDCCH with DCI format 4_0 with CRC scrambled by MCCH-RNTI or G-RNTI for broadcast\n-\tthe UE shall use IMCS and Table 5.1.3.1-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel.\nelseif the higher layer parameter mcs-Table given by pdsch-ConfigMCCH and pdsch-ConfigMTCH for MBS multicast is set to \u2018qam256\u2019, and the PDSCH is scheduled by a PDCCH with DCI format 4_0 with CRC scrambled by multicast-MCCH-RNTI or by a PDCCH with DCI format 4_1 with CRC scrambled by G-RNTI for multicast in RRC_INACTIVE\n-\tthe UE shall use IMCS and Table 5.1.3.1-2 to determine the modulation order (Qm) and Target code rate I used in the physical downlink shared channel.\nelseif the higher layer parameter mcs-Table given by pdsch-ConfigMulticast is set to 'qam64LowSE', and the PDSCH is scheduled by a PDCCH with DCI format 4_1 or 4_2 with CRC scrambled by G-RNTI for multicast\n-\tthe UE shall use IMCS and Table 5.1.3.1-3 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel.\nelseif the UE is not configured with MCS-C-RNTI, the higher layer parameter mcs-Table given by PDSCH-Config is set to 'qam64LowSE', and the PDSCH is scheduled by a PDCCH with a DCI format other than DCI format 1_2 in a UE-specific search space with CRC scrambled by C-RNTI\n-\tthe UE shall use IMCS and Table 5.1.3.1-3 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel.\nelseif the UE is configured with MCS-C-RNTI, and the PDSCH is scheduled by a PDCCH with CRC scrambled by MCS-C-RNTI\n-\tthe UE shall use IMCS and Table 5.1.3.1-3 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel. \nelseif the UE is not configured with the higher layer parameter mcs-Table given by SPS-config, and the higher layer parameter mcs-Table-r17 given by PDSCH-Config is set to 'qam1024',\n-\tif the PDSCH is scheduled by a PDCCH with DCI format 1_1 with CRC scrambled by CS-RNTI or\n-\tif the PDSCH with SPS activated by DCI format 1_1 is scheduled without corresponding PDCCH transmission using SPS-Config, \n-\tthe UE shall use IMCS and Table 5.1.3.1-4 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel. \nelseif the UE is not configured with the higher layer parameter mcs-Table given by SPS-config, and the higher layer parameter mcs-TableDCI-1-2-r17 given by PDSCH-Config is set to 'qam1024',\n-\tif the PDSCH is scheduled by a PDCCH with DCI format 1_2 with CRC scrambled by CS-RNTI or\n-\tif the PDSCH with SPS activated by DCI format 1_2 is scheduled without corresponding PDCCH transmission using SPS-Config, \n-\tthe UE shall use IMCS and Table 5.1.3.1-4 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel. \nelseif the UE is not configured with the higher layer parameter mcs-Table given by SPS-config, and the higher layer parameter mcs-TableDCI-1-2 given by PDSCH-Config is set to 'qam256',\n-\tif the PDSCH is scheduled by a PDCCH with DCI format 1_2 with CRC scrambled by CS-RNTI or\n-\tif the PDSCH with SPS activated by DCI format 1_2 is scheduled without corresponding PDCCH transmission using SPS-Config, \n-\tthe UE shall use IMCS and Table 5.1.3.1-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel. \nelseif the UE is not configured with the higher layer parameter mcs-Table given by SPS-Config, and the higher layer parameter mcs-Table given by PDSCH-Config is set to 'qam256', \n-\tif the PDSCH is scheduled by a PDCCH with DCI format 1_1 with CRC scrambled by CS-RNTI or\n-\tif the PDSCH with SPS activated by DCI format 1_1 is scheduled without corresponding PDCCH transmission using SPS-Config, \n-\tthe UE shall use IMCS and Table 5.1.3.1-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel.\nelseif the UE is configured with the higher layer parameter mcs-Table given by SPS-Config set to 'qam64LowSE'\n-\tif the PDSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or\n-\tif the PDSCH is scheduled without corresponding PDCCH transmission using SPS-Config, \n-\tthe UE shall use IMCS and Table 5.1.3.1-3 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel.\nelseif the UE is configured with the higher layer parameter mcs-Table given by SPS-Config or mcs-Table of pdsch-ConfigMulticast in the same CFR-ConfigMulticast set to 'qam64LowSE'\n-\tif the GC-PDSCH is scheduled by a GC-PDCCH with CRC scrambled by G-CS-RNTI or\n-\tif the GC-PDSCH is scheduled without corresponding GC-PDCCH transmission using SPS-Config, \n-\tthe UE shall use IMCS and Table 5.1.3.1-3 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel.\nelse\n-\tthe UE shall use IMCS and Table 5.1.3.1-1 to determine the modulation order (Qm) and Target code rate (R) used in the physical downlink shared channel.\nend\nThe UE is not expected to decode a PDSCH scheduled with P-RNTI, RA-RNTI, SI-RNTI and Qm > 2\nFor a UE configured with the higher layer parameter repetitionScheme set to 'fdmSchemeB', and when the UE not configured with dl-OrJointTCI-StateList is indicated with two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication', or when the UE configured with dl-OrJointTCI-StateList and having two indicated TCI States to be applied to PDSCH, and the UE is indicated with DM-RS port(s) within one CDM group in the DCI field 'Antenna Port(s)', the determined modulation order of PDSCH transmission occasion associated with the first TCI state is applied to the PDSCH transmission occasion associated with the second TCI state. \nTable 5.1.3.1-1: MCS index table 1 for PDSCH\n\nTable 5.1.3.1-2: MCS index table 2 for PDSCH\n\nTable 5.1.3.1-3: MCS index table 3 for PDSCH\n\nTable 5.1.3.1-4: MCS index table 4 for PDSCH\n\n5.1.3.2\tTransport block size determination\nIn case the higher layer parameter maxNrofCodeWordsScheduledByDCI in PDSCH-config indicates that two codeword transmission is enabled, then one of the two transport blocks is disabled by DCI format 1_1 or 1_3 if IMCS = 26 and if rvid = 1 for the corresponding transport block. In case the higher layer parameter maxNrofCodeWordsScheduledByDCI in pdsch-ConfigMulticast indicates that two codeword transmission is enabled, then one of the two transport blocks is disabled by DCI format 4_2 if IMCS = 26 and if rvid = 1 for the corresponding transport block. When the UE is configured with higher layer parameter pdsch-TimeDomainAllocationListForMultiPDSCH, either the first or the second transport block of all scheduled PDSCHs is disabled by the DCI format 1_1 if IMCS = 26 and if rvid = 2 for the corresponding transport block of all scheduled PDSCHs. If both transport blocks are enabled, transport block 1 and 2 are mapped to codeword 0 and 1 respectively. If only one transport block is enabled, then the enabled transport block is always mapped to the first codeword.\nFor the PDSCH assigned by a PDCCH with DCI format 1_0, 1_1, 1_2, 1_3, 4_0, 4_1, or 4_2 with CRC scrambled by C-RNTI, MCS-C-RNTI, TC-RNTI, CS-RNTI, G-RNTI, G-CS-RNTI, MCCH-RNTI, multicast-MCCH-RNTI or SI-RNTI, if Table 5.1.3.1-2 is used and , else if Table 5.1.3.1-4 is used and  or a table other than Table 5.1.3.1-2 and Table 5.1.3.1-4 is used and , the UE shall, except if the transport block is disabled in DCI format 1_1 or 1_3, first determine the TBS as specified below:\n1)\tThe UE shall first determine the number of REs (NRE) within the slot. \n-\tA UE first determines the number of REs allocated for PDSCH within a PRB () by , where is the number of subcarriers in a physical resource block,  is the number of symbols of the PDSCH allocation within the slot,  is the number of REs for DM-RS per PRB in the scheduled duration including the overhead of the DM-RS CDM groups without data, as indicated by DCI format 1_1, 1_2 or 1_3 or as described for format 1_0 in Clause 5.1.6.2, and  is the overhead configured by higher layer parameter xOverhead in PDSCH-ServingCellConfig. If the xOverhead in PDSCH-ServingCellconfig is not configured (a value from 6, 12, or 18), the  is set to 0. If the PDSCH is scheduled by PDCCH with a CRC scrambled by SI-RNTI, RA-RNTI, MSGB-RNTI or P-RNTI,  is assumed to be 0. If the PDSCH is scheduled by PDCCH with a CRC scrambled by G-RNTI for multicast or G-CS-RNTI or PDSCH without PDCCH is activated by PDCCH with a CRC scrambled by G-CS-RNTI,  is the overhead configured by higher layer parameter xOverhead-Multicast in pdsch-ConfigMulticast. If the xOverhead-Multicast in pdsch-ConfigMulticast is not configured, the  is set to 0. If the PDSCH is scheduled by PDCCH with a CRC scrambled by G-RNTI for broadcast or MCCH-RNTI,  is the overhead configured by higher layer parameter xOverhead in pdsch-ConfigBroadcast. If the xOverhead in pdsch- ConfigBroadcast is not configured, the  is set to 0.\n-\tA UE determines the total number of REs allocated for PDSCH () by , where nPRB is the total number of allocated PRBs for the UE. \n2)\tUnquantized intermediate variable (Ninfo) is obtained by .\nIf \nUse step 3 as the next step of the TBS determination\nelse\nUse step 4 as the next step of the TBS determination\nend if\n3)\tWhen , TBS is determined as follows\n-\tquantized intermediate number of information bits , where .\n-\tuse Table 5.1.3.2-1 find the closest TBS that is not less than .\nTable 5.1.3.2-1: TBS for \n\n4)\tWhen , TBS is determined as follows.\n-\tquantized intermediate number of information bits , where and ties in the round function are broken towards the next largest integer.\n-\tif \n, where \nelse\nif \n, where \nelse\n\nend if\nend if\nelse if Table 5.1.3.1-2 is used and , \n-\tthe TBS is assumed to be as determined from the DCI transported in the latest PDCCH for the same transport block using . If there is no PDCCH for the same transport block using , and if the initial PDSCH for the same transport block is semi-persistently scheduled, the TBS shall be determined from the most recent semi-persistent scheduling assignment PDCCH.\nelse if Table 5.1.3.1-4 is used and , \n-\tthe TBS is assumed to be as determined from the DCI transported in the latest PDCCH for the same transport block using . If there is no PDCCH for the same transport block using , and if the initial PDSCH for the same transport block is semi-persistently scheduled, the TBS shall be determined from the most recent semi-persistent scheduling assignment PDCCH.\nelse \n-\tthe TBS is assumed to be as determined from the DCI transported in the latest PDCCH for the same transport block using . If there is no PDCCH for the same transport block using, and if the initial PDSCH for the same transport block is semi-persistently scheduled, the TBS shall be determined from the most recent semi-persistent scheduling assignment PDCCH.\nThe UE is not expected to receive a PDSCH assigned by a PDCCH with CRC scrambled by SI-RNTI with a TBS exceeding 2976 bits.\nFor a UE configured with the higher layer parameter repetitionScheme set to 'fdmSchemeB', and when the UE not configured with dl-OrJointTCI-StateList is indicated with two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication', or when the UE configured with dl-OrJointTCI-StateList and having two indicated TCI States to be applied to PDSCH, and the UE is indicated with DM-RS port(s) within one CDM group in the DCI field 'Antenna Port(s)', the TBS determination follows the steps 1-4 with the following modification in step 1: a UE determines the total number of REs allocated for PDSCH () by , where nPRB is the total number of allocated PRBs corresponding to the first TCI state, and the determined TBS of PDSCH transmission occasion associated with the first TCI state is also applied to the PDSCH transmission occasion associated with the second TCI state. For a UE configured with the higher layer parameter repetitionScheme set to 'tdmSchemeA' and indicated with two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication' for the UE not configured with dl-OrJointTCI-StateList or for the UE configured with dl-OrJointTCI-StateList and having two indicated TCI States to be applied to PDSCH and indicated with DM-RS port(s) within one CDM group in the DCI field 'Antenna Port(s)', the TBS determination follows the steps 1-4 with the following modification in step 1: a UE determines the number of REs allocated for PDSCH within a PRB () by , where \u00a0is the number of symbols of the PDSCH allocation within the slot corresponding to the first TCI state, and the determined TBS of PDSCH transmission occasion associated with the first TCI state is also applied to the PDSCH transmission occasion associated with the second TCI state.\nFor the PDSCH assigned by a PDCCH with DCI format 1_0 with CRC scrambled by P-RNTI, or RA-RNTI, MsgB-RNTI, TBS determination follows the steps 1-4 with the following modification in step 2: a scaling  is applied in the calculation of Ninfo, where the scaling factor is determined based on the TB scaling field in the DCI as in Table 5.1.3.2-2.\nTable 5.1.3.2-2: Scaling factor of Ninfo for P-RNTI, RA-RNTI and MSGB-RNTI\n\nThe NDI and HARQ process ID, as signalled on PDCCH, and the TBS, as determined above, shall be reported to higher layers.\n5.1.4\tPDSCH resource mapping\nWhen receiving the PDSCH scheduled with SI-RNTI and the system information indicator in DCI is set to 0, the UE shall assume that no SS/PBCH block, after puncturing if applicable, is transmitted in REs used by the UE for a reception of the PDSCH.\nWhen receiving the PDSCH scheduled with SI-RNTI and the system information indicator in DCI is set to 1, RA-RNTI, MSGB-RNTI, P-RNTI or TC-RNTI, the UE assumes SS/PBCH block transmission according to ssb-PositionsInBurst, and if the PDSCH resource allocation overlaps with PRBs containing SS/PBCH block transmission resources the UE shall assume that the PRBs containing SS/PBCH block transmission resources, after puncturing if applicable, are not available for PDSCH in the OFDM symbols where SS/PBCH block is transmitted.\nA UE expects a configuration provided by ssb-PositionsInBurst in ServingCellConfigCommon to be same as a configuration provided by ssb-PositionsInBurst in SIB1.\nWhen receiving PDSCH scheduled by PDCCH with CRC scrambled by C-RNTI, MCS-C-RNTI, CS-RNTI, G-RNTI, G-CS-RNTI, MCCH-RNTI, multicast-MCCH-RNTI or PDSCHs with SPS, the REs corresponding to the configured or dynamically indicated resources in Clauses 5.1.4.1, 5.1.4.2 are not available for PDSCH. Furthermore, the UE assumes SS/PBCH block transmission according to ssb-PositionsInBurst if the PDSCH resource allocation overlaps with PRBs containing SS/PBCH block transmission resources, after puncturing if applicable, and the UE shall assume that the PRBs containing SS/PBCH block transmission resources, after puncturing if applicable, are not available for PDSCH in the OFDM symbols where SS/PBCH block associated with the same PCI is transmitted. \nA UE is not expected to handle the case where PDSCH DM-RS REs are overlapping, even partially, with any RE(s) not available for PDSCH.\nFor operation with shared spectrum channel access, SS/PBCH block transmission according to ssb-PositionsInBurst represents all of the candidate SS/PBCH blocks corresponding to SS/PBCH block indices provided by ssb-PositionsInBurst as described in Clause 4.1 of [6, TS 38.213].\n5.1.4.1\tPDSCH resource mapping with RB symbol level granularity\nThe procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 1_2, by applying only the parameters of rateMatchPatternGroup1DCI-1-2, rateMatchPatternGroup2DCI-1-2 instead of rateMatchPatternGroup1 and rateMatchPatternGroup2. The procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 1_3. The procedures for PDSCH scheduled by PDCCH with DCI format 1_0 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 4_0, by applying only the parameters of rateMatchPatternToAddModList configured in pdsch-ConfigMCCH or pdsch-ConfigMTCH.\nThe procedures for PDSCH scheduled by PDCCH with DCI format 1_0 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 4_1, and the procedures for PDSCH scheduled by DCI format 1_1 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 4_2 by applying only the parameters of rateMatchPatternToAddModList, rateMatchPatternGroup1 and rateMatchPatternGroup2 configured in pdsch-ConfigMulticast. \nA UE may be configured with any of the following higher layer parameters indicating REs declared as not available for PDSCH:\n-\trateMatchPatternToAddModList given by PDSCH-Config, by pdsch-ConfigMulticast, by ServingCellConfig or by ServingCellConfigCommon, or by pdsch-ConfigMCCH or pdsch-ConfigMTCH and configuring up to 4 RateMatchPattern(s) per BWP and up to 4 RateMatchPattern(s) per serving-cell. The RateMatchPatterns configured for MBS multicast are counted into the ones that are configured per BWP. The RateMatchPattern(s) configured for MBS broadcast or for MBS multicast in RRC_INACTIVE_state is counted into the ones that are configured per serving-cell. A RateMatchPattern may contain:\n-\twithin a BWP, when provided by PDSCH-Config or pdsch-ConfigMulticast or within a serving cell when provided by ServingCellConfig or ServingCellConfigCommon, or by pdsch-ConfigMCCH or pdsch-ConfigMTCH, a pair of reserved resources with numerology provided by higher layer parameter subcarrierSpacing given by RateMatchPattern when configured per serving cell or by numerology of associated BWP when configured per BWP. The pair of reserved resources are respectively indicated by an RB level bitmap (higher layer parameter resourceBlocks given by RateMatchPattern) with 1RB granularity and a symbol level bitmap spanning one or two slots (higher layer parameters symbolsInResourceBlock given by RateMatchPattern) for which the reserved RBs apply. A bit value equal to 1 in the RB and symbol level bitmaps indicates that the corresponding resource is not available for PDSCH. For each pair of RB and symbol level bitmaps, a UE may be configured with a time-domain pattern (higher layer parameter periodicityAndPattern given by RateMatchPattern), where each bit of periodicityAndPattern corresponds to a unit equal to a duration of the symbol level bitmap, and a bit value equal to 1 indicates that the pair is present in the unit. The periodicityAndPattern can be {1, 2, 4, 5, 8, 10, 20 or 40} units long, but maximum of 40 msec. The first symbol of periodicityAndPattern every 40 msec/P periods is a first symbol in frame  mod 4 = 0, where P is the duration of periodicityAndPattern in units of msec. When periodicityAndPattern is not configured for a pair, for a symbol level bitmap spanning two slots, the bits of the first and second slots correspond respectively to even and odd slots of a radio frame, and for a symbol level bitmap spanning one slot, the bits of the slot correspond to every slot of a radio frame. The pair can be included in one or two groups of resource sets (higher layer parameters rateMatchPatternGroup1 and rateMatchPatternGroup2). The rateMatchPatternToAddModList given by ServingCellConfig or ServingCellConfigCommon configuration in numerology \u00b5 applies only to PDSCH of the same numerology \u00b5.\n-\twithin a BWP, a frequency domain resource of a CORESET configured by ControlResourceSet with controlResourceSetId or ControlResourceSetZero and time domain resource determined by the higher layer parameters monitoringSlotPeriodicityAndOffset, duration and monitoringSymbolsWithinSlot of all search-space-sets configured by SearchSpace and time domain resource of search-space-set zero configured by searchSpaceZero associated with the CORESET as well as CORESET duration configured by ControlResourceSet with controlResourceSetId or ControlResourceSetZero. This resource not available for PDSCH can be included in one or two groups of resource sets (higher layer parameters rateMatchPatternGroup1 and rateMatchPatternGroup2).\nA configured group rateMatchPatternGroup1 or rateMatchPatternGroup2 contains a list of indices of RateMatchPattern(s) forming a union of resource-sets not available for a PDSCH dynamically if a corresponding bit of the 'Rate matching indicator' field of the DCI format 1_1 scheduling the PDSCH is equal to 1. The REs corresponding to the union of resource-sets configured by RateMatchPattern(s) that are not included in either of the two groups are not available for a PDSCH scheduled by a DCI format 1_0, a PDSCH scheduled by a DCI format 1_1, and PDSCHs with SPS. When receiving a PDSCH scheduled by a DCI format 1_0 or PDSCHs with SPS activated by a DCI format 1_0, the REs corresponding to configured resources in rateMatchPatternGroup1 or rateMatchPatternGroup2 are not available for the scheduled PDSCH or the activated PDSCHs with SPS. When receiving PDSCHs with SPS activated by a DCI format 1_1, the REs corresponding to configured resources in rateMatchPatternGroup1 or rateMatchPatternGroup2 are not available for the PDSCHs with SPS if a corresponding bit of the Rate matching indicator field of the DCI format 1_1 activating the PDSCHs with SPS is equal to 1.\nFor a bitmap pair included in one or two groups of resource sets, the dynamic indication of availability for PDSCH applies to a set of slot(s) where the rateMatchPatternToAddModList is present among the slots of scheduled PDSCH.\nIf a UE monitors PDCCH candidates of aggregation levels 8 and 16 with the same starting CCE index in non-interleaved CORESET spanning one OFDM symbol:\n-\tand if a detected PDCCH scheduling the PDSCH has aggregation level 8, the resources corresponding to the aggregation level 16 PDCCH candidate are not available for the PDSCH;\n-\twhen at least one of the PDCCH candidates of aggregation levels 8 and 16 linked as indicated by higher layer parameter searchSpaceLinkingId, the PDCCH candidates of aggregation level 16 and any other PDCCH candidate(s) linked with any of the PDCCH candidates of aggregation level 8 and 16 are not available for the PDSCH reception at the UE, if a detected PDCCH scheduling the PDSCH is associated with the PDCCH candidates of aggregation level 8 or 16.\nIf a PDSCH scheduled by a PDCCH would overlap with resources in the CORESET containing the PDCCH, the resources corresponding to a union of the detected PDCCH that scheduled the PDSCH and associated PDCCH DM-RS are not available for the PDSCH. When the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], the resources corresponding to a union of the two PDCCH candidates scheduling the PDSCH and the associated PDCCH DM-RS are not available for the PDSCH. When precoderGranularity configured in a CORESET where the PDCCH was detected is set to 'allContiguousRBs', the associated PDCCH DM-RS are DM-RS in all REGs of the CORESET. Otherwise, the associated DM-RS are the DM-RS in REGs of the PDCCH.\n5.1.4.2\tPDSCH resource mapping with RE level granularity\nThe procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 1_2, by applying the parameters of aperiodicZP-CSI-RS-ResourceSetsToAddModListDCI-1-2 instead of aperiodic-ZP-CSI-RS-ResourceSetsToAddModList. The procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 1_3.\nThe procedures for PDSCH scheduled by PDCCH with DCI format 1_0 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 4_1 and the procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 4_2, by applying the parameters of aperiodicZP-CSI-RS-ResourceSetsToAddModList in pdsch-ConfigMulticast instead of aperiodic-ZP-CSI-RS-ResourceSetsToAddModList in PDSCH-Config.\nA UE may be configured with any of the following higher layer parameters:\n-\tREs indicated by the 'RateMatchPatternLTE-CRS' in lte-CRS-ToMatchAround in ServingCellConfig or ServingCellConfigCommon configuring cell-specific RS, in 15 kHz subcarrier spacing applicable only to 15 kHz subcarrier spacing PDSCH, of one LTE carrier in a serving cell are declared as not available for PDSCH. \n-\tREs indicated by 'RateMatchPatternLTE-CRS' in lte-CRS-PatternList1-r16 or lte-CRS-PatternList3-r18 in ServingCellConfig configuring cell-specific RS, in 15 kHz subcarrier spacing applicable only to 15 kHz subcarrier spacing PDSCH, of one LTE carrier in a serving cell are declared as not available for PDSCH.\n-\tFor the UE for broadcast reception or multicast reception in RRC_INACTIVE_state, REs indicated by 'RateMatchPatternLTE-CRS' in pdsch-ConfigMCCH or pdsch-ConfigMTCH configuring cell-specific RS, in 15 kHz subcarrier spacing applicable only to 15 kHz subcarrier spacing PDSCH, of one LTE carrier in a serving cell are declared as not available for broadcast PDSCH. The total number of RateMatchPatternLTE-CRS for broadcast reception or multicast reception in RRC_INACTIVE_state that a UE can be configured with is the same as for unicast in Rel-15.\n-\tEach RateMatchPatternLTE-CRS configuration contains v-Shift consisting of LTE-CRS-vshift(s), nrofCRS-Ports consisting of LTE-CRS antenna ports 1, 2 or 4 ports, carrierFreqDL representing the offset in units of 15 kHz subcarriers from (reference) point A to the LTE carrier centre subcarrier location, carrierBandwidthDL representing the LTE carrier bandwidth, and may also configure mbsfn-SubframeConfigList representing MBSFN subframe configuration. A UE determines the CRS position within the slot according to Clause 6.10.1.2 in [15, TS 36.211], where slot corresponds to LTE subframe. \n-\tIf the UE is configured by higher layer parameter PDCCH-Config with two different values of coresetPoolIndex in ControlResourceSet and is also configured by the higher layer parameter lte-CRS-PatternList1-r16 and lte-CRS-PatternList2-r16 in ServingCellConfig, the following REs are declared as not available for PDSCH:\n-\tif the UE is configured with crs-RateMatch-PerCoresetPoolIndex, REs indicated by the CRS pattern(s) in lte-CRS-PatternList1-r16 if the PDSCH is associated with coresetPoolIndex set to '0', or the CRS pattern(s) in lte-CRS-PatternList2-r16 if PDSCH is associated with coresetPoolIndex set to '1';\n-\totherwise, REs indicated by lte-CRS-PatternList1-r16 and lte-CRS-PatternList2-r16, in ServingCellConfig.\n-\tIf the UE is not configured by higher layer parameter PDCCH-Config with two different values of coresetPoolIndex in ControlResourceSet, and if the UE is configured by higher layer parameter lte-CRS-PatternList3-r18 and lte-CRS-PatternList4-r18 in ServingCellConfig, REs indicated by lte-CRS-PatternList3-r18 and lte-CRS-PatternList4-r18 are declared as not available for PDSCH.\n-\tIf the UE is configured by higher layer parameter PDCCH-Config with two different values of coresetPoolIndex in ControlResourceSet and is also configured by the higher layer parameter lte-CRS-PatternList3-r18 and lte-CRS-PatternList4-r18 in ServingCellConfig, the following REs are declared as not available for PDSCH:\n-\tif the UE is configured with crs-RateMatch-PerCoresetPoolIndex, REs indicated by the CRS pattern(s) in lte-CRS-PatternList3-r18 if the PDSCH is associated with coresetPoolIndex set to '0', or the CRS pattern(s) in lte-CRS-PatternList4-r18 if PDSCH is associated with coresetPoolIndex set to '1';\n-\totherwise, REs indicated by lte-CRS-PatternList3-r18 and lte-CRS-PatternList4-r18, in ServingCellConfig.\n-\tWithin a BWP, the UE can be configured with one or more ZP CSI-RS resource set configuration(s) for aperiodic, semi-persistent and periodic time-domain behaviours (higher layer parameters aperiodic-ZP-CSI-RS-ResourceSetsToAddModList,  sp-ZP-CSI-RS-ResourceSetsToAddModList and p-ZP-CSI-RS-ResourceSet respectively comprised in PDSCH-Config), with each ZP CSI-RS resource set consisting of at most 16 ZP CSI-RS resources (higher layer parameter ZP-CSI-RS-Resource) in numerology of the BWP. The REs indicated by p-ZP-CSI-RS-ResourceSet are declared as not available for PDSCH. The REs indicated by sp-ZP-CSI-RS-ResourceSetsToAddModList and aperiodic-ZP-CSI-RS-ResourceSetsToAddModList are declared as not available for PDSCH when their triggering and activation are applied, respectively. The following parameters are configured via higher layer signaling for each ZP CSI-RS resource configuration:\n-\tzp-CSI-RS-ResourceId in ZP-CSI-RS-Resource determines ZP CSI-RS resource configuration identity.\n-\tnrofPorts in CSI-RS-ResourceMapping defines the number of CSI-RS ports, where the allowable values are given in Clause 7.4.1.5 of [4, TS 38.211].\n-\tcdm-Type in CSI-RS-ResourceMapping defines CDM values and pattern, where the allowable values are given in Clause 7.4.1.5 of [4, TS 38.211].\n-\tresourceMapping in ZP-CSI-RS-Resource defines the OFDM symbol and subcarrier occupancy of the ZP CSI-RS resource within a slot that are given in Clause 7.4.1.5 of [4, TS 38.211].\n-\tperiodicityAndOffset in ZP-CSI-RS-Resource defines the ZP-CSI-RS periodicity and slot offset for periodic/semi-persistent ZP CSI-RS. \n-\tFor the UE in RRC_CONNECTED mode for multicast reception, p-ZP-CSI-RS-ResourceSet can be configured in pdsch-ConfigMulticast for GC-PDSCH rate matching, subject to UE capability. The REs indicated by p-ZP-CSI-RS-ResourceSet are declared as not available for GC-PDSCH. The REs indicated by p-ZP-CSI-RS-ResourceSet configured in PDSCH-Config for unicast do not apply for GC-PDSCH and the REs indicated by p-ZP-CSI-RS-ResourceSet configured in pdsch-ConfigMulticast for multicast do not apply for unicast PDSCH. The total number of periodic ZP-CSI-RS-Resources that a UE can be configured with is the same as for unicast in Rel-16. If p-ZP-CSI-RS-ResourceSet is configured in both PDSCH-Config and pdsch-ConfigMulticast, it is subject to UE capability whether the p-ZP-CSI-RS-ResourceSet configured in pdsch-ConfigMulticast can be different from the p-ZP-CSI-RS-ResourceSet configured in PDSCH-Config.\n-\tFor the UE in RRC_CONNECTED mode for multicast reception, sp-ZP-CSI-RS-ResourceSet can be configured in pdsch-ConfigMulticast for GC-PDSCH rate matching, subject to UE capability. The REs indicated by sp-ZP-CSI-RS-ResourceSet are declared as not available for GC-PDSCH when their triggering and activation delivered by unicast PDSCH are applied. The REs indicated by sp-ZP-CSI-RS-ResourceSet configured in PDSCH-Config for unicast do not apply for GC-PDSCH and the REs indicated by sp-ZP-CSI-RS-ResourceSet configured in pdsch-ConfigMulticast for multicast do not apply for unicast PDSCH. The total number of semi-persistent ZP-CSI-RS-Resources that a UE can be configured with is the same as for unicast.\nThe UE may be configured with a DCI field for triggering the aperiodic ZP CSI-RS. A list of ZP-CSI-RS-ResourceSet(s), provided by higher layer parameter aperiodic-ZP-CSI-RS-ResourceSetsToAddModList in PDSCH-Config, is configured for aperiodic triggering. The maximum number of aperiodic ZP-CSI-RS-ResourceSet(s) configured per BWP is 3. The bit-length of DCI field ZP CSI-RS trigger depends on the number of aperiodic ZP-CSI-RS-ResourceSet(s)configured (up to 2 bits). Each non-zero codepoint of 'ZP CSI-RS' trigger in DCI format 1_1 triggers one aperiodic 'ZP-CSI-RS-ResourceSet' in the list aperiodic-ZP-CSI-RS-ResourceSetsToAddModList by indicating the aperiodic ZP CSI-RS resource set ID. The DCI codepoint '01' triggers the resource set with 'ZP-CSI-RS-ResourceSetId' set to '1', the DCI codepoint '10' triggers the resource set with 'ZP-CSI-RS-ResourceSetId' set to '2', and the DCI codepoint '11' triggers the resource set with 'ZP-CSI-RS-ResourceSetId' set to '3'. Codepoint '00' is reserved for not triggering aperiodic ZP CSI-RS. When receiving PDSCH scheduled by DCI format 1_0 or PDSCHs with SPS activated by DCI format 1_0, the REs corresponding to configured resources in aperiodic-ZP-CSI-RS-ResourceSetsToAddModList or in aperiodicZP-CSI-RS-ResourceSetsToAddModListDCI-1-2 are available for PDSCH. \nWhen the UE is configured with multi-slot and single-slot PDSCH scheduling or pdsch-TimeDomainAllocationListForMultiPDSCH, the triggered aperiodic ZP CSI-RS is applied to all the slot(s) of the PDSCH(s) scheduled or the PDSCHs with SPS activated by the PDCCH containing the trigger.\nFor a UE configured with a list of semi-persistent ZP-CSI-RS-ResourceSet(s) provided by higher layer parameter sp-ZP-CSI-RS-ResourceSetsToAddModList: \n-\twhen the UE would transmit a PUCCH with HARQ-ACK information in slot n corresponding to the PDSCH carrying the activation command, as described in clause 6.1.3.19 of [10, TS 38.321], for ZP CSI-RS resource(s), the corresponding action in [10, TS 38.321] and the UE assumption on the PDSCH RE mapping corresponding to the activated ZP CSI-RS resource(s) shall be applied starting from the first slot that is after slot  where \uf06d is the SCS configuration for the PUCCH and is the subcarrier spacing configuration for  with a value of 0 for frequency range 1, and  is provided by K-Mac or  if K-Mac is not provided.\n-\twhen the UE would transmit a PUCCH with HARQ-ACK information in slot n corresponding to the PDSCH carrying the deactivation command, as described in clause 6.1.3.19 of [10, TS 38.321], for activated ZP CSI-RS resource(s), the corresponding action in [10, TS 38.321] and the UE assumption on cessation of the PDSCH RE mapping corresponding to the de-activated ZP CSI-RS resource(s) shall be applied starting from the first slot that is after slot  where \uf06d is the SCS configuration for the PUCCH and is the subcarrier spacing configuration for  with a value of 0 for frequency range 1, and  is provided by K-Mac or  if K-Mac is not provided.\n5.1.5\tAntenna ports quasi co-location\nThe UE can be configured with a list of up to M TCI-State configurations within the higher layer parameter PDSCH-Config to decode PDSCH according to a detected PDCCH with DCI intended for the UE and the given serving cell, where M depends on the UE capability maxNumberConfiguredTCIstatesPerCC. Each TCI-State contains parameters for configuring a quasi co-location relationship between one or two downlink reference signals and the DM-RS ports of the PDSCH, the DM-RS port of PDCCH or the CSI-RS port(s) of a CSI-RS resource. The quasi co-location relationship is configured by the higher layer parameter qcl-Type1 for the first DL RS, and qcl-Type2 for the second DL RS (if configured). For the case of two DL RSs, the QCL types shall not be the same, regardless of whether the references are to the same DL RS or different DL RSs. The quasi co-location types corresponding to each DL RS are given by the higher layer parameter qcl-Type in QCL-Info and may take one of the following values: \n-\t'typeA': {Doppler shift, Doppler spread, average delay, delay spread}\n-\t'typeB': {Doppler shift, Doppler spread}\n-\t'typeC': {Doppler shift, average delay}\n-\t'typeD': {Spatial Rx parameter}\nThe UE can be configured with a list of up to 128 TCI-State configurations, within the higher layer parameter dl-OrJointTCI-StateList in PDSCH-Config for providing a reference signal for the quasi co-location for DM-RS of PDSCH and DM-RS of PDCCH in a BWP/CC, for CSI-RS, and to provide a reference, if applicable, for determining UL TX spatial filter for dynamic-grant and configured-grant based PUSCH and PUCCH resource in a BWP/CC, and SRS. \nIf the TCI-State or TCI-UL-State configurations are absent in a BWP of the CC, the UE can apply the TCI-State or TCI-UL-State configurations from a reference BWP of a reference CC configured by unifiedTCI-StateRef. The UE is not expected to be configured with tci-StatesToAddModList, SpatialRelationInfo or PUCCH-SpatialRelationInfo, except SpatialRelationInfoPos in a CC in a band, if the UE is configured with dl-OrJointTCI-StateList or ul-TCI-StateList in any CC in the same band. The UE can assume that when the UE is configured with tci-StatesToAddModList in any CC in the CC list configured by simultaneousTCI-UpdateList1-r16, simultaneousTCI-UpdateList2-r16, simultaneousSpatial-UpdatedList1-r16, or simultaneousSpatial-UpdatedList2-r16, the UE is not configured with dl-OrJointTCI-StateList or ul-TCI-StateList in any CC within the same band in the CC list.\nThe UE receives an activation command, as described in clause 6.1.3.xx of [10, TS 38.321], 6.1.3.47 of [10, TS 38.321] or 6.1.4.xx of [10, TS 38.321], used to map up to 8 TCI states and/or pairs of TCI states, with one TCI state for DL channels/signals and/or one TCI state for UL channels/signals to the codepoints of the DCI field 'Transmission Configuration Indication' for one or for a set of CCs/DL BWPs, [and/] or up to 8 sets of TCI states, where each set is comprised of up to two TCI state(s) for DL and UL signals/channels, or up to two TCI state(s) for DL channels/signals and up to two TCI state(s) for UL channels/signals to the codepoints of the DCI field 'Transmission Configuration Indication' for one or for a set of CCs/DL BWPs, and if applicable, for one or for a set of CCs/UL BWPs. When a set of TCI state IDs are activated for a set of CCs/DL BWPs and if applicable, for a set of CCs/UL BWPs, where the applicable list of CCs is determined by the indicated CC in the activation command, the same set of TCI state IDs are applied for all DL and/or UL BWPs in the indicated CCs. If the activation command maps TCI-State(s) and/or TCI-UL-State(s) to only one TCI codepoint, the UE shall apply the indicated TCI-State(s) and/or TCI-UL-State(s) to one or to a set of CCs /DL BWPs, and if applicable, to one or to a set of CCs /UL BWPs once the indicated mapping for the one single TCI codepoint is applied as described in [11, TS 38.133].\nWhen the bwp-id or cell for QCL-TypeA/D source RS in a QCL-Info of the TCI state is not configured, the UE assumes that QCL-TypeA/D source RS is configured in the CC/DL BWP where TCI state applies.\nWhen tci-PresentInDCI is set as 'enabled' or tci-PresentDCI-1-2 is configured for the CORESET, a UE configured with dl-OrJointTCI-StateList with activated TCI-State or ul-TCI-StateList with activated TCI-UL-State receives DCI format 1_1/1_2/1_3 providing indicated TCI-State(s) and/or TCI-UL-State(s) for a CC or all CCs in the same CC list configured by simultaneousU-TCI-UpdateList1-r17, simultaneousU-TCI-UpdateList2-r17, simultaneousU-TCI-UpdateList3-r17, simultaneousU-TCI-UpdateList4-r17. The DCI format 1_1/1_2 can be with or without, if applicable, DL assignment. If the DCI format 1_1/1_2/ is without DL assignment, the UE can assume the following:\n-\tCS-RNTI is used to scramble the CRC for the DCI\n-\tThe values of the following DCI fields are set as follows:\n-\tRV = all '1's\n-\tMCS = all '1's\n-\tNDI = 0\n-\tSet to all '0's for FDRA Type 0, or all '1's for FDRA Type 1, or all '0's for dynamicSwitch (same as in Table 10.2-4 of [6, TS 38.213]). \nAfter a UE receives an initial higher layer configuration of dl-OrJointTCI-StateList with more than one TCI-State and before application of an indicated TCI state from the configured TCI states:\n-\tThe UE assumes that DM-RS of PDSCH and DM-RS of PDCCH and the CSI-RS applying the indicated TCI state are quasi co-located with the SS/PBCH block the UE identified during the initial access procedure\nAfter a UE receives an initial higher layer configuration of dl-OrJointTCI-StateList with more than one TCI-State or ul-TCI-StateList with more than one TCI-UL-State and before application of an indicated TCI state from the configured TCI states:\n-\tThe UE assumes that the UL TX spatial filter, if applicable, for dynamic-grant and configured-grant based PUSCH and PUCCH, and for SRS applying the indicated TCI state, is the same as that for a PUSCH transmission scheduled by a RAR UL grant or a MsgA PUSCH transmission during the initial access procedure\nAfter a UE receives a higher layer configuration of dl-OrJointTCI-StateList with more than one TCI-State as part of a Reconfiguration with sync procedure as described in [12, TS 38.331] and before applying an indicated TCI state from the configured TCI states:\n-\tThe UE assumes that DM-RS of PDSCH and DM-RS of PDCCH, and the CSI-RS applying the indicated TCI state are quasi co-located with the SS/PBCH block or the CSI-RS resource the UE identified during the random access procedure initiated by the Reconfiguration with sync procedure as described in [12, TS 38.331].\nAfter a UE receives a higher layer configuration of dl-OrJointTCI-StateList with more than one TCI-State or more than one TCI-UL-State as part of a Reconfiguration with sync procedure as described in [12, TS 38.331] and before applying an indicated TCI state from the configured TCI states: \n-\tThe UE assumes that the UL TX spatial filter, if applicable, for dynamic-grant and configured-grant based PUSCH and PUCCH, and for SRS applying the indicated TCI state, is the same as that for a PUSCH transmission scheduled by a RAR UL grant or a MsgA PUSCH transmission during random access procedure initiated by the Reconfiguration with sync procedure as described in [12, TS 38.331].\nIf a UE receives a higher layer configuration of dl-OrJointTCI-StateList with a single TCI-State, that can be used as an indicated TCI state, the UE obtains the QCL assumptions from the configured TCI state for DM-RS of PDSCH and DM-RS of PDCCH, and the CSI -RS applying the indicated TCI state. \nIf a UE receives a higher layer configuration of dl-OrJointTCI-StateList with a single TCI-State or ul-TCI-StateList with a single TCI-UL-State, that can be used as an indicated TCI state, the UE determines an UL TX spatial filter, if applicable, from the configured TCI state for dynamic-grant and configured-grant based PUSCH and PUCCH, and SRS applying the indicated TCI state.\nWhen a UE configured with dl-OrJointTCI-StateList would transmit a PUCCH with positive HARQ-ACK or a PUSCH with positive HARQ-ACK corresponding to the DCI carrying the TCI State indication and without DL assignment, or corresponding to the PDSCH scheduled by the DCI carrying the TCI State indication, and if the indicated TCI State(s) is/are different from the previously indicated one(s), the indicated TCI-State(s) and/or TCI-UL-State(s) should be applied starting from the first slot that is at least  symbols after the last symbol of the PUCCH or the PUSCH, and if the UE receives more than one indicated TCI state for a CC/BWP to be applied starting from the first slot that is at least  symbols after the last symbol of the PUCCH or the PUSCH, the indicated TCI state carried in the latest DCI in time corresponding to positive HARQ-ACK value is applied. The first slot and the  symbols are both determined on the active BWP with the smallest SCS among the BWP(s) from the CCs applying the indicated TCI-State(s) or TCI-UL-State(s) that are active at the end of the PUCCH or the PUSCH carrying the positive HARQ-ACK. \nWhen a UE is configured with dl-OrJointTCI-StateList, and if the UE is configured with unifiedTCI-StateType is set as \u2018separate\u2019, and if the UE receives a TCI codepoint mapped with either of {TCI-State, TCI-UL-State}, the UE shall update the one indicated {TCI-State, TCI-UL-State} and maintain the other {TCI-State, TCI-UL-State} that is not updated by the received TCI codepoint.\nWhen a UE is configured with dl-OrJointTCI-StateList and is having two indicated TCI-states, if the UE receives a TCI codepoint mapped with a sub-set of first and second TCI-State(s) and/or a sub-set of first and second TCI-UL-State(s), the UE shall update the first/second TCI-State(s) and/or first/second TCI-UL-State(s) mapped to the TCI codepoint, when applicable, and keep the previously indicated first/second TCI-State(s) and/or first/second TCI-UL-State(s) that is/are not updated by the TCI codepoint.\nIf a UE is configured with pdsch-TimeDomainAllocationListForMultiPDSCH in which one or more rows contain multiple SLIVs for PDSCH on a DL BWP of a serving cell, and the UE is receiving a DCI carrying the TCI-State indication and without DL assignment, the UE does not expect that the number of indicated SLIVs in the row of the pdsch-TimeDomainAllocationListForMultiPDSCH by the DCI is more than one.\nIf the UE is configured with SSB-MTC-AddtionalPCI and with PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet, the UE receives an activation command for CORESET associated with each coresetPoolIndex, as described in clause 6.1.3.14 of [10, TS 38.321] or 6.1.3.xx of [10, TS 38.321], used to map up to 8 TCI states and/or pairs of TCI states, with one TCI state for DL channels/signals and/or one TCI state for UL channels/signals to the codepoints of the DCI field 'Transmission Configuration Indication' in one CC/DL BWP. When a set of TCI state IDs are activated for a coresetPoolIndex, the activated TCI states corresponding to one coresetPoolIndex is associated with the serving cell physical cell ID and activated TCI states corresponding to another coresetPoolIndex can be associated with another physical cell ID.\nWhen a UE supports two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication' the UE may receive an activation command, as described in clause 6.1.3.24 of [10, TS 38.321], the activation command is used to map up to 8 combinations of one or two TCI states to the codepoints of the DCI field 'Transmission Configuration Indication'. The UE is not expected to receive more than 8 TCI states in the activation command. \nWhen the DCI field 'Transmission Configuration Indication' is present in DCI format 1_2 and when the number of codepoints S in the DCI field 'Transmission Configuration Indication' of DCI format 1_2 is smaller than the number of TCI codepoints that are activated by the activation command, as described in clause 6.1.3.14, 6.1.3.24 and 6.1.3.47 of [10, TS38.321], only the first S activated codepoints are applied for DCI format 1_2. \nWhen the UE would transmit a PUCCH with HARQ-ACK information in slot n corresponding to the PDSCH carrying the activation command, the indicated mapping between TCI states and codepoints of the DCI field 'Transmission Configuration Indication' should be applied starting from the first slot that is after slot where \uf06d is the SCS configuration for the PUCCH and is the subcarrier spacing configuration for  with a value of 0 for frequency range 1, and  is provided by K-Mac or  if K-Mac is not provided. If tci-PresentInDCI is set to 'enabled' or tci-PresentDCI-1-2 is configured for the CORESET scheduling the PDSCH, and the time offset between the reception of the DL DCI and the corresponding PDSCH is equal to or greater than timeDurationForQCL if applicable, after a UE receives an initial higher layer configuration of TCI states and before reception of the activation command, the UE may assume that the DM-RS ports of PDSCH of a serving cell are quasi co-located with the SS/PBCH block determined in the initial access procedure with respect to qcl-Type set to 'typeA', and when applicable, also with respect to qcl-Type set to 'typeD'. \nIf a UE is configured with the higher layer parameter tci-PresentInDCI that is set as 'enabled' for the CORESET scheduling a PDSCH, the UE assumes that the TCI field is present in the DCI format 1_1 or format 1_3 of the PDCCH transmitted on the CORESET. If a UE is configured with the higher layer parameter tci-PresentDCI-1-2 for the CORESET scheduling the PDSCH, the UE assumes that the TCI field with a DCI field size indicated by tci-PresentDCI-1-2 is present in the DCI format 1_2 of the PDCCH transmitted on the CORESET. If a UE is configured with the higher layer parameter tci-PresentInDCI that is set as 'enabled' for the CORESET scheduling the multicast PDSCH, the UE assumes that the TCI field is present in the DCI format 4_2 of the PDCCH transmitted on the CORESET. If the PDSCH is scheduled by a DCI format not having the TCI field present, and the time offset between the reception of the DL DCI and the corresponding PDSCH of a serving cell is equal to or greater than a threshold timeDurationForQCL if applicable, where the threshold is based on reported UE capability [13, TS 38.306], for determining PDSCH antenna port quasi co-location, the UE assumes that the TCI state or the QCL assumption for the PDSCH is identical to the TCI state or QCL assumption whichever is applied for the CORESET used for the PDCCH transmission within the active BWP of the serving cell. \nWhen a UE is configured with both sfnSchemePDCCH and sfnSchemePDSCH scheduled by DCI format 1_0 or by DCI format 1_1/1_2, if the time offset between the reception of the DL DCI and the corresponding PDSCH of a serving cell is equal to or greater than a threshold timeDurationForQCL if applicable:\n-\tif the UE supports sfn-DefaultDL-BeamSetup-r17 for DCI scheduling without TCI field, the UE assumes that the TCI state(s) or the QCL assumption(s) for the PDSCH is identical to the TCI state(s) or QCL assumption(s) whichever is applied for the CORESET used for the reception of the DL DCI within the active BWP of the serving cell regardless of the number of active TCI states of the CORESET. If the UE does not support sfn-SchemeA-DynamicSwitching-r17 or sfn-SchemeB-DynamicSwitching-r17, the UE should be activated with the CORESET with two TCI states. \n-\telse if the UE does not support sfn-DefaultDL-BeamSetup-r17 for DCI scheduling without TCI field, the UE shall expect TCI field present when scheduled by DCI format 1_1/1_2. \nWhen a UE is configured with sfnSchemePDSCH and sfnSchemePDCCH is not configured, when scheduled by DCI format 1_1/1_2, if the time offset between the reception of the DL DCI and the corresponding PDSCH of a serving cell is equal to or greater than a threshold timeDurationForQCL if applicable, the UE shall expect TCI field present. \nFor PDSCH scheduled by DCI format 1_0, 1_1, 1_2, when a UE is configured with sfnSchemePDCCH set to 'sfnSchemeA' and sfnSchemePDSCH is not configured, and there is no TCI codepoint with two TCI states in the activation command, and if the time offset between the reception of the DL DCI and the corresponding PDSCH is equal or larger than the threshold timeDurationForQCL if applicable and the CORESET which schedules the PDSCH is indicated with two TCI states, the UE assumes that the TCI state or the QCL assumption for the PDSCH is identical to the first TCI state or QCL assumption which is applied for the CORESET used for the PDCCH transmission within the active BWP of the serving cell.\nIf a UE is not provided dl-OrJointTCI-StateList-r17, and if a PDSCH is scheduled by a DCI format having the TCI field present, the TCI field in DCI in the scheduling component carrier points to the activated TCI states in the scheduled component carrier or DL BWP, the UE shall use the TCI-State according to the value of the 'Transmission Configuration Indication' field in the detected PDCCH with DCI for determining PDSCH antenna port quasi co-location. The UE may assume that the DM-RS ports of PDSCH of a serving cell are quasi co-located with the RS(s) in the TCI state with respect to the QCL type parameter(s) given by the indicated TCI state if the time offset between the reception of the DL DCI and the corresponding PDSCH is equal to or greater than a threshold timeDurationForQCL, where the threshold is based on reported UE capability [13, TS 38.306]. For a single slot PDSCH, the indicated TCI state(s) should be based on the activated TCI states in the slot with the scheduled PDSCH. For a multi-slot PDSCH or the UE is configured with higher layer parameter pdsch-TimeDomainAllocationListForMultiPDSCH, the indicated TCI state(s) should be based on the activated TCI states in the first slot with the scheduled PDSCH(s), and UE shall expect the activated TCI states are the same across the slots with the scheduled PDSCH(s). When the UE is configured with CORESET associated with a search space set for cross-carrier scheduling and the UE is not configured with enableDefaultBeamForCCS, the UE expects tci-PresentInDCI is set as 'enabled' or tci-PresentDCI-1-2 is configured for the CORESET, and if one or more of the TCI states configured for the serving cell scheduled by the search space set contains qcl-Type set to 'typeD', the UE expects the time offset between the reception of the detected PDCCH in the search space set and a corresponding PDSCH is larger than or equal to the threshold timeDurationForQCL.\nIndependent of the configuration of tci-PresentInDCI and tci-PresentDCI-1-2 in RRC connected mode, if the UE is not provided dl-OrJointTCI-StateList-r17, and if the offset between the reception of the DL DCI and the corresponding PDSCH is less than the threshold timeDurationForQCL and at least one configured TCI state for the serving cell of scheduled PDSCH contains qcl-Type set to 'typeD', \n-\tthe UE may assume that the DM-RS ports of PDSCH(s) of a serving cell are quasi co-located with the RS(s) with respect to the QCL parameter(s) used for PDCCH quasi co-location indication of the CORESET associated with a monitored search space with the lowest controlResourceSetId in the latest slot in which one or more CORESETs within the active BWP of the serving cell are monitored by the UE. In this case, if the qcl-Type is set to 'typeD' of the PDSCH DM-RS is different from that of the PDCCH DM-RS with which they overlap in at least one symbol, the UE is expected to prioritize the reception of PDCCH associated with that CORESET. This also applies to the intra-band CA case (when PDSCH and the CORESET are in different component carriers). \n-\tIf a UE is configured with enableDefaultTCI-StatePerCoresetPoolIndex and the UE is configured by higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in different ControlResourceSets, \n-\tthe UE may assume that the DM-RS ports of PDSCH associated with a value of coresetPoolIndex of a serving cell are quasi co-located with the RS(s) with respect to the QCL parameter(s) used for PDCCH quasi co-location indication of the CORESET associated with a monitored search space with the lowest controlResourceSetId among CORESETs, which are configured with the same value of coresetPoolIndex as the PDCCH scheduling that PDSCH, in the latest slot in which one or more CORESETs associated with the same value of coresetPoolIndex as the PDCCH scheduling that PDSCH within the active BWP of the serving cell are monitored by the UE. In this case, if the 'QCL-TypeD' of the PDSCH DM-RS is different from that of the PDCCH DM-RS with which they overlap in at least one symbol and they are associated with same value of coresetPoolIndex, the UE is expected to prioritize the reception of PDCCH associated with that CORESET. This also applies to the intra-band CA case (when PDSCH and the CORESET are in different component carriers).\n-\tIf a UE is configured with enableTwoDefaultTCI-States, and at least one TCI codepoint indicates two TCI states, the UE may assume that the DM-RS ports of PDSCH or PDSCH transmission occasions of a serving cell are quasi co-located with the RS(s) with respect to the QCL parameter(s) associated with the TCI states corresponding to the lowest codepoint among the TCI codepoints containing two different TCI states. When the UE is configured by higher layer parameter repetitionScheme set to 'tdmSchemeA' or is configured with higher layer parameter repetitionNumber, and the offset between the reception of the DL DCI and the first PDSCH transmission occasion is less than the threshold timeDurationForQCL, the mapping of the TCI states to\u00a0PDSCH transmission occasions is determined according to clause 5.1.2.1 by replacing the indicated TCI states with the TCI states corresponding to the lowest codepoint among the TCI codepoints containing two different TCI states based on the activated TCI states in the slot with the first PDSCH transmission occasion. In this case, if the 'QCL-TypeD' in both of the TCI states corresponding to the lowest codepoint among the TCI codepoints containing two different TCI states is different from that of the PDCCH DM-RS with which they overlap in at least one symbol, the UE is expected to prioritize the reception of PDCCH associated with that CORESET. This also applies to the intra-band CA case (when PDSCH and the CORESET are in different component carriers)\n-\tIf a UE is not configured with sfnSchemePDSCH, and the UE is configured with sfnSchemePDCCH set to 'sfnSchemeA' and there is no TCI codepoint with two TCI states in the activation command and the CORESET with the lowest ID in the latest slot is indicated with two TCI states, the UE may assume that the DM-RS ports of PDSCH of a serving cell are quasi co-located with the RS(s) with respect to the QCL parameter(s) associated with the first TCI state of two TCI states indicated for the CORESET. In this case, if the qcl-Type is set to 'typeD' of the PDSCH DM-RS is different from that of the PDCCH DM-RS with which they overlap in at least one symbol, the UE is expected to prioritize the reception of PDCCH associated with that CORESET with single active TCI state. This also applies to the intra-band CA case (when PDSCH and the CORESET are in different component carriers).\n-\tIn all cases above, if none of configured TCI states for the serving cell of scheduled PDSCH is configured with qcl-Type set to 'typeD', the UE shall obtain the other QCL assumptions from the indicated TCI state(s) for its scheduled PDSCH irrespective of the time offset between the reception of the DL DCI and the corresponding PDSCH.\nIndependent of the configuration of tci-PresentInDCI and tci-PresentDCI-1-2 in RRC connected mode, if the UE is provided dl-OrJointTCI-StateList-r17, and if the offset between the reception of the DL DCI and the corresponding PDSCH is less than the threshold timeDurationForQCL and at least one configured TCI state for the serving cell of scheduled PDSCH contains qcl-Type set to 'typeD', regardless of configuration of followUnifiedTCI-State,\n-\tif the indicated TCI state is associated with the PCI of the serving cell, the indicated TCI state is applied to PDSCH reception.\n-\tif the indicated TCI state is associated with a PCI different from the serving cell, the UE may assume that the DM-RS ports of PDSCH(s) of a serving cell are quasi co-located with the RS(s) with respect to the QCL parameter(s) used for PDCCH quasi co-location indication of the CORESET associated with a monitored search space with the lowest controlResourceSetId in the latest slot in which one or more CORESETs within the active BWP of the serving cell are monitored by the UE. In the CA case, if the 'QCL-TypeD' of the PDSCH DM-RSs from respective CCs in a band are different in a slot, the QCL-TypeD assumption of the PDSCH DM-RS in the CC with lowest CC ID in the band is applied to all the PDSCH DM-RSs in the CCs in the band. In this case, if the qcl-Type is set to 'typeD' of the PDSCH DM-RS is different from that of the PDCCH DM-RS with which they overlap in at least one symbol, the UE is expected to prioritize the reception of PDCCH associated with that CORESET. This also applies to the intra-band CA case (when PDSCH and the CORESET are in different component carriers).\nIf the PDCCH carrying the scheduling DCI is received on one component carrier, and a PDSCH scheduled by that DCI is on another component carrier:\n-\tThe timeDurationForQCL is determined based on the subcarrier spacing of the scheduled PDSCH. If \u00b5PDCCH < \u00b5PDSCH an additional timing delay  is added to the timeDurationForQCL, where d is defined in 5.2.1.5.1a-1, otherwise d is zero;\n-\tWhen the UE is configured with enableDefaultBeamForCCS, if the offset between the reception of the DL DCI and the corresponding PDSCH is less than the threshold timeDurationForQCL, or if the DL DCI does not have the TCI field present, the UE obtains its QCL assumption for the scheduled PDSCH from the activated TCI state with the lowest ID applicable to PDSCH in the active BWP of the scheduled cell.\nA UE that has indicated a capability beamCorrespondenceWithoutUL-BeamSweeping set to 'supported', as described in [13, TS 38.306], can determine a spatial domain filter to be used while performing the applicable channel access procedures described in [16, TS 37.213] prior to a UL transmission on the channel as follows:\n-\tif UE is indicated with an SRI corresponding to the UL transmission, the UE may use a spatial domain filter that is same as the spatial domain transmission filter associated with the indicated SRI,\n-\tif UE is configured with SRS-spatialRelationInfo for the UL transmission, the UE may use a spatial domain filter that is same as the spatial domain filter associated with referenceSignal in the corresponding SRS-spatialRelationInfo,\n-\tif UE is configured with TCI-State in dl-OrJointTCI-StateList or TCI-UL-State in ul-TCI-StateList, the UE may use a spatial domain filter that is same as the spatial domain receive filter the UE may use to receive the DL reference signal associated with the indicated TCI state.\nWhen the PDCCH reception includes two PDCCH from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the purpose of determining the time offset between the reception of the DL DCI and the corresponding PDSCH, the PDCCH candidate that ends later in time is used. When the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the configuration of tci-PresentInDCI or tci-PresentDCI-1-2, the UE expects the same configuration in the first and second CORESETs associated with the two PDCCH candidates; and if the PDSCH is scheduled by a DCI format not having the TCI field present and if the scheduling offset is equal to or larger than timeDurationForQCL, if applicable, PDSCH QCL assumption is based on the CORESET with lower ID among the first and second CORESETs associated with the two PDCCH candidates. \nFor a periodic CSI-RS resource in an NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info, the UE shall expect that a TCI-State indicates one of the following quasi co-location type(s):\n-\t'typeC' with an SS/PBCH block and, when applicable, 'typeD' with the same SS/PBCH block where SS/PBCH block may have a PCI different from the PCI of the serving cell. The UE can assume center frequency, SCS, SFN offset are the same for SS/PBCH block from the serving cell and SS/PBCH block having a PCI different from the serving cell, or\n-\t'typeC' with an SS/PBCH block and, when applicable,'typeD' with a CSI-RS resource in an NZP-CSI-RS-ResourceSet configured with higher layer parameter repetition, where SS/PBCH block may have a PCI different from the PCI of the serving cell. The UE can assume center frequency, SCS, SFN offset are the same for SS/PBCH block from the serving cell and SS/PBCH block having a PCI different from the serving cell.\nFor periodic/semi-persistent CSI-RS, if the UE is configured with dl-OrJointTCI-StateList, the UE can assume that the indicated TCI-State is not applied.\nFor an aperiodic CSI-RS resource in an NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info, the UE shall expect that a TCI-State indicates qcl-Type set to 'typeA' with a periodic CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info and, when applicable, qcl-Type set to 'typeD' with the same periodic CSI-RS resource.\nFor a CSI-RS resource in an NZP-CSI-RS-ResourceSet configured without higher layer parameter trs-Info and without the higher layer parameter repetition, the UE shall expect that a TCI-State indicates one of the following quasi co-location type(s): \n-\t'typeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info and, when applicable, 'typeD' with the same CSI-RS resource, or\n-\t'typeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info and, when applicable, 'typeD' with an SS/PBCH block, where SS/PBCH block may have a PCI different from the PCI of the serving cell. The UE can assume center frequency, SCS, SFN offset are the same for SS/PBCH block from the serving cell and SS/PBCH block having a PCI different from the serving cell, or\n-\t'typeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info and, when applicable, 'typeD' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter repetition, or\n-\t'typeB' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info when 'typeD' is not applicable.\nFor a CSI-RS resource in an NZP-CSI-RS-ResourceSet configured with higher layer parameter repetition, the UE shall expect that a TCI-State indicates one of the following quasi co-location type(s):\n-\t'typeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info and, when applicable, 'typeD' with the same CSI-RS resource, or\n-\t'typeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info and, when applicable, 'typeD' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter repetition, or\n-\t'typeC' with an SS/PBCH block and, when applicable, 'typeD' with the same SS/PBCH block, the reference RS may additionally be an SS/PBCH block having a PCI different from the PCI of the serving cell. The UE can assume center frequency, SCS, SFN offset are the same for\u00a0SS/PBCH block from\u00a0the serving cell and SS/PBCH block\u00a0having a PCI different from the serving cell.\nFor the DM-RS of PDCCH, if the UE is not configured with dl-OrJointTCI-StateList, the UE shall expect that a TCI-State indicates one of the following quasi co-location type(s):\n-\t'typeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info and, when applicable, 'typeD' with the same CSI-RS resource, or\n-\t'typeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info and, when applicable, 'typeD' with a CSI-RS resource in an NZP-CSI-RS-ResourceSet configured with higher layer parameter repetition, or\n-\t'typeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured without higher layer parameter trs-Info and without higher layer parameter repetition and, when applicable, 'typeD' with the same CSI-RS resource.\nWhen a UE is configured with sfnSchemePdcch set to 'sfnSchemeA', and CORESET is activated with two TCI states, the UE shall assume that the DM-RS port(s)of the PDCCH in the CORESET is quasi co-located with the DL-RSs of the two TCI states. When a UE is configured with sfnSchemePdcch set to 'sfnSchemeB', and a CORESET is activated with two TCI states, the UE shall assume that the DM-RS port(s)of the PDCCH is quasi co-located with the DL-RSs of the two TCI states except for quasi co-location parameters {Doppler shift, Doppler spread} of the second indicated TCI state.\nWhen a UE is configured by higher layer parameter cjtSchemePDSCH and dl-OrJointTCI-StateList and is indicated with two TCI-States applied for PDSCH reception and reports [support for two joint TCI states for PDSCH-CJT]:\n-\tif the UE is configured with cjtSchemeA, the UE assumes that PDSCH DM-RS port(s) are QCLed with the DL RSs of both indicated TCI-States with respect to QCL-TypeA. \n-\tif the UE is configured with cjtSchemeB, the UE assumes that PDSCH DM-RS port(s) are QCLed with the DL RSs of both indicated TCI-States with respect to QCL-TypeA except for QCL parameters {Doppler shift, Doppler spread} of the second indicated joint TCI state.\nFor the DM-RS of PDSCH, if the UE is not configured with dl-OrJointTCI-StateList, the UE shall expect that a TCI-State indicates one of the following quasi co-location type(s):\n-\t'typeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info and, when applicable, 'typeD' with the same CSI-RS resource, or\n-\t'typeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info and, when applicable, 'typeD' with a CSI-RS resource in an NZP-CSI-RS-ResourceSet configured with higher layer parameter repetition,or\n-\ttypeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured without higher layer parameter trs-Info and without higher layer parameter repetition and, when applicable, 'typeD' with the same CSI-RS resource.\nFor the DM-RS of PDCCH, if the UE is configured with dl-OrJointTCI-StateList, the UE shall expect that an indicated TCI-State indicates one of the following quasi co-location type(s):\n-\t'typeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info and, when applicable, 'typeD' with the same CSI-RS resource, or\n-\t'typeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info and, when applicable, 'typeD' with a CSI-RS resource in an NZP-CSI-RS-ResourceSet configured with higher layer parameter repetition.\nFor the DM-RS of PDSCH, if the UE is configured with dl-OrJointTCI-StateList, the UE shall expect that an indicated TCI-State indicates one of the following quasi co-location type(s):\n-\t'typeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info and, when applicable, 'typeD' with the same CSI-RS resource, or\n-\t'typeA' with a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info and, when applicable, 'typeD' with a CSI-RS resource in an NZP-CSI-RS-ResourceSet configured with higher layer parameter repetition.\nWhen a UE is configured with sfnSchemePDSCH set to 'sfnSchemeA', and the UE is indicated with two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication' in a DCI scheduling a PDSCH, the UE shall assume that the DM-RS port(s)of the PDSCH is quasi co-located with the DL-RSs of the two TCI states. When a UE is configured with sfnSchemePDSCH set to 'sfnSchemeB', and the UE is indicated with two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication' in a DCI scheduling a PDSCH, the UE shall assume that the DM-RS port(s)of the PDSCH is quasi co-located with the DL-RSs of the two TCI states except for quasi co-location parameters {Doppler shift, Doppler spread} of the second indicated TCI state.\nWhen a UE is configured with dl-OrJointTCI-StateList or TCI-UL-State and is configured by higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet, an indicated TCI state is specific to a coresetPoolIndex value, when it is indicated by the DCI field 'Transmission Configuration Indication' in DCI format 1_1/1_2 associated with the coresetPoolIndex value.\nWhen a UE is configured with dl-OrJointTCI-StateList and is having two indicated TCI-states, if the UE does not report its capability of [two default beams for S-DCI based MTRP] in frequency range 2 and when the offset between the reception of the scheduling/activation DCI format 1_0/1_1/1_2 and the scheduled or activated PDSCH reception is less than [timeDurationForQCL] in frequency range 2, the UE shall apply the first indicated TCI-State to the scheduled or activated PDSCH reception.\nWhen a UE is configured with dl-OrJointTCI-StateList, is configured by higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet, if the UE does not report its capability of [default beam per coresetPoolIndex for M-DCI based MTRP] in frequency range 2\n-\twhen the offset between the reception of the scheduling/activation DCI format 1_0/1_1/1_2 in a CORESET associated with coresetPoolIndex value 0 and the scheduled or activated PDSCH reception is less than [timeDurationForQCL] in frequency range 2, the UE shall apply the indicated joint/DL TCI state specific to coresetPoolIndex value 0 to the scheduled or activated PDSCH reception.\n-\tthe UE does not expect that the offset between reception of the scheduling/activation DCI format 1_0/1_1/1_2 in a CORESET associated with coresetPoolIndex value 1 and scheduled or activated PDSCH reception is less than [timeDurationForQCL] in frequency range 2.\nWhen a UE is configured with dl-OrJointTCI-StateList and is having two indicated TCI-states:\n-\tRegardless of the offset between the reception of the scheduling DCI format 1_0/1_1/1_2 and the scheduled/activated PDSCH reception, if the UE is in frequency range 1, or the UE reports its capability of [two default beams for S-DCI based MTRP] in frequency range 2, or\n-\tIf the UE does not report its capability of [two default beams for S-DCI based MTRP]in frequency range 2 and if the scheduling offset between the reception of the scheduling DCI format 1_0/1_1/1_2 and the scheduled/activated PDSCH reception is equal to or larger than [timeDurationForQCL]\n-\tThe UE can be configured by higher layer parameter applyIndicatedTCIState to indicate whether the first, the second, or both of the indicated TCI-state(s) is/are applied to PDSCH reception scheduled or activated by DCI format 1_0. The UE can be configured with applyIndicatedTCIState with value both only when the UE is configured with cjtSchemePDSCH and the UE reports [support for two joint TCI states for PDSCH-CJT] or the UE is configured with sfnSchemePdsch. In that case, the UE shall apply both indicated TCI-states to PDSCH reception scheduled or activated by DCI format 1_0 on a search space other than Type0/0A/2 CSS on CORESET#0. \n-\tIf the UE is not configured with applyIndicatedTCIState, the first indicated TCI-state is applied to PDSCH reception scheduled or activated by DCI format 1_0.\n-\tWhen the UE is configured with tciSelection-PresentInDCI jointly for both DCI formats 1_1 and 1_2 in the same DL BWP, and when the UE receives a DCI format 1_1/1_2 that schedules or activates PDSCH reception, the UE shall determine the indicated joint/DL TCI state(s) for the PDSCH reception according to the following:\n-\tIf the DCI format 1_1/1_2 indicates codepoint \"00\" for the [TCI selection field], the UE shall apply the first one of two indicated joint/DL TCI states to all PDSCH DM-RS port(s) of corresponding PDSCH transmission occasion(s) scheduled or activated by the DCI format 1_1/1_2.\n-\tIf the DCI format 1_1/1_2 indicates codepoint \"01\" for the [TCI selection field], the UE shall apply the second one of two indicated joint/DL TCI states to all PDSCH DM-RS port(s) of corresponding PDSCH transmission occasion(s) scheduled or activated by the DCI format 1_1/1_2.\n-\tIf the DCI format 1_1/1_2 indicates codepoint \"10\" for the [TCI selection field], the UE shall apply both indicated joint/DL TCI states to the PDSCH reception scheduled or activated by the DCI format 1_1/1_2.\n-\tIf the UE is not configured with tciSelection-PresentInDCI and when the UE receives a DCI format 1_1/1_2 that schedules/activates PDSCH reception, the UE shall apply both indicated TCI-States to the scheduled or activated PDSCH reception\n5.1.6\tUE procedure for receiving reference signals\n5.1.6.1\tCSI-RS reception procedure\nThe CSI-RS defined in Clause 7.4.1.5 of [4, TS 38.211], may be used for time/frequency tracking, CSI computation, L1-RSRP computation, L1-SINR computation, mobility, and tracking during fast SCell activation.\nFor a CSI-RS resource associated with a NZP-CSI-RS-ResourceSet with the higher layer parameter repetition set to 'on', the UE shall not expect to be configured with CSI-RS over the symbols during which the UE is also configured to monitor the CORESET, while for other NZP-CSI-RS-ResourceSet configurations, if the UE is configured with a CSI-RS resource and a search space set associated with a CORESET in the same OFDM symbol(s), the UE may assume that the CSI-RS and a PDCCH DM-RS transmitted in all the search space sets associated with CORESET are quasi co-located with 'typeD', if 'typeD' is applicable. If the CORESET is activated with two TCI states, UE may assume that the first TCI state of the CORESET as the default QCL assumption for the CSI-RS. This also applies to the case when CSI-RS and the CORESET are in different intra-band component carriers, if 'typeD' is applicable. Furthermore, the UE shall not expect to be configured with the CSI-RS in PRBs that overlap those of the CORESET in the OFDM symbols occupied by the search space set(s).\nThe UE is not expected to receive CSI-RS and SIB1 message in the overlapping PRBs in the OFDM symbols where SIB1 is transmitted. \nIf the UE is configured with DRX, \n-\tif  the UE is configured to monitor DCI format 2_6 and configured by higher layer parameter ps-TransmitOtherPeriodicCSI to report CSI with the higher layer parameter reportConfigType set to 'periodic' and reportQuantity set to quantities other than 'cri-RSRP' and 'ssb-Index-RSRP' when drx-onDurationTimer in DRX-Config is not started, the most recent CSI measurement occasion occurs in DRX active time or during the time duration indicated by drx-onDurationTimer in DRX-Config also outside DRX active time for CSI to be reported;\n-\tif the UE is configured to monitor DCI format 2_6 and configured by higher layer parameter ps-TransmitPeriodicL1-RSRP to report L1-RSRP with the higher layer parameter reportConfigType set to 'periodic' and reportQuantity set to cri-RSRP when drx-onDurationTimer in DRX-Config is not started, the most recent CSI measurement occasion occurs in DRX active time or during the time duration indicated by drx-onDurationTimer in DRX-Config also outside DRX active time for CSI to be reported;\n-\totherwise, the most recent CSI measurement occasion occurs in DRX active time for CSI to be reported.\nDuring non-active periods of cell DTX if cell DTX is activated for a serving cell, the UE is not expected to receive the periodic CSI-RS and semi-persistent CSI-RS on the serving cell configured in CSI report configuration in CSI-ReportConfig associated with the higher layer parameter reportQuantity comprising at least 'RI'. If the cell DTX is activated for a serving cell [10, TS 38.321], the most recent CSI measurement occasion of semi-persistent CSI-RS resource or periodic CSI-RS resource on the serving cell occurs in active periods of cell DTX for CSI report configured by CSI-ReportConfig associated with the higher layer parameter reportQuantity comprising at least 'RI'.\n5.1.6.1.1\tCSI-RS for tracking\nA UE in RRC connected mode is expected to receive the higher layer UE specific configuration of a NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info.\nFor a NZP-CSI-RS-ResourceSet configured with the higher layer parameter trs-Info, the UE shall assume the antenna port with the same port index of the configured NZP CSI-RS resources in the NZP-CSI-RS-ResourceSet is the same. \n-\tFor frequency range 1, the UE may be configured with one or more NZP CSI-RS set(s), where a NZP-CSI-RS-ResourceSet consists of four periodic NZP CSI-RS resources in two consecutive slots with two periodic NZP CSI-RS resources in each slot. If no two consecutive slots are indicated as downlink slots by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigDedicated, then the UE may be configured with one or more NZP CSI-RS set(s), where a NZP-CSI-RS-ResourceSet consists of two periodic NZP CSI-RS resources in one slot. \n-\tFor frequency range 2 the UE may be configured with one or more NZP CSI-RS set(s), where a NZP-CSI-RS-ResourceSet consists of two periodic CSI-RS resources in one slot or with a NZP-CSI-RS-ResourceSet of four periodic NZP CSI-RS resources in two consecutive slots with two periodic NZP CSI-RS resources in each slot. \nA UE configured with NZP-CSI-RS-ResourceSet(s) configured with higher layer parameter trs-Info may have the CSI-RS resources configured as:\n-\tPeriodic, with the CSI-RS resources in the NZP-CSI-RS-ResourceSet configured with same periodicity, bandwidth and subcarrier location.\n-\tPeriodic CSI-RS resource in one set and aperiodic CSI-RS resources in a second set, with the aperiodic CSI-RS and periodic CSI-RS resource having the same bandwidth (with same RB location) and the aperiodic CSI-RS being configured with qcl-Type set to 'typeA' and 'typeD', where applicable, with the periodic CSI-RS resources. For frequency range 2, the UE does not expect that the scheduling offset between the last symbol of the PDCCH carrying the triggering DCI and the first symbol of the aperiodic CSI-RS resources is smaller than beamSwitchTiming + d  in CSI-RS symbols, where beamSwitchTiming is UE reported value defined in [13, TS 38.306], the reported value is one of the values of {14, 28, 48}, and the beam switching timing delay d is defined in Table 5.2.1.5.1a-1 if  \u00b5PDCCH < \u00b5CSIRS , else d is zero. The UE shall expect that the periodic CSI-RS resource set and aperiodic CSI-RS resource set are configured with the same number of CSI-RS resources and with the same number of CSI-RS resources in a slot. For the aperiodic CSI-RS resource set if triggered, and if the associated periodic CSI-RS resource set is configured with four periodic CSI-RS resources with two consecutive slots with two periodic CSI-RS resources in each slot, the higher layer parameter aperiodicTriggeringOffset indicates the triggering offset for the first slot for the first two CSI-RS resources in the set.\nA UE does not expect to be configured with a CSI-ReportConfig that is linked to a CSI-ResourceConfig containing an NZP-CSI-RS-ResourceSet configured with trs-Info and with the CSI-ReportConfig configured with the higher layer parameter timeRestrictionForChannelMeasurements set to 'configured'.\nA UE does not expect to be configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to other than 'none' for aperiodic NZP CSI-RS resource set configured with trs-Info.\nA UE does not expect to be configured with a CSI-ReportConfig for periodic NZP CSI-RS resource set configured with trs-Info, except for reportQuantity set to 'tdcp'.\nA UE does not expect to be configured with a NZP-CSI-RS-ResourceSet configured both with trs-Info and repetition.\nEach CSI-RS resource, defined in Clause 7.4.1.5.3 of [4, TS 38.211], is configured by the higher layer parameter NZP-CSI-RS-Resource with the following restrictions:\n-\tthe time-domain locations of the two CSI-RS resources in a slot, or of the four CSI-RS resources in two consecutive slots (which are the same across two consecutive slots), as defined by higher layer parameter CSI-RS-resourceMapping, is given by one of\n-\t, , or for frequency range 1 and frequency range 2,\n-\t, , , , ,  or  for frequency range 2.\n-\ta single port CSI-RS resource with density  given by Table 7.4.1.5.3-1 from [4, TS 38.211] and higher layer parameter density configured by CSI-RS-ResourceMapping.\n-\tif carrier , ,  and the carrier is configured in paired spectrum, the bandwidth of the CSI-RS resource, as given by the higher layer parameter freqBand configured by CSI-RS-ResourceMapping, is X resource blocks, where  resource blocks if the UE indicates trs-AddBW-Set1 for the trs-AdditionalBandwidth capability for CSI-RS for tracking or addBW-Set1 for the aperiodicCSI-RS-AdditionalBandwidth capability for aperiodic CSI-RS for fast SCell activation and  if the UE indicates trs-AddBW-Set2 for the AdditionalBandwidth capability for CSI-RS for tracking or addBW-Set2 for the aperiodicCSI-RS-AdditionalBandwidth capability for aperiodic CSI-RS for fast SCell activation; in these cases, if the UE is configured with CSI-RS comprising X<52 resource blocks, the UE does not expect that the total number of PRBs allocated for DL transmissions but not overlapped with the PRBs carrying CSI-RS for tracking is more than 4, where all CSI-RS resource configurations shall span the same set of resource blocks; otherwise, the bandwidth of the CSI-RS resource, as given by the higher layer parameter freqBand configured by CSI-RS-ResourceMapping, is the minimum of 52 and  resource blocks, or is equal to  resource blocks. For operation with shared spectrum channel access in FR1, freqBand configured by CSI-RS-ResourceMapping, is the minimum of 48 and  resource blocks, or is equal to  resource blocks.\n-\tthe UE is not expected to be configured with the periodicity of  slots if the bandwidth of CSI-RS resource is larger than 52 resource blocks.\n-\tthe periodicity and slot offset for periodic NZP CSI-RS resources, as given by the higher layer parameter periodicityAndOffset configured by NZP-CSI-RS-Resource, is one of slots where 10, 20, 40, or 80 and where \u00b5 is defined in Clause 4.3 of [4, TS 38.211]. \n-\tsame powerControlOffset and powerControlOffsetSS given by NZP-CSI-RS-Resource value across all resources.\nA UE in RRC_IDLE or RRC_INACTIVE can receive a higher layer configuration of TRS occasions via a trs-ResourceSetConfig. \n-\tFor frequency range 1, the UE may be configured with one or more TRS resource set(s), where each TRS resource set configured by a TRS-ResourceSet consists of four periodic NZP CSI-RS resources in two consecutive slots with two periodic NZP CSI-RS resources in each slot. If no two consecutive slots are indicated as downlink slots by tdd-UL-DL-ConfigurationCommon, then the UE may be configured with one or more TRS resource set(s), where a TRS-ResourceSet consists of two periodic NZP CSI-RS resources in one slot.\n-\tFor frequency range 2 the UE may be configured with one or more TRS resource set(s), where each TRS resource set configured by a TRS-ResourceSet consists of two periodic NZP CSI-RS resources in one slot or by a TRS-ResourceSet of four periodic NZP CSI-RS resources in two consecutive slots with two periodic NZP CSI-RS resources in each slot. \nEach NZP CSI-RS resource, defined in Clause 7.4.1.5.3 of [4, TS 38.211], is configured by the higher layer parameter TRS-ResourceSet with the following restrictions for a UE in RRC_IDLE or RRC_INACTIVE:\n-\tthe number of periodic NZP CSI-RS resources configured by a TRS-ResourceSet is given by nrofResources\n-\tthe time-domain locations of the two CSI-RS resources in a slot, or of the four CSI-RS resources in two consecutive slots (which are the same across two consecutive slots), is one of\n-\t, , or for frequency range 1 and frequency range 2,\n-\t, , , , ,  or  for frequency range 2.\n-\twhere the first symbol location in a slot is indicated by firstOFDMSymbolInTimeDomain in the TRS-ResourceSet and the second symbol location in a slot is firstOFDMSymbolInTimeDomain + 4\n-\ta single port CSI-RS resource with density  given by Table 7.4.1.5.3-1 from [4, TS 38.211].\n-\tthe bandwidth and the frequency location of the NZP CSI-RS resource, is given by the higher layer parameter nrofRBs, startingRB and frequencyDomainAllocation in a TRS-ResourceSet and applies to all resources in a TRS-ResourceSet. Bandwidth, nrofRBs, and the initial CRB index, startingRB, of the NZP CSI-RS resource configured by TRS-ResourceSet are not restricted by initial DL BWP.\n-\tUE is not required to receive TRS occasions outside the initial DL BWP.\n-\tthe periodicity for periodic NZP CSI-RS resources, is given by the higher layer parameter periodicityAndOffset configured by a TRS-ResourceSet, is one of slots where 10, 20, 40, or 80 and where \u00b5 is defined in Clause 4.3 of [4, TS 38.211], applies to all resources in a TRS-ResourceSet. The slot offset given by the higher layer parameter periodicityAndOffset configured by a TRS-ResourceSet provides the location of the first slot containing the periodic NZP CSI-RS resources configured by by a TRS-ResourceSet.\n-\tthe UE does not expect the TRS-ResourceSet to be configured with the periodicity of  slots if the bandwidth of NZP CSI-RS resource is larger than 52 resource blocks.\n-\tthe UE may assume the sub-carrier spacing of the NZP CSI-RS resources configured by TRS-ResourceSet to be same as the sub-carrier spacing of the initial DL BWP.\n-\tpowerControlOffsetSS given by a TRS-ResourceSet applies to all resources in a TRS-ResourceSet.\n-\tthe QCL information for periodic NZP CSI-RS resources, is given by the higher layer parameter ssb-Index configured by a TRS-ResourceSet, is a SS/PBCH block, applies to all resources in a TRS-ResourceSet.\n-\tOne or more scrambling IDs according to scramblingID-Info where if a single scramblingIDforCommon is configured, it applies to all NZP-CSI-RS resources in the resource set, otherwise, each NZP-CSI-RS resource is provided with a scrambling IDs according to scramblingIDperResourceListWith2 or scramblingIDperResourceListWith4.\n-\tthe UE may assume the following quasi co-location type(s):\n-\t'typeC' with an SS/PBCH block and, when applicable, 'typeD' with the same SS/PBCH block.\nFor each TRS-ResourceSet the index of the associated bit in TRS availability indication field [5, TS 38.212], is given by the higher layer parameter indBitID.\n5.1.6.1.1.1\tAperiodic CSI-RS for tracking for fast SCell activation\nA UE can be configured with aperiodic CSI-RS resources for tracking for an SCell for fast SCell activation using NZP-CSI-RS-ResourceSet(s) with the higher layer parameter scellActivationRS-ConfigToAddModList, with the QCL relation, provided by higher layer parameter qcl-Info given by SCellActivationRS-Config as with aperiodic CSI-RS for tracking in clause 5.1.6.1.1.\nEach CSI-RS resource, defined in clause 7.4.1.5.3 of [4, TS 38.211], for fast SCell activation is configured by the higher layer parameter NZP-CSI-RS-Resource with the same restrictions as defined for CSI-RS for tracking in clause 5.1.6.1.1.\n5.1.6.1.2\tCSI-RS for L1-RSRP and L1-SINR computation\nIf a UE is configured with a NZP-CSI-RS-ResourceSet configured with the higher layer parameter repetition set to 'on', the UE may assume that the CSI-RS resources, described in Clause 5.2.2.3.1, within the NZP-CSI-RS-ResourceSet are transmitted with the same downlink spatial domain transmission filter, where the CSI-RS resources in the NZP-CSI-RS-ResourceSet are transmitted in different OFDM symbols. If repetition is set to 'off', the UE shall not assume that the CSI-RS resources within the NZP-CSI-RS-ResourceSet are transmitted with the same downlink spatial domain transmission filter.\nIf the UE is configured with a CSI-ReportConfig with reportQuantity set to 'cri-RSRP', 'cri-SINR' or 'none' and if the CSI-ResourceConfig for channel measurement (higher layer parameter resourcesForChannelMeasurement) contains a NZP-CSI-RS-ResourceSet that is configured with the higher layer parameter repetition and without the higher layer parameter trs-Info, the UE can only be configured with the same number (1 or 2) of ports with the higher layer parameter nrofPorts for all CSI-RS resources within the set. If the UE is configured with the CSI-RS resource in the same OFDM symbol(s) as an SS/PBCH block, the UE may assume that the CSI-RS and the SS/PBCH block are quasi co-located with 'typeD' if 'typeD' is applicable. Furthermore, the UE shall not expect to be configured with the CSI-RS in PRBs that overlap with those of the SS/PBCH block, and the UE shall expect that the same subcarrier spacing is used for both the CSI-RS and the SS/PBCH block.\n5.1.6.1.3\tCSI-RS for mobility\nIf a UE is configured with the higher layer parameter CSI-RS-Resource-Mobility and the higher layer parameter associatedSSB is not configured, the UE shall perform measurements based on CSI-RS-Resource-Mobility and the UE may base the timing of the CSI-RS resource on the timing of the serving cell.\nIf a UE is configured with the higher layer parameters CSI-RS-Resource-Mobility and associatedSSB, the UE may base the timing of the CSI-RS resource on the timing of the cell given by the cellId of the CSI-RS resource configuration. Additionally, for a given CSI-RS resource, if the associated SS/PBCH block is configured but not detected by the UE, the UE is not required to monitor the corresponding CSI-RS resource. The higher layer parameter isQuasiColocated indicates whether the associated SS/PBCH block given by the associatedSSB and the CSI-RS resource(s) are quasi co-located with respect to 'typeD', when applicable. \nIf a UE is configured with the higher layer parameter CSI-RS-Resource-Mobility and with periodicity greater than 10 msec in paired spectrum, the UE may assume the absolute value of the time difference between radio frame i between any two cells, listed in the configuration with the higher layer parameter CSI-RS-CellMobility and with same refFreqCSI-RS, is less than 153600 Ts.\nIf the UE is configured with DRX, the UE is not required to perform measurement of CSI-RS resources other than during the active time for measurements based on CSI-RS-Resource-Mobility. When the UE is configured to monitor DCI format 2_6, the UE is not required to perform measurements other than during the active time and during the timer duration indicated by drx-onDurationTimer in DRX-Config also outside active time based on CSI-RS-Resource-Mobility. \nIf the UE is configured with DRX and DRX cycle in use is larger than 80 msec, the UE may not expect CSI-RS resources are available other than during the active time for measurements based on CSI-RS-Resource-Mobility. If the UE is configured with DRX and configured to monitor DCI format 2_6 and DRX cycle in use is larger than 80 msec, the UE may not expect that the CSI-RS resources are available other than during the active time and during the time duration indicated by drx-onDurationTimer in DRX-Config also outside active time for measurements based on CSI-RS-Resource-Mobility. Otherwise, the UE may assume CSI-RS are available for measurements based on CSI-RS-Resource-Mobility.\nA UE configured with the higher layer parameters CSI-RS-Resource-Mobility may expect to be configured\n-\twith no more than 96 CSI-RS resources per higher layer parameter MeasObjectNR for UEs not supporting [increasedNumberofCSIRSPerMO-r16] when all CSI-RS resources configured by the same higher layer parameter MeasObjectNR have been configured with associatedSSB, or, \n-\twith no more than 192 CSI-RS resources per higher layer parameter MeasObjectNR for UEs supporting [increasedNumberofCSIRSPerMO-r16] when all CSI-RS resources configured by the same higher layer parameter MeasObjectNR have been configured with associatedSSB, or,\n -\twith no more than 64 CSI-RS resources per higher layer parameter MeasObjectNR when all CSI-RS resources have been configured without associatedSSB or when only some of the CSI-RS resources have been configured with associatedSSB by the same higher layer parameter MeasObjectNR\n-\tFor frequency range 1 the associatedSSB is optionally present for each CSI-RS resource.\n-\tFor frequency range 2 the associatedSSB is either present for all configured CSI-RS resources or not present for any configured CSI-RS resource per higher layer parameter MeasObjectNR. \nFor any CSI-RS resource configuration, the UE shall assume that the value for parameter cdm-Type is 'noCDM', and there is only one antenna port.\n5.1.6.2\tDM-RS reception procedure\nThe DM-RS reception procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 1_2, by applying the parameters of dmrs-DownlinkForPDSCH-MappingTypeA-DCI-1-2 and dmrs-DownlinkForPDSCH-MappingTypeB-DCI-1-2 instead of dmrs-DownlinkForPDSCH-MappingTypeA and dmrs-DownlinkForPDSCH-MappingTypeB. The DM-RS reception procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 1_3.\nThe DM-RS reception procedures for PDSCH scheduled by PDCCH with DCI format 1_1 described in this clause equally apply to PDSCH scheduled by PDCCH with DCI format 4_2, by applying the parameters of dmrs-DownlinkForPDSCH-MappingTypeA and dmrs-DownlinkForPDSCH-MappingTypeB in pdsch-ConfigMulticast instead of dmrs-DownlinkForPDSCH-MappingTypeA and dmrs-DownlinkForPDSCH-MappingTypeB in PDSCH-Config.\nWhen receiving PDSCH scheduled by DCI format 1_0, 4_0, or 4_1, or receiving PDSCH before dedicated higher layer configuration of any of the parameters dmrs-AdditionalPosition, maxLength and dmrs-Type, the UE shall assume that the PDSCH is not present in any symbol carrying DM-RS except for PDSCH with allocation duration of 2 symbols with PDSCH mapping type B (described in clause 7.4.1.1.2 of [4, TS 38.211]), and a single symbol front-loaded DM-RS of configuration type 1 on DM-RS port 1000 is transmitted, and that all the remaining orthogonal antenna ports are not associated with transmission of PDSCH to another UE and in addition\n-\tFor PDSCH with mapping type A and type B, the UE shall assume dmrs-AdditionalPosition='pos2' and up to two additional single-symbol DM-RS present in a slot according to the PDSCH duration indicated in the DCI as defined in Clause 7.4.1.1 of [4, TS 38.211], and\n-\tFor PDSCH with allocation duration of 2 symbols with mapping type B, the UE shall assume that the PDSCH is present in the symbol carrying DM-RS.\nWhen receiving PDSCH scheduled by DCI format 1_1 or 1_3 by PDCCH with CRC scrambled by C-RNTI, MCS-C-RNTI, or CS-RNTI or DCI format 4_2 by PDCCH with CRC scrambled by G-RNTI for multicast or G-CS-RNTI,\n-\tthe UE may be configured with the higher layer parameter dmrs-Type and/or dmrs-TypeEnh, and the configured DM-RS configuration type is used for receiving PDSCH in as defined in Clause 7.4.1.1 of [4, TS 38.211].\n-\tthe UE may be configured with the maximum number of front-loaded DM-RS symbols for PDSCH by higher layer parameter maxLength given by DMRS-DownlinkConfig..\n-\tif maxLength is set to 'len1', single-symbol DM-RS can be scheduled for the UE by DCI, and the UE can be configured with a number of additional DM-RS for PDSCH by higher layer parameter dmrs-AdditionalPosition, which can be set to 'pos0', 'pos1', 'pos2' or 'pos3'. \n-\tif maxLength is set to 'len2', both single-symbol DM-RS and double symbol DM-RS can be scheduled for the UE by DCI, and the UE can be configured with a number of additional DM-RS for PDSCH by higher layer parameter dmrs-AdditionalPosition, which can be set to 'pos0' or 'pos1'.\n-\tand the UE shall assume to receive additional DM-RS as specified in Table 7.4.1.1.2-3 and Table 7.4.1.1.2-4 as described in Clause 7.4.1.1.2 of [4, TS 38.211].\nFor the UE-specific reference signals generation as defined in Clause 7.4.1.1 of [4, TS 38.211], a UE can be configured by higher layers with one or two scrambling identity(s), i = 0,1 which are the same for both PDSCH mapping Type A and Type B.\nA UE may be scheduled with a number of DM-RS ports by the antenna port index in DCI format 1_1 as described in Clause 7.3.1.2 of [5, TS 38.212]. \nFor DM-RS configuration type 1, \n-\tif a UE is scheduled with one codeword and assigned with the antenna port mapping with indices of {2, 9, 10, 11 or 30} in Table 7.3.1.2.2-1 and Table 7.3.1.2.2-2 of Clause 7.3.1.2 of [5, TS 38.212], or\n-\tif a UE is scheduled with one codeword and assigned with the antenna port mapping with indices of {2, 9, 10, 11 or 12} in Table 7.3.1.2.2-1A and {2, 9, 10, 11, 30 or 31} in Table 7.3.1.2.2-2A of Clause 7.3.1.2 of [5, TS 38.212], or\n-\tif a UE is scheduled with two codewords, \nthe UE may assume that all the remaining orthogonal antenna ports are not associated with transmission of PDSCH to another UE.\nFor DM-RS configuration type 2, \n-\tif a UE is scheduled with one codeword and assigned with the antenna port mapping with indices of {2, 10 or 23} in Table 7.3.1.2.2-3 and Table 7.3.1.2.2-4 of Clause 7.3.1.2 of [5, TS38.212], or\n-\tif a UE is scheduled with one codeword and assigned with the antenna port mapping with indices of {2, 10, 23 or 24} in Table 7.3.1.2.2-3A and {2, 10, 23 or 58} in Table 7.3.1.2.2-4A of Clause 7.3.1.2 of [5, TS 38.212], or\n-\tif a UE is scheduled with two codewords, \nthe UE may assume that all the remaining orthogonal antenna ports are not associated with transmission of PDSCH to another UE.\nFor DM-RS configuration enhanced type 1,\n-\tif a UE is scheduled with one codeword and assigned with the antenna port mapping with indices of {9, 10, 11 and 27 when applicable} in Table 7.3.1.2.2-7 and Table 7.3.1.2.2-7A of Clause 7.3.1.2 of [5, TS 38.212], or\n-\tif a UE is scheduled with one codeword and assigned with the antenna port mapping with indices of {9, 10, 11, 39, 40, 41, 42, 43, 44, 45 and 66 when applicable} in Table 7.3.1.2.2-8 and Table 7.3.1.2.2-8A of Clause 7.3.1.2 of [5, TS 38.212], \nthe UE may assume that all the remaining orthogonal antenna ports of the CDM groups, from which the antenna ports are indicated to the UE, are not associated with transmission of PDSCH to another UE, or\n-\tif a UE is scheduled with two codewords, the UE may assume that all the remaining orthogonal antenna ports are not associated with transmission of PDSCH to another UE.\nFor DM-RS configuration enhanced type 2, \n-\tif a UE is scheduled with one codeword and assigned with the antenna port mapping with indices of {9, 10, 20, 21, 22, 23 and 54 when applicable} in Table 7.3.1.2.2-9 and Table 7.3.1.2.2-9A of Clause 7.3.1.2 of [5, TS38.212], or\n-\tif a UE is scheduled with one codeword and assigned with the antenna port mapping with indices of {9, 10, 20, 21, 22, 23, 72, 73, 74, 75, 76, 77 and 136 when applicable} in Table 7.3.1.2.2-10 and in Table 7.3.1.2.2-10A of Clause 7.3.1.2 of [5, TS 38.212], \nThe UE may assume that all the remaining orthogonal antenna ports of CDM groups, from which the antenna ports are indicated to the UE, are not associated with transmission of PDSCH to another UE, or\n-\tif a UE is scheduled with two codewords, the UE may assume that all the remaining orthogonal antenna ports are not associated with transmission of PDSCH to another UE.\nFor DM-RS configuration enhanced type 1, \n-\tif a UE is configured with the higher layer parameter repetitionScheme set to 'fdmSchemeA' or 'fdmSchemeB', and is indicated with two TCI states to be applied to the PDSCH, and DM-RS port(s) within one CDM group in the DCI field 'Antenna Port(s)',\n-\tif a UE is not indicating UE capability of [noSchedulingRestrictionForFDMSchemeA-r18] or [noSchedulingRestrictionForFDMSchemeB-r18], the UE shall assume that the number of consecutively scheduled PRBs for PDSCH for each TCI-state is even, and the offset of each set of consecutively scheduled PRB from common resource block 0 for PDSCH for each TCI-state is even number.\n-\totherwise,\n-\tif the UE is not indicating UE capability of [noSchedulingRestriction-r18], the UE shall assume the number of consecutively scheduled PRBs for PDSCH is even, and the offset of each set of consecutively scheduled PRB for PDSCH from common resource block 0 is even number.\nIf a UE receiving PDSCH scheduled by DCI format 1_2 is configured with the higher layer parameter phaseTrackingRS in dmrs-DownlinkForPDSCH-MappingTypeA-DCI-1-2  or dmrs-DownlinkForPDSCH-MappingTypeB-DCI-1-2 or a UE receiving PDSCH scheduled by DCI format 1_0, 1_1 or 1_3 is configured with the higher layer parameter phaseTrackingRS in dmrs-DownlinkForPDSCH-MappingTypeA or dmrs-DownlinkForPDSCH-MappingTypeB, the UE may assume that the following configurations are not occurring simultaneously for the received PDSCH:\n-\tany DM-RS ports among \n1004-1007 or 1006-1011 for DM-RS configurations type 1 and type 2, respectively or,\n1004-1007 or 1012-1015 for DM-RS configuration enhanced type 1 or,\n1006-1011 or 1018-1023 for DM-RS configuration enhanced type 2,\nare scheduled for the UE and the other UE(s) sharing the DM-RS REs on the same CDM group(s), and\n-\tPT-RS is transmitted to the UE.\nThe UE is not expected to simultaneously be configured with the maximum number of front-loaded DM-RS symbols for PDSCH by higher layer parameter maxLength being set equal to 'len2' and more than one additional DM-RS symbol as given by the higher layer parameter dmrs-AdditionalPosition. \nThe UE is not expected to assume co-scheduled UE(s) with different DM-RS configuration with respect to the actual number of front-loaded DM-RS symbol(s), the actual number of additional DM-RS, the DM-RS symbol locationas described in Clause 7.4.1.1 of [4, TS 38.211]. The UE configured with DM-RS configuration type 1 or enhanced type 1 is not expected to assume co-scheduled UE(s) with DM-RS configuration type 2 or enhanced type 2. The UE configured with DM-RS configuration type 2 or enhanced type 2 is not expected to assume co-scheduled UE(s) with DM-RS configuration type 1 or enhanced type 1.\nThe UE does not expect the precoding of the potential co-scheduled UE(s) in other DM-RS ports of the same CDM group to be different in the PRG-level grid configured to this UE with PRG =2 or 4.\nWhen the UE is configured with the higher layer parameter enhanced-dmrs-Type_r18 and indicated with at least one DM-RS ports 1008-1015 for enhanced Type 1 DM-RS or DM-RS ports 1012-1023 for enhanced Type 2 DM-RS, the UE does not expect that any co-scheduled UE(s) in the same CDM group is not configured with the higher layer- parameter enhanced-dmrs-Type_r18. When the UE is not configured with the higher layer parameter enhanced-dmrs-Type_18, the UE does not expect that any co-scheduled UE(s) in the same CDM group(s) is configured with the higher layer parameter enhanced-dmrs-Type_r18 and indicated with at least one of DMRS ports 1008-1015 for enhanced Type 1 DMRS or DMRS ports 1012-1023 for enhanced Type 2 DMRS.\nThe UE does not expect the resource allocation of the potential co-scheduled UE(s) in other DM-RS ports of the same CDM group to be misaligned in the PRG-level grid to this UE with PRG=2 or 4.\nWhen receiving PDSCH scheduled by DCI format 1_1, the UE shall assume that the CDM groups indicated in the configured index from Tables 7.3.1.2.2-1, 7.3.1.2.2-1A, 7.3.1.2.2-7, 7.3.1.2.2-7A, 7.3.1.2.2-2, 7.3.1.2.2-2A, 7.3.1.2.2-8, 7.3.1.2.2-8A, 7.3.1.2.2-3, 7.3.1.2.2-3A, 7.3.1.2.2-9, 7.3.1.2.2-9A, 7.3.1.2.2-4, 7.3.1.2.2-4A, 7.3.1.2.2-10, 7.3.1.2.2-10A of [5, TS. 38.212] contain potential co-scheduled downlink DM-RS and are not used for data transmission, where \"1\", \"2\" and \"3\" for the number of DM-RS CDM group(s) in Tables 7.3.1.2.2-1, 7.3.1.2.2-1A, 7.3.1.2.2-7, 7.3.1.2.2-7A, 7.3.1.2.2-2, 7.3.1.2.2-2A, 7.3.1.2.2-8, 7.3.1.2.2-8A, 7.3.1.2.2-3, 7.3.1.2.2-3A, 7.3.1.2.2-9, 7.3.1.2-9A, 7.3.1.2.2-4, 7.3.1.2.2-4A, 7.3.1.2.2-10, 7.3.1.2.2-10A of [5, TS. 38.212] correspond to CDM group 0, {0,1}, {0,1,2}, respectively.\nWhen receiving PDSCH scheduled by DCI format 1_0, 4_0, or 4_1, the UE shall assume the number of DM-RS CDM groups without data is 1 which corresponds to CDM group 0 for the case of PDSCH with allocation duration of 2 symbols, and the UE shall assume that the number of DM-RS CDM groups without data is 2 which corresponds to CDM group {0,1} for all other cases.\nThe UE is not expected to receive PDSCH scheduling DCI which indicates CDM group(s) with potential DM-RS ports which overlap with any configured CSI-RS resource(s) for that UE.\nIf the UE receives the DM-RS for PDSCH and an SS/PBCH block associated with the same PCI in the same OFDM symbol(s), then the UE may assume that the DM-RS and SS/PBCH block are quasi co-located with 'typeD', if 'typeD' is applicable. Furthermore, the UE shall not expect to receive DM-RS in resource elements that overlap with those of the SS/PBCH block associated with the same PCI as the DM-RS, and the UE can expect that the same or different subcarrier spacing is configured for the DM-RS and SS/PBCH block in a CC except for the case of 240 kHz where only different subcarrier spacing is supported. A DM-RS for PDSCH is said to be associated with an additional PCI if the indicated TCI state for the PDSCH is associated with the additional PCI, otherwise a DM-RS for PDSCH is associated with serving cell PCI.\nIf at least one TCI codepoint indicates two TCI states for a UE not configured with dl-OrJointTCI-StateList, or if the UE configured with dl-OrJointTCI-StateList is having two indicated TCI states and the UE receives the DM-RS for PDSCH and an SS/PBCH block in the same OFDM symbol(s), then the UE may assume that at least one DM-RS port for the PDSCH and SS/PBCH block are quasi co-located with 'QCL-TypeD', if 'QCL-TypeD' is applicable.\nIf the UE is configured by higher layer parameter PDCCH-Config that contains two different values of CORESETPoolIndex in different ControlResourceSets, and the UE receives the DM-RS for PDSCH(s) and an SS/PBCH block in the same OFDM symbol(s), then the UE may assume that at least one DM-RS port for the PDSCH(s) and SS/PBCH block are quasi co-located with 'QCL-TypeD', if 'QCL-TypeD' is applicable.\nIf a UE is configured by the higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet, the UE may be scheduled with fully or partially overlapping PDSCHs in the time and frequency domain by multiple PDCCHs with the following restrictions,\n-\tthe UE is not expected to assume different DM-RS configuration with respect to the actual number of front-loaded DM-RS symbol(s), the actual number of additional DM-RS symbol(s), the actual DM-RS symbol location, and DM-RS configuration type. \n-\tthe UE is not expected to assume DM-RS ports in a CDM group indicated by two TCI states. \nWhen a UE is not indicated with a DCI that DCI field 'Time domain resource assignment' indicating an entry which contains repetitionNumber in PDSCH-TimeDomainResourceAllocation, the UE is not configured with sfnSchemePDSCH and it is indicated with two TCI states to be applied to the PDSCH and indicated DM-RS port(s) within two CDM groups in the DCI field 'Antenna Port(s)', \n-\tthe first TCI state corresponds to the CDM group of the first antenna port indicated by the antenna port indication table, and the second TCI state corresponds to the other CDM group.\nIf a UE is configured with higher layer parameter dmrs-FD-OCC-DisabledForRank1-PDSCH and the UE is scheduled with PDSCH with single DM-RS port, the UE may assume that set of orthogonal DM-RS antenna ports from the same CDM group using different set of wf(k') codes are not associated with the transmission of PDSCH to another UE. If a UE is configured with higher layer parameter dmrs-TypeEnh, the UE does not expect to be configured with dmrs-FD-OCC-DisabledForRank1-PDSCH.\n5.1.6.3\tPT-RS reception procedure\nThe procedures on PT-RS reception described in this clause apply to a UE receiving PDSCH scheduled by DCI format 1_2 configured with the higher layer parameter phaseTrackingRS in dmrs-DownlinkForPDSCH-MappingTypeA-DCI-1-2 or dmrs-DownlinkForPDSCH-MappingTypeB-DCI-1-2 and to a UE receiving PDSCH scheduled by DCI format 1_0, 1_1 or 1_3 configured with the higher layer parameter phaseTrackingRS in dmrs-DownlinkForPDSCH-MappingTypeA or dmrs-DownlinkForPDSCH-MappingTypeB. The procedures on PT-RS reception described in this clause apply to a UE receiving PDSCH scheduled by DCI format 4_1 or 4_2 configured with the higher layer parameter phaseTrackingRS in dmrs-DownlinkForPDSCH-MappingTypeA or dmrs-DownlinkForPDSCH-MappingTypeB in pdsch-ConfigMulticast.\nA UE shall report the preferred MCS and bandwidth thresholds based on the UE capability at a given carrier frequency, for each subcarrier spacing applicable to data channel at this carrier frequency, assuming the MCS table with the maximum Modulation Order as it reported to support.\nIf a UE is configured with the higher layer parameter phaseTrackingRS in DMRS-DownlinkConfig,\n-\tthe higher layer parameters timeDensity and frequencyDensity in PTRS-DownlinkConfig indicate the threshold values ptrs-MCSi, i=1,2,3 and NRB,i , i=0,1, as shown in Table 5.1.6.3-1 and Table 5.1.6.3-2, respectively. \n-\tif either or both of the additional higher layer parameters timeDensity and frequencyDensity are configured, and the RNTI equals MCS-C-RNTI, C-RNTI or CS-RNTI, the UE shall assume the PT-RS antenna port' presence and pattern is a function of the corresponding scheduled MCS of the corresponding codeword and scheduled bandwidth in corresponding bandwidth part as shown in Table 5.1.6.3-1 and Table 5.1.6.3-2, \n-\tif the higher layer parameter timeDensity given by PTRS-DownlinkConfig is not configured, the UE shall assume LPT-RS = 1.\n-\tif the higher layer parameter frequencyDensity given by PTRS-DownlinkConfig is not configured, the UE shall assume KPT-RS = 2.\n-\totherwise, if neither of the additional higher layer parameters timeDensity and frequencyDensity are configured and the RNTI equals MCS-C-RNTI, C-RNTI or CS-RNTI, the UE shall assume the PT-RS is present with LPT-RS = 1, KPT-RS = 2, and the UE shall assume PT-RS is not present when\n-\tthe scheduled MCS from Table 5.1.3.1-1 is smaller than 10, or\n-\tthe scheduled MCS from Table 5.1.3.1-2 is smaller than 5, or \n-\tthe scheduled MCS from Table 5.1.3.1-3 is smaller than 15, or \n-\tthe scheduled MCS from Table 5.1.3.1-4 is smaller than 3, or\n-\tthe number of scheduled RBs is smaller than 3, or\n-\totherwise, if the RNTI equals RA-RNTI, [MSGB-RNTI], SI-RNTI, or P-RNTI, the UE shall assume PT-RS is not present \nTable 5.1.6.3-1: Time density of PT-RS as a function of scheduled MCS\n\nTable 5.1.6.3-2: Frequency density of PT-RS as a function of scheduled bandwidth\n\nIf a UE is not configured with the higher layer parameter phaseTrackingRS in DMRS-DownlinkConfig, the UE assumes PT-RS is not present. \nThe higher layer parameter PTRS-DownlinkConfig provides the parameters ptrs-MCSi, i=1,2,3 and with values in range 0-29 when MCS Table 5.1.3.1-1 or MCS Table 5.1.3.1-3 is used and 0-28 when MCS Table 5.1.3.1-2 is used, and 0-27 when MCS Table 5.1.3.1-4 is used, respectively. ptrs-MCS4 is not explicitly configured by higher layers but assumed 29 when MCS Table 5.1.3.1-1 or MCS Table 5.1.3.1-3 is used and 28 when MCS Table 5.1.3.1-2 is used and 27 when MCS Table 5.1.3.1-4 is used, respectively. The higher layer parameter frequencyDensity in PTRS-DownlinkConfig provides the parameters NRBi i=0,1 with values in range 1-276.\nIf the higher layer parameter PTRS-DownlinkConfig indicates that the time density thresholds ptrs-MCSi = ptrs-MCSi+1, then the time density LPT-RS of the associated row where both these thresholds appear in Table 5.1.6.3-1 is disabled. If the higher layer parameter PTRS-DownlinkConfig indicates that the frequency density thresholds NRBi = NRBi +1, then the frequency density KPTRS of the associated row where both these thresholds appear in Table 5.1.6.3-2 is disabled.\nIf either or both of the parameters PT-RS time density (LPT-RS) and PT-RS frequency density (KPT-RS), shown in Table 5.1.6.3-1 and Table 5.1.6.3-2, indicates that 'PT-RS not present', the UE shall assume that PT-RS is not present.\nWhen the UE is receiving a PDSCH with allocation duration of 2 symbols as defined in Clause 7.4.1.1.2 of [4, TS 38.211] and if LPT-RS is set to 2 or 4, the UE shall assume PT-RS is not transmitted. \nWhen the UE is receiving a PDSCH with allocation duration of 4 symbols and if LPT-RS is set to 4, the UE shall assume PT-RS is not transmitted.\nWhen a UE is receiving PDSCH for retransmission, if the UE is scheduled with an MCS index greater than V, where V=28 for MCS Table 5.1.3.1-1 and Table 5.1.3.1-3, and V=27 for MCS Table 5.1.3.1-2, and V=26 for MCS Table 5.1.3.1-4 respectively, the MCS for the PT-RS time-density determination is obtained from the DCI received for the same transport block in the initial transmission, which is smaller than or equal to V. \nThe DL DM-RS port(s) associated with a PT-RS port are assumed to be quasi co-located with respect to 'typeA' and 'typeD'. If a UE is scheduled with one codeword, the PT-RS antenna port is associated with the lowest indexed DM-RS antenna port among the DM-RS antenna ports assigned for the PDSCH.\nIf a UE is scheduled with two codewords, the PT-RS antenna port is associated with the lowest indexed DM-RS antenna port among the DM-RS antenna ports assigned for the codeword with the higher MCS. If the MCS indices of the two codewords are the same, the PT-RS antenna port is associated with the lowest indexed DM-RS antenna port assigned for codeword 0.\nWhen a UE is not indicated with a DCI that DCI field 'Time domain resource assignment' indicating an entry which contains repetitionNumber in PDSCH-TimeDomainResourceAllocation, and if the UE is configured with the higher layer parameter maxNrofPorts equal to n2, the UE is not configured with sfnSchemePDSCH and if the UE not configured with dl-OrJointTCI-StateList is indicated with two TCI states by the codepoints of the DCI field 'Transmission Configuration Indication' or when the UE configured with dl-OrJointTCI-StateList and having two indicated TCI States to be applied to PDSCH, and indicated DM-RS port(s) within two CDM groups in the DCI field 'Antenna Port(s)', the UE shall receive two PT-RS ports which are associated to the lowest indexed DM-RS port among the DM-RS ports corresponding to the first/second indicated TCI state, respectively. \nWhen a UE configured by the higher layer parameter repetitionScheme set to 'fdmSchemeA' or  'fdmSchemeB', and the UE not configured with dl-OrJointTCI-StateList is indicated with two TCI states in a codepoint of the DCI field 'Transmission Configuration Indication' or when the UE configured with dl-OrJointTCI-StateList and having two indicated TCI States to be applied to PDSCH, and indicated DM-RS port(s) within one CDM group in the DCI field 'Antenna Port(s)', the UE shall receive a single PT-RS port which is associated with the lowest indexed DM-RS antenna port among the DM-RS antenna ports assigned for the PDSCH, a PT-RS frequency density is determined by the number of PRBs associated to each TCI state, and a PT-RS resource element mapping is associated to the allocated PRBs for each TCI state.\n5.1.6.4\tSRS reception procedure for CLI\nThe SRS resources defined in Clause 6.4.1.4 of [4, TS 38.211] may be configured for SRS-RSRP measurement for CLI, as defined in Clause 5.1.19 of [7, TS 38.215]. The UE is not expected to measure SRS-RSRP with a subcarrier spacing other than the one configured for the active BWP confining the SRS resource. The UE is not expected to measure SRS-RSRP using the SRS-RSRP measurement resource which is not fully confined within the DL active BWP. The UE is not expected to measure more than 32 SRS resources, and the UE is not expected to receive more than 8 SRS resources in a slot.\n5.1.6.5\tPRS reception procedure\nThe UE can be configured with one or more DL PRS resource set configuration(s) as indicated by the higher layer parameters NR-DL-PRS-ResourceSet and NR-DL-PRS-Resource as defined by Clause 6.4.3 [17, TS 37.355]. Each DL PRS resource set consists of K\u22651 DL PRS resource(s) where each has an associated spatial transmission filter. The UE can be configured with one or more DL PRS positioning frequency layer configuration(s) as indicated by the higher layer parameter NR-DL-PRS-PositioningFrequencyLayer. A DL PRS positioning frequency layer is defined as a collection of DL PRS resource sets which have common parameters configured by NR-DL-PRS-PositioningFrequencyLayer.\nThe UE assumes that the following parameters for each DL PRS resource(s) are configured via higher layer parameters NR-DL-PRS-PositioningFrequencyLayer, NR-DL-PRS-ResourceSet and NR-DL-PRS-Resource.\nA DL PRS positioning frequency layer is configured by NR-DL-PRS-PositioningFrequencyLayer, consists of one or more DL PRS resource sets and it is defined by:\n-\tdl-PRS-SubcarrierSpacing defines the subcarrier spacing for the DL PRS resource. All DL PRS resources and DL PRS resource sets in the same DL PRS positioning frequency layer have the same value of dl-PRS-SubcarrierSpacing. The supported values of dl-PRS-SubcarrierSpacing are given in Table 4.2-1 of [4, TS38.211], excluding the values of 240kHz, 480 kHz, and 960 kHz.\n-\tdl-PRS-CyclicPrefix defines the cyclic prefix for the DL PRS resource. All DL PRS Resources and DL PRS Resource sets in the same DL PRS positioning frequency layer have the same value of dl-PRS-CyclicPrefix. The supported values of dl-PRS-CyclicPrefix are given in Table 4.2-1 of [4, TS38.211].\n-\tdl-PRS-PointA defines the absolute frequency of the reference resource block. Its lowest subcarrier is also known as Point A. All DL PRS resources belonging to the same DL PRS resource set have common Point A and all DL PRS resources sets belonging to the same DL PRS positioning frequency layer have a common Point A.\nThe UE expects that it will be configured with dl-PRS-ID each of which is defined such that it is associated with multiple DL PRS resource sets. The UE expects that one of these dl-PRS-ID along with a nr-DL-PRS-ResourceSetID and a nr-DL-PRS-ResourceID-r16 can be used to uniquely identify a DL PRS resource. \nThe UE may be configured by the network with nr-PhysCellID, nr-CellGlobalID, and nr-ARFCN [17, TS 37.355] associated with a dl-PRS-ID.\n-\tIf nr-PhysCellID or nr-CellGlobalID is provided, and if nr-PhysCellID, nr-CellGlobalID and nr-ARFCN associated with the dl-PRS-ID, if provided, are the same as the corresponding information of a serving cell, the UE may assume that the DL PRS is transmitted from the serving cell;\n-\tOtherwise, the UE may assume that the DL PRS is not transmitted from a serving cell.\nIf the UE assumes that the DL PRS is transmitted from a serving cell, and if the serving cell is the same as the serving cell defined by the SS/PBCH block, the UE may assume that the DL PRS and the SS/PBCH block are transmitted from the same serving cell.\nIf the UE assumes that the DL PRS is not transmitted from a serving cell, and if nr-PhysCellID is provided, and is the same as physical cell ID of the SS/PBCH block from a non-serving cell of the same band as the DL PRS, the UE may assume that the DL PRS and the SS/PBCH block are transmitted from the same non-serving cell.\nA DL PRS resource set is configured by NR-DL-PRS-ResourceSet, consists of one or more DL PRS resources and it is defined by:\n-\tnr-DL-PRS-ResourceSetID defines the identity of the DL PRS resource set configuration. \n-\tdl-PRS-Periodicity-and-ResourceSetSlotOffset defines the DL PRS resource periodicity and takes values slots, where for dl-PRS-SubcarrierSpacing=15, 30, 60 and 120 kHz respectively and the slot offset for DL PRS resource set with respect to SFN0 slot 0. All the DL PRS resources within one DL PRS resource set are configured with the same DL PRS resource periodicity. The UE does not expect that the product of DL PRS resource periodicity , the higher layer parameter dl-prs-MutingBitRepetitionFactor and the size of the bitmap of dl-PRS-MutingOption1 exceeds , where for dl-PRS-SubcarrierSpacing=15, 30, 60 and 120 kHz respectively.\n-\tdl-PRS-ResourceRepetitionFactor defines how many times each DL-PRS resource is repeated for a single instance of the DL-PRS resource set and takes values . All the DL PRS resources within one resource set have the same resource repetition factor.\n-\tdl-PRS-ResourceTimeGap defines the offset in number of slots between two repeated instances of a DL PRS resource with the same nr-DL-PRS-ResourceID within a single instance of the DL PRS resource set. The UE only expects to be configured with dl-PRS-ResourceTimeGap if dl-PRS-ResourceRepetitionFactor is configured with value greater than 1. The time duration spanned by one instance of a nr-DL-PRS-ResourceSet is not expected to exceed the configured value of DL PRS periodicity. All the DL PRS resources within one resource set have the same value of dl-PRS-ResourceTimeGap.\n-\tdl-PRS-MutingOption1 and dl-PRS-MutingOption2 define the time locations where the DL PRS resource is expected to not be transmitted for a DL PRS resource set. If dl-PRS-MutingOption1 is configured, each bit in the bitmap of dl-PRS-MutingOption1 corresponds to a configurable number provided by higher layer parameter dl-prs-MutingBitRepetitionFactor of consecutive instances of a DL PRS resource set where all the DL PRS resources within the set are muted for the instance that is indicated to be muted. The length of the bitmap can be {2, 4, 6, 8, 16, 32} bits. If dl-PRS-MutingOption2 is configured each bit in the bitmap of dl-PRS-MutingOption2 corresponds to a single repetition index for each of the DL PRS resources within each instance of a nr-DL-PRS-ResourceSet and the length of the bitmap is equal to the values of dl-PRS-ResourceRepetitionFactor. Both dl-PRS-MutingOption1 and dl-PRS-MutingOption2 may be configured at the same time in which case the logical AND operation is applied to the bit maps as described in Clause 7.4.1.7.4 of [4, TS 38.211].\n-\tNR-DL-PRS-SFN0-Offset defines the time offset of the SFN0 slot 0 for the DL PRS resource set with respect to SFN0 slot 0 of reference provided by nr-DL-PRS-ReferenceInfo. \n-\tdl-PRS-ResourceList determines the DL PRS resources that are contained within one DL PRS resource set. \n-\tdl-PRS-CombSizeN defines the comb size of a DL PRS resource where the allowable values are given in Clause 7.4.1.7.3 of [TS38.211]. All DL PRS resource sets belonging to the same DL PRS positioning frequency layer have the same value of dl-PRS-CombSizeN.\n-\tdl-PRS-ResourceBandwidth defines the number of resource blocks configured for DL PRS transmission. The parameter has a granularity of 4 PRBs with a minimum of 24 PRBs and a maximum of 272 PRBs. All DL PRS resources sets within a DL PRS positioning frequency layer have the same value of dl-PRS-ResourceBandwidth.\n-\tdl-PRS-StartPRB defines the starting PRB index of the DL PRS resource with respect to reference Point A, where reference Point A is given by the higher-layer parameter dl-PRS-PointA. The starting PRB index has a granularity of one PRB with a minimum value of 0 and a maximum value of 2176 PRBs. All DL PRS resource sets belonging to the same DL PRS positioning frequency layer have the same value of dl-PRS-StartPRB.\n-\tdl-PRS-NumSymbols defines the number of symbols of the DL PRS resource within a slot where the allowable values are given in Clause 7.4.1.7.3 of [4, TS38.211].\nA DL PRS resource is defined by:\n-\tnr-DL-PRS-ResourceID determines the DL PRS resource configuration identity. All DL PRS resource IDs are locally defined within a DL PRS resource set.\n-\tdl-PRS-SequenceID is used to initialize cinit value used in pseudo random generator as described in Clause 7.4.1.7.2 of [4, TS 38.211] for generation of DL PRS sequence for a given DL PRS resource.\n-\tdl-PRS-CombSizeN-AndReOffset defines the starting RE offset of the first symbol within a DL PRS resource in frequency. The relative RE offsets of the remaining symbols within a DL PRS resource are defined based on the initial offset and the rule described in Clause 7.4.1.7.3 of [4, TS 38.211]. \n-\tdl-PRS-ResourceSlotOffset determines the starting slot of the DL PRS resource with respect to corresponding DL PRS resource set slot offset.\n-\tdl-PRS-ResourceSymbolOffset determines the starting symbol of a slot configured with the DL PRS resource. \n-\tdl-PRS-QCL-Info defines any quasi co-location information of the DL PRS resource with other reference signals. The DL PRS may be configured with QCL 'typeD' with a DL PRS associated with the same dl-PRS-ID, or with rs-Type set to 'typeC', 'typeD', or 'typeC-plus-typeD' with a SS/PBCH Block from a serving or non-serving cell.\n-\tdl-PRS-ResourcePrioritySubset defines a subset of DL-PRS resources for the DL PRS resource for the purpose of prioritization of measurement reporting as described in [17, TS 37.355].\nThe UE assumes constant EPRE is used for all REs of a given DL PRS resource.\nThe UE may be indicated by the network that DL PRS resource(s) can be used as the reference for the DL RSTD, DL PRS-RSRP, DL PRS-RSRPP, and UE Rx-Tx time difference measurements in a higher layer parameter nr-DL-PRS-ReferenceInfo. The reference indicated by the network to the UE can also be used by the UE to determine how to apply higher layer parameters nr-DL-PRS-ExpectedRSTD and nr-DL-PRS-ExpectedRSTD-Uncertainty. The UE expects the reference to be indicated whenever it is expected to receive the DL PRS. This reference provided by nr-DL-PRS-ReferenceInfo may include a dl-PRS-ID, a DL PRS resource set ID, and optionally a single DL PRS resource ID or a list of DL PRS resource IDs [17, TS 37.355]. The UE may use different DL PRS resources or a different DL PRS resource set to determine the reference for the RSTD measurement as long as the condition that the DL PRS resources used belong to a single DL PRS resource set is met. If the UE chooses to use a different reference than indicated by the network, then it is expected to report the dl-PRS-ID, the DL PRS resource ID(s) or the DL PRS resource set ID used to determine the reference. \nThe UE may be configured to report quality metrics NR-TimingQuality corresponding to the DL RSTD and UE Rx-Tx time difference measurements which include the following fields:\n-\ttimingQualityValue which provides the best estimate of the uncertainty of the measurement\n-\ttimingQualityResolution which specifies the resolution levels used in the timingQualityValue field.\nThe UE expects to be configured with higher layer parameter nr-DL-PRS-ExpectedRSTD, which defines the time difference with respect to the received DL subframe timing the UE is expected to receive DL PRS, and nr-DL-PRS-ExpectedRSTD-Uncertainty, which defines a search window around the nr-DL-PRS-ExpectedRSTD.\nFor DL UE positioning measurement reporting in higher layer parameters NR-DL-TDOA-SignalMeasurementInformation or NR-Multi-RTT-SignalMeasurementInformation the UE can be configured to report the DL PRS resource ID(s) or the DL PRS resource set ID(s) associated with the DL PRS resource(s) or the DL PRS resource set(s) which are used in determining the UE measurements DL RSTD, or UE Rx-Tx time difference, respectively.\nFor the DL RSTD, DL PRS-RSRP, DL PRS-RSRPP, and UE Rx-Tx time difference measurements the UE reports an associated higher layer parameter nr-TimeStamp. The nr-TimeStamp can include the dl-PRS-ID, the SFN and the slot number for a subcarrier spacing. These values correspond to the reference which is provided by nr-DL-PRS-ReferenceInfo. \nThe UE is expected to measure the DL PRS resource outside the active DL BWP or with a numerology different from the numerology of the active DL BWP if the measurement is made during a configured measurement gap. When the UE is expected to measure the DL PRS resource, the UE may request a measurement gap via higher layer parameter NR-PRS-MeasurementInfoList [12, TS 38.331] or as specified in clause 6.1.3.40 of [10, TS 38.321]. The UE may be preconfigured with one or more measurement gaps each associated with a measPosPreConfigGapId. When the UE requests activation or deactivation of a measurement gap as specified in clause 6.1.3.40 of [10, TS 38.321] it can request one of the preconfigured measurement gaps by referring to the measPosPreConfigGapId. The UE may have one of the preconfigured measurement gap(s) activated or deactivated as specified in clause 6.1.3.41 of [10, TS 38.321]. \nThe UE assumes that the DL PRS from the serving cell is not mapped to any symbol that contains SS/PBCH block from the serving cell. If the time frequency location of the SS/PBCH block transmissions from non-serving cells are provided to the UE then the UE also assumes that the DL PRS from a non-serving cell is not mapped to any symbol that contains the SS/PBCH block of the same non-serving cell. \nThe UE may be configured to measure and report, subject to UE capability, up to 4 DL RSTD measurements per pair of dl-PRS-ID with each measurement between a different pair of DL PRS resources or DL PRS resource sets within the DL PRS configured for those dl-PRS-ID. If the UE is not configured to report with multiMeasInSameReport-r17, the up to 4 measurements being performed on the same pair of dl-PRS-ID and all DL RSTD measurements in the same report use a single reference timing. If the UE is configured to report with multiMeasInSameReport-r17, the up to 4 measurements being performed on the same pair of dl-PRS-ID and all DL RSTD measurements in the same measurement instance of the same report use a single reference timing.\nThe UE may be configured to measure and report, subject to UE capability, up to 24 DL PRS-RSRP measurements on DL PRS resources associated with the same dl-PRS-ID. When the UE reports DL PRS-RSRP measurements from one DL PRS resource set, the UE may indicate which DL PRS-RSRP measurements associated with the same higher layer parameter nr-DL-PRS-RxBeamIndex [17, TS 37.355] have been performed using the same spatial domain filter for reception if for each nr-DL-PRS-RxBeamIndex reported there are at least 2 DL PRS-RSRP measurements associated with it within the DL PRS resource set. When the UE reports DL PRS-RSRP measurements for a DL PRS resource, the reported multiple DL PRS-RSRP measurements associated with the same or different higher layer parameter nr-DL-PRS-RxBeamIndex may have the same or different timestamps. \nThe UE may be configured to measure and optionally report, subject to UE capability, up to 24 DL PRS-RSRPP for the first detected path on DL PRS resources associated with the same dl-PRS-ID. When the UE reports DL PRS-RSRPP measurements for a DL PRS resource, the reported multiple DL PRS-RSRPP measurements associated with the same or different higher layer parameter nr-DL-PRS-RxBeamIndex may have the same or different timestamps. When the UE reports DL PRS-RSRPP measurements from one DL PRS resource set, the UE may indicate which DL PRS-RSRPP measurements associated with the same higher layer parameter nr-DL-PRS-RxBeamIndex [17, TS 37.355] have been performed using the same spatial domain filter for reception if for each nr-DL-PRS-RxBeamIndex reported there are at least 2 DL PRS-RSRPP measurements associated with it within the DL PRS resource set.\nThe UE may be configured to optionally report a differential DL PRS-RSRPP for a DL PRS resource with reference to nr-DL-PRS-FirstPathRSRP-Result and/or a differential DL PRS RSRP with reference to nr-DL-PRS-RSRP-Result via higher layer parameter NR-DL-AoD-AdditionalMeasurementElement.\nFor each DL PRS resource, the UE may be configured, subject to UE capability, with dl-PRS-ResourcePrioritySubset that is associated with this DL PRS resource, where the subset of DL PRS resources associated with the DL PRS resource can be in the same or different DL PRS resource set than the DL PRS resource. The UE may include UE measurements for the subset of DL PRS resources in NR-DL-AoD-AdditionalMeasurementElement if the UE measurements of the associated PRS resource are reported, where the UE measurement can be DL PRS-RSRP and/or DL PRS-RSRPP. The UE may report DL PRS-RSRP and/or DL PRS-RSRPP measurements only for the subset of DL PRS resources. Subject to UE capability, the UE may be configured with boresight direction via higher layer parameter DL-PRS-BeamInfoElement for each DL PRS resource.\nThe UE may be provided with beam/antenna information via higher layer parameter NR-TRP-BeamAntennaInfo.\nThe UE may request to be provided with either expected DL-AoD/ZoD and uncertainty range(s) of expected DL-AoD/ZoD, or expected DL-AoA/ZoA and uncertainty range(s) of the expected DL-AoA/ZoA. The UE may be provided with expected DL-AoD/ZoD and uncertainty range(s) of the expected DL-AoD/ZoD. The UE may be provided with expected DL-AoA/ZoA and uncertainty range(s) of the expected DL-AoA/ZoA. The uncertainty range(s) of the expected DL-AoD/DL-AoA may be configured within [0, 60]. The uncertainty range(s) of expected DL-ZoD/DL-ZoA may be configured within [0, 30].\nThe UE may be configured to measure and report, subject to UE capability, up to 4 UE Rx-Tx time difference measurements corresponding to a single configured SRS resource or resource set for positioning. Each measurement corresponds to a single received DL PRS resource or resource set which can be in different DL PRS positioning frequency layers. \nThe UE may be configured to measure and report via higher layer parameter additionalPaths or additionalPathsExt, subject to UE capability, the timing and the quality metrics of up to 8 additional detected paths, that are associated with each RSTD or UE Rx \u2013 Tx time difference. The timing of each additional path is reported relative to the path timing used for determining nr-RSTD or nr-UE-RxTxTimeDiff. For UE positioning measurement reporting in higher layer parameters NR-DL-TDOA-SignalMeasurementInformation or NR-Multi-RTT-SignalMeasurementInformation, the UE may be configured to measure and report, subject to UE capability, the DL PRS-RSRPP of the first path and the up to 8 additional paths that are associated with each RSTD or UE Rx \u2013 Tx time difference. \nThe UE may be requested, subject to UE capability, to measure and report one or more of the DL RSTD, DL PRS-RSRP, DL PRS-RSRPP, or UE Rx-Tx time difference measurements with either  or 4 samples, where  = 1 or 2 is as defined in [11, TS 38.133], via higher layer parameter reducedDL-PRS-ProcessingSamples [17, TS 37.355] which applies for all DL PRS positioning frequency layers.\nThe UE may be requested, subject to UE capability, to report LoS/NLoS indicator(s) via higher layer parameter nr-los-nlos-IndicatorRequest. The UE can report LoS/NLoS indicator(s) via higher layer parameter nr-los-nlos-Indicator associated with each DL RSTD, DL PRS-RSRP, DL PRS-RSRPP, and UE Rx-Tx time difference measurements. The UE can report LoS/NLoS indicator(s) via higher layer parameter nr-los-nlos-Indicator associated with each dl-PRS-ID in a measurement report. For the LoS/NLoS indicator(s) associated with DL RSTD, the UE may report one indicator associated with the dl-PRS-ID indicated by higher layer parameter dl-PRS-ReferenceInfo and one indicator associated with the dl-PRS-ID of the DL RSTD measurement. A UE may be provided with LoS/NLoS indicator(s) via higher layer parameter nr-los-nlos-Indicator, and it may be associated with each DL PRS resource of each configured dl-PRS-ID or may be associated with each configured dl-PRS-ID. The values of the higher layer parameter LOS-NLOS-Indicator may be soft values (0, 0.1, \u2026, 0.9, 1) or hard values (0, 1) with the values corresponding to the likelihood of LoS, with a value of 1 corresponding to LoS and a value of 0 corresponding to NLoS.\nIf the UE is configured with DL-PRS-QCL-Info and the QCL relation is between two DL PRS resources, then the UE assumes those DL PRS resources are associated with the same dl-PRS-ID. If DL-PRS-QCL-Info is configured to the UE with QCL set to 'type-D' with a source DL PRS resource then the nr-DL-PRS-ResourceSetId and the nr-DL-PRS-ResourceId of the source DL PRS resource are expected to be indicated to the UE.\nThe UE is expected to measure the DL PRS outside the measurement gap, subject to UE capability, if the DL PRS is inside the active DL BWP and has the same numerology as the active DL BWP and is within the DL PRS processing window indicated by higher layer parameter DL-PPW-PreConfig. The UE is not expected to measure the DL PRS outside the measurement gap if the expected received timing difference between the DL PRS from the non-serving cell and that from the serving cell, determined by the higher layer parameters nr-DL-PRS-ExpectedRSTD and nr-DL-PRS-ExpectedRSTD-Uncertainty, is larger than maximum Rx timing difference provided by UE capability. For receiving the DL PRS outside the measurement gap and within the DL PRS processing window, the priority between DL PRS and SSB is defined in [11, TS 38.133] and the UE determines the DL PRS priority as indicated by higher layer parameter priority subject to UE capability or as implied by UE capability, except for SSB: \n-\twith value 'st1' where the DL PRS is higher priority than all the DL signals and channels, or \n-\twith value 'st2' where the DL PRS is lower priority than PDCCH and the PDSCH scheduled by DCI formats 1_1, 1_2, 1_3 or 4_2 with the priority indicator field in the corresponding DCI format set to 1, and is higher priority than other DL signals and channels, or\n-\twith value 'st3' where the DL PRS is lower priority than all the DL signals and channels.\nInside one DL-PPW-PreConfig the UE is only expected to measure a single DL PRS positioning frequency layer.\nWhen the UE is expected to measure the DL PRS outside the measurement gap in a configured DL PRS processing window with type1A and if the DL PRS is determined to be higher priority than the DL signals and channels inside the DL PRS processing window, those DL signals and channels are not expected to be measured by the UE. When the UE is expected to measure the DL PRS outside the measurement gap in a configured DL PRS processing window with type1B and if the DL PRS is determined to be higher priority than the DL signals and channels inside the DL PRS processing window, those DL signals and channels in the same band as the DL PRS are not expected to be measured by the UE. When the UE is expected to measure the DL PRS outside the measurement gap in a configured DL PRS processing window with type2 if the DL PRS is determined to be higher priority than the DL signals and channels inside the DL PRS processing window, those DL signals and channels from the impacted serving cells are not expected to be measured by the UE on the overlapped symbols with the DL PRS, where impacted serving cells refer to the serving cell on which the DL-PPW-PreConfig is configured for a frequency range 1 band, and all the serving cells in the same band as the DL PRS for a frequency range 2 band. When the UE is expected to measure the DL PRS outside the measurement gap in a configured DL PRS processing window with type1B or type2, and if the DL PRS is determined to be higher priority than the DL signals and channels inside the DL PRS processing window, the UE behavior is described in [11, TS 38.133] for inter-band case for frequency range 2 for the DL signals/channels from a different frequency range 2 band than the frequency range 2 band of the DL PRS.\nWhen the UE has an activated DL PRS processing window with type1A or type1B and the UE determines the presence of other DL signals and channels, except SSB, of higher priority than the DL PRS in the DL PRS processing window no later than N2 symbols, defined in clause 6.4 for the subcarrier spacing  of the DL PRS, before the first symbol of the DL PRS processing window, the UE is expected to receive the other DL signals and channels and drop all PRS within the DL PRS processing window. When the UE has an activated DL PRS processing window with type2 and the UE determines the presence of other DL signals and channels, except SSB, of higher priority than the DL PRS on a symbol configured with the DL PRS no later than N2 symbols, defined in clause 6.4 for the subcarrier spacing  of the DL PRS, before the DL PRS symbol, the UE is expected to receive the other DL signals and channels and drop the DL PRS symbol. \nWhen the UE has an activated DL PRS processing window with type1A or type1B and the UE determines the presence of other DL signals and channels, except SSB, of higher priority than the DL PRS in the DL PRS processing window later than N2 symbols, defined in clause 6.4 for the subcarrier spacing  of the DL PRS, before the first symbol of the DL PRS processing window, the UE is not required to receive the other DL signals and channels and may receive the DL PRS and consider the DL PRS as higher priority in the DL PRS processing window. When the UE has an activated DL PRS processing window with type2 and the UE determines the presence of other DL signals and channels, except SSB, of higher priority than the DL PRS on a symbol configured with the DL PRS later than N2 symbols, defined in clause 6.4 for the subcarrier spacing  of the DL PRS, before the DL PRS symbols, the UE is not required to receive the other DL signals and channels and may receive the DL PRS symbol and consider the DL PRS as higher priority in that symbol. \nWithin a positioning frequency layer, the DL PRS resources are sorted in the decreasing order of priority for measurement to be performed by the UE, with the reference indicated by nr-DL-PRS-ReferenceInfo being the highest priority for measurement, and the following priority is assumed:\n-\tUp to 64 NR-SelectedDL-PRS-IndexPerTRP of the DL PRS positioning frequency layer are sorted according to priority if nr-SelectedDL-PRS-IndexListPerFreq is provided, or up to 64 NR-DL-PRS-AssistanceDataPerTRP of the frequency layer are sorted according to priority; except when the UE is requested to perform aggregated measurement(s), in which case:\n-\tA DL PRS ID associated with DL PRS bandwidth aggregation linkage has higher priority than a DL PRS ID not associated with DL PRS bandwidth aggregation linkage. If multiple DL PRS ID are associated with DL PRS bandwidth aggregation linkage, they are sorted according to priority.\n-\tUp to 2 DL-SelectedPRS-ResourceSetIndex per dl-PRS-ID of the DL PRS positioning frequency layer are sorted according to priority if dl-SelectedPRS-ResourceSetIndexList is provided, or up to 2 NR-DL-PRS-ResourceSet per dl-PRS-ID of the DL PRS positioning frequency layer are sorted according to priority except when the UE is requested to perform aggregated measurement(s), in which case:\n-\tA DL PRS resource set linked for a DL PRS bandwidth aggregation has higher priority than a DL PRS resource set not linked for DL PRS bandwidth aggregation. If multiple DL PRS resource sets are linked for DL PRS bandwidth aggregation, then they are sorted according to priority.\nThe UE DL PRS processing capability is defined in [TS 37.355]. For the purpose of DL PRS processing capability, the duration K msec of DL PRS symbols within P msec window, is calculated by\n-\tType 1 duration calculation with UE symbol level buffering capability\n\n-\tType 2 duration calculation with UE slot level buffering capability\n\n-\tS is the set of slots based on the numerology of the DL PRS of a serving cell within the P msec window in the positioning frequency layer that contains potential DL PRS resources considering the actual nr-DL-PRS-ExpectedRSTD, nr-DL-PRS-ExpectedRSTD-Uncertainty provided for each pair of DL PRS Resource Sets.\n-\tFor Type 1,  is the smallest interval in msec within slot  corresponding to an integer number of OFDM symbols based on the numerology of the DL PRS of a serving cell that covers the union of the potential DL PRS symbols and determines the DL PRS symbol occupancy within slot , where the interval  considers the actual nr-DL-PRS-ExpectedRSTD, nr-DL-PRS-ExpectedRSTD-Uncertainty provided for each pair of DL PRS resource sets (target and reference). \n-\tFor Type 2,  is the numerology of the DL PRS, and  is the cardinality of the set .\nThe UE may be configured to report one or more measurement instances, each with its own timestamp, on DL RSTD, DL PRS-RSRP, DL PRS-RSRPP, and/or UE Rx-Tx time difference measurements, in a single measurement report. \nTiming Error Group(s) (TEG(s)) at UE side are defined:\n-\tUE Rx TEG is associated with one or more DL measurements, which have the Rx timing error difference within a certain margin.\n-\tUE RxTx TEG is associated with one or more UE Rx-Tx time difference measurements, which have the 'Rx timing errors+Tx timing errors' difference within a certain margin.\nThe UE may be configured to report, subject to UE capability, via high layer parameter nr-UE-RxTEG-Request, the association information of DL RSTD measurement(s) with UE Rx TEG(s) via higher layer parameter nr-UE-Rx-TEG-ID when the UE reports the DL RSTD measurement(s). The UE may report up to 4 RSTD measurements associated with different DL PRS resources per UE Rx TEG per dl-PRS-ID.\nThe UE may report a UE Rx TEG ID via higher layer parameter nr-UE-Rx-TEG-ID for a RSTD reference time dl-PRS-ReferenceInfo and a UE Rx TEG ID for each DL RSTD measurement, where the DL RSTD can be DL RSTD measurement in NR-DL-TDOA-MeasElement and/or NR-DL-TDOA-AdditionalMeasurementElement. \nIf the UE reports a UE Rx TEG ID with a DL RSTD measurement, the UE may report a UE Rx TEG timing error margin value, via high layer parameter nr-UE-RxTEG-TimingErrorMargin, for all the UE Rx TEGs within one NR-DL-TDOASignalMeasurementInformation.\nThe UE may be configured to measure and report, via high layer parameter measureSameDL-PRS-ResourceWithDifferentRxTEGs subject to UE capability, RSTD measurements on a DL PRS resource associated with a dl-PRS-ID using up to 8 different UE Rx TEGs with the same dl-PRS-ReferenceInfo. The higher layer parameter measureSameDL-PRS-ResourceWithDifferentRxTEGs applies to all DL PRS positioning frequency layers.\nThe UE may be provided with association information of DL PRS resource(s) with TRP Tx TEGs via higher layer parameter dl-prs-trp-Tx-TEG-ID for a dl-PRS-ID.\nThe UE may be configured to report, via high layer parameter nr-UE-RxTxTEG-Request, subject to UE capability, the association information of UE Rx-Tx time difference measurement(s) with UE RxTx TEG(s) via higher layer parameter nr-UE-RxTx-TEG-ID. The UE may report up to 4 UE Rx-Tx time difference measurements associated with different DL PRS resources per UE RxTx TEG per dl-PRS-ID.\nIf the UE reports a UE RxTx TEG ID with a UE Rx-Tx time difference measurement, the UE may report a UE RxTx TEG timing error margin value, via high layer parameter nr-UE-RxTxTEG-TimingErrorMargin, for all the UE RxTx TEGs within one NR-Multi-RTT-SignalMeasurementInformation.\nThe UE may be configured to report, via high layer parameter nr-UE-RxTxTEG-Request, subject to UE capability, the association information of UE Rx-Tx time difference measurement(s) with the UE Rx TEG(s) and UE Tx TEG(s) via the higher layer parameters of nr-UE-Rx-TEG-ID, and nr-UE-Tx-TEG-Index. The UE may report up to 4 UE Rx-Tx time difference measurements associated with different DL PRS resources per UE Rx TEG per dl-PRS-ID.\nIf the UE reports a UE Rx TEG ID with a UE Rx-Tx time difference measurement, the UE may report a UE Rx TEG timing error margin value, via high layer parameter nr-UE-RxTEG-TimingErrorMargin, for all the UE Rx TEGs within one NR-Multi-RTT-SignalMeasurementInformation.\nThe UE may be configured to measure and report, via high layer parameter measureSameDL-PRS-ResourceWithDifferentRxTEGs subject to UE capability, UE Rx-Tx time difference measurements on a PRS resource associated with a dl-PRS-ID using up to 8 different UE Rx TEGs. The high layer parameter measureSameDL-PRS-ResourceWithDifferentRxTEGs applies to all DL PRS positioning frequency layers. \nThe UE may be configured to measure and report, via high layer parameter measureSameDL-PRS-ResourceWithDifferentRxTxTEGs subject to UE capability, UE Rx-Tx time difference measurements with the same UE Tx TEG using up to 8 different UE RxTx TEGs. The high layer parameter measureSameDL-PRS-ResourceWithDifferentRxTxTEGs applies to all DL PRS positioning frequency layers.\nThe UE may be configured to measure and report, via higher layer parameter [undetermined NTN related parameter] subject to UE capability, UE Rx-Tx time difference measurements on a PRS resource associated with a dl-PRS-ID, and report the UE Rx-Tx time difference subframe offset and the DL timing drift as described in [7, TS 38.215].\nThe UE in RRC_INACTIVE mode is expected to prioritize the reception of any other DL signals and DL channels than the reception of DL PRS.\nThe UE in RRC_INACTIVE mode, subject to UE capability, is expected to process DL PRS outside or inside of the initial DL BWP. For DL PRS processing outside of the initial DL BWP, the UE may be configured with the same or different subcarrier spacing and CP for DL PRS resources than those of the initial DL BWP. For DL PRS processing inside of the initial DL BWP, the UE is configured with the same subcarrier spacing and CP for DL PRS resources as those of the initial DL BWP.\nFor a UE configured with preconfigured Measurement gap(s) for Positioning, when the UE receives an activation command, as described in clause 6.1.3.41 of [10, TS 38.321], for a preconfigured Measurement Gap for Positioning activation/deactivation, and when the UE would transmit a PUCCH with HARQ-ACK information in slot n corresponding to the PDSCH carrying the command, the corresponding actions in [10, TS 38.321] and the UE assumptions shall be applied starting from the first slot that is after slot  where \uf06d is the SCS configuration for the PUCCH.\nFor a UE configured with DL PRS Processing Window(s), when the UE receives an activation/deactivation command, as described in clause 6.1.3.42 of [10, TS 38.321], for a DL PRS processing window activation, and when the UE would transmit a PUCCH with HARQ-ACK information in slot n corresponding to the PDSCH carrying the command, the corresponding actions in [10, TS 38.321] and the UE assumptions shall be applied starting from the first slot that is after slot  where \uf06d is the SCS configuration for the PUCCH. The UE is not expected to be indicated with more than 4 activated DL PRS processing windows across all active DL BWPs and is not expected to be indicated with the activated DL PRS processing windows that overlap in time.\nThe UE, subject to UE capability, may be requested to perform DL RSCPD and/or DL RSCP measurements on indicated DL PRS resource sets occurring within one or two time window(s) indicated by NR-DL-PRS-MeasurementTimeWindowsConfig. Within each window indicated by NR-DL-PRS-MeasurementTimeWindowsConfig, the UE expects that the indicated DL PRS resource sets across all dl-PRS-IDs are from one DL PRS positioning frequency layer, and that the number of indicated DL PRS resource sets associated with each dl-PRS-ID are the same.\nThe UE, subject to UE capability, may be requested to perform DL RSTD, UE Rx \u2013 Tx time difference, DL PRS-RSRP, and DL PRS-RSRPP measurement on the indicated DL PRS resource sets only within the window(s) indicated by NR-DL-PRS-MeasurementTimeWindowsConfig. Otherwise, UE may use the indicated DL PRS resource set(s) occurring outside the indicated time window for these measurements in addition to the indicated DL PRS resource set(s) occurring inside the indicated time window(s).\n5.1.6.5.1\tPRS receiver frequency hopping\nThe reduced capability UE may be configured to measure and report, subject to UE capability, via [nr-Requested-DL-PRS-measurementBasedOnMultihopRx] the DL RSTD, DL PRS-RSRP, DL PRS-RSRPP, or UE Rx-Tx time difference using receiver frequency hopping for a DL PRS resource, with a requested bandwidth of all hops that may be greater than the maximum reduced capability UE bandwidth. The reduced capability UE performing receiver frequency hopping may report via [higher layer parameter] one measurement associated with one received frequency hop or one measurement based on multiple hops of the DL PRS. The reduced capability UE may report whether the measurement is associated with one received frequency hop or multiple frequency hops of the DL PRS. In RRC_CONNECTED mode, the reduced capability UE is expected to use a single instance of a configured measurement gap to receive all hops of the DL PRS using receiver frequency hopping. \n5.1.6.5.2\tPRS for carrier phase positioning\nFor DL UE positioning measurement reporting in higher layer parameter NR-DL-TDOA-SignalMeasurementInformation, the UE may be configured to report the DL Reference Signal Carrier Phase Difference (RSCPD) [7, TS 38.215] measurement along with the DL RSTD. When the UE reports RSCPD measurements, the reference nr-DL-PRS-ReferenceInfo is the same as the one reported, for the RSTD measurements. For DL UE positioning measurement reporting in higher layer parameter NR-Multi-RTT-SignalMeasurementInformation, the UE may be configured to report the DL Reference Signal Carrier Phase (RSCP) measurement [7, TS 38,215] along with the UE Rx-Tx time difference measurement. When the UE reports DL RSCPD measurement(s) along with DL RSTD measurement(s) or DL RSCP measurement(s) along with UE Rx-Tx time difference measurement(s), the DL RSCPD and/or DL RSCP measurement(s) should be measured from a single DL PRS positioning frequency layer. For a UE in RRC_CONNECTED state, DL RSCP/RSCPD measurements are measured within the configured measurement gap.\nThe UE is expected to obtain each DL RSCP or DL RSCPD measurement with  as defined in [11, TS 38.133]. If the UE reports a DL RSTD measurement with  = 2 or 4 samples as defined in [11, TS 38.133], up to  DL RSCPD measurements can be reported associated with the DL RSTD measurement. If the UE reports a UE Rx-Tx time difference measurement with  = 2 or 4 samples as defined in [11, TS 38.133], up to  DL RSCP measurements can be reported associated with the UE Rx-Tx time difference measurement. Each DL RSCP or DL RSCPD measurement has its own timestamp. \nWhen the UE reports a timestamp associated with a DL RSCP measurement or a DL RSCPD measurement, subject to UE capability, it may include a symbol index in the timestamp.\nIf the UE reports LoS/NLoS indicator(s) via higher layer parameter nr-los-nlos-Indicator along with a measurement report containing DL RSCP or DL RSCPD the LoS/NLoS indicator(s) are assumed to also apply to the DL RSCP or DL RSCPD measurements. \nThe UE may be provided with [nr-PruInformation-Ue-based-DL-CPP ] which contains DL RSCP/RSCPD measurements together with DL RSTD, DL PRS-RSRP, and/or DL PRS-RSRPP measurement(s) associated with the RSCP/RSCPD measurements performed by a positioning reference unit (PRU) [20, TS 38.305] the timestamps associated with the measurements, and the location information of the PRU. \nThe UE may be configured to report quality metrics [nr-CarrierPhaseQualityInfo] corresponding to the DL RSCP and RSCPD measurements which include the following fields [17, TS 37.355]:\n-\t[phase quality index] which provides the uncertainty of the measurement\n-\t[phase quality resolution] which specifies the resolution levels used in the [phase quality index] field.\nThe UE in RRC_INACTIVE or RRC_IDLE mode is expected to perform the DL carrier phase measurement from the bandwidth of a DL PRS resource including outside of the initial downlink bandwidth part.\n5.1.6.5.3\tPRS bandwidth aggregation for positioning measurements\nWhen the UE is expected to perform aggregated measurements for bandwidth aggregation across DL PRS positioning frequency layers, the UE expects to be configured with linkage information, via higher layer parameter nr-DL-PRS-AggregationInfo, between DL PRS resource sets across DL PRS positioning frequency layers. For the linked DL PRS resource sets, the UE is expected to be configured with the same values of QCL, dl-PRS-Periodicity-and-ResourceSetSlotOffset, dl-PRS-NumSymbols, dl-PRS-ResourceTimeGap, dl-PRS-ResourceRepetitionFactor, dl-PRS-ResourceSymbolOffset, dl-PRS-MutingBitRepetitionFactor, dl-PRS-SubcarrierSpacing, dl-PRS-CyclicPrefix, comb size, power per subcarrier, NR-MutingPattern, and NR-DL-PRS-SFN0-Offset, and the UE is expected to be configured with DL PRS resources that maintain uniformly spaced DL PRS RE pattern within a symbol across aggregated DL PRS positioning frequency layers. The UE assumes that DL PRS resources across the linked DL PRS resource sets which satisfy the above conditions are linked for bandwidth aggregation, and the UE may assume phase continuity on the DL PRS resources on same symbol(s); otherwise, the UE does not assume that PRS resources from the linked DL PRS resource sets are linked for bandwidth aggregation.\nThe UE may be indicated by the network that aggregated DL PRS resource set(s) can be used as the reference for the aggregated DL RSTD, DL PRS-RSRP, DL PRS-RSRPP, and UE Rx-Tx time difference measurements.  \nThe UE may be configured to measure and report, subject to UE capability, up to 4 aggregated DL RSTD measurement(s) per pair of dl-PRS-ID, from a different pair of aggregated DL PRS resources across two or three DL PRS positioning frequency layers. The UE may report up to 4 RSTD measurements associated with different aggregated DL PRS resources per UE Rx TEG per dl-PRS-ID.\nThe UE may be configured to measure and report, subject to UE capability, up to 4 aggregated UE Rx-Tx time difference measurement(s) from aggregated DL PRS resources across two or three DL PRS positioning frequency layers. The UE may report up to 4 UE Rx-Tx time difference measurements associated with different aggregated DL PRS resources per UE RxTx TEG per dl-PRS-ID.\nThe UE may be requested via higher layer parameter nr-DL-PRS-JointMeasurementRequested to perform the aggregated DL RSTD measurement(s) or the aggregated UE Rx-Tx time difference measurement(s) across two or three DL PRS positioning frequency layers.\nThe UE may report via higher layer parameter nr-RSTD-BasedOnAggregatedResources or nr-UE-RxTxTimeDiffBasedOnAggregatedResources in a measurement report whether the aggregated DL RSTD measurement(s) or the aggregated UE Rx-Tx time difference measurement(s) is performed. If any aggregated measurement is performed, the two or three DL PRS positioning frequency layers to be used may also be reported by reporting PRS resource set IDs.\nIf the UE reports a DL PRS-RSRP or a DL PRS-RSRPP with aggregated DL RSTD measurement(s) or aggregated UE Rx-Tx time difference measurement(s), the DL PRS-RSRP or the DL PRS-RSRPP correspond to the aggregated DL PRS resources across two or three DL PRS positioning frequency layers.\nFor PRS resources on multiple DL PRS positioning frequency layers (PFLs) linked for aggregation, the channel over which a symbol on one PFL for PRS transmission is conveyed can be inferred from the channel over which the same symbol of another PFL or the aggregated PFL is conveyed.\n5.1.7\tCode block group based PDSCH transmission\nIf a UE is configured to receive code block group (CBG) based transmissions by receiving the higher layer parameter PDSCH-CodeBlockGroupTransmission in PDSCH-ServingCellConfig on a serving cell in a PUCCH group, the UE does not expect to be configured with higher layer parameter ScheduledCell-ListDCI-1-3 on any serving cell within the PUCCH group.\n5.1.7.1\tUE procedure for grouping of code blocks to code block groups\nIf a UE is configured to receive code block group (CBG) based transmissions by receiving the higher layer parameter PDSCH-CodeBlockGroupTransmission for PDSCH, the UE shall determine the number of CBGs for a transport block reception as \n\t,\nwhere N is the maximum number of CBGs per transport block as configured by maxCodeBlockGroupsPerTransportBlock for PDSCH, and C is the number of code blocks in the transport block according to the procedure defined in Clause 7.2.3 of [5, TS 38.212].\nDefine , , and .\nIf , CBG m, , consists of code blocks with indices . CBG m, , consists of code blocks with indices .\n5.1.7.2\tUE procedure for receiving code block group based transmissions\nIf a UE is configured to receive code block group-based transmissions by receiving the higher layer parameter PDSCH-CodeBlockGroupTransmission for PDSCH, \n-\tThe 'CBG transmission information' (CBGTI) field of DCI format 1_1 is of length  bits, where  is the value of the higher layer parameter maxNrofCodeWordsScheduledByDCI. If  the CBGTI field bits are mapped such that the first set of  bits starting from the MSB corresponds to the first TB while the second set of  bits corresponds to a second TB, if scheduled. The first M bits of each set of  bits in the CBGTI field have an in-order one-to-one mapping with the M CBGs of the TB, with the MSB mapped to CBG#0.\n-\tFor initial transmission of a TB as indicated by the 'New Data Indicator' field of the scheduling DCI, the UE may assume that all the code block groups of the TB are present.\n-\tFor a retransmission of a TB as indicated by the 'New Data Indicator' field of the scheduling DCI, the UE may assume that \n-\tThe 'CBGTI' field of the scheduling DCI indicates which CBGs of the TB are present in the transmission. A bit value of '0' in the CBGTI field indicates that the corresponding CBG is not transmitted and '1' indicates that it is transmitted. \n-\tIf the 'CBG flushing out information' (CBGFI) field of the scheduling DCI is present, 'CBGFI' set to '0' indicates that the earlier received instances of the same CBGs being transmitted may be corrupted, and 'CBGFI' set to '1' indicates that the CBGs being retransmitted are combinable with the earlier received instances of the same CBGs. \n-\tA CBG contains the same CBs as in the initial transmission of the TB.\n5.2\tUE procedure for reporting channel state information (CSI)\n5.2.1\tChannel state information framework\nThe procedures on aperiodic CSI reporting described in this clause assume that the CSI reporting is triggered by DCI format 0_1, but they equally apply to CSI reporting triggered by DCI format 0_2, by applying the higher layer parameter reportTriggerSizeDCI-0-2 instead of reportTriggerSize. The procedures on aperiodic CSI reporting described in this clause assume that the CSI reporting is triggered by DCI format 0_1, but they equally apply to CSI reporting triggered by DCI format 0_3.\nThe time and frequency resources that can be used by the UE to report CSI are controlled by the gNB. CSI may consist of Channel Quality Indicator (CQI), precoding matrix indicator (PMI), CSI-RS resource indicator (CRI), SS/PBCH Block Resource indicator (SSBRI), layer indicator (LI), rank indicator (RI), L1-RSRP, L1-SINR, CapabilityIndex or time-domain channel properties (TDCP).\nFor CQI, PMI, CRI, SSBRI, LI, RI, L1-RSRP, L1-SINR, CapabilityIndex, TDCP a UE is configured by higher layers with N\u22651 CSI-ReportConfig Reporting Settings and/or X\u22651 LTM-CSI-ReportConfig Reporting Settings, M\u22651 CSI-ResourceConfig Resource Settings and/or Y\u22651 LTM-CSI-ResourceConfig Resource Settings, and one or two list(s) of trigger states (given by the higher layer parameters CSI-AperiodicTriggerStateList and CSI-SemiPersistentOnPUSCH-TriggerStateList). Each trigger state in CSI-AperiodicTriggerStateList contains a list of associated CSI-ReportConfigs or LTM-CSI-ReportConfigs indicating the Resource Set IDs for channel and optionally for interference where a Resource Set for interference can only be present for a Report Setting given by a CSI-ReportConfig and a trigger state additionally contains one or more [csi-ReportSubConfigID] if the associated CSI-ReportConfig configured with a list of sub-configurations, as described in Clause 5.2.1.1. Each trigger state in CSI-SemiPersistentOnPUSCH-TriggerStateList contains one associated CSI-ReportConfig or LTM-CSI-ReportConfig, and a trigger state additionally contain one or more [csi-ReportSubConfigID] if the associated CSI-ReportConfig is configured with a list of sub-configurations, as described in Clause 5.2.1.1.\n5.2.1.1\tReporting settings\nEach Reporting Setting CSI-ReportConfig is associated with a single downlink BWP (indicated by higher layer parameter BWP-Id) given in the associated CSI-ResourceConfig for channel measurement and contains the parameter(s) for one CSI reporting band: codebook configuration including codebook subset restriction, time-domain behavior, frequency granularity for CQI and PMI, measurement restriction configurations, and the CSI-related quantities to be reported by the UE such as the layer indicator (LI), L1-RSRP, L1-SINR, CRI, SSBRI (SSB Resource Indicator), CapabilityIndex and TDCP. \nEach Reporting Setting LTM-CSI-ReportConfig is associated with a LTM-CSI-ResourceConfig for channel measurement and contains the parameters(s) for time-domain behavior provided by ltm-ReportConfigType, the number of cells and the number of reference signals per candidate cell provided by nrOfReportedCells, and nrOfReportedRS-PerCell, respectively, comprising L1 measurement results associated with current SpCell if spCellInclusion is configured.\nThe time domain behavior of the CSI-ReportConfig is indicated by the higher layer parameter reportConfigType and can be set to 'aperiodic', 'semiPersistentOnPUCCH', 'semiPersistentOnPUSCH', or 'periodic'. For 'periodic' and 'semiPersistentOnPUCCH'/'semiPersistentOnPUSCH' CSI reporting, the configured periodicity and slot offset applies in the numerology of the UL BWP in which the CSI report is configured to be transmitted on. The higher layer parameter reportQuantity indicates the CSI-related, L1-RSRP-related, L1-SINR-related, CapabilityIndex-related or TDCP-related quantities to report. The reportFreqConfiguration indicates the reporting granularity in the frequency domain, including the CSI reporting band and if PMI/CQI reporting is wideband or sub-band. The timeRestrictionForChannelMeasurements parameter in CSI-ReportConfig can be configured to enable time domain restriction for channel measurements and timeRestrictionForInterferenceMeasurements can be configured to enable time domain restriction for interference measurements. The CSI-ReportConfig can also contain CodebookConfig, which contains configuration parameters for Type-I, Type II, Enhanced Type II CSI, Further Enhanced Type II Port Selection, Enhanced Type II for coherent joint transmission (CJT), Further Enhanced Type II Port Selection for CJT, Enhanced Type II for predicted PMI, or Further Enhanced Type II Port Selection for predicted PMI including codebook subset restriction when applicable, and configurations of group-based reporting. A UE is not expected to be configured with a CSI report setting associated with a dormant DL BWP if the reportConfigType is set to 'aperiodic'. A CSI-ReportConfig can contain a list of sub-configurations, provided by the higher layer parameter [csi-ReportSubConfigList], where each sub-configuration is identified by [csi-ReportSubConfigID] and corresponds to a list of one or more CSI-RS resources or corresponds to a CSI-RS antenna port subset, and/or corresponds to a power offset for PDSCH relative to CSI-RS additional to powerControlOffset of the CSI-RS resource(s). A UE is not expected to be configured with a CSI-ReportConfig that contains a mix of sub-configuration(s) each corresponding to a list of one or more CSI-RS resources and some other sub-configuration(s) each corresponding to CSI-RS antenna port subset.\nThe time domain behavior of LTM-CSI-ReportConfig is indicated by the higher layer parameter ltm-ReportConfigType and can be set to 'aperiodic', 'semiPersistentOnPUCCH', 'semiPersistentOnPUSCH', or 'periodic'. For 'periodic' and 'semiPersistentOnPUCCH'/'semiPersistentOnPUSCH' CSI reporting, the configured periodicity and slot offset applies in the numerology of the UL BWP in which the CSI report is configured to be transmitted on.\n5.2.1.2\tResource settings\nEach CSI Resource Setting CSI-ResourceConfig contains a configuration of a list of S\u22651 CSI Resource Sets (given by higher layer parameter csi-RS-ResourceSetList), where the list is comprised of references to either or both of NZP CSI-RS resource set(s) and SS/PBCH block set(s) or the list is comprised of references to CSI-IM resource set(s). Each CSI Resource Setting is located in the DL BWP identified by the higher layer parameter BWP-id, and all CSI Resource Settings linked to a CSI Report Setting have the same DL BWP.\nThe time domain behavior of the CSI-RS resources within a CSI Resource Setting are indicated by the higher layer parameter resourceType and can be set to aperiodic, periodic, or semi-persistent. For periodic and semi-persistent CSI Resource Settings, when the UE is configured with groupBasedBeamReporting-r17 or groupBasedBeamReporting-v18, the number of CSI Resource Sets configured is S=2, otherwise the number of CSI-RS Resource Sets configured is limited to S=1, except for periodic CSI Resource Settings, when the UE is configured with TDCP reporting, for which the number of CSI-RS Resource Sets in the CSI Resource Setting for channel measurement is  and all the CSI-RS Resource Sets are configured with the higher layer parameter trs-Info. For periodic and semi-persistent CSI Resource Settings, the configured periodicity and slot offset is given in the numerology of its associated DL BWP, as given by BWP-id. When a UE is configured with multiple CSI-ResourceConfigs consisting the same NZP CSI-RS resource ID, the same time domain behavior shall be configured for the CSI-ResourceConfigs.\u00a0When a UE is configured with multiple CSI-ResourceConfigs consisting the same CSI-IM resource ID, the same time-domain behavior shall be configured for the CSI-ResourceConfigs. All CSI Resource Settings linked to a CSI Report Setting shall have the same time domain behavior.\nThe following are configured via higher layer signaling for one or more CSI Resource Settings for channel and interference measurement:\n-\tCSI-IM resource for interference measurement as described in Clause 5.2.2.4. \n-\tNZP CSI-RS resource for interference measurement as described in Clause 5.2.2.3.1.\n-\tNZP CSI-RS resource for channel measurement as described in Clause 5.2.2.3.1.\nThe UE may assume that the NZP CSI-RS resource(s) for channel measurement and the CSI-IM resource(s) for interference measurement configured for one CSI reporting are resource-wise QCLed with respect to 'typeD'. When NZP CSI-RS resource(s) is used for interference measurement, the UE may assume that the NZP CSI-RS resource for channel measurement and the CSI- IM resource or NZP CSI-RS resource(s) for interference measurement configured for one CSI reporting are QCLed with respect to 'typeD'.\nFor TDCP measurement, one periodic CSI Resource Setting is configured, and the Resource Setting is for channel measurement on CSI-RS for tracking.\nFor L1-SINR measurement:\n-\tWhen one Resource Setting is configured, the Resource Setting (given by higher layer parameter resourcesForChannelMeasurement) is for channel and interference measurement on NZP CSI-RS for L1-SINR computation. UE may assume that same 1 port NZP CSI-RS resource(s) with density 3 REs/RB is used for both channel and interference measurements. \n-\tWhen two Resource Settings are configured, the first one Resource Setting (given by higher layer parameter resourcesForChannelMeasurement) is for channel measurement on SSB or NZP CSI-RS and the second one (given by either higher layer parameter csi-IM-ResourcesForInterference or higher layer parameter nzp-CSI-RS-ResourcesForInterference) is for interference measurement performed on CSI-IM or on 1 port NZP CSI-RS with density 3 REs/RB, where each SSB or NZP CSI-RS resource for channel measurement is associated with one CSI-IM resource or one NZP CSI-RS resource for interference measurement by the ordering of the SSB or NZP CSI-RS resource for channel measurement and CSI-IM resource or NZP CSI-RS resource for interference measurement in the corresponding resource sets. The number of SSB(s) or CSI-RS resources for channel measurement equals to the number of CSI-IM resources or the number of NZP CSI-RS resource for interference measurement.\n-\tUE may apply the SSB, or 'typeD' RS configured with qcl-Type set to 'typeD' to the NZP CSI-RS resource for channel measurement, as the reference RS for determining 'typeD' assumption for the corresponding\u00a0CSI-IM resource or the corresponding NZP CSI-RS resource for interference measurement configured for one CSI reporting.\n-\tUE may expect that the NZP CSI-RS resource set for channel measurement and the NZP-CSI-RS resource set for interference measurement, if any, are configured with the higher layer parameter repetition.\nEach LTM CSI Resource Setting LTM-CSI-ResourceConfig contains configuration of a LTM-CSI-SSB-ResourceSet which comprises of a list of Z \u2265 1 SS/PBCH blocks indices (given by ltm-CSI-SSB-ResourceList) and a list of Z LTM-CandidateIds (given by ltm-CandidateIdList) referring to candidate cells associated with the SS/PBCH block indices. For each candidate cell, the UE determines the time domain behavior of a SS/PBCH block from ssb-Periodicity and ssb-PositionsInBurst and the frequency domain behavior of a SS/PBCH block is determined by the higher layer parameters subcarrierSpacing, ssbFrequency.\n5.2.1.3\t(void)\n5.2.1.4\tReporting configurations\nThe UE shall calculate CSI parameters (if reported) assuming the following dependencies between CSI parameters (if reported)\n-\tLI shall be calculated conditioned on the reported CQI, PMI, RI and CRI\n-\tCQI shall be calculated conditioned on the reported PMI, RI and CRI\n-\tPMI shall be calculated conditioned on the reported RI and CRI\n-\tRI shall be calculated conditioned on the reported CRI.\nThe Reporting configuration for CSI can be aperiodic (using PUSCH), periodic (using PUCCH) or semi-persistent (using PUCCH, and DCI activated PUSCH). The CSI-RS Resources can be periodic, semi-persistent, or aperiodic. Table 5.2.1.4-1 shows the supported combinations of CSI Reporting configurations and CSI-RS Resource configurations and how the CSI Reporting is triggered for each CSI-RS Resource configuration. Periodic CSI-RS is configured by higher layers. Semi-persistent CSI-RS is activated and deactivated as described in Clause 5.2.1.5.2. Aperiodic CSI-RS is configured and triggered/activated as described in Clause 5.2.1.5.1. \nTable 5.2.1.4-1: Triggering/Activation of CSI Reporting for the possible CSI-RS Configurations.\n\nWhen the UE is configured with higher layer parameter NZP-CSI-RS-ResourceSet and when the higher layer parameter repetition is set to 'off', the UE shall determine a CRI from the supported set of CRI values as defined in Clause 6.3.1.1.2 of [5, TS 38.212] and report the number in each CRI report. When the higher layer parameter repetition for a CSI-RS Resource Set for channel measurement is set to 'on', CRI for the CSI-RS Resource Set for channel measurement is not reported. CRI reporting is not supported when the higher layer parameter codebookType is set to 'typeII', 'typeII-PortSelection', 'typeII-r16', 'typeII-PortSelection-r16', 'typeII-PortSelection-r17', 'typeII-CJT-r18', 'typeII-CJT-PortSelection-r18', 'typeII-Doppler-r18' or 'typeII-Doppler-PortSelection-r18'.\nFor a periodic or semi-persistent CSI report on PUCCH, the periodicity  (measured in slots) and the slot offset  are configured by the higher layer parameter reportSlotConfig. Unless specified otherwise, the UE shall transmit the CSI report in frames with SFN  and slot number within the frame  satisfying\n\t\nwhere  is the SCS configuration of the UL BWP the CSI report is transmitted on.\nFor a semi-persistent CSI report on PUSCH, the periodicity  (measured in slots) is configured by the higher layer parameter reportSlotConfig. Unless specified otherwise, the UE shall transmit the CSI report in frames with SFN  and slot number within the frame  satisfying\n\t\nwhere  and  are the SFN and slot number within the frame respectively of the initial semi-persistent PUSCH transmission according to the activating DCI.\nFor a semi-persistent or aperiodic CSI report on PUSCH, the allowed slot offsets are configured by the following higher layer parameters:\n-\tif triggered/activated by DCI format 0_2 and the higher layer parameter reportSlotOffsetListDCI-0-2 or reportSlotOffsetListDCI-0-2-r17 is configured, the allowed slot offsets are configured by reportSlotOffsetListDCI-0-2 or reportSlotOffsetListDCI-0-2-r17, and \n-\tif triggered/activated by DCI format 0_1 or 0_3 and the higher layer parameter reportSlotOffsetListDCI-0-1 or reportSlotOffsetListDCI-0-1-r17 is configured, the allowed slot offsets are configured by reportSlotOffsetListDCI-0-1 or reportSlotOffsetListDCI-0-1-r17, and\n-\totherwise, the allowed slot offsets are configured by the higher layer parameter reportSlotOffsetList or reportSlotOffsetList-r17.\nThe offset is selected in the activating/triggering DCI.\nFor CSI reporting, a UE can be configured via higher layer signaling with one out of two possible subband sizes, where a subband is defined as  contiguous PRBs and depends on the total number of PRBs in the bandwidth part according to Table 5.2.1.4-2.\n\nTable 5.2.1.4-2: Configurable subband sizes\n\nThe reportFreqConfiguration contained in a CSI-ReportConfig indicates the frequency granularity of the CSI Report. A CSI Reporting Setting configuration defines a CSI reporting band as a subset of subbands of the bandwidth part, where the reportFreqConfiguration indicates: \n-\tthe csi-ReportingBand as a contiguous or non-contiguous subset of subbands in the bandwidth part for which CSI shall be reported. \n-\tA UE is not expected to be configured with csi-ReportingBand which contains a subband where a CSI-RS resource linked to the CSI Report setting has the frequency density of each CSI-RS port per PRB in the subband less than the configured density of the CSI-RS resource.\n-\tIf a CSI-IM resource is linked to the CSI Report Setting, a UE is not expected to be configured with csi-ReportingBand which contains a subband where not all PRBs in the subband have the CSI-IM REs present.\n-\twideband CQI or subband CQI reporting, as configured by the higher layer parameter cqi-FormatIndicator. When wideband CQI reporting is configured, a wideband CQI is reported for each codeword for the entire CSI reporting band. When subband CQI reporting is configured, one CQI for each codeword is reported for each subband in the CSI reporting band.\n-\twideband PMI or subband PMI reporting as configured by the higher layer parameter pmi-FormatIndicator. When wideband PMI reporting is configured, a wideband PMI is reported for the entire CSI reporting band. When subband PMI reporting is configured, except with 2 antenna ports, a single wideband indication (i1 in Clause 5.2.2.2) is reported for the entire CSI reporting band and one subband indication (i2 in clause 5.2.2.2) is reported for each subband in the CSI reporting band. When subband PMIs are configured with 2 antenna ports, a PMI is reported for each subband in the CSI reporting band. \n-\ta UE is not expected to be configured with pmi-FormatIndicator if codebookType is set to 'typeII-r16', 'typeII-PortSelection-r16', 'typeII-PortSelection-r17', 'typeII-CJT-r18', 'typeII-CJT-PortSelection-r18', 'typeII-Doppler-r18' or 'typeII-Doppler-PortSelection-r18'.\nA CSI Reporting Setting is said to have a wideband frequency-granularity if \n-\treportQuantity is set to 'cri-RI-PMI-CQI', or 'cri-RI-LI-PMI-CQI', cqi-FormatIndicator is set to 'widebandCQI' and pmi-FormatIndicator is set to 'widebandPMI', or\n-\treportQuantity is set to 'cri-RI-PMI-CQI', codebookType is set to 'typeII-PortSelection-r17', 'typeII-CJT-PortSelection-r18' or 'typeII-Doppler-PortSelection-r18' with  and cqi-FormatIndicator is set to 'widebandCQI', or\n-\treportQuantity is set to 'cri-RI-i1' or\n-\treportQuantity is set to 'cri-RI-CQI' or 'cri-RI-i1-CQI' and cqi-FormatIndicator is set to 'widebandCQI', or\n-\treportQuantity is set to 'cri-RSRP' or 'ssb-Index-RSRP' or 'cri-SINR', or 'ssb-Index-SINR' or 'cri-RSRP-Index' or 'ssb-Index-RSRP-Index' or 'cri-SINR-Index', or 'ssb-Index-SINR-Index', or\n-\treportQuantity is set to 'tdcp'\notherwise, the CSI Reporting Setting is said to have a subband frequency-granularity.\nA CSI Reporting Setting with codebookType set to 'typeI-SinglePanel' and the corresponding CSI-RS Resource Set for channel measurement configured with two Resource Groups and  Resource Pairs, as described in clause 5.2.1.4.1, can be configured with wideband frequency-granularity only if csi-ReportMode is set to 'Mode1' and numberOfSingleTRP-CSI-Mode1 is set to , as described in clause 5.2.1.4.2.\nIf the UE is configured with a CSI Reporting Setting for a bandwidth part with fewer than 24 PRBs, the CSI reporting setting is expected to have a wideband frequency-granularity, and, if applicable, the higher layer parameter codebookType is set to 'typeI-SinglePanel'.\nThe first subband size is given by  and the last subband size given by  if  and if \nIf a UE is configured with semi-persistent CSI reporting, the UE shall report CSI when both CSI-IM and NZP CSI-RS resources are configured as periodic or semi-persistent. If a UE is configured with aperiodic CSI reporting, the UE shall report CSI when both CSI-IM and NZP CSI-RS resources are configured as periodic, semi-persistent or aperiodic. \nA UE configured with DCI format 0_1, 0_2 or 0_3 does not expect to be triggered with multiple CSI reports with the same CSI-ReportConfigId.\n5.2.1.4.1\tResource Setting configuration\nFor aperiodic CSI, each trigger state configured using the higher layer parameter CSI-AperiodicTriggerState is associated with one or multiple CSI-ReportConfig where the CSI-ReportConfig not configured with groupBasedBeamReporting-r17 or groupBasedBeamReporting-v18 is linked to periodic, or semi-persistent, or aperiodic resource setting(s): \n-\tWhen one Resource Setting is configured, the Resource Setting (given by higher layer parameter resourcesForChannelMeasurement) is for channel measurement for L1-RSRP or for channel and interference measurement for L1-SINR computation.\n-\tWhen two Resource Settings are configured, the first one Resource Setting (given by higher layer parameter resourcesForChannelMeasurement) is for channel measurement and the second one (given by either higher layer parameter csi-IM-ResourcesForInterference or higher layer parameter nzp-CSI-RS-ResourcesForInterference) is for interference measurement performed on CSI-IM or on NZP CSI-RS.\n-\tWhen three Resource Settings are configured, the first Resource Setting (higher layer parameter resourcesForChannelMeasurement) is for channel measurement, the second one (given by higher layer parameter csi-IM-ResourcesForInterference) is for CSI-IM based interference measurement and the third one (given by higher layer parameter nzp-CSI-RS-ResourcesForInterference) is for NZP CSI-RS based interference measurement.\nFor aperiodic CSI, and for periodic and semi-persistent CSI resource settings, each trigger state configured using the higher layer parameter CSI-AperiodicTriggerState is associated with one or multiple CSI-ReportConfig where the CSI-ReportConfig configured with groupBasedBeamReporting-r17 or groupBasedBeamReporting-v18 is linked to periodic or semi-persistent, setting(s): \n-\tWhen one Resource Setting is configured, the Resource setting is given by resourcesForChannelMeasurement for L1-RSRP measurement. In such a case, the number of configured CSI Resource Sets in the Resource Setting is S=2\nFor aperiodic CSI, and for aperiodic CSI resource settings, each trigger state configured using the higher layer parameter CSI-AperiodicTriggerState is associated with one or multiple CSI-ReportConfig where the CSI-ReportConfig configured with groupBasedBeamReporting-r17 or groupBasedBeamReporting-v18 is associated with resourcesForChannel and resourcesForChannel2, which correspond to first and second resource sets, respectively, for L1-RSRP measurement.\nFor semi-persistent or periodic CSI, each CSI-ReportConfig is linked to periodic or semi-persistent Resource Setting(s):\n-\tWhen one Resource Setting (given by higher layer parameter resourcesForChannelMeasurement) is configured, the Resource Setting is for channel measurement for L1-RSRP or for channel and interference measurement for L1-SINR computation.\n-\tWhen two Resource Settings are configured, the first Resource Setting (given by higher layer parameter resourcesForChannelMeasurement) is for channel measurement and the second Resource Setting (given by higher layer parameter csi-IM-ResourcesForInterference) is used for interference measurement performed on CSI-IM. For L1-SINR computation, the second Resource Setting (given by higher layer parameter csi-IM-ResourcesForInterference or higher layer parameter nzp-CSI-RS-ResourceForInterference) is used for interference measurement performed on CSI-IM or on NZP CSI-RS.\nFor aperiodic CSI, a UE configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'tdcp' is expected to be configured with one CSI Resource Setting (given by higher layer parameter resourcesForChannelMeasurement). The CSI Resource Setting may be periodic, with  CSI-RS Resource Sets configured with higher layer parameter trs-Info. The support of  or 3 is subject to UE capability indication. For a periodic CSI-ResourceConfig, the UE can assume that all the CSI-RS resources in the  CSI-RS Resource Sets share the same QCL-TypeA/C and, if applicable, TypeD. The UE expects that all the CSI-RS resources in the CSI-RS Resource Set(s) are configured with the same bandwidth and subcarrier locations. A UE configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'tdcp' is not expected to be configured with interference measurement on CSI-IM and/or NZP-CSI-RS.\nFor a UE configured with LTM-CSI-ReportConfig, the aperiodic, semi-persistent or periodic CSI are associated with one Resource Setting given by ltm-ResourcesForChannelMeasurement for L1-RSRP measurement.\nA UE is not expected to be configured with more than one CSI-RS resource in resource set for channel measurement for a CSI-ReportConfig with the higher layer parameter codebookType set to 'typeII', 'typeII-PortSelection', 'typeII-r16', 'typeII-PortSelection-r16', or 'typeII-PortSelection-r17'. A UE is not expected to be configured with more than 64 NZP CSI-RS resources and/or SS/PBCH block resources in resource setting for channel measurement for a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'none', 'cri-RI-CQI', 'cri-RSRP', 'ssb-Index-RSRP', 'cri-SINR' or 'ssb-Index-SINR', 'cri-RSRP- Index', 'ssb-Index-RSRP- Index', 'cri-SINR- Index' or 'ssb-Index-SINR- Index'. If interference measurement is performed on CSI-IM, each CSI-RS resource for channel measurement is resource-wise associated with a CSI-IM resource by the ordering of the CSI-RS resource and CSI-IM resource in the corresponding resource sets. The number of CSI-RS resources for channel measurement equals to the number of CSI-IM resources.\nA UE configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'cri-RI-PMI-CQI' and codebookType set to 'typeII-CJT-r18' or 'typeII-CJT-PortSelection-r18' is expected to be configured with  CSI-RS resources in a resource set for channel measurement. If interference measurement is performed on CSI-IM, only one resource is configured in the corresponding csi-IM-ResourceSet. If interference measurement is performed on NZP CSI-RS, only one resource is configured in the corresponding NZP-CSI-RS-ResourceSet for interference measurement.\nA UE configured with a CSI-ReportConfig with the higher layer parameter N4 and reportQuantity set to 'cri-RI-PMI-CQI', is expected to be configured with  aperiodic CSI-RS resources or with a single periodic or semi-persistent CSI-RS resource in the resource set for channel measurement. For an aperiodic CSI-RS resource set for channel measurement, the  CSI-RS resources are triggered by the same triggering instance and the separation between two consecutive CSI-RS resources is  slots, which is configured by higher layer parameter in the NZP-CSI-RS-ResourceSet. The K aperiodic CSI-RS resources are transmitted following the order of the CSI-RS resource IDs configured in the CSI-RS resource set. The UE shall assume that the antenna port with the same port index of the  aperiodic CSI-RS resources is the same. If interference measurement is performed on CSI-IM, only one resource is configured in the corresponding csi-IM-ResourceSet. If interference measurement is performed on NZP CSI-RS, only one resource is configured in the corresponding NZP-CSI-RS-ResourceSet for interference measurement.\nAn NZP CSI-RS Resource Set for channel measurement with  resources can be configured with two Resource Groups, with  resources in Group 1 and  resources in Group 2, such that , and with  Resource Pairs. Each Resource Pair consists of one resource from Group 1 and one resource from Group 2. The same resource can be associated with two Resource Pairs in frequency range 1 but not in frequency range 2.\nA subset of resources, where a subset contains one or more resources, of a NZP CSI-RS Resource Set for channel measurement corresponds to a sub-configuration contained in a CSI-ReportConfig if each of the sub-configuration(s) contains a list of one or more NZP CSI-RS resources, or all the resources of a NZP CSI-RS Resource Set for channel measurement correspond to each of the sub-configuration(s) contained in a CSI-ReportConfig if each of the sub-configurations does not contain a list of NZP CSI-RS resources, as described in Clause 5.2.1.4.2.\nExcept for L1-SINR, codebookType set to 'typeII-CJT-r18', 'typeII-CJT-PortSelection-r18', 'typeII-Doppler-r18', or 'typeII-Doppler-PortSelection-r18', if interference measurement is performed on NZP CSI-RS, a UE does not expect to be configured with more than one NZP CSI-RS resource in the associated resource set within the resource setting for channel measurement. Except for L1-SINR, the UE configured with the higher layer parameter nzp-CSI-RS-ResourcesForInterference may expect no more than 18 NZP CSI-RS ports configured in a NZP CSI-RS resource set.\nFor CSI measurement(s) other than L1-SINR, a UE assumes: \n-\teach NZP CSI-RS port configured for interference measurement corresponds to an interference transmission layer.\n-\tall interference transmission layers on NZP CSI-RS ports for interference measurement take into account the associated EPRE ratios configured in 5.2.2.3.1; \n-\tother interference signal on REs of NZP CSI-RS resource for channel measurement, NZP CSI-RS resource for interference measurement, or CSI-IM resource for interference measurement. \nFor L1-SINR measurement with dedicated interference measurement resources, a UE assumes:\n-\tthe total received power on dedicated NZP CSI-RS resource for interference measurement or dedicated CSI-IM resource for interference measurement corresponds to interference and noise.\n5.2.1.4.2\tReport quantity configurations\nA UE may be configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to either 'none', 'cri-RI-PMI-CQI ', 'cri-RI-i1', 'cri-RI-i1-CQI', 'cri-RI-CQI', 'cri-RSRP', 'cri-SINR', 'ssb-Index-RSRP', 'ssb-Index-SINR', 'cri-RI-LI-PMI-CQI', 'cri-RSRP- Index', 'ssb-Index-RSRP- Index', 'cri-SINR- Index', 'ssb-Index-SINR- Index' or 'tdcp'.\nIf the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'none', then the UE shall not report any quantity for the CSI-ReportConfig. \nIf the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'cri-RI-PMI-CQI', or 'cri-RI-LI-PMI-CQI', the UE shall report a preferred precoder matrix for the entire reporting band, or a preferred precoder matrix per subband, according to Clause 5.2.2.2.\nIf the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'cri-RI-i1',\n-\tthe UE expects, for that CSI-ReportConfig, to be configured with higher layer parameter codebookType set to 'typeI-SinglePanel' and pmi-FormatIndicator set to 'widebandPMI' and,\n-\tthe UE shall report a PMI consisting of a single wideband indication ( in Clause 5.2.2.2.1) for the entire CSI reporting band.\nIf the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'cri-RI-i1-CQI',\n-\tthe UE expects, for that CSI-ReportConfig, to be configured with higher layer parameter codebookType set to 'typeI-SinglePanel' and pmi-FormatIndicator set to 'widebandPMI' and,\n-\tthe UE shall report a PMI consisting of a single wideband indication ( in Clause 5.2.2.2.1) for the entire CSI reporting band. The CQI is calculated conditioned on the reported assuming PDSCH transmission with  precoders (corresponding to the same but different  in Clause 5.2.2.2.1), where the UE assumes that one precoder is randomly selected from the set of  precoders for each PRG on PDSCH, where the PRG size for CQI calculation is configured by the higher layer parameter pdsch-BundleSizeForCSI.\nIf the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'cri-RI-CQI', \n-\tif the UE is configured with higher layer parameter non-PMI-PortIndication contained in a CSI-ReportConfig, r ports are indicated in the order of layer ordering for rank r and each CSI-RS resource in the CSI resource setting is linked to the CSI-ReportConfig based on the order of the associated NZP-CSI-RS-ResourceId in the linked CSI resource setting for channel measurement given by higher layer parameter resourcesForChannelMeasurement. The configured higher layer parameter non-PMI-PortIndication contains a sequence  of port indices, where  are the CSI-RS port indices associated with rank \u03bd and  where is the number of ports in the CSI-RS resource. The UE shall only report RI corresponding to the configured fields of PortIndexFor8Ranks. If the UE is configured with a CSI-ReportConfig that contains a list of sub-configurations with [port-subsetIndicator] configured in each sub-configuration, and the higher layer parameter non-PMI-PortIndication is separately provided for a sub-configuration, then  corresponds to the number of bits with value 1 in the bitmap [port-subsetIndicator] for the sub-configuration and the CSI-RS port indices are derived by mapping antenna ports corresponding to all bits with value of 1 in [port-subsetIndicator] as consecutive antenna ports starting at CSI-RS port index 0 in increasing order of the bit position in [port-subsetIndicator].\n-\tif the UE is not configured with higher layer parameter non-PMI-PortIndication, the UE assumes, for each CSI-RS resource in the CSI resource setting linked to the CSI-ReportConfig, that the CSI-RS port indices  are associated with ranks  where  is the number of ports in the CSI-RS resource. If the UE is configured with a CSI-ReportConfig that contains a list of sub-configurations with [port-subsetIndicator] configured in each sub-configuration and the higher layer parameter non-PMI-PortIndication is not provided for a sub-configuration, then  corresponds to the number of bits with value 1 in the bitmap [port-subsetIndicator] for the sub-configuration and the CSI-RS port indices are derived by mapping antenna ports corresponding to all bits with value of 1 in [port-subsetIndicator] as consecutive antenna ports starting at CSI-RS port index 0 in increasing order of the bit position in [port-subsetIndicator].\n-\tWhen calculating the CQI for a rank, the UE shall use the ports indicated for that rank for the selected CSI-RS resource. The precoder for the indicated ports shall be assumed to be the identity matrix scaled by .\nIf the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'cri-RSRP', 'ssb-Index-RSRP', 'cri-RSRP- Index' or 'ssb-Index-RSRP- Index',\n-\tif the UE is configured with the higher layer parameter groupBasedBeamReporting set to 'disabled', the UE is not required to update measurements for more than 64 CSI-RS and/or SSB resources, and the UE shall report in a single report nrofReportedRS (higher layer configured) different CRI or SSBRI for each report setting. \n-\tif the UE is configured with the higher layer parameter groupBasedBeamReporting set to 'enabled', the UE is not required to update measurements for more than 64 CSI-RS and/or SSB resources, and the UE shall report in a single reporting instance two different CRI or SSBRI for each report setting, where CSI-RS and/or SSB resources can be received simultaneously by the UE either with a single spatial domain receive filter, or with multiple simultaneous spatial domain receive filters. \n-\tif the UE is configured with the higher layer parameter groupBasedBeamReporting-r17, the UE is not required to update measurements for more than 64 CSI-RS and/or SSB resources, and the UE shall report in a single reporting instance nrofReportedGroups, if configured, group(s) of two CRIs or SSBRIs selecting one CSI-RS or SSB from each of the two CSI Resource Sets for the report setting, where CSI-RS and/or SSB resources of each group can be received simultaneously by the UE.\n-\tif the UE is configured with the higher layer parameter groupBasedBeamReporting-v18 set to JointULandDL, the UE is not required to update measurements for more than 64 CSI-RS and/or SSB resources, and the UE shall report in a single reporting instance nrofReportedGroups-r18, if configured, group(s) of two CRIs or SSBRIs selecting one CSI-RS or SSB from each of the two CSI Resource Sets for the report setting, where CSI-RS and/or SSB resources of each group can be received simultaneously and applied for simultaneous  transmission with spatial filters by the UE subject to UE capability.\n- \tif the UE is configured with the higher layer parameter groupBasedBeamReporting-v18 set to ULOnly, the UE is not required to update measurements for more than 64 CSI-RS and/or SSB resources, and the UE shall report in a single reporting instance nrofReportedGroups-r18, if configured, group(s) of two CRIs or SSBRIs selecting one CSI-RS or SSB from each of the two CSI Resource Sets for the report setting, where CSI-RS and/or SSB resources of each group can be applied for simultaneous  transmission with spatial filters by the UE subject to UE capability.\nIf the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'cri-SINR', 'ssb-Index-SINR', 'cri-SINR- Index' or 'ssb-Index-SINR- Index', \n-\tif the UE is configured with the higher layer parameter groupBasedBeamReporting set to 'disabled', the UE shall report in a single report nrofReportedRS (higher layer configured) different CRI or SSBRI for each report setting.\n-\tif the UE is configured with the higher layer parameter groupBasedBeamReporting set to 'enabled', the UE shall report in a single reporting instance two different CRI or SSBRI for each report setting, where CSI-RS and/or SSB resources can be received simultaneously by the UE.\nIf the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'tdcp'\n-\tthe value of  is configured by higher layer parameter Y, and  delay values, , are configured by higher layer parameter D, such that the UE is expected to report the amplitude of TDCP measurement, as defined in Clause 5.1 of [7, TS 38.215], for each of the configured delays. Values of  can be configured subject to UE capability. The configurable delay values are , , where the value  is restricted to subcarrier spacing configuration , the values other than  are applicable to subcarrier spacing configurations , and where the values  can be configured subject to UE capability, with .\n-\tFor , if the higher layer parameter phase is configured, the UE is expected to report the amplitude and phase of TDCP measurement for each of the configured delays, if supported by UE capability.\nExcept for a CSI-ReportConfig configured with reportQuantity set to 'cri-RI-PMI-CQI' and codebookType set to 'typeII-CJT-r18', 'typeII-CJT-PortSelection-r18', 'typeII-Doppler-r18', or 'typeII-Doppler-PortSelection-r18', if the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'cri-RSRP', 'cri-RI-PMI-CQI ', 'cri-RI-i1', 'cri-RI-i1-CQI', 'cri-RI-CQI', 'cri-RI-LI-PMI-CQI', 'cri-SINR', or 'cri-SINR- Index ', and resources are configured in the corresponding resource set for channel measurement, then the UE shall derive the CSI parameters other than CRI conditioned on the reported CRI, where CRI k (k \u2265 0) corresponds to the configured (k+1)-th entry of associated nzp-CSI-RS-Resources in the corresponding NZP-CSI-RS-ResourceSet for channel measurement, and (k+1)-th entry of associated csi-IM-Resource in the corresponding csi-IM-ResourceSet (if configured) or (k+1)-th entry of associated nzp-CSI-RS-Resources in the corresponding NZP-CSI-RS-ResourceSet (if configured for\u00a0CSI-ReportConfig\u00a0with\u00a0reportQuantity set to 'cri-SINR' or 'cri-SINR- Index ') for interference measurement. If CSI-RS resources are configured, each resource shall contain at most 16 CSI-RS ports. If CSI-RS resources are configured, each resource shall contain at most 8 CSI-RS ports. \nIf the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'cri-RI-PMI-CQI', codebookType set to 'typeII-CJT-r18' or 'typeII-CJT-PortSelection-r18' and the corresponding NZP-CSI-RS-ResourceSet for channel measurement is configured with  resources, each resource can contain, at most, 32 CSI-RS ports.\nSubject to UE capability, a UE configured with a CSI-ReportConfig with the higher layer parameter N4 and reportQuantity set to 'cri-RI-PMI-CQI' is assumed to support UE-side CSI prediction. The reported PMI indicates predicted precoder matrices associated with  consecutive slot intervals, each with duration of  slots, where the value of  is configured by higher layer parameter N4. If the UE is configured with an aperiodic CSI-RS resource set for channel measurement, the value, in number of slots, of the time unit  is configured by higher layer parameter d, where  is defined in Clause 5.2.1.4.1. If the UE is configured with a periodic or semi-persistent CSI-RS resource set for channel measurement, the value of  is equal to the periodicity of the CSI-RS resource. The earliest of the  slot intervals starts at slot , where  is the uplink slot in which the CSI is reported and the slot offset  is configured by higher layer parameter delta, where  defined in Clause 5.2.2.5 and the value  can be configured subject to UE capability.\n-\tFor , the UE is expected to report a predicted PMI for slot interval  and the slot offset value  can be configured only for . A UE can be configured with  if the higher layer parameter codebookType is set to 'typeII-Doppler-r18', or 'typeII-Doppler-PortSelection-r18'.\n-\tThe reported CQI is associated with slot  and the reported PMI.\n-\tFor , the UE is expected to report a PMI which indicates predicted precoder matrices associated with slot intervals , for . A UE can be configured with  if the higher layer parameter codebookType is set to 'typeII-Doppler-r18'.\n-\tThe UE is configured by higher layer parameter TDCQI to report  CQIs for each subband in the CSI reporting band, if cqi-FormatIndicator is set to 'subbandCQI', or   CQIs for the entire CSI reporting band, if cqi-FormatIndicator is set to 'widebandCQI'. For , the second CQI includes a 4-bit wideband CQI index and, if subband CQI reporting is configured, a 2-bit subband CQI index, calculated independently from the first CQI, as described in Clause 5.2.2.1, and the two CQIs are reported in the same CSI report. \n-\tIf the higher layer parameter TDCQI is set to '1-1',  and the CQI is associated with slot  and the precoder matrices for slot interval .\n-\tIf the higher layer parameter TDCQI is set to '1-2',  and the CQI is associated with slot  and the precoder matrices for slot interval  and with slot  and the precoder matrices for slot interval .\n-\tIf the higher layer parameter TDCQI is set to '2', . The first CQI is associated with slot  and the precoder matrices for slot interval . The second CQI is associated with slot  and the precoder matrices for slot interval .\nIf the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'cri-RI-PMI-CQI', or 'cri-RI-LI-PMI-CQI' and the corresponding NZP-CSI-RS-ResourceSet for channel measurement is configured with  resources, two Resource Groups with  resources in Group 1,  resources in Group 2, , and  Resource Pairs:\n-\teach resource can contain, subject to UE capability, at most 32 CSI-RS ports. For two Resource Groups with   resources (i=1,2), if , the resource in NZP-CSI-RS-ResourceSet shall contain at most 32 CSI-RS ports; if , each resource in NZP-CSI-RS-ResourceSet shall contain at most 16 CSI-RS ports; if  , each resource in NZP-CSI-RS-ResourceSet shall contain at most 8 CSI-RS ports.\n-\teach of the  Resource Pairs is associated to a CRI value.\n-\tThe CSI-ReportConfig may be configured with higher layer parameter sharedCMR.  and  are the numbers of resources associated to a CRI value, other than the N CRIs defined above, in Group 1 and Group 2, respectively, with , such that the total number of CRI values configured for the CSI-ReportConfig is .\n-\tIf the higher layer parameter csi-ReportMode is set to 'Mode1' and the higher layer parameter numberOfSingleTRP-CSI-Mode1 is set to , ; otherwise,\n-\tif the higher layer parameter csi-ReportMode is set to 'Mode1' and the higher layer parameter numberOfSingleTRP-CSI-Mode1 is set to , or if csi-ReportMode is set to 'Mode2',\n-\tif sharedCMR is configured:  and ; otherwise \n-\tif sharedCMR is not configured, only the resources in Group 1 and Group 2 that are not referred to in any Resource Pair are associated to M CRI values other than the N CRIs defined above.\n-\tIf interference measurement is performed on CSI-IM,  resources are configured in the corresponding csi-IM-ResourceSet. The  resources for channel measurement defined above are resource-wise associated with the first  CSI-IM resources by the ordering of the CSI-RS resources and CSI-IM resources in the corresponding Resource Set. The  Resource Pairs for channel measurement are associated to the last  CSI-IM resources by the ordering of the CSI-RS Resource Pairs and CSI-IM resources in the CSI-IM Resource Set. The UE may assume that the two CSI-RS resources for channel measurement in a Resource Pair and the associated CSI-IM resource for interference measurement are resource-wise QCLed with respect to 'typeD'.\n-\tThe UE is not expected to be configured with NZP CSI-RS for interference measurement other than the NZP CSI-RS resources for channel measurement configured in the  Resource Pairs.\n-\tThe UE expects, for that CSI-ReportConfig, to be configured with higher layer parameter codebookType set to 'typeI-SinglePanel', and\n-\tThe UE shall derive the CSI parameters other than CRI(s) conditioned on the reported CRI(s), as follows:\n-\tIf the higher layer parameter csi-ReportMode is set to 'Mode1' and the higher layer parameter numberOfSingleTRP-CSI-Mode1 is set to ,  CRI(s) are reported:\n-\tone CRI  corresponds to the configured -th entry of the associated  Resource Pairs in the corresponding CSI-RS Resource Set for channel measurement, and -th entry of the corresponding CSI-IM Resource Set, if configured. The UE shall report two RIs, two PMIs, two LIs (if configured), associated to the resource in Group 1 and the resource in Group 2, respectively, of the -th Resource Pair, and one CQI; and\n-\tif , one CRI  () corresponds to the configured -th entry of the associated  resources in the corresponding CSI-RS Resource Set for channel measurement, and -th entry of the corresponding CSI-IM Resource Set, if configured. The UE shall report one RI, one PMI, one LI (if configured) and one or two CQIs conditioned on CRI ; or\n-\tif , one CRI   corresponds to the configured -th entry of the associated  resources in Group 1 of the corresponding CSI-RS Resource Set for channel measurement, and -th entry of the associated resources in the corresponding CSI-IM Resource Set, if configured, and one CRI   corresponds to the configured -th entry of the associated  resources in Group 2 of the corresponding CSI-RS Resource Set for channel measurement, and -th entry of the corresponding CSI-IM Resource Set, if configured. The UE shall report one RI, one PMI, one LI (if configured) and one or two CQIs conditioned on CRI  and one RI, one PMI, one LI (if configured) and one or two CQIs conditioned on CRI .\n-\tIf the higher layer parameter csi-ReportMode is set to 'Mode2', one CRI   is reported, which corresponds to the -th entry of the  resources or Resource Pairs in the corresponding CSI-RS Resource Set for channel measurement, and -th entry of the associated resources in the corresponding CSI-IM Resource Set, if configured. The first  codepoints of the CRI correspond to resources associated to Group 1 and Group 2. The last  codepoints of the CRI correspond to the  configured Resource Pairs. The UE shall report one RI, one PMI, one LI, if configured, and one or two CQIs conditioned on CRI  if ; or two RIs, two PMIs, two LIs, if configured, associated to the resource in Group 1 and the resource in Group 2, respectively, of the -th Resource Pair, and one CQI, otherwise.\n-\tFor a reported CRI corresponding to an entry of the  Resource Pairs configured in the corresponding CSI-RS Resource Set for channel measurement:\n-\tthe UE shall not report a total number of layers larger than four.\n-\tthe two RIs are reported with a joint RI index corresponding to one of the four rank combinations: .\n-\tThe CodebookConfig in CSI-ReportConfig can be configured with two RI restriction parameters typeI-SinglePanel-ri-RestrictionSTRP and typeI-SinglePanel-ri-RestrictionSDM. The parameter typeI-SinglePanel-ri-RestrictionSTRP applies to a reported RI when conditioned on a CRI corresponding to an entry of the  CSI-RS resources defined above. The bitmap parameter typeI-SinglePanel-ri-RestrictionSTRP forms the bit sequence  where  is the LSB and  is the MSB. When  is zero, , PMI and RI reporting are not allowed to correspond to any precoder associated with  layers. The parameter typeI-SinglePanel-ri-RestrictionSDM applies to a reported joint RI index when conditioned on a CRI corresponding to an entry of the  Resource Pairs and indicates one or more of the four rank combinations that are allowed to correspond to the reported PMIs and RIs. The bitmap parameter typeI-SinglePanel-ri-RestrictionSDM forms the bit sequence  where  is the LSB and  is the MSB. When  is zero, , PMI and RI reporting are not allowed to correspond to any precoder associated with the -th rank combination in the following order: {1,1}, {1,2}, {2,1},{2,2}.\n-\tThe CodebookConfig in CSI-ReportConfig can be configured with two Codebook Subset Restrictions. The first restriction applies to a reported PMI associated to a CSI-RS resource in Group 1. The second restriction applies to a reported PMI associated to a CSI-RS resource in Group 2.\nIf the UE is configured with a CSI-ReportConfig that contains a list of sub-configurations, provided by [csi-ReportSubConfigList]:\n-\tThe UE expects to be configured with the higher layer parameter codebookType set to 'typeI-SinglePanel' or 'typeI-MultiPanel'. If the UE indicates a capability for supporting mixed codebook combination in a slot with [ABC], each sub-configuration can be configured with the higher layer parameter codebookType set to 'typeI-SinglePanel' or 'typeI-MultiPanel'. \n-\tEach sub-configuration can be configured with an antenna port subset using the higher layer bitmap parameter [port-subsetIndicator] which contains the bit sequence , where  is the MSB and  is the LSB, bit  corresponds to antenna port , and  is the number of ports nrofPorts configured for the CSI-RS resources(s) within a NZP-CSI-RS-ResourceSet contained in the CSI-ResourceConfig for channel measurement that corresponds to the CSI-ReportConfig. A bit value 0 in [port-subsetIndicator] indicates that the corresponding antenna port is disabled for the sub-configuration, whereas bit value 1 indicates that the antenna port is enabled and belongs to the antenna port subset for the sub-configuration. For the derivation of PMI, antenna ports corresponding to all bits with value of 1 in [port-subsetIndicator] are mapped to consecutive antenna ports starting at CSI-RS antenna port 3000 in increasing order of the bit position in [port-subsetIndicator].\n-\tIf a sub-configuration is configured with an antenna port subset, then the sub-configuration can be configured with a [RI restriction parameter] and, if the number of antenna ports of the subset greater than 2, with [n1-n2 parameter] if the higher layer parameter codebookType is set to 'typeI-SinglePanel' or with [ng-n1-n2 parameter] if the higher layer parameter codebookType is set to 'typeI-MultiPanel', and, if the corresponding number of antenna ports of the subset is 2, with twoTX-CodebookSubsetRestriction, where the parameters [RI restriction],  [n1-n2], [ng-n1-n2], twoTX-CodebookSubsetRestriction are as described in Clauses 5.2.2.2.1 and 5.2.2.2.2. If a sub-configuration is configured with an antenna port subset, and if higher layer parameter reportQuantity is set to 'cri-RI-i1-CQI', and if the higher layer parameter codebookType is set to 'typeI-SinglePanel', then the sub-configuration can be configured with higher layer parameter typeI-SinglePanel-codebookSubsetRestriction-i2, where typeI-SinglePanel-codebookSubsetRestriction-i2 is as described in Clause 5.2.2.2.1.\n-\tIf a sub-configuration is configured with an antenna port subset, and if the CSI-ReportConfig that contains a mix of sub-configuration(s) each corresponding to 'typeI-SinglePanel' some other sub-configuration(s)  each corresponding to 'typeI-MultiPanel', then the sub-configuration(s) can be configured with the higher layer parameter codebookMode.\n-\tA sub-configuration can be configured with a power offset provided by [powerOffset].\n-\tA sub-configuration can be configured with a list of NZP CSI-RS resources, provided by [nzp-CSI-RS-resourceList], which indicates one or more NZP CSI-RS resources, within a NZP-CSI-RS-ResourceSet contained in the CSI-ResourceConfig for channel measurement which corresponds to the CSI-ReportConfig. If there is no sub-configuration configured with a power offset provided by [powerOffset], the list of NZP CSI-RS resources has no intersection with a list of NZP CSI-RS resources configured for any other sub-configuration(s) within the CSI-ReportConfig, otherwise, the list of NZP CSI-RS resources is identical to or has no intersection with a list of NZP CSI-RS resources configured for any other sub-configuration(s) within the CSI-ReportConfig.\n-\tIf a sub-configuration is configured with a list of NZP CSI-RS resources with more than one resource, the UE shall derive the CSI parameters other than CRI conditioned on the reported CRI, where the CRI k (k \u2265 0) for the sub-configuration corresponds to the configured (k+1)-th entry of associated NZP-CSI-RS-Resource in the list of NZP CSI-RS resources.\n-\tIf a sub-configurations is not configured with [nzp-CSI-RS-resourceList] then the sub-configuration shall be associated with all the NZP CSI-RS resources within a NZP-CSI-RS-ResourceSet contained in the CSI-ResourceConfig for channel measurement which corresponds to the CSI-ReportConfig.\n-\tthe UE reports CSI(s) for one or more sub-configurations according to Clauses 5.2.1.5.1, 5.2.1.5.2, 5.2.3 and 5.2.4, and according to the higher layer parameter reportQuantity configured for that CSI-ReportConfig.\n-\tThe UE does not expect the higher layer parameter reportQuantity to be set to 'cri-RSRP', 'cri-SINR', 'cri-SINR- Index', 'cri-RSRP-Index', 'none', 'ssb-Index-RSRP', 'ssb-Index-SINR', 'ssb-Index-RSRP- Index', 'ssb-Index-SINR- Index', or 'tdcp'.\nIf the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'ssb-Index-RSRP' or 'ssb-Index-RSRP- Index', the UE shall report SSBRI, where SSBRI k (k \u2265 0) corresponds to the configured (k+1)-th entry of the associated csi-SSB-ResourceList in the corresponding CSI-SSB-ResourceSet. \nIf the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'ssb-Index-SINR' or 'ssb-Index-SINR- Index', the UE shall derive L1-SINR conditioned on the reported SSBRI, where SSBRI k (k \u2265 0) corresponds to the configured (k+1)-th entry of the associated csi-SSB-ResourceList  in the corresponding CSI-SSB-ResourceSet for channel measurement, and (k+1)-th entry of associated csi-IM-Resource in the corresponding csi-IM-ResourceSet (if configured) or (k+1)-th entry of associated nzp-CSI-RS-Resources in the corresponding NZP-CSI-RS-ResourceSet (if configured) for interference measurement.\nIf the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'cri-RI-PMI-CQI', ' cri-RI-i1', 'cri-RI-i1-CQI', 'cri-RI-CQI' or 'cri-RI-LI-PMI-CQI', then the UE is not expected to be configured with more than 8 CSI-RS resources in a CSI-RS resource set contained within a resource setting that is linked to the CSI-ReportConfig, except when the UE is configured with a CSI-ReportConfig with the higher layer parameter N4, reportQuantity set to 'cri-RI-PMI-CQI' and the corresponding CSI-RS resource set for channel measurement is aperiodic with  resources.\nIf the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to 'cri-RI-LI-PMI-CQI', UE does not expect the CSI-ReportConfig to be configured with higher layer parameter codebookType set to 'typeII-r16' or 'typeII-PortSelection-r16', 'typeII-PortSelection-r17', 'typeII-CJT-r18', 'typeII-CJT-PortSelection-r18', 'typeII-Doppler-r18' or 'typeII-Doppler-PortSelection-r18'.\nIf the UE is configured with a CSI-ReportConfig with higher layer parameter reportQuantity set to 'cri-RSRP', 'cri-SINR', 'none', 'cri-RSRP- Index' or 'cri-SINR- Index and the CSI-ReportConfig is linked to a resource setting configured with the higher layer parameter resourceType set to 'aperiodic', then the UE is not expected to be configured with more than 16 CSI-RS resources in a CSI-RS resource set contained within the resource setting. \nThe LI indicates which column of the precoder matrix of the reported PMI corresponds to the strongest layer of the codeword corresponding to the largest reported wideband CQI. If two wideband CQIs are reported and have equal value, the LI corresponds to strongest layer of the first codeword. If the UE is configured with a CSI-ReportConfig with reportQuantity set to 'cri-RI-LI-PMI-CQI' and the corresponding NZP-CSI-RS-ResourceSet for channel measurement is configured with two Resource Groups and  Resource Pairs, and the UE reports a CRI associated to a Resource Pair, and a rank combination , the first LI indicates which column of the precoder matrix of the first reported PMI corresponds to the strongest of the first  layers of the codeword and the second LI indicates which column of the precoder matrix of the second reported PMI corresponds to the strongest of the last  layers of the codeword.\nFor operation with shared spectrum channel access in FR1, or in FR2-2 when the UE is provided ChannelAccessMode2-r17 = 'enabled', if the UE is configured with a CSI-ReportConfig with higher layer parameter reportQuantity set to 'cri-RI-PMI-CQI ', 'cri-RI-i1', 'cri-RI-i1-CQI', 'cri-RI-CQI' or 'cri-RI-LI-PMI-CQI', the UE shall derive:\n-\tthe CSI parameters without averaging two or more instances of any periodic or semi-persistent nzp-CSI-RS-Resources in the corresponding NZP-CSI-RS-ResourceSet for channel measurement or for interference measurement located in different DL transmissions,\n-\tthe instances of the nzp-CSI-RS-Resources are not in the same channel occupancy duration indicated by DCI format 2_0, if the UE is provided at least one of SlotFormatIndicator or co-DurationList; or\n-\tthe instances of the nzp-CSI-RS-Resources occur within a set of consecutive symbols which are not all occupied by PDSCH(s) and/or aperiodic CSI-RS(s) indicated by DCI formats, if any, and the corresponding PDCCH(s), if the UE is neither provided with CO-DurationsPerCell nor SlotFormatIndicator, but is provided with csi-RS-ValidationWithDCI\n-\tthe interference measurements for computing CSI value based on periodic/semi-persistent CSI-IM measured only in OFDM symbol(s) that fulfill the same conditions under which the UE is expected to receive periodic/semi-persistent CSI-RS as described in Clause 11.1 and Clause 11.1.1 of [6, TS 38.213].\nIf the UE is configured with the higher layer parameter SSB-MTC-AdditionalPCI, the UE is allowed to report in a single reporting instance up to four SSBRIs for each report setting, where SSB resources are associated with PCI indices referring to the PCI of the serving cell and PCI(s) different from the PCI of the serving cell within the set of PCIs configured.\nIf a UE is configured with a LTM-CSI-ReportConfig,\n-\tif the UE is configured with spCellInclusion, the UE shall report in a single reporting instance nrOfReportedRS-PerCell different SSBRI for the current SpCell and each of the nrOfReportedCells -1 candidate cells. Otherwise, the UE shall report in a single reporting instance nrOfReportedRS-PerCell different SSBRI for each of the nrOfReportedCells candidate cells, \n-\twhere SSBRI k (k \u2265 0) corresponds to the configured (k+1)-th entry of the associated ltm-CSI-SSB-ResourceList in the corresponding LTM-CSI-SSB-ResourceSet,\n-\tif spCellInclusion is configured, SSB resources in ltm-CSI-SSB-ResourceList associated with the current SpCell are the entries where PCI given by ltm-CandidatePCI and frequency information given by ssbFrequency of the associated candidate cell (given in [ltm-CandidateIdList]) is equal to the PCI and center frequency of cell-defining SSB of the current SpCell.\nIf the UE is configured with a CSI-ReportConfig that contains a list of sub-configurations provided by csi-ReportSubConfigList, the UE can only be configured with NZP CSI-RS for interference measurement if each sub-configuration is configured with [powerOffset] and not configured with [port-subsetIndicator].\n5.2.1.4.3\tL1-RSRP Reporting\nFor L1-RSRP computation\n-\tthe UE may be configured with CSI-RS resources, SS/PBCH Block resources or both CSI-RS and SS/PBCH block resources, when resource-wise quasi co-located with 'type C' and 'typeD' when applicable.\n-\tthe UE may be configured with CSI-RS resource setting up to 16 CSI-RS resource sets having up to 64 resources within each set. The total number of different CSI-RS resources over all resource sets is no more than 128.\nFor L1-RSRP reporting, if the higher layer parameter nrofReportedRS in CSI-ReportConfig is configured to be one, or if the higher layer parameters nrOfReportedCells and nrOfReportedRS-PerCell are both configured to be one, the reported L1-RSRP value is defined by a 7-bit value in the range [-140, -44] dBm with 1dB step size, if the higher layer parameter nrofReportedRS is configured to be larger than one, or if the higher layer parameter groupBasedBeamReporting is configured as 'enabled', or if the higher layer parameter groupBasedBeamReporting-r17 is configured, or if any of the higher layer parameters nrOfReportedCells and nrOfReportedRS-PerCell is configured to be larger than one, the UE shall use differential L1-RSRP based reporting, where the largest measured value of L1-RSRP is quantized to a 7-bit value in the range [-140, -44] dBm with 1dB step size, and the differential L1-RSRP is quantized to a 4-bit value. The differential L1-RSRP value is computed with 2 dB step size with a reference to the largest measured L1-RSRP value which is part of the same L1-RSRP reporting instance. The mapping between the reported L1-RSRP value and the measured quantity is described in [11, TS 38.133]. \nWhen the higher layer parameter groupBasedBeamReporting-r17in CSI-ReportConfig is configured, the UE shall indicate the CSI Resource Set associated with the largest measured value of L1-RSRP, and for each group, CRI or SSBRI of the indicated CSI Resource Set is present first.\nIf the higher layer parameter timeRestrictionForChannelMeasurements in CSI-ReportConfig is set to \"notConfigured\", the UE shall derive the channel measurements for computing L1-RSRP value reported in uplink slot n based on only the SS/PBCH or NZP CSI-RS, no later than the CSI reference resource, (defined in TS 38.211[4]) associated with the CSI resource setting. \nIf the higher layer parameter timeRestrictionForChannelMeasurements in CSI-ReportConfig is set to \"Configured\", the UE shall derive the channel measurements for computing L1-RSRP reported in uplink slot n based on only the most recent, no later than the CSI reference resource, occasion of SS/PBCH or NZP CSI-RS (defined in [4, TS 38.211]) associated with the CSI resource setting.\nWhen the UE is configured with SSB-MTC-AddtionalPCI, a CSI-SSB-ResourceSet configured for L1-RSRP reporting includes one set of SSB indices and one set of PCI indices, where each SSB index is associated with a PCI index. \nWhen the UE is configured with a CSI-ReportConfig with the higher layer parameter reportQuantity set to ' cri-RSRP- Index' or 'ssb-Index-RSRP- Index' an index of UE capability value set, indicating the maximum supported number of SRS antenna ports, is reported along with the pair of SSBRI/CRI and L1-RSRP. \n5.2.1.4.4\tL1-SINR Reporting\nFor L1-SINR computation, for channel measurement the UE may be configured with NZP CSI-RS resources and/or SS/PBCH Block resources, for interference measurement the UE may be configured with NZP CSI-RS or CSI-IM resources.\n-\tfor channel measurement, the UE may be configured with CSI-RS resource setting with up to 16 resource sets, with a total of up to 64 CSI-RS resources or up to 64 SS/PBCH Block resources.\nFor L1-SINR reporting, if the higher layer parameter nrofReportedRS in CSI-ReportConfig is configured to be one, the reported L1-SINR value is defined by a 7-bit value in the range [-23, 40] dB with 0.5 dB step size, and if the higher layer parameter nrofReportedRS is configured to be larger than one, or if the higher layer parameter groupBasedBeamReporting is configured as 'enabled', the UE shall use differential L1-SINR based reporting, where the largest measured value of L1-SINR is quantized to a 7-bit value in the range [-23, 40] dB with 0.5 dB step size, and the differential L1-SINR is quantized to a 4-bit value. The differential L1-SINR is computed with 1 dB step size with a reference to the largest measured L1-SINR value which is part of the same L1-SINR reporting instance. When NZP CSI-RS is configured for channel measurement and/or interference measurement, the reported L1-SINR values should not be compensated by the power offset(s) given by higher layer parameter powerControOffsetSS or powerControlOffset. \nWhen one or two resource settings are configured for L1-SINR measurement\n-\tIf the higher layer parameter timeRestrictionForChannelMeasurements in CSI-ReportConfig is set to 'notConfigured', the UE shall derive the channel measurements for computing L1-SINR reported in uplink slot n based on only the SSB or NZP CSI-RS, no later than the CSI reference resource, (defined in TS 38.211[4]) associated with the CSI resource setting. \n-\tIf the higher layer parameter timeRestrictionForChannelMeasurements in CSI-ReportConfig is set to 'configured', the UE shall derive the channel measurements for computing L1-SINR reported in uplink slot n based on only the most recent, no later than the CSI reference resource, occasion of SSB or NZP CSI-RS (defined in [4, TS 38.211]) associated with the CSI resource setting. \n-\tIf the higher layer parameter timeRestrictionForInterferenceMeasurements in CSI-ReportConfig is set to 'notConfigured', the UE shall derive the interference measurements for computing L1-SINR reported in uplink slot n based on only the CSI-IM or NZP CSI-RS for interference measurement (defined in [4, TS 38.211]) or NZP CSI-RS for channel and interference measurement no later than the CSI reference resource associated with the CSI resource setting. \n-\tIf the higher layer parameter timeRestrictionForInterferenceMeasurements in CSI-ReportConfig is set to 'configured', the UE shall derive the interference measurements for computing the L1-SINR reported in uplink slot n based on the most recent, no later than the CSI reference resource, occasion of CSI-IM or NZP CSI-RS for interference measurement (defined in [4, TS 38.211]) or NZP CSI-RS for channel and interference measurement associated with the CSI resource setting.\nWhen the UE is configured a CSI-ReportConfig with the higher layer parameter reportQuantity set to ' cri-SINR- Index' or 'ssb-Index-SINR- Index' an index of UE capability value, indicating the maximum supported number of SRS antenna ports, is reported along with the pair of SSBRI/CRI and L1-SINR.\n5.2.1.4.5\tTDCP Reporting\nFor a CSI-ReportConfig with higher layer parameter reportQuantity set to 'tdcp' and higher layer parameters  and , the reported TDCP amplitude(s) corresponding to the  configured delays are indicated by\n\n\nand the corresponding amplitude values are obtained from: , for , where the mapping from  to  is given in Table 5.2.1.4.5-1.\nTable 5.2.1.4.5-1: Mapping of elements of :  to \n\nFor , if the higher layer parameter phase is configured, the reported TDCP phases are indicated by\n\n\nand the corresponding phase values are given by: . \n5.2.1.5\tTriggering/activation of CSI Reports and CSI-RS\n5.2.1.5.1\tAperiodic CSI Reporting/Aperiodic CSI-RS when the triggering PDCCH and the CSI-RS have the same numerology\nFor CSI-RS resource sets associated with Resource Settings configured with the higher layer parameter resourceType set to 'aperiodic', 'periodic', or 'semi-persistent', trigger states for Reporting Setting(s) (configured with the higher layer parameter reportConfigType set to 'aperiodic') and/or Resource Setting for channel and/or interference measurement on one or more component carriers are configured using the higher layer parameter CSI-AperiodicTriggerStateList. For a reporting setting for which the CSI-ReportConfig contains a list of sub-configurations provided by the higher layer parameter [csi-ReportSubConfigList], one or more trigger states can be configured with each indicating one or more of the sub-configurations. For aperiodic CSI report triggering, a single set of CSI triggering states are higher layer configured, wherein the CSI triggering states can be associated with any candidate DL BWP. A UE is not expected to receive more than one DCI with non-zero CSI request field per slot per cell. A UE is not expected to receive DCI with non-zero CSI request field within a cell group in a slot overlapping with any slot receiving DCI with non-zero CSI request field in the same cell group. A UE is not expected to be configured with different TCI-StateId's for the same aperiodic CSI-RS resource ID configured in multiple aperiodic CSI-RS resource sets with the same triggering offset in the same aperiodic trigger state. A UE is not expected to receive more than one aperiodic CSI report request for transmission in a given slot per cell. A UE is not expected to receive an aperiodic CSI report request for transmission in a slot overlapping with any slot having an aperiodic CSI report transmission in the same cell group. If a UE does not indicate its capability of csi-TriggerStateNon-ActiveBWP the UE is not expected to be triggered with a CSI report for a non-active DL BWP. Otherwise, when a UE is triggered with a CSI report for a DL BWP that is non-active when expecting to receive the most recent occasion, no later than the CSI reference resource, of the associated NZP CSI-RS, the UE is not expected to report the CSI for the non-active DL BWP and the CSI report associated with that BWP is omitted. When a UE is triggered with aperiodic NZP CSI-RS in a DL BWP that is non-active when expecting to receive the NZP CSI-RS, the UE is not expected to measure the aperiodic CSI-RS. In the carrier of the serving cell expecting to receive that associated NZP CSI-RS, if the active DL BWP when receiving the NZP CSI-RS is different from the active DL BWP when receiving the triggering DCI, \n-\tthe last symbol of the PDCCH span of the DCI carrying the BWP switching shall be no later than the last symbol of the PDCCH span of the DCI carrying the CSI trigger, irrespective of whether they are in the same carrier of a serving cell or not and irrespective of whether they are in the same SCS or not;\n-\tthe UE is not expected to have any other BWP switching in that carrier after the last symbol of the PDCCH span covering the DCI carrying the CSI trigger and before the first symbol of the triggered NZP CSI-RS or CSI-IM. \n-\twhen the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], the span that involves the PDCCH candidate that ends later in time is used.\nA trigger state is initiated using the CSI request field in DCI.\n-\tWhen all the bits of CSI request field in DCI are set to zero, no CSI is requested.\n-\tWhen the number of configured CSI triggering states in CSI-AperiodicTriggerStateList is greater than , where  is the number of bits in the DCI CSI request field, the UE receives a subselection indication, as described in clause 6.1.3.13 of [10, TS 38.321], used to map up to  trigger states to the codepoints of the CSI request field in DCI.  is configured by the higher layer parameter reportTriggerSize where . When the UE would transmit a PUCCH with HARQ-ACK information in slot n corresponding to the PDSCH carrying the subselection indication, the corresponding action in [10, TS 38.321] and UE assumption on the mapping of the selected CSI trigger state(s) to the codepoint(s) of DCI CSI request field shall be applied starting from the first slot that is after slot  where \uf06d is the SCS configuration for the PUCCH and is the subcarrier spacing configuration for  with a value of 0 for frequency range 1, and  is provided by K-Mac or  if K-Mac is not provided..\n-\tWhen the number of CSI triggering states in CSI-AperiodicTriggerStateList is less than or equal to , the CSI request field in DCI directly indicates the triggering state.\n-\tFor each aperiodic CSI-RS resource in a CSI-RS resource set associated with each CSI triggering state, the UE is indicated the quasi co-location configuration of quasi co-location RS source(s) and quasi co-location type(s), as described in clause 5.1.5, through higher layer signaling of qcl-info which contains a list of references to TCI-State's for the aperiodic CSI-RS resources associated with the CSI triggering state. If a State referred to in the list is configured with a reference to an RS configured with qcl-Type set to 'typeD', that RS may be an SS/PBCH block located in the same or different CC/DL BWP or a CSI-RS resource configured as periodic or semi-persistent located in the same or different CC/DL BWP.\n-\tIf the scheduling offset between the last symbol of the PDCCH carrying the triggering DCI and the first symbol of the aperiodic CSI-RS resources in a NZP-CSI-RS-ResourceSet configured without higher layer parameter trs-Info is smaller than the UE reported threshold beamSwitchTiming, as defined in [13, TS 38.306], when the reported value is one of the values of {14, 28, 48} and enableBeamSwitchTiming is not provided, or is smaller than 48 when the UE provides beamSwitchTiming-r16, enableBeamSwitchTiming is provided and the NZP-CSI-RS-ResourceSet is configured with the higher layer parameter repetition set to 'off' or configured without the higher layer parameter repetition, or is smaller than the UE reported threshold beamSwitchTiming-r16, when enableBeamSwitchTiming is provided and the NZP-CSI-RS-ResourceSet is configured with the higher layer parameter repetition set to 'on'.\n-\tIf a UE is configured with enableDefaultTCI-StatePerCoresetPoolIndex and the UE is configured by higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet\n-\tif there is any other DL signal with an indicated TCI state in the same symbols as the CSI-RS, the UE applies the QCL assumption of the other DL signal also when receiving the aperiodic CSI-RS. The other DL signal refers to PDSCH scheduled by a PDCCH associated with the same coresetPoolIndex as the PDCCH triggering the aperiodic CSI-RS and scheduled with offset larger than or equal to the threshold timeDurationForQCL, as defined in [13, TS 38.306], aperiodic CSI-RS triggered by a PDCCH associated with the same coresetPoolIndex as the PDCCH triggering the aperiodic CSI-RS and scheduled with offset larger than or equal to the UE reported threshold beamSwitchTiming when the reported value is one of the values {14,28,48} and enableBeamSwitchTiming is not provided, aperiodic CSI-RS triggered by a PDCCH associated with the same coresetPoolIndex as the PDCCH triggering the aperiodic CSI-RS and scheduled with offset larger than or equal to 48 when the reported value of beamSwitchTiming-r16 is one of the values {224, 336} and enableBeamSwitchTiming is provided, periodic CSI-RS, semi-persistent CSI-RS;\n-\telse, the UE applies the QCL parameter(s) of the CORESET associated with a monitored search space with the lowest controlResourceSetId among CORESETs, which are configured with the same value of coresetPoolIndex as the PDCCH triggering that aperiodic CSI-RS, in the latest slot in which one or more CORESETs are associated with the same value of coresetPoolIndex as the PDCCH triggering that aperiodic CSI-RS\n-\telse if a UE is configured with enableTwoDefaultTCI-States and at least one TCI codepoint is mapped to two TCI states\n-\tif there is any other DL signal with an indicated TCI state in the same symbols as the CSI-RS, the UE applies the QCL assumption of the other DL signal also when receiving the aperiodic CSI-RS. The other DL signal refers to PDSCH scheduled with offset larger than or equal to the threshold timeDurationForQCL, as defined in [13, TS 38.306], aperiodic CSI-RS scheduled with offset larger than or equal to the UE reported threshold beamSwitchTiming when the reported value is one of the values {14,28,48} and enableBeamSwitchTiming is not provided, aperiodic CSI-RS scheduled with offset larger than or equal to 48 when the reported value of beamSwitchTiming-r16 is one of the values {224, 336} and enableBeamSwitchTiming is provided, periodic CSI-RS, semi-persistent CSI-RS. If there is a PDSCH indicated with two TCI states in the same symbols as the CSI-RS, the UE applies the first TCI state of the two TCI states when receiving the aperiodic CSI-RS.\n-\telse, the UE applies the first one of two TCI states corresponding to the lowest TCI codepoint among those mapped to two TCI states and applicable to the PDSCH within the active BWP of the cell in which the CSI-RS is to be received when receiving the aperiodic CSI-RS.\n-\telse if a UE is configured with sfnSchemePdcch set to 'sfnSchemeA' or 'sfnSchemeB', it is not configured with enableTwoDefaultTCI-States, and the two TCI states are activated for the CORESET by the activation command as described in clause 6.1.3.44 of [10, TS 38.321]\n-\tif there is any other DL signal with an indicated TCI state in the same symbols as the CSI-RS, the UE applies the QCL assumption of the other DL signal also when receiving the aperiodic CSI-RS. The other DL signal refers to PDSCH scheduled with an offset larger than or equal to the threshold timeDurationForQCL, as defined in [13, TS 38.306], periodic CSI-RS, semi-persistent CSI-RS, aperiodic CSI-RS in a NZP-CSI-RS-ResourceSet scheduled with offset larger than or equal to the UE reported threshold beamSwitchTiming when the reported value is one of the values {14,28,48} and when enableBeamSwitchTiming is not provided or the NZP-CSI-RS-ResourceSet is configured with the higher layer parameter trs-Info , aperiodic CSI-RS in a NZP-CSI-RS-ResourceSet configured with the higher layer parameter repetition set to 'off' or configured without the higher layer parameters repetition and trs-Info scheduled with offset larger than or equal to 48 when the UE provides beamSwitchTiming-r16 and enableBeamSwitchTiming is provided, aperiodic CSI-RS in a NZP-CSI-RS-ResourceSet configured with the higher layer parameter repetition set to 'on' scheduled with offset larger than or equal to the UE reported threshold beamSwitchTiming-r16 and enableBeamSwitchTiming is provided;\n-\telse, the UE applies the first one of TCI states indicated for the CORESET with the lowest CORESET ID in the latest slot within the active BWP of the cell in which the CSI-RS is to be received when receiving the aperiodic CSI-RS, if two TCI states are activated for the CORESET. Otherwise, the UE applies the single activated TCI state of the CORESET with the lowest CORESET ID in the latest slot within the active BWP of the cell in which the CSI-RS is to be received, when receiving the aperiodic CSI-RS\n-\telse if there is any other DL signal with an indicated TCI state in the same symbols as the CSI-RS, the UE applies the QCL assumption of the other DL signal also when receiving the aperiodic CSI-RS. The other DL signal refers to PDSCH scheduled with offset larger than or equal to the threshold timeDurationForQCL, as defined in [13, TS 38.306], periodic CSI-RS, semi-persistent CSI-RS, aperiodic CSI-RS in a NZP-CSI-RS-ResourceSet scheduled with offset larger than or equal to the UE reported threshold beamSwitchTiming when the reported value is one of the values {14,28,48} and when enableBeamSwitchTiming is not provided or the NZP-CSI-RS-ResourceSet is configured with the higher layer parameter trs-Info , aperiodic CSI-RS in a NZP-CSI-RS-ResourceSet configured with the higher layer parameter repetition set to 'off' or configured without the higher layer parameters repetition and trs-Info scheduled with offset larger than or equal to 48 when the UE provides beamSwitchTiming-r16 and enableBeamSwitchTiming is provided, aperiodic CSI-RS in a NZP-CSI-RS-ResourceSet configured with the higher layer parameter repetition set to 'on' scheduled with offset larger than or equal to the UE reported threshold beamSwitchTiming-r16 and enableBeamSwitchTiming is provided;\n-\telse if the UE is not provided dl-OrJointTCI-StateList, and if at least one CORESET is configured for the BWP in which the aperiodic CSI-RS is received, when receiving the aperiodic CSI-RS, the UE applies the QCL assumption used for the CORESET associated with a monitored search space with the lowest controlResourceSetId in the latest slot in which one or more CORESETs within the active BWP of the serving cell are monitored; \n-\telse if the UE is provided dl-OrJointTCI-StateList and if the indicated TCI state is associated with a PCI different from the serving cell, regardless of configuration of followUnifiedTCI-State, and if at least one CORESET is configured for the BWP in which the aperiodic CSI-RS is received, when receiving the aperiodic CSI-RS, the UE applies the QCL assumption used for the CORESET associated with a monitored search space with the lowest controlResourceSetId in the latest slot in which one or more CORESETs within the active BWP of the serving cell are monitored. In the CA case, if the 'QCL-TypeD' of the aperiodic CSI-RSs from respective CCs in a band are different in a slot, the QCL-TypeD assumption of the CSI-RS in the CC with lowest CC ID in the band is applied to all the aperiodic CSI-RSs in the CCs in the band;\n-\telse if the UE is provided dl-OrJointTCI-StateList and the indicated TCI state is associated with the PCI of the serving cell, regardless of configuration of followUnifiedTCI-State, the indicated TCI state is applied to the aperiodic CSI-RS;\n-\telse if the UE is configured with enableDefaultBeamForCCS and when receiving the aperiodic CSI-RS, the UE applies the QCL assumption of the lowest-ID activated TCI state applicable to the PDSCH within the active BWP of the cell in which the CSI-RS is to be received.\n-\tIf the scheduling offset between the last symbol of the PDCCH carrying the triggering DCI and the first symbol of the aperiodic CSI-RS resources in a NZP-CSI-RS-ResourceSet is equal to or greater than the UE reported threshold beamSwitchTiming when the reported value is one of the values of {14,28,48} and enableBeamSwitchTiming is not provided and the NZP-CSI-RS-ResourceSet is not configured with higher layer parameter trs-Info, or is equal to or greater than the UE reported threshold beamSwitchTiming when the reported value is one of the values of {14,28,48} and the NZP-CSI-RS-ResourceSet is configured with higher layer parameter trs-Info, or is equal to or greater than 48 when the UE provides beamSwitchTiming-r16 and enableBeamSwitchTiming is provided and the NZP-CSI-RS-ResourceSet is configured with the higher layer parameter repetition set to 'off' or configured without the higher layer parameters repetition and trs-Info, or is equal to or greater than the UE reported threshold beamSwitchTiming-r16, when enableBeamSwitchTiming is provided and the NZP-CSI-RS-ResourceSet is configured with the higher layer parameter repetition set to 'on', the UE is expected to apply the QCL assumptions in the indicated TCI states for the aperiodic CSI-RS resources in the CSI triggering state indicated by the CSI trigger field in DCI. \n-\tThe UE is not expected to receive aperiodic CSI-RS and PDSCH/aperiodic CSI-RS associated with different values of coresetPoolIndex in overlapped symbol(s). The UE is not expected to receive aperiodic CSI-RS and semi-persistent/periodic CSI-RS with different 'QCL-type D' in overlapped symbol(s). \n-\tIf dl-OrJointTCI-StateList-r17 is provided, the UE may assume that a CSI-RS resource in an aperiodic CSI-RS resource set configured without trs-Info is quasi co-located with the RS(s) in the indicated TCI state.\n-\tA non-zero codepoint of the CSI request field in the DCI is mapped to a CSI triggering state according to the order of the associated positions of the up to  trigger states in CSI-AperiodicTriggerStateList with codepoint '1' mapped to the triggering state in the first position.\nFor a UE configured with the higher layer parameter CSI-AperiodicTriggerStateList, if a Resource Setting linked to a CSI-ReportConfig has multiple aperiodic resource sets, only one of the aperiodic CSI-RS resource sets from the Resource Setting is associated with the trigger state, and the UE is higher layer configured per trigger state per Resource Setting to select the one CSI-IM/NZP CSI-RS resource set from the Resource Setting.\nWhen aperiodic CSI-RS is used with aperiodic reporting, the CSI-RS offset is configured per resource set by the higher layer parameter aperiodicTriggeringOffset or aperiodicTriggeringOffset-r16 or aperiodicTriggeringOffset-r17. The CSI-RS triggering offset has the values of {0, 1, 2, 3, 4, 5, 6, \u2026, 15, 16, 24} slots for  or {0, 4, 8, 12, \u2026, 60, 64, 96} slots for  and , where  is the subcarrier spacing configurations for CSI-RS. If the UE is not configured with minimumSchedulingOffsetK0 for any DL BWP and minimumSchedulingOffsetK2 for any UL BWP and if all the associated trigger states do not have the higher layer parameter qcl-Type set to 'typeD' in the corresponding TCI states, the CSI-RS triggering offset is fixed to zero. The aperiodic triggering offset of the CSI-IM follows offset of the associated NZP CSI-RS for channel measurement. The aperiodic CSI-RS is transmitted in a slot , , if UE is configured with ca-SlotOffset for at least one of the triggered and triggering cell, and in slot , otherwise, and where\n-\tn is the slot containing the triggering DCI, X is the CSI-RS triggering offset according to the higher layer parameter aperiodicTriggeringOffset or aperiodicTriggeringOffset-r16 or aperiodicTriggeringOffset-r17,\n-\tand  are the and the  which are determined by higher-layer configured ca-SlotOffset for the cell receiving the PDCCH, and  are the and the  which are determined by higher-layer configured ca-SlotOffset for the cell transmitting the CSI-RS respectively, as defined in [4, TS 38.211] clause 4.5.\nThe UE does not expect that aperiodic CSI-RS is transmitted before the OFDM symbol(s) carrying its triggering DCI. When the minimum scheduling offset restriction is applied, UE is not expected to be triggered by CSI triggering state indicated by the CSI request field in DCI in which CSI-RS triggering offset is smaller than the currently applicable minimum scheduling offset restriction K0min.\nIf interference measurement is performed on aperiodic NZP CSI-RS, a UE is not expected to be configured with a different aperiodic triggering offset of the NZP CSI-RS for interference measurement from the associated NZP CSI-RS for channel measurement.\nIf the UE is configured with a single carrier for uplink, the UE is not expected to transmit more than one aperiodic CSI report triggered by different DCIs on overlapping OFDM symbols.\nWhen the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the purpose of determining scheduling offset between the last symbol of the PDCCH carrying the triggering DCI and the first symbol of the aperiodic CSI-RS resources, the PDCCH candidate that ends later in time is used, and the UE does not expect that the aperiodic CSI-RS is transmitted before the first symbol of the PDCCH candidate that starts later in time.\nWhen a UE is configured with dl-OrJointTCI-StateList and is having two indicated TCI states, a higher layer configuration can be provided to an aperiodic CSI-RS resource set or a CSI-RS resource in an aperiodic CSI-RS resource set to inform that the UE shall apply the first or the second indicated TCI-State to the aperiodic CSI-RS resource set or to the CSI-RS resource in the aperiodic CSI-RS resource set, if the aperiodic CSI-RS resource set for CSI or BM is configured with followUnifiedTCI-State and if the offset between the last symbol of the PDCCH carrying the triggering DCI and the first symbol of the aperiodic CSI-RS resources in the aperiodic CSI-RS resource set is equal to or larger than a threshold. \n-\tIf the UE is configured by higher layer parameter PDCCH-Config that contains two different values of CORESETPoolIndex in different ControlResourceSets, the first and the second indicated TCI-States correspond to the indicated TCI-States specific to coresetPoolIndex value 0 and value 1, respectively. \nWhen a UE is configured with dl-OrJointTCI-StateList and is having two indicated TCI states and if the offset between the last symbol of the PDCCH carrying the triggering DCI and the first symbol of the aperiodic CSI-RS resources in the aperiodic CSI-RS resource set is smaller than a threshold:\n-\tIf there is no DL signal in the same symbols as the aperiodic CSI-RS\n-\tif the UE is in frequency range 1, or the UE reports its capability of [two default beams for S-DCI based MTRP] in frequency range 2, the UE shall apply the first or the second indicated joint/DL TCI state to the aperiodic CSI-RS according to the higher layer configuration(s) provided to the aperiodic CSI-RS resource or to the aperiodic CSI-RS resource set\n-\totherwise, the UE shall apply the first indicated joint/DL TCI state to the aperiodic CSI-RS\n-\telse if there is any other DL signal with an indicated TCI state in the same symbols as the CSI-RS, the UE applies the QCL assumption of the other DL signal also when receiving the aperiodic CSI-RS. The other DL signal refers to PDSCH scheduled with offset larger than or equal to the threshold timeDurationForQCL, as defined in [13, TS 38.306], periodic CSI-RS, semi-persistent CSI-RS, aperiodic CSI-RS in a NZP-CSI-RS-ResourceSet scheduled with offset larger than or equal to the UE reported threshold beamSwitchTiming when the reported value is one of the values {14,28,48}\u22192max(0,\u03bcCSIRS-3) and when enableBeamSwitchTiming is not provided or the NZP-CSI-RS-ResourceSet is configured with the higher layer parameter trs-Info, aperiodic CSI-RS in a NZP-CSI-RS-ResourceSet configured with the higher layer parameter repetition set to 'off' or configured without the higher layer parameters repetition and trs-Info scheduled with offset larger than or equal to 48\u22192max(0,\u03bcCSIRS-3) when the UE provides beamSwitchTiming-r16 and enableBeamSwitchTiming is provided, aperiodic CSI-RS in a NZP-CSI-RS-ResourceSet configured with the higher layer parameter repetition set to 'on' scheduled with offset larger than or equal to the UE reported threshold beamSwitchTiming-r16 and enableBeamSwitchTiming is provided. If there is a PDSCH applying two indicated joint/DL TCI states in the same symbols as the AP CSI-RS, the UE applies the first or the second indicated joint/DL TCI state to the AP CSI-RS according to the higher layer configuration(s) provided to the AP CSI-RS resource or to the aperiodic CSI-RS resource set.\nWhen a UE is configured with dl-OrJointTCI-StateList, is configured by higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in different ControlResourceSets, is having two indicated TCI states where the first and the second indicated TCI states correspond to the indicated TCI states specific to coresetPoolIndex value 0 and value 1 and if the offset between the last symbol of the PDCCH carrying the triggering DCI and the first symbol of the aperiodic CSI-RS resources in the aperiodic CSI-RS resource set is smaller than a threshold:\n-\tIf there is no other DL signal in the same symbols as the aperiodic CSI-RS\n-\tif the UE is in frequency range 1, or the UE reports its capability of [default beam per coresetPoolIndex for M-DCI based MTRP] in frequency range 2, the UE shall apply the first or the second indicated TCI state to the aperiodic CSI-RS according to the higher layer configuration(s) provided to the aperiodic CSI-RS resource or aperiodic CSI-RS resource set\n-\totherwise, the UE shall apply the indicated TCI state specific to coresetPoolIndex value 0 to the aperiodic CSI-RS resource set\n-\telse if there is any other DL signal with an indicated TCI state in the same symbols as the aperiodidc CSI-RS, \n-\tif the UE is in frequency range 1, or the UE reports its capability of [default beam per coresetPoolIndex for M-DCI based MTRP] in frequency range 2, and there are two other DL signals applying the first and the second indicated TCI states, respectively, in the same symbols as the aperiodic CSI-RS, the UE shall apply the first or the second indicated TCI state to the aperiodic CSI-RS according to the higher layer configuration(s) provided to the aperiodic CSI-RS resource or aperiodic CSI-RS resource set\n-\totherwisethe UE applies the QCL assumption of the other DL signal also when receiving the aperiodic CSI-RS. The other DL signal refers to PDSCH scheduled with offset larger than or equal to the threshold timeDurationForQCL, as defined in [13, TS 38.306], periodic CSI-RS, semi-persistent CSI-RS, aperiodic CSI-RS in a NZP-CSI-RS-ResourceSet scheduled with offset larger than or equal to the UE reported threshold beamSwitchTiming when the reported value is one of the values {14,28,48}\u22192max(0,\u03bcCSIRS-3) and when enableBeamSwitchTiming is not provided or the NZP-CSI-RS-ResourceSet is configured with the higher layer parameter trs-Info, aperiodic CSI-RS in a NZP-CSI-RS-ResourceSet configured with the higher layer parameter repetition set to 'off' or configured without the higher layer parameters repetition and trs-Info scheduled with offset larger than or equal to 48\u22192max(0,\u03bcCSIRS-3) when the UE provides beamSwitchTiming-r16 and enableBeamSwitchTiming is provided, aperiodic CSI-RS in a NZP-CSI-RS-ResourceSet configured with the higher layer parameter repetition set to 'on' scheduled with offset larger than or equal to the UE reported threshold beamSwitchTiming-r16 and enableBeamSwitchTiming is provided.\n5.2.1.5.1a\tAperiodic CSI Reporting/Aperiodic CSI-RS when the triggering PDCCH and the CSI-RS have different numerologies\nWhen the triggering PDCCH and the triggered aperiodic CSI-RS are of different numerologies, the behavior defined in 5.2.1.5.1 for the case where the numerologies are the same applies with the following exceptions:\nBeam switch timing:\n-\tIf the scheduling offset between the last symbol of the PDCCH carrying the triggering DCI and the first symbol of the aperiodic CSI-RS resources in a NZP-CSI-RS-ResourceSet configured without higher layer parameter trs-Info is smaller than beamSwitchTiming + d  in CSI-RS symbols, as defined in [13, TS 38.306], when the reported value is one of the values of {14, 28, 48} and enableBeamSwitchTiming is not provided, or is smaller than 48+  in CSI-RS symbols when the UE provides beamSwitchTiming-r16 and enableBeamSwitchTiming is provided and the NZP-CSI-RS-ResourceSet is configured with the higher layer parameter repetition set to 'off' or configured without the higher layer parameter repetition, or is smaller than beamSwitchTiming-r16 +  in CSI-RS symbols, when enableBeamSwitchTiming is provided and the NZP-CSI-RS-ResourceSet is configured with the higher layer parameter repetition set to 'on', where if the \u00b5PDCCH < \u00b5CSIRS, the beam switching timing delay d is defined in Table 5.2.1.5.1a-1, else d is zero\n-\tif one of the associated trigger states has the higher layer parameter qcl-Type set to 'typeD',\n-\tif there is any other DL signal with an indicated TCI state in the same symbols as the CSI-RS, the UE applies the QCL assumption of the other DL signal also when receiving the aperiodic CSI-RS. The other DL signal refers to PDSCH scheduled with offset larger than or equal to the threshold timeDurationForQCL, as defined in [13, TS 38.306], periodic CSI-RS, semi-persistent CSI-RS, aperiodic CSI-RS scheduled with offset larger than or equal to beamSwitchTiming + d  in CSI-RS symbols when the reported value is one of the values {14,28,48} and when enableBeamSwitchTiming is not provided or the NZP-CSI-RS-ResourceSet is configured with the higher layer parameter trs-Info, aperiodic CSI-RS in a NZP-CSI-RS-ResourceSet configured with the higher layer parameter repetition set to 'off' or configured without the higher layer parameters repetition and trs-Info scheduled with offset larger than or equal to 48+  in CSI-RS symbols when the UE provides beamSwitchTiming-r16  and enableBeamSwitchTiming is provided, aperiodic CSI-RS in a NZP-CSI-RS-ResourceSet configured with the higher layer parameter repetition set to 'on' and scheduled with offset larger than or equal to beamSwitchTiming-r16 + d  in CSI-RS symbols when enableBeamSwitchTiming is provided;\n-\telse,\n-\tif at least one CORESET is configured for the BWP in which the aperiodic CSI-RS is to be received, when receiving the aperiodic CSI-RS, the UE applies the QCL assumption used for the CORESET associated with a monitored search space with the lowest controlResourceSetId in the latest slot in which one or more CORESETs within the active BWP of the serving cell are monitored.\n-\telse if the UE is configured with enableDefaultBeamForCCS, when receiving the aperiodic CSI-RS, the UE applies the QCL assumption of the lowest-ID activated TCI state applicable to the PDSCH within the active BWP of the cell in which the CSI-RS is to be received. \n-\tIf the scheduling offset between the last symbol of the PDCCH carrying the triggering DCI and the first symbol of the aperiodic CSI-RS resources in a NZP-CSI-RS-ResourceSet is equal to or greater than beamSwitchTiming + d  in CSI-RS symbols, when the reported value is one of the values of {14,28,48} and enableBeamSwitchTiming is not provided and the NZP-CSI-RS-ResourceSet is not configured with higher layer parameter trs-Info, or is equal to or greater than beamSwitchTiming + d  in CSI-RS symbols when the reported value is one of the values of {14,28,48} and the NZP-CSI-RS-ResourceSet is configured with higher layer parameter trs-Info, or is equal to or greater than 48+ in CSI-RS symbols when the UE provides beamSwitchTiming-r16 and enableBeamSwitchTiming is provided and the NZP-CSI-RS-ResourceSet is configured with the higher layer parameter repetition set to 'off' or configured without the higher layer parameters repetition and trs-Info, or is equal to or greater than beamSwitchTiming-r16 + d  in CSI-RS symbols when enableBeamSwitchTiming is provided and the NZP-CSI-RS-ResourceSet is configured with the higher layer parameter repetition set to 'on', where if the \u00b5PDCCH < \u00b5CSIRS, the beam switching timing delay d is defined in Table 5.2.1.5.1a-1, else d is zero, the UE is expected to apply the QCL assumptions in the indicated TCI states for the aperiodic CSI-RS resources in the CSI triggering state indicated by the CSI trigger field in DCI. For \u00b5PDCCH = 5, UE shall report one of values of {56, 112} for additional beam switching time delay d.\n\nTable 5.2.1.5.1a-1: Additional beam switching timing delay d\n\nAperiodic CSI-RS timing:\n-\tWhen the aperiodic CSI-RS is used with aperiodic CSI reporting, the CSI-RS triggering offset X is configured per resource set by the higher layer parameter aperiodicTriggeringOffset or aperiodicTriggeringOffset-r16 or aperiodicTriggeringOffset-r17, including the case that the UE is not configured with minimumSchedulingOffsetK0 for any DL BWP or minimumSchedulingOffsetK2 for any UL BWP and all the associated trigger states do not have the higher layer parameter qcl-Type set to 'typeD' in the corresponding TCI states. The CSI-RS triggering offset has the values of {0, 1, \u2026, 31} slots for  or {0, 4, 8, \u2026, 124} slots for  and  when the \u00b5PDCCH < \u00b5CSIRS and {0, 1, 2, 3, 4, 5, 6, \u2026, 15, 16, 24} for  or {0, 4, 8, 12, \u2026, 60, 64, 96} slots for  and  when the \u00b5PDCCH > \u00b5CSIRS.. The aperiodic CSI-RS is transmitted in a slot , if UE is configured with ca-SlotOffset for at least one of the triggered and triggering cell, and Ks = , otherwise, and where\n-\tn is the slot containing the triggering DCI, X is the CSI-RS triggering offset in the numerology of CSI-RS according to the higher layer parameter aperiodicTriggeringOffset or aperiodicTriggeringOffset-r16 or aperiodicTriggeringOffset-r17,\n-\t and  are the subcarrier spacing configurations for CSI-RS and PDCCH, respectively,\n-\t and\u00a0are the\u00a0and the, respectively, which are determined by higher-layer configured ca-SlotOffset for the cell receiving the PDCCH respectively,\u00a0and \u00a0 are the\u00a0and the, respectively, which are determined by higher-layer configured ca-SlotOffset for the cell transmitting the CSI-RS respectively, as defined in [4, TS 38.211] clause 4.5\n-\tIf the \u00b5PDCCH < \u00b5CSIRS, the UE is expected to be able to measure the aperiodic CSI RS, if the CSI-RS starts no earlier than the first symbol of the CSI-RS carrier's slot that starts at least Ncsirs PDCCH symbols after the end of the PDCCH triggering the aperiodic CSI-RS.\n-\tIf the \u00b5PDCCH > \u00b5CSIRS, the UE is expected to be able to measure the aperiodic CSI RS, if the CSI-RS starts no earlier than at least Ncsirs PDCCH symbols after the end of the PDCCH triggering the aperiodic CSI-RS.\nWhen the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the purpose of determining Ncsirs, the PDCCH candidate that ends later in time is used.\nTable 5.2.1.5.1a: Ncsirs as a function of the subcarrier spacing of the triggering PDCCH\n\nWhen the triggering PDCCH and the triggered aperiodic CSI-RS are of different numerologies, the CSI request constraint and CSI reporting constraint defined in 5.2.1.5.1 for the case where the numerologies are the same applies with the following additions:\n-\tCSI request constraints:\n-\tA UE is not expected to receive more than one CSI request per reference slot length across all CCs in a cell group, where the SCS of the reference slot is the minimum of SCS of the PDCCH with which the DCI was transmitted, the SCS of the PUSCH with which the CSI report is to be transmitted, and the SCS of the minimum SCS of the CSI-RS associated to the CSI reports triggered by the DCI. The beginning of a slot length is defined according the PDCCH cell with which the DCI carrying the CSI request is transmitted.\n-\tCSI reporting constraints:\n-\tA UE is not expected to receive more than one CSI request for transmission in a given reference slot length across all CCs in a cell group, where the SCS of the reference slot is the minimum of SCS of the PDCCH with which the DCI was transmitted, the SCS of the PUSCH with which the CSI report is to be transmitted, and the SCS of the minimum SCS of the CSI-RS associated to the CSI reports triggered by the DCI. The beginning of a slot length is defined according the PUSCH cell with which the CSI report is transmitted.\n5.2.1.5.2\tSemi-persistent CSI/Semi-persistent CSI-RS\nFor semi-persistent reporting on PUSCH, a set of trigger states are higher layer configured by CSI-SemiPersistentOnPUSCH-TriggerStateList, where the CSI request field in DCI scrambled with SP-CSI-RNTI activates one of the trigger states. For a reporting setting for which the CSI-ReportConfig contains a list of sub-configurations, provided by the higher layer parameter [csi-ReportSubConfigList], one or more trigger states can be configured with each indicating one or more of the sub-configurations. A UE is not expected to receive a DCI scrambled with SP-CSI-RNTI activating one semi-persistent CSI report with the same CSI-ReportConfigId as in a semi-persistent CSI report which is activated by a previously received DCI scrambled with SP-CSI-RNTI.\nFor semi-persistent reporting on PUCCH, the PUCCH resource used for transmitting the CSI report are configured by reportConfigType. Semi-persistent reporting on PUCCH is activated by an activation command as described in clause 6.1.3.16 of [10, TS 38.321], which selects one of the semi-persistent Reporting Settings for use by the UE on the PUCCH. For a selected reporting setting for which the CSI-ReportConfig contains a list of sub-configurations provided by the higher layer parameter [csi-ReportSubConfigList], [an/the] activation command can [also] select one or more sub-configurations to use by the UE as described in clause 6.1.3.X of [10, TS 38.321]. When the UE would transmit a PUCCH with HARQ-ACK information in slot n corresponding to the PDSCH carrying the activation command, the indicated semi-persistent Reporting Setting should be applied starting from the first slot that is after slot  where \uf06d is the SCS configuration for the PUCCH. \nFor a UE configured with CSI resource setting(s) where the higher layer parameter resourceType set to 'semiPersistent'. \n-\twhen a UE receives an activation command, as described in clause 6.1.3.12 of [10, TS 38.321], for CSI-RS resource set(s) for channel measurement and CSI-IM/NZP CSI-RS resource set(s) for interference measurement associated with configured CSI resource setting(s), and when the UE would transmit a PUCCH with HARQ-ACK information in slot n corresponding to the PDSCH carrying the selection command, the corresponding actions in [10, TS 38.321] and the UE assumptions (including QCL assumptions provided by a list of reference to TCI-State's, one per activated resource) on CSI-RS/CSI-IM transmission corresponding to the configured CSI-RS/CSI-IM resource configuration(s) shall be applied starting from the first slot that is after slot  where \uf06d is the SCS configuration for the PUCCH and is the subcarrier spacing configuration for  with a value of 0 for frequency range 1, and  is provided by K-Mac or  if K-Mac is not provided. If a TCI-State referred to in the list is configured with a reference to an RS configured with qcl-Type set to 'typeD', that RS can be an SS/PBCH block, periodic or semi-persistent CSI-RS located in same or different CC/DL BWP.\n-\twhen a UE receives a deactivation command, as described in clause 6.1.3.12 of [10, TS 38.321], for activated CSI-RS/CSI-IM resource set(s) associated with configured CSI resource setting(s), and when the UE would transmit a PUCCH with HARQ-ACK information in slot n corresponding to the PDSCH carrying the deactivation command, the corresponding actions in [10, TS 38.321] and UE assumption on cessation of CSI-RS/CSI-IM transmission corresponding to the deactivated CSI-RS/CSI-IM resource set(s) shall apply starting from the first slot that is after slot  where \uf06d is the SCS configuration for the PUCCH and is the subcarrier spacing configuration for  with a value of 0 for frequency range 1, and  is provided by K-Mac or  if K-Mac is not provided.\nA codepoint of the CSI request field in the DCI is mapped to a SP-CSI triggering state according to the order of the positions of the configured trigger states in CSI-SemiPersistentOnPUSCH-TriggerStateList, with codepoint '0' mapped to the triggering state in the first position. A UE validates, for semi-persistent CSI activation or release, a PDCCH on a DCI only if the following conditions are met: \n-\tthe CRC parity bits of the DCI format are scrambled with a SP-CSI-RNTI provided by higher layer parameter sp-CSI-RNTI \n-\tSpecial fields for the DCI format are set according to Table 5.2.1.5.2-1 or Table 5.2.1.5.2-2.\nIf validation is achieved, the UE considers the information in the DCI format as a valid activation or valid release of semi-persistent CSI transmission on PUSCH, and the UE activates or deactivates a CSI Reporting Setting indicated by CSI request field in the DCI. If validation is not achieved, the UE considers the DCI format as having been detected with a non-matching CRC.\nTable 5.2.1.5.2-1: Special fields for semi-persistent CSI activation PDCCH validation\n\nTable 5.2.1.5.2-2: Special fields for semi-persistent CSI deactivation PDCCH validation\n\nIf the UE has an active semi-persistent CSI-RS/CSI-IM resource configuration, or an active semi-persistent ZP CSI-RS resource set configuration, and has not received a deactivation command, the activated semi-persistent CSI-RS/CSI-IM resource set or the activated semi-persistent ZP CSI-RS resource set configurations are considered to be active when the corresponding DL BWP is active, otherwise they are considered suspended.\nIf the UE is configured with carrier deactivation, the following configurations in the carrier in activated state would also be deactivated and need re-activation configuration(s): semi-persistent CSI-RS/CSI- IM resource, semi-persistent CSI reporting on PUCCH, semi-persistent SRS, semi-persistent ZP CSI-RS resource set.\n5.2.1.5.3\tAperiodic CSI-RS for tracking for fast SCell activation\nWhen the UE receives an Enhanced Scell Activation/Deactivation MAC-CE that triggers one or two CSI-RS bursts for fast SCell activation for a (set of) deactivated SCell(s),\n-\tif the MAC-CE indicates that the first CSI-RS burst for SCell activation is present in an SCell, then the UE may assume that the first CSI-RS burst for SCell activation is present in that SCell. The first slot of the first CSI-RS burst starts at the m1th SCell slot after the last SCell slot coinciding with the reference slot n+k, as defined in clause 4.3 of [6, TS38.213].\n-\tif the MAC-CE indicates that the second CSI-RS burst for SCell activation is present in an SCell, then the UE may assume that the second CSI-RS burst for SCell activation is present in that SCell. The first slot of the second CSI-RS burst starts at the m2th SCell slot after the end of the first CSI-RS burst. The CSI-RS of the second burst shall have the same antenna port index, OFDM symbol allocations in a slot, same PRB allocation location as the CSI-RS of the first burst.\n-\twhere the CSI-RS burst is defined as four CSI-RS resources in two consecutive slots in clause 5.1.6.1.1.1, and m1 and m2 are provided by aperiodicTriggeringOffsetL2 in NZP-CSI-RS-ResourceSet and gapBetweenBursts, respectively, associated with the CSI-RS burst(s) triggered by the MAC-CE.\n5.2.1.6\tCSI processing criteria\nThe UE indicates the number of supported simultaneous CSI calculations  with parameter simultaneousCSI-ReportsPerCC in a component carrier, and simultaneousCSI-ReportsAllCC across all component carriers. If a UE supports  simultaneous CSI calculations it is said to have  CSI processing units for processing CSI reports. If L CPUs are occupied for calculation of CSI reports in a given OFDM symbol, the UE has  unoccupied CPUs. If N CSI reports start occupying their respective CPUs on the same OFDM symbol on which  CPUs are unoccupied, where each CSI report  corresponds to , the UE is not required to update the  requested CSI reports with lowest priority (according to Clause 5.2.5), where is the largest value such that  holds. \nA UE is not expected to be configured with an aperiodic CSI trigger state containing more than  Reporting Settings. Processing of a CSI report occupies a number of CPUs for a number of symbols as follows:\n-\tfor a CSI report with CSI-ReportConfig with higher layer parameter reportQuantity set to 'none' and CSI-RS-ResourceSet with higher layer parameter trs-Info configured\n-\t for a CSI report with LTM-CSI-ReportConfig or a CSI report with CSI-ReportConfig with higher layer parameter reportQuantity set to 'cri-RSRP', 'ssb-Index-RSRP', 'cri-SINR', 'ssb-Index-SINR', 'cri-RSRP- Index', 'ssb-Index-RSRP- Index', 'cri-SINR- Index', 'ssb-Index-SINR- Index ' or 'none' (and CSI-RS-ResourceSet with higher layer parameter trs-Info not configured)\n-\t, for a CSI report with CSI-ReportConfig with higher layer parameter reportQuantity set to 'tdcp' and with number of delays  configured by higher layer parameter Y, where the value of  is reported by UE capability.\n-\tfor a CSI report with CSI-ReportConfig with higher layer parameter reportQuantity set to 'cri-RI-PMI-CQI', 'cri-RI-i1', 'cri-RI-i1-CQI', 'cri-RI-CQI', or 'cri-RI-LI-PMI-CQI', \n-\tif max{ \u00b5PDCCH, \u00b5CSI-RS, \u00b5UL} \u2264 3, and if a CSI report is aperiodically triggered without transmitting a PUSCH with either transport block or HARQ-ACK or both when L = 0 CPUs are occupied, where the CSI corresponds to a single CSI with wideband frequency-granularity and to at most 4 CSI-RS ports in a single resource without CRI report and where codebookType is set to 'typeI-SinglePanel' or where reportQuantity is set to 'cri-RI-CQI', ,\n-\tif a CSI-ReportConfig is configured with codebookType set to 'typeI-SinglePanel' and the corresponding CSI-RS Resource Set for channel measurement is configured with two Resource Groups and  Resource Pairs, , where  is the number of CPUs occupied by a pair of CMRs subject to mTRP-CSI-numCPU-r17 and  is defined in clause 5.2.1.4.2,\n-\tif a CSI-ReportConfig contains a list of L sub-configurations provided by the higher layer parameter [csi-ReportSubConfigList], \n-\t for periodic CSI reporting, where  is the total number of CSI-RS resources corresponding to the i-th sub-configuration.\n-\t for aperiodic and semi-persistent CSI reporting, where  is the total number of CSI-RS resources corresponding to the i-th sub-configuration, and where the i-th sub-configuration is from N indicated sub-configurations out of L sub-configurations contained in a CSI-ReportConfig, where  and .\n-\tif a CSI-ReportConfig is configured with the higher layer parameter reportQuantity set to 'cri-RI-PMI-CQI', codebookType set to 'typeII-CJT-r18' or 'typeII-CJT-PortSelection-r18' and the corresponding NZP-CSI-RS-ResourceSet for channel measurement is configured with  resources, , where  is reported by UE capability indication, \n-\tif a CSI-ReportConfig is configured with the higher layer parameter reportQuantity set to 'cri-RI-PMI-CQI' and with codebookType set to 'typeII-Doppler-r18' or 'typeII-Doppler-PortSelection-r18',\n-\tif the corresponding CSI-RS Resource Set for channel measurement is aperiodic and configured with  CSI-RS resources,   for  and  for , where  is reported by UE capability indication,\n-\tif the corresponding CSI-RS Resource Set for channel measurement is periodic or semi-persistent and configured with a single CSI-RS resource,  for  and ) for , where the value of  is configured by the higher layer parameter N4, and is reported by UE capability indication,\n-\totherwise, , where is the number of CSI-RS resources in the CSI-RS resource set for channel measurement.\nFor a CSI report with CSI-ReportConfig with higher layer parameter reportQuantity not set to 'none', the CPU(s) are occupied for a number of OFDM symbols as follows:\n-\tA periodic or semi-persistent CSI report (excluding an initial semi-persistent CSI report on PUSCH after the PDCCH triggering the report and a semi-persistent CSI report on PUSCH configured with the higher layer parameter codebookType set to 'typeII-Doppler-r18' or 'typeII-Doppler-PortSelection-r18') occupies CPU(s) from the first symbol of the earliest one of each CSI-RS/CSI-IM/SSB resource, or each CSI-RS/CSI-IM resource associated with all configured sub-configurations for periodic CSI report corresponding to a CSI-ReportConfig that contains a list of sub-configurations provided by csi-ReportSubConfigList, or each CSI-RS/CSI-IM resource associated with all activated/triggered sub-configurations for semi-persistent CSI report corresponding to a CSI-ReportConfig that contains a list of sub-configurations provided by csi-ReportSubConfigList, for channel or interference measurement, respective latest CSI-RS/CSI-IM/SSB occasion no later than the corresponding CSI reference resource, until the last symbol of the configured PUSCH/PUCCH carrying the report.\n-\tAn aperiodic CSI report occupies CPU(s) from the first symbol after the PDCCH triggering the CSI report until the last symbol of the scheduled PUSCH carrying the report. When the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the purpose of determining the CPU occupation duration, the PDCCH candidate that ends later in time is used.\n-\tAn initial semi-persistent CSI report on PUSCH after the PDCCH trigger occupies CPU(s) from the first symbol after the PDCCH until the last symbol of the scheduled PUSCH carrying the report. When the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the purpose of determining the CPU occupation duration, the PDCCH candidate that ends later in time is used.\n-\tA semi-persistent CSI report on PUSCH configured with the higher layer parameter codebookType set to 'typeII-Doppler-r18' or 'typeII-Doppler-PortSelection-r18' occupies CPU(s) from the first symbol of KP-th latest consecutive periodic/semi-persistent CSI-RS occasions no later than CSI reference resource, until the last symbol of the PUSCH carrying the report, where the value of  is indicated by UE capability.\nFor a CSI report with CSI-ReportConfig with higher layer parameter reportQuantity set to 'none' and CSI-RS-ResourceSet with higher layer parameter trs-Info not configured, the CPU(s) are occupied for a number of OFDM symbols as follows:\n-\tA semi-persistent CSI report (excluding an initial semi-persistent CSI report on PUSCH after the PDCCH triggering the report) occupies CPU(s) from the first symbol of the earliest one of each transmission occasion of periodic or semi-persistent CSI-RS/SSB resource for channel measurement for L1-RSRP computation, until  symbols after the last symbol of the latest one of the CSI-RS/SSB resource for channel measurement for L1-RSRP computation in each transmission occasion.\n-\tAn aperiodic CSI report occupies CPU(s) from the first symbol after the PDCCH triggering the CSI report until the last symbol between  symbols after the first symbol after the PDCCH triggering the CSI report and  symbols after the last symbol of the latest one of each CSI-RS/SSB resource for channel measurement for L1-RSRP computation.\nwhere  are defined in the table 5.4-2.\nIn any slot, the UE is not expected to have more active CSI-RS ports or active CSI-RS resources in active BWPs than reported as capability. NZP CSI-RS resource is active in a duration of time defined as follows. For aperiodic CSI-RS, starting from the end of the PDCCH containing the request and ending at the end of the scheduled PUSCH containing the report associated with this aperiodic CSI-RS. When the PDCCH candidates are associated with a search space set configured with searchSpaceLinkingId, for the purpose of determining the NZP CSI-RS resource active duration, the PDCCH candidate that ends later in time among the two linked PDCCH candidates is used. For semi-persistent CSI-RS, starting from the end of when the activation command is applied, and ending at the end of when the deactivation command is applied. For periodic CSI-RS, starting when the periodic CSI-RS is configured by higher layer signalling, and ending when the periodic CSI-RS configuration is released. \nIf a CSI-RS resource is referred N times by one or more CSI Reporting Settings not configured with higher layer parameter csi-ReportSubConfigList, the CSI-RS resource and the CSI-RS ports within the CSI-RS resource are counted N times. \nFor a CSI-RS Resource Set for channel measurement configured with two Resource Groups and  Resource Pairs, if a CSI-RS resource is referred  times by one of the  CSI-RS resources, where  is defined in clause 5.2.1.4.2, and/or one or two Resource Pairs, the CSI-RS resource and the CSI-RS ports within the CSI-RS resource are counted  times. \nFor a CSI-ReportConfig containing a list of L sub-configuration(s) provided by higher layer parameter csi-ReportSubConfigList, if a CSI-RS resource is referred by M sub-configurations among N triggered sub-configurations for CSI reporting for aperiodic CSI-RS resource, or L configured sub-configurations for CSI reporting for periodic or semi-persistent CSI-RS resource, the CSI-RS resource is counted M times and the CSI-RS ports within the CSI-RS resource are counted , where P is the number of ports configured by nrofPorts and  is the number of CSI-RS ports in s-th sub-configuration from M sub-configurations derived from the corresponding antenna port subset indicator [port-subsetIndicator] according to clause 5.2.1.4.2 if configured, otherwise  .\nFor a periodic or semi-persistent CSI-RS resource in a CSI-RS resource set for channel measurement linked to a CSI-ReportConfig configured with the higher layer parameter codebookType set to 'typeII-Doppler-r18' or 'typeII-Doppler-PortSelection-r18', the CSI-RS resource and the CSI-RS ports within the CSI-RS resource are counted  times, where the value of  is indicated by UE capability.\n5.2.2\tChannel state information\n5.2.2.1\tChannel quality indicator (CQI) \nThe CQI indices and their interpretations are given in Table 5.2.2.1-2 or Table 5.2.2.1-4 for reporting CQI based on QPSK, 16QAM and 64QAM. The CQI indices and their interpretations are given in Table 5.2.2.1-3 for reporting CQI based on QPSK, 16QAM, 64QAM and 256QAM. The CQI indices and their interpretations are given in Table 5.2.2.1-5 for reporting CQI based on QPSK, 16QAM, 64QAM, 256QAM and 1024 QAM.\nBased on an unrestricted observation interval in time unless specified otherwise in this Clause, and an unrestricted observation interval in frequency, the UE shall derive for each CQI value reported in uplink slot n the highest CQI index which satisfies the following condition:\n-\tA single PDSCH transport block with a combination of modulation scheme, target code rate and transport block size corresponding to the CQI index, and occupying a group of downlink physical resource blocks termed the CSI reference resource, could be received with a transport block error probability not exceeding: \n-\t0.1, if the higher layer parameter cqi-Table in CSI-ReportConfig configures 'table1' (corresponding to Table 5.2.2.1-2), or 'table2' (corresponding to Table 5.2.2.1-3), or if the higher layer parameter cqi-Table in CSI-ReportConfig configures 'table4-r17' (corresponding to Table 5.2.2.1-5), or\n-\t0.00001, if the higher layer parameter cqi-Table in CSI-ReportConfig configures 'table3' (corresponding to Table 5.2.2.1-4).\nIf the higher layer parameter timeRestrictionForChannelMeasurements is set to \"notConfigured\", the UE shall derive the channel measurements for computing CSI value reported in uplink slot n based on only the NZP CSI-RS, no later than the CSI reference resource, (defined in TS 38.211[4]) associated with the CSI resource setting. \nIf the higher layer parameter timeRestrictionForChannelMeasurements in CSI-ReportConfig is set to \"Configured\", the UE shall derive the channel measurements for computing CSI reported in uplink slot n based on only the most recent, no later than the CSI reference resource, in cell DTX active time of a serving cell if cell DTX is activated, occasion of NZP CSI-RS (defined in [4, TS 38.211]) associated with the CSI resource setting on the serving cell. \nIf the higher layer parameter timeRestrictionForInterferenceMeasurements is set to \"notConfigured\", the UE shall derive the interference measurements for computing CSI value reported in uplink slot n based on only the CSI-IM and/or NZP CSI-RS for interference measurement no later than the CSI reference resource associated with the CSI resource setting. \nIf the higher layer parameter timeRestrictionForInterferenceMeasurements in CSI-ReportConfig is set to \"Configured\", the UE shall derive the interference measurements for computing the CSI value reported in uplink slot n based on the most recent, no later than the CSI reference resource, in cell DTX active time of a serving cell if cell DTX is activated, occasion of CSI-IM and/or NZP CSI-RS for interference measurement (defined in [4, TS 38.211]) associated with the CSI resource setting on the serving cell. \nIf the higher layer parameter cqi-BitsPerSubband in CSI-ReportConfig is not configured, for each sub-band index s, a 2-bit sub-band differential CQI is defined as:\n-\tSub-band Offset level (s) = sub-band CQI index (s) - wideband CQI index.\nThe mapping from the 2-bit sub-band differential CQI values to the offset level is shown in Table 5.2.2.1-1\nTable 5.2.2.1-1: Mapping sub-band differential CQI value to offset level\n\nIf the higher layer parameter cqi-BitsPerSubband in CSI-ReportConfig is configured, for each sub-band index s, a 4-bit sub-band CQI is reported. The 4-bit sub-band CQI for each sub-band s is a CQI index in Table 5.2.2.1-2, Table 5.2.2.1-3, or Table 5.2.2.1-4 as configured by the higher layer parameter cqi-Table in CSI-ReportConfig. \nA combination of modulation scheme and transport block size corresponds to a CQI index if:\n-\tthe combination could be signaled for transmission on the PDSCH in the CSI reference resource according to the Transport Block Size determination described in Clause 5.1.3.2, and \n-\tthe modulation scheme is indicated by the CQI index, and \n-\tthe combination of transport block size and modulation scheme when applied to the reference resource results in the effective channel code rate which is the closest possible to the code rate indicated by the CQI index. If more than one combination of transport block size and modulation scheme results in an effective channel code rate equally close to the code rate indicated by the CQI index, only the combination with the smallest of such transport block sizes is relevant.\nTable 5.2.2.1-2: 4-bit CQI Table\n\nTable 5.2.2.1-3: 4-bit CQI Table 2\n\nTable 5.2.2.1-4: 4-bit CQI Table 3\n\nTable 5.2.2.1-5: 4-bit CQI Table 4\n\n5.2.2.1.1\t(void)\n5.2.2.2\tPrecoding matrix indicator (PMI) \n5.2.2.2.1\tType I Single-Panel Codebook\nFor 2 antenna ports {3000, 3001} and the UE configured with higher layer parameter codebookType set to 'typeI-SinglePanel' each PMI value corresponds to a codebook index given in Table 5.2.2.2.1-1. The UE is configured with the higher layer parameter twoTX-CodebookSubsetRestriction. The bitmap parameter twoTX-CodebookSubsetRestriction forms the bit sequence  where  is the LSB and  is the MSB and where a bit value of zero indicates that PMI reporting is not allowed to correspond to the precoder associated with the bit. Bits 0 to 3 are associated respectively with the codebook indices 0 to 3 for  layer, and bits 4 and 5 are associated respectively with the codebook indices 0 and 1 for  layers.\nTable 5.2.2.2.1-1: Codebooks for 1-layer and 2-layer CSI reporting using antenna ports 3000 to 3001\n\nFor 4 antenna ports {3000, 3001, 3002, 3003}, 8 antenna ports {3000, 3001, \u2026, 3007}, 12 antenna ports {3000, 3001, \u2026, 3011}, 16 antenna ports {3000, 3001, \u2026, 3015}, 24 antenna ports {3000, 3001, \u2026, 3023}, and 32 antenna ports {3000, 3001, \u2026, 3031}, and the UE configured with higher layer parameter codebookType set to 'typeI-SinglePanel', except when the number of layers (where  is the associated RI value), each PMI value corresponds to three codebook indices ,,. When the number of layers , each PMI value corresponds to four codebook indices ,,,. The composite codebook index  is defined by \n\t\nThe codebooks for 1-8 layers are given respectively in Tables 5.2.2.2.1-5, 5.2.2.2.1-6, 5.2.2.2.1-7, 5.2.2.2.1-8, 5.2.2.2.1-9, 5.2.2.2.1-10, 5.2.2.2.1-11, and 5.2.2.2.1-12. The mapping from  to  and  for 2-layer reporting is given in Table 5.2.2.2.1-3. The mapping from  to  and  for 3-layer and 4-layer reporting when  is given in Table 5.2.2.2.1-4. The quantities , , , , and  are given by\n\t\n-\tThe values of and  are configured with the higher layer parameter n1-n2, respectively. The supported configurations of  for a given number of CSI-RS ports and the corresponding values of  are given in Table 5.2.2.2.1-2. The number of CSI-RS ports, , is.\n-\tUE shall only use  and shall not report  if the value of N2 is 1.\nThe bitmap parameter n1-n2 forms the bit sequence  where  is the LSB and  is the MSB and where a bit value of zero indicates that PMI reporting is not allowed to correspond to any precoder associated with the bit. The number of bits is given by . Except when the number of layers and the number of antenna ports is 16, 24, or 32, bit  is associated with all precoders based on the quantity , , . When the number of layers and the number of antenna ports is 16, 24, or 32, \n-\tbits , , and  are each associated with all precoders based on the quantity , , ;\n-\tif one or more of the associated bits is zero, then PMI reporting is not allowed to correspond to any precoder based on . \nFor UE configured with higher layer parameter codebookType set to 'typeI-SinglePanel', the bitmap parameter typeI-SinglePanel-ri\u2011Restriction forms the bit sequence  where  is the LSB and  is the MSB. When  is zero, , PMI and RI reporting are not allowed to correspond to any precoder associated with  layers.\nFor UE configured with higher layer parameter reportQuantity set to 'cri-RI-i1-CQI', the bitmap parameter typeI-SinglePanel-codebookSubsetRestriction-i2 forms the bit sequence , where  is the LSB and  is the MSB. The bit  is associated with precoders corresponding to codebook index . When  is zero, the randomly selected precoder for CQI calculation is not allowed to correspond to any precoder associated with the bit . \nTable 5.2.2.2.1-2: Supported configurations of and \n\nTable 5.2.2.2.1-3: Mapping of  to  and  for 2-layer CSI reporting\n\nTable 5.2.2.2.1-4: Mapping of  to  and  for 3-layer and 4-layer CSI reporting when \n\nTable 5.2.2.2.1-5: Codebook for 1-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\n\n\n\nTable 5.2.2.2.1-6: Codebook for 2-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\n\n\n\nTable 5.2.2.2.1-7: Codebook for 3-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\n\n\nTable 5.2.2.2.1-8: Codebook for 4-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\n\n\nTable 5.2.2.2.1-9: Codebook for 5-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\n\nTable 5.2.2.2.1-10: Codebook for 6-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\n\nTable 5.2.2.2.1-11: Codebook for 7-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\n\nTable 5.2.2.2.1-12: Codebook for 8-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\n\n5.2.2.2.2\tType I Multi-Panel Codebook\nFor 8 antenna ports {3000, 3001, \u2026, 3007}, 16 antenna ports {3000, 3001, \u2026, 3015}, and 32 antenna ports {3000, 3001, \u2026, 3031}, and the UE configured with higher layer parameter codebookType set to 'typeI-MultiPanel',\n-\tThe values of , and  are configured with the higher layer parameters ng-n1-n2. The supported configurations of  for a given number of CSI-RS ports and the corresponding values of  are given in Table 5.2.2.2.2-1. The number of CSI-RS ports, , is .\n-\tWhen , codebookMode shall be set to either '1' or '2'. When , codebookMode shall be set to '1'.\nThe bitmap parameter ng-n1-n2 forms the bit sequence  where  is the LSB and  is the MSB and where a bit value of zero indicates that PMI reporting is not allowed to correspond to any precoder associated with the bit. The number of bits is given by . Bit  is associated with all precoders based on the quantity , , , as defined below. The bitmap parameter ri\u2011Restriction forms the bit sequence  where  is the LSB and  is the MSB. When  is zero, , PMI and RI reporting are not allowed to correspond to any precoder associated with  layers.\nTable 5.2.2.2.2-1: Supported configurations of  and \n\nEach PMI value corresponds to the codebook indices  and , where  is the vector\n\t\nand  is the associated RI value. When codebookMode is set to '1',  is\n\t.\nWhen codebookMode is set to '2',  and  are\n\t.\nThe mapping from  to  and  for 2-layer reporting is given in Table 5.2.2.2.1-3. The mapping from  to  and  for 3-layer and 4-layer reporting is given in Table 5.2.2.2.2-2. \n-\tUE shall only use  and shall not report  if the value of N2 is 1.\nTable 5.2.2.2.2-2: Mapping of  to  and  for 3-layer and 4-layer CSI reporting\n\nSeveral quantities are used to define the codebook elements. The quantities , , , , and  are given by\n\t\nFurthermore, the quantities  and  () are given by\n\t\nwhere\n\t,\nand the quantities  and  () are given by\n\t\nwhere\n\t.\nThe codebooks for 1-4 layers are given respectively in Tables 5.2.2.2.2-3, 5.2.2.2.2-4, 5.2.2.2.2-5, and 5.2.2.2.2-6.\nTable 5.2.2.2.2-3: Codebook for 1-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\n\n\nTable 5.2.2.2.2-4: Codebook for 2-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\n\n\nTable 5.2.2.2.2-5: Codebook for 3-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\n\n\nTable 5.2.2.2.2-6: Codebook for 4-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\n\n\n5.2.2.2.3\tType II Codebook\nFor 4 antenna ports {3000, 3001, \u2026, 3003}, 8 antenna ports {3000, 3001, \u2026, 3007}, 12 antenna ports {3000, 3001, \u2026, 3011}, 16 antenna ports {3000, 3001, \u2026, 3015}, 24 antenna ports {3000, 3001, \u2026, 3023}, and 32 antenna ports {3000, 3001, \u2026, 3031}, and the UE configured with higher layer parameter codebookType set to 'typeII'\n-\tThe values of and  are configured with the higher layer parameter n1-n2-codebookSubsetRestriction. The supported configurations of  for a given number of CSI-RS ports and the corresponding values of  are given in Table 5.2.2.2.1-2. The number of CSI-RS ports, , is .\n-\tThe value of  is configured with the higher layer parameter numberOfBeams, where  when  and  when .\n-\tThe value of  is configured with the higher layer parameter phaseAlphabetSize, where .\n-\tThe UE is configured with the higher layer parameter subbandAmplitude set to 'true' or 'false'.\n-\tThe UE shall not report RI > 2.\nWhen , where  is the associated RI value, each PMI value corresponds to the codebook indices  and  where\n\t..\nThe  vectors combined by the codebook are identified by the indices  and , where\n\t\n\t.\n Let\n\t \nand\n\t .\nwhere the values of  are given in Table 5.2.2.2.3-1.\nThen the elements of  and  are found from using the algorithm:\n \nfor  \nFind the largest  in Table 5.2.2.2.3-1 such that  \n \n \n \n \n \nWhen  and  are known,  is found using:\n where the indices  are assigned such that  increases as  increases\n, where  is given in Table 5.2.2.2.3-1.\n-\tIf ,  and  for , and  is not reported. \n-\tWhen ,  and , and  is not reported. \n-\tWhen  and ,  and , and  is not reported.\n-\tWhen  and ,  and, and  is not reported.\nTable 5.2.2.2.3-1: Combinatorial coefficients \n\nThe strongest coefficient on layer  is identified by .\nThe amplitude coefficient indicators  and  are\n\t\nfor . The mapping from  to the amplitude coefficient  is given in Table 5.2.2.2.3-2 and the mapping from  to the amplitude coefficient  is given in Table 5.2.2.2.3-3. The amplitude coefficients are represented by\n\t\nfor .\nTable 5.2.2.2.3-2: Mapping of elements of :  to \n\nTable 5.2.2.2.3-3: Mapping of elements of :  to \n\nThe phase coefficient indicators are \n\t\nfor .\nThe amplitude and phase coefficient indicators are reported as follows:\n-\tThe indicators , , and  (). , , and  are not reported for .\n-\tThe remaining  elements of  () are reported, where . Let  () be the number of elements of  that satisfy .\n-\tThe remaining  elements of  and  () are reported as follows:\n-\tWhen subbandAmplitude is set to 'false',\n-\t for , and .  is not reported for .\n-\tFor , the elements of  corresponding to the coefficients that satisfy , , as determined by the reported elements of , are reported, where  and the remaining  elements of  are not reported and are set to .\n-\tWhen subbandAmplitude is set to 'true',\n-\tFor , the elements of  and  corresponding to the  strongest coefficients (excluding the strongest coefficient indicated by), as determined by the corresponding reported elements of , are reported, where and . The values of  are given in Table 5.2.2.2.3-4. The remaining  elements of  are not reported and are set to . The elements of  corresponding to the  weakest non-zero coefficients are reported, where . The remaining  elements of  are not reported and are set to .\n-\tWhen two elements,  and , of the reported elements of  are identical (), then element  is prioritized to be included in the set of the  strongest coefficients for  and  () reporting.\nTable 5.2.2.2.3-4: Full resolution subband coefficients when subbandAmplitude is set to 'true'\n\nThe codebooks for 1-2 layers are given in Table 5.2.2.2.3-5, where the indices  and  are given by\n\t\nfor , and the quantities , , and  are given by\n\t.\n\nTable 5.2.2.2.3-5: Codebook for 1-layer and 2-layer CSI reporting using antenna ports 3000 to 2999+PCSI\u2011RS\n\nWhen the UE is configured with higher layer parameter codebookType set to 'typeII', thebitmap parameter typeII-RI\u2011Restriction forms the bit sequence  where  is the LSB and  is the MSB. When  is zero, , PMI and RI reporting are not allowed to correspond to any precoder associated with  layers. The bitmap parameter n1-n2\u2011codebookSubsetRestriction forms the bit sequence where bit sequences , and are concatenated to form . To define  and , first define the  vector groups  as\n\t \nfor\n\t.\nThe UE shall be configured with restrictions for 4 vector groups indicated by  for  and identified by the group indices\n\t \nfor , where the indices are assigned such that  increases as  increases. The remaining vector groups are not restricted.\n-\tIf ,  for , and  is empty.\n-\tIf ,  is the binary representation of the integer  where  is the MSB and  is the LSB. is found using:\n\t,\nwhere  is defined in Table 5.2.2.2.3-1. The group indices  and indicators  for  may be found from  using the algorithm:\n \nfor  \nFind the largest  such that  \n \n \n \n \n \nThe bit sequence  is the concatenation of the bit sequences  for , corresponding to the group indices . The bit sequence  is defined as\n\t \nBits  indicate the maximum allowed amplitude coefficient  for the vector in group  indexed by , where the maximum amplitude coefficients are given in Table 5.2.2.2.3-6. A UE that does not report parameter amplitudeSubsetRestriction = 'supported' in its capability signaling is not expected to be configured with  = 01 or 10.\nTable 5.2.2.2.3-6: Maximum allowed amplitude coefficients for restricted vectors\n\n5.2.2.2.4\tType II Port Selection Codebook\nFor 4 antenna ports {3000, 3001, \u2026, 3003}, 8 antenna ports {3000, 3001, \u2026, 3007}, 12 antenna ports {3000, 3001, \u2026, 3011}, 16 antenna ports {3000, 3001, \u2026, 3015}, 24 antenna ports {3000, 3001, \u2026, 3023}, and 32 antenna ports {3000, 3001, \u2026, 3031}, and the UE configured with higher layer parameter codebookType set to 'typeII-PortSelection'\n-\tThe number of CSI-RS ports is given by as configured by higher layer parameter nrofPorts.\n-\tThe value of  is configured with the higher layer parameter numberOfBeams , where  when  and  when .\n-\tThe value of  is configured with the higher layer parameter portSelectionSamplingSize, where  and .\n-\tThe value of  is configured with the higher layer parameter phaseAlphabetSize, where .\n-\tThe UE is configured with the higher layer parameter subbandAmplitude set to 'true' or 'false'.\n-\tThe UE shall not report RI > 2.\nThe UE is also configured with the higher layer parameter typeII-PortSelectionRI\u2011Restriction. The bitmap parameter typeII-PortSelectionRI\u2011Restriction forms the bit sequence  where  is the LSB and  is the MSB. When  is zero, , PMI and RI reporting are not allowed to correspond to any precoder associated with  layers.\nWhen , where  is the associated RI value, each PMI value corresponds to the codebook indices  and  where\n\t.\nThe  antenna ports per polarization are selected by the index , where\n\t.\nThe strongest coefficient on layer  is identified by .\nThe amplitude coefficient indicators  and  are\n\t\nfor . The mapping from  to the amplitude coefficient  is given in Table 5.2.2.2.3-2 and the mapping from  to the amplitude coefficient  is given in Table 5.2.2.2.3-3. The amplitude coefficients are represented by\n\t\nfor .\nThe phase coefficient indicators are \n\t\nfor .\nThe amplitude and phase coefficient indicators are reported as follows:\n-\tThe indicators , , and  (). , , and  are not reported for .\n-\tThe remaining  elements of  () are reported, where . Let  () be the number of elements of that satisfy .\n-\tThe remaining  elements of  and  () are reported as follows:\n-\tWhen subbandAmplitude is set to 'false',\n-\t for , and .  is not reported for .\n-\tFor , the  elements of  corresponding to the coefficients that satisfy , , as determined by the reported elements of , are reported, where  and the remaining  elements of  are not reported and are set to .\n-\tWhen subbandAmplitude is set to 'true',\n-\tFor , the elements of  and  corresponding to the  strongest coefficients (excluding the strongest coefficient indicated by), as determined by the corresponding reported elements of , are reported, where and . The values of  are given in Table 5.2.2.2.3-4. The remaining  elements of  are not reported and are set to . The elements of  corresponding to the  weakest non-zero coefficients are reported, where . The remaining  elements of  are not reported and are set to .\n-\tWhen two elements,  and , of the reported elements of  are identical (), then element  is prioritized to be included in the set of the  strongest coefficients for  and  () reporting.\nThe codebooks for 1-2 layers are given in Table 5.2.2.2.4-1, where the quantity  is given by\n\t\nand  is a -element column vector containing a value of 1 in element  and zeros elsewhere (where the first element is element 0).\nTable 5.2.2.2.4-1: Codebook for 1-layer and 2-layer CSI reporting using antenna ports 3000 to 2999+PCSI\u2011RS\n\n5.2.2.2.5\tEnhanced Type II Codebook\nFor 4 antenna ports {3000, 3001, \u2026, 3003}, 8 antenna ports {3000, 3001, \u2026, 3007}, 12 antenna ports {3000, 3001, \u2026, 3011}, 16 antenna ports {3000, 3001, \u2026, 3015}, 24 antenna ports {3000, 3001, \u2026, 3023}, and 32 antenna ports {3000, 3001, \u2026, 3031}, and UE configured with higher layer parameter codebookType set to ' typeII-r16'\n-\tThe values of  and  are configured with the higher layer parameter n1-n2-codebookSubsetRestriction-r16. The supported configurations of  for a given number of CSI-RS ports and the corresponding values of   are given in Table 5.2.2.2.1-2. The number of CSI-RS ports, , is .\n-\tThe values of ,  and  are determined by the higher layer parameter paramCombination-r16, where the mapping is given in Table 5.2.2.2.5-1.\n-\tThe UE is not expected to be configured with paramCombination-r16 equal to\n-\t3, 4, 5, 6, 7, or 8 when ,\n-\t7 or 8 when \n-\t7 or 8 when higher layer parameter typeII-RI-Restriction-r16 is configured with  for any .\n-\t7 or 8 when .\n-\tThe parameter  is configured with the higher-layer parameter numberOfPMI-SubbandsPerCQI-Subband. This parameter controls the total number of precoding matrices  indicated by the PMI as a function of the number of configured subbands in csi-ReportingBand, the subband size configured by the higher-level parameter subbandSize and of the total number of PRBs in the bandwidth part according to Table 5.2.1.4-2, as follows:\n-\tWhen :\n-\tOne precoding matrix is indicated by the PMI for each subband in csi-ReportingBand.\n-\tWhen :\n-\tFor each subband in csi-ReportingBand that is not the first or last subband of a BWP, two precoding matrices are indicated by the PMI: the first precoding matrix corresponds to the first  PRBs of the subband and the second precoding matrix corresponds to the last  PRBs of the subband.\n-\tFor each subband in csi-ReportingBand that is the first or last subband of a BWP\n-\tIf , one precoding matrix is indicated by the PMI corresponding to the first subband. If , two precoding matrices are indicated by the PMI corresponding to the first subband: the first precoding matrix corresponds to the first  PRBs of the first subband and the second precoding matrix corresponds to the last  PRBs of the first subband.\n-\tIf , one precoding matrix is indicated by the PMI corresponding to the last subband. If , two precoding matrices are indicated by the PMI corresponding to the last subband: the first precoding matrix corresponds to the first  PRBs of the last subband and the second precoding matrix corresponds to the last    PRBs of the last subband.\nTable 5.2.2.2.5-1: Codebook parameter configurations for   and \n\n-\tThe UE shall report the RI value  according to the configured higher layer parameter typeII-RI-Restriction-r16. The UE shall not report .\nThe PMI value corresponds to the codebook indices of  and  where\n\nThe precoding matrices indicated by the PMI are determined from  vectors.\n vectors, , are identified by the indices , , indicated by , , obtained as in 5.2.2.2.3, where the values of  are given in Table 5.2.2.2.5-4. \n vectors, , , are identified by  (for ) and where\n\n\n\nwhich are indicated by means of the indices  (for ) and  , where\n\n\nThe amplitude coefficient indicators  and  are\n\n\n\n\n\nfor .\nThe phase coefficient indicator is \n\n\n\nfor \nLet . The bitmap whose nonzero bits identify which coefficients in  and are reported, is indicated by \n\n\n\nfor , such that  is the number of nonzero coefficients for layer  and  is the total number of nonzero coefficients. \nThe indices of ,  and  are associated to the  codebook indices in .\nThe mapping from  to the amplitude coefficient  is given in Table 5.2.2.2.5-2 and the mapping from  to the amplitude coefficient  is given in Table 5.2.2.2.5-3. The amplitude coefficients are represented by \n\n\n\nfor.\nLet  be the index of  and  be the index of  which identify the strongest coefficient of layer , i.e., the element  of , for . The codebook indices of  are remapped with respect to  as , such that , after remapping. The index  is remapped with respect to  as , such that the index of the strongest coefficient is  (), after remapping. The indices of ,  and  indicate amplitude coefficients, phase coefficients and bitmap after remapping.\nThe strongest coefficient of layer  is identified by , which is obtained as follows\n\t \nfor .\nTable 5.2.2.2.5-2: Mapping of elements of :  to \n\nThe amplitude and phase coefficient indicators are reported as follows:\n-\t, ,  and   . The indicators ,  and  are not reported for .\n-\tThe indicator  is reported for .\n-\tThe  indicators  for which ,  are reported. \n-\tThe  indicators  for which ,  are reported. \n-\tThe remaining  indicators  are not reported.\n-\tThe remaining  indicators  are not reported.\nTable 5.2.2.2.5-3: Mapping of elements of :  to \n\nThe elements of  and  are found from using the algorithm described in 5.2.2.2.3, where the values of  are given in Table 5.2.2.2.5-4.\nFor ,  is identified by .\nFor all values of ,  for . If , the nonzero elements of , identified by are found from  , for , and from   and , for , using   as defined in Table 5.2.2.2.5-4 and the algorithm:\n \nfor \nFind the largest  in Table 5.2.2.2.5-4 such that\n \n \n \nif \n \nelse\n \nif \n \nelse \n \nend if\nend if\n\nTable 5.2.2.2.5-4: Combinatorial coefficients \n\nWhen  and  are known, and  are found as follows:\n-\tIf  ,  and is not reported. If , , for , and is not reported. If , , where  is given in Table 5.2.2.2.5-4 and where the indices  are assigned such that  increases as  increases.\n-\tIf  ,  is indicated by , which is reported and given by\n\t\n\tOnly the nonzero indices , where, are reported, where the indices  are assigned such that  increases as  increases. Let\n\t\n\tthen , where  is given in Table 5.2.2.2.5-4.\nThe codebooks for 1-4 layers are given in Table 5.2.2.2.5-5, where , , for   are obtained as in clause 5.2.2.2.3, and the quantities  and are given by\n\n\nwhere , is the index associated with the precoding matrix, , and with\n\t\nfor.\nTable 5.2.2.2.5-5: Codebook for 1-layer. 2-layer, 3-layer and 4-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\nFor coefficients with , amplitude and phase are set to zero, i.e.,  and .\nThe bitmap parameter typeII-RI-Restriction-r16 forms the bit sequence  where  is the LSB and  is the MSB. When  is zero, , PMI and RI reporting are not allowed to correspond to any precoder associated with  layers.\nThe bitmap parameter n1-n2-codebookSubsetRestriction-r16 forms the bit sequence  and configures the vector group indices  as in clause 5.2.2.2.3. Bits  indicate the maximum allowed average amplitude,  (), with , of the coefficients associated with the vector in group  indexed by , where the maximum amplitudes are given in Table 5.2.2.2.5-6 and the average coefficient amplitude is restricted as follows\n\t\nfor , and . A UE that does not report the parameter amplitudeSubsetRestriction-r16 = 'supported' in its capability signaling is not expected to be configured with  or .\nTable 5.2.2.2.5-6: Maximum allowed average coefficient amplitudes for restricted vectors\n\n5.2.2.2.6\tEnhanced Type II Port Selection Codebook\nFor 4 antenna ports {3000, 3001, \u2026, 3003}, 8 antenna ports {3000, 3001, \u2026, 3007}, 12 antenna ports {3000, 3001, \u2026, 3011}, 16 antenna ports {3000, 3001, \u2026, 3015}, 24 antenna ports {3000, 3001, \u2026, 3023}, and 32 antenna ports {3000, 3001, \u2026, 3031}, and the UE configured with higher layer parameter codebookType set to ' typeII-PortSelection-r16 '\n-\tThe number of CSI-RS ports is configured as in Clause 5.2.2.2.4 \n-\tThe value of  is configured with the higher layer parameter portSelectionSamplingSize-r16, where  and .\n-\tThe values ,  and  are configured as in Clause 5.2.2.2.5, where the supported configurations are given in Table 5.2.2.2.6-1.\nTable 5.2.2.2.6-1: Codebook parameter configurations for ,  and\n\n-\tThe UE shall report the RI value  according to the configured higher layer parameter typeII-PortSelectionRI-Restriction-r16. The UE shall not report .\n-\tThe value of  is configured as in Clause 5.2.2.2.5.\nThe UE is also configured with the higher layer bitmap parameter typeII-PortSelectionRI-Restriction-r16, which forms the bit sequence , where is the LSB and  is the MSB. When  is zero, , PMI and RI reporting are not allowed to correspond to any precoder associated with  layers.\nThe PMI value corresponds to the codebook indices  and  where\n\nThe  antenna ports are selected by the index  as in clause 5.2.2.2.4.\nParameters ,  (for ) and  are defined as in clause 5.2.2.2.5. \nFor layer , , the strongest coefficient  the amplitude coefficient indicators  and , the phase coefficient indicator  and the bitmap indicator  are defined and indicated as in clause 5.2.2.2.5, where the mapping from  to the amplitude coefficient  is given in Table 5.2.2.2.5-2 and the mapping from  to the amplitude coefficient  is given in Table 5.2.2.2.5-3. \nThe number of nonzero coefficients for layer , , and the total number of nonzero coefficients  are defined as in Clause 5.2.2.2.5. \nThe amplitude coefficients  and   are represented as in clause 5.2.2.2.5.\nThe amplitude and phase coefficient indicators are reported as in clause 5.2.2.2.5. \nCodebook indicators and  are found as in clause 5.2.2.2.5.\nThe codebooks for 1-4 layers are given in Table 5.2.2.2.6-2, where  is a -element column vector containing a value of 1 in element  and zeros elsewhere (where the first element is element 0), and the quantities  and are defined as in clause 5.2.2.2.5.\n\nTable 5.2.2.2.6-2: Codebook for 1-layer. 2-layer, 3-layer and 4-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\nFor coefficients with , amplitude and phase are set to zero, i.e.,  and .\n5.2.2.2.7\tFurther enhanced Type II port selection codebook\nFor 4 antenna ports {3000, 3001, \u2026, 3003}, 8 antenna ports {3000, 3001, \u2026, 3007}, 12 antenna ports {3000, 3001, \u2026, 3011}, 16 antenna ports {3000, 3001, \u2026, 3015}, 24 antenna ports {3000, 3001, \u2026, 3023}, and 32 antenna ports {3000, 3001, \u2026, 3031}, and the UE configured with higher layer parameter codebookType set to ' typeII-PortSelection-r17 '\n-\tThe number of CSI-RS ports, , is configured as in clause 5.2.2.2.4.\n-\tThe values ,  and  are determined by the higher layer parameter paramCombination-r17, where the mapping is given in Table 5.2.2.2.7-1.\n-\tThe UE is not expected to be configured with paramCombination-r17 equal to\n-\t1 or 6 when ,\n-\t7 or 8 when ,\n-\t5 when  and higher layer parameter typeII-PortSelectionRI-Restriction-r17 is configured with  for any .\nTable 5.2.2.2.7-1: Codebook parameter configurations for ,  and \n\n-\tThe parameter  is configured with the higher-layer parameter valueOfN, when .\n-\tThe parameter  is configured with the higher-layer parameter numberOfPMI-SubbandsPerCQI-Subband-r17, when , and  when , where  is defined as in clause 5.2.2.2.5.\n-\tThe UE shall report the RI value  according to the configured higher layer parameter typeII-PortSelectionRI-Restriction-r17. The UE shall not report . The bitmap parameter typeII-PortSelectionRI-Restriction-r17 forms the bit sequence , where is the LSB and  is the MSB. When  is zero, , PMI and RI reporting are not allowed to correspond to any precoder associated with  layers.\nThe PMI value corresponds to the codebook indices  and  where\n\nThe precoding matrices indicated by the PMI are determined from  vectors, where  and .\n ports are selected from  ports based on  vectors, , which are identified by\n\n\nwhich are indicated by the index , where\n\nThe elements of  are found from  using  as defined in Tables 5.2.2.2.5-4 and 5.2.2.2.7-2 and the algorithm:\n \nfor \nFind the largest  in Table 5.2.2.2.5-4, if , or in Table 5.2.2.2.7-2, if , such that  \n \n \n \nWhen  are known,  is found using , where  is given in Tables 5.2.2.2.5-4 and 5.2.2.2.7-2, and where the indices  are assigned such that  increases as  increases.\n-\tIf , , , and  is not reported.\nTable 5.2.2.2.7-2: Combinatorial coefficients \n\n vectors, , , are identified by , where  is defined as in clause 5.2.2.2.5, and where\n\n\nwith the indices  assigned such that  increases with .  is indicated by the index , when  and , where\n\n-\tIf , or  and ,  is not reported.\n-\tIf  and , the nonzero offset between  and  is reported with  assuming that  (reference for the offset) is 0. The nonzero offset values are mapped to the index values of  in increasing order with offset value 1 mapped to index value '0'.\nThe amplitude coefficient indicators  and , for , are\n\n\n\n\n\nThe phase coefficient indicator , for , is \n\n\n\nLet . The bitmap whose nonzero bits identify which coefficients in  and are reported, is indicated by , for \n\n\n\nsuch that  is the number of nonzero coefficients for layer  and  is the total number of nonzero coefficients. \n-\tIf  and ,  is not reported, for .\nThe indices of ,  and  are associated to the  codebook indices in .\nThe mapping from  to the amplitude coefficient  is given in Table 5.2.2.2.5-2 and the mapping from  to the amplitude coefficient  is given in Table 5.2.2.2.5-3. The amplitude coefficients are represented by \n\n\n\nLet  be the index of  and  be the index of  which identify the strongest coefficient of layer , i.e., the element  of , for . The strongest coefficient of layer  is identified by the index\n\nwhich is found from\n\nThe amplitude and phase coefficient indicators are reported as follows:\n-\t, ,  and   . The elements ,  and  are not reported for .\n-\tThe element  is reported for .\n-\tThe  elements  for which ,  are reported. \n-\tThe  elements  for which ,  are reported. \n-\tThe remaining  elements  are not reported.\n-\tThe remaining  elements  are not reported.\nThe codebooks for 1-4 layers are given in Table 5.2.2.2.7-3, where  is a -element column vector containing a value of 1 in the element of index  and zeros elsewhere (where the first element is the element of index 0), the quantities are given by\n\nwhere , is the index associated with the precoding matrix and where\n\nfor , and the quantities  are given by\n\nTable 5.2.2.2.7-3: Codebook for 1-layer. 2-layer, 3-layer and 4-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\n\nFor coefficients with , amplitude and phase are set to zero, i.e.,  and .\n5.2.2.2.8\tEnhanced Type II codebook for CJT\nFor 4 antenna ports {3000, 3001, \u2026, 3003}, 8 antenna ports {3000, 3001, \u2026, 3007}, 12 antenna ports {3000, 3001, \u2026, 3011}, 16 antenna ports {3000, 3001, \u2026, 3015}, 24 antenna ports {3000, 3001, \u2026, 3023}, and 32 antenna ports {3000, 3001, \u2026, 3031} per CSI-RS resource, and the UE configured with  CSI-RS resources in a resource set for channel measurement and with higher layer parameter codebookType set to 'typeII-CJT-r18'\n-\tthe values of ,   and ,  are the same for all  CSI-RS resources and are configured by n1-n2-codebookSubsetRestrictionList-r18. The supported configurations of  for a given number of CSI-RS ports and the corresponding values of  are given in Table 5.2.2.2.1-2. The number of CSI-RS ports, , is  for each of the  CSI-RS resources.\nA set of  combinations of values of  is configured by the higher layer parameter paramCombination-CJT-L-r18, where the value of  is configured by the higher layer parameter numberOfSDCombinations and the mapping is given in Table 5.2.2.2.8-1, with the value of  corresponding to CSI-RS resource , for . A single value of  and  is configured by the higher layer parameter paramCombination-CJT-r18, where the mapping is given in Table 5.2.2.2.8-2. The configurable combinations of  and  are marked with 'x' in Table 5.2.2.2.8-3.\n-\tThe UE is not expected to be configured with paramCombination-CJT-L-r18 equal to\n-\t2, 3 for  2, 3, 4 for ; 2, 3, 4, 5 for ; 2, 3 or 4 for ; when ,\n-\t3 for when ,\n-\t3 for when higher layer parameter typeII-CJT-RI-Restriction-r18 is configured with  for any .\n-\t3 for when .\n-\tIf , the UE is expected to select one of the  configured combinations of  and report the index of the selected combination, where the index value 0 corresponds to the first configured combination and the index value  corresponds to the -th configured combination. If , a single combination of  is configured and the selection is not reported.\nTable 5.2.2.2.8-1: Codebook parameter configurations for \n\nTable 5.2.2.2.8-2: Codebook parameter configurations for \n\nTable 5.2.2.2.8-3: Configurable combinations of  and \n\n-\tThe value of  is configured with the higher-layer parameter numberOfPMI-SubbandsPerCQI-Subband-CJT-r18, where  and the corresponding value of  are defined as in clause 5.2.2.2.5.\n-\tThe UE shall report the RI value  according to the configured higher layer parameter typeII-CJT-RI-Restriction-r18. The UE shall not report . The bitmap parameter typeII-CJT-RI-Restriction-r18 forms the bit sequence  where  is the LSB and  is the MSB. When  is zero, , PMI and RI reporting are not allowed to correspond to any precoder associated with  layers.\n-\tThe UE may be configured with higher layer parameter restrictedCMR-Selection. If restrictedCMR-Selection is configured, the number of selected CSI-RS resources is . Otherwise, the UE is expected to select  CSI-RS resources, with , and the selection is reported with an -bit bitmap, , where the CSI-RS resources are mapped from bit  to bit  by their ordering in the resource set and the first of the  selected CSI-RS resources corresponds to the nonzero bit with lowest index.\nThe PMI value for the  selected CSI-RS resources corresponds to the codebook indices of  and  where\n\n\nThe precoding matrices indicated by the PMI are determined from  vectors, where  are the indices of the  selected CSI-RS resources in increasing order, such that , and  are the corresponding values from the selected combination of .\nThe  vectors, , , corresponding to the -th selected CSI-RS resource, for , are indicated by , , where\n\n\n\n\nand\n\n\nLet\n\n\n\nand\n\n\n\nthe index , for the -th selected CSI-RS resource, , is obtained from the  indices + , , as described in Clause 5.2.2.2.3 for the indicator , obtained from the  indices + , . Vector  is then derived from the indices  and , as described in Clause 5.2.2.2.3 for vector , derived from indices , .\nThe  vectors, , , for layer are common for all the  selected CSI-RS resources and are indicated by  (for ) and  , which are obtained as described in Clause 5.2.2.2.5, where  is derived from the selected vectors identified by the indices , . The  vectors' elements are given by\n\nfor , and .\nIf the higher layer parameter codebookMode is set to 'mode1', an offset  is reported for the -th selected CSI-RS resource, with , relative to the first of the  selected CSI-RS resources. The  reported offsets are common for all  layers and are indicated by , given by\n\nwhere the value of  is configured by higher layer parameter numberOfO3. The offsets are represented by\n\n\nIf codebookMode is set to 'mode2', the offset indicator, , is not reported and  for .\nThe reference amplitude coefficient indicator , for layer , is given by\n\n\nThe reference amplitude coefficients for layer  are represented by\n\nand the mapping from , to  is given in Table 5.2.2.2.5-2. \nThe amplitude coefficient indicator , for layer , is given by\n\n\n\n\nThe amplitude coefficients for layer  are represented by\n\n\n\nand the mapping from  to  is given in Table 5.2.2.2.5-3. \nThe phase coefficient indicator , for , is given by\n\n\n\n\nThe phase coefficients for layer  are represented by\n\n\n\nand the mapping from  to  is given by\n\nLet . The bitmap whose nonzero bits identify which coefficients in  and are reported for layer , is indicated by \n\n\n\n\nLet  be the number of nonzero coefficients for layer , the total number of nonzero coefficients is reported and given by .\nThe indices of ,  and  are associated to the  selected CSI-RS resources.\nLet  and  be the indices which identify the strongest coefficient of layer , for , i.e., the element  of , where the indices ,  are such that . The codebook indices of  are remapped with respect to  as , such that , after remapping. The index  is remapped with respect to  as , such that the index of the strongest coefficient is , for each layer , after remapping. The indices of ,  and  indicate amplitude coefficients, phase coefficients and bitmap after remapping.\nThe strongest coefficient of layer  is identified by \nand is obtained as follows, where, for ,  and index  is such that \n\t\nThe amplitude and phase coefficient indicators are reported as follows:\n-\t, ,  and , for . The reference amplitude, , amplitude coefficient,  and phase coefficient, , are not reported for .\n-\tThe reference amplitude, , is reported for .\n-\tThe  amplitude coefficients, , for which , ,  are reported. \n-\tThe  phase coefficients, , for which , ,  are reported. \n-\tThe remaining  amplitude coefficients, , are not reported.\n-\tThe remaining  phase coefficients, , are not reported.\nThe codebooks for 1-4 layers are given in Table 5.2.2.2.8-4, where , is the index associated with the precoding matrix,  is the layer index, and where, for coefficients with , amplitude and phase are set to zero, i.e.,  and .\nTable 5.2.2.2.8-4: Codebook for 1-layer. 2-layer, 3-layer and 4-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS of N0 selected CSI-RS resources\n\nThe bitmap parameter n1-n2-codebookSubsetRestrictionList-r18 is configured per CSI-RS resource and for at least one of the  CSI-RS resources, and it is configured as described in Clause 5.2.2.2.5, where only the bit values '00' or '11' of Table 5.2.2.2.5-6 are configurable. If parameter n1-n2-codebookSubsetRestrictionList-r18 is not configured for a CSI-RS resource, no restriction is applied to the selection of vectors  corresponding to that resource.\n5.2.2.2.9\tFurther enhanced Type II port selection codebook for CJT\nFor 4 antenna ports {3000, 3001, \u2026, 3003}, 8 antenna ports {3000, 3001, \u2026, 3007}, 12 antenna ports {3000, 3001, \u2026, 3011}, 16 antenna ports {3000, 3001, \u2026, 3015}, 24 antenna ports {3000, 3001, \u2026, 3023}, and 32 antenna ports {3000, 3001, \u2026, 3031} per CSI-RS resource, the UE configured with  CSI-RS resources in a resource set for channel measurement and with higher layer parameter codebookType set to 'typeII-CJT-PortSelection-r18'\n-\tthe number of CSI-RS ports for each CSI-RS resource, , is configured as in clause 5.2.2.2.4.\nA set of  combinations of values of  is configured by the higher layer parameter paramCombination-CJT-PS-alpha-r18, where the value of  is configured by the higher layer parameter numberOfSDCombinations-PS and the mapping is given in Table 5.2.2.2.9-1, with the value of  corresponding to CSI-RS resource , for . A single value of  and  is configured by the higher layer parameter paramCombination-CJT-PS-r18, where the mapping is given in Table 5.2.2.2.9-2. The configurable combinations of  and  are marked with 'x' in Table 5.2.2.2.9-3.\n-\tThe UE is not expected to be configured with paramCombination-CJT-PS-alpha-r18 equal to\n-\t2 for  4 for  2, 3 or 4 for  when ,\n-\t3 for  5 for  8 for  4 for when paramCombination-CJT-PS-r18 is configured to 4 or 5 and ,\n-\t1 for  1, 2, 3 for  1, 2, 3, 4, 5, 6,7 for  1, 2, 3 for  when  and higher layer parameter typeII-CJT-PS-RI-Restriction-r18 is configured with  for any .\n-\tIf , the UE is expected to select one of the  configured combinations of  and report the index of the selected combination, where the index value 0 corresponds to the first configured combination and the index value  corresponds to the -th configured combination. If , a single combination of  is configured and the selection is not reported.\nTable 5.2.2.2.9-1: Codebook parameter configurations for \n\nTable 5.2.2.2.9-2: Codebook parameter configurations for \n\nTable 5.2.2.2.9-3: Configurable combinations of  and \n\n-\tThe value of  is configured with the higher-layer parameter valueOfN-CJT-r18, when .\n-\tThe value of  is configured with the higher-layer parameter numberOfPMI-SubbandsPerCQI-Subband-CJT-PS-r18, when , and  when , where  and the corresponding value of  are defined as in clause 5.2.2.2.5.\n-\tThe UE shall report the RI value  according to the configured higher layer parameter typeII-CJT-PS-RI-Restriction-r18. The UE shall not report . The bitmap parameter typeII-CJT-PS-RI-Restriction-r18 forms the bit sequence , where is the LSB and  is the MSB. When  is zero, , PMI and RI reporting are not allowed to correspond to any precoder associated with  layers.\n-\tThe UE may be configured with higher layer parameter restrictedCMR-Selection. If restrictedCMR-Selection is configured, the number of selected CSI-RS resources is . Otherwise, the UE is expected to select  CSI-RS resources, with , and the selection is reported with an -bit bitmap, , where the CSI-RS resources are mapped from bit  to bit  by their ordering in the resource set and the first of the  selected CSI-RS resources corresponds to the nonzero bit with lowest index.\nThe PMI value for the  selected CSI-RS resources corresponds to the codebook indices of  and  where\n\nThe precoding matrices indicated by the PMI are determined from  vectors, where  are the indices of the  selected CSI-RS resources in increasing order, such that , and , , where  are the corresponding values from the selected combination of .\n ports are selected from the  ports of the -th selected CSI-RS resource, for , based on  vectors, , , which are indicated by , where\n\n\nLet\n\n\n\nthe index , for the -th selected CSI-RS resource, , is obtained from the  elements of , as described in Clause 5.2.2.2.7 for the indicator , obtained from the  elements of . Vector  is a -element column vector containing a value of 1 in the element of index  and zeros elsewhere, and where the first element is the element of index 0.\n-\tIf  for the -th selected CSI-RS resource, , for , and  is not reported.\nThe  vectors, , , are common for all the  selected CSI-RS resources and are identified by , where\n\n\nwith the indices  assigned such that  increases with .  is indicated by the index , when  and , where\n\n-\tIf , or  and ,  is not reported.\n-\tIf  and , the nonzero offset between  and  is reported with  assuming that  (reference for the offset) is 0. The nonzero offset values are mapped to the index values of  in increasing order with offset value 1 mapped to index value '0'.\nThe  vectors' elements are given by\n\nfor , and .\nIf the higher layer parameter codebookMode is set to 'mode1', an offset  is reported for the -th selected CSI-RS resource, with , relative to the first of the  selected CSI-RS resources. The  reported offsets are common for all  layers and are indicated by , given by\n\n\nwhere the value of  is configured by higher layer parameter numberOfO3. The offsets are represented by\n\n\nIf codebookMode is set to 'mode2', the offset indicator, , is not reported and  for .\nThe reference amplitude coefficient indicator , for layer , is given by\n\n\nThe reference amplitude coefficients for layer  are represented by\n\nand the mapping from  to  is given in Table 5.2.2.2.5-2. \nThe amplitude coefficient indicator , for layer , is given by\n\n\n\n\nThe amplitude coefficients for layer  are represented by\n\n\n\nand the mapping from  to  is given in Table 5.2.2.2.5-3. \nThe phase coefficient indicator , for , is given by\n\n\n\n\nThe phase coefficients for layer  are represented by\n\n\n\nand the mapping from  to  is given by\n\nLet . The bitmap whose nonzero bits identify which coefficients in  and are reported for layer , is indicated by \n\n\n\n\nLet  be the number of nonzero coefficients for layer , the total number of nonzero coefficients is reported and given by .\n-\tIf  and ,  is not reported, for .\nThe indices of ,  and  are associated to the  selected CSI-RS resources.\nLet  and  be the indices which identify the strongest coefficient of layer , for , i.e., the element  of , where the indices ,  are such that . The strongest coefficient of layer  is identified by the index\n\nwhich is found from\n\nThe amplitude and phase coefficient indicators are reported as follows:\n-\t, ,  and , for . The reference amplitude, , amplitude coefficient,  and phase coefficient, , are not reported for .\n-\tThe reference amplitude, , is reported for .\n-\tThe  amplitude coefficients, , for which , ,  are reported. \n-\tThe  phase coefficients, , for which , ,  are reported. \n-\tThe remaining  amplitude coefficients, , are not reported.\n-\tThe remaining  phase coefficients, , are not reported.\nThe codebooks for 1-4 layers are given in Table 5.2.2.2.9-4, where , is the index associated with the precoding matrix,  is the layer index, and where, for coefficients with , amplitude and phase are set to zero, i.e.,  and .\nTable 5.2.2.2.9-4: Codebook for 1-layer. 2-layer, 3-layer and 4-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS of N0 selected CSI-RS resources\n\n5.2.2.2.10\tEnhanced Type II codebook for predicted PMI\nFor 4 antenna ports {3000, 3001, \u2026, 3003}, 8 antenna ports {3000, 3001, \u2026, 3007}, 12 antenna ports {3000, 3001, \u2026, 3011}, 16 antenna ports {3000, 3001, \u2026, 3015}, 24 antenna ports {3000, 3001, \u2026, 3023}, and 32 antenna ports {3000, 3001, \u2026, 3031} per CSI-RS resource, the UE configured with  aperiodic CSI-RS resources or with a single periodic or semi-persistent CSI-RS resource in the resource set for channel measurement and with codebookType set to 'typeII-Doppler-r18'\n-\tThe values of  and  are configured with the higher layer parameter n1-n2\u2011codebookSubsetRestriction-r18. The supported configurations of  for a given number of CSI-RS ports and the corresponding values of   are given in Table 5.2.2.2.1-2. The number of CSI-RS ports, , is .\n-\tThe values of ,  and  are determined by the higher layer parameter paramCombination-Doppler-r18, where the mapping is given in Table 5.2.2.2.10-1.\n-\tThe UE is not expected to be configured with paramCombination-Doppler-r18 equal to\n-\t4, 5, 6, 7, 8, or 9 when ,\n-\t8 or 9 when \n-\t8 or 9 when higher layer parameter typeII-Doppler-RI-Restriction-r18 is configured with  for any .\n-\t8 or 9 when .\nTable 5.2.2.2.10-1: Codebook parameter configurations for   and \n\n-\tThe value of  is configured with the higher-layer parameter numberOfPMI-SubbandsPerCQI-Subband-Doppler-r18, where  and the corresponding value of  are defined as in clause 5.2.2.2.5.\n-\tThe UE shall report the RI value  according to the configured higher layer parameter typeII-Doppler-RI-Restriction-r18. The UE shall not report . The bitmap parameter typeII-Doppler-RI-Restriction-r18 forms the bit sequence  where  is the LSB and  is the MSB. When  is zero, , PMI and RI reporting are not allowed to correspond to any precoder associated with  layers.\n-\tThe value of  is configured by the higher layer parameter N4, such that the PMI indicates  precoder matrices for each of the  consecutive slot intervals of duration  slots, as defined in Clause 5.2.1.4.2.\nIf , the PMI value corresponds to the codebook indices of  and  as described in Clause 5.2.2.2.5 and the precoder matrices for 1-4 layers are obtained from the PMI codebook as in Table 5.2.2.2.5-5.\nIf , the PMI value corresponds to the codebook indices of  and , where\n\nThe precoding matrices indicated by the PMI are determined from  vectors, where .\nThe  vectors, , indicated by ,  and the  vectors, , , for layer , indicated by  (for ) and  , are obtained as in Clause 5.2.2.2.5.\nThe  vectors, , , for layer   are identified by , where\n\n\nwith the indices  assigned such that  increases with .  is indicated by the index , for layer , where\n\n-\tIf , , for layer  are not reported.\n-\tIf, the nonzero offset between  and  is reported with  assuming that  (reference for the offset) is 0. The nonzero offset values are mapped to the index values of  in increasing order with offset value 1 mapped to index value '0'.\nThe  vectors' elements are given by\n\nfor , and .\nThe reference amplitude coefficient indicator , for layer , is given by\n\n\nThe reference amplitude coefficients for layer  are represented by\n\nand the mapping from  to  is given in Table 5.2.2.2.5-2. \nThe amplitude coefficient indicator , for layer , is given by\n\n\n\n\nThe amplitude coefficients for layer  are represented by\n\n\n\nand the mapping from  to  is given in Table 5.2.2.2.5-3. \nThe phase coefficient indicator , for , is given by\n\n\n\n\nThe phase coefficients for layer  are represented by\n\n\n\nand the mapping from  to  is given by\n\nLet . The bitmap whose nonzero bits identify which coefficients in  and are reported for layer , is indicated by \n\n\n\n\nLet  be the number of nonzero coefficients for layer , the total number of nonzero coefficients is reported and given by .\nThe indices of ,  and  are associated to the  codebook indices in .\nLet ,  and  be the indices which identify the strongest coefficient of layer , for , i.e., the element  of . The codebook indices of  are remapped with respect to  as , such that , after remapping. The index  is remapped with respect to  as , such that the index of the strongest coefficient is  (), after remapping. The indices of ,  and  indicate amplitude coefficients, phase coefficients and bitmap after remapping.\nThe strongest coefficient of layer  is identified by , which is obtained as follows, where, for ,  and index  is such that \n\t\nThe amplitude and phase coefficient indicators are reported as follows:\n-\t, ,  and , for . The reference amplitude, , amplitude coefficient,  and phase coefficient, , are not reported for .\n-\tThe reference amplitude, , is reported for .\n-\tThe  amplitude coefficients, , for which , ,  are reported. \n-\tThe  phase coefficients, , for which ,   are reported. \n-\tThe remaining  amplitude coefficients, , are not reported.\n-\tThe remaining  phase coefficients, , are not reported.\nThe codebooks for 1-4 layers are given in Table 5.2.2.2.10-2, where ,  are the indices associated with the precoding matrix,  is the layer index, and where, for coefficients with , amplitude and phase are set to zero, i.e.,  and .\nTable 5.2.2.2.10-2: Codebook for 1-layer. 2-layer, 3-layer and 4-layer CSI reporting using antenna ports 3000 to 2999+PCSI-RS\n\nThe bitmap parameter n1-n2\u2011codebookSubsetRestriction-r18 is configured as described in Clause 5.2.2.2.5, where only the bit values '00' or '11' of Table 5.2.2.2.5-6 are configurable.\n5.2.2.2.11\tFurther enhanced Type II port selection codebook for predicted PMI\nFor 4 antenna ports {3000, 3001, \u2026, 3003}, 8 antenna ports {3000, 3001, \u2026, 3007}, 12 antenna ports {3000, 3001, \u2026, 3011}, 16 antenna ports {3000, 3001, \u2026, 3015}, 24 antenna ports {3000, 3001, \u2026, 3023}, and 32 antenna ports {3000, 3001, \u2026, 3031} per CSI-RS resource, the UE configured with  aperiodic CSI-RS resources or with a single periodic or semi-persistent CSI-RS resource in the resource set for channel measurement and with codebookType set to 'typeII-Doppler-PortSelection-r18'\n-\tthe number of CSI-RS ports, , is configured as in clause 5.2.2.2.4.\n-\tThe values ,  and  are determined by the higher layer parameter paramCombination-Doppler-PS-r18, where the mapping is given in Table 5.2.2.2.7-1 and the applicable configuration restrictions are described in Clause 5.2.2.2.7.\n-\tThe parameter  is configured with the higher-layer parameter valueOfN-Doppler-r18, when .\n-\tThe parameter  is configured with the higher-layer parameter numberOfPMI-SubbandsPerCQI-Subband-Doppler-PS-r18, when , and  when , where  and the corresponding value of parameter  are defined as in clause 5.2.2.2.5.\n-\tThe UE shall report the RI value  according to the configured higher layer parameter typeII-Doppler-PS-RI-Restriction-r18. The UE shall not report . The bitmap parameter typeII-Doppler-RI-Restriction-r18 forms the bit sequence  where  is the LSB and  is the MSB. When  is zero, , PMI and RI reporting are not allowed to correspond to any precoder associated with  layers.\n-\tThe value of  is configured by the higher layer parameter N4, such that the PMI indicates  precoder matrices for one slot interval of duration  slots, as defined in Clause 5.2.1.4.2.\nThe PMI value corresponds to the codebook indices of  and  as described in Clause 5.2.2.2.7 and the precoder matrices for 1-4 layers are obtained from the PMI codebook as in Table 5.2.2.2.7-3.\n5.2.2.3\tReference signal (CSI-RS) \n5.2.2.3.1\tNZP CSI-RS\nThe UE can be configured with one or more NZP CSI-RS resource set configuration(s) as indicated by the higher layer parameters CSI-ResourceConfig, and NZP-CSI-RS-ResourceSet. Each NZP CSI-RS resource set consists of K\u22651 NZP CSI-RS resource(s).\nThe following parameters for which the UE shall assume non-zero transmission power for CSI-RS resource are configured via the higher layer parameter NZP-CSI-RS-Resource, CSI-ResourceConfig and NZP-CSI-RS-ResourceSet for each CSI-RS resource configuration:\n-\tnzp-CSI-RS-ResourceId determines CSI-RS resource configuration identity.\n-\tperiodicityAndOffset defines the CSI-RS periodicity and slot offset for periodic/semi-persistent CSI-RS. All the CSI-RS resources within one set are configured with the same periodicity, while the slot offset can be same or different for different CSI-RS resources.\n-\tresourceMapping defines the number of ports, CDM-type, and OFDM symbol and subcarrier occupancy of the CSI-RS resource within a slot that are given in Clause 7.4.1.5 of [4, TS 38.211]. \n-\tnrofPorts in resourceMapping defines the number of CSI-RS ports, where the allowable values are given in Clause 7.4.1.5 of [4, TS 38.211].\n-\tdensity in resourceMapping defines CSI-RS frequency density of each CSI-RS port per PRB, and CSI-RS PRB offset in case of the density value of 1/2, where the allowable values are given in Clause 7.4.1.5 of [4, TS 38.211]. For density 1/2, the odd/even PRB allocation indicated in density is with respect to the common resource block grid.\n-\tcdm-Type in resourceMapping defines CDM values and pattern, where the allowable values are given in Clause 7.4.1.5 of [4, TS 38.211].\n-\tpowerControlOffset: which is the assumed ratio of PDSCH EPRE to NZP CSI-RS EPRE when UE derives CSI feedback and takes values in the range of [-8, 15] dB with 1 dB step size. For CQI calculation based on a pair of NZP CSI-RS resources, powerControlOffset of each NZP CSI-RS resource in the pair of NZP CSI-RS resources for channel measurement is the assumed ratio of EPRE when UE derives CSI feedback and takes values in the range of [-8, 15] dB with 1 dB step size.\n-\tpowerControlOffsetSS: which is the assumed ratio of NZP CSI-RS EPRE to SS/PBCH block EPRE. \n-\tscramblingID defines scrambling ID of CSI-RS with length of 10 bits.\n-\tBWP-Id in CSI-ResourceConfig defines which bandwidth part the configured CSI-RS is located in.\n-\trepetition in NZP-CSI-RS-ResourceSet is associated with a CSI-RS resource set and defines whether UE can assume the CSI-RS resources within the NZP CSI-RS Resource Set are transmitted with the same downlink spatial domain transmission filter or not as described in Clause 5.1.6.1.2. and can be configured only when the higher layer parameter reportQuantity associated with all the reporting settings linked with the CSI-RS resource set is set to 'cri-RSRP', 'cri-SINR', 'cri-RSRP- Index', 'cri-SINR- Index' or 'none'.\n-\tqcl-InfoPeriodicCSI-RS contains a reference to a TCI-State indicating QCL source RS(s) and QCL type(s). If the TCI-State is configured with a reference to an RS configured with qcl-Type set to 'typeD' association, that RS may be an SS/PBCH block located in the same or different CC/DL BWP or a CSI-RS resource configured as periodic located in the same or different CC/DL BWP. The reference RS may additionally be an SS/PBCH block associated with a PCI different from the PCI of the serving cell.\n-\ttrs-Info in NZP-CSI-RS-ResourceSet is associated with a CSI-RS resource set and for which the UE can assume that the antenna port with the same port index of the configured NZP CSI-RS resources in the NZP-CSI-RS-ResourceSet is the same as described in Clause 5.1.6.1.1 and can be configured when reporting setting is not configured or when the higher layer parameter reportQuantity associated with all the reporting settings linked with the CSI-RS resource set is set to 'tdcp' or 'none'.\nAll CSI-RS resources within one set are configured with same density and same nrofPorts, except for the NZP CSI-RS resources used for interference measurement.\nThe UE expects that all the CSI-RS resources of a resource set are configured with the same starting RB and number of RBs and the same cdm-type.\nFor a CSI-RS Resource Set for channel measurement configured with two Resource Groups and  Resource Pairs, the slot offsets of the two resources in a Resource Pair are configured within  slots, without DL/UL switching in between the two resources, where  implies that the two resources are configured in the same slot, and  implies that the two resources are configured within two adjacent slots. \nFor a NZP-CSI-RS-ResourceSet for channel measurement with  resources and linked to a CSI-ReportConfig configured with codebookType set to 'typeII-CJT-r18' or 'typeII-CJT-PortSelection-r18', the slot offsets of the  CSI-RS resources are configured within  slots, without DL/UL switching in between the two resources, where  implies that the  resources are configured in the same slot, and  implies that the  resources are configured within two adjacent slots.\nThe bandwidth and initial common resource block (CRB) index of a CSI-RS resource within a BWP, as defined in Clause 7.4.1.5 of [4, TS 38.211], are determined based on the higher layer parameters nrofRBs and startingRB, respectively, within the CSI-FrequencyOccupation IE configured by the higher layer parameter freqBand within the CSI-RS-ResourceMapping IE. Both nrofRBs and startingRB are configured as integer multiples of 4 RBs, and the reference point for startingRB is CRB 0 on the common resource block grid. If  the UE shall assume that the initial CRB index of the CSI-RS resource is , otherwise . If , the UE shall assume that the bandwidth of the CSI-RS resource is , otherwise . In all cases, the UE shall expect that .\n5.2.2.4\tChannel State Information \u2013 Interference Measurement (CSI-IM) \nThe UE can be configured with one or more CSI-IM resource set configuration(s) as indicated by the higher layer parameter CSI-IM-ResourceSet. Each CSI-IM resource set consists of K\u22651 CSI-IM resource(s). \nThe following parameters are configured via higher layer parameter CSI-IM-Resource for each CSI-IM resource configuration:\n-\tcsi-IM-ResourceId determines CSI-IM resource configuration identity\n-\tsubcarrierLocation-p0 or subcarrierLocation-p1 defines subcarrier occupancy of the CSI-IM resource within a slot for csi-IM-ResourceElementPattern set to 'pattern0' or 'pattern1', respectively. \n-\tsymbolLocation-p0 or symbolLocation-p1 defines OFDM symbol location of the CSI-IM resource within a slot for csi-IM-ResourceElementPattern set to 'pattern0' or 'pattern1', respectively.\n-\tperiodicityAndOffset defines the CSI-IM periodicity and slot offset for periodic/semi-persistent CSI-IM.\n-\tfreqBand includes parameters to enable configuration of frequency-occupancy of CSI-IM\nIn each of the PRBs configured by freqBand, the UE shall assume each CSI-IM resource is located in, \n-\tresource elements , ,  and , if csi-IM-ResourceElementPattern is set to 'pattern0',\n-\tresource elements , ,  and  if csi-IM-ResourceElementPattern is set to 'pattern1',\nwhere and  are the configured frequency-domain location and time-domain location, respectively, given by the higher layer parameters in the above list.\n5.2.2.5\tCSI reference resource definition\nThe CSI reference resource for a serving cell is defined as follows:\n-\tIn the frequency domain, the CSI reference resource is defined by the group of downlink physical resource blocks corresponding to the band to which the derived CSI relates.\n-\tIn the time domain, the CSI reference resource for a CSI reporting in uplink slot n' is defined by a single downlink slot , where  is a parameter configured by higher layer as specified in clause 4.2 of [6 TS 38.213], and where is the subcarrier spacing configuration for  with a value of 0 for frequency range 1,\n-\twhere  and and  are the subcarrier spacing configurations for DL and UL, respectively, and  and  are determined by higher-layer configured ca-SlotOffset for the cells transmitting the uplink and downlink, as defined in clause 4.5 of [4, TS 38.211]\n-\twhere for periodic and semi-persistent CSI reporting\n-\tif a single CSI-RS/SSB resource is configured for channel measurement nCSI_ref is the smallest value greater than or equal to , such that it corresponds to a valid downlink slot, or\n-\tif multiple CSI-RS/SSB resources are configured for channel measurement nCSI_ref is the smallest value greater than or equal to , such that it corresponds to a valid downlink slot.\n-\twhere for aperiodic CSI reporting, if the UE is indicated by the DCI to report CSI in the same slot as the CSI request, nCSI_ref is such that the reference resource is in the same valid downlink slot as the corresponding CSI request, otherwise nCSI_ref is the smallest value greater than or equal to , such that slot n- nCSI_ref corresponds to a valid downlink slot, where Z' corresponds to the delay requirement as defined in Clause 5.4.\n-\twhen periodic or semi-persistent CSI-RS/CSI-IM or SSB is used for channel/interference measurements, the UE is not expected to measure channel/interference on the CSI-RS/CSI-IM/SSB whose last OFDM symbol is received up to Z' symbols before transmission time of the first OFDM symbol of the aperiodic CSI reporting.\nA slot in a serving cell shall be considered to be a valid downlink slot if:\n-\tit comprises at least one higher layer configured downlink or flexible symbol, and\n-\tit does not fall within a configured measurement gap for that UE \nIf there is no valid downlink slot for the CSI reference resource corresponding to a CSI Report Setting in a serving cell, CSI reporting is omitted for the serving cell in uplink slot n'.\nFor a CSI report with reportQuantity not set to \u2018ssb-Index-RSRP\u2019, \u2018ssb-Index-SINR\u2019, \u2018ssb-Index-RSRP-Index\u2019 or \u2018ssb-Index-SINR-Index\u2019, after the CSI report (re)configuration, serving cell activation, BWP change, or activation of SP-CSI, the UE reports a CSI report only after receiving at least one CSI-RS transmission occasion for channel measurement and CSI-RS and/or CSI-IM occasion for interference measurement no later than CSI reference resource and drops the report otherwise. For a CSI report configuration containing a list of sub-configurations provided by csi-ReportSubConfigList, after the CSI report (re)configuration, serving cell activation, BWP change, or activation of SP-CSI, the UE reports a CSI report including one or more sub-reports only after receiving at least one CSI-RS transmission occasion for channel measurement and CSI-RS and/or CSI-IM occasion for interference measurement, per sub-configuration, no later than CSI reference resource and drops the report otherwise, where the sub-configuration is the activated/triggered one for AP/SP-CSI reporting, or the configured one for P-CSI reporting.\nFor a CSI-ReportConfig configured with two Resource Groups and  Resource Pairs for channel measurement in the corresponding CSI-RS Resource Set, as described in clause 5.2.1.4.1, after the CSI report (re)configuration, serving cell activation, BWP change, or activation of SP-CSI, the UE reports a CSI report only after receiving at least one CSI-RS transmission occasion for each of the CSI-RS resources in the corresponding CSI-RS Resource Set for channel measurement and one CSI-IM occasion for each of the CSI-IM resources in the corresponding Resource Set for interference measurement no later than the CSI reference resource and within the same DRX Active Time when DRX is configured, and drops the report otherwise.\nFor a CSI-ReportConfig configured with codebookType set to 'typeII-CJT-r18' or 'typeII-CJT-PortSelection-r18', after the CSI report (re)configuration, serving cell activation, BWP change, or activation of SP-CSI, the UE reports a CSI report only after receiving at least one CSI-RS transmission occasion for each of the CSI-RS resources in the corresponding CSI-RS Resource Set for channel measurement and one CSI-RS and/or CSI-IM resource transmission occasion for the CSI-RS and/or CSI-IM resource in the corresponding Resource Set for interference measurement no later than the CSI reference resource and within the same DRX Active Time, when DRX is configured, and drops the report otherwise.\nFor a CSI-ReportConfig configured with codebookType set to 'typeII-Doppler-r18' or 'typeII-Doppler-PortSelection-r18', after the CSI report (re)configuration, serving cell activation, BWP change, or activation of SP-CSI, the UE reports a CSI report only if receiving at least one aperiodic or  periodic or semipersistent consecutive CSI-RS transmission occasions for each CSI-RS resource in the corresponding CSI-RS Resource Set for channel measurement and one CSI-RS and/or CSI-IM resource transmission occasion for the CSI-RS and/or CSI-IM resource in the corresponding Resource Set for interference measurement no later than the CSI reference resource and within the same DRX Active Time, when DRX is configured, and drops the report otherwise. The value of  is indicated by UE capability, as defined in clause 5.2.1.6.\nFor a CSI-ReportConfig configured with the higher layer parameter reportQuantity set to 'tdcp', after the CSI report (re)configuration, serving cell activation, BWP change, the UE reports a CSI report only after receiving at least one CSI-RS transmission occasion for each CSI-RS resource in the  CSI-RS Resource Sets of the CSI-RS Resource Setting for channel measurement no later than the CSI reference resource within the same DRX active time, when DRX is configured, and drop the report otherwise.\nWhen DRX is configured, the UE reports a CSI report with the reportQuantity not set to \u2018ssb-Index-RSRP\u2019, \u2018ssb-Index-SINR\u2019, \u2018ssb-Index-RSRP-Index\u2019 or \u2018ssb-Index-SINR-Index\u2019 only if receiving at least one CSI-RS transmission occasion for channel measurement and CSI-RS and/or CSI-IM occasion for interference measurement in DRX Active Time no later than CSI reference resource and drops the report otherwise. When DRX is configured, for a CSI report configuration containing a list of sub-configurations provided by csi-ReportSubConfigList, the UE reports a CSI report including one or more sub-reports only if receiving at least one CSI-RS transmission occasion for channel measurement and CSI-RS and/or CSI-IM occasion for interference measurement in DRX Active Time, per sub-configuration, no later than CSI reference resource and drops the report otherwise, where the sub-configuration is the activated/triggered one for AP/SP-CSI reporting, or the configured one for P-CSI reporting. When the UE is configured to monitor DCI format 2_6 and if the UE configured by higher layer parameter ps-TransmitOtherPeriodicCSI to report CSI with the higher layer parameter reportConfigType set to 'periodic' and reportQuantity set to quantities other than 'cri-RSRP', 'ssb-Index-RSRP', 'cri-RSRP- Index', and 'ssb-Index-RSRP- Index ' when drx-onDurationTimer is not started, the UE shall report CSI with the reportQuantity not set to \u2018ssb-Index-SINR\u2019 or \u2018ssb-Index-SINR-Index\u2019 during the time duration indicated by drx-onDurationTimer in DRX-Config also outside active time according to the procedure described in Clause 5.2.1.4 if receiving at least one CSI-RS transmission occasion for channel measurement and CSI-RS and/or CSI-IM occasion for interference measurement during the time duration indicated by drx-onDurationTimer in DRX-Config outside DRX active time or in DRX Active Time no later than CSI reference resource and drops the report otherwise. For a CSI report configuration containing a list of sub-configurations provided by csi-ReportSubConfigList, when the UE is configured to monitor DCI format 2_6 and if the UE configured by higher layer parameter ps-TransmitOtherPeriodicCSI to report CSI with the higher layer parameter reportConfigType set to 'periodic' and reportQuantity set to quantities other than 'cri-RSRP', 'ssb-Index-RSRP', 'cri-RSRP- Index', and 'ssb-Index-RSRP- Index' when drx-onDurationTimer is not started, UE shall report a CSI report including one or more sub-reports only during the time duration indicated by drx-onDurationTimer in DRX-Config also outside active time according to the procedure described in Clause 5.2.1.4 if receiving at least one CSI-RS transmission occasion for channel measurement and CSI-RS and/or CSI-IM occasion for interference measurement during the time duration indicated by drx-onDurationTimer in DRX-Config outside DRX active time or in DRX Active Time, per sub-configuration, no later than CSI reference resource and drops the report otherwise, where the sub-configuration is the configured one for P-CSI reporting. When the UE is configured to monitor DCI format 2_6 and if the UE configured by higher layer parameter ps-TransmitPeriodicL1-RSRP to report L1-RSRP with the higher layer parameter reportConfigType set to 'periodic' and reportQuantity set to 'cri-RSRP', 'ssb-Index-RSRP', 'cri-RSRP- Index', or 'ssb-Index-RSRP- Index' when drx-onDurationTimer is not started, the UE shall report L1-RSRP during the time duration indicated by drx-onDurationTimer in DRX-Config also outside active time according to the procedure described in clause 5.2.1.4 and when reportQuantity set to 'cri-RSRP' or 'cri-RSRP- Index' if receiving at least one CSI-RS transmission occasion for channel measurement during the time duration indicated by drx-onDurationTimer in DRX-Config outside DRX active time or in DRX Active Time no later than CSI reference resource and drops the report otherwise.\nFor the CSI report configuration in CSI-ReportConfig associated with the higher layer parameter reportQuantity comprising at least 'RI', the UE reports a CSI report only if receiving at least one CSI-RS transmission occasion of each periodic CSI-RS resource or semi-persistent CSI-RS resource on a serving cell with cell DTX activated [10, TS 38.321] for channel measurement and/or interference measurement in active periods of cell DTX of the serving cell no later than CSI reference resource, and the UE drops the CSI report otherwise.\nWhen deriving CSI feedback, the UE is not expected that a NZP CSI -RS resource for channel measurement overlaps with CSI-IM resource for interference measurement or NZP CSI -RS resource for interference measurement.\n5.2.2.5.1\tUE assumptions for CQI/PMI/RI calculation\nIf configured to report CQI index, in the CSI reference resource, or in each of the slot(s) associated with a CQI in the predicted CSI, as defined in Clause 5.2.1.4.2, the UE shall assume the following for the purpose of deriving the CQI index, and if also configured, for deriving PMI and RI:\n-\tThe first 2 OFDM symbols are occupied by control signaling.\n-\tThe number of PDSCH and DM-RS symbols is equal to 12.\n-\tThe same bandwidth part subcarrier spacing configured as for the PDSCH reception\n-\tThe bandwidth as configured for the corresponding CQI report.\n-\tThe IAB-MT shall only assume the frequency resources as indicated by the DL TX power adjustment MAC CE, if indicated for the slot of the CSI reference resource by DL Tx Power Adjustment MAC CE as described in [10, TS 38.321].\n-\tThe reference resource uses the CP length and subcarrier spacing configured for PDSCH reception \n-\tNo resource elements used by primary or secondary synchronization signals or PBCH.\n-\tRedundancy Version 0.\n-\tThe ratio of PDSCH EPRE to CSI-RS EPRE is as given in Clause 5.2.2.3.1.\n-\tIn addition, the IAB-MT shall apply the provided DL TX power adjustment, if indicated for the slot of the CSI reference resource by DL Tx Power Adjustment MAC CE as described in [10, TS 38.321].\n-\tAssume no REs allocated for NZP CSI-RS and ZP CSI-RS.\n-\tAssume the same number of front-loaded DM-RS symbols as the maximum front-loaded symbols configured by the higher layer parameter maxLength in DMRS-DownlinkConfig. \n-\tAssume the same number of additional DM-RS symbols as the additional symbols configured by the higher layer parameter dmrs-AdditionalPosition.\n-\tAssume the PDSCH symbols are not containing DM-RS.\n-\tAssume PRB bundling size of 2 PRBs.\n-\tThe PDSCH transmission scheme where the UE may assume that PDSCH transmission would be performed with up to 8 transmission layers as defined in Clause 7.3.1.4 of [4, TS 38.211]. For CQI calculation, the UE should assume that PDSCH signals on antenna ports in the set [1000,\u2026, 1000+\u03bd-1] for \u03bd layers would result in signals equivalent to corresponding symbols transmitted on antenna ports [3000,\u2026, 3000+P-1], as given by\n\t\n\twhere  is a vector of PDSCH symbols from the layer mapping defined in Clause 7.3.1.4 of [4, TS 38.211],  is the number of CSI-RS ports. If only one CSI-RS port is configured, W(i) is 1. If the higher layer parameter reportQuantity in CSI-ReportConfig for which the CQI is reported is set to either 'cri-RI-PMI-CQI' or 'cri-RI-LI-PMI-CQI', W(i) is the precoding matrix corresponding to the reported PMI applicable to x(i). If the higher layer parameter reportQuantity in CSI-ReportConfig for which the CQI is reported is set to 'cri-RI-CQI', W(i) is the precoding matrix corresponding to the procedure described in Clause 5.2.1.4.2. If the higher layer parameter reportQuantity in CSI-ReportConfig for which the CQI is reported is set to 'cri-RI-i1-CQI', W(i) is the precoding matrix corresponding to the reported i1 according to the procedure described in Clause 5.2.1.4.2. The corresponding PDSCH signals transmitted on antenna ports [3000,\u2026,3000 + P - 1] would have a ratio of EPRE to CSI-RS EPRE equal to the ratio given in Clause 5.2.2.3.1. \n-\tFor a UE configured with a CSI-ReportConfig that contains a list of sub-configurations provided by  [csi-ReportSubConfigList],\n-\tif a sub-configuration indicates a CSI-RS antenna port subset using the higher layer bitmap parameter [port-subsetIndicator], as described in clause 5.2.1.4.2, for CQI calculation, antenna ports corresponding to all bits with value of 1 in [port-subsetIndicator] are mapped to consecutive antenna ports starting at CSI-RS antenna port 3000 in increasing order of the bit position in [port-subsetIndicator]. The UE should assume that PDSCH signals on antenna ports in the set [1000,\u2026, 1000+\u03bd-1] for \u03bd layers would result in signals equivalent to corresponding symbols transmitted on antenna ports [3000, \u2026, 3000+P-1] T, as given by\n\nwhere P corresponds to the number of bits with value 1 in the bitmap [port-subsetIndicator] and T , and  are as previously described in this Clause, and the corresponding PDSCH EPRE to CSI-RS EPRE is as previously defined in this Clause if the sub-configuration does not indicate a power offset [powerOffset].\n-\tif a sub-configuration indicates a list of NZP CSI-RS resources, provided by [nzp-CSI-RS-resourceList] and does not indicate a power offset [powerOffset], for CQI calculation for the sub-configuration the UE follows the procedure previously described in this Clause. \n-\tif a sub-configuration indicates a power offset [powerOffset], for CQI calculation, the UE shall assume the corresponding PDSCH signals transmitted on the antenna ports of a CSI-RS resource would have a ratio of EPRE to CSI-RS EPRE equal to the difference between powerControlOffset of the CSI-RS resource, given in Clause 5.2.2.3.1, and [powerOffset], where the difference is expected to take one of the values that can be configured for powerControlOffset of the CSI-RS resource, given in Clause 5.2.2.3.1, and is also expected to take a value that is no larger than the value of powerControlOffset.\n5.2.2.5.1a\tUE assumptions for CQI/PMI/RI calculation for NCJT\nIf the higher layer parameter reportQuantity in CSI-ReportConfig for which the CQI is reported is set to either 'cri-RI-PMI-CQI' or 'cri-RI-LI-PMI-CQI', the corresponding CSI-RS Resource Set for channel measurement is configured with two Resource Groups and  Resource Pairs, as described in clause 5.2.1.4.1, the reported CRI corresponds to an entry of the  Resource Pairs, and the reported rank combination is , as described in clause 5.2.1.4.2, for CQI calculation, the UE should assume that\n-\tPDSCH signals on antenna ports in the set  for  layers would result in signals equivalent to corresponding symbols transmitted on antenna ports  of the Group 1 CSI-RS resource in the Resource Pair indicated by the CRI, and PDSCH signals on antenna ports in the set  for  layers would result in signals equivalent to corresponding symbols transmitted on antenna ports  of the Group 2 CSI-RS resource in the Resource Pair indicated by the CRI, as given by\n\t\n\twhere ,  are the two precoding matrices corresponding to the two reported PMIs applicable to , as described in clause 5.2.1.4.2; and the indices  are associated to the two Resource Groups configured in the corresponding CSI-RS Resource Set for channel measurement; that the signals , , fully overlap in time and frequency, and that, for the calculation of RI, PMI and LI (if configured) of  layers, , the interference from the other  layers is derived from channel measurement and precoding matrix corresponding to the other  layers.\n-\tThe UE shall assume that the corresponding PDSCH signals for  layers transmitted on the  antenna ports of the CSI-RS resource in Group  would have a ratio of EPRE to CSI-RS EPRE equal to the powerControlOffset of the respective CSI-RS resource, for .\n5.2.2.5.1b\tUE assumptions for CQI/PMI/RI calculation for CJT \nIf the higher layer parameter reportQuantity in CSI-ReportConfig for which the CQI is reported is set to 'cri-RI-PMI-CQI', the higher layer parameter codebookType is set to 'typeII-CJT-r18' or ' typeII-CJT-PortSelection-r18', and the corresponding CSI-RS Resource Set for channel measurement is configured with  CSI-RS resources, for CQI calculation\n-\ta UE should assume PDSCH signals on antenna ports in the set  for  layers would result in signals equivalent to corresponding symbols transmitted on antenna ports  of each of the N0 selected CSI-RS resources, as given by\n\t\n\twhere  is the precoding matrix corresponding to the procedure described in Clause 5.2.2.2.8 and 5.2.2.2.9 for codebookType set to 'typeII-CJT-r18' and ' typeII-CJT-PortSelection-r18', respectively, and  are the indices of the N0 selected CSI-RS resources in increasing order, such that . A UE should assume that the signals , , fully overlap in time and frequency.\n-\ta UE can assume that the PDSCH signals for  layers would have the same ratio of EPRE to CSI-RS EPRE for all CSI-RS resources , with , equal to   times the powerControlOffset (in linear scale) of the respective CSI-RS resource.\n5.2.2.5.1c\tUE assumptions for CQI/PMI/RI calculation for predicted CSI\nIf the higher layer parameter reportQuantity in CSI-ReportConfig for which the CQI is reported is set to 'cri-RI-PMI-CQI', the higher layer parameter codebookType is set to 'typeII-Doppler-r18' or ' typeII-Doppler-PortSelection-r18', and the corresponding CSI-RS Resource Set for channel measurement is aperiodic with  CSI-RS resources, for CQI calculation, a UE can assume the same ratio of EPRE to CSI-RS EPRE for all  configured CSI-RS resources.\n5.2.3\tCSI reporting using PUSCH\nA UE shall perform aperiodic CSI reporting using PUSCH on serving cell c upon successful decoding of a DCI format 0_1 or DCI format 0_2 which triggers an aperiodic CSI trigger state. A UE shall perform aperiodic CSI reporting using PUSCH on the serving cell with the smallest serving cell index scheduled by DCI format 0_3 which triggers an aperiodic CSI trigger state.\nWhen a DCI format 0_1 schedules two PUSCH allocations, the aperiodic CSI report is carried on the second scheduled PUSCH. When a DCI format 0_1 schedules more than two PUSCH allocations, the aperiodic CSI report is carried on the penultimate scheduled PUSCH.\nAn aperiodic CSI report carried on the PUSCH supports wideband, and sub-band frequency granularities. An aperiodic CSI report carried on the PUSCH supports Type I, Type II, Enhanced Type II, Further Enhanced Type II Port Selection CSI, Enhanced Type II for CJT, Further Enhanced Type II Port Selection for CJT, Enhanced Type II for predicted PMI, Further Enhanced Type II Port Selection for predicted PMI and TDCP reporting. \nA UE shall perform semi-persistent CSI reporting on the PUSCH upon successful decoding of a DCI format 0_1 or DCI format 0_2 which activates a semi-persistent CSI trigger state. DCI format 0_1 and DCI format 0_2 contains a CSI request field which indicates the semi-persistent CSI trigger state to activate or deactivate. Semi-persistent CSI reporting on the PUSCH supports Type I, Type II with wideband, and sub-band frequency granularities, Enhanced Type II, Further Enhanced Type II Port Selection CSI, Enhanced Type II for CJT, Further Enhanced Type II Port Selection for CJT, Enhanced Type II for predicted PMI and Further Enhanced Type II Port Selection for predicted PMI. The PUSCH resources and MCS shall be allocated semi-persistently by an uplink DCI.\nCSI reporting on PUSCH can be multiplexed with uplink data on PUSCH except that semi-persistent CSI reporting on PUSCH activated by a DCI format is not expected to be multiplexed with uplink data on the PUSCH. CSI reporting on PUSCH can also be performed without any multiplexing with uplink data from the UE. \nType I CSI feedback is supported for CSI Reporting on PUSCH. Type I wideband and sub-band CSI is supported for CSI Reporting on the PUSCH. Type II CSI is supported for CSI Reporting on the PUSCH.\nFor Type I, Type II, Enhanced Type II, Further Enhanced Type II Port Selection CSI, Enhanced Type II for CJT, Further Enhanced Type II Port Selection for CJT, Enhanced Type II for predicted PMI and Further Enhanced Type II Port Selection for predicted PMI feedback on PUSCH, a CSI report comprises of two parts. Part 1 has a fixed payload size and is used to identify the number of information bits in Part 2. Part 1 shall be transmitted in its entirety before Part 2. \n-\tFor Type I CSI feedback, Part 1 contains RI (if reported), CRI (if reported), CQI for the first codeword (if reported). Part 2 contains PMI (if reported), LI (if reported) and contains the CQI for the second codeword (if reported) when RI is larger than 4. For a CSI-ReportConfig configured with codebookType set to 'typeI-SinglePanel' and the corresponding CSI-RS Resource Set for channel measurement configured with two Resource Groups and  Resource Pairs, Part 1 contains RI(s), CRI(s), CQI(s) for the first codeword and is zero padded to a fixed payload size (if needed). Part 2 contains the CQI(s) for the second codeword (if reported) when RI is larger than 4, LIs (if reported) and PMI(s). For a CSI-ReportConfig that contains a list of sub-configurations provided by [csi-ReportSubConfigList], for Type I CSI feedback for one or more of the sub-configurations, Part 1 for a sub-configuration contains corresponding RI (if reported), CRI (if reported), CQI for the first codeword (if reported) and is zero padded to a fixed payload size (if needed). Part 2 for a sub-configuration contains the corresponding CQI for the second codeword (if reported) when RI is larger than 4, LI (if reported) and PMI (if reported).\n-\tFor Type II CSI feedback, Part 1 contains RI (if reported), CQI, and an indication of the number of non-zero wideband amplitude coefficients per layer for the Type II CSI (see Clause 5.2.2.2.3). The fields of Part 1 \u2013 RI (if reported), CQI, and the indication of the number of non-zero wideband amplitude coefficients for each layer \u2013 are separately encoded. Part 2 contains the PMI and LI (if reported) of the Type II CSI. The elements of  are reported in the increasing order of their indices, where the element of the lowest index is mapped to the most significant bits and the element of the highest index is mapped to the least significant bits. The elements of ,  (if reported) and  (if reported) are reported in the increasing order of their indices, , where the element of the lowest index is mapped to the most significant bits and the element of the highest index is mapped to the least significant bits. Part 1 and 2 are separately encoded. \n-\tFor Enhanced Type II CSI feedback (see Clause 5.2.2.2.5), Further Enhanced Type II Port Selection CSI feedback (see Clause 5.2.2.2.7), Enhanced Type II for predicted PMI with  (see Clause 5.2.2.2.10) and Further Enhanced Type II Port Selection for predicted PMI (see Clause 5.2.2.2.11), Part 1 contains RI (if reported), CQI, and the total number of reported non-zero amplitude coefficients across layers. The fields of Part 1 \u2013 RI (if reported), CQI, and the total number of reported non-zero amplitude coefficients across layers \u2013 are separately encoded. Part 2 contains the PMI of the Enhanced Type II, Further Enhanced Type II Port Selection CSI, Enhanced Type II for predicted PMI with  or Further Enhanced Type II Port Selection for predicted PMI. Part 1 and 2 are separately encoded.\n-\tFor Enhanced Type II for CJT (see Clause 5.2.2.2.8) and Further Enhanced Type II Port Selection for CJT (see Clause 5.2.2.2.9), Part 1 contains RI (if reported), CQI, the total number of reported non-zero amplitude coefficients across layers, the bitmap selecting  CSI-RS resources (if reported) and the selected combination of  or  (if reported). The fields of Part 1 \u2013 RI (if reported), CQI, the total number of reported non-zero amplitude coefficients across layers, the bitmap selecting  CSI-RS resources (if reported) and the selected combination of  or  (if reported) \u2013 are separately encoded. Part 2 contains the PMI of the Enhanced Type II for CJT or Further Enhanced Type II Port Selection for CJT. Part 1 and 2 are separately encoded.\n-\tFor Enhanced Type II for predicted PMI with  (see Clause 5.2.2.2.10), Part 1 contains RI (if reported), the CQI (if the higher layer parameter TDCQI is set to '1-1' or '1-2') or the first CQI (if the higher layer parameter TDCQI is set to '2') and the total number of reported non-zero amplitude coefficients across layers. The fields of Part 1 \u2013 RI (if reported), CQI, and the total number of reported non-zero amplitude coefficients across layers \u2013 are separately encoded. Part 2 contains the second CQI (if the higher layer parameter TDCQI is set to '2') and the PMI of the Enhanced Type II for predicted PMI with . Part 1 and 2 are separately encoded.\nA Type II CSI report that is carried on the PUSCH shall be computed independently from any Type II CSI report that is carried on the PUCCH formats 3 or 4 (see Clause 5.2.4 and 5.2.2). \nWhen the higher layer parameter reportQuantity is configured with one of the values 'cri-RSRP', 'ssb-Index-RSRP', 'cri-SINR' or 'ssb-Index-SINR', or 'cri-RSRP-Index', 'ssb-Index-RSRP-Index', 'cri-SINR-Index', 'ssb-Index-SINR-Index', 'tdcp', the CSI feedback consists of a single part.\nFor both Type I and Type II reports configured for PUCCH but transmitted on PUSCH, the determination of the payload for CSI part 1 and CSI part 2 follows that of PUCCH as described in Clause 5.2.4.\nWhen CSI reporting on PUSCH comprises two parts, the UE may omit a portion of the Part 2 CSI. Omission of Part 2 CSI is according to the priority order shown in Table 5.2.3-1, where  is the number of CSI reports configured to be carried on the PUSCH. Priority 0 is the highest priority and priority  is the lowest priority and the CSI report n corresponds to the CSI report with the nth smallest Prii,CSI(y,k,c,s) value among the  CSI reports as defined in Clause 5.2.5. The subbands for a given CSI report n indicated by the higher layer parameter csi-ReportingBand with value '1' are numbered continuously in increasing order with the lowest subband of csi-ReportingBand with value set to '1' as subband 0. When omitting Part 2 CSI information for a particular priority level, the UE shall omit all of the information at that priority level, except for Part 2 subband CSI when the corresponding CSI report contains one or more CSI sub-reports with Part 2 each corresponding to a sub-configuration from a list of sub-configurations provided by csi-ReportSubConfigList contained in the CSI-ReportConfig as described in Clause 5.2.1.1. \n-\tFor Enhanced Type II reports and Enhanced Type II for predicted PMI configured with higher layer parameter , for a given CSI report , each reported element of indices   and , indexed by  and , is associated with a priority value , with  with , , and , and where  is defined in Clause 5.2.2.2.5. The element with the highest priority has the lowest associated value . Omission of Part 2 CSI is according to the priority order shown in Table 5.2.3-1, where\n-\tGroup 0 includes indices  (if reported),  (if reported) and  ().\n-\tGroup 1 includes indices  (if reported),  (if reported), the  highest priority elements of ,  , the  highest priority elements of  and the  highest priority elements of  ().\n-\tGroup 2 includes the  lowest priority elements of , the  lowest priority elements of  and the  lowest priority elements of  ().\n-\tFor Further Enhanced Type II Port Selection reports and Further Enhanced Type II Port Selection for predicted PMI, for a given CSI report , each reported element of  and , indexed by ,  and , is associated with a priority value , with ,  and . The element with the highest priority has the lowest associated value . Omission of Part 2 CSI is according to the priority order shown in Table 5.2.3-1, where:\n-\tGroup 0 includes  (if reported),  () and  (if reported).\n-\tGroup 1 includes the  highest priority elements of  (if reported), , the  highest priority elements of  and the   highest priority elements of  ().\n-\tGroup 2 includes the  lowest priority elements of  (if reported), the  lowest priority elements of  and the  lowest priority elements of  ().\n-\tFor Enhanced Type II for CJT reports, for a given CSI report , each reported element of  and , indexed by ,  and , is associated with a priority value , with , for , ,  and , and where  and  are defined in Clause 5.2.2.2.8. The element with the highest priority has the lowest associated value . Omission of Part 2 CSI is according to the priority order shown in Table 5.2.3-1, where\n-\tGroup 0 includes indices  (if reported),  (if reported) and  ().\n-\tGroup 1 includes indices  (if reported),  (if reported), the  highest priority elements of ,  , the  highest priority elements of , the  highest priority elements of  () and  (if reported).\n-\tGroup 2 includes the  lowest priority elements of , the  lowest priority elements of  and the  lowest priority elements of  ().\n-\tFor Further Enhanced Type II Port Selection for CJT reports, for a given CSI report , each reported element of  and , indexed by , ,  and , is associated with a priority value , for , ,  and ,  and where  is defined in Clause 5.2.2.2.8. The element with the highest priority has the lowest associated value . Omission of Part 2 CSI is according to the priority order shown in Table 5.2.3-1, where:\n-\tGroup 0 includes  (if reported),  () and  (if reported).\n-\tGroup 1 includes the  highest priority elements of  (if reported), , the  highest priority elements of , the   highest priority elements of  () and  (if reported).\n-\tGroup 2 includes the  lowest priority elements of  (if reported), the  lowest priority elements of  and the  lowest priority elements of  ().\n-\tFor Enhanced Type II for predicted PMI configured with , for a given CSI report , each reported element of   and , indexed by ,  and , is associated with a priority value , for , ,  and . The element with the highest priority has the lowest associated value . Omission of Part 2 CSI is according to the priority order shown in Table 5.2.3-1, where\n-\tGroup 0 includes indices  (if reported),  (if reported),  () and the second wideband CQI (if reported).\n-\tGroup 1 includes indices  (if reported),  (if reported), the  highest priority elements of ,  , the  highest priority elements of , the  highest priority elements of  (),  (if reported) and the second subband CQI of even subbands (if reported).\n-\tGroup 2 includes the  lowest priority elements of , the  lowest priority elements of , the  lowest priority elements of  () and the second subband CQI of odd subbands (if reported).\n-\tFor a Reporting Setting for which the CSI-ReportConfig contains a list of sub-configurations provided by [csi-ReportSubConfigList], for a corresponding CSI report  which contains one or more CSI sub-reports, omission of Part 2 subband CSI is done at a sub-configuration level within the same priority level defined by Table 5.2.3-1 where a sub-configuration with an index, provided by [csi-ReportSubConfigID], with lower value has higher priority.\n\nTable 5.2.3-1: Priority reporting levels for Part 2 CSI\n\nWhen the UE is scheduled to transmit a transport block on PUSCH not using repetition type B multiplexed with a CSI report(s) and if numberOfSlotsTBoMS is not present in the resource allocation table, or if numberOfSlotsTBoMS is present in the resource allocation table and the value of numberOfSlotsTBoMS in the row indicated by the Time domain resource assignment field in DCI is equal to 1, Part 2 CSI is omitted only when  is larger than  or when the higher layer parameter nrofBitsInUTO-UCI is configured, where parameters , , , , , , , , , and are defined in Clause 6.3.2.4 of [5, TS 38.212].\nPart 2 CSI is omitted level by level, beginning with the lowest priority level until the lowest priority level is reached which causes the  to be less than or equal to  or  when the higher layer parameter nrofBitsInUTO-UCI is configured.\nWhen the UE is scheduled to transmit a transport block on PUSCH not using repetition type B multiplexed with a CSI report(s) and if numberOfSlotsTBoMS is present in the resource allocation table and the value of numberOfSlotsTBoMS in the row indicated by the Time domain resource assignment field in DCI is larger than 1, Part 2 CSI is omitted only when   is larger than  when the higher layer parameter nrofBitsInUTO-UCI is configured, where parameters , , , , , , , ,, ,  and are defined in Clause 6.3.2.4 of [5, TS 38.212].\nPart 2 CSI is omitted level by level, beginning with the lowest priority level until the lowest priority level is reached which causes the  to be less than or equal to  or  when the higher layer parameter nrofBitsInUTO-UCI is configured.\nWhen the UE is scheduled to transmit a transport block on PUSCH using repetition type B multiplexed with a CSI report(s), Part 2 CSI is omitted only when \n\nis larger than \n,\nor\n, \nwhen the higher layer parameter nrofBitsInUTO-UCI is configured, where parameters , , , , , , , , , , , and are defined in Clause 6.3.2.4 of [5, TS 38.212].\nPart 2 CSI is omitted level by level, beginning with the lowest priority level until the lowest priority level is reached which causes \n\nto be less than or equal to \n,\nor\n, \nwhen the higher layer parameter nrofBitsInUTO-UCI is configured.\nWhen part 2 CSI is transmitted on PUSCH with no transport block, lower priority bits are omitted until Part 2 CSI code rate, which is given by  where , ,  are given in clause 6.3.2.4 of [5, 38.212] before HARQ-ACK puncturing part 2 CSI if any, is below a threshold code rate lower than one, where \n\t\n-\tis the CSI offset value from Table 9.3-2 of [6, TS 38.213]\n-\tR is signaled code rate in DCI\nIf the UE is in an active semi-persistent CSI reporting configuration on PUSCH, the CSI reporting is deactivated when either the downlink BWP or the uplink BWP is changed. Another activation command is required to enable the semi-persistent CSI reporting.\n5.2.4\tCSI reporting using PUCCH\nA UE is semi-statically configured by higher layers to perform periodic CSI Reporting on the PUCCH. A UE can be configured by higher layers for multiple periodic CSI Reports corresponding to multiple higher layer configured CSI Reporting Settings, where the associated CSI Resource Settings are higher layer configured. For a Reporting Setting for which the CSI-ReportConfig contains a list of sub-configurations provided by [csi-ReportSubConfigList], CSI reporting is provided for all the sub-configurations in each corresponding reporting instance. Periodic CSI reporting on PUCCH formats 2, 3, 4 supports Type I CSI with wideband granularity. \nA UE shall perform semi-persistent CSI reporting on the PUCCH applied starting from the first slot that is after slot  when the UE would transmit a PUCCH with HARQ-ACK information in slot n corresponding to the PDSCH carrying the activation command described in clause 6.1.3.16 of [10, TS 38.321] where \uf06d is the SCS configuration for the PUCCH. The activation command will contain one or more Reporting Settings, with or without containing one or more sub-configurations for each Reporting Setting for which the CSI-ReportConfig contains a list of sub-configurations provided by [csi-ReportSubConfigList], where the associated CSI Resource Settings are configured. Semi-persistent CSI reporting on the PUCCH supports Type I CSI. Semi-persistent CSI reporting on the PUCCH format 2 supports Type I CSI with wideband frequency granularity. Semi-persistent CSI reporting on PUCCH formats 3 or 4 supports Type I CSI with wideband and sub-band frequency granularities and Type II CSI Part 1.\nWhen the PUCCH carry Type I CSI with wideband frequency granularity, the CSI payload carried by the PUCCH format 2 and PUCCH formats 3, or 4 are identical and the same irrespective of RI (if reported), CRI (if reported). A CSI-ReportConfig with codebookType set to 'typeI-SinglePanel' and the corresponding CSI-RS Resource Set for channel measurement configured with two Resource Groups and  Resource Pairs can be configured with wideband frequency granularity only with csi-ReportMode set to 'Mode1' and numberOfSingleTRP-CSI-Mode1 set to . For type I CSI sub-band reporting on PUCCH formats 3, or 4, the payload is split into two parts. The first part contains RI (if reported), CRI (if reported), CQI for the first codeword. The second part contains PMI (if reported), LI (if reported) and contains the CQI for the second codeword (if reported) when RI > 4. For a CSI-ReportConfig configured with subband reporting, codebookType set to 'typeI-SinglePanel' and the corresponding CSI-RS Resource Set for channel measurement configured with two Resource Groups and  Resource Pairs, Part 1 contains RI(s), CRI(s), CQI(s) for the first codeword and is zero padded to a fixed payload size (if needed). Part 2 contains the CQI(s) for the second codeword (if reported) when RI is larger than 4, LIs (if reported) and PMI(s). For a CSI-ReportConfig containing a list of sub-configurations provided by [csi-ReportSubConfigList], and configured with subband reporting, for Type I CSI for one or more of the sub-configurations, Part 1 for a sub-configuration contains corresponding RI (if reported), CRI (if reported), CQI for the first codeword (if reported) and is zero padded to a fixed payload size (if needed). Part 2 for a sub-configuration contains the corresponding CQI for the second codeword (if reported) when RI is larger than 4, LI (if reported) and PMI (if reported).\nA semi-persistent report carried on the PUCCH formats 3 or 4 supports Type II CSI feedback, but only Part 1 of Type II CSI feedback (See Clause 5.2.2 and 5.2.3). Supporting Type II CSI reporting on the PUCCH formats 3 or 4 is a UE capability type2-SP-CSI-Feedback-LongPUCCH. A Type II CSI report (Part 1 only) carried on PUCCH formats 3 or 4 shall be calculated independently of any Type II CSI reports carried on the PUSCH (see Clause 5.2.3). \nWhen the UE is configured with CSI Reporting on PUCCH formats 2, 3 or 4, each PUCCH resource is configured for each candidate UL BWP. \nIf the UE is in an active semi-persistent CSI reporting configuration on PUCCH and has not received a deactivation command, the CSI reporting takes place when the BWP in which the reporting is configured to take place is the active BWP, otherwise the CSI reporting is suspended.\nA UE is not expected to report CSI with a total number of UCI bits and CRC bits larger than 115 bits when configured with PUCCH format 4. For CSI reports transmitted on a PUCCH, if all CSI reports consist of one part, the UE may omit a portion of CSI reports. Omission of CSI is according to the priority order determined from the Prii,CSI(y,k,c,s) value as defined in Clause 5.2.5. CSI report is omitted beginning with the lowest priority level until the CSI report code rate is less or equal to the one configured by the higher layer parameter maxCodeRate.\nIf any of the CSI reports consist of two parts, the UE may omit a portion of Part 2 CSI. Omission of Part 2 CSI is according to the priority order shown in Table 5.2.3-1. For a Reporting Setting for which the CSI-ReportConfig contains a list of sub-configurations provided by [csi-ReportSubConfigList], for a given CSI report which contains one or more CSI sub-reports, omission of Part 2 CSI is defined in Clause 5.2.3. Part 2 CSI is omitted beginning with the lowest priority level until the Part 2 CSI code rate is less or equal to the one configured by higher layer parameter maxCodeRate.\n5.2.5\tPriority rules for CSI reports\nFor two overlapping PUSCHs, the priority rules in this clause are applied for physical channels with same priority index according to clause 9 in [6, TS 38.213] if a UE is not configured with enableSTx2PofmDCI or a UE is configured by higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet and the UE is configured with enableSTx2PofmDCI and the two overlapping PUSCHs are associated with same value of coresetPoolIndex.\nCSI reports are associated with a priority value  where\n-\t for aperiodic CSI reports to be carried on PUSCH  for semi-persistent CSI reports to be carried on PUSCH,  for semi-persistent CSI reports to be carried on PUCCH and  for periodic CSI reports to be carried on PUCCH;\n-\t for CSI reports carrying L1-RSRP or L1-SINR and  for CSI reports not carrying L1-RSRP or L1-SINR;\n-\tc is the serving cell index and  is the value of the higher layer parameter maxNrofServingCells;\n-\tfor a CSI report configured with LTM-CSI-ReportConfig, c is the serving cell index value where the report configuration is configured.\n-\ts is the reportConfigID and is the value of the higher layer parameter maxNrofCSI-ReportConfigurations.\n-\tfor a CSI report configured with LTM-CSI-ReportConfig, s is the LTM-CSI-ReportConfigID and Ms is the value of the higher layer parameter maxNrofLTM-CSI-ReportConfigurations\nA first CSI report is said to have priority over second CSI report if the associated  value is lower for the first report than for the second report.\nTwo CSI reports are said to collide if the time occupancy of the physical channels scheduled to carry the CSI reports overlap in at least one OFDM symbol and are transmitted on the same carrier. When a UE is configured to transmit two colliding CSI reports, \n-\tif y values are different between the two CSI reports, the following rules apply except for the case when one of the y value is 2 and the other y value is 3 (for CSI reports transmitted on PUSCH, as described in Clause 5.2.3; for CSI reports transmitted on PUCCH, as described in Clause 5.2.4): \n-\tThe CSI report with higher  value shall not be sent by the UE.\n-\totherwise, the two CSI reports are multiplexed or either is dropped based on the priority values, as described in Clause 9.2.5.2 in [6, TS 38.213].\nA CSI report configured with LTM-CSI-ReportConfig has a higher priority over all CSI report(s) configured with CSI-ReportConfig irrespective of  value in case of collision with CSI report(s) configured with CSI-ReportConfig.\nIf a semi-persistent CSI report to be carried on PUSCH overlaps in time with PUSCH data transmission in one or more symbols on the same carrier, and if the earliest symbol of these PUSCH channels starts no earlier than N2+d2,1 symbols after the last symbol of the DCI scheduling the PUSCH where d2,1 is the maximum of the d2,1 associated with the PUSCH carrying semi-persistent CSI report and the PUSCH with data transmission, the CSI report shall not be transmitted by the UE. Otherwise, if the timeline requirement is not satisfied this is an error case.\nIf a UE would transmit a first PUSCH that includes semi-persistent CSI reports and a second PUSCH that includes an UL-SCH on the same carrier, and the first PUSCH transmission would overlap in time with the second PUSCH transmission, the UE does not transmit the first PUSCH and transmits the second PUSCH. The UE expects that the first and second PUSCH transmissions satisfy the above timing conditions for PUSCH transmissions that overlap in time when at least one of the first or second PUSCH transmissions is in response to a DCI format detection by the UE.\n5.3\tUE PDSCH processing procedure time\nIf the first uplink symbol of the PUCCH which carries the HARQ-ACK information, as defined by the assigned HARQ-ACK timing K1 and Koffset, if configured, and the PUCCH resource to be used and including the effect of the timing advance, starts no earlier than at symbol L1, where L1 is defined as the next uplink symbol with its CP starting after  after the end of the last symbol of the PDSCH carrying the TB being acknowledged, then the UE shall provide a valid HARQ-ACK message. For a PDSCH with disabled HARQ-ACK feedback,.\n-\tN1 is based on \u00b5 of table 5.3-1 and table 5.3-2 for UE processing capability 1 and 2 respectively, where \u00b5 corresponds to the one of (\u00b5PDCCH, \u00b5PDSCH, \u00b5UL) resulting with the largest Tproc,1, where the \u00b5PDCCH corresponds to the subcarrier spacing of the PDCCH scheduling the PDSCH, the \u00b5PDSCH corresponds to the subcarrier spacing of the scheduled PDSCH, and \u00b5UL corresponds to the subcarrier spacing of the uplink channel with which the HARQ-ACK is assumed to be transmitted for PDSCH with or without disabled HARQ-ACK feedback, and \u03ba is defined in clause 4.1 of [4, TS 38.211]. \n-\tFor UE processing capability 2,\n-\tif the UE is not indicating [UE Capability name], the UE is not expected to be simultaneously configured with higher layer parameter processingType2Enabled set to 'enable' and higher layer parameter dmrs-TypeEnh, and the additional processing delay d3 is 0.\n-\tif the UE is indicating [UE Capability name], \n-\tif the UE is configured with higher layer parameter dmrs-TypeEnh, the additional processing delay d3 is indicated by [UE Capability name], \n-\totherwise d3 =0.\n-\tFor operation with shared spectrum channel access in FR1, is calculated according to [4, TS 38.211], otherwise =0.\n-\tIf the PDSCH DM-RS position  for the additional DM-RS in Table 7.4.1.1.2-3 in clause 7.4.1.1.2 of [4, TS 38.211] is  then N1,0=14 in Table 5.3-1, otherwise N1,0=13.\n-\tIf the UE is configured with multiple active component carriers, the first uplink symbol which carries the HARQ-ACK information further includes the effect of timing difference between the component carriers as given in [11, TS 38.133].\n-\tFor the PDSCH mapping type A as given in clause 7.4.1.1 of [4, TS 38.211]: if the last symbol of PDSCH is on the i-th symbol of the slot where i < 7, then d1,1 = 7 - i, otherwise d1,1 = 0\n-\tIf a PUCCH of a larger priority index would overlap with a PUCCH of a smaller priority index, or with a PUSCH of a smaller priority index and the PUCCH of a larger priority index and the PUSCH of a smaller priority index are not simultaneously transmitted and the UE is not provided uci-MuxWithDiffPrio for the primary PUCCH group or uci-MuxWithDiffPrioSecondaryPUCCHgroup for the secondary PUCCH group, d2 for the PUCCH of a larger priority is set as reported by the UE; otherwise d2 = 0.\n-\tFor UE processing capability 1: If the PDSCH is mapping type B as given in clause 7.4.1.1 of [4, TS 38.211], and\n-\tif the number of PDSCH symbols allocated is L \u2265 7, then d1,1 = 0,\n-\tif the number of PDSCH symbols allocated is L \u2265 4 and L \u2264 6, then d1,1 = 7- L.\n-\tif the number of PDSCH symbols allocated is L = 3 then d1,1 = 3 + min (d,1), where d is the number of overlapping symbols of the scheduling PDCCH and the scheduled PDSCH.\n-\tif the number of PDSCH symbols allocated is 2, then d1,1 = 3+d, where d is the number of overlapping symbols of the scheduling PDCCH and the scheduled PDSCH.\n-\tFor UE processing capability 2: If the PDSCH is mapping type B as given in clause 7.4.1.1 of [4, TS 38.211], \n-\tif the number of PDSCH symbols allocated is L \u2265 7, then d1,1 = 0,\n-\tif the number of PDSCH symbols allocated is L \u2265 3 and L \u2264 6, then d1,1 is the number of overlapping symbols of the scheduling PDCCH and the scheduled PDSCH,\n-\tif the number of PDSCH symbols allocated is 2,\n-\tif the scheduling PDCCH was in a 3-symbol CORESET and the CORESET and the PDSCH had the same starting symbol, then d1,1 = 3,\n-\totherwise d1,1 is the number of overlapping symbols of the scheduling PDCCH and the scheduled PDSCH.\n-\tFor UE processing capability 2 with scheduling limitation when \u00b5PDSCH = 1, if the scheduled RB allocation exceeds 136 RBs, the UE defaults to capability 1 processing time. The UE may skip decoding a number of PDSCHs with last symbol within 10 symbols before the start of a PDSCH that is scheduled to follow Capability 2, if any of those PDSCHs are scheduled with more than 136 RBs with 30kHz SCS and following Capability 1 processing time. \n-\tFor a UE that supports capability 2 on a given cell, the processing time according to UE processing capability 2 is applied if the high layer parameter processingType2Enabled in PDSCH-ServingCellConfig is configured for the cell and set to 'enable'.\n-\tPDSCH processing capability 2 is not applied to PDSCH scheduled by PDCCH with DCI format 4_0, 4_1, or  4_2.\n-\tIf this PUCCH resource is overlapping with another PUCCH or PUSCH resource, then HARQ-ACK is multiplexed following the procedure in clause 9.2.5 of [6, TS 38.213], otherwise the HARQ-ACK message is transmitted on PUCCH.\n-\tUE is not expected to be scheduled to transmit PUCCH carrying the HARQ-ACK information for PDSCH scheduled by a PDCCH if uplink switching gap is triggered for the PUCCH as defined in clause 6.1.6 and the first uplink symbol of the PUCCH starts earlier than the duration of { + } from the last symbol of the PDCCH, where  equals to the switching gap duration.\nOtherwise the UE may not provide a valid HARQ-ACK corresponding to the scheduled PDSCH. The value of Tproc,1 is used both in the case of normal and extended cyclic prefix. \nFor a PDSCH that consists of two PDSCH transmission occasions in time domain in one slot, d1,1 is calculated based on the first PDSCH transmission occasion in the slot, and as described above.\nFor PDSCH with mapping Type B, if PDSCH is scheduled by a PDCCH reception that includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], d1,1 for PDSCH processing time is determined by considering the PDCCH candidate that results in larger d1,1 value. \nTable 5.3-1: PDSCH processing time for PDSCH processing capability 1\n\nTable 5.3-2: PDSCH processing time for PDSCH processing capability 2\n\n5.3.1\tApplication delay of the minimum scheduling offset restriction\nWhen the UE is scheduled with DCI format 0_1, 0_3, 1_1 or 1_3 with a 'Minimum applicable scheduling offset indicator' field in slot n, it shall determine the K0min and K2min values, if configured respectively, to be applied, while the previously applied K0min and/or K2min values are applied until the new values take effect. If the DCI in slot n also indicates an active DL (UL) BWP change for a serving cell, the indicated K0min (K2min) value in the new active DL (UL) BWP, if configured, is applied from the slot indicated by the slot offset value of the time domain resource assignment field in the DCI. Otherwise, change of applied minimum scheduling offset restriction indication carried by DCI in slot n, shall be applied in slot n+X of the scheduling cell. The UE does not expect to be scheduled with DCI format 0_1, 0_3, 1_1 or 1_3 with 'Minimum applicable scheduling offset indicator' field indicating another change to K0min or K2min for the same active BWP of the scheduled cell before slot n+X of the scheduling cell.\nWhen the DCI format 0_1, 0_3, 1_1 or 1_3 with 'Minimum applicable scheduling offset indicator' field indicating a change to the applied K0min or K2min is contained within the first three symbols of slot n, the value of application delay X is determined by, where  K0minOld is the currently applied K0min value of the active DL BWP in the scheduled cell and is zero, if minimumSchedulingOffsetK0 is not configured for the active DL BWP in the scheduled cell, Z\u00b5 is determined by the subcarrier spacing of the active DL BWP in the scheduling cell in slot n, and given in Table 5.3.1-1, and \u00b5PDCCH and \u00b5PDSCH are the sub-carrier spacing configurations for PDCCH of the active DL BWP in the scheduling cell and PDSCH of the active DL BWP in the scheduled cell, respectively, in slot n. After indication of a change to the applied K0min or K2min of the scheduled cell in slot n of the scheduling cell, if there is an active DL BWP change in the scheduling cell before slot n+X, the new K0min and/or K2min values are applied from the first slot no earlier than the start of slot n+X based on the sub-carrier spacing configuration of the active DL BWP in the scheduling cell in slot n.\nWhen the DCI format 0_1, 0_3, 1_1 or 1_3 with 'Minimum applicable scheduling offset indicator' field is received outside the first three symbols of the slot, value of Z\u00b5 from Table 5.3.1-1 is incremented by one before determining the application delay X. When the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the purpose of determining 'Minimum applicable scheduling offset indicator' field is received outside the first three symbols of the slot, the PDCCH candidate that ends later in time is used.\nTable 5.3.1-1: Definition of Z\u00b5\n\n5.4\tUE CSI computation time\nWhen the CSI request field on a DCI triggers a CSI report(s) on PUSCH, the UE shall provide a valid CSI report for the n-th triggered report, \n-\tif the first uplink symbol to carry the corresponding CSI report(s) including the effect of the timing advance, starts no earlier than at symbol Zref, and\n-\tif the first uplink symbol to carry the n-th CSI report including the effect of the timing advance, starts no earlier than at symbol Z'ref(n), \nwhere Zref is defined as the next uplink symbol with its CP starting  after the end of the last symbol of the PDCCH triggering the CSI report(s), and where Z'ref(n), is defined as the next uplink symbol with its CP starting after the end of the last symbol in time of the latest of: aperiodic CSI-RS resource for channel measurements, aperiodic CSI-IM used for interference measurements, and aperiodic NZP CSI-RS for interference measurement for a CSI-ReportConfig, or for all triggered sub-configurations if CSI-ReportConfig contains multiple sub-configurations, when aperiodic CSI-RS is used for channel measurement for the n-th triggered CSI report, and where Tswitch is defined in clause 6.4 and is applied only if  of table 5.4-1 is applied. \nIf the PUSCH indicated by the DCI is overlapping with another PUCCH or PUSCH, then the CSI report(s) are multiplexed following the procedure in clause 9.2.5 of [6, TS 38.213] and clause 5.2.5 when applicable, otherwise the CSI report(s) are transmitted on the PUSCH indicated by the DCI.\nWhen the CSI request field on a DCI triggers a CSI report(s) on PUSCH, if the first uplink symbol to carry the corresponding CSI report(s) including the effect of the timing advance, starts earlier than at symbol Zref,\n-\tthe UE may ignore the scheduling DCI if no HARQ-ACK or transport block is multiplexed on the PUSCH.\nWhen the CSI request field on a DCI triggers a CSI report(s) on PUSCH, if the first uplink symbol to carry the n-th CSI report including the effect of the timing advance, starts earlier than at symbol Z'ref(n),\n-\tthe UE may ignore the scheduling DCI if the number of triggered reports is one and no HARQ-ACK or transport block is multiplexed on the PUSCH\n-\tOtherwise, the UE is not required to update the CSI for the n-th triggered CSI report.\nWhen the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the purpose of determining the last symbol of the PDCCH triggering the CSI report(s), the PDCCH candidate that ends later in time is used.\nZ, Z' and \u00b5 are defined as: \n and , where M is the number of updated CSI report(s) according to Clause 5.2.1.6,  corresponds to the m-th updated CSI report and is defined as\n-\t of the table 5.4-1 if max{ \u00b5PDCCH, \u00b5CSI-RS, \u00b5UL} \u2264 3 and if the CSI is triggered without a PUSCH with either transport block or HARQ-ACK or both when L = 0 CPUs are occupied (according to Clause 5.2.1.6) and the CSI to be transmitted is a single CSI and corresponds to wideband frequency-granularity where the CSI corresponds to at most 4 CSI-RS ports in a single resource without CRI report and where CodebookType is set to 'typeI-SinglePanel' or where reportQuantity is set to 'cri-RI-CQI', or\n-\t of the table 5.4-2 if the CSI to be transmitted corresponds to wideband frequency-granularity where the CSI corresponds to at most 4 CSI-RS ports in a single resource without CRI report and where CodebookType is set to 'typeI-SinglePanel' or where reportQuantity is set to 'cri-RI-CQI', or\n-\t of the table 5.4-2 if the CSI to be transmitted corresponds to wideband frequency-granularity where the reportQuantity is set to 'ssb-Index-SINR', 'cri-SINR', 'ssb-Index-SINR- Index ', or 'cri-SINR- Index ', or\n-\t of the table 5.4-2 if reportQuantity is set to 'cri-RSRP', 'ssb-Index-RSRP', 'cri-RSRP- Index' or 'ssb-Index-RSRP- Index ', is according to UE reported capability beamReportTiming and KBl is according to UE reported capability beamSwitchTiming as defined in [13, TS 38.306], or\n-\t or , according to UE reported capability, with  of table 5.4-2, if codebookType is set to 'typeII-CJT-r18' or 'typeII-CJT-PortSelection-r18' and the corresponding NZP-CSI-RS-ResourceSet for channel measurement is configured with  resources, or\n-\t, with  of table 5.4-2, if the CSI report is configured with , codebookType is set to 'typeII-Doppler-r18' or 'typeII-Doppler-PortSelection-r18' and the corresponding NZP-CSI-RS-ResourceSet for channel measurement is aperiodic with  CSI-RS resources, or\n-\t, with  of table 5.4-2, if the CSI report is configured with , codebookType is set to 'typeII-Doppler-r18' or 'typeII-Doppler-PortSelection-r18' and the corresponding NZP-CSI-RS-ResourceSet for channel measurement is periodic or semi-persistent with a single CSI-RS resource, or\n-\t or , according to UE reported capability, with  of table 5.4-2, if the CSI report is configured with , codebookType is set to 'typeII-Doppler-r18' and the corresponding NZP-CSI-RS-ResourceSet for channel measurement is aperiodic with  CSI-RS resources, or\n-\t or , according to UE reported capability, with  of table 5.4-2, if the CSI report is configured with , codebookType is set to 'typeII-Doppler-r18' and the corresponding NZP-CSI-RS-ResourceSet for channel measurement is periodic or semi-persistent with a single CSI-RS resource, or\n-\t of table 5.4-2 otherwise.\n-\t\u00b5 of table 5.4-1 and table 5.4-2 corresponds to the min (\u00b5PDCCH, \u00b5CSI-RS, \u00b5UL) where the \u00b5PDCCH corresponds to the subcarrier spacing of the PDCCH with which the DCI was transmitted and \u00b5UL corresponds to the subcarrier spacing of the PUSCH with which the CSI report is to be transmitted and \u00b5CSI-RS corresponds to the minimum subcarrier spacing of the aperiodic CSI-RS triggered by the DCI\nTable 5.4-1: CSI computation delay requirement 1\n\nTable 5.4-2: CSI computation delay requirement 2\n\nFor a CSI report corresponding to a CSI-ReportConfig that contains a list of sub-configurations, provided by [csi-ReportSubConfigList], only  of table 5.4-2 is applicable. \n5.5\tUE PDSCH reception preparation time with cross carrier scheduling with different subcarrier spacings for PDCCH and PDSCH\nThis clause applies only if the PDCCH carrying the scheduling DCI is received on one carrier with one OFDM subcarrier spacing (\u00b5PDCCH), and the PDSCH scheduled to be received by the DCI is on another carrier with another OFDM subcarrier spacing (\u00b5PDSCH).\nIf the \u00b5PDCCH < \u00b5PDSCH, the UE is expected to receive the scheduled PDSCH, if the first symbol in the PDSCH allocation, including the DM-RS, as defined by the slot offset K0 and the start and length indicator SLIV of the scheduling DCI starts no earlier than the first symbol of the slot of the PDSCH reception starting at least Npdsch PDCCH symbols after the end of the PDCCH scheduling the PDSCH, not taking into account the effect of receive timing difference between the scheduling cell and the scheduled cell.\nIf the \u00b5PDCCH > \u00b5PDSCH, the UE is expected to receive the scheduled PDSCH, if the first symbol in the PDSCH allocation, including the DM-RS, as defined by the slot offset K0 and the start and length indicator SLIV of the scheduling DCI starts no earlier than Npdsch PDCCH symbols after the end of the PDCCH scheduling the PDSCH, not taking into account the effect of receive timing difference between the scheduling cell and the scheduled cell.\nWhen the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the purpose of determining Npdsch, the PDCCH candidate that ends later in time is used. \nTable 5.5-1: Npdsch as a function of the subcarrier spacing of the scheduling PDCCH\n\n6\tPhysical uplink shared channel related procedure\n6.1\tUE procedure for transmitting the physical uplink shared channel\nPUSCH transmission(s) can be dynamically scheduled by an UL grant in a DCI, or the transmission can correspond to a configured grant Type 1 or Type 2. The configured grant Type 1 PUSCH transmission is semi-statically configured to operate upon the reception of higher layer parameter of configuredGrantConfig including rrc-ConfiguredUplinkGrant without the detection of an UL grant in a DCI. The configured grant Type 2 PUSCH transmission is semi-persistently scheduled by an UL grant in a valid activation DCI according to clause 10.2 of [6, TS 38.213] after the reception of higher layer parameter configuredGrantConfig not including rrc-ConfiguredUplinkGrant. If configuredGrantConfigToAddModList is configured, more than one configured grant configuration of configured grant Type 1 and/or configured grant Type 2 may be active at the same time on an active BWP of a serving cell.\nThe UE can be configured with a list of up to 64 TCI-UL-State configurations within the higher layer parameter BWP-UplinkDedicated. Each TCI-UL-State configuration contains a parameter for configuring one reference signal, if applicable, for determining UL TX spatial filter for dynamic-grant and configured-grant based PUSCH and PUCCH resource in a CC, and SRS.\nIf a UE is configured by higher layer parameter PDCCH-Config that contains ControlResourceSets with two different values of coresetPoolIndex for the active BWP of a serving cell, or if a UE is configured with SSB-MTC-AddtionalPCI and with PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet, and if the UE is configured with [twoTAGs] and is configured with dl-OrJointTCI-StateList or TCI-UL-State for a serving cell, each TCI-State or TCI-UL-State is associated with a [TAG-ID] for determining timing adjustment for a corresponding UL transmission as described in Clause 4.2 of [6, TS 38.213]. The UE does not expect that TCI-states or TCI-UL-States associated with one coresetPoolIndex to correspond to two TAGs.\nFor the PUSCH transmission corresponding to a Type 1 configured grant or a Type 2 configured grant activated by DCI format 0_0 or 0_1, the parameters applied for the transmission are provided by configuredGrantConfig except for dataScramblingIdentityPUSCH, txConfig, codebookSubset, maxRank, maxRank-n8, scaling of UCI-OnPUSCH, which are provided by pusch-Config. A configured grant PUSCH can be transmitted with at most 4 layers. For the PUSCH transmission corresponding to a Type 2 configured grant activated by DCI format 0_2, the parameters applied for the transmission are provided by configuredGrantConfig except for dataScramblingIdentityPUSCH, txConfig, codebookSubsetDCI-0-2, maxRankDCI-0-2, scaling of UCI-OnPUSCH, resourceAllocationType1GranularityDCI-0-2 provided by pusch-Config. If the UE is provided with transformPrecoder in configuredGrantConfig, the UE applies the higher layer parameter tp-pi2BPSK, if provided in pusch-Config, according to the procedure described in clause 6.1.4 for the PUSCH transmission corresponding to a configured grant. \nWhen the UE is configured dl-OrJointTCI-StateList or ul-TCI-StateList, the UE shall perform PUSCH transmission corresponding to a Type 1 configured grant or a Type 2 configured grant or a dynamic grant according to the spatial relation, if applicable, with a reference to the RS for determining UL Tx spatial filter. The RS is determined based on an RS configured with qcl-Type set to 'typeD' of the indicated TCI-State or an RS in the indicated TCI-UL-State. The reference RS in the indicated TCI-State can be a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter repetition, or a CSI-RS resource in an NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info. The reference RS in the indicated TCI-UL-State can be a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter repetition, a CSI-RS resource in an NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info, an SRS resource in an SRS resource set with the higher layer parameter usage set to 'beamManagement', or SS/PBCH block associated with the same or different PCI from the PCI of the serving cell. When nrofSlotsInCG-Period is configured for Type 1 configured grant or Type 2 configured grant, HARQ process ID for the first configured PUSCH grant and each subsequent valid configured PUSCH grant within a periodicity of the configuration is determined as in clause 5.4.1 of [10, TS 38.321], where a valid configured PUSCH grant is the one not colliding  with the DL symbol(s) indicated by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated if provided, and not colliding with a symbol(s) of an SS/PBCH block with index provided by ssb-PositionsInBurst as described in clause 11.1 of [6, TS 38.213].\nWhen a UE is configured with dl-OrJointTCI-StateList or TCI-UL-State and is having two indicated TCI-States or TCI-UL-States, \n-\ta UE having a PUSCH transmission scheduled or activated by DCI format 0_0 should apply the first indicated TCI state to the PUSCH transmission, \n-\ta UE configured with a PUSCH transmission corresponding to a Type 1 configured grant is expected to be configured with the higher layer parameter applyIndicatedTCIState indicating the first, the second or both of the indicated TCI states to be applied for the PUSCH transmission. If 'both' TCI states are indicated, the UE should apply the first indicated TCI state to the PUSCH transmission occasion(s) or the PUSCH antenna port(s) associated with the first SRS resource set for CB/NCB transmission, and the second indicated TCI state to the PUSCH transmission occasion(s) or the PUSCH antenna port(s) associated with the second SRS resource set for CB/NCB transmission; otherwise the UE should apply either the 'first' or 'second' indicated TCI state to all PUSCH transmission occasions.\n-\tIf the UE is configured by higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in different ControlResourceSets, the first and the second indicated TCI states correspond to the indicated TCI-States or TCI-UL-States specific to coresetPoolIndex value 0 and value 1, respectively, and applyIndicatedTCIState does not indicate both of the indicated TCI states to be applied for the PUSCH transmission\nFor the PUSCH retransmission scheduled by a PDCCH with CRC scrambled by CS-RNTI with NDI=1, the parameters in pusch-Config are applied for the PUSCH transmission except for p0-NominalWithoutGrant, p0-PUSCH-Alpha, powerControlLoopToUse, pathlossReferenceIndex described in clause 7.1 of [6, TS 38.213], mcs-Table, mcs-TableTransformPrecoder described in clause 6.1.4.1 and transformPrecoder described in clause 6.1.3.\nFor a UE configured with two uplinks in a serving cell, PUSCH retransmission for a TB on the serving cell is not expected to be on a different uplink than the uplink used for the PUSCH initial transmission of that TB.\nA UE shall upon detection of a PDCCH with a configured DCI format 0_0, 0_1, 0_2 or 0_3 transmit the corresponding PUSCH as indicated by that DCI unless the UE does not generate a transport block as described in [10, TS38.321]. Upon detection of a DCI format 0_1 or 0_2  with 'UL-SCH indicator' set to '0' and with a non-zero 'CSI request' where the associated reportQuantity in CSI-ReportConfig set to 'none' for all CSI report(s) triggered by 'CSI request' in this DCI format 0_1 or 0_2, the UE ignores all fields in this DCI except the 'CSI request' and the UE shall not transmit the corresponding PUSCH as indicated by this DCI format 0_1 or 0_2. Upon detection of a DCI format 0_3 with 'UL-SCH indicator' set to '0' and with a non-zero 'CSI request' where the associated reportQuantity in CSI-ReportConfig set to 'none' for all CSI report(s) triggered by 'CSI request' in this DCI format 0_3, the UE ignores all fields for the scheduled cell with the smallest serving cell index in this DCI except the 'CSI request' and the UE shall not transmit the corresponding PUSCH on the serving cell with the smallest serving cell index as indicated by this DCI format 0_3. \nWhen the UE is scheduled with multiple PUSCHs on a serving cell by a DCI, HARQ process ID indicated by this DCI applies to the first PUSCH not overlapping with a DL symbol indicated by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated if provided, or a symbol of an SS/PBCH block with index provided by ssb-PositionsInBurst, HARQ process ID is then incremented by 1 for each subsequent PUSCH(s) in the scheduled order, with modulo operation of nrofHARQ-ProcessesForPUSCH applied if nrofHARQ-ProcessesForPUSCH is provided, or with modulo operation of nrofHARQ-ProcessesForPUSCH-r17 applied if nrofHARQ-ProcessesForPUSCH-r17 is provided, or with modulo operation of 16 applied, otherwise. HARQ process ID is not incremented for PUSCH(s) not transmitted if at least one of the symbols indicated by the indexed row of the used resource allocation table in the slot overlaps with a DL symbol indicated by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated if provided, or a symbol of an SS/PBCH block with index provided by ssb-PositionsInBurst. For any HARQ process ID(s) in a given scheduled cell, the UE is not expected to transmit a PUSCH that overlaps in time with another PUSCH. Except for the case when a UE is configured by higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet for the active BWP of a serving cell and PDCCHs that schedule two PUSCHs are associated to different ControlResourceSets having different values of coresetPoolIndex, for any two HARQ process IDs in a given scheduled cell, if the UE is scheduled to start a first PUSCH transmission starting in symbol j by a PDCCH ending in symbol i on a scheduling cell,, the UE is not expected to be scheduled to transmit a PUSCH starting earlier than the end of the first PUSCH by a PDCCH that ends later than symbol i of the scheduling cell. When the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the purpose of determining the PDCCH ending in symbol i, the PDCCH candidate that ends later in time is used. The UE is not expected to be scheduled to transmit another PUSCH by a DCI format 0_0 with CRC scrambled by TC-RNTI, for a given HARQ process with the DCI received before the end of the expected transmission of the last PUSCH for that HARQ process if the latter is scheduled by a DCI format 0_0 with CRC scrambled by TC-RNTI or by an UL grant in RA Response. The UE is not expected to be scheduled to transmit another PUSCH by DCI format 0_0, 0_1, 0_2 or 0_3 scrambled by C-RNTI, CS-RNTI or MCS-C-RNTI for a given HARQ process with the DCI received before the end of the expected transmission of the last PUSCH for that HARQ process if the latter is scheduled by a DCI with CRC scrambled by C-RNTI, CS-RNTI or MCS-C-RNTI. \nIf a UE is configured by higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet for the active BWP of a serving cell and PDCCHs that schedule two PUSCHs are associated to different ControlResourceSets having different values of coresetPoolIndex, for any two HARQ process IDs  in a given scheduled cell, if the UE is scheduled to start a first PUSCH transmission starting in symbol j by a PDCCH associated with a value of coresetPoolIndex ending in symbol i, the UE can be scheduled to transmit a PUSCH starting earlier than the end of the first PUSCH by a PDCCH associated with a different value of coresetPoolIndex that ends later than symbol i. \nWhen two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook' or 'nonCodebook' and higher layer parameter enableSTx2PofmDCI is configured and PDCCH-Config  contains two different values of coresetPoolIndex in ControlResourceSet for the active BWP of a serving cell, \n-\ttwo PUSCHs that are fully/partially overlapping in time domain and are fully/partially/non-overlapping in frequency domain can be dynamically scheduled by UL grant(s) in DCI(s) and/or scheduled by configured grant(s) Type 1 or Type 2, \n-\tif dynamically scheduled by UL grant(s) in DCI(s) or activated by DCI(s) for configured grant Type 2, the DCI field SRS Resource Set Indicator is not present in each of PDCCH \n-\ttwo PUSCHs are associated to different values of coresetPoolIndex where for configured grant Type 1, the association is based on higher layer parameter srs-ResourceSetId in rrc-ConfiguredUplinkGrant that indicates either the first or the second SRS resource set with usage 'codebook' or 'nonCodeBook' in srs-ResourceSetToAddModList\n-\tthe UE is not expected to be configured with different number of SRS resources in the two SRS resource sets\n-\tthe UE expects maxNrofPorts in PTRS-UplinkConfig to be configured as one if UL PT-RS is configured. \nWhen a UE is configured with dl-OrJointTCI-StateList or TCI-UL-State and two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook' or 'noncodebook', and the higher layer parameter multipanelScheme is set to 'SDMscheme' or 'SFNscheme', and the higher layer parameter rrc-ConfiguredUplinkGrant does not contain srs-ResourceIndicator2 or precodingAndNumberOfLayers2, the PUSCH transmission occasion(s) is associated with the first SRS resource set if the first indicated TCI-States or TCI-UL-States applies and is associated with the second SRS resource set if the second indicated TCI-States or TCI-UL-States applies.\nWhen a UE is configured with dl-OrJointTCI-StateList or TCI-UL-State is having two indicated TCI states, and only one SRS resource set is configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook' or 'noncodebook', the PUSCH transmission occasion(s) scheduled or activated by DCI format 0_1 or 0_2 is associated with the first indicated TCI-States or TCI-UL-States if applies or is associated with the second indicated TCI-States or TCI-UL-States if applies, as indicated by the higher layer parameter applyIndicatedTCIState-r18 configured by PUSCH-Config.\nWhen a UE is configured with higher layer parameter enableSTx2PofmDCI and PDCCH-Config contains two different values of coresetPoolIndex in ControlResourceSet for the active BWP of a serving cell, \n-\tthe UE is expected to be configured with two SRS resource sets with usage 'codebook' or 'nonCodeBook' in srs-ResourceSetToAddModList\n-\tif the UE is configured to monitor DCI format 0_2 and there is only one SRS resource sets configured by srs-ResourceSetToAddModListDCI-0-2 and associated with usage 'codebook' or 'nonCodeBook', the UE monitors only CORESETs associated with coresetPoolIndex value 0. \nA UE is not expected to be scheduled by a PDCCH ending in symbol  to transmit a PUSCH on a given serving cell overlapping in time with a transmission occasion, where the UE is allowed to transmit a PUSCH with configured grant according to [10, TS38.321], starting in a symbol  on the same serving cell if the end of symbol  is not at least  symbols before the beginning of symbol , if \n-\tthe UE is not provided prioLowDG-HighCG or prioHighDG-LowCG, or the UE is provided prioLowDG-HighCG or prioHighDG-LowCG and the two PUSCHs have the same priority index as described in Clause 9 of [6, TS 38.213] and\n-\tthe UE is not provided enableSTx2PofmDCI, or is provided enableSTx2PofmDCI and the two PUSCHs are associated with the same coresetPoolIndex value.\nThe value  in symbols is determined according to the UE processing capability defined in Clause 6.4, and and the symbol duration are based on the minimum of the subcarrier spacing corresponding to the PUSCH with configured grant and the subcarrier spacing of the PDCCH scheduling the PUSCH.\nIf a UE receives an ACK for a given HARQ process in CG-DFI in a PDCCH ending in symbol i to terminate a transport block repetition in a PUSCH transmission with a configured grant on a given serving cell with the same HARQ process after symbol i, the UE is expected to terminate the repetition of the transport block in a PUSCH transmission starting from a symbol j if the gap between the end of PDCCH of symbol i and the start of the PUSCH transmission in symbol j is equal to or more than N2 symbols. The value N2 in symbols is determined according to the UE processing capability defined in Clause 6.4, and N2 and the symbol duration are based on the minimum of the subcarrier spacing corresponding to the PUSCH and the subcarrier spacing of the PDCCH indicating CG-DFI. A UE is not expected to be scheduled by a PDCCH ending in symbol  to transmit a PUSCH on a given serving cell for a given HARQ process, if there is a transmission occasion where the UE is allowed to transmit a PUSCH with configured grant according to [10, TS38.321] with the same HARQ process on the same serving cell starting in a symbol  after symbol , and if the gap between the end of PDCCH and the beginning of symbol  is less than  symbols. The value  in symbols is determined according to the UE processing capability defined in clause 6.4, and and the symbol duration are based on the minimum of the subcarrier spacing corresponding to the PUSCH with configured grant and the subcarrier spacing of the PDCCH scheduling the PUSCH.\nFor PUSCH scheduled by DCI format 0_0 on a cell, the UE shall transmit PUSCH according to the spatial relation, if applicable, corresponding to the dedicated PUCCH resource with the lowest ID within the active UL BWP of the cell, as described in Clause 9.2.1 of [6, TS 38.213]. If the dedicated PUCCH resource with the lowest ID within the active UL BWP of the cell corresponds to two spatial relations, the UE shall transmit the PUSCH according to the spatial relation with the lower ID. \nFor PUSCH scheduled by DCI format 0_0 on a cell and if the higher layer parameter enableDefaultBeamPL-ForPUSCH0-0 is set 'enabled', the UE is not configured with PUCCH resources on the active UL BWP and the UE is in RRC connected mode, the UE shall transmit PUSCH according to the spatial relation, if applicable, with a reference to the RS configured with qcl-Type set to 'typeD' corresponding to the QCL assumption of the CORESET with the lowest ID on the active DL BWP of the cell. If the CORESET is indicated with two TCI states, sfnSchemePdcch is configured and the UE supports sfn-DefaultUL-BeamSetup-r17, the UE shall use the first TCI state as the QCL assumption. \nFor PUSCH scheduled by DCI format 0_0 on a cell and if the higher layer parameter enableDefaultBeamPL-ForPUSCH0-0 is set 'enabled', the UE is configured with PUCCH resources on the active UL BWP where all the PUCCH resource(s) are not configured with any spatial relation and the UE is in RRC connected mode, the UE shall transmit PUSCH according to the spatial relation, if applicable, with a reference to the RS configured with qcl-Type set to 'typeD' corresponding to the QCL assumption of the CORESET with the lowest ID on the active DL BWP of the cell in case CORESET(s) are configured on the cell. If the CORESET is indicated with two TCI states, sfnSchemePdcch is configured and the UE supports sfn-DefaultUL-BeamSetup-r17, the UE shall use the first TCI state as the QCL assumption.\nFor uplink, 16 HARQ processes per cell are supported by the UE, or subject to UE capability, a maximum of 32 HARQ processes per cell as defined in [13, TS 38.306]. The number of processes the UE may assume will at most be used for the uplink is configured to the UE for each cell separately by higher layer parameter nrofHARQ-ProcessesForPUSCH, or nrofHARQ-ProcessesForPUSCH-r17, and when no configuration is provided the UE may assume a default number of 16 processes.\n6.1.1\tTransmission schemes\nTwo transmission schemes are supported for PUSCH: codebook based transmission and non-codebook based transmission. The UE is configured with codebook based transmission when the higher layer parameter txConfig in pusch-Config is set to 'codebook', the UE is configured non-codebook based transmission when the higher layer parameter txConfig is set to 'nonCodebook'. If the higher layer parameter txConfig is not configured, the UE is not expected to be scheduled by DCI format 0_1, 0_2 or 0_3. If PUSCH is scheduled by DCI format 0_0, the PUSCH transmission is based on a single antenna port. Except if the higher layer parameter enableDefaultBeamPL-ForPUSCH0-0 is set 'enabled', the UE shall not expect PUSCH scheduled by DCI format 0_0 in a BWP without configured PUCCH resource with PUCCH-SpatialRelationInfo in frequency range 2 in RRC connected mode.\n6.1.1.1\tCodebook based UL transmission\nFor codebook based transmission, PUSCH can be scheduled by DCI format 0_0, DCI format 0_1, DCI format 0_2, DCI format 0_3 or semi-statically configured to operate according to Clause 6.1.2.3. If this PUSCH is scheduled by DCI format 0_1, DCI format 0_2, or semi-statically configured to operate according to Clause 6.1.2.3, the UE determines its PUSCH transmission precoder(s) based on SRI(s), TPMI(s) and the transmission rank, where the SRI(s), TPMI(s) and the transmission rank are given by DCI fields of one or two SRS resource indicators and one or two Precoding information and number of layers in clause 7.3.1.1.2 and 7.3.1.1.3 of [5, TS 38.212] for DCI format 0_1 and 0_2  or given by srs-ResourceIndicator and precodingAndNumberOfLayers according to clause 6.1.2.3 or given by srs-ResourceIndicator, srs-ResourceIndicator2, precodingAndNumberOfLayers, and precodingAndNumberOfLayers2 according to clause 6.1.2.3. If this PUSCH is scheduled by DCI format 0_3, the UE determines its PUSCH transmission precoder based on SRI, TPMI and the transmission rank, where the SRI, TPMI and the transmission rank are given by DCI fields of one SRS resource indicator and one Precoding information and number of layers in clause 7.3.1.1.4 of [5, TS 38.212] for DCI format 0_3. The SRS-ResourceSet(s) applicable for PUSCH scheduled by DCI format 0_1 and DCI format 0_2 are defined by the entries of the higher layer parameter srs-ResourceSetToAddModList and srs-ResourceSetToAddModListDCI-0-2 in SRS-config, respectively. Only one or two SRS resource sets can be configured in srs-ResourceSetToAddModList with higher layer parameter usage in SRS-ResourceSet set to 'codebook', and only one or two SRS resource sets can be configured in srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook'. \nWhen only one SRS resource set is configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook', SRI and TPMI are given by the DCI fields of one SRS resource indicator and one Precoding information and number of layers in clauses 7.3.1.1.2, 7.3.1.1.3 and 7.3.1.1.4 of [5, TS 38.212] for DCI format 0_1, 0_2 and 0_3 or given by srs-ResourceIndicator and precodingAndNumberOfLayers according to clause 6.1.2.3. When two SRS resource sets are configured in srs-ResourceSetToAddModList with higher layer parameter usage in SRS-ResourceSet set to 'codebook', SRI and TPMI are given by the DCI fields of one SRS resource indicator and one Precoding information and number of layers in clause 7.3.1.1.4 of [5, TS 38.212] for DCI format 0_3 and the UE applies the indicated SRI and TPMI to one or more PUSCH repetitions according to the first SRS resource set. The TPMI is used to indicate the precoder to be applied over the layers {0\u2026\u03bd-1} and that corresponds to the SRS resource selected by the SRI when multiple SRS resources are configured, or if a single SRS resource is configured TPMI is used to indicate the precoder to be applied over the layers {0\u2026\u03bd-1} and that corresponds to the SRS resource. The transmission precoder is selected from the uplink codebook that has a number of antenna ports equal to higher layer parameter nrofSRS-Ports in SRS-Config, as defined in Clause 6.3.1.5 of [4, TS 38.211]. When the UE is configured with the higher layer parameter txConfig set to 'codebook', the UE is configured with at least one SRS resource. The indicated SRI in slot n is associated with the most recent transmission of SRS resource identified by the SRI, where the SRS resource is prior to the PDCCH carrying the SRI.\nWhen two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook', one or two SRI(s), and one or two TPMI(s) are given by the DCI fields of two SRS resource indicator and two Precoding information and number of layers in clause 7.3.1.1.2 and 7.3.1.1.3 of [5, TS 38.212] for DCI format 0_1 and 0_2.  The UE applies the indicated SRI(s) and TPMI(s) to one or more PUSCH repetitions according to the associated SRS resource set of a PUSCH repetition according to clause 6.1.2.1. Each TPMI, based on indicated codepoint of SRS Resource Set indicator, is used to indicate the precoder to be applied over the layers {0\u2026\u03bd-1} and that corresponds to the SRS resource selected by the corresponding SRI when multiple SRS resources are configured for the applicable SRS resource set, or if a single SRS resource is configured for the applicable SRS resource set TPMI is used to indicate the precoder to be applied over the layers {0\u2026\u03bd-1} and that corresponds to the SRS resource. For one or two TPMI(s), the transmission precoder is selected from the uplink codebook that has a number of antenna ports equal to the higher layer parameter nrofSRS-Ports in SRS-Config for the indicated SRI(s), as defined in Clause 6.3.1.5 of [4, TS 38.211]. When two SRIs are indicated, the UE shall expect the nrofSRS-Ports for the two indicated SRS resources to be the same. When the UE is configured with the higher layer parameter txConfig set to 'codebook', the UE is configured with at least one SRS resource. Each of the indicated one or two SRI(s) in slot n is associated with the most recent transmission of SRS resource of associated SRS resource set identified by the SRI, where the SRS resource is prior to the PDCCH carrying the SRI. When two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook', the UE is not expected to be configured with different number of SRS resources in the two SRS resource sets.\nWhen the higher layer parameter multipanelScheme is set to 'SDMScheme' and two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook', two SRI(s), and two TPMI(s) are given by the DCI fields of two SRS resource indicator and two Precoding information and number of layers in clause 7.3.1.1.2 and 7.3.1.1.3 of [5, TS 38.212] for DCI format 0_1 and 0_2 or given by srs-ResourceIndicator, srs-ResourceIndicator2, precodingAndNumberOfLayers, and precodingAndNumberOfLayers2 in configuredGrantConfig: \n-\tWhen codepoint \"10\"  of SRS Resource Set indicator is indicated or when srs-ResourceIndicator2 and precodingAndNumberOfLayers2 are provided, the first TPMI is used to indicate the precoder to be applied over layers {0\u2026v1-1}, where v1 is the number of layers indicated by the first TPMI, that corresponds to the SRS resource selected by the corresponding SRI when multiple SRS resources are configured for the applicable SRS resource set or if single SRS resource is configured for the applicable SRS resource set, and the second TPMI is used to indicate the precoder to be applied over layers {v1\u2026. v2+v1-1}, where v2 is the number of layers indicated by the second TPMI, that corresponds to the SRS resource selected by the corresponding SRI when multiple SRS resources are configured for the applicable SRS resource set or if single SRS resource is configured for the applicable SRS resource set, v1 \u2264 maxRankSdm or maxRankSdmDCI-0-2 and v2 \u2264 maxRankSdm or maxRankSdmDCI-0-2 and maxRankSdm or maxRankSdmDCI-0-2 are defining the maximum number of layers applied over the first and the second SRS resource sets, separately. \n-\tWhen codepoint \"00\" or \"01\" of SRS Resource Set indicator is indicated, the second SRI and second TPMI are reserved, the first TPMI is used to indicate the precoder to be applied over layers {0\u2026v-1}, where v \u2264 maxRank, where maxRank is defining the maximum number of layers. \n-\tCodepoint \"11\" of SRS Resource Set indicator is reserved. \n-\tFor one or two TPMI(s), the transmission precoder is selected from the uplink codebook that has a number of antenna ports equal to the higher layer parameter nrofSRS-Ports in SRS-Config for the indicated SRI(s), as defined in Clause 6.3.1.5 of [4, TS 38.211]. When two TPMIs are indicated, the UE shall expect that the precoder indicated by the first TPMI and the precoder indicated by the second TPMI are mapped to different PUSCH antenna ports.\n-\tWhen two SRIs are indicated, the UE shall expect that the number of SRS antenna ports associated with two indicated SRIs would be the same. When the UE is configured with the higher layer parameter txConfig set to 'codebook', the UE is configured with at least one SRS resource. Each of the indicated one or two SRI(s) in slot n is associated with the most recent transmission of SRS resource of associated SRS resource set identified by the SRI, where the SRS resource is prior to the PDCCH carrying the SRI. When two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook', the UE is not expected to be configured with different number of SRS resources in the two SRS resource sets.\nWhen higher layer parameter multipanelScheme set to 'SFNscheme' and two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook', two SRI(s), and two TPMI(s) are given by the DCI fields of two SRS resource indicator and two Precoding information and number of layers in clause 7.3.1.1.2 and 7.3.1.1.3 of [5, TS 38.212] for DCI format 0_1 and 0_2 or given by srs-ResourceIndicator, srs-ResourceIndicator2, precodingAndNumberOfLayers, and precodingAndNumberOfLayers2 in configuredGrantConfig: \n-\tWhen  codepoint \"10\" of SRS Resource Set indicator is indicated or when srs-ResourceIndicator2 and precodingAndNumberOfLayers2 are provided, the first TPMI is used to indicate precoder to be applied over layers {0\u2026v-1} and the second TPMI is used to indicate the precoder to be applied over layers {0\u2026v-1}, where  v \u2264 maxRankSfn or maxRankSfnDCI-0-2 and maxRankSfn or maxRankSfnDCI-0-2 defining the maximum number of layers applied over the first SRS resource set and over the second SRS resource set separately. \n-\tWhen codepoint \"00\" or \"01\" of SRS Resource Set indicator is indicated, the second SRI and second TPMI are reserved, the first TPMI is used to indicate precoder to be applied over layers {0\u2026v-1}, where v \u2264 maxRank and where maxRank is defining the maximum number of layers applied over the first SRS resource set or the seoncd SRS resource. \n-\tCodepoint \"11\" of SRS Resource Set indicator is reserved. \n-\tFor one or two TPMI(s), the transmission precoder is selected from the uplink codebook that has a number of antenna ports equal to nrofSRS-Ports in SRS-Config for the indicated SRI(s), as defined in Clause 6.3.1.5 of [4, TS 38.211]. When two TPMIs are indicated, the UE shall expect that the precoder indicated by the first TPMI and the precoder indicated by the second TPMI are mapped to different PUSCH antenna ports.\n-\tWhen two TPMIs are indicated, the UE shall expect that the number of SRS antenna ports associated with two indicated SRIs to be the same. When the UE is configured with the higher layer parameter txConfig set to 'codebook', the UE is configured with at least one SRS resource. Each of the indicated one or two SRI(s) in slot n is associated with the most recent transmission of SRS resource of associated SRS resource set identified by the SRI, where the SRS resource is prior to the PDCCH carrying the SRI. When two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook', the UE is not expected to be configured with different number of SRS resources in the two SRS resource sets.\nWhen the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the purpose of determining the most recent transmission of SRS resource identified by the SRI, the PDCCH candidate that starts earlier in time is used.\nFor codebook based transmission with two or four antenna ports, the UE determines its codebook subsets based on TPMI(s) and upon the reception of higher layer parameter codebookSubset in pusch-Config for PUSCH associated with DCI format 0_1 or 0_3 and codebookSubsetDCI-0-2 in pusch-Config for PUSCH associated with DCI format 0_2 which may be configured with 'fullyAndPartialAndNonCoherent', or 'partialAndNonCoherent', or 'nonCoherent' depending on the UE capability for two or four antenna ports. \nFor codebook based transmission with eight antenna ports, the UE determines its codebook based upon the reception of higher layer parameter[s] CodebookTypeUL in pusch-Config for PUSCH associated with DCI format 0_1 and 0_2, depending on the UE capability. According to the configured CodebookTypeUL, coherent UL MIMO operation applies within antenna port groups as defined in Table 6.3.1.5-8 of [4, TS 38.211].\nWhen higher layer parameter ul-FullPowerTransmission is set to 'fullpowerMode2' and the higher layer parameter codebookSubset or the higher layer parameter codebookSubsetDCI-0-2 is set to 'partialAndNonCoherent', and when the SRS-resourceSet with usage set to \"codebook\" includes at least one SRS resource with 4 ports and one SRS resource with 2 ports, the codebookSubset associated with the 2-port SRS resource is 'nonCoherent'. \nWhen higher layer parameter ul-FullPowerTransmission is set to 'fullpowerMode2' and the higher layer parameter CodebookTypeUL is set to 'Codebook2' or 'Codebook3', and the SRS-resourceSet with usage set to 'codebook' includes one SRS resource with 8 ports, and at least one SRS resource with 2 ports or 4 ports, subject to UE capability,\n-\twhen CodebookTypeUL is set to 'Codebook2', the codebookSubset associated with the 2-port SRS resource is 'nonCoherent'.\n-\twhen CodebookTypeUL is set to 'Codebook2', the codebookSubset associated with the 4-port SRS resource can be configured as 'partialAndNonCoherent' or 'nonCoherent', subject to UE capability.\n-\twhen CodebookTypeUL is set to 'Codebook3', the codebookSubset associated with 4 ports SRS resources is 'nonCoherent'.\nThe maximum transmission rank may be configured by the higher layer parameter maxRank or maxRank-n8 in pusch-Config for PUSCH scheduled with DCI format 0_1 or 0_3 and maxRankDCI-0-2 for PUSCH scheduled with DCI format 0_2.\nA UE reporting its UE capability of 'partialAndNonCoherent' transmission shall not expect to be configured by either codebookSubset or codebookSubsetDCI-0-2 with 'fullyAndPartialAndNonCoherent' for two or four antenna ports. \nA UE reporting its UE capability of 'nonCoherent' transmission shall not expect to be configured by either codebookSubset or codebookSubsetDCI-0-2 with 'fullyAndPartialAndNonCoherent' or with 'partialAndNonCoherent' for two or four antenna ports.\nA UE does not expect to be configured by CodebookTypeUL with a value of CodebookTypeUL that does not correspond to one of the values of UL_8TX_Ng reported in its capability. A UE can be configured by ULcodebookFC-N1N2 subject to UE capability, when higher layer parameter CodebookTypeUL is set to 'Codebook1' corresponding to Ng=1, where Ng represents the number of antenna port groups. \nA UE shall not expect to be configured with the higher layer parameter codebookSubset or the higher layer parameter codebookSubsetDCI-0-2 set to 'partialAndNonCoherent' when higher layer parameter nrofSRS-Ports in an SRS-ResourceSet with usage set to 'codebook' indicates that the maximum number of the configured SRS antenna ports in the SRS-ResourceSet is two.\nFor codebook based transmission, only one SRS resource can be indicated based on the SRI from within the SRS resource set. Except when higher layer parameter ul-FullPowerTransmission is set to 'fullpowerMode2', the maximum number of configured SRS resources for codebook based transmission is 2. If aperiodic SRS is configured for a UE, the SRS request field in DCI triggers the transmission of aperiodic SRS resources. \nA UE shall not expect to be configured with higher layer parameter ul-FullPowerTransmission set to 'fullpowerMode1' and codebookSubset or codebookSubsetDCI-0-2 set to 'fullAndPartialAndNonCoherent' simultaneously.\nA UE shall not expect to be configured with higher layer parameter ul-FullPowerTransmission set to 'fullpowerMode1' and CodebookTypeUL set to 'Codebook1' simultaneously.\nThe UE shall transmit PUSCH using the same antenna port(s) as the SRS port(s) in the SRS resource(s) indicated by the DCI format 0_1, 0_2 or 0_3 or by configuredGrantConfig according to clause 6.1.2.3.\nThe DM-RS antenna ports  in Clause 6.4.1.1.3 of [4, TS38.211] are determined according to the ordering of DM-RS port(s) given by Tables 7.3.1.1.2-6 to 7.3.1.1.2-23 in Clause 7.3.1.1.2 of [5, TS 38.212].\nExcept when higher layer parameter ul-FullPowerTransmission is set to 'fullpowerMode2', when multiple SRS resources are configured by SRS-ResourceSet with usage set to 'codebook', the UE shall expect that higher layer parameters nrofSRS-Ports in SRS-Resource in SRS-ResourceSet shall be configured with the same value for all these SRS resources.\nWhen higher layer parameter ul-FullPowerTransmission is set to 'fullpowerMode2', \n-\tthe UE can be configured with one SRS resource or multiple SRS resources with same or different number of SRS ports within an SRS resource set with usage set to 'codebook'.\n-\tup to 2 different spatial relations can be configured for all SRS resources in the SRS resource set with usage set to 'codebook' when multiple SRS resources are configured in the SRS resource set. \n-\tsubject to UE capability, a maximum of 2 or 4 SRS resources are supported in an SRS resource set with usage set to 'codebook'.\n6.1.1.2\tNon-Codebook based UL transmission\nFor non-codebook based transmission, PUSCH can be scheduled by DCI format 0_0, DCI format 0_1, DCI format 0_2, DCI format 0_3 or semi-statically configured to operate according to Clause 6.1.2.3. If this PUSCH is scheduled by DCI format 0_1, DCI format 0_2, DCI format 0_3 or semi-statically configured to operate according to Clause 6.1.2.3, the UE can determine its PUSCH precoder(s) and transmission rank based on the SRI(s) when multiple SRS resources are configured, where the SRI(s) is given by one or two SRS resource indicator(s) in DCI according to clause 7.3.1.1.2 and 7.3.1.1.3 of [5, 38.212] for DCI format 0_1 and DCI format 0_2, or the SRI is given by one SRS resource indicator in DCI according to clause 7.3.1.1.4 of [5, 38.212] for DCI format 0_3, or the SRI is given by srs-ResourceIndicator according to clause 6.1.2.3, or SRIs given by srs-ResourceIndicator and srs-ResourceIndicator2 according to clause 6.1.2.3.. The SRS-ResourceSet(s) applicable for PUSCH scheduled by DCI format 0_1 and DCI format 0_2 are defined by the entries of the higher layer parameter srs-ResourceSetToAddModList and srs-ResourceSetToAddModListDCI-0-2 in SRS-config, respectively. The UE shall use one or multiple SRS resources for SRS transmission, where, in a SRS resource set, the maximum number of SRS resources which can be configured to the UE for simultaneous transmission in the same symbol and the maximum number of SRS resources are UE capabilities. The SRS resources transmitted simultaneously occupy the same RBs. For a given CC, multiple SRS resources in a set with usage \u201cnonCodebook\u201d are not expected to be partially overlapped in time. Only one SRS port for each SRS resource is configured. Only one or two SRS resource sets can be configured in srs-ResourceSetToAddModList with higher layer parameter usage in SRS-ResourceSet set to 'nonCodebook', and only one or two SRS resource sets can be configured in srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'nonCodebook'. When two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'nonCodebook', SRIs are given by the DCI fields of two SRS resource indicators in clauses 7.3.1.1.2 and 7.3.1.1.3 of [5, TS 38.212] for DCI format 0_1 and 0_2 and the UE applies the indicated SRI(s) to one or more PUSCH repetitions according to the associated SRS resource set of a PUSCH repetition according to clause 6.1.2.1. When two SRS resource sets are configured in srs-ResourceSetToAddModList with higher layer parameter usage in SRS-ResourceSet set to 'nonCodebook', SRI is given by the DCI field of one SRS resource indicator in clause 7.3.1.1.4 of [5, TS 38.212] for DCI format 0_3 and the UE applies the indicated SRI to one or more PUSCH repetitions according to the first SRS resource set. The maximum number of SRS resources per SRS resource set that can be configured for non-codebook based uplink transmission is 1, 2, 4 or 8 depending on UE capability. Each of the indicated SRIs in slot n is associated with the most recent transmission of SRS resource(s) of associated SRS resource set identified by the SRI, where the SRS transmission is prior to the PDCCH carrying the SRI. When two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'nonCodebook', the UE is not expected to be configured with different number of SRS resources in the two SRS resource sets.  \nWhen the higher layer parameter multipanelScheme is set to 'SDMScheme' and two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'nonCodebook', SRIs are given by the DCI fields of two SRS resource indicators in clause 7.3.1.1.2 and 7.3.1.1.3 of [5, TS 38.212] for DCI format 0_1 and 0_2 or given by srs-ResourceIndicator, srs-ResourceIndicator2 in configuredGrantConfig: \n-\tWhen codepoint \"10\" of SRS Resource Set indicator is indicated, or when srs-ResourceIndicator2 is provided, the first SRI is used to indicate resource(s) to be associated with layer(s) {0\u2026v1-1}, where v1 being the number of layers indicated by the first SRI, and the second SRI is used to indicate resource(s) to be associated with layer(s) {v1\u2026. v2+v1-1}, where v2 being the number of layers indicated by the second SRI, v1 \u2264 Lmax and v2 \u2264 Lmax where Lmax is defined in clauses 7.3.1.1.2 and 7.3.1.1.3 of [5, TS 38.212]. The UE shall expect that SRS resource(s) indicated by the first SRI and SRS resource(s) indicated by the second SRI are corresponding to different PUSCH antenna ports.\n-\tWhen codepoint \"00\" or \"01\" of SRS Resource Set indicator is indicated, the second SRI is reserved, the first SRI is used to indicate resource(s) to be associated with layers {0\u2026v-1}, v \u2264 Lmax. \n-\tCodepoint \"11\" of SRS Resource Set indicator is reserved. \nWhen the higher layer parameter multipanelScheme is set to 'SFNscheme' and two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'nonCodebook', two SRI(s) are given by the DCI fields of two SRS resource indicators in clause 7.3.1.1.2 and 7.3.1.1.3 of [5, TS 38.212] for DCI format 0_1 and 0_2 or given by srs-ResourceIndicator and srs-ResourceIndicator2 in configuredGrantConfig: \n-\tWhen codepoint \"10\" of SRS Resource Set indicator is indicated, or when srs-ResourceIndicator2 is provided, the first SRI is used to indicate resource(s) to be associated with layer(s) {0\u2026v-1} and the second SRI is used to indicate resource(s) to be associated with  layer(s) {0\u2026v-1}, where  v \u2264 Lmax and where Lmax is defined in clauses 7.3.1.1.2 and 7.3.1.1.3 of [5, TS 38.212]. The UE shall expect that SRS resource(s) indicated by the first SRI and SRS resource(s) indicated by the second SRI are corresponding to different PUSCH antenna ports.\n-\tWhen codepoint \"00\" or \"01\" of SRS Resource Set indicator is indicated, the second SRI is reserved, the first SRI is used to indicate resources(s) to be associated with layers {0\u2026v-1}, where v \u2264 Lmax. When two SRIs are indicated, the UE shall expect that the number of SRS antenna ports associated with two indicated SRIs to be the same. \n-\tCodepoint \"11\" of SRS Resource Set indicator is reserved. \nWhen the UE is configured with the higher layer parameter txConfig set to 'Noncodebook', the UE is configured with at least one SRS resource. Each of the indicated one or two SRI(s) in slot n is associated with the most recent transmission of SRS resource of associated SRS resource set identified by the SRI, where the SRS resource is prior to the PDCCH carrying the SRI. When two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'Noncodebook', the UE is not expected to be configured with different number of SRS resources in the two SRS resource sets.\nWhen the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the purpose of determining the most recent transmission of SRS resource(s) identified by the SRI, the PDCCH candidate that starts earlier in time is used.\nFor non-codebook based transmission, the UE can calculate the precoder used for the transmission of SRS based on measurement of an associated NZP CSI-RS resource. A UE can be configured with only one NZP CSI-RS resource for each of the SRS resource set(s) with higher layer parameter usage in SRS-ResourceSet set to 'nonCodebook' if configured.\n-\tIf aperiodic SRS resource set is configured, the associated NZP-CSI-RS is indicated via SRS request field in DCI format 0_1 and 1_1, DCI format 0_2 (if SRS request field is present) and DCI format 1_2 (if SRS request field is present), as well as DCI format 0_3 and 1_3, where AperiodicSRS-ResourceTrigger and AperiodicSRS-ResourceTriggerList (indicating the association between aperiodic SRS triggering state(s) and SRS resource sets), triggered SRS resource(s) srs-ResourceSetId, csi-RS (indicating the associated NZP-CSI-RS-ResourceId) are higher layer configured in SRS-ResourceSet. The SRS-ResourceSet(s) associated with the SRS request by DCI format 0_1, 0_3, 1_1 and 1_3 are defined by the entries of the higher layer parameter srs-ResourceSetToAddModList and the SRS-ResourceSet(s) associated with the SRS request by DCI format 0_2 and 1_2 are defined by the entries of the higher layer parameter srs-ResourceSetToAddModListDCI-0-2. A UE is not expected to update the SRS precoding information if the gap from the last symbol of the reception of the aperiodic NZP-CSI-RS resource and the first symbol of the aperiodic SRS transmission is less than 42 OFDM symbols, where the SCS configuration \u03bc is the smallest SCS configuration between the NZP-CSI-RS resource and the SRS transmission. \n-\tIf the UE configured with aperiodic SRS associated with aperiodic NZP CSI-RS resource, the presence of the associated CSI-RS is indicated by the SRS request field if the value of the SRS request field is not '00' as in Table 7.3.1.1.2-24 of [5, TS 38.212] and if the scheduling DCI is not used for cross carrier or cross bandwidth part scheduling. If UE is configured with minimumSchedulingOffsetK0 in the active DL BWP and the currently applicable minimum scheduling offset restriction K0,min is larger than 0, the UE does not expected to receive the scheduling DCI with the SRS request field value other than '00'. The CSI-RS is located in the same slot as the SRS request field. If the UE configured with aperiodic SRS associated with aperiodic NZP CSI-RS resource, any of the TCI states configured in the scheduled CC shall not be configured with qcl-Type set to 'typeD'.\n-\tIf periodic or semi-persistent SRS resource set is configured, the NZP-CSI-RS-ResourceId for measurement is indicated via higher layer parameter associatedCSI-RS in SRS-ResourceSet.\nThe UE shall perform one-to-one mapping from the indicated SRI(s) to the indicated DM-RS ports(s) and their corresponding PUSCH layers {0 \u2026 \u03bd-1} given by DCI format 0_1, 0_2 or 0_3 or by configuredGrantConfig according to clause 6.1.2.3 in increasing order.\nThe UE shall transmit PUSCH using the same antenna ports as the SRS port(s) in the SRS resource(s) indicated by SRI(s) given by DCI format 0_1 or 0_2 or by configuredGrantConfig according to clause 6.1.2.3, where the SRS port in (i+1)-th SRS resource in the SRS resource set is indexed as . \nThe DM-RS antenna ports  in Clause 6.4.1.1.3 of [4, TS 38.211] are determined according to the ordering of DM-RS port(s) given by Tables 7.3.1.1.2-6 to 7.3.1.1.2-23 in Clause 7.3.1.1.2 of [5, TS 38.212].\nFor non-codebook based transmission, the UE does not expect to be configured with both spatialRelationInfo for SRS resource and associatedCSI-RS in SRS-ResourceSet for SRS resource set.\nFor non-codebook based transmission, the UE can be scheduled with DCI format 0_1 or 0_2 when at least one SRS resource is configured in SRS-ResourceSet with usage set to 'nonCodebook'.\n6.1.2\tResource allocation \n6.1.2.1\tResource allocation in time domain\nWhen the UE is scheduled to transmit a transport block and no CSI report by a DCI or by a RAR UL grant or fallbackRAR UL grant, or the UE is scheduled to transmit a transport block and a CSI report(s) on PUSCH by a DCI, the 'Time domain resource assignment' field value m for the scheduled PUSCH on the serving cell of the DCI or the PUSCH time resource allocation field value m of the RAR UL grant or of the fallbackRAR UL grant provides a row index m + 1 to a resource allocation table. The determination of the used resource allocation table is defined in Clause 6.1.2.1.1. The indexed row defines the slot offset K2, the start and length indicator SLIV, or directly the start symbol S and the allocation length L, the PUSCH mapping type, the number of slots used for TBS determination (if numberOfSlotsTBoMS is present in the resource allocation table), and the number of repetitions (if numberOfRepetitions is present in the resource allocation table) to be applied in the PUSCH transmission.\nWhen the UE is scheduled to transmit a PUSCH with no transport block and with a CSI report(s) by a 'CSI request' field on a DCI, the 'Time domain resource assignment' field value m of the DCI provides a row index m + 1 to the allocated table as defined in Clause 6.1.2.1.1. The indexed row defines the start and length indicator SLIV, or directly the start symbol S and the allocation length L, and the PUSCH mapping type to be applied in the PUSCH transmission and the K2 value is determined as , where  are the corresponding list entries of the higher layer parameter\n-\treportSlotOffsetListDCI-0-2 or reportSlotOffsetListDCI-0-2-r17, if PUSCH is scheduled by DCI format 0_2 and reportSlotOffsetListDCI-0-2 or reportSlotOffsetListDCI-0-2-r17 is configured;\n-\treportSlotOffsetListDCI-0-1 or reportSlotOffsetListDCI-0-1-r17, if PUSCH is scheduled by DCI format 0_1 or 0_3 and reportSlotOffsetListDCI-0-1 or reportSlotOffsetListDCI-0-1-r17 is configured;\n-\treportSlotOffsetList or reportSlotOffsetList-r17, otherwise;\nin CSI-ReportConfig for the  triggered CSI Reporting Settings and  is the (m+1)th entry of  including the omitted CSI Reporting Settings triggered for non-active DL BWPs, where the UE does not expect that (m+1) is larger than 16.\n-\tThe slot Ks where the UE shall transmit the PUSCH is determined by K2 as Ks =, if UE is configured with ca-SlotOffset for at least one of the scheduled and scheduling cell, , otherwise, where  is a parameter configured by higher layer as specified in clause 4.2 of [6 TS 38.213], and where is the subcarrier spacing configuration for  with a value of 0 for frequency range 1, n is the slot with the scheduling DCI, K2 is based on the numerology of PUSCH,  and  are the subcarrier spacing configurations for PUSCH and PDCCH, respectively, and the scheduling DCI is other than DCI format 0_0 with CRC scrambled by TC-RNTI.\n-\t and are the and the, respectively, which are determined by higher-layer configured ca-SlotOffset for the cell receiving the PDCCH,\u00a0and are the  and the,respectively, which are determined by higher-layer configured ca-SlotOffset for the cell transmitting the PUSCH, as defined in clause 4.5 of [4, TS 38.211], and\n-\tfor PUSCH scheduled by DCI format 0_1, if pusch-RepTypeIndicatorDCI-0-1  is set to 'pusch-RepTypeB', the UE applies PUSCH repetition Type B procedure when determining the time domain resource allocation. For PUSCH scheduled by DCI format 0_2, if pusch-RepTypeIndicatorDCI-0-2 is set to 'pusch-RepTypeB', the UE applies PUSCH repetition Type B procedure when determining the time domain resource allocation. Otherwise, the UE applies PUSCH repetition Type A procedure when determining the time domain resource allocation for PUSCH scheduled by PDCCH, by RAR UL grant, or by fallbackRAR UL grant.\n-\tfor PUSCH scheduled by DCI format 0_1, 0_2 or 0_3, if numberOfSlotsTBoMS is present and larger than 1, the UE applies TB processing over multiple slots procedure when determining the time domain resource allocation.\n-\tFor PUSCH repetition Type A and TB processing over multiple slots, the starting symbol S relative to the start of the slot, and the number of consecutive symbols L counting from the symbol S allocated for the PUSCH are determined from the start and length indicator SLIV of the indexed row:\nif  then\n\nelse \n\nwhere, and\n-\tFor PUSCH repetition Type B, the starting symbol S relative to the start of the slot, and the number of consecutive symbols L counting from the symbol S allocated for the PUSCH are provided by startSymbol and length of the indexed row of the resource allocation table, respectively.\n-\tFor PUSCH repetition Type A and TB processing over multiple slots, the PUSCH mapping type is set to Type A or Type B as defined in Clause 6.4.1.1.3 of [4, TS 38.211] as given by the indexed row. \n-\tFor PUSCH repetition Type B, the PUSCH mapping type is set to Type B.\nThe UE shall consider the S and L combinations defined in table 6.1.2.1-1 as valid PUSCH allocations\nTable 6.1.2.1-1: Valid S and L combinations\n\nFor TB processing over multiple slots, when transmitting PUSCH scheduled by DCI format 0_1, 0_2 or 0_3 in PDCCH with CRC scrambled with C-RNTI, MCS-C-RNTI, or CS-RNTI with NDI=1,\n-\tthe number of slots used for TBS determination N is indicated by numberOfSlotsTBoMS.\n-\tthe number of repetitions K of the number of slots N used for TBS determination is determined as \n-\tif numberOfRepetitions is present in the resource allocation table, the number of repetitions K is equal to numberOfRepetitions;\n-\totherwise, K=1.\n-\twhen the UE supports repetition of TB processing over multiple slots, the UE does not expect that  is larger than 32.\nWhen configured with m= 5 or 6 the UE does not expect to be scheduled with more than one PUSCH in a slot, by a single DCI or multiple DCIs, where multiple DCIs are not associated with CORESETs having different coresetpoolIndex.\nFor PUSCH repetition Type A, when transmitting PUSCH scheduled by DCI format 0_1, 0_2 or 0_3 in PDCCH with CRC scrambled with C-RNTI, MCS-C-RNTI, or scheduled by DCI format 0_1 or 0_2 in PDCCH with CRC scrambled CS-RNTI with NDI=1, the number of repetitions K is determined as\n-\tif numberOfRepetitions is present in the resource allocation table, the number of repetitions K is equal to numberOfRepetitions;\n-\telseif the UE is configured with pusch-AggregationFactor, the number of repetitions K is equal to pusch-AggregationFactor; \n-\totherwise K=1.\n-\tthe number of slots used for TBS determination N is equal to 1.\nFor PUSCH repetition type A, when transmitting PUSCH scheduled by RAR UL grant, the 2 MSBs of the MCS information field of the RAR UL grant provide a codepoint to determine the number of repetitions K according to Table 6.1.2.1-1A, based on whether or not the higher layer parameter numberOfMsg3-RepetitionsList is configured. The number of slots used for TBS determination N is equal to 1.\nFor PUSCH repetition type A, when transmitting PUSCH scheduled by DCI format 0_0 with CRC scrambled by TC-RNTI, the 2 MSBs of the MCS information field of the DCI format 0_0 with CRC scrambled by TC-RNTI provide a codepoint to determine the number of repetitions K according to Table 6.1.2.1-1A, based on whether or not the higher layer parameter numberOfMsg3-RepetitionsList is configured. The number of slots used for TBS determination N is equal to 1.\nTable 6.1.2.1-1A: Number of repetition K as a function of 2 MSBs of MCS information field\nIf a UE is configured with higher layer parameter pusch-TimeDomainAllocationListForMultiPUSCH, the UE does not expect to be configured with pusch-AggregationFactor.\nIf a UE is configured with extendedK2 in pusch-TimeDomainAllocationListForMultiPUSCH in which one or more rows contain multiple SLIVs for PUSCH on a UL BWP of a serving cell, the UE does not apply pusch-AggregationFactor, if configured, to DCI format 0_1 on the UL BWP of the serving cell and the UE does not expect to be configured with numberOfRepetitions in pusch-TimeDomainAllocationListForMultiPUSCH.\nIf a UE is configured with extendedK2 in pusch-TimeDomainAllocationListForMultiPUSCH in which one or more rows contain multiple SLIVs for PUSCH on a UL BWP of a serving cell, when any two UL DCIs end in the same symbol and at least one of the DCIs scheduling multiple PUSCHs, the UE does not expect that the any scheduled multiple PUSCHs have overlapping spans, where the span associated with a DCI is defined from the beginning of the first scheduled PUSCH till the end of the last scheduled PUSCH.\nFor unpaired spectrum:\n-\tWhen AvailableSlotCounting is enabled, and in case K>1, the UE determines  slots for a PUSCH transmission of a PUSCH repetition type A scheduled by DCI format 0_1, 0_2 or 0_3, based on tdd-UL-DL-ConfigurationCommon, tdd-UL-DL-ConfigurationDedicated and ssb-PositionsInBurst, and the TDRA information field value in the DCI format 0_1, 0_2 or 0_3.\n-\tA slot is not counted in the number of  slots for PUSCH transmission of a PUSCH repetition Type A scheduled by DCI format 0_1, 0_2 or 0_3 if at least one of the symbols indicated by the indexed row of the used resource allocation table in the slot overlaps with a DL symbol indicated by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated if provided, or a symbol of an SS/PBCH block with index provided by ssb-PositionsInBurst.\n-\tOtherwise, the UE determines  consecutive slots for a PUSCH transmission of a PUSCH repetition type A scheduled by DCI format 0_1, 0_2 or 0_3, based on the TDRA information field value in the DCI format 0_1, 0_2 or 0_3.\n-\tThe UE determines  slots for a PUSCH transmission of TB processing over multiple slots scheduled by DCI format 0_1, 0_2 or 0_3, based on tdd-UL-DL-ConfigurationCommon, tdd-UL-DL-ConfigurationDedicated and ssb-PositionsInBurst, and the TDRA information field value in the DCI format 0_1, 0_2 or 0_3.\n-\tA slot is not counted in the number of  slots for a PUSCH transmission of TB processing over multiple slots if at least one of the symbols indicated by the indexed row of the used resource allocation table in the slot overlaps with a DL symbol indicated by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated if provided, or a symbol of an SS/PBCH block with index provided by ssb-PositionsInBurst.\n-\tThe UE determines  slots for a PUSCH transmission of a PUSCH repetition Type A scheduled by RAR UL grant, based on tdd-UL-DL-ConfigurationCommon and ssb-PositionsInBurst, and\u00a0the TDRA information field value in the RAR UL grant. \n-\tA slot is not counted in the number of  slots for a PUSCH transmission of a PUSCH repetition Type A scheduled by RAR UL grant, if at least one of the symbols indicated by the indexed row of the used resource allocation table in the slot overlaps with a DL symbol indicated by tdd-UL-DL-ConfigurationCommon if provided, or a symbol of an SS/PBCH block with index provided by ssb-PositionsInBurst.\n-\tThe UE determines  slots for a PUSCH transmission of a PUSCH repetition Type A scheduled by DCI format 0_0 with CRC scrambled by TC-RNTI, based on tdd-UL-DL-ConfigurationCommon and ssb-PositionsInBurst and\u00a0the TDRA information field value in the DCI scheduling the PUSCH.\n-\tA slot is not counted in the number of  slots for a PUSCH transmission of a PUSCH repetition Type A scheduled by DCI format 0_0 scrambled by TC-RNTI, if at least one of the symbols indicated by the indexed row of the used resource allocation table in the slot overlaps with a DL symbol indicated by tdd-UL-DL-ConfigurationCommon if provided, or a symbol of an SS/PBCH block with index provided by ssb-PositionsInBurst.\nFor paired spectrum and SUL band:\n-\tThe UE determines  consecutive slots for a PUSCH transmission of a PUSCH repetition type A scheduled by DCI format 0_1 or 0_2, or 0_3 for paired spectrum only, or for a PUSCH transmission of TB processing over multiple slots scheduled by DCI format 0_1 or 0_2, or 0_3 for paired spectrum only, based on the TDRA information field value in the DCI format 0_1, 0_2 or 0_3.\n-\tFor the case of a reduced capability half-duplex UE, the UE determines  slots for a PUSCH transmission of a PUSCH repetition type A scheduled by DCI format 0_1, 0_2 or 0_3 when AvailableSlotCounting is enabled and K>1, or for a PUSCH transmission of TB processing over multiple slots scheduled by DCI format 0_1,  0_2 or 0_3, based on the TDRA information field value in the DCI format 0_1, 0_2 or 0_3. A slot is not counted in the number of  slots if at least one of the symbols indicated by the indexed row of the used resource allocation table in the slot does not start or end at least  or , respectively, from the last or first symbol of an SS/PBCH block with index provided by ssb-PositionsInBurst.\n-\tThe UE determines  consecutive slots for a PUSCH transmission of a PUSCH repetition Type A scheduled by RAR UL grant, based on the TDRA information field value in the RAR UL grant. \n-\tThe UE determines  consecutive slots for a PUSCH transmission of a PUSCH repetition Type A scheduled by DCI format 0_0 with CRC scrambled by TC-RNTI, based on the TDRA information field value in the DCI scheduling the PUSCH. \nIf a UE would transmit a PUSCH of PUSCH repetition Type A when AvailableSlotCounting is enabled and K>1 or a TB processing over multiple slots over  slots, and the UE does not transmit the PUSCH of a TB processing over multiple slots or the PUSCH repetition Type A in a slot from the  slots, according to Clause 9, Clause 11.1, Clause 11.2A, Clause 15 and Clause 17.2 of [6, TS 38.213], the UE counts the slots in the number of  slots.\nFor PUSCH repetition Type A, in case K>1, \n-\tIf the PUSCH is scheduled by DCI format 0_1, 0_2 or 0_3\n-\tif AvailableSlotCounting is enabled, the same symbol allocation is applied across the  slots determined for the PUSCH transmission and the PUSCH is limited to a single transmission layer. The UE shall repeat the TB across the  slots determined for the PUSCH transmission, applying the same symbol allocation in each slot.\n-\tOtherwise, the same symbol allocation is applied across the  consecutive slots and the PUSCH is limited to a single transmission layer. The UE shall repeat the TB across the  consecutive slots applying the same symbol allocation in each slot. \n-\tElse if the PUSCH is scheduled by RAR UL grant or by DCI format 0_0 with CRC scrambled by TC-RNTI, the same symbol allocation is applied across the  slots determined for the PUSCH transmission and the PUSCH is limited to a single transmission layer. The UE shall repeat the TB across the  slots determined for the PUSCH transmission, applying the same symbol allocation in each slot.\nFor PUSCH repetition Type B:\n-\tIf pusch-DMRS-Bundling is enabled, the PUSCH is limited to a single transmission layer.\nFor TB processing over multiple slots:\n-\tFor unpaired spectrum, the same symbol allocation is applied across the  slots determined for the PUSCH transmission and the PUSCH is limited to a single transmission layer. The UE shall transmit the TB across the  slots determined for the PUSCH transmission, applying the same symbol allocation in each slot. \n-\tFor paired spectrum or supplementary uplink band, the same symbol allocation is applied across the  consecutive slots and the PUSCH is limited to a single transmission layer. The UE shall transmit the TB across the  consecutive slots applying the same symbol allocation in each slot.\n-\tFor the case of reduced capability half-duplex UE, the same symbol allocation is applied across the  slots determined for the PUSCH transmission and the PUSCH is limited to a single transmission layer. The UE shall transmit the TB across the  slots determined for the PUSCH transmission, applying the same symbol allocation in each slot.\nFor a PUSCH transmission scheduled by DCI format 0_1, 0_2 or 0_3, or 0_0 with CRC scrambled by TC-RNTI, the redundancy version to be applied on the nth transmission occasion of the TB, where n = 0, 1, \u2026  -1, is determined according to table 6.1.2.1-2. \nFor a PUSCH transmission of a PUSCH repetition Type A scheduled by RAR UL grant, the redundancy version to be applied on the nth transmission occasion of the TB, where n = 0, 1, \u2026  -1, is determined according to the first row of Table 6.1.2.1-2. \nTable 6.1.2.1-2: Redundancy version for PUSCH transmission\n\nWhen transmitting MsgA PUSCH on a non-initial UL BWP, if the UE is configured with startSymbolAndLengthMsgA-PO, the UE shall determine the S and L from startSymbolAndLengthMsgA-PO.\nWhen transmitting MsgA PUSCH, if the UE is not configured with startSymbolAndLengthMsgA-PO, and if the TDRA list PUSCH-TimeDomainResourceAllocationList is provided in PUSCH-ConfigCommon, the UE shall use msgA-PUSCH-TimeDomainAllocation to indicate which values are used in the list. If PUSCH-TimeDomainResourceAllocationList is not provided in PUSCH-ConfigCommon, the UE shall use parameters S and L from table 6.1.2.1.1-2 or table 6.1.2.1.1-3 where msgA-PUSCH-TimeDomainAllocation indicates which values are used in the list. The time offset for PUSCH transmission is described in [6, TS 38.213].\nFor PUSCH repetition Type A and TB processing over multiple slots, a PUSCH transmission in a slot of a multi-slot PUSCH transmission is omitted according to the conditions in Clause 9, Clause 11.1, Clause 11.2A, Clause 15 and Clause 17.2 of [6, TS 38.213]. \nFor PUSCH repetition Type B, except for PUSCH transmitting CSI report(s) with no transport block, the number of nominal repetitions is given by numberOfRepetitions. For the n-th nominal repetition, n = 0, \u2026, numberOfRepetitions - 1,\n-\tThe slot where the nominal repetition starts is given by , and the starting symbol relative to the start of the slot is given by .\n-\tThe slot where the nominal repetition ends is given by , and the ending symbol relative to the start of the slot is given by .\nHere is the slot where the PUSCH transmission starts, and is the number of symbols per slot as defined in Clause 4.3.2 of [4, TS38.211].\nFor PUSCH repetition Type B, the UE determines invalid symbol(s) for PUSCH repetition Type B transmission as follows:\n-\tA symbol that is indicated as downlink by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated is considered as an invalid symbol for PUSCH repetition Type B transmission. \n-\tFor operation in unpaired spectrum, symbols indicated by ssb-PositionsInBurst in SIB1 or ssb-PositionsInBurst in ServingCellConfigCommon for reception of SS/PBCH blocks are considered as invalid symbols for PUSCH repetition Type B transmission.\n-\tFor a reduced capability half-duplex UE in paired spectrum, symbols that do not start or end at least  or , respectively, from the last or first symbol of an SS/PBCH block with index indicated by ssb-PositionsInBurst in SIB1 or by ssb-PositionsInBurst in ServingCellConfigCommon or by NonCellDefiningSSB, or by ssb-PositionsInBurst in SSB-MTC-AdditionalPCI associated to physical cell ID with active TCI states for PDCCH or PDSCH, or for a set of symbols of a slot corresponding to SS/PBCH blocks configured for L1 beam measurement/reporting for reception of SS/PBCH blocks are considered as invalid symbols for PUSCH repetition Type B transmission.\n-\tFor operation in unpaired spectrum, symbol(s) indicated by pdcch-ConfigSIB1 in MIB for a CORESET for Type0-PDCCH CSS set are considered as invalid symbol(s) for PUSCH repetition Type B transmission.\n-\tFor operation in unpaired spectrum, if numberOfInvalidSymbolsForDL-UL-Switching is configured, numberOfInvalidSymbolsForDL-UL-Switching symbol(s) after the last symbol that is indicated as downlink in each consecutive set of all symbols that are indicated as downlink by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated are considered as invalid symbol(s) for PUSCH repetition Type B transmission. The symbol(s) given by numberOfInvalidSymbolsForDL-UL-Switching are defined using the reference SCS configuration referenceSubcarrierSpacing provided in tdd-UL-DL-ConfigurationCommon.\n-\tFor operation with shared spectrum channel access with semi-static channel occupancy, symbols in an idle duration associated with a periodic channel occupancy as described in Clause 4.3.1.1 of [16, 37.213], or in an idle duration in a period associated with an initiated channel occupancy as described in Clause 4.3.2. of [16, TS 37.213] are considered as invalid symbol(s) for PUSCH repetition Type B transmission.\n-\tThe UE may be configured with the higher layer parameter invalidSymbolPattern, which provides a symbol level bitmap spanning one or two slots (higher layer parameter symbols given by invalidSymbolPattern). A bit value equal to 1 in the symbol level bitmap symbols indicates that the corresponding symbol is an invalid symbol for PUSCH repetition Type B transmission. The UE may be additionally configured with a time-domain pattern (higher layer parameter periodicityAndPattern given by invalidSymbolPattern), where each bit of periodicityAndPattern corresponds to a unit equal to a duration of the symbol level bitmap symbols, and a bit value equal to 1 indicates that the symbol level bitmap symbols is present in the unit. The periodicityAndPattern can be {1, 2, 4, 5, 8, 10, 20 or 40} units long, but maximum of 40 msec. The first symbol of periodicityAndPattern every 40 msec/P periods is a first symbol in frame \ud835\udc5b\ud835\udc53 mod 4 = 0, where P is the duration of periodicityAndPattern-r16 in units of msec. When periodicityAndPattern is not configured, for a symbol level bitmap spanning two slots, the bits of the first and second slots correspond respectively to even and odd slots of a radio frame, and for a symbol level bitmap spanning one slot, the bits of the slot correspond to every slot of a radio frame. If invalidSymbolPattern is configured, when the UE applies the invalid symbol pattern is determined as follows:\n-\tif the PUSCH is scheduled by DCI format 0_1, or corresponds to a Type 2 configured grant activated by DCI format 0_1, and if invalidSymbolPatternIndicatorDCI-0-1  is configured,\n-\tif invalid symbol pattern indicator field is set 1, the UE applies the invalid symbol pattern;\n-\totherwise, the UE does not apply the invalid symbol pattern;\n-\tif the PUSCH is scheduled by DCI format 0_2, or corresponds to a Type 2 configured grant activated by DCI format 0_2, and if invalidSymbolPatternIndicatorDCI-0-2  is configured,\n-\tif invalid symbol pattern indicator field is set 1, the UE applies the invalid symbol pattern;\n-\totherwise, the UE does not apply the invalid symbol pattern;\n-\totherwise, the UE applies the invalid symbol pattern. \n-\tIf the UE \n-\tis configured with multiple serving cells within a cell group and is provided with directionalCollisionHandling-r16 = 'enabled' for a set of serving cell(s) among the multiple serving cells, and\n-\tindicates support of half-DuplexTDD-CA-SameSCS-r16 capability, and\n-\tis not configured to monitor PDCCH for detection of DCI format 2-0 on any of the multiple serving cells, \n-\ta symbol indicated to the UE for reception of SS/PBCH blocks in a first cell of the multiple serving cells by ssb-PositionsInBurst in SIB1, or by ssb-PositionsInBurst in ServingCellConfigCommon, or by NonCellDefiningSSB, or by ssb-PositionsInBurst in SSB-MTC-AdditionalPCI associated to physical cell ID with active TCI states for PDCCH or PDSCH, or for a set of symbols of a slot corresponding to SS/PBCH blocks configured for L1 beam measurement/reporting is considered as an invalid symbol for PUSCH repetition Type B transmission in\n-\tany of the multiple serving cells if the UE is not capable of simultaneous transmission and reception as indicated by simultaneousRxTxInterBandCA among the multiple serving cells, and\n-\tany one of the cells corresponding to the same band as the first cell, irrespective of any capability indicated by simultaneousRxTxInterBandCA\nand\n-\ta symbol is considered as an invalid symbol in another cell among the set of serving  cell(s) provided with directionalCollisionHandling-r16 for PUSCH repetition Type B transmission with Type 1 or Type 2 configured grant except for the first Type 2 PUSCH transmission (including all repetitions) after activation if the symbol is indicated as downlink by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated on the reference cell as defined in Clause 11.1 of [6, TS 38.213], or the UE is configured by higher layers to receive PDCCH, PDSCH, or CSI-RS on the reference cell in the symbol.\nFor PUSCH repetition Type B, after determining the invalid symbol(s) for PUSCH repetition type B transmission for each of the K nominal repetitions, the remaining symbols are considered as potentially valid symbols for PUSCH repetition Type B transmission. If the number of potentially valid symbols for PUSCH repetition type B transmission is greater than zero for a nominal repetition, the nominal repetition consists of one or more actual repetitions, where each actual repetition consists of a consecutive set of all potentially valid symbols that can be used for PUSCH repetition Type B transmission within a slot. An actual repetition with a single symbol is omitted except for the case of L=1. An actual repetition is omitted according to the conditions in Clause 9, Clause 11.1, Clause 11.2A, Clause 15 and Clause 17.2 of [6, TS 38.213]. The UE shall repeat the TB across actual repetitions. The redundancy version to be applied on the nth actual repetition (with the counting including the actual repetitions that are omitted) is determined according to table 6.1.2.1-2, where N=1. \nFor PUSCH repetition Type B, when a UE receives a DCI that schedules aperiodic CSI report(s) or activates semi-persistent CSI report(s) on PUSCH with no transport block by a 'CSI request' field on a DCI, the number of nominal repetitions is always assumed to be 1, regardless of the value of numberOfRepetitions. When the UE is scheduled to transmit a PUSCH repetition Type B with no transport block and with aperiodic or semi-persistent CSI report(s) by a 'CSI request' field on a DCI, the first nominal repetition is expected to be the same as the first actual repetition. For PUSCH repetition Type B carrying semi-persistent CSI report(s) without a corresponding PDCCH after being activated on PUSCH by a 'CSI request' field on a DCI, if the first nominal repetition is not the same as the first actual repetition, the first nominal repetition is omitted; otherwise, the first nominal repetition is omitted according to the conditions in Clause 9, Clause 11.1, Clause 11.2A, Clause 15 and Clause 17.2 of [6, TS 38.213].\nFor PUSCH repetition Type B, when a UE is scheduled to transmit a transport block and aperiodic CSI report(s) on PUSCH by a 'CSI request' field on a DCI, the CSI report(s) is multiplexed only on the first actual repetition. The UE does not expect that the first actual repetition has a single symbol duration.\nFor pusch-TimeDomainAllocationListForMultiPUSCH in pusch-Config, if a row indicates resource allocation for two to eight contiguous PUSCHs and extendedK2 is not configured, K2 given by k2-r16 indicates the slot where UE shall transmit the first PUSCH of the multiple PUSCHs. Each PUSCH has a separate SLIV and mapping type. The number of scheduled PUSCHs is signalled by the number of indicated valid SLIVs in the row of the pusch-TimeDomainAllocationListForMultiPUSCH signalled in DCI format 0_1. \nFor pusch-TimeDomainAllocationListForMultiPUSCH in pusch-Config, if a row indicates resource allocation of more than one PUSCH and extendedK2 is configured, each PUSCH has a separate SLIV, mapping type and K2 given by extendedK2. If a row indicates resource allocation of a single PUSCH, the PUSCH has a single SLIV, mapping type, and K2, where K2 is given by extendedK2, if configured, otherwise K2 is given by k2-r16. The number of scheduled PUSCHs is signalled by the number of indicated SLIVs in the row of the pusch-TimeDomainAllocationListForMultiPUSCH signalled in DCI format 0_1. \nIf a UE is configured with extendedK2 in pusch-TimeDomainAllocationListForMultiPUSCH in which one or more rows contain multiple SLIVs for PUSCH on a UL BWP of a serving cell, and the UE is indicated re-transmission of PUSCH by DCI format 0_1, where the PUSCH is correspond to a configured grant Type 1 or Type 2, the UE does not expect that the number of indicated SLIVs in the row of the pusch-TimeDomainAllocationListForMultiPUSCH by the DCI is more than one.\nIf a UE is configured with pusch-TimeDomainAllocationListForMultiPUSCH in which one or more rows contain multiple SLIVs for PUSCH on a UL BWP of a serving cell, the UE does not expect to be scheduled with one or multiple PUSCH transmissions by a single DCI format 0_1, where each PUSCH transmission overlaps with a DL symbol indicated by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated if provided, or a symbol of an SS/PBCH block with index provided by ssb-PositionsInBurst.\nWhen the UE is configured with minimumSchedulingOffsetK2 in an active UL BWP it applies a minimum scheduling offset restriction indicated by the 'Minimum applicable scheduling offset indicator' field in DCI format 0_1, 0_3, 1_1 or 1_3 if the same field is available. When the UE is configured with minimumSchedulingOffsetK2 in an active UL BWP and it has not received 'Minimum applicable scheduling offset indicator' field in DCI format 0_1, 0_3, 1_1 or 1_3, the UE shall apply a minimum scheduling offset restriction indicated based on 'Minimum applicable scheduling offset indicator' value '0'. When the minimum scheduling offset restriction is applied the UE is not expected to be scheduled with a DCI in slot n to transmit a PUSCH scheduled with C-RNTI, CS-RNTI, MCS-C-RNTI or SP-CSI-RNTI with K2 smaller than , where K2min and  are the applied minimum scheduling offset restriction and the numerology of the active UL BWP of the scheduled cell when receiving the DCI in slot n, respectively, and  is the numerology of the new active UL BWP in case of active UL BWP change in the scheduled cell and is equal to , otherwise. The minimum scheduling offset restriction is not applied when PUSCH transmission is scheduled by RAR UL grant or fallbackRAR UL grant for RACH procedure, or when PUSCH is scheduled with TC-RNTI. The application delay of the change of the minimum scheduling offset restriction is determined in Clause 5.3.1.\nWhen two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook' or 'noncodebook', for PUSCH repetition Type A, in case K>1, the same symbol allocation is applied across the K consecutive slots and the PUSCH is limited to a single transmission layer. The UE shall repeat the TB across the K consecutive slots applying the same symbol allocation in each slot, and the association of the first and second SRS resource set in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 to each slot is determined as follows:\n-\tif a DCI format 0_3 schedules the PUSCH, the first SRS resource set is associated with all K consecutive slots,\n-\tif a DCI format 0_1 or DCI format 0_2 indicates codepoint \"00\" for the SRS resource set indicator, the first SRS resource set is associated with all K consecutive slots,\n-\tif a DCI format 0_1 or DCI format 0_2 indicates codepoint \"01\" for the SRS resource set indicator, the second SRS resource set is associated with all K consecutive slots,\n-\tif a DCI format 0_1 or DCI format 0_2 indicates codepoint \"10\" for the SRS resource set indicator, the first and second SRS resource set association to K consecutive slots is determined as follows: \n-\tWhen K = 2, the first and second SRS resource sets are applied to the first and second slot of 2 consecutive slots, respectively.  \n-\tWhen K > 2 and cyclicMapping in PUSCH-Config is enabled, the first and second SRS resource sets are applied to the first and second slot of K consecutive slots, respectively, and the same SRS resource set mapping pattern continues to the remaining slots of K consecutive slots. \n-\tWhen K > 2 and sequentialMapping in PUSCH-Config is enabled, first SRS resource set is applied to the first and second slots of K consecutive slots, and the second SRS resource set is applied to the third and fourth slot of K consecutive slots, and the same SRS resource set mapping pattern continues to the remaining slots of K consecutive slots.\n-\tOtherwise, a DCI format 0_1 or DCI format 0_2 indicates codepoint \"11\" for the SRS resource set indicator, and the first and second SRS resource set association to K consecutive slots is determined as follows, \n-\tWhen K = 2, the second and first SRS resource set are applied to the first and second slot of 2 consecutive slots, respectively.  \n-\tWhen K > 2 and cyclicMapping in PUSCH-Config is enabled, the second and first SRS resource sets are applied to the first and second slot of K consecutive slots, respectively, and the same SRS resource set mapping pattern continues to the remaining slots of the K consecutive slots. \n-\tWhen K > 2 and sequentialMapping in PUSCH-Config is enabled, the second SRS resource set is applied to the first and second slot of K consecutive slots, and the first SRS resource set is applied to the third and fourth slot of K consecutive slots, and the same SRS resource set mapping pattern continues to the remaining slots of the K consecutive slots.\nFor PUSCH repetition Type B, when two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook' or 'noncodebook', the SRS resource set association to nominal PUSCH repetitions follows the same method as SRS resource set association to slots in PUSCH Type A repetition by considering nominal repetitions instead of slots. \nWhen a UE is configured with dl-OrJointTCI-StateList or TCI-UL-State and is having two indicated TCI-States or TCI-UL-States, and two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook' or 'noncodebook', for PUSCH repetition Type A or Type B as described above, or for PUSCH transmission when the higher layer parameter multipanelScheme is set to 'SDMscheme' or 'SFNscheme', the association of the first and second indicated joint/UL TCI states to PUSCH transmission occasions or to corresponding PUSCH antenna ports is determined as follows:\n-\tif a DCI format 0_1 or DCI format 0_2 indicates codepoint \u201c00\u201d or \u201c01\u201d for the SRS resource set indicator, the first or second indicated joint/UL TCI state is applied to all PUSCH transmission occasions, respectively. \n-\tif a DCI format 0_1 or DCI format 0_2 indicates codepoint \u201c10\u201d or \u201c11\u201d for the SRS resource set indicator, and the multipanelScheme is not configured,\n-\tthe first indicated joint/UL TCI state is applied to the PUSCH transmission occasion(s) associated with the first SRS resource set and the second indicated joint/UL TCI state is applied to the PUSCH transmission occasion(s) associated with the second SRS resource set, where the association of PUSCH transmission occasions to SRS resource sets is determined for K = 2 and K > 2, and depending on whether cyclicMapping or sequentialMapping in PUSCH-Config is enabled, based on the above description in this Clause.\n-\tif a DCI format 0_1 or DCI format 0_2 indicates codepoint \u201c10\u201d for the SRS resource set indicator and the higher layer parameters multipanelScheme is configured and set to 'SDMscheme' or 'SFNscheme',\n-\tthe first indicated TCI state is applied to the PUSCH antenna port(s), of corresponding PUSCH transmission occasion, associated with the first SRS resource set, and the second indicated TCI state is applied to the PUSCH antenna port(s), of corresponding PUSCH transmission occasion, associated with the second SRS resource set, where the association of PUSCH antenna ports to SRS resource sets is determined according to Clauses 6.1.1.1 and 6.1.1.2.\nFor both PUSCH repetition Type A and PUSCH repetition Type B, when a DCI format 0_1 or DCI format 0_2 indicates codepoint \"10\" or \"11\" for the SRS resource set indicator, the redundancy version to be applied on the nth transmission occasion (for PUSCH repetition Type A) of the TB, where n = 0, 1, \u2026 K-1, or nth actual repetition (for PUSCH repetition Type B, with the counting including the actual repetitions that are omitted) is determined according to Table 6.1.2.1-2 and Table 6.1.2.1-3. For all PUSCH repetitions associated with the SRS resource set of the first transmission occasion or actual repetition, the redundancy version to be applied is derived according to Table 6.1.2.1-2, where n is counted only considering PUSCH transmission occasions or actual repetitions associated with the same SRS resource set as the first transmission occasion or actual repetition. The redundancy version for PUSCH transmission occasions or actual repetitions that are associated with an SRS resource set other than the SRS resource set of the first transmission occasion or actual repetition is derived according to Table 6.1.2.1-3, where additional shifting operation for each redundancy version is configured by higher layer parameter sequenceOffsetforRV in PUSCH-Config and  is counted only considering PUSCH transmission occasions or actual repetitions that are not associated with the SRS resource set of the first transmission occasion or actual repetition. \nTable 6.1.2.1-3: Applied redundancy version for the other SRS resource set (SRS resource set not associated with the first transmission occasion or actual repetition) when sequenceOffsetforRV is present\n\nFor PUSCH repetition Type A, when higher layer parameter multipanelScheme is not provided and a DCI format 0_1 and DCI format 0_2 indicate codepoint \"10\" or \"11\" for the SRS resource set indicator and schedule aperiodic CSI report(s) on PUSCH with transport block by a 'CSI request' field on a DCI, the CSI report(s) multiplexing is determined as follows\n-\tif higher layer parameter ap-CSI-MultiplexingMode in CSI-AperiodicTriggerState is enabled and UCI other than CSI report(s) are not multiplexed on PUSCH, the CSI report(s) is transmitted separately only on the first transmission occasion associated with the first SRS resource set and the first transmission occasion associated with the second SRS resource set. \n-\totherwise, the CSI report(s) is transmitted only on the first transmission occasion. \nFor PUSCH transmissions of TB processing over multiple slots, when a DCI format 0_1, 0_2 or 0_3 schedule aperiodic CSI report(s) on PUSCH with transport block by a 'CSI request' field on a DCI, the CSI report(s) is transmitted only on the first slot of the \ud835\udc41 \u2219 \ud835\udc3e slots determined for the PUSCH transmission.\nFor PUSCH repetition Type B, when higher layer parameter multipanelScheme is not provided and a DCI format 0_1 and DCI format 0_2 indicate codepoint \"10\" or \"11\" for the SRS resource set indicator and schedule aperiodic CSI report(s) on PUSCH with transport block by a 'CSI request' field on a DCI, CSI report(s) multiplexing is determined as follows\n-\tif higher layer parameter ap-CSI-MultiplexingMode in CSI-AperiodicTriggerState is enabled and the first actual repetition associated with the first SRS resource set and the first actual repetition associated with the second SRS resource set have the same number of symbols and UCI other than CSI report(s) are not multiplexed on PUSCH, the CSI report(s) is multiplexed separately only on the first actual repetition associated with the first SRS resource set and first actual repetition associated with the second SRS resource set. \n-\totherwise, the CSI report(s) is multiplexed only on the first actual repetition. \nThe UE does not expect a different number of actual PT-RS ports for the two actual repetitions when the CSI report(s) is transmitted separately on two actual repetitions. \nFor PUSCH repetition Type A, when higher layer parameter multipanelScheme is not provided and a DCI format 0_1 and DCI format 0_2 indicate codepoint \"10\" or \"11\" for the SRS resource set indicator and schedule aperiodic CSI report(s) on PUSCH with no transport block by a 'CSI request' field on a DCI, the number of repetitions is assumed to be 2 regardless of the value of numberOfRepetitions or pusch-AggregationFactor (if numberOfRepetitions is not present in the time domain resource allocation table), and transmission of CSI report(s) is determined as follows\n-\tif higher layer parameter ap-CSI-MultiplexingMode in CSI-AperiodicTriggerState is enabled and UCI other than CSI report(s) are not multiplexed on PUSCH, the CSI report(s) is transmitted separately on the first transmission occasion and the second transmission occasion\n-\totherwise, the CSI report(s) is transmitted only on the first transmission occasion. \nFor PUSCH repetition Type B, when higher layer parameter multipanelScheme is not provided and a DCI format 0_1 and DCI format 0_2 indicate codepoint \"10\" or \"11\" for the SRS resource set indicator and schedule aperiodic CSI report(s) or activates semi-persistent CSI report(s) on PUSCH with no transport block by a 'CSI request' field on a DCI, the number of nominal repetitions is always assumed to be 2 regardless of the value of numberOfRepetitions, and the first and second nominal repetitions are expected to be the same as the first and second actual repetitions, and transmission of CSI report(s) is determined as follows:\n-\tif higher layer parameter ap-CSI-MultiplexingMode in CSI-AperiodicTriggerState is enabled for aperiodic CSI report(s) or higher layer paremeter SP-CSI-MultiplexingMode in CSI-SemiPersistentOnPUSCH-TriggerState is enabled for semi-persistent CSI report(s) and UCI other than CSI report(s) are not multiplexed on PUSCH, the CSI report(s) is transmitted separately on the first actual repetition and the second actual repetition\n-\totherwise, the CSI report(s) is transmitted only on the first actual repetition. \nThe UE does not expect a different number of actual PT-RS ports for the two actual repetitions when the CSI report(s) is transmitted separately on two actual repetitions. \nFor PUSCH repetition Type A, when higher layer parameter multipanelScheme is not provided and a DCI format 0_1 and DCI format 0_2 indicate codepoint \"10\" or \"11\" for the SRS resource set indicator and activate semi-persistent CSI report(s) on PUSCH with no transport block by a 'CSI request' field on a DCI, or indicate the PUSCH repetition Type A carrying semi-persistent CSI report(s) without a corresponding PDCCH after being activated on PUSCH by a 'CSI request' field on a DCI, the number of repetitions is always assumed to be 2 regardless of the value of numberOfRepetitions or pusch-AggregationFactor (if numberOfRepetitions is not present in the time domain resource allocation table), and transmission of CSI report(s) is determined as follows\n-\tif higher layer parameter SP-CSI-MultiplexingMode in CSI-SemiPersistentOnPUSCH-TriggerState is enabled and UCI other than CSI report(s) are not multiplexed on PUSCH, the CSI report(s) is transmitted separately on the first transmission occasion and the second transmission occasion\n-\totherwise, the CSI report(s) is transmitted only on the first transmission occasion. \nFor PUSCH repetition Type B, when higher layer parameter multipanelScheme is not provided and a DCI format 0_1 and DCI format 0_2 indicate codepoint \"10\" or \"11\" for the SRS resource set indicator and the PUSCH repetition Type B carrying semi-persistent CSI report(s) without a corresponding PDCCH after being activated on PUSCH by a 'CSI request' field on a DCI, the number of nominal repetitions is always assumed to be 2 regardless of the value of numberOfRepetitions, and transmission of CSI report(s) is determined as follows\n-\tif higher layer parameter SP-CSI-MultiplexingMode in CSI-SemiPersistentOnPUSCH-TriggerState is enabled and one of the first or second nominal repetition is the same as corresponding first or second actual repetition, the nominal repetition that is not having same actual repetition is omitted and the CSI report(s) is transmitted on the actual repetition that is not omitted. \n-\tif higher layer parameter SP-CSI-MultiplexingMode in CSI-SemiPersistentOnPUSCH-TriggerState is enabled and the first and second nominal repetitions are the same as the first and second actual repetitions and the UCI other than CSI report(s) are not multiplexed on PUSCH, the CSI report(s) is transmitted separately on the first actual repetition and the second actual repetition\n-\totherwise, the CSI report(s) is transmitted only on the first actual repetition.\n6.1.2.1.1\tDetermination of the resource allocation table to be used for PUSCH\nTable 6.1.2.1.1-1, Table 6.1.2.1.1-1A, Table 6.1.2.1.1-1B and Table 6.1.2.1.1-1C define which PUSCH time domain resource allocation configuration to apply. \nTable 6.1.2.1.1-4 defines the subcarrier spacing specific values j. j is used in determination of K2 in conjunction to table 6.1.2.1.1-2, for normal CP or table 6.1.2.1.1.-3 for extended CP, where  is the subcarrier spacing configurations for PUSCH.\nTable 6.1.2.1.1-5 defines the additional subcarrier spacing specific slot delay value for the first transmission of PUSCH scheduled by the RAR or by the fallbackRAR. When the UE transmits a PUSCH scheduled by RAR or by the fallbackRAR, the \u0394 value specific to the PUSCH subcarrier spacing \u00b5PUSCH is applied in addition to the K2 value.\nTable 6.1.2.1.1-1: Applicable PUSCH time domain resource allocation for common search space and DCI format 0_0 in UE specific search space\n\nTable 6.1.2.1.1-1A: Applicable PUSCH time domain resource allocation for DCI format 0_1 in UE specific search space scrambled with C-RNTI, MCS-C-RNTI, CS-RNTI or SP-CSI-RNTI\n\nTable 6.1.2.1.1-1B: Applicable PUSCH time domain resource allocation for DCI format 0_2 in UE specific search space scrambled with C-RNTI, MCS-C-RNTI, CS-RNTI or SP-CSI-RNTI\n\nTable 6.1.2.1.1-1C: Applicable PUSCH time domain resource allocation for DCI format 0_3 in UE specific search space scrambled with C-RNTI or MCS-C-RNTI\n\nTable 6.1.2.1.1-2: Default PUSCH time domain resource allocation A for normal CP\n\nTable 6.1.2.1.1-3: Default PUSCH time domain resource allocation A for extended CP \n\nTable 6.1.2.1.1-4: Definition of value j\n\nTable 6.1.2.1.1-5: Definition of value \u0394\n\n6.1.2.2\tResource allocation in frequency domain\nThe UE shall determine the resource block assignment in frequency domain using the resource allocation field in the detected PDCCH DCI except for a PUSCH transmission scheduled by a RAR UL grant or fallbackRAR UL grant, in which case the frequency domain resource allocation is determined according to clause 8.3 of [6, 38.213] or a MsgA PUSCH transmission with frequency domain resource allocation determined according to clause 8.1A of [6, 38.213]. Three uplink resource allocation schemes type 0, type 1 and type 2 are supported. Uplink resource allocation scheme type 0 is supported for PUSCH only when transform precoding is disabled. Uplink resource allocation scheme type 1 and type 2 are supported for PUSCH for both cases when transform precoding is enabled or disabled.\nIf the scheduling DCI is configured to indicate the uplink resource allocation type as part of the 'Frequency domain resource' assignment field by setting a higher layer parameter resourceAllocation in pusch-Config to 'dynamicSwitch', for DCI format 0_1 or setting a higher layer parameter resourceAllocationDCI-0-2 in pusch-Config to 'dynamicSwitch' for DCI format 0_2 or setting a higher layer parameter resourceAllocationDCI-0-3 in pusch-ConfigDCI-0-3 to 'dynamicSwitch' for DCI format 0_3, the UE shall use uplink resource allocation type 0 or type 1 as defined by this DCI field. Otherwise the UE shall use the uplink frequency resource allocation type as defined by the higher layer parameter resourceAllocation for DCI format 0_1 or the higher layer parameter resourceAllocationDCI-0-2 for DCI format 0_2. The UE shall assume that when the scheduling PDCCH is received with DCI format 0_1 and useInterlacePUCCH-PUSCH in BWP-UplinkDedicated is configured, uplink type 2 resource allocation is used.\nThe UE shall assume that when the scheduling PDCCH is received with DCI format 0_0, then uplink resource allocation type 1 is used, except when any of the higher layer parameters useInterlacePUCCH-PUSCH in BWP-UplinkCommon and useInterlacePUCCH-PUSCH in BWP-UplinkDedicated is configured in which case uplink resource allocation type 2 is used. \nThe UE expects that either none or both of useInterlacePUCCH-PUSCH in BWP-UplinkCommon and useInterlacePUCCH-PUSCH in BWP-UplinkDedicated is configured.\nIf a bandwidth part indicator field is not configured in the scheduling DCI or the UE does not support active bandwidth part change via DCI, the RB indexing for uplink type 0, type 1 and type 2 resource allocation is determined within the UE's active bandwidth part. If a bandwidth part indicator field is configured in the scheduling DCI and the UE supports active bandwidh part change via DCI, the RB indexing for uplink type 0, type 1, type 2 resource allocation is determined within the UE's bandwidth part indicated by bandwidth part indicator field value in the DCI. The UE shall upon detection of PDCCH intended for the UE determine first the uplink bandwidth part and then the resource allocation within the bandwidth part. RB numbering starts from the lowest RB in the determined uplink bandwidth part.\n6.1.2.2.1\tUplink resource allocation type 0\nIn uplink resource allocation of type 0, the resource block assignment information includes a bitmap indicating the Resource Block Groups (RBGs) that are allocated to the scheduled UE where a RBG is a set of consecutive virtual resource blocks defined by higher layer parameter rbg-Size for DCI format 0_1/0_2 configured in pusch-Config or rbg-SizeDCI-0-3 for DCI format 0_3 configured in pusch-ConfigDCI-0-3 and the size of the bandwidth part as defined in Table 6.1.2.2.1-1.\nTable 6.1.2.2.1-1: Nominal RBG size P\n\nThe total number of RBGs () for a uplink bandwidth part i of sizePRBs is given by  where \n-\tthe size of the first RBG is ,\n-\tthe size of the last RBG is if and P otherwise.\n-\tthe size of all other RBG is P. \nThe bitmap is of size bits with one bitmap bit per RBG such that each RBG is addressable. The RBGs shall be indexed in the order of increasing frequency of the bandwidth part and starting at the lowest frequency. The order of RBG bitmap is such that RBG 0 to RBG are mapped from MSB to LSB of the bitmap. The RBG is allocated to the UE if the corresponding bit value in the bitmap is 1, the RBG is not allocated to the UE otherwise. \nIn frequency range 1, only 'almost contiguous allocation' defined in [8, TS 38.101-1] is allowed as non-contiguous allocation per component carrier for UL RB allocation for CP-OFDM.\nIn frequency range 2, non-contiguous allocation per component carrier for UL RB allocation for CP-OFDM is not supported.\n6.1.2.2.2\tUplink resource allocation type 1\nIn uplink resource allocation of type 1, the resource block assignment information indicates to a scheduled UE a set of contiguously allocated non-interleaved virtual resource blocks within the active bandwidth part of size  PRBs except for the case when DCI format 0_0 is decoded in any common search space in which case the size of the initial UL bandwidth part  shall be used. \nAn uplink type 1 resource allocation field consists of a resource indication value (RIV) corresponding to a starting virtual resource block () and a length in terms of contiguously allocated resource blocks. The resource indication value is defined by \nif  then\n\nelse \n\nwhere 1 and shall not exceed. \nWhen the DCI size for DCI format 0_0 in USS is derived from the initial UL BWP with size  but applied to another active BWP with size of , an uplink type 1 resource block assignment field consists of a resource indication value (RIV) corresponding to a starting resource block and a length in terms of virtually contiguously allocated resource blocks . \nThe resource indication value is defined by\nif  then\n\nelse \n\nwhere, and where shall not exceed .\nIf , K is the maximum value from set {1, 2, 4, 8} which satisfies ; otherwise K = 1. \nWhen the scheduling grant is received with DCI format 0_2 or 0_3, an uplink type 1 resource allocation field consists of a resource indication value (RIV) corresponding to a starting resource block group RBGstart=0, 1, \u2026, NRBG-1 and a length in terms of virtually contiguously allocated resource block groups LRBGs=1, \u2026, NRBG, where the resource block groups are defined as in 6.1.2.2.1 with P defined by resourceAllocationType1GranularityDCI-0-2 for DCI format 0_2 and by resourceAllocationType1GranularityDCI-0-3 for DCI format 0_3 if the UE is configured with higher layer parameter resourceAllocationType1GranularityDCI-0-2 or resourceAllocationType1GranularityDCI-0-3, and P=1 otherwise. The resource indication value is defined by\nif  then\n\nelse \n\nwhere 1 and shall not exceed .\n6.1.2.2.3\tUplink resource allocation type 2\nIn uplink resource allocation of type 2, the resource block assignment information defined in [5, TS 38.212] indicates to a UE a set of up to M interlace indices, and for DCI format 0_0 monitored in a UE-specific search space and DCI formats 0_1 and 0_3 a set of up to  contiguous RB sets, where M and interlace indexing are defined in Clause 4.4.4.6 in [4, TS 38.211]. Within the active UL BWP, the assigned physical resource block  is mapped to virtual resource block  For DCI format 0_0 monitored in a UE-specific search space and DCI formats 0_1 and 0_3, the UE shall determine the resource allocation in frequency domain as an intersection of the resource blocks of the indicated interlaces and the union of the indicated set of RB sets and intra-cell guard bands defined in Clause 7 between the indicated RB sets, if any. For DCI format 0_0 monitored in a common search space, the UE shall determine the resource allocation in frequency domain as an intersection of the resource blocks of the indicated interlaces and a single uplink RB set of the active UL BWP. For DCI format 0_0 monitored in a CSS with CRC scrambled by an RNTI other than TC-RNTI, the uplink RB set is the lowest indexed one amongst uplink RB set(s) that intersects the lowest-indexed CCE of the PDCCH in which the UE detects the DCI format 0_0 in the active downlink BWP. When the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the purpose of determining the uplink RB set of a PUSCH when scheduled by DCI format 0_0 monitored in a CSS with CRC scrambled by an RNTI other than TC-RNTI, the CORESET with lower ID among two CORESETs associated with two PDCCH candidates is used. If there is no intersection, the uplink RB set is RB set 0 in the active uplink BWP. For DCI format 0_0 with CRC scrambled by TC-RNTI, the uplink RB set is the same one in which the UE transmits the PRACH associated with the RAR UL grant, in which case the UE assumes that the uplink RB set is defined as when the UE is not configured with intraCellGuardBandsUL-List (see Clause 7).\nFor \u00b5=0, the X=6 MSBs of the resource block assignment information indicates to a UE a set of allocated interlace indices  , where the indication consists of a resource indication value (RIV). For  ,  the resource indication value corresponds to the starting interlace index m0 and the number of contiguous interlace indices (). The resource indication value is defined by:\nif  then\n\nelse\n\nFor  , the resource indication value corresponds to the starting interlace index m0 and the set of values  according to Table 6.1.2.2.3-1.\nTable 6.1.2.2.3-1: m0  and  for .\n\nFor \u00b5=1, the X=5 MSBs of the resource block assignment information comprise a bitmap indicating the interlaces that are allocated to the scheduled UE. The bitmap is of size M bits with one bitmap bit per interlace such that each interlace is addressable, where M and interlace indexing is defined in Clause 4.4.4.6 in [4, TS 38.211]. The order of interlace bitmap is such that interlace 0 to interlace  are mapped from MSB to LSB of the bitmap. An interlace is allocated to the UE if the corresponding bit value in the bitmap is 1; otherwise the interlace is not allocated to the UE.\nFor DCI format 0_0 monitored in a UE-specific search space and DCI formats 0_1 and 0_3 for both \u00b5=0 and \u00b5=1, the  the resource block assignment information indicate to a UE a set of contiguously allocated RB sets for PUSCH scheduled by DCI format 0_0 monitored in a UE-specific search space, DCI formats 0_1 and 0_3 and Type 1 and Type 2 configured grant. The resource allocation field consists of a resource indication value (). For  ,  the resource indication value corresponds to the starting RB set index  and the number of contiguous RB sets . The resource indication value is defined by;\nif  then\n \nelse\n \nwhere ,  and shall not exceed \nIf transform precoding is enabled according to the procedure in Clause 6.1.3, then the UE transmits PUSCH on the lowest-indexed  PRBs amongst the PRBs indicated by the frequency domain resource assignment information.  is the largest integer not greater than the number of RBs indicated by the frequency domain resource assignment information that fulfils the conditions in Clause 6.3.1.4 of [4, TS 38.211].\n6.1.2.3\tResource allocation for uplink transmission with configured grant\nWhen PUSCH resource allocation is semi-statically configured by higher layer parameter configuredGrantConfig in BWP-UplinkDedicated information element, and the PUSCH transmission corresponding to a configured grant, the following higher layer parameters are applied in the transmission:\n-\tFor Type 1 PUSCH transmissions with a configured grant, the following parameters are given in configuredGrantConfig unless mentioned otherwise:\n-\tFor the determination of the PUSCH repetition type, if the higher layer parameter pusch-RepTypeIndicator in rrc-ConfiguredUplinkGrant is configured and set to 'pusch-RepTypeB', PUSCH repetition type B is applied; otherwise, PUSCH repetition type A is applied;  \n-\tFor PUSCH repetition type A, the selection of the time domain resource allocation table follows the rules for DCI format 0_0 on UE specific search space, as defined in Clause 6.1.2.1.1.\n-\tFor PUSCH repetition type B, the selection of the time domain resource allocation table is as follows:\n-\tIf pusch-RepTypeIndicatorDCI-0-1 in pusch-Config is configured and set to 'pusch-RepTypeB', pusch-TimeDomainAllocationListDCI-0-1 in pusch-Config is used;\n-\tOtherwise, pusch-TimeDomainAllocationListDCI-0-2 in pusch-Config is used.\n-\tIt is not expected that pusch-RepTypeIndicator in rrc-ConfiguredUplinkGrant is configured with 'pusch-RepTypeB' when none of pusch-RepTypeIndicatorDCI-0-1 and pusch-RepTypeIndicatorDCI-0-2 in pusch-Config is set to 'pusch-RepTypeB'.\n-\tThe higher layer parameter timeDomainAllocation value m provides a row index m+1 pointing to the determined time domain resource allocation table, where the start symbol and length are determined following the procedure defined in Clause 6.1.2.1;\n-\tFrequency domain resource allocation is determined by the N LSB bits in the higher layer parameter frequencyDomainAllocation, forming a bit sequence , where  is the LSB, according to the procedure in Clause 6.1.2.2 and N is determined as the size of frequency domain resource assignment field in DCI format 0_1 for a given resource allocation type indicated by resourceAllocation, except if useInterlacePUCCH-PUSCH in BWP-UplinkDedicated is configured, in which case uplink type 2 resource allocation is used wherein the UE interprets the LSB bits in the higher layer parameter frequencyDomainAllocation as for the frequency domain resource assignment field of DCI 0_1 according to the procedure in Clause 6.1.2.2.3;\n-\tThe IMCS is provided by higher layer parameter mcsAndTBS;\n-\tNumber of DM-RS CDM groups, DM-RS ports, SRS resource indication and DM-RS sequence initialization are determined as in Clause 7.3.1.1.2 of [5, TS 38.212], and the antenna port value, the bit value for DM-RS sequence initialization, precoding information and number of layers, SRS resource indicator are provided by antennaPort, dmrs-SeqInitialization, precodingAndNumberOfLayers, and srs-ResourceIndicator respectively; When two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2, precoding information and number of layers (applicable when higher layer parameter usage in SRS-ResourceSet set to 'codebook') associated with the first and second SRS resource set is provided by precodingAndNumberOfLayers and precodingAndNumberOfLayers2, respectively, and SRS resource indicators associated with the first and second SRS resource sets are provided by srs-ResourceIndicator and srs-ResourceIndicator2, respectively. When both srs-ResourceSetToAddModList and srs-ResourceSetToAddModListDCI-0-2 are configured with two SRS resource sets, the two SRS resource sets configured by srs-ResourceSetToAddModList is used to determine the SRS resource indications by srs-ResourceIndicator and srs-ResourceIndicator2.\n-\tIf two SRS resource sets with usage set to 'codebook' or 'noncodebook' are configured in srs-ResourceSetToAddModList, the two SRS resource sets are used to determine the SRS resource indications by srs-ResourceIndicator and srs-ResourceIndicator2.\n-\totherwise, the two SRS resource sets with usage set to 'codebook' or 'noncodebook' configured in srs-ResourceSetToAddModListDCI-0-2 are used to determine the SRS resource indications by srs-ResourceIndicator and srs-ResourceIndicator2.\n-\tWhen frequency hopping is enabled, the frequency offset between two frequency hops can be configured by higher layer parameter frequencyHoppingOffset.\n-\tFor Type 2 PUSCH transmissions with a configured grant: the resource allocation follows the higher layer configuration according to [10, TS 38.321], and UL grant received on the DCI. \n-\tThe PUSCH repetition type and the time domain resource allocation table are determined by the PUSCH repetition type and the time domain resource allocation table associated with the UL grant received on the DCI, respectively, as defined in Clause 6.1.2.1. The value of Koffset, if configured, is applied when determining the first transmission opportunity.\nFor PUSCH transmissions with a Type 1 or Type 2 configured grant, the number of (nominal) repetitions K to be applied to the transmitted transport block is provided by the indexed row in the time domain resource allocation table if numberOfRepetitions is present in the table; otherwise K is provided by the higher layer configured parameters repK. For a configuredGrantConfig, if a UE is configured with higher layer parameter nrofSlotsInCG-Period, the UE does not support repetition nor the TB processing over multiple slots for the configuredGrantConfig.\nFor PUSCH transmissions with a Type 2 configured grant, when two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2, the SRS resource set association to (nominal) repetitions follows MappingPattern in ConfiguredGrantConfig as defined in Clause 6.1.2.1 for PUSCH scheduled by DCI format 0_1 and 0_2. For PUSCH transmissions with a Type 1 configured grant, when two SRS resource sets with usage set to 'codebook' or 'noncodebook' are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2, if p0-PUSCH-Alpha2 is provided, the SRS resource set association to (nominal) repetitions is determined as follows. When K = 2, the first and second SRS resource sets are applied to the first and second (nominal) repetitions, respectively.  \n-\tWhen K > 2 and cyclicMapping in ConfiguredGrantConfig is enabled, the first and second SRS resource sets are applied to the first and second (nominal) repetitions, respectively, and the same SRS resource set mapping pattern continues to the remaining (nominal) repetitions. \n-\tWhen K > 2 and sequentialMapping in ConfiguredGrantConfig is enabled, first SRS resource set is applied to the first and second (nominal) repetitions, and the second SRS resource set is applied to the third and fourth (nominal) repetitions, and the same SRS resource set mapping pattern continues to the remaining (nominal) repetitions.\nFor PUSCH transmissions with a Type 1 configured grant, when two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2, if configuredGrantConfig contains only one pathlossReferenceIndex, p0-PUSCH-Alpha, powerControlLoopToUse, srs-ResourceIndicator and precodingAndNumberOfLayers (applicable when higher layer parameter usage in SRS-ResourceSet set to 'codebook'), PUSCH repetitions are associated only with the first SRS resource set.\nIf the UE is provided two SRS resource sets in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with usage set to 'codebook' or 'nonCodebook', and the UE is not provided p0-PUSCH-Alpha2 and powerControlLoopToUse2, for a retransmission of a configured grant Type 1 PUSCH, or for activation or retransmission of a configured grant Type 2 PUSCH, scheduled by a DCI format that includes an SRS resource set indicator field, the UE expects the value of the SRS resource set indicator field to be set to '00', and PUSCH repetitions are associated only with the first SRS resource set.\nThe UE shall not transmit anything on the resources configured by configuredGrantConfig if the higher layers did not deliver a transport block to transmit on the resources allocated for uplink transmission without grant.\nA set of allowed periodicities P are defined in [12, TS 38.331]. The higher layer parameter cg-nrofSlots, provides the number of consecutive slots allocated within a configured grant period. The higher layer parameter cg-nrofPUSCH-InSlot provides the number of consecutive PUSCH allocations within a slot, where the first PUSCH allocation follows the higher layer parameter timeDomainAllocation for Type 1 PUSCH transmission or the higher layer configuration according to [10, TS 38.321], and UL grant received on the DCI for Type 2 PUSCH transmissions, and the remaining PUSCH allocations have the same length and PUSCH mapping type, and are appended following the previous allocations without any gaps. The higher layer parameter nrofSlotsInCG-Period provides the number of consecutive slots allocated within a configured grant period. The same combination of start symbol and length and PUSCH mapping type repeats over the consecutively allocated slots if cg-nrofSlots or nrofSlotsInCG-Period is configured. If nrofSlotsInCG-Period is configured, the PUSCH allocation in each consecutive slot follows the higher layer parameter timeDomainAllocation for Type 1 PUSCH transmission or the higher layer configuration according to [10, TS 38.321], and UL grant received in the DCI for Type 2 PUSCH transmissions. If a UE is configured with higher layer parameter nrofSlotsInCG-Period in a configuredGrantConfig, the UE does not expect to be configured with cg-nrofSlots and cg-nrofPUSCH-InSlot in the configuredGrantConfig.\nFor operation with shared spectrum channel access, and when the higher layer parameter semiStaticChannelAccessConfigUE is not configured, where a UE is performing uplink transmission with configured grants in contiguous OFDM symbols on all resource blocks of an RB set, for the first such UL transmission the UE determines a duration of a cyclic prefix extension Text to be applied for transmission according to [4, TS 38.211] where the index for  [4, TS 38.211] is chosen randomly from a set of values configured by higher layers according to the following rule:\n-\tIf the first such UL transmission is within a channel occupancy initiated by the gNB (defined in Clause 4 of [16, TS 37.213]), the set of values is determined by cg-StartingFullBW-InsideCOT;\n-\totherwise, the set of values is determined by cg-StartingFullBW-OutsideCOT.\nFor operation with shared spectrum channel access, and when the higher layer parameter semiStaticChannelAccessConfigUE is not configured, where a UE is performing uplink transmission with configured grants in contiguous OFDM symbols on fewer than all\u00a0resource blocks of an RB set, for the first such UL transmission the UE determines a duration of a cyclic prefix extension Text to be applied for transmission according to [4, TS 38.211] according to the following rule:\n-\tIf the first such UL transmission is within a channel occupancy initiated by the gNB (defined in Clause 4 of [16, TS 37.213]), the index for  [4, TS 38.211]  is equal to cg-StartingPartialBW-InsideCOT;\n-\totherwise, the index for  [4, TS 38.211]  is equal to cg-StartingPartialBW-OutsideCOT.\n6.1.2.3.1\tTransport Block repetition for uplink transmissions of PUSCH repetition Type A with a configured grant\nThe procedures described in this clause apply to PUSCH transmissions of PUSCH repetition Type A with a Type 1 or Type 2 configured grant. \nThe higher layer parameter repK-RV defines the redundancy version pattern to be applied to the repetitions. If cg-RetransmissionTimer is provided, the redundancy version for uplink transmission with a configured grant is determined by the UE. If the parameter repK-RV is not provided in the configuredGrantConfig and cg-RetransmissionTimer is not provided, the redundancy version for uplink transmissions with a configured grant shall be set to 0. If the parameter repK-RV is provided in the configuredGrantConfig and cg-RetransmissionTimer is not provided, for the nth transmission occasion among K repetitions, n=1, 2, \u2026, K, it is associated with (mod(((n-mod(n, N))/N)-1,4)+1)th value in the configured RV sequence, where N=1. If a configured grant configuration is configured with startingFromRV0 set to 'off', the initial transmission of a transport block may only start at the first transmission occasion of the K repetitions. Otherwise, the initial transmission of a transport block may start at \n-\tthe first transmission occasion of the K repetitions if the configured RV sequence is {0,2,3,1},\n-\tany of the transmission occasions of the K repetitions that are associated with RV=0 if the configured RV sequence is {0,3,0,3},\n-\tany of the transmission occasions of the K repetitions if the configured RV sequence is {0,0,0,0}, except the last transmission occasion when K\u22658. \nWhen the transmission occasions are associated with the first and second SRS resource sets, if the parameter repK-RV is provided in the configuredGrantConfig, for the nth transmission occasion among all transmission occasions that are associated with the SRS resource set of the first transmission occasion, it is associated with (mod(n-1,4)+1)th value in the configured RV sequence, and for the nth transmission occasion among all transmission occasions that are not associated with the SRS resource set of the first transmission occasion, it is associated with (mod(n-1,4)+1)th value in the adjusted RV sequence and the adjustment is based on additional shifting operation on the configured RV sequence, where the shifting operation is defined as  where is the ith RV value (i=1, 2, 3, 4) in the configured RV sequence and  is configured by the higher layer parameter sequenceOffsetforRV in configuredGrantConfig. When the transmission occasions are associated with the first and second SRS resource sets, if a configured grant configuration is configured with startingFromRV0 set to 'off', the initial transmission of a transport block may only start at the first transmission occasion of the K repetitions. Otherwise, the initial transmission of a transport block may start at \n-\tthe first transmission occasion associated with RV = 0 corresponding to the first or second SRS resource set of the K repetitions if the configured RV sequence is {0,2,3,1},\n-\tany of the transmission occasions of the K repetitions that are associated with RV=0 if the configured RV sequence is {0,3,0,3},\n-\tany of the transmission occasions of the K repetitions if the configured RV sequence is {0,0,0,0}, except the last transmission occasion when K\u22658. \nAfter the initial transmission of a transport block, later transmission occasions among the K repetitions associated with any RV value and associated to any of the first or second SRS resource set can be used for transmitting the transport block.\nFor any RV sequence, the repetitions shall be terminated after transmitting K repetitions, or at the last transmission occasion among the K repetitions within the period P, or from the starting symbol of the repetition that overlaps with a PUSCH with the same HARQ process scheduled by DCI format 0_0, 0_1, 0_2 or 0_3, whichever is reached first. In addition, the UE shall terminate the repetition of a transport block in a PUSCH transmission if the UE receives a DCI format 0_1 with DFI flag provided and set to '1', and if in this DCI the UE detects ACK for the HARQ process corresponding to that transport block.\nThe UE is not expected to be configured with the time duration for the transmission of K repetitions larger than the time duration derived by the periodicity P. If the UE determines that, for a transmission occasion, the number of symbols available for the PUSCH transmission in a slot is smaller than transmission duration L, the UE does not transmit the PUSCH in the transmission occasion.\nFor both Type 1 and Type 2 PUSCH transmissions with a configured grant, when K > 1, \n-\tFor unpaired spectrum:\n-\tIf AvailableSlotCounting is enabled, the UE shall repeat the TB across the  slots determined for the PUSCH transmission applying the same symbol allocation in each slot.\n-\tA slot is not counted in the number of  slots if at least one of the symbols indicated by the indexed row of the used resource allocation table in the slot overlaps with a DL symbol indicated by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated if provided, or a symbol of an SS/PBCH block with index provided by ssb-PositionsInBurst.\n-\tOtherwise, the UE shall repeat the TB across the  consecutive slots applying the same symbol allocation in each slot, except if the UE is provided with higher layer parameters cg-nrofSlots and cg-nrofPUSCH-InSlot, in which case the UE repeats the TB in the repK earliest consecutive transmission occasion candidates within the same configuration.\n-\tFor paired spectrum and SUL band:\n-\tThe UE shall repeat the TB across the  consecutive slots applying the same symbol allocation in each slot, except if the UE is provided with higher layer parameters cg-nrofSlots and cg-nrofPUSCH-InSlot, in which case the UE repeats the TB in the repK earliest consecutive transmission occasion candidates within the same configuration.\n-\tIf AvailableSlotCounting is enabled, and in case of reduced capability half-duplex UE, the UE shall repeat the TB across the  slots applying the same symbol allocation in each slot. A slot is not counted in the number of  slots if at least one of the symbols indicated by the indexed row of the used resource allocation table in the slot does not start or end at least  or , respectively, from the last or first symbol of an SS/PBCH block with index provided by ssb-PositionsInBurst.\nA Type 1 or Type 2 PUSCH transmission with a configured grant in a slot is omitted according to the conditions in Clause 9, Clause 11.1, Clause 11.2A, Clause 15 and Clause 17.2 of [6, TS 38.213]. \n6.1.2.3.2\tTransport Block repetition for uplink transmissions of PUSCH repetition Type B with a configured grant\nThe procedures described in this Clause apply to PUSCH transmissions of PUSCH repetition type B with a Type 1 or Type 2 configured grant.\nFor PUSCH transmissions with a Type 1 or Type 2 configured grant, the nominal repetitions and the actual repetitions are determined according to the procedures for PUSCH repetition Type B defined in Clause 6.1.2.1. The higher layer configured parameters repK-RV defines the redundancy version pattern to be applied to the repetitions. If the parameter repK-RV is not provided in the configuredGrantConfig, the redundancy version for each actual repetition with a configured grant shall be set to 0. Otherwise, for the nth transmission occasion among all the actual repetitions (including the actual repetitions that are omitted) of the K nominal repetitions, it is associated with (mod(((n-mod(n, N))/N)-1,4)+1)th value in the configured RV sequence, where N = 1. If a configured grant configuration is configured with startingFromRV0 set to 'off', the initial transmission of a transport block may only start at the first transmission occasion of the actual repetitions. Otherwise, the initial transmission of a transport block may start at \n-\tthe first transmission occasion of the actual repetitions if the configured RV sequence is {0,2,3,1},\n-\tany of the transmission occasions of the actual repetitions that are associated with RV=0 if the configured RV sequence is {0,3,0,3},\n-\tany of the transmission occasions of the actual repetitions if the configured RV sequence is {0,0,0,0}, except the actual repetitions within the last nominal repetition when K\u22658. \nWhen the transmission occasions are associated with the first and second SRS resource sets, if the parameter repK-RV is provided in the configuredGrantConfig, for the nth transmission occasion among all actual repetitions (including the actual repetitions that are omitted) that are associated with the SRS resource set of the first transmission occasion, it is associated with (mod(n-1,4)+1)th value in the configured RV sequence, and for the nth transmission occasion among all actual repetitions that are not associated with the SRS resource set of the first transmission occasion, it is associated with (mod(n-1,4)+1)th value in the adjusted RV sequence and the adjustment is based on additional shifting operation on the configured RV sequence, where the shifting operation is defined as  where is the ith RV value (i=1, 2, 3, 4) in the configured RV sequence and  is configured by the higher layer parameter sequenceOffsetforRV in configuredGrantConfig. When the transmission occasions are associated with the first and second SRS resource sets, if a configured grant configuration is configured with startingFromRV0 set to 'off', the initial transmission of a transport block may only start at the first transmission occasion of the K repetitions. Otherwise, the initial transmission of a transport block may start at \n-\tthe first transmission occasion associated with RV = 0 corresponding to the first or second SRS resource set of the K repetitions if the configured RV sequence is {0,2,3,1},\n-\tany of the transmission occasions of the K repetitions that are associated with RV=0 if the configured RV sequence is {0,3,0,3},\n-\tany of the transmission occasions of the K repetitions if the configured RV sequence is {0,0,0,0}, except the last transmission occasion when K\u22658. \nAfter the initial transmission of a transport block, later transmission occasions among the K repetitions associated with any RV value and associated to any of the first or second SRS resource set can be used for transmitting the transport block.\nFor any RV sequence, the repetitions shall be terminated after transmitting K nominal repetitions, or at the last transmission occasion among the K nominal repetitions within the period P, or from the starting symbol of an actual repetition that overlaps with a PUSCH with the same HARQ process scheduled by DCI format 0_0, 0_1, 0_2 or 0_3, whichever is reached first. The UE is not expected to be configured with the time duration for the transmission of K nominal repetitions larger than the time duration derived by the periodicity P.\n6.1.2.3.3\tTransport Block repetition for uplink transmissions of TB processing over multiple slots with a configured grant\nThe procedures described in this clause apply to PUSCH transmissions of TB processing over multiple slots with a Type 2 configured grant. \nThe higher layer parameter repK-RV defines the redundancy version pattern to be applied to the repetitions. If the parameter repK-RV is not provided in the configuredGrantConfig, the redundancy version for uplink transmissions with a configured grant shall be set to 0. If the parameter repK-RV is provided in the configuredGrantConfig, the nth transmission occasion among  transmissions occasions, n=0,1, \u2026,  -1, is associated with (mod((n-mod(n, N))/N,4)+1)th value in the configured RV sequence. When K=1, or when K>1 and the configured grant configuration is configured with startingFromRV0 set to 'off', the initial transmission of the transport block may only start at the first transmission occasion of the  transmission occasions. Otherwise, the initial transmission of the transport block may start at\n-\tThe first transmission occasion of the  transmission occasions if the configured RV sequence is {0,2,3,1}.\n-\tAny transmission occasion n associated with RV=0, and for which n mod N =0, if the configured RV sequence is {0,3,0,3} or {0,0,0,0}.\nThe UE is not expected to be configured with the time duration for  transmissions larger than the time duration derived by the periodicity P. If the UE determines that, for a transmission occasion, the number of symbols available in a slot for the PUSCH transmission of TB processing over multiple slots is smaller than transmission duration L, the UE does not transmit the PUSCH in the transmission occasion.\nFor unpaired spectrum:\n-\tThe UE determines  slots for a PUSCH transmission of TB processing over multiple slots with a Type 2 configured grant activated by DCI format 0_1 or 0_2, based on tdd-UL-DL-ConfigurationCommon, tdd-UL-DL-ConfigurationDedicated and ssb-PositionsInBurst, and the TDRA information field value in the DCI format 0_1 or 0_2.\n-\tA slot is not counted in the number of  slots for a PUSCH transmission of TB processing over multiple slots with a Type 2 configured grant activated by DCI format 0_1 or 0_2 if at least one of the symbols indicated by the indexed row of the used resource allocation table in the slot overlaps with a DL symbol indicated by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated if provided, or a symbol of an SS/PBCH block with index provided by ssb-PositionsInBurst.\nFor paired spectrum and SUL band:\n-\tThe UE determines  consecutive slots for a PUSCH transmission of TB processing over multiple slots with a Type 2 configured grant activated by DCI format 0_1 or 0_2, based on the TDRA information field value in the DCI format 0_1 or 0_2.\n-\tFor the case of a reduced capability half-duplex UE, the UE determines  slots for a PUSCH transmission of TB processing over multiple slots with a Type 2 configured grant activated by DCI format 0_1 or 0_2, based on the TDRA information field value in the DCI format 0_1 or 0_2. A slot is not counted in the number of  slots if at least one of the symbols indicated by the indexed row of the used resource allocation table in the slot does not start or end at least  or , respectively, from the last or first symbol of an SS/PBCH block with index provided by ssb-PositionsInBurst.\nFor Type 2 PUSCH transmission with a configured grant of TB processing over multiple slots, the UE shall transmit the TB across the  slots determined for the PUSCH transmission applying the same symbol allocation in each slot. A Type 2 PUSCH transmission with a configured grant of TB processing over multiple slots is omitted in a slot according to the conditions in Clause 9, Clause 11.1, Clause 11.2A, Clause 15 and Clause 17.2 of [6, TS 38.213].\n6.1.3\tUE procedure for applying transform precoding on PUSCH\nFor a PUSCH scheduled by RAR UL grant, or for a PUSCH scheduled by fallbackRAR UL grant, or for a PUSCH scheduled by DCI format 0_0 with CRC scrambled by TC-RNTI, the UE shall consider the transform precoding either 'enabled' or 'disabled' according to the higher layer configured parameter msg3-transformPrecoder.\nFor a MsgA PUSCH, the UE shall consider the transform precoding either 'enabled' or 'disabled' according to the higher layer configured parameter msgA-TransformPrecoder. If higher layer parameter msgA-TransformPrecoder is not configured, the UE shall consider the transform precoding either 'enabled' or 'disabled' according to the higher layer configured parameter msg3-transformPrecoder.\nFor PUSCH transmission scheduled by a PDCCH with CRC scrambled by CS-RNTI with NDI=1, C-RNTI, or MCS-C-RNTI or SP-CSI-RNTI:\n-\tIf the DCI with the scheduling grant was received with DCI format 0_0, the UE shall, for this PUSCH transmission, consider the transform precoding either enabled or disabled according to the higher layer configured parameter msg3-transformPrecoder. \n-\tIf the DCI with the scheduling grant was not received with DCI format 0_0 \n-\tIf the DCI with the scheduling grant was received with DCI format 0_1 or 0_2 with CRC scrambled by C-RNTI, MCS-RNTI, or CS-RNTI with NDI=1 and if the UE is configured with a higher layer parameter [dynamicTransformPrecoderIndicationDCI-0-1] in pusch-Config for DCI format 0_1 or [dynamicTransformPrecoderIndicationDCI-0-2] in pusch-Config for DCI format 0_2 and the higher layer parameter is set to 'enabled', \n-\tthe UE shall, for this PUSCH transmission, consider the transform precoding either enabled or disabled according to the Transform precoder indicator field in the DCI with the scheduling grant.\n-\tFor pusch-TimeDomainAllocationListForMultiPUSCH in pusch-Config, the UE shall, for all PUSCH transmissions, consider the transform precoding either enabled or disabled according to Transform precoder indicator field in the DCI format 0_1 with the scheduling grant.\n-\tIf resourceAllocation in pusch-Config for DCI format 0_1 or resourceAllocationDCI-0-2 in pusch-Config for DCI format 0_2 is set to resourceAllocationType0, or if the resource allocation is set to resource allocation type 0 according to the DCI configuration as described in clauses 7.3.1.1.2 and 7.3.1.1.3 of [6, TS 38.212], or if dmrs-Type in DMRS-UplinkConfig is set to \u2018type 2\u2019 for this PUSCH transmission, the UE does not expect that the Transform precoder indicator field in the DCI with the scheduling grant indicates that transform precoding is enabled.\n-\tIf the UE is configured with the higher layer parameter dmrs-TypeEnh in DMRS-UplinkConfig, and if the scheduling grant indicates that transform precoding is enabled for the scheduled PUSCH transmission, the UE ignores the higher layer parameters dmrs-TypeEnh in DMRS-UplinkConfig, if configured, for the DM-RS transmission of the scheduled PUSCH transmission.\n-\tOtherwise,\n-\tIf the UE is configured with the higher layer parameter transformPrecoder in pusch-Config, the UE shall, for this PUSCH transmission, consider the transform precoding either enabled or disabled according to this parameter.\n-\tIf the UE is not configured with the higher layer parameter transformPrecoder in pusch-Config, the UE shall, for this PUSCH transmission, consider the transform precoding either enabled or disabled according to the higher layer configured parameter msg3-transformPrecoder.\nFor PUSCH transmission with a configured grant\n-\tIf the UE is configured with the higher layer parameter transformPrecoder in configuredGrantConfig, the UE shall, for this PUSCH transmission, consider the transform precoding either enabled or disabled according to this parameter.\n-\tIf the UE is not configured with the higher layer parameter transformPrecoder in configuredGrantConfig, the UE shall, for this PUSCH transmission, consider the transform precoding either enabled or disabled according to the higher layer configured parameter msg3-transformPrecoder.\n6.1.4\tModulation order, redundancy version and transport block size determination\nTo determine the modulation order, target code rate, redundancy version and transport block size for the physical uplink shared channel, the UE shall first\n-\tread the 5-bit modulation and coding scheme field in the DCI scheduling PUSCH or provided in a DCI activating a configured grant Type 2 PUSCH, or as provided by mcsAndTBS as described in Clause 6.1.2.3 for a configured grant Type 1 PUSCH to determine the modulation order  and target code rate (R) based on the procedure defined in Clause 6.1.4.1\n-\tread redundancy version field (rv) in the DCI to determine the redundancy version for PUSCH scheduled by DCI, or determine the redundancy version according to Clause 6.1.2.3.1 for configured grant Type 1 and Type 2 PUSCH, \nand second\n-\tuse the number of layers , the total number of allocated PRBs  to determine the transport block size based on the procedure defined in Clause 6.1.4.2.\nWhen the UE is scheduled with multiple PUSCHs on a serving cell by a DCI, as described in clause 6.1.2.1, the bits of rv field and NDI field, respectively, in the DCI are one to one mapped to the scheduled PUSCH(s) indicated by the TDRA information field with the corresponding transport block(s) in the scheduled order where the LSB bits of the rv field and NDI field, respectively, correspond to the last scheduled PUSCH indicated by the TDRA information field. \nWithin a cell group, a UE is not required to handle PUSCH(s) transmissions in slot sj in serving cell-j, and for j = 0,1,2.. J-1, slot sj overlapping with any given point in time, if the following condition is not satisfied at that point in time: \n,\nwhere\n-\tJ is the number of configured serving cells belong to a frequency range\n-\tfor the j-th serving cell,\n-\tM is the number of TB(s) transmitted in slot-sj. For PUSCH repetition Type B, each actual repetition is counted separately.\n-\tTslot(j) =10-3/2(j), where (j) is the numerology for PUSCH(s) in slot sj of the j-th serving cell. \n-\tfor the m-th TB, \n-\tA is the number of bits in the transport block as defined in Clause 6.2.1 [5, TS 38.212] \n-\tC is the total number of code blocks for the transport block defined in Clause 5.2.2 [5, TS 38.212].\n-\tis the number of scheduled code blocks for the transport block as defined in Clause 5.4.2.1 [5,38.212] \n-\t [Mbps] is computed as the maximum data rate summed over all the carriers in the frequency range for any signaled band combination and feature set consistent with the configured servings cells, where the data rate value is given by the formula in Clause 4.1.2 in [13, TS 38.306], including the scaling factor f(i).\nFor a j-th serving cell, if higher layer parameter processingType2Enabled of PUSCH-ServingCellConfig is configured for the serving cell and set to 'enable', or if at least one IMCS > W for a PUSCH, where W = 28 for MCS tables 5.1.3.1-1 and 5.1.3.1-3, and W = 27 for MCS tables 5.1.3.1-2, 6.1.4.1-1, and 6.1.4.1-2, or if it is an actual repetition for PUSCH repetition Type B, the UE is not required to handle PUSCH transmissions, if the following condition is not satisfied:\n\nwhere\n-\tis the number of symbols assigned to the PUSCH\n-\tM is the number of TB in the PUSCH\n-\t where  is the numerology of the PUSCH \n-\tfor the m-th TB, \n-\tA is the number of bits in the transport block as defined in Clause 6.2.1 [5, TS 38.212] \n-\tC is the total number of code blocks for the transport block defined in Clause 5.2.2 [5, TS 38.212]\n-\t is the number of scheduled code blocks for the transport block as defined in Clause 5.4.2.1 [5, TS 38.212] \n-\t [Mbps] is computed as the maximum data rate for a carrier in the frequency band of the serving cell for any signaled band combination and feature set consistent with the serving cell, where the data rate value is given by the formula in Clause 4.1.2 in [13, TS 38.306], including the scaling factor f(i)\n-\teach actual repetition for PUSCH repetition type B is treated as one PUSCH.\n6.1.4.1\tModulation order and target code rate determination\nFor a PUSCH scheduled by RAR UL grant or \nfor a PUSCH scheduled by a fallbackRAR UL grant or\nfor a MsgA PUSCH transmission, or\nfor a PUSCH scheduled by a DCI format 0_0 with CRC scrambled by C-RNTI, MCS-C-RNTI, TC-RNTI, CS-RNTI, or \nfor a PUSCH scheduled by a DCI format 0_1 or DCI format 0_2 with CRC scrambled by C-RNTI, MCS-C-RNTI, CS-RNTI, SP-CSI-RNTI, or \nfor a PUSCH scheduled by a DCI format 0_3 with CRC scrambled by C-RNTI, MCS-C-RNTI, or\nfor a PUSCH with configured grant using CS-RNTI, and\nif transform precoding is disabled for this PUSCH transmission according to Clause 6.1.3\n-\tif mcs-TableDCI-0-2 in pusch-Config is set to 'qam256', and PUSCH is scheduled by a PDCCH with DCI format 0_2 with CRC scrambled by C-RNTI or SP-CSI-RNTI,\n-\tthe UE shall use IMCS and Table 5.1.3.1-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel;\n-\telseif the UE is not configured with MCS-C-RNTI, mcs-TableDCI-0-2  in pusch-Config is set to 'qam64LowSE', and the PUSCH is scheduled by a PDCCH by a PDCCH with DCI format 0_2 with CRC scrambled by C-RNTI or SP-CSI-RNTI,\n-\tthe UE shall use IMCS and Table 5.1.3.1-3 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\n-\telseif mcs-Table in pusch-Config is set to 'qam256', and PUSCH is scheduled by a PDCCH with DCI format 0_1 or 0_3with CRC scrambled by C-RNTI or SP-CSI-RNTI,\n-\tthe UE shall use IMCS and Table 5.1.3.1-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\n-\telseif the UE is not configured with MCS-C-RNTI, mcs-Table in pusch-Config is set to 'qam64LowSE', and the PUSCH is scheduled by a PDCCH with a DCI format other than DCI format 0_2 in a UE-specific search space with CRC scrambled by C-RNTI or SP-CSI-RNTI,\n-\tthe UE shall use IMCS and Table 5.1.3.1-3 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\n-\telseif the UE is configured with MCS-C-RNTI, and the PUSCH is scheduled by a PDCCH with CRC scrambled by MCS-C-RNTI,\n-\tthe UE shall use IMCS and Table 5.1.3.1-3 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\n-\telseif mcs-Table in configuredGrantConfig is set to 'qam256', \n-\tif PUSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or\n-\tif PUSCH is transmitted with configured grant\n-\tthe UE shall use IMCS and Table 5.1.3.1-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\n-\telseif mcs-Table in configuredGrantConfig is set to 'qam64LowSE', \n-\tif PUSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or\n-\tif PUSCH is transmitted with configured grant,\n-\tthe UE shall use IMCS and Table 5.1.3.1-3 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel. \n-\telseif for a MsgA PUSCH transmission, \n-\tthe UE shall use higher layer parameter msgA-MCS for IMCS and Table 5.1.3.1-1 to determine the Target code rate (R) used in the physical uplink shared channel.\n-\telseif the UE requests repetition of PUSCH scheduled by RAR UL grant [10, TS 38.321], when transmitting PUSCH scheduled by RAR UL grant,\n-\tthe 2 LSBs of the MCS information field of the RAR UL grant provide a codepoint to determine the MCS index IMCS according to Table 6.1.4.1-3, based on whether or not the higher layer parameter mcs-Msg3-Repetitions is configured. The UE shall use the determined IMCS and Table 5.1.3.1-1 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\n-\telseif the UE requests repetition of PUSCH scheduled by RAR UL grant [10, TS 38.321], when transmitting PUSCH scheduled by DCI format 0_0 with CRC scrambled by the TC-RNTI,\n-\tthe 3 LSBs of the MCS information field of the DCI format 0_0 with CRC scrambled by the TC-RNTI provide a codepoint to determine the MCS index IMCS according to Table 6.1.4.1-4, based on whether or not the higher layer parameter mcs-Msg3-Repetitions is configured. The UE shall use the determined IMCS and Table 5.1.3.1-1 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\n-\telse\n-\tthe UE shall use IMCS and Table 5.1.3.1-1 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\nelse\n-\tif mcs-TableTransformPrecoderDCI-0-2 in pusch-Config is set to 'qam256', and PUSCH is scheduled by a PDCCH with DCI format 0_2 with CRC scrambled by C-RNTI or SP-CSI-RNTI,\n-\tthe UE shall use IMCS and Table 5.1.3.1.-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel. \n-\telseif the UE is not configured with MCS-C-RNTI, mcs-TableTransformPrecoderDCI-0-2 in pusch-Config is set to 'qam64LowSE', and the PUSCH is scheduled by a PDCCH with DCI format 0_2 with CRC scrambled by C-RNTI or SP-CSI-RNTI,\n-\tthe UE shall use IMCS and Table 6.1.4.1-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\n-\telseif mcs-TableTransformPrecoder in pusch-Config is set to 'qam256', and PUSCH is scheduled by a PDCCH with DCI format 0_1 or 0_3 with CRC scrambled by C-RNTI or SP-CSI-RNTI,\n-\tthe UE shall use IMCS and Table 5.1.3.1.-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel. \n-\telseif the UE is not configured with MCS-C-RNTI, mcs-TableTransformPrecoder in pusch-Config is set to 'qam64LowSE', and the PUSCH is scheduled by a PDCCH with a DCI format other than DCI format 0_2 in a UE-specific search space with CRC scrambled by C-RNTI or SP-CSI-RNTI,\n-\tthe UE shall use IMCS and Table 6.1.4.1-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\n-\telseif the UE is configured with MCS-C-RNTI, and the PUSCH is scheduled by a PDCCH with CRC scrambled by MCS-C-RNTI,\n-\tthe UE shall use IMCS and Table 6.1.4.1-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\n-\telseif mcs-TableTransformPrecoder in configuredGrantConfig is set to 'qam256', \n-\tif PUSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or\n-\tif PUSCH is transmitted with configured grant,\n-\tthe UE shall use IMCS and Table 5.1.3.1-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\n-\telseif mcs-TableTransformPrecoder in configuredGrantConfig is set to 'qam64LowSE',\n-\tif PUSCH is scheduled by a PDCCH with CRC scrambled by CS-RNTI or\n-\tif PUSCH is transmitted with configured grant,\n-\tthe UE shall use IMCS and Table 6.1.4.1-2 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel. \n-\telseif for a MsgA PUSCH transmission,\n-\tthe UE shall use higher layer parameter MsgA-MCS for IMCS and Table 6.1.4.1-1 to determine the Target code rate (R) used in the physical uplink shared channel.\n-\tthe UE shall use q=2 for determining modulation order Qm in Table 6.1.4.1-1.\n-\telseif the UE requests repetition of PUSCH scheduled by RAR UL grant [10, TS 38.321], when transmitting PUSCH scheduled by RAR UL grant,\n-\tthe 2 LSBs of the MCS information field of the RAR UL grant provide a codepoint to determine the MCS index IMCS according to Table 6.1.4.1-3, based on whether or not the higher layer parameter mcs-Msg3-Repetitions is configured. The UE shall use the determined IMCS and Table 6.1.4.1-1 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\n-\telseif the UE requests repetition of PUSCH scheduled by RAR UL grant [10, TS 38.321], when transmitting PUSCH scheduled by DCI format 0_0 with CRC scrambled by the TC-RNTI,\n-\tthe 3 LSBs of the MCS information field of the DCI format 0_0 with CRC scrambled by the TC-RNTI provide a codepoint to determine the MCS index IMCS according to Table 6.1.4.1-4, based on whether or not the higher layer parameter mcs-Msg3-Repetitions is configured. The UE shall use the determined IMCS and Table 6.1.4.1-1 to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\n-\telse\n-\tthe UE shall use IMCS and Table 6.1.4.1-1to determine the modulation order (Qm) and Target code rate (R) used in the physical uplink shared channel.\nend\nFor Table 6.1.4.1-1 and Table 6.1.4.1-2, if higher layer parameter tp-pi2BPSK is configured, q = 1 otherwise q=2.\nTable 6.1.4.1-1: MCS index table for PUSCH with transform precoding and 64QAM\n\nTable 6.1.4.1-2: MCS index table 2 for PUSCH with transform precoding and 64QAM\n\nTable 6.1.4.1-3: MCS index IMCS as a function of 2 LSBs of MCS information field in RAR UL grant\n\nTable 6.1.4.1-4: MCS index IMCS as a function of 3 LSBs of MCS information field in DCI format 0_0 with CRC scrambled by the TC-RNTI\n\n6.1.4.2\tTransport block size determination\nFor eight antenna ports PUSCH transmission, when the number of PUSCH transmission layers is greater than 4, two codewords are transmitted. \nIf the higher layer parameter maxRank-n8 is configured or maxMIMO-Layers in PUSCH-config is greater than 4, then one of the two transport blocks is disabled by DCI format 0_1 if IMCS = 26 and if rvid = 1 for the corresponding transport block. If both transport blocks are enabled, transport block 1 and 2 are mapped to codeword 0 and 1 respectively. If only one transport block is enabled, then the enabled transport block is always mapped to the first codeword.\nFor a PUSCH scheduled by RAR UL grant or \nfor a PUSCH scheduled by fallbackRAR UL grant or\nfor a PUSCH scheduled by a DCI format 0_0 with CRC scrambled by C-RNTI, MCS-C-RNTI, TC-RNTI, CS-RNTI, or \nfor a PUSCH scheduled by a DCI format 0_1 or DCI format 0_2 with CRC scrambled by C-RNTI, MCS-C-RNTI, CS-RNTI, or \nfor a PUSCH scheduled by a DCI format 0_3 with CRC scrambled by C-RNTI, MCS-C-RNTI, or\nfor a PUSCH transmission with configured grant, or\nfor a MsgA PUSCH transmission,\nif\n-\tand transform precoding is disabled and Table 5.1.3.1-2 is used, or\n-\t and transform precoding is disabled and a table other than Table 5.1.3.1-2 is used, or \n-\t and transform precoding is enabled, the UE shall first determine the TBS as specified below:\nThe UE shall first determine the number of REs (NRE) within the slot: \n-\tA UE first determines the number of REs allocated for PUSCH within a PRB  by \n-\t, where is the number of subcarriers in the frequency domain in a physical resource block,  is the number of symbols L of the PUSCH allocation according to Clause 6.1.2.1 for scheduled PUSCH or Clause 6.1.2.3 for configured PUSCH,  is the number of REs for DM-RS per PRB in the allocated duration including the overhead of the DM-RS CDM groups without data, as described for PUSCH with a configured grant in Clause 6.1.2.3 or as indicated by DCI format 0_1, 0_2 or 0_3 or as described for DCI format 0_0 in Clause 6.2.2, and  is the overhead configured by higher layer parameter xOverhead in PUSCH-ServingCellConfig. If the  is not configured (a value from 6, 12, or 18), the  is assumed to be 0. For Msg3 or MsgA PUSCH transmission the  is always set to 0. In case of PUSCH repetition Type B,  is determined assuming a nominal repetition with the duration of L symbols without segmentation.\n-\tA UE determines the total number of REs allocated for PUSCH  as follows\n-\tFor TB processing over multiple slots,  where  is the total number of allocated PRBs for the UE and N is the number of slots used for TBS determination indicated by numberOfSlotsTBoMS.\n-\tOtherwise, . \n-\tNext, proceed with steps 2-4 as defined in Clause 5.1.3.2\n-\tFor a PUSCH scheduled by fallbackRAR UL grant, UE assumes the TB size determined by the UL grant in the fallbackRAR shall be the same as the TB size used in the corresponding MsgA PUSCH transmission.\nelse if\n-\t and transform precoding is disabled and Table 5.1.3.1-2 is used, or\n-\t and transform precoding is enabled, \n-\tthe TBS is assumed to be as determined from the DCI transported in the latest PDCCH for the same transport block using . If there is no PDCCH for the same transport block using , and if the initial PUSCH for the same transport block is scheduled by a RAR UL grant, the TBS shall be determined from the RAR UL grant. If there is no PDCCH for the same transport block using , and if the initial PUSCH for the same transport block is transmitted with configured grant, \n-\tthe TBS shall be determined from configuredGrantConfig for a configured grant Type 1 PUSCH.\n-\tthe TBS shall be determined from the most recent PDCCH scheduling a configured grant Type 2 PUSCH.\nelse\n-\tthe TBS is assumed to be as determined from the DCI transported in the latest PDCCH for the same transport block using . If there is no PDCCH for the same transport block using , and if the initial PUSCH for the same transport block is scheduled by a RAR UL grant, the TBS shall be determined from the RAR UL grant. If there is no PDCCH for the same transport block using , and if the initial PUSCH for the same transport block is transmitted with configured grant, \n-\tthe TBS shall be determined from configuredGrantConfig for a configured grant Type 1 PUSCH.\n-\tthe TBS shall be determined from the most recent PDCCH scheduling a configured grant Type 2 PUSCH.\n6.1.5\tCode block group based PUSCH transmission\nIf a UE is configured to transmit code block group (CBG) based transmissions by receiving the higher layer parameter codeBlockGroupTransmission in PUSCH-ServingCellConfig on a serving cell in a PUCCH group, the UE does not expect to be configured with higher layer parameter ScheduledCell-ListDCI-0-3 on any serving cell within the PUCCH group.\n6.1.5.1\tUE procedure for grouping of code blocks to code block groups\nIf a UE is configured to transmit code block group (CBG) based transmissions by receiving the higher layer parameter codeBlockGroupTransmission in PUSCH-ServingCellConfig, the UE shall determine the number of CBGs for a transport block transmission as \n,\nwhere N is the maximum number of CBGs per transport block as configured by maxCodeBlockGroupsPerTransportBlock in PUSCH-ServingCellConfig, and C is the number of code blocks in the transport block according to the procedure defined in Clause 6.2.3 of [5, TS 38.212].\nDefine , , and .\nIf , CBG m, , consists of code blocks with indices . CBG m, , consists of code blocks with indices .\n6.1.5.2\tUE procedure for transmitting code block group based transmissions\nIf a UE is configured to transmit code block group-based transmissions by receiving the higher layer parameter codeBlockGroupTransmission in PUSCH-ServingCellConfig, \n-\tFor an initial transmission of a TB as indicated by the 'New Data Indicator' field of the scheduling DCI, the UE may expect that the CBGTI field indicates all the CBGs of the TB are to be transmitted, and the UE shall include all the code block groups of the TB.\n-\tFor a retransmission of a TB as indicated by the 'New Data Indicator' field of the scheduling DCI, the UE shall include only the CBGs indicated by the CBGTI field of the scheduling DCI. \nA bit value of '0' in the CBGTI field indicates that the corresponding CBG is not to be transmitted and '1' indicates that it is to be transmitted. The order of CBGTI field bits is such that the CBGs are mapped in order from CBG#0 onwards starting from the MSB.\n6.1.6\tUplink switching\nThe UE may omit uplink transmission during the uplink switching gap  if the conditions defined in this clause are met and the UE is configured with uplinkTxSwitching. The switching gap  is indicated by UE capability uplinkTxSwitchingPeriod2T2T if uplinkTxSwitching-2T-Mode is configured, and uplinkTxSwitchingPeriod otherwise in clauses 6.1.6.1, 6.1.6.2.0, 6.1.6.3, and is determined based on UE capability uplinkTxSwitchingPeriodForBandPair in clause 6.1.6.2.2 for uplink switching with 3 or 4 uplink bands: \n-\tIf a UE indicated a capability for uplink switching with BandCombination-UplinkTxSwitch for a band combination, and if it is for that band combination\n-\tConfigured with a MCG using E-UTRA radio access and with a SCG using NR radio access (EN-DC), or\n-\tConfigured with uplink carrier aggregation, or\n-\tConfigured in a serving cell with two uplink carriers with higher layer parameter supplementaryUplink.\n\tThe conditions under which the switching gap may be present are defined for each of the cases in clauses 6.1.6.1, 6.1.6.2, and 6.1.6.3 respectively.\nIf an uplink switching is triggered for an uplink transmission starting at T0, after T0-Toffset, the UE is not expected to cancel the uplink switching, or to trigger any other new uplink switching occurring before T0 for any other uplink transmission that is scheduled after T0-Toffset, where Toffset is \n-\tdetermined based on the switching gap defined for a single Tx switching in [8, TS 38.101-1] when the Tx switching involves more than two bands, and there are at least two UL transmissions after switching on two switch-to bands that trigger the uplink switching, which are at least partially overlapped in time domain,\n-\tthe UE processing procedure time defined for the uplink transmission triggering the switch given in clause 5.3, clause 5.4, clause 6.2.1, clause 6.4 and in clause 9 of [6, TS 38.213], otherwise.\nThe UE does not expect to perform more than one uplink switching in a slot with \u00b5UL = max(\u00b5UL, 1, \u00b5UL, 2), where the \u00b5UL, 1 corresponds to the subcarrier spacing of the active UL BWP of one uplink carrier before the switching gap and the \u00b5UL, 2 corresponds to the subcarrier spacing of the active UL BWP of the other uplink carrier after the switching gap.\nFor uplink switching configured with 3 or 4 uplink bands\n-\tIf two contiguous intra-band uplink carriers are configured to a UE, the UE may assume that the active UL BWPs of the two carriers are configured with the same subcarrier spacing.\n-\tThe UE does not expect to perform more than one uplink switching in a reference slot with \u00b5UL, where the \u00b5UL corresponds to the maximum subcarrier spacing of the active UL BWPs of all the configured uplink carriers.\n-\tIf 500 \u00b5s is determined by the UE capability uplinkTxSwitchingMinimumSeparationTime, when within any two consecutive reference slots corresponding to numerology \u00b5UL, \n-\tthe UE first performs one uplink switch and later performs another uplink switch and \n-\tat least three bands are involved in the transmissions before the first switch, between the first switch and the second switch, and after the second switch, \nthe separation time between the start of all transmission(s) after the first switch and the start of all transmission(s) after the second switch is not expected to be less than 500 \u00b5s. If other than 500 \u00b5s is determined by the UE capability uplinkTxSwitchingMinimumSeparationTime, no additional restrictions apply.\n-\tIf an uplink switching is triggered for uplink transmission(s) with a gap between the start of the first uplink transmission(s) and the end of the last preceding uplink transmission(s) that is smaller than the determined switching gap , the UE determines the band of the switching period location, defined in [8, TS 38.101-1] based on the priority of the bands configured by uplinkTxSwitchingBandList. Among the bands either in switch-from or switch-to bands but not both, the switch is located on either, \n-\tthe switch-from band(s) if the highest priority band is a switch-to band, or\n-\tthe switch-to band(s) if the highest priority band is a switch-from band.\n6.1.6.1\tUplink switching for EN-DC\nFor a UE indicating a capability for uplink switching with BandCombination-UplinkTxSwitch for a band combination, and if it is for that band combination configured with a MCG using E-UTRA radio access and with a SCG using NR radio access (EN-DC), if the UE is configured with uplink switching with parameter uplinkTxSwitching,\n-\tfor the UE configured with switchedUL by the parameter uplinkTxSwitchingOption, when the UE is to transmit in the uplink based on DCI(s) received before  or based on a higher layer configuration(s):\n-\twhen the UE is to transmit an NR uplink that takes place after an E-UTRA uplink on another uplink carrier then the UE is not expected to transmit for the duration of  on any of the two carriers.\n-\twhen the UE is to transmit an E-UTRA uplink that takes place after an NR uplink on another uplink carrier then the UE is not expected to transmit for the duration of  on any of the two carriers.\n-\tthe UE is not expected to transmit simultaneously on the NR uplink and the E-UTRA uplink. If the UE is scheduled or configured to transmit any NR uplink transmission overlapping with an E-UTRA uplink transmission, the NR uplink transmission is dropped, \n-\tfor the UE configured with uplinkTxSwitchingOption set to 'dualUL', when the UE is to transmit in the uplink based on DCI(s) received before  or based on a higher layer configuration(s):\n-\twhen the UE is to transmit an NR two-port uplink that takes place after an E-UTRA uplink on another uplink carrier then the UE is not expected to transmit for the duration of  on any of the two carriers.\n-\twhen the UE is to transmit an E-UTRA uplink that takes place after an NR two-port uplink on another uplink carrier then the UE is not expected to transmit for the duration of  on any of the two carriers.\n-\tthe UE is not expected to transmit simultaneously a two- port transmission on the NR uplink and the E-UTRA uplink.\n-\tin all other cases the UE is expected to transmit normally all uplink transmissions without interruptions.\n-\twhen the UE is configured with tdm-PatternConfig or by tdm-PatternConfig2\n-\tfor the E-UTRA subframes designated as uplink by the configuration, the UE assumes the operation state in which one-port E-UTRA uplink can be transmitted. \n-\tfor the E-UTRA subframes other than the ones designated as uplink by the configuration, the UE assumes the operation state in which two-port NR uplink can be transmitted. \n6.1.6.2\tUplink switching for carrier aggregation\n6.1.6.2.0\tUplink switching with two uplink bands\nFor a UE indicating a capability for uplink switching with BandCombination-UplinkTxSwitch or uplinkTxSwitchingPeriod2T2T for a band combination, and if it is for that band combination configured with uplink carrier aggregation:\n-\tIf the UE is configured with uplink switching with parameter uplinkTxSwitching, when the UE is to transmit in the uplink based on DCI(s) received before  or based on a higher layer configuration(s):\n-\tWhen the UE is to transmit a 2-port transmission on one uplink carrier on one band and if the preceding uplink transmission is a 1-port transmission on another uplink carrier on another band, then the UE is not expected to transmit for the duration of  on any of the carriers.\n-\tWhen the UE is to transmit a 1-port transmission on one uplink carrier on one band and if the preceding uplink transmission is a 2-port transmission on another uplink carrier on another band, then the UE is not expected to transmit for the duration of  on any of the carriers. \n-\tFor the UE configured with uplinkTxSwitchingOption set to 'switchedUL', when the UE is to transmit a 1-port transmission on one uplink carrier on one band and if the preceding uplink transmission was a 1-port transmission on another uplink carrier on another band, then the UE is not expected to transmit for the duration of  on any of the carriers.\n-\tFor the UE configured with uplinkTxSwitchingOption set to 'dualUL', when the UE is to transmit a 2-port transmission on one uplink carrier on one band and if the preceding uplink transmission was a 1-port transmission on a carrier on the same band and the UE is under the operation state in which 2-port transmission cannot be supported in the same band, then the UE is not expected to transmit for the duration of  on any of the carriers.\n-\tFor the UE configured with uplinkTxSwitchingOption set to 'dualUL', when the UE is to transmit a 1-port transmission on one uplink carrier on one band and if the preceding uplink transmission was a 1-port transmission on another uplink carrier on another band and the UE is under the operation state in which 2-port transmission can be supported in the same band, then the UE is not expected to transmit for the duration of  on any of the carriers.\n-\tFor the UE configured with uplinkTxSwitchingOption set to 'dualUL', if the UE is configured with uplinkTxSwitching-DualUL-TxState set to 'oneT', when the UE is under the operation state in which 2-port transmission can be supported on one carrier on one band followed by no transmission on any carrier on the same band and 1-port transmission on the other carrier on another band the UE shall consider this as if 1-port transmission was transmitted on both uplinks, otherwise the UE shall consider this as if 2-port transmission took place on the transmitting carrier.\n-\tIf uplinkTxSwitching-2T-Mode is configured, when the UE is to transmit a 2-port transmission on one uplink carrier on one band and if the preceding uplink transmission is a 2-port transmission on another uplink carrier on another band, then the UE is not expected to transmit for the duration of  on any of the carriers.\n-\tThe UE is not expected to be scheduled or configured with uplink transmissions that result in simultaneous transmission on two antenna ports on one uplink carrier on one band, and any transmission on another uplink carrier on another band.\n-\tIn all other cases the UE is expected to transmit normally all uplink transmissions without interruptions.\n6.1.6.2.1\tvoid\n6.1.6.2.2\tUplink switching with 3 or 4 uplink bands\nFor a UE indicating a capability for uplink switching with BandCombination-UplinkTxSwitch for a band combination, and if it is for that band combination configured with uplink carrier aggregation with 3 or 4 bands, the behaviour in subclause 6.1.6.2.0 applies when the two bands involved in the uplink switching belong to different uplink serving cells, and the behavior in subclause 6.1.6.3 applies when the two bands involved in the uplink switching belong to one uplink serving cell, with the following exceptions:\n-\tIf more than two bands are involved in the determination of one uplink switching and if on any two of the bands the UE is configured with switchingOptionConfigForBandPair set to 'dualUL',\n-\tWhen the UE is to transmit a 2-port transmission on one uplink carrier on the 1st band and if the preceding uplink transmission was a 1-port transmission on a carrier on the 2nd and/or 3rd band and the UE is under the operation state in which 1-port transmission can be supported in the 2nd and 3rd band, then the UE is not expected to transmit for the duration of NTx1-Tx2 on any of the carriers, where NTx1-Tx2 is the switching gap defined in [8, TS 38.101-1].\n-\tWhen the UE is to transmit a 1-port transmission on one uplink carrier on the 1st band and the 2nd band, and if the preceding uplink transmission was a 1-port or 2-port transmission on a carrier on the 3rd band and the UE is under the operation state in which 2-port transmission can be supported on the 3rd band, then the UE is not expected to transmit for the duration of NTx1-Tx2 on any of the carriers, where NTx1-Tx2 is the switching gap defined in [8, TS3 8.101-1].\n-\tWhen the UE is to transmit a 1-port transmission on one uplink carrier on the 1st band and the 2nd band, and if the preceding uplink transmission was a 1-port transmission on a carrier on the 1st band and/or the 3rd band and the UE is under the operation state in which 1-port transmission can be supported in the 1st and 3rd band, if UE indicates maintainedUL-Trans for the 1st band for band pair{the 2nd band, the 3rd band} then the UE is not expected to transmit for the duration of NTx1-Tx2 on any of the carriers on the 2nd band and the 3rd band, otherwise then the UE is not expected to transmit for the duration of NTx1-Tx2 on any of the carriers , where NTx1-Tx2 is the switching gap defined in [8, TS 38.101-1].\n-\tWhen the UE is to transmit a 1-port transmission on one uplink carrier on the 1st band and the 2nd band, and if the preceding uplink transmission was a 1-port transmission on a carrier on the 3rd band and/or the 4th band and the UE is under the operation state in which 1-port transmission can be supported in the 3rd and 4th band, then the UE is not expected to transmit for the duration of NTx1-Tx2 on any of the carriers, where NTx1-Tx2 is theswitching gap defined in [8, TS 38.101-1].\n-\tThe UE is not expected to be scheduled or configured to transmit on more than two uplink bands at any given time. \n-\tIf the UE indicated a uplinkTxSwitchingOptionForBandPair set to \u2018DualUL\u2019, or \u2018Both\u2019 for a band pair in the band combination, the UE can be configured with switchingOptionConfigForBandPair set to 'dualUL' for that band pair.\n-\tIf the UE indicated a uplinkTxSwitchingOptionForBandPair set to \u2018SwitchedUL\u2019, or \u2018Both\u2019 for a band pair in the band combination, the UE can be configured with switchingOptionConfigForBandPair set to 'switchedUL' for that band pair.\n-\tIf the UE is configured with uplinkTxSwitching-DualUL-TxState set to 'oneT', when the UE is under the operation state in which 1-port transmission can be supported on one carrier on the 1st band and the 2nd band followed by no transmission on any carrier on these two bands and 1-port transmission on the other carrier on the 3rd band the UE shall consider this as if 1-port transmission was transmitted on the 3rd band and the band associated with the 3rd band as configured by associatedBand, otherwise the UE shall consider this as if 2-port transmission took place on the transmitting carrier. Even if all cells in a band are deactivated, that does not invalidate the associated band configuration that is indicating the band as associated band for the other band(s) for the definition in clause 6.1.6.\n-\tIf the UE is configured with uplinkTxSwitching-DualUL-TxState set to 'oneT', if a band in the band combination is not configured as dualUL for any band pair it belongs to, when the UE is to transmit a 1-port transmission on a carrier on the band the UE shall consider this as if 2-port transmission took place on the transmitting carrier.\n6.1.6.3\tUplink switching with two uplink bands for supplementary uplink\nFor a UE indicating a capability for uplink switching with BandCombination-UplinkTxSwitch for a band combination, and if it is for that band combination configured in a serving cell with two uplink carriers with higher layer parameter supplementaryUplink:\n-\tIf the UE is configured with uplink switching with parameter uplinkTxSwitching,\n-\tIf the UE is to transmit any uplink channel or signal on a different uplink on a different band from the preceding transmission occasion based on DCI(s) received before  or based on a higher layer configuration(s), then the UE assumes that an uplink switching is triggered in a duration of switching gap , where  is the start time of the first symbol of the transmission occasion of the uplink channel or signal and  is the preparation procedure time of the transmission occasion of the uplink channel or signal given in clause 5.3, clause 5.4, clause 6.2.1, clause 6.4 and in clause 9 of [6, TS 38.213], respectively. During the switching gap , the UE is not expected to transmit on any of the two uplinks.\n-\tIn all other cases the UE is expected to transmit normally all uplink transmissions without interruptions.\n6.1.7\tUE procedure for determining time domain windows for bundling DM-RS\nFor PUSCH transmissions of PUSCH repetition Type A scheduled by DCI format 0_1 or 0_2, PUSCH repetition Type A with a configured grant, PUSCH repetition Type B and TB processing over multiple slots, when pusch-DMRS-Bundling is enabled, and for PUCCH transmissions of PUCCH repetition, when PUCCH-DMRS-Bundling is enabled, the UE determines one or multiple nominal TDWs, as follows:\n-\tFor PUSCH transmissions of repetition Type A, PUSCH repetition Type B and TB processing over multiple slots, the duration of each nominal TDW except the last nominal TDW, in number of consecutive slots, is:\n-\tGiven by pusch-TimeDomainWindowLength, if configured.\n-\tComputed as min (maxDurationDMRS-Bundling, M), if pusch-TimeDomainWindowLength is not configured, where maxDurationDMRS-Bundling is maximum duration for a nominal TDW subject to UE capability [13, TS 38.306], M is the time duration in consecutive slots of  PUSCH transmissions, and where:\n-\tFor PUSCH transmissions of PUSCH repetition Type A, N=1 and K is the number of repetitions, as defined in Clause 6.1.2.1 or in Clause 6.1.2.3.\n-\tFor PUSCH transmissions of PUSCH repetition Type B, N=1 and K is the number of nominal repetitions, as defined in Clause 6.1.2.1 or in Clause 6.1.2.3.\n-\tFor PUSCH transmissions of TB processing over multiple slots, N is the number of slots used for TBS determination and K is the number of repetitions of the number of slots N used for TBS determination, as defined in Clause 6.1.2.1 or in Clause 6.1.2.3.\n-\tFor PUCCH transmissions of PUCCH repetition, the duration of each nominal TDW except the last nominal TDW, in number of consecutive slots, is:\n-\tGiven by pucch-TimeDomainWindowLength, if configured.\n-\tComputed as min (maxDurationDMRS-Bundling, M), if pucch-TimeDomainWindowLength is not configured, where maxDurationDMRS-Bundling is maximum duration for a nominal TDW subject to UE capability [13, TS 38.306], M is the time duration in consecutive slots from the first slot determined for PUCCH transmissions of PUCCH repetition to the last slot determined for PUCCH transmissions of PUCCH repetition according to clause 9.2.6 of [6, TS 38.213].\n-\tFor PUSCH transmission of a PUSCH repetition Type A scheduled by DCI format 0_1, 0_2 or 0_3 and PUSCH repetition Type A with a configured grant, when AvailableSlotCounting is enabled, and for TB processing over multiple slots:\n-\tThe start of the first nominal TDW is the first slot determined for the first PUSCH transmission.\n-\tThe end of the last nominal TDW is the last slot determined for the last PUSCH transmission.\n-\tThe start of any other nominal TDWs is the first slot determined for PUSCH transmission after the last slot determined for PUSCH transmission of a previous nominal TDW.\n-\tFor PUSCH transmissions of a PUSCH repetition type A scheduled by DCI format 0_1, 0_2 or 0_3 and PUSCH repetition Type A with a configured grant, when the UE is not configured with AvailableSlotCounting or when AvailableSlotCounting is disabled, and for PUSCH repetition type B:\n-\tThe start of the first nominal TDW is the first slot for the first PUSCH transmission.\n-\tThe end of the last nominal TDW is the last slot for the last PUSCH transmission.\n-\tThe start of any other nominal TDWs is the first slot after the last slot of a previous nominal TDW.\n-\tFor PUCCH transmissions of a PUCCH repetition:\n-\tThe start of the first nominal TDW is the first slot determined for the first PUCCH transmission.\n-\tThe end of the last nominal TDW is the last slot determined for the last PUCCH transmission.\n-\tThe start of any other nominal TDWs is the first slot determined for PUCCH transmission after the last slot determined for PUCCH transmission of a previous nominal TDW.\nFor PUSCH transmissions of a PUSCH repetition Type A scheduled by DCI format 0_1, 0_2 or 0_3, PUSCH repetition Type A with a configured grant, PUSCH repetition Type B and TB processing over multiple slots, a nominal TDW consists of one or multiple actual TDWs. The UE determines the actual TDWs as follows: \n-\tThe start of the first actual TDW is the first symbol of the first PUSCH transmission in a slot for PUSCH transmission of PUSCH repetition type A scheduled by DCI format 0_1, 0_2 or 0_3, or PUSCH repetition Type A with a configured grant, or PUSCH repetition type B or TB processing over multiple slots within the nominal TDW.\n-\tThe end of an actual TDW is\n-\tThe last symbol of the last PUSCH transmission in a slot for PUSCH transmission of PUSCH repetition type A scheduled by DCI format 0_1, 0_2 or 0_3, or PUSCH repetition Type A with a configured grant, or PUSCH repetition type B or TB processing over multiple slots within the nominal TDW, if the actual TDW reaches the end of the last PUSCH transmission within the nominal TDW.\n-\tThe last symbol of a PUSCH transmission before the event, if an event occurs which causes power consistency and phase continuity not to be maintained across PUSCH transmissions of PUSCH repetition type A scheduled by DCI format 0_1, 0_2 or 0_3, or PUSCH repetition Type A with a configured grant, or PUSCH repetition type B or TB processing over multiple slots within the nominal TDW, and the PUSCH transmission is in a slot for PUSCH transmission of PUSCH repetition type A scheduled by DCI format 0_1, 0_2 or 0_3, or PUSCH repetition Type A with a configured grant, or PUSCH repetition type B or TB processing over multiple slots.\n-\tWhen pusch-WindowRestart is enabled, the start of a new actual TDW is the first symbol of the PUSCH transmission after the event which causes power consistency and phase continuity not to be maintained across PUSCH transmissions of PUSCH repetition type A scheduled by DCI format 0_1, 0_2 or 0_3, or PUSCH repetition Type A with a configured grant, or PUSCH repetition type B or TB processing over multiple slots within the nominal TDW, and the PUSCH transmission is in a slot for PUSCH transmission of PUSCH repetition type A scheduled by DCI format 0_1, 0_2 or 0_3, or PUSCH repetition Type A with a configured grant, or PUSCH repetition type B or TB processing over multiple slots.\nFor PUCCH transmissions of PUCCH repetition, a nominal TDW consists of one or multiple actual TDWs. The UE determines the actual TDWs as follows:\n-\tThe start of the first actual TDW is the first symbol of the first PUCCH transmission in a slot determined for PUCCH transmission within the nominal TDW.\n-\tThe end of an actual TDW is\n-\tThe last symbol of the last PUCCH transmission in a slot determined for transmission of the PUCCH within the nominal TDW, if the actual TDW reaches the end of the last PUCCH transmission within the nominal TDW.\n-\tThe last symbol of a PUCCH transmission before the event, if an event occurs which causes power consistency and phase continuity not be maintained across PUCCH transmissions of PUCCH repetition within the nominal TDW, and the PUCCH transmission is in a slot determined for transmission of the PUCCH.\n-\tWhen pucch-WindowRestart is enabled, the start of a new actual TDW is the first symbol of the PUCCH transmission after the event which causes power consistency and phase continuity not to be maintained across PUCCH transmissions of PUCCH repetition within the nominal TDW, and the PUCCH transmission is in a slot determined for transmission of the PUCCH.\nEvents which cause power consistency and phase continuity not to be maintained across PUSCH transmissions of PUSCH repetition type A scheduled by DCI format 0_1, 0_2 or 0_3, or PUSCH repetition Type A with a configured grant, or PUSCH repetition type B or TB processing over multiple slots, or PUCCH transmissions of PUCCH repetition, within the nominal TDW, are:\n-\tA downlink slot or downlink reception or downlink monitoring based on tdd-UL-DL-ConfigurationCommon and\u00a0tdd-UL-DL-ConfigurationDedicated\u00a0for unpaired spectrum.\n-\tThe gap between any two consecutive PUSCH transmissions, or the gap between any two consecutive PUCCH transmissions, exceeds 13 symbols for normal cyclic prefix or exceeds 11 symbols for extended cyclic prefix.\n-\tThe gap between any two consecutive PUSCH transmissions, or the gap between any two consecutive PUCCH transmissions, does not exceed 13 symbols but other uplink transmissions are scheduled between the two consecutive PUSCH transmissions or the two consecutive PUCCH transmissions.\n-\tFor PUSCH transmissions of PUSCH repetition type A, or PUSCH repetition type B or TB processing over multiple slots, a dropping or cancellation of a PUSCH transmission according to clause 9, clause 11.1 and clause 11.2A of [6, TS 38.213].\n-\tFor PUCCH transmissions of PUCCH repetition, a dropping or cancellation of a PUCCH transmission according to clause 9, clause 9.2.6 and clause 11.1 of [6, TS 38.213].\n-\tFor any two consecutive PUSCH transmissions of PUSCH repetition type A, or PUSCH repetition type B, and when two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook' or 'noncodebook', a different SRS resource set association is used for the two PUSCH transmissions of PUSCH repetition type A, or PUSCH repetition type B, according to Clause 6.1.2.1.\n-\tFor any two consecutive PUCCH transmissions of PUCCH repetition, and when a PUCCH resource used for repetitions of a PUCCH transmission by a UE includes first and second spatial relations or first and second sets of power control parameters, as described in [10, TS 38.321] and in clause 7.2.1 of [6, TS 38.213], different spatial relations or different power control parameters are used for the two PUCCH transmissions of PUCCH repetition, according to Clause 9.2.6 of [6, TS 38.213]. \n-\tUplink timing adjustment in response to a timing advance command according to clause 4.2 of [6, TS 38.213].\n-\tFrequency hopping.\n-\tFor reduced capability half-duplex UEs, \n-\ta dropping or cancellation of a PUSCH or PUCCH transmission according to clause 17.2 of [6, TS 38.213] or\n-\tan overlapping of the gap between two consecutive PUSCH or two consecutive PUCCH transmissions and any symbol of downlink reception or downlink monitoring\nThe UE shall maintain power consistency and phase continuity within an actual TDW, across PUSCH transmissions of PUSCH repetition Type A scheduled by DCI format 0_1, 0_2 or 0_3, or PUSCH repetition Type A with a configured grant, or PUSCH repetition type B or TB processing over multiple slots, or across PUCCH transmissions of PUCCH repetition, in case the actual TDW is created in response to frequency hopping, or in response to the use of a different SRS resource set association for the two PUSCH transmissions of PUSCH repetition type A, or PUSCH repetition type B, or in response to the use of different spatial relations or different power control parameters for the two PUCCH transmissions of PUCCH repetition, or in response to any event not triggered by DCI or MAC-CE. The UE maintains power consistency and phase continuity within an actual TDW, across PUSCH transmissions of PUSCH repetition Type A scheduled by DCI format 0_1, 0_2 or 0_3, or PUSCH repetition Type A with a configured grant, or PUSCH repetition type B or TB processing over multiple slots, or across PUCCH transmissions of PUCCH repetition, in case the actual TDW is created in response to an event triggered by DCI other than frequency hopping or the use of a different SRS resource set association for the two PUSCH transmissions of PUSCH repetition type A, or PUSCH repetition type B, or the use of different spatial relations or different power control parameters for the two PUCCH transmissions of PUCCH repetition, or in response to an event triggered by MAC-CE, subject to UE capability. of dmrs-BundlingRestart [13, TS 38.306] and when pusch-WindowRestart or pucch-WindowRestart is enabled.\n6.2\tUE reference signal (RS) procedure\n6.2.1\tUE sounding procedure\nThe UE may be configured with one or more Sounding Reference Signal (SRS) resource sets as configured by the higher layer parameter SRS-ResourceSet or SRS-PosResourceSet. For each SRS resource set configured by SRS-ResourceSet, a UE may be configured with SRS resources (higher layer parameter SRS-Resource), where the maximum value of K is indicated by UE capability [13, 38.306]. When SRS resource set is configured with the higher layer parameter SRS-PosResourceSet, a UE may be configured with K \u22651 SRS resources (higher layer parameter SRS-PosResource), where the maximum value of K is 16. The SRS resource set applicability is configured by the higher layer parameter usage in SRS-ResourceSet. When the higher layer parameter usage is set to 'beamManagement', only one SRS resource in each of multiple SRS resource sets may be transmitted at a given time instant, but the SRS resources in different SRS resource sets with the same time domain behaviour in the same BWP may be transmitted simultaneously. For a given CC, multiple SRS resources across multiple sets with usage \u201cbeamManagement\u201d are not expected to be partially overlapped in time.\nDuring non-active periods of cell DRX, the UE configured with cell DRX is not expected to transmit the periodic SRS, or semi-persistent SRS for channel acquisition. SRS for positioning is not impacted by cell DRX operation.\nFor the SRS resource set(s) configured in srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage set to 'antennaSwitching' or 'beamManagement', the UE expects the same SRS resource set(s) with the same usage being configured in srs-ResourceSetToAddModList.\nWhen the UE is configured dl-OrJointTCI-StateList or ul-TCI-StateList, the UE can assume that SRS resource(s) in any SRS resource set, except SRS resource set for positioning and an SRS resource set configured with followUnifiedTCI-StateSRS, can be configured with TCI-State or TCI-UL-State or updated as described in clause 6.1.3.59 or 6.1.3.60 of [10, TS 38.321]. The reference RS in the TCI-State can be a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter repetition, or a CSI-RS resource in an NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info. The reference RS in the TCI-UL-State(s) can be a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter repetition, a CSI-RS resource in an NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info, an SRS resource with the higher layer parameter usage set to 'beamManagement', or SS/PBCH block associated with the same or different PCI from the PCI of the serving cell.\nIf an SRS resource set, except an SRS resource set for positioning, is configured with followUnifiedTCI-StateSRS, the UE shall transmit the target SRS resource(s) within the SRS resource set according to the spatial relation, if applicable, with a reference to the RS used for determining UL TX spatial filter. The RS is determined based on an RS configured with qcl-Type set to 'typeD' in QCL-Info of the indicated TCI-State or an RS in the indicated TCI-UL-State. The reference RS in the indicated TCI-State can be a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter repetition, or a CSI-RS resource in an NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info. The reference RS in the indicated TCI-UL-State can be a CSI-RS resource in a NZP-CSI-RS-ResourceSet configured with higher layer parameter repetition, a CSI-RS resource in an NZP-CSI-RS-ResourceSet configured with higher layer parameter trs-Info, an SRS resource with the higher layer parameter usage set to 'beamManagement', or SS/PBCH block associated with the same or different PCI from the PCI of the serving cell.\nWhen the UE is configured dl-OrJointTCI-StateList or TCI-UL-State and is having two indicated TCI-States or TCI-UL-States, and if the UE is configured with [[followUnifiedTCI-StateSRS]] to, a periodic, semi-persistent or aperiodic SRS resource set with higher layer parameter usage in SRS-ResourceSet set to 'codebook', 'nonCodebook' or 'antennaSwitching' or to an aperiodic SRS resource set with higher layer parameter usage in SRS-ResourceSet set to 'beamManagement' \n-\tThe UE may be configured by higher layer parameter applyIndicatedTCIState to the SRS resource set to indicate whether the UE shall apply the first or the second indicated TCI-State or TCI-UL-State to the SRS resource set. \n-\tWhen a UE is configured by higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet, the first and second indicated TCI-States or TCI-UL-States correspond to the indicated TCI-States or TCI-UL-States specific to coresetPoolIndex value 0 and value 1, respectively. \n-\tWhen a UE is configured by higher layer parameter PDCCH-Config that contains two different values of coresetPoolIndex in ControlResourceSet, and the aperiodic SRS resource set which is not configured with higher layer parameter applyIndicatedTCIState and the aperiodic SRS resource set is triggered by PDCCH on a CORESET associated with a coresetPoolIndex value, the UE shall apply the indicated TCI-State or TCI-UL-State specific to the coresetPoolIndex value to the aperiodic SRS resource set. \n-\tWhen two SRS resource sets with higher layer parameter usage in SRS-ResourceSet set to 'codebook' or 'nonCodebook' are configured, the UE does not expectthat the first indicated TCI-State or TCI-UL-State is applied to the second SRS resource set and that the second indicated TCI-State or TCI-UL-State is applied to the first SRS resource set.\nFor aperiodic SRS at least one state of the DCI field is used to select at least one out of the configured SRS resource set(s).\nThe following SRS parameters are semi-statically configurable by higher layer parameter SRS-Resource or SRS-PosResource.\n-\tsrs-ResourceId or SRS-PosResourceId determines SRS resource configuration identity.\n-\tNumber of SRS ports, as defined by the higher layer parameter nrofSRS-Ports or nrofSRS-Ports-n8 and described in clause 6.4.1.4 of [4, TS 38.211]. If not configured, nrofSRS-Ports is 1.\n-\tTime domain behaviour of SRS resource configuration as indicated by the higher layer parameter resourceType, which may be periodic, semi-persistent, aperiodic SRS transmission as defined in clause 6.4.1.4 of [4, TS 38.211].\n-\tSlot level periodicity and slot level offset as defined by the higher layer parameters periodicityAndOffset-p or periodicityAndOffset-sp for an SRS resource of type periodic or semi-persistent. The UE is not expected to be configured with SRS resources in the same SRS resource set SRS-ResourceSet or SRS-PosResourceSet with different slot level periodicities. For an SRS-ResourceSet configured with higher layer parameter resourceType set to 'aperiodic', a slot level offset is defined by the higher layer parameter slotOffset. For an SRS-ResourceSet configured with higher layer parameter resourceType set to 'aperiodic', a list of up to four different available slot offset values from the reference slot n + k to the slot where the aperiodic SRS resource set is transmitted where n is the slot with triggering DCI and k is slotOffset, can be configured by the higher layer parameter availableSlotOffsetList. The parameter availableSlotOffsetList can be configured up to 4 different values. For an SRS-PosResourceSet configured with higher layer parameter resourceType set to 'aperiodic', the slot level offset is defined by the higher layer parameter slotOffset for each SRS resource. \n-\tsrs-PosHyperSFN-Index indicates whether the current hyper-frame number is even or odd for SRS for positioning transmission, if configured.\n-\tSupport of time division mapping subsets of ports of the SRS resource into S symbols (S=2), as defined by the higher layer parameter nrofSRS-Ports-n8 set to ports8tdm, where the SRS ports are evenly distributed in two consecutive symbols over the symbols in a slot for the SRS resource according to clause 6.4.1.4.2 in [4, TS 38.211]. This applies when the SRS resource set is configured with higher layer parameter usage in SRS-ResourceSet set to 'codebook', or 'antennaSwitching', and nrofSRS-Ports-n8 is set to 'ports8tdm'.\n-\tComb offset hopping pattern with repetition, as defined by the higher layer parameter hoppingWithRepetition, where the parameter can be set to either 'symbol' or 'repetition' subject to UE capability. When the parameter is set to 'symbol', the comb offset hopping pattern is determined by the symbol index, and the comb offset hopping pattern is determined by the symbol index of the first symbol of the repetition when the parameter is set to 'repetition' according to clause 6.4.1.4.3 in [4, TS 38.211].\n-\tNumber of OFDM symbols in the SRS resource, starting OFDM symbol of the SRS resource within a slot including repetition factor R as defined by the higher layer parameter resourceMapping and described in clause 6.4.1.4 of [4, TS 38.211]. If R is not configured for positioning SRS, then R is equal to the number of OFDM symbols in the SRS resource.\n-\tSRS bandwidth and , as defined by the higher layer parameter freqHopping and described in clause 6.4.1.4 of [4, TS 38.211]. If not configured, then= 0.\n-\tFrequency hopping bandwidth , as defined by the higher layer parameter freqHopping and described in clause 6.4.1.4 of [4, TS 38.211]. If not configured, then = 0.\n-\tDefining partial frequency sounding factor and start RB index for partial frequency sounding as defined by the higher layer parameters FreqScalingFactor PF and StartRBIndex kF, respectively, and described in Clause 6.4.1.4 of [4, TS 38.211]. If not configured, then PF = 1 and kF,= 0.\n-\tDefining start RB index hopping for partial frequency sounding in different SRS frequency hopping periods for aperiodic/periodic/semi-persistent SRS based on the hopping pattern khop as described in clause 6.4.1.4.3 in [4, TS 38.211. If not configured, then start RB hopping is not enabled and khop is fixed to be 0 for all SRS symbols.\n-\tDefining frequency domain position and configurable shift, as defined by the higher layer parameters freqDomainPosition and freqDomainShift, respectively, and described in clause 6.4.1.4 of [4, TS 38.211]. If freqDomainPosition is not configured, freqDomainPosition is zero.\n-\tCyclic shift, as defined by the higher layer parameter cyclicShift-n2, cyclicShift-n4, or cyclicShift-n8 for transmission comb value 2, 4 or 8, and described in clause 6.4.1.4 of [4, TS 38.211]. When cyclic shift hopping is configured by the higher layer parameter cyclicShiftHopping for an SRS resource in an SRS resource set with the usage configured as 'antennaSwitching' or 'codebook', subject to UE capabilities, cyclic shift is updated at every symbol as described in [clause 6,4,1,4 of [4, TS 38.211]]. For the cyclic shift hopping, a UE can be configured with a subset of cyclic shifts by the higher layer parameter hoppingSubset, where the cyclic shift hopping is performed only across the cyclic shifts configured in the subset. For the cyclic shift hopping, a UE can be configured with finer hopping granularity by the higher layer parameter hoppingFinerGranularity. The UE is not expecting that hoppingFinerGranularity and hoppingSubset are configured simultaneously in cyclicShiftHopping for an SRS resource. The UE is not expecting that the cyclic shift hopping and the higher layer parameter nrofSRS-Ports-n8 set to ports8tdm are configured simultaneously for an SRS resource.\n-\tTransmission comb value, as defined by the higher layer parameter transmissionComb described in clause 6.4.1.4 of [4, TS 38.211].\n-\tTransmission comb offset, as defined by the higher layer parameter combOffset-n2, combOffset-n4, and combOffset-n8 for transmission comb value 2, 4, or 8, and described in clause 6.4.1.4 of [4, TS 38.211]. When comb offset hopping is configured by the higher layer parameter combOffsetHopping for an SRS resource in an SRS resource set with the usage configured as 'antennaSwitching' or 'codebook', subject to UE capabilities, transmission comb offset(s) are updated as described in clause 6.4.1.4 of [4, TS 38.211]. For the comb offset hopping, a UE can be configured with a subset of comb offsets by the higher layer parameter hoppingSubset, where the comb offset hopping is performed only across the comb offsets configured in the subset. The UE is not expecting that the comb offset hopping and the higher layer parameter nrofSRS-Ports-n8 set to ports8tdm are configured simultaneously.\n-\tSRS sequence ID, as defined by the higher layer parameter sequenceId in clause 6.4.1.4 of [4, TS 38.211].\n-\tSRS cyclic shift and/or comb offset hopping ID, as defined by the higher layer parameter hoppingID in cyclicShiftHopping and/or combOffsetHopping, respectively.\n-\tThe configuration of the spatial relation between a reference RS and the target SRS, where the higher layer parameter spatialRelationInfo or spatialRelationInfoPos, if configured, contains the ID of the reference RS. The reference RS may be an SS/PBCH block, CSI-RS configured on serving cell indicated by higher layer parameter servingCellId if present, same serving cell as the target SRS otherwise, or an SRS configured on uplink BWP indicated by the higher layer parameter uplinkBWP, and serving cell indicated by the higher layer parameter servingCellId if present, same serving cell as the target SRS otherwise. When the target SRS is configured by the higher layer parameter SRS-PosResourceSet, the reference RS may also be a DL PRS configured on a serving cell or a non-serving cell indicated by the higher layer parameter dl-PRS, or an SS/PBCH block of a non-serving cell indicated by the higher layer parameter ssb-Ncell. If the UE is configured with dl-OrJointTCI-StateList or ul-TCI-StateList, the reference RS may additionally be an SS/PBCH block associated with a PCI different from the PCI of the serving cell.\nThe UE may be configured by the higher layer parameter resourceMapping in SRS-Resource with an SRS resource occupying  adjacent OFDM symbols within the last 6 symbols of the slot, or at any symbol location within the slot if resourceMapping-r16 is provided subject to UE capability, where all antenna ports of the SRS resources are mapped to each symbol of the resource. When the SRS is configured with the higher layer parameter SRS-PosResourceSet the higher layer parameter resourceMapping-r16 in SRS-PosResource indicates an SRS resource occupying  adjacent symbols anywhere within the slot. When the SRS is configured with the higher layer parameter SRS-ResourceSet, the higher layer parameter resourceMapping-r17 in SRS-Resource indicates an SRS resource occupying  adjacent symbols anywhere within the slot.  is divisible by, where S = 2 when nrofSRS-Ports-n8 is set to ports8tdm is configured and S = 1 otherwise, and R is the repetition factor.\nIf a PUSCH with a priority index 0 and SRS configured by SRS-Resource are transmitted in the same slot on a serving cell, the UE may only be configured to transmit SRS after the transmission of the PUSCH and the corresponding DM-RS. \nIf a PUSCH transmission with a priority index 1 or a PUCCH transmission with a priority index 1 would overlap in time with an SRS transmission on a serving cell, the UE does not transmit the SRS in the overlapping symbol(s).\nFor a UE configured with one or more SRS resource configuration(s), and when the higher layer parameter resourceType in SRS-Resource or SRS-PosResource is set to 'periodic':\n-\tif the UE is configured with the higher layer parameter spatialRelationInfo, spatialRelationInfo-PDC or spatialRelationInfoPos containing the ID of a reference 'ssb-Index', 'ssb-IndexServing', or 'ssb-IndexNcell', the UE shall transmit the target SRS resource with the same spatial domain transmission filter used for the reception of the reference SS/PBCH block, if the higher layer parameter spatialRelationInfo, spatialRelationInfo-PDC or spatialRelationInfoPos contains the ID of a reference 'csi-RS-Index' or 'csi-RS-IndexServing', the UE shall transmit the target SRS resource with the same spatial domain transmission filter used for the reception of the reference periodic CSI-RS or of the reference semi-persistent CSI-RS, if the higher layer parameter spatialRelationInfo, spatialRelationInfo-PDC or spatialRelationInfoPos containing the ID of a reference 'srs' or 'srs-spatialRelation', the UE shall transmit the target SRS resource with the same spatial domain transmission filter used for the transmission of the reference periodic SRS. When the SRS is configured by the higher layer parameter SRS-PosResource and if the higher layer parameter spatialRelationInfoPos contains the ID of a reference 'dl-PRS', the UE shall transmit the target SRS resource with the same spatial domain transmission filter used for the reception of the reference DL PRS. When the SRS is configured by the higher layer parameter SRS-Resource and if the higher layer parameter spatialRelationInfo-PDC contains the ID of a reference 'dl-PRS-PDC', the UE shall transmit the target SRS resource with the same spatial domain transmission filter used for the reception of the reference DL PRS for RTT-based propagation delay compensation according to clause 9.\nFor a UE configured with one or more SRS resource configuration(s), and when the higher layer parameter resourceType in SRS-Resource or SRS-PosResource is set to 'semi-persistent':\n-\twhen a UE receives an activation command, as described in clause 6.1.3.17 or 6.1.3.36 of [10, TS 38.321], for an SRS resource, and when the UE would transmit a PUCCH with HARQ-ACK information in slot n corresponding to the PDSCH carrying the activation command, the corresponding actions in [10, TS 38.321] and the UE assumptions on SRS transmission corresponding to the configured SRS resource set shall be applied starting from the first slot that is after slot  where \uf06d is the SCS configuration for the PUCCH. The activation command also contains spatial relation assumptions provided by a list of references to reference signal IDs, one per element of the activated SRS resource set. When the SRS is configured with the higher layer parameter SRS-ResourceSet, each ID in the list refers to a reference SS/PBCH block, NZP CSI-RS resource configured on serving cell indicated by Resource Serving Cell ID field in the activation command if present, same serving cell as the SRS resource set otherwise, or SRS resource configured on serving cell and uplink bandwidth part indicated by Resource Serving Cell ID field and Resource BWP ID field in the activation command if present, same serving cell and bandwidth part as the SRS resource set otherwise. When the SRS is configured with the higher layer parameter SRS-PosResourceSet, each ID in the list of reference signal IDs may refer to a reference SS/PBCH block on a serving or non-serving cell indicated by PCI field in the activation command, NZP CSI-RS resource configured on serving cell indicated by Resource Serving Cell ID field in the activation command if present, same serving cell as the SRS resource set otherwise, SRS resource configured on serving cell and uplink bandwidth part indicated by Resource Serving Cell ID field and Resource BWP ID field in the activation command if present, same serving cell and bandwidth part as the SRS resource set otherwise, or DL PRS resource of a serving or non-serving cell associated with a dl-PRS-ID indicated by DL-PRS ID field in the activation command.\n-\tif an SRS resource in the activated resource set is configured with the higher layer parameter spatialRelationInfo or spatialRelationInfoPos, the UE shall assume that the ID of the reference signal in the activation command overrides the one configured in spatialRelationInfo or spatialRelationInfoPos.\n-\twhen a UE receives a deactivation command [10, TS 38.321] for an activated SRS resource set, and when the UE would transmit a PUCCH with HARQ-ACK information in slot n corresponding to the PDSCH carrying the deactivation command, the corresponding actions in [10, TS 38.321] and UE assumption on cessation of SRS transmission corresponding to the deactivated SRS resource set shall apply starting from the first slot that is after slot  where \uf06d is the SCS configuration for the PUCCH.\n-\tif the UE is configured with the higher layer parameter spatialRelationInfo or spatialRelationInfoPos containing the ID of a reference 'ssb-Index', 'ssb-IndexServing', or 'ssb-IndexNcell' the UE shall transmit the target SRS resource with the same spatial domain transmission filter used for the reception of the reference SS/PBCH block, if the higher layer parameter spatialRelationInfo or spatialRelationInfoPos contains the ID of a reference 'csi-RS-Index' or 'csi-RS-IndexServing', the UE shall transmit the target SRS resource with the same spatial domain transmission filter used for the reception of the reference periodic CSI-RS or of the reference semi-persistent CSI-RS, if the higher layer parameter spatialRelationInfo or spatialRelationInfoPos contains the ID of a reference 'srs' or 'srs-SpatialRelation', the UE shall transmit the target SRS resource with the same spatial domain transmission filter used for the transmission of the reference periodic SRS or of the reference semi-persistent SRS. When the SRS is configured by the higher layer parameter SRS-PosResourceSet and if the higher layer parameter spatialRelationInfoPos contains the ID of a reference 'dl-PRS', the UE shall transmit the target SRS resource with the same spatial domain transmission filter used for the reception of the reference DL PRS.\nIf the UE has an active semi-persistent SRS resource configuration and has not received a deactivation command, the semi-persistent SRS configuration is considered to be active in the UL BWP which is active, otherwise it is considered suspended.\nFor a UE configured with one or more SRS resource configuration(s), and when the higher layer parameter resourceType in SRS-Resource or SRS-PosResource is set to 'aperiodic':\n-\tthe UE receives a configuration of SRS resource sets,\n-\tthe UE receives a downlink DCI, a group common DCI, or an uplink DCI based command where a codepoint of the DCI may trigger one or more SRS resource set(s). For SRS in a resource set with usage set to 'codebook' or 'antennaSwitching', the minimal time interval between the last symbol of the PDCCH triggering the aperiodic SRS transmission and the first symbol of SRS resource is N2  symbols and an additional time duration  Tswitch. Otherwise, the minimal time interval between the last symbol of the PDCCH triggering the aperiodic SRS transmission and the first symbol of SRS resource is N2 +14 symbols and an additional time duration Tswitch. The minimal time interval unit of OFDM symbol is counted based on the minimum subcarrier spacing given by min(\u00b5PDCCH, \u00b5UL) where \u00b5UL is given by min(\u00b5UL,carrier1, \u00b5UL,carrier2, \u00b5SRS) when the UE is configured with the higher layer parameter uplinkTxSwitchingOption set to 'dualUL' for uplink carrier aggregation, and by \u00b5SRS otherwise. \u00b5SRS and \u00b5PDCCH are the subcarrier spacing configurations for triggered SRS and PDCCH carrying the triggering command respectively. \n-\tTswitch, \u00b5UL,carrier1 and \u00b5UL,carrier2 are defined in clause 6.4.\n-\tA UE reporting its UE capability 'srs-TriggeringDCI' can be indicated with DCI 0_1 and 0_2 to trigger aperiodic SRS without data and without CSI as described in clause 7.3.1.1 of [5, TS 38.212]. Otherwise, except for DCI format 0_1/0_2 with CRC scrambled by SP-CSI-RNTI, a UE is not expected to receive a DCI format 0_1/0_2 with UL-SCH indicator of \"0\" and CSI request of all zero(s) as described in clause 7.3.1.1 of [5, TS 38.212].\n-\tIf the UE receives the DCI triggering aperiodic SRS in slot n and at least one resource set is configured with parameter availableSlotOffset across all configured BWPs in a component carrier except when SRS is configured with the higher layer parameter SRS-PosResource, \n-\tIf ca-SlotOffset is configured, the UE transmits aperiodic SRS in each of the triggered SRS resource set(s) in the (t + 1)-th available slot counting from slot , \n-\totherwise the UE transmits aperiodic SRS in each of the triggered SRS resource set(s) in the (t + 1)-th available slot counting from slot , where   is a parameter configured by higher layer as specified in clause 4.2 of [6 TS 38.213], and where\n-\tk is configured via higher layer parameter slotOffset for each triggered SRS resources set and is based on the subcarrier spacing of the triggered SRS transmission, \u00b5SRS and \u00b5PDCCH are the subcarrier spacing configurations for triggered SRS and PDCCH carrying the triggering command, respectively.\n-\tis the subcarrier spacing configuration for  with a value of 0 for frequency range 1.\n-\t\u00a0and  are the \u00a0and the, respectively, which are determined by higher-layer configured ca-SlotOffset for the cell receiving the PDCCH, \u00a0and \u00a0are the \u00a0and the, respectively, which are determined by higher-layer configured ca-SlotOffset for the cell transmitting the SRS, as defined in [4, TS 38.211] clause 4.5.\n-\tAn available slot is a slot satisfying there are UL or flexible symbol(s) for the time-domain location(s) for all the SRS resources in the resource set and it satisfies UE capability on the minimum timing requirement between triggering PDCCH and all the SRS resources in the resource set. From the first symbol carrying the SRS request DCI to the last symbol of the triggered SRS resource set, UE does not expect to receive SFI indication, UL cancellation indication or dynamic scheduling of DL channel/signal(s) on flexible symbol(s) that may change the determination of available slot.\n-\tt is configured via higher layer parameter availableSlotOffsetList with up to four different values of AvailableSlotOffset for each triggered SRS resources set and it is based on the subcarrier spacing of the triggered SRS transmission. When one or more SRS resource sets across all configured BWPs in a component carrier are configured, and at least one resource set is configured with availableSlotOffsetList parameter of more than one values, the indicated value of t is indicated by SOI field in DCI scheduling PUSCH/PDSCH and DCI 0_1/0_2 without data and without CSI request described in [5, TS 38.212]. The UE shall apply indicated value t specifically for those sets with configured availableSlotOffsetList parameter. When one or more SRS resource sets across all configured BWPs in a component carrier are configured and at least one resource set is configured with availableSlotOffsetList parameter, and the availableSlotOffsetList parameter for each SRS resource set has only one value, the UE shall apply the configured value specifically for those sets with configured availableSlotOffsetList parameter. For SRS resource set configured with availableSlotOffsetList parameter, each of resource set is configured with K values of AvailableSlotOffset. For SRS resource set configured without availableSlotOffsetList parameter, t = 0 is applied for the resource set.\n-\tIf the UE receives the DCI triggering aperiodic SRS in slot n and none of the resource sets is configured with parameter availableSlotOffsetList across all configured BWPs in a component carrier except when SRS is configured with the higher layer parameter SRS-PosResource \n-\tif the UE is configured with ca-SlotOffset for at least one of the triggered and triggering cell, the UE transmits aperiodic SRS in each of the triggered SRS resource set(s) in slot ,\n-\totherwise, the UE transmits aperiodic SRS in each of the triggered resource set(s) in slot , where  is a parameter configured by higher layer as specified in clause 4.2 of [6 TS 38.213], and where \n-\tk is configured via higher layer parameter slotOffset for each triggered SRS resources set and is based on the subcarrier spacing of the triggered SRS transmission, \u00b5SRS and \u00b5PDCCH are the subcarrier spacing configurations for triggered SRS and PDCCH carrying the triggering command respectively;\n-\tis the subcarrier spacing configuration for  with a value of 0 for frequency range 1.\n-\t and are the  and the, respectively, which are determined by higher-layer configured ca-SlotOffset for the cell receiving the PDCCH,  and  are the  and the , respectively, which are determined by higher-layer configured ca-SlotOffset for the cell transmitting the SRS, as defined in [4, TS 38.211] clause 4.5. \n-\tIf the UE receives the DCI triggering aperiodic SRS in slot n and when SRS is configured with the higher layer parameter SRS-PosResource, the UE transmits every aperiodic SRS resource in each of the triggered SRS resource set(s) in slot , if UE is configured with ca-SlotOffset for at least one of the triggered and triggering cell, , otherwise, where  is a parameter configured by higher layer as specified in clause 4.2 of [6 TS 38.213], and where \n-\tk is configured via higher layer parameter slotOffset for each aperiodic SRS resource in each triggered SRS resources set and is based on the subcarrier spacing of the triggered SRS transmission, \u00b5SRS and \u00b5PDCCH are the subcarrier spacing configurations for triggered SRS and PDCCH carrying the triggering command respectively;\n-\t is the subcarrier spacing configuration for  with a value of 0 for frequency range 1.\n-\t and are the  and the, respectively, which are determined by higher-layer configured ca-SlotOffset for the cell receiving the PDCCH,  and  are the  and the , respectively, which are determined by higher-layer configured ca-SlotOffset for the cell transmitting the SRS, as defined in [4, TS 38.211] clause 4.5.\n-\tif the UE is configured with the higher layer parameter spatialRelationInfo or spatialRelationInfoPos containing the ID of a reference 'ssb-Index', 'ssb-IndexServing' or 'ssb-IndexNcell', the UE shall transmit the target SRS resource with the same spatial domain transmission filter used for the reception of the reference SS/PBCH block, if the higher layer parameter spatialRelationInfo or spatialRelationInfoPos contains the ID of a reference 'csi-RS-Index' or 'csi-RS-IndexServing', the UE shall transmit the target SRS resource with the same spatial domain transmission filter used for the reception of the reference periodic CSI-RS or of the reference semi-persistent CSI-RS, or of the latest reference aperiodic CSI-RS. If the higher layer parameter spatialRelationInfo or spatialRelationInfoPos contains the ID of a reference 'srs' or 'srs-SpatialRelation', the UE shall transmit the target SRS resource with the same spatial domain transmission filter used for the transmission of the reference periodic SRS or of the reference semi-persistent SRS or of the reference aperiodic SRS. When the SRS is configured by the higher layer parameter SRS-PosResourceSet and if the higher layer parameter spatialRelationInfoPos contains the ID of a reference 'dl-PRS', the UE shall transmit the target SRS resource with the same spatial domain transmission filter used for the reception of the reference DL PRS.\n-\twhen a UE receives an spatial relation update command, as described in clause 6.1.3.26 of [10, TS 38.321], for an SRS resource configured with the higher layer parameter SRS-Resource, and when the HARQ-ACK corresponding to the PDSCH carrying the update command is transmitted in slot n, the corresponding actions in [10, TS 38.321] and the UE assumptions on updating spatial relation for the SRS resource shall be applied for SRS transmission starting from the first slot that is after slot where \uf06d is the SCS configuration for the PUCCH. The update command contains spatial relation assumptions provided by a list of references to reference signal IDs, one per element of the updated SRS resource set. Each ID in the list refers to a reference SS/PBCH block, NZP CSI-RS resource configured on serving cell indicated by Resource Serving Cell ID field in the update command if present, same serving cell as the SRS resource set otherwise, or SRS resource configured on serving cell and uplink bandwidth part indicated by Resource Serving Cell ID field and Resource BWP ID field in the update command if present, same serving cell and bandwidth part as the SRS resource set otherwise. When the UE is configured with the higher layer parameter usage in SRS-ResourceSet set to 'antennaSwitching', the UE shall not expect to be configured with different spatial relations for SRS resources in the same SRS resource set.\nThe UE is not expected to be configured with different time domain behavior for SRS resources in the same SRS resource set. The UE is also not expected to be configured with different time domain behavior between SRS resource and associated SRS resources set. \nFor operation in the same carrier, the UE is not expected to be configured on overlapping symbols with a SRS resource configured by the higher layer parameter SRS-PosResource and a SRS resource configured by the higher layer parameter SRS-Resource with resourceType of both SRS resources as 'periodic'.\nFor operation in the same carrier, the UE is not expected to be activated or triggered to transmit SRS on overlapping symbols with a SRS resource configured by the higher layer parameter SRS-PosResource and a SRS resource configured by the higher layer parameter SRS-Resource with resourceType of both SRS resources as 'semi-persistent' or 'aperiodic'.\nFor operations in the same carrier, the UE is not expected to be configured on overlapping symbols with more than one SRS resources configured by the higher layer parameter SRS-PosResource with resourceType of the SRS resources as 'periodic'.\nFor operations in the same carrier, the UE is not expected to be activated or triggered to transmit SRS on overlapping symbols with more than one SRS resources configured by the higher layer parameter SRS-PosResource with resourceType of the SRS resources as 'semi-persistent' or 'aperiodic'.\nFor intra-band and inter-band CA operations, a UE can simultaneously transmit more than one SRS resource configured by SRS-PosResource on different CCs, subject to UE's capability\nFor intra-band and inter-band CA operations, a UE can simultaneously transmit more than one SRS resource configured by SRS-PosResource and SRS-Resource on different CCs, subject to UE's capability.\nThe SRS request field [5, TS38.212] in DCI format 0_1, 1_1, 0_2 (if SRS request field is present), 1_2 (if SRS request field is present), 0_3, 1_3 indicates the triggered SRS resource set given in Table 7.3.1.1.2-24 of [5, TS 38.212]. The 2-bit SRS request field in DCI format 2_3 indicates the triggered SRS resource set given in clause 7.3 of [5, TS 38.212] and defined by the entries of the higher layer parameter srs-ResourceSetToAddModList if the UE is configured with higher layer parameter srs-TPC-PDCCH-Group set to 'typeB', or indicates the SRS transmission on a set of serving cells configured by higher layers if the UE is configured with higher layer parameter srs-TPC-PDCCH-Group set to 'typeA'.\nFor PUCCH and SRS on the same carrier, a UE shall not transmit SRS when semi-persistent or periodic SRS is configured in the same symbol(s) with PUCCH carrying only CSI report(s), or only L1-RSRP report(s), or only L1-SINR report(s). A UE shall not transmit SRS when semi-persistent or periodic SRS is configured or aperiodic SRS is triggered to be transmitted in the same symbol(s) with PUCCH carrying HARQ-ACK, link recovery request (as defined in clause 9.2.4 of [6, 38.213]) and/or SR. In the case that SRS is not transmitted due to overlap with PUCCH, only the SRS symbol(s) that overlap with PUCCH symbol(s) are dropped. PUCCH shall not be transmitted when aperiodic SRS is triggered to be transmitted to overlap in the same symbol with PUCCH carrying semi-persistent/periodic CSI report(s) or semi-persistent/periodic L1-RSRP report(s) only, or only L1-SINR report(s). \nIn case of intra-band contiguous carrier aggregation, or in inter-band or intra-band non-contiguous CA band combination if simultaneous SRS and PUCCH/PUSCH transmissions are not supported by UE, the UE is not expected to be indicated with a SRS transmission from a carrier and to be configured or scheduled with a PUSCH/UL DM-RS/UL PT-RS/PUCCH transmission from a different carrier in the same symbol.\nIn case of intra-band contiguous carrier aggregation, or in inter-band CA band combination if simultaneous SRS and PRACH transmissions are not supported by UE, or in case of intra-band non-contiguous CA band combination if the UE is not configured with higher layer parameter intraBandNC-PRACH-simulTx-r17, the UE shall not transmit simultaneously SRS resource(s) from a carrier and PRACH from a different carrier. \nIn case of intra-band contiguous carrier aggregation, or in inter-band CA band combination if simultaneous SRS and MsgA transmissions are not supported by UE, the UE shall not transmit simultaneously SRS resource(s) from a carrier and MsgA from a different carrier.\nIn case a SRS resource with resourceType set as 'aperiodic' is triggered on the OFDM symbol(s) configured with periodic/semi-persistent SRS transmission, the UE shall transmit the aperiodic SRS resource and only the periodic/semi-persistent SRS symbol(s) overlapping within the symbol(s) are dropped, while the periodic/semi-persistent SRS symbol(s) that are not overlapped with the aperiodic SRS resource are transmitted. In case a SRS resource with resourceType set as 'semi-persistent' is triggered on the OFDM symbol(s) configured with periodic SRS transmission, the UE shall transmit the semi-persistent SRS resource and only the periodic SRS symbol(s) overlapping within the symbol(s) are dropped, while the periodic SRS symbol(s) that are not overlapped with the semi-persistent SRS resource are transmitted. \nWhen the UE is configured with the higher layer parameter usage in SRS-ResourceSet set to 'antennaSwitching', and a guard period of Y symbols is configured according to Clause 6.2.1.2, the UE shall use the same priority rules as defined above during the guard period as if SRS was configured. \nWhen a spatialRelationInfo is activated/updated for a semi-persistent or aperiodic SRS resource configured by the higher layer parameter SRS-Resource by a MAC CE for a set of CCs/BWPs, where the applicable list of CCs provided by higher layer parameter simultaneousSpatial-UpdatedList1 or simultaneousSpatial-UpdatedList2 is determined by the indicated CC in the MAC CE, the spatialRelationInfo is applied for the semi-persistent or aperiodic SRS resource(s) with the same SRS resource ID for all the BWPs in the determined CCs.\nWhen the higher layer parameter enableDefaultBeamPL-ForSRS is set 'enabled', and if the higher layer parameter spatialRelationInfo for the SRS resource, except for the SRS resource with the higher layer parameter usage in SRS-ResourceSet set to 'beamManagement' or for the SRS resource with the higher layer parameter usage in SRS-ResourceSet set to 'nonCodebook' with configuration of associatedCSI-RS or for the SRS resource configured by the higher layer parameter SRS-PosResourceSet, or dl-OrJointTCI-StateList or ul-TCI-StateList is not configured in frequency range 2 and if the UE is not configured with higher layer parameter(s) pathlossReferenceRS, and if the UE is not configured with different values of coresetPoolIndex in ControlResourceSets, and\u00a0is not provided\u00a0at least one TCI codepoint mapped with\u00a0two TCI states, the UE shall transmit the target SRS resource in an active UL BWP of a CC,\n-\taccording to the spatial relation, if applicable, with a reference to the RS configured with qcl-Type set to 'typeD' corresponding to the QCL assumption of the CORESET with the lowest controlResourceSetId in the active DL BWP in the CC. If the CORESET is activated with two TCI states, sfnSchemePdcch is configured and the UE supports sfn-DefaultUL-BeamSetup-r17, UE shall use the first TCI state as the QCL assumption.\n-\taccording to the spatial relation, if applicable, with a reference to the RS configured with qcl-Type set to 'typeD' in the activated TCI state with the lowest ID applicable to PDSCH in the active DL BWP of the CC if the UE is not configured with any CORESET in the active DL BWP of the CC.\nFor a SRS resource, if nrofSRS-Ports-n8 is set to ports8tdm or combOffsetHopping is configured, the corresponding UE SRS frequency hopping procedure is specified in clause 6.4.1.4.3 of [4, TS 38.211]. If for a SRS resource nrofSRS-Ports-n8 is not configured or it is not set to ports8tdm and combOffsetHopping is not configured, the UE SRS frequency hopping procedure is specified in clause 6.4.1.4.3 of [4, TS 38.211] and in clause 6.2.1.1.\n6.2.1.1\tUE SRS frequency hopping procedure\nFor a given SRS resource, the UE is configured with repetition factor R\u2208{1,2,4} or R\u2208{1,2,3,4,5,6,7,8,10,12,14} by higher layer parameter resourceMapping in SRS-Resource where R\u2264Ns. When frequency hopping within an SRS resource in each slot is not configured (R=Ns), each of the antenna ports of the SRS resource in each slot is mapped in all the  symbols to the same set of subcarriers in the same set of PRBs. When frequency hopping within an SRS resource in each slot is configured without repetition (R=1), according to the SRS hopping parameters , and defined in clause 6.4.1.4 of [4, TS 38.211], each of the antenna ports of the SRS resource in each slot is mapped to different sets of subcarriers in each OFDM symbol, where the same transmission comb value is assumed for different sets of subcarriers. When both frequency hopping and repetition within an SRS resource in each slot are configured (Ns \u2265 4, R \u2265 2), each of the antenna ports of the SRS resource in each slot is mapped to the same set of subcarriers within each set of R adjacent OFDM symbols, and frequency hopping across the  sets is according to the SRS hopping parameters , and , where  should be divisible by .\nFor operation with shared spectrum channel access in FR1, the UE does not expect that multiple hops of an SRS resource transmission are in different RB sets.\nA UE may be configured  adjacent symbol aperiodic SRS resource with intra-slot frequency hopping within a bandwidth part, where the full hopping bandwidth is sounded with an equal-size subband across  symbols when frequency hopping is configured with R=1. A UE may be configured Ns \u2265 4 adjacent symbols aperiodic SRS resource with intra-slot frequency hopping within a bandwidth part, where the full hopping bandwidth is sounded with an equal-size subband across  sets of R adjacent OFDM symbols, when frequency hopping is configured with R \u2265 2, Ns \u2265 R and Ns  should be divisible by R. Each of the antenna ports of the SRS resource is mapped to the same set of subcarriers within each set of R adjacent OFDM symbols of the resource.\nA UE may be configured symbol periodic or semi-persistent SRS resource with inter-slot hopping within a bandwidth part, where the SRS resource occupies the same symbol location in each slot. A UE may be configured  symbol periodic or semi-persistent SRS resource with intra-slot and inter-slot hopping within a bandwidth part, where the SRS resource occupies the same symbol location(s) in each slot. For Ns \u2265 4, when frequency hopping is configured with R \u2265 2, intra-slot and inter-slot hopping is supported with each of the antenna ports of the SRS resource mapped to different sets of subcarriers across  sets of R adjacent OFDM symbol(s) of the resource in each slot, where  should be divisible by R. Each of the antenna ports of the SRS resource is mapped to the same set of subcarriers within each set of R adjacent OFDM symbols of the resource in each slot. For Ns= R, when frequency hopping is configured, inter-slot frequency hopping is supported with each of the antenna ports of the SRS resource mapped to the same set of subcarriers in R adjacent OFDM symbol(s) of the resource in each slot.\n6.2.1.2\tUE sounding procedure for DL CSI acquisition\nWhen the UE is configured with the higher layer parameter usage in SRS-ResourceSet set as 'antennaSwitching', the UE may be configured with only one of the following configurations depending on the indicated UE capability supportedSRS-TxPortSwitch ('t1r2' for 1T2R, 't1r1-t1r2' for 1T=1R/1T2R, 't2r4' for 2T4R, 't1r4' for 1T4R, 't1r1-t1r2-t1r4' for 1T=1R/1T2R/1T4R, 't1r4-t2r4' for 1T4R/2T4R, 't1r1-t1r2-t2r2-t2r4' for 1T=1R/1T2R/2T=2R/2T4R, 't1r1-t1r2-t2r2-t1r4-t2r4' for 1T=1R/1T2R/2T=2R/1T4R/2T4R, 't1r1' for 1T=1R, 't2r2' for 2T=2R, 't1r1-t2r2' for 1T=1R/2T=2R, 't4r4' for 4T=4R, or 't1r1-t2r2-t4r4' for 1T=1R/2T=2R/4T=4R) or the UE may be configured with only one of the following configurations depending on the indicated UE capability supportedSRS-TxPortSwitchBeyond4Rx ('t1r1' for 1T=1R, 't2r2' for 2T=2R, 't1r2' for 1T2R, 't4r4' for 4T=4R, 't2r4' for 2T4R, 't1r4' for 1T4R, 't2r6' for 2T6R, 't1r6' for 1T6R, 't4r8' for 4T8R, 't2r8' for 2T8R, 't1r8' for 1T8R) or the UE may be configured with the following configurations depending on the indicated UE capability [newUECapabilitySupporting8T8R] ('t1r1' for 1T=1R, 't2r2' for 2T=2R, 't1r2' for 1T2R, 't4r4' for 4T=4R, 't2r4' for 2T4R, 't1r4' for 1T4R, 't2r6' for 2T6R, 't1r6' for 1T6R, 't4r8' for 4T8R, 't2r8' for 2T8R, 't1r8' for 1T8R, \u2018[noTDM]\u2019 or \u2018[TDM and noTDM]\u2019 for 8T8R):\n-\tFor 1T2R, if the UE is indicating srs-AntennaSwitching2SP-1Periodic and/or srs-ExtensionAperiodicSRS:\n-\twhen the UE is indicating srs-AntennaSwitching2SP-1Periodic only, then up to two SRS resource sets with resourceType in SRS-ResourceSet set to 'semi-persistent' and up to one SRS resource set with resourceType in SRS-ResourceSet set to 'periodic' can be configured, or up to two SRS resource sets configured with a different value for the higher layer parameter resourceType in SRS-ResourceSet can be configured, where the two SRS resource sets configured with 'semi-persistent' are not activated at the same time, each SRS resource set has two SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a single SRS port, and the SRS port of the second resource in the set is associated with a different UE antenna port than the SRS port of the first resource in the same set.\n-\twhen the UE is indicating srs-ExtensionAperiodicSRS only, then up to two SRS resource sets with resourceType in SRS-ResourceSet set to 'aperiodic' and up to one SRS resource set with resourceType in SRS-ResourceSet set to 'periodic' or 'semi-persistent' can be configured, or up to two SRS resource sets configured with a different value for the higher layer parameter resourceType in SRS-ResourceSet can be configured. In the case of two resource sets with resourceType in SRS-ResourceSet set to 'aperiodic', a total of two SRS resources are transmitted in different symbols of two different slots, the SRS port of each SRS resource in the given two sets is associated with a different UE antenna port and the two sets are each configured with one SRS resource. In the case of the one resource set with resourceType in SRS-ResourceSet set to 'aperiodic' is configured, a total of two SRS resources transmitted in different symbols of one slot and where the SRS port of the second resource in the given set is associated with a different UE antenna port than the SRS port of the first resource in the same set. Each SRS resource set with 'resourceType' in SRS-ResourceSet set to 'periodic' or 'semi-persistent' has two SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a single SRS port, and the SRS port of the second resource in the set is associated with a different UE antenna port than the SRS port of the first resource in the same set.\n-\tzero or one or two SRS resource sets configured with different value of resourceType in SRS-ResourceSet set to 'periodic' or 'semi-persistent' if the UE is not indicating srs-AntennaSwitching2SP-1Periodic, or up to two SRS resource sets configured with resourceType in SRS-ResourceSet set to 'semi-persistent' and up to one SRS resource set configured with resourceType in SRS-ResourceSet set to 'periodic' if the UE is indicating srs-AntennaSwitching2SP-1Periodic, where the two SRS resource sets configured with 'semi-persistent' are not activated at the same time. An SRS resource set has two SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a single SRS port, and the SRS port of the second resource in the set is associated with a different UE antenna port than the SRS port of the first resource in the same set, and\n-\tzero or one SRS resource set with resourceType in SRS-ResourceSet set to 'aperiodic' if the UE is not indicating srs-ExtensionAperiodicSRS, or up to two SRS resource sets configured with resourceType in SRS-ResourceSet set to 'aperiodic' if the UE is indicating srs-ExtensionAperiodicSRS, where in the case of one resource set, a total of two SRS resources transmitted in different symbols of one slot and where the SRS port of the second resource in the given set is associated with a different UE antenna port than the SRS port of the first resource in the same set. In the case of two resource sets, a total of two SRS resources are transmitted in different symbols of two different slots, the SRS port of each SRS resource in the given two sets is associated with a different UE antenna port. The two sets are each configured with one SRS resource, or\n-\totherwise, for 1T2R, up to two SRS resource sets configured with a different value for the higher layer parameter resourceType in SRS-ResourceSet set, where each set has two SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a single SRS port, and the SRS port of the second resource in the set is associated with a different UE antenna port than the SRS port of the first resource in the same set, or\n-\tFor 2T4R, if the UE is indicating srs-AntennaSwitching2SP-1Periodic and/or srs-ExtensionAperiodicSRS:\n-\twhen the UE is indicating srs-AntennaSwitching2SP-1Periodic only, then up to two SRS resource sets with resourceType in SRS-ResourceSet set to 'semi-persistent' and up to one SRS resource set with resourceType in SRS-ResourceSet set to 'periodic' can be configured, or up to two SRS resource sets configured with a different value for the higher layer parameter resourceType in SRS-ResourceSet can be configured, where the two SRS resource sets configured with 'semi-persistent' are not activated at the same time, each SRS resource set has two SRS resources transmitted in different symbols, each SRS resource in a given set consisting of two SRS ports, and the SRS port pair of the second resource is associated with a different UE antenna port pair than the SRS port pair of the first resource.\n-\twhen the UE is indicating srs-ExtensionAperiodicSRS only, then up to two SRS resource sets with resourceType in SRS-ResourceSet set to 'aperiodic' and up to one SRS resource set with resourceType in SRS-ResourceSet set to 'periodic' or 'semi-persistent' can be configured, or up to two SRS resource sets configured with a different value for the higher layer parameter resourceType in SRS-ResourceSet can be configured. In the case of two resource sets with resourceType in SRS-ResourceSet set to 'aperiodic', a total of two SRS resources are transmitted in different symbols of two different slots, the SRS port pair of each SRS resource in the given two sets is associated with a different UE antenna port pair and the two sets are each configured with one SRS resource. In the case of one resource set with resourceType in SRS-ResourceSet set to 'aperiodic' is configured, a total of two SRS resources transmitted in different symbols in the same slot, each SRS resource in a given set consisting of two SRS ports, and the SRS port pair of the second resource is associated with a different UE antenna port pair than the SRS port pair of the first resource. Each SRS resource set with 'resourceType' in SRS-ResourceSet set to 'periodic' or 'semi-persistent' has two SRS resources transmitted in different symbols, each SRS resource in a given set consisting of two SRS ports, and the SRS port pair of the second resource is associated with a different UE antenna port pair than the SRS port pair of the first resource.\n-\tzero or one or two SRS resource sets configured with a different value for the higher layer parameter resourceType in SRS-ResourceSet set to 'periodic' or 'semi-persistent' if the UE is not indicating srs-AntennaSwitching2SP-1Periodic, or up to two SRS resource sets configured with resourceType in SRS-ResourceSet set to 'semi-persistent' and up to one SRS resource set configured with resourceType in SRS-ResourceSet set to 'periodic' if the UE is indicating srs-AntennaSwitching2SP-1Periodic, where the two SRS resource sets configured with 'semi-persistent' are not activated at the same time. Each SRS resource set has two SRS resources transmitted in different symbols, each SRS resource in a given set consisting of two SRS ports, and the SRS port pair of the second resource is associated with a different UE antenna port pair than the SRS port pair of the first resource, and, \n-\tzero or one SRS resource set configured with resourceType in SRS-ResourceSet set to 'aperiodic' if the UE is not indicating srs-ExtensionAperiodicSRS, or up to two SRS resource sets configured with resourceType in SRS-ResourceSet set to 'aperiodic' if the UE is indicating srs-ExtensionAperiodicSRS, where in the case of one resource set, a total of two SRS resources transmitted in different symbols in the same slot, each SRS resource in a given set consisting of two SRS ports, and the SRS port pair of the second resource is associated with a different UE antenna port pair than the SRS port pair of the first resource. In the case of two resource sets, a total of two SRS resources are transmitted in different symbols of two different slots, the SRS port pair of each SRS resource in the given two sets is associated with a different UE antenna port pair. The two sets are each configured with one SRS resource, or\n-\totherwise, for 2T4R, up to two SRS resource sets configured with a different value for the higher layer parameter  resourceType in SRS-ResourceSet, where each SRS resource set has two SRS resources transmitted in different symbols, each SRS resource in a given set consisting of two SRS ports, and the SRS port pair of the second resource is associated with a different UE antenna port pair than the SRS port pair of the first resource, or\n-\tFor 1T4R, if the UE is indicating srs-AntennaSwitching2SP-1Periodic and/or srs-ExtensionAperiodicSRS and/or srs-OneAP-SRS, \n-\tzero or one SRS resource set configured with resourceType in SRS-ResourceSet set to 'periodic' or 'semi-persistent' if the UE is not indicating srs-AntennaSwitching2SP-1Periodic, or up to two SRS resource sets configured with resourceType in SRS-ResourceSet set to 'semi-persistent' and up to one SRS resource set configured with resourceType in SRS-ResourceSet set to 'periodic' if the UE is indicating srs-AntennaSwitching2SP-1Periodic, where the two SRS resource sets configured with 'semi-persistent' are not activated at the same time. Each SRS resource set has four SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a single SRS port, and the SRS port of each resource is associated with a different UE antenna port, and\n-\tzero or two SRS resource sets each configured with resourceType in SRS-ResourceSet set to 'aperiodic', if the UE is not indicating srs-ExtensionAperiodicSRS or srs-OneAP-SRS, or zero or one or two or four SRS resource sets each configured with resourceType in SRS-ResourceSet set to 'aperiodic' if the UE is indicating srs-ExtensionAperiodicSRS and srs-OneAP-SRS, or zero or two or four SRS resource sets each configured with resourceType in SRS-ResourceSet set to 'aperiodic' if the UE is indicating srs-ExtensionAperiodicSRS only, or zero or one or two SRS resource sets each configured with resourceType in SRS-ResourceSet set to 'aperiodic' if the UE is indicating srs-OneAP-SRS only. In the case of one resource set, a total of four SRS resources are transmitted in different symbols in the same slot, and the SRS port of each resource in the given set is associated with a different UE antenna port. In the case of two resource sets, a total of four SRS resources are transmitted in different symbols of two different slots, and the SRS port of each SRS resource in the given two sets is associated with a different UE antenna port. The two sets are each configured with two SRS resources, or one set is configured with one SRS resource and the other set is configured with three SRS resources. In the case of four resource sets, a total of four SRS resources are transmitted in different symbols of four different slots, and the SRS port of each SRS resource in the given four sets is associated with a different UE antenna port. The four sets are each configured with one SRS resource. The UE shall expect that the value of the higher layer parameter aperiodicSRS-ResourceTrigger or the value of an entry in AperiodicSRS-ResourceTriggerList in each SRS-ResourceSet is the same, and the value of the higher layer parameter slotOffset in each SRS-ResourceSet is different when none of the SRS resource sets is configured with parameter availableSlotOffsetList across all configured BWPs in a component carrier. Or, \n-\totherwise, for 1T4R,\n-\tzero or one SRS resource set configured with higher layer parameter resourceType in SRS-ResourceSet set to 'periodic' or 'semi-persistent' with four SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a single SRS port, and the SRS port of each resource is associated with a different UE antenna port, and\n-\tzero or two SRS resource sets each configured with higher layer parameter resourceType in SRS-ResourceSet set to 'aperiodic' and with a total of four SRS resources transmitted in different symbols of two different slots, and where the SRS port of each SRS resource in the given two sets is associated with a different UE antenna port. The two sets are each configured with two SRS resources, or one set is configured with one SRS resource and the other set is configured with three SRS resources. The UE shall expect that the value of the higher layer parameter aperiodicSRS-ResourceTrigger or the value of an entry in AperiodicSRS-ResourceTriggerList in each SRS-ResourceSet is the same, and the value of the higher layer parameter slotOffset in each SRS-ResourceSet is different when none of the SRS resource sets is configured with parameter availableSlotOffsetList across all configured BWPs in a component carrier. Or,\n-\tFor 1T=1R, 2T=2R, 4T=4R or 8T=8R, up to two SRS resource sets each with one SRS resource can be configured, where the number of SRS ports for each resource is equal to 1, 2, 4 or 8 if the UE is not indicating srs-AntennaSwitching2SP-1Periodic. Up to two SRS resource sets configured with resourceType in SRS-ResourceSet set to 'semi-persistent' and one SRS resource set configured with resourceType in SRS-ResourceSet set to 'periodic' can be configured and the two SRS resource sets configured with 'semi-persistent' are not activated at the same time, or up to two SRS resource sets can be configured, if the UE is indicating srs-AntennaSwitching2SP-1Periodic or [srs-AntennaSwitching2SP-1Periodic8T8R], where each SRS resource set has one SRS resource, the number of SRS ports for each resource is equal to 1, 2, 4, or 8 or\n-\tFor 1T6R, zero or one SRS resource sets configured with resourceType in SRS-ResourceSet set to 'periodic',  where in the case of one resource set has six SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a single SRS port, and the SRS port of the resource in the set is associated with a different UE antenna port, and\n-\tFor 1T6R, zero or one SRS resource sets configured with resourceType in SRS-ResourceSet set to 'semi-persistent' if the UE is not indicating srs-AntennaSwitching2SP-1Periodic, or up to two SRS resource sets configured with resourceType in SRS-ResourceSet set to 'semi-persistent' if the UE is indicating srs-AntennaSwitching2SP-1Periodic, where the two SRS resource sets configured with 'semi-persistent' are not activated at the same time. Each SRS resource set has six SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a single SRS port, and the SRS port of the resource in the set is associated with a different UE antenna port, and\n-\tFor 1T6R, zero or one or two or three SRS resource sets configured with resourceType in SRS-ResourceSet set to 'aperiodic', where in the case of one resource set a total of six SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a single SRS port, and the SRS port of each resource in the set is associated with a different UE antenna port. In the case of two resource sets a total of six SRS resources are transmitted in different symbols of two different slots, and the SRS port of each SRS resource in the given two sets is associated with a different UE antenna port. In the case of three resource sets, a total of six SRS resources are transmitted in different symbols of three different slots, and the SRS port of each SRS resource in the given three sets is associated with a different UE antenna port, or\n-\tFor 1T8R, zero or one SRS resource sets configured with resourceType in SRS-ResourceSet set to 'periodic', where in the case of one resource set has eight SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a single SRS port, and the SRS port of the resource in the set is associated with a different UE antenna port, and\n-\tFor 1T8R, zero or one SRS resource sets configured with resourceType in SRS-ResourceSet set to 'semi-persistent' if the UE is not indicating srs-AntennaSwitching2SP-1Periodic, or up to two SRS resource sets configured with resourceType in SRS-ResourceSet set to 'semi-persistent' if the UE is indicating srs-AntennaSwitching2SP-1Periodic, where the two SRS resource sets configured with 'semi-persistent' are not activated at the same time. Each SRS resource set has eight SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a single SRS port, and the SRS port of the resource in the set is associated with a different UE antenna port, and\n-\tFor 1T8R, zero or two or three or four SRS resource sets configured with resourceType in SRS-ResourceSet set to 'aperiodic', where in the case of two resource sets a total of eight SRS resources transmitted in different symbols of two different slots, and where the SRS port of each SRS resource in the given two sets is associated with a different UE antenna port. In the case of three resource sets a total of eight SRS resources are transmitted in different symbols of three different slots, and the SRS port of each SRS resource in the given three sets is associated with a different UE antenna port. In the case of four resource sets a total of eight SRS resources are transmitted in different symbols of four different slots, and the SRS port of each SRS resource in the given four sets is associated with a different UE antenna port, or\n-\tFor 2T6R, zero or one SRS resource sets configured with resourceType in SRS-ResourceSet set to 'periodic', where in the case of one resource set has three SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a two SRS ports, and the SRS port pair of the resource in the set is associated with a different UE antenna port pair, and\n-\tFor 2T6R, zero or one SRS resource sets configured resourceType in SRS-ResourceSet set to 'semi-persistent' if the UE is not indicating srs-AntennaSwitching2SP-1Periodic, or up to two SRS resource sets configured with 'semi-persistent' and up to one SRS resource set configured with 'periodic' if the UE is indicating srs-AntennaSwitching2SP-1Periodic, where the two SRS resource sets configured with 'semi-persistent' are not activated at the same time.  Each SRS resource set has three SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a two SRS ports, and the SRS port pair of the resource in the set is associated with a different UE antenna port pair, and\n-\tFor 2T6R, zero or one or two or three SRS resource sets configured with resourceType in SRS-ResourceSet set to 'aperiodic, where in the case of one resource set has three SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a two SRS ports, and the SRS port pair of the resource in the set is associated with a different UE antenna port pair. In the case of two resource sets a total of three SRS resources are transmitted in different symbols of two different slots, and the SRS port pair of each SRS resource in the given two sets is associated with a different UE antenna port pair. One set is configured with two SRS resources and another set with one resource. In the case of three resource sets a total of three SRS resources are transmitted in different symbols of three different slots, and the SRS port pair of each SRS resource in the given three sets is associated with a different UE antenna port pair, or\n-\tFor 2T8R, zero or one SRS resource sets configured with resourceType in SRS-ResourceSet set to 'periodic', where in the case of one resource set has four SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a two SRS ports, and the SRS port pair of the resource in the set is associated with a different UE antenna port pair, and\n-\tFor 2T8R, zero or one SRS resource sets configured with resourceType in SRS-ResourceSet set to 'semi-persistent' if the UE is not indicating srs-AntennaSwitching2SP-1Periodic, or up to two SRS resource sets configured with 'semi-persistent' and up to one SRS resource set configured with 'periodic' if the UE is indicating srs-AntennaSwitching2SP-1Periodic, where the two SRS resource sets configured with 'semi-persistent' are not activated at the same time. Each SRS resource set has four SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a two SRS ports, and the SRS port pair of the resource in the set is associated with a different UE antenna port pair, and\n-\tFor 2T8R, zero or one or two or three or four SRS resource sets configured with resourceType in SRS-ResourceSet set to 'aperiodic', where in the case of one resource set has four SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a two SRS ports, and the SRS port pair of the  resource in the set is associated with a different UE antenna port pair. In the case of two resource sets a total of four SRS resources transmitted in different symbols of two different slots, and where the SRS port pair of each SRS resource in the given two sets is associated with a different UE antenna port pair. In the case of three resource sets a total of four SRS resources transmitted in different symbols of three different slots, and where the SRS port pair of each SRS resource in the given three sets is associated with a different UE antenna port pair. Two sets are configured with one SRS resource in each set and one resource set is configured with two resources. In the case of four resource sets a total of four SRS resources transmitted in different symbols of four different slots, and where the SRS port pair of each SRS resource in the given four sets is associated with a different UE antenna port pair. Four sets are configured with one SRS resource in each set, or\n-\tFor 4T8R, zero or one or two SRS resource sets configured with a different value of resourceType in SRS-ResourceSet set to 'periodic' or 'semi-persistent' if the UE is not indicating srs-AntennaSwitching2SP-1Periodic, or up to two SRS resource sets configured with 'semi-persistent' and up to one SRS resource set configured with 'periodic' if the UE is indicating srs-AntennaSwitching2SP-1Periodic, where the two SRS resource sets configured with 'semi-persistent' are not activated at the same time. Each SRS resource set has two SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a four SRS ports, and the SRS ports of the resource in the set are associated with a different UE antenna ports, or\n-\tFor 4T8R, zero or one or two SRS resource sets configured with resourceType in SRS-ResourceSet set to 'aperiodic', where in the case of one resource set has two SRS resources transmitted in different symbols, each SRS resource in a given set consisting of a four SRS ports, and the SRS ports of the resource in the set are associated with a different UE antenna ports. In the case of two resource sets a total of two SRS resources are transmitted in different symbols of two different slots, and where the SRS ports of each SRS resource in the given two sets are associated with a different UE antenna ports.\nThe UE is configured with a guard period of Y symbols, in which the UE does not transmit any other signal, in the case the SRS resources of a set are transmitted in the same slot. The guard period is in-between the SRS resources of the set. For two SRS resource sets of an antenna switching located in two consecutive slots, if UE is capable of transmitting SRS in all symbols in one slot, a guard period of Y symbols exists between the last OFDM symbol occupied by the SRS resource set in the first slot and the first OFDM symbol occupied by the SRS resource set in the second slot.\nFor the inter-set guard period, the UE does not transmit any other signal on any symbols of the interval if the interval between SRS resource sets is Y symbols.\n-\tWhen both the SRS resource on all of the corresponding symbols prior to the gap and the SRS resource on all of the corresponding symbols after the gap are dropped due to collision handling, the gap period is also dropped with same priority and can be used for UL transmission.\nThe UE shall expect to be configured with the same number of SRS ports for all SRS resources in the SRS resource set(s) with higher layer parameter usage set as 'antennaSwitching'.\nIn the case that more than one SRS resource set configured with resourceType in SRS-ResourceSet set to 'aperiodic', the UE shall expect that the more than one set are configured with the same values of the higher layer parameters alpha, p0, pathlossReferenceRS, and srs-PowerControlAdjustmentStates in SRS-ResourceSet.\nFor 1T2R, 1T4R, 2T4R, 1T6R, 1T8R, 2T6R, 2T8R, or 4T8R, the UE shall not expect to be configured or triggered with more than one SRS resource set with higher layer parameter usage set as 'antennaSwitching' in the same slot. For 1T=1R, 2T=2R, 4T=4R, or 8T=8R, the UE shall not expect to be configured or triggered with more than one SRS resource set with higher layer parameter usage set as 'antennaSwitching' in the same symbol.\nThe value of Y is defined by Table 6.2.1.2-1.\nTable 6.2.1.2-1: The minimum guard period between two SRS resources of an SRS resource set for antenna switching\n\n6.2.1.3\tUE sounding procedure between component carriers\nFor a carrier of a serving cell c1 with slot formats comprised of DL and UL symbols, not configured for PUSCH/PUCCH transmission, denote  as the corresponding carrier of a serving cell whose UL transmissions are temporarily suspended as signalled by higher layer parameter srs-SwitchFromServCellIndex and srs-SwitchFromCarrier. Define the set  as the set of carriers of serving cells that each carrier meets one of the following conditions:\n-\t is in the same band and same TAG as ;\n-\t is a carrier of inter-band CA with  and  is indicated through the capability signalling srs-SwitchingAffectedBandsListNR-r17 to be affected by the SRS switch from  to ;\nwhere .\nA UE can be configured with SRS resource(s) on a carrier c1 with slot formats comprised of DL and UL symbols and not configured for PUSCH/PUCCH transmission. For carrier c1, the UE is configured with higher layer parameter srs-SwitchFromServCellIndex and srs-SwitchFromCarrier the switching from carrier c2 which is configured for PUSCH/PUCCH transmission. During SRS transmission on carrier c1 (including any interruption due to uplink or downlink RF retuning time [11, TS 38.133] as defined by higher layer parameters switchingTimeUL and switchingTimeDL of SRS-SwitchingTimeNR), the UE temporarily suspends the uplink transmission on carriers in the set S(c2).\nFor an SRS transmission starting in symbol  of carrier  and a conflicting transmission in any carrier  starting in symbol, the UE shall apply the prioritization / dropping rules in the remainder of this clause taking into account:\n-\tDCI(s) for which the time interval between the last symbol of PDCCH and  is at leastsymbols and an additional time duration ,  and the time interval between the last symbol of PDCCH and  is at least   symbols; and\n-\tsemi-persistent CSI reports or SRS considered active at least  symbols and an additional time duration  before , and considered active at least  symbols before .\nwhere , and the time interval unit of OFDM symbol is counted based on the smaller subcarrier spacing across any carrier within the set ,  and their corresponding scheduling cells.\nThe following prioritization rules shall be applied in case of collision between a transmission of SRS over carrier  and transmission of a physical signal/channel over a carrier of a serving cell in set \n-\tthe UE shall not transmit SRS whenever SRS transmission (including any interruption due to uplink or downlink RF retuning time [11, TS 38.133] as defined by higher layer parameters switchingTimeUL and switchingTimeDL of SRS-SwitchingTimeNR) on the carrier of the serving cell  and PUSCH/PUCCH transmission carrying HARQ-ACK/positive SR/RI/CRI/SSBRI and/or PRACH on a carrier of a serving cell in set happen to overlap in the same symbol\n-\tthe UE shall not transmit a periodic/semi-persistent SRS whenever periodic/semi-persistent SRS transmission (including any interruption due to uplink or downlink RF retuning time [11, TS 38.133] as defined by higher layer parameters switchingTimeUL and switchingTimeDL of SRS-SwitchingTimeNR) on the carrier of the serving cell  and PUSCH transmission carrying aperiodic CSI on a carrier of a serving cell in set  happen to overlap in the same symbol\n-\tthe UE shall drop PUCCH/PUSCH transmission carrying periodic/semi-persistent CSI comprising only CQI/PMI/L1-RSRP/L1-SINR, and/or SRS transmission on a carrier of a serving cell in set  configured for PUSCH/PUCCH transmission whenever the transmission and SRS transmission (including any interruption due to uplink or downlink RF retuning time [11, TS 38.133] as defined by higher layer parameters switchingTimeUL and switchingTimeDL of SRS-SwitchingTimeNR) on the carrier of the serving cell  happen to overlap in the same symbol\n-\tthe UE shall drop PUSCH transmission carrying aperiodic CSI comprising only CQI/PMI/L1-RSRP/L1-SINR on a carrier of a serving cell in set whenever the transmission and aperiodic SRS transmission (including any interruption due to uplink or downlink RF retuning time [11, TS 38.133]) as defined by higher layer parameters switchingTimeUL and switchingTimeDL of SRS-SwitchingTimeNR) on the carrier of the serving cell  happen to overlap in the same symbol.\nFor an aperiodic SRS triggered in DCI format 2_3 and if the UE is configured with higher layer parameter srs-TPC-PDCCH-Group set to 'typeA', and given by SRS-CarrierSwitching, without PUSCH/PUCCH transmission, the UE in each serving cell transmits the configured one or two SRS resource set(s) from srs-ResourceSetToAddModList with higher layer parameter usage set to 'antennaSwitching' and higher layer parameter resourceType in SRS-ResourceSet set to 'aperiodic'. \nFor an aperiodic SRS triggered in DCI format 2_3 and if the UE is configured with higher layer parameter srs-TPC-PDCCH-Group set to 'typeB' without PUSCH/PUCCH transmission, the UE in each serving cell transmits the configured one or two SRS resource set(s) from srs-ResourceSetToAddModList with higher layer parameter usage set to 'antennaSwitching' and higher layer parameter resourceType in SRS-ResourceSet set to 'aperiodic'.\nFor an aperiodic SRS triggered in DCI format 1_1 or 1_2, if the UE is configured by SRS-CarrierSwitching, it transmits SRS on one serving cell not configured for PUSCH/PUCCH transmission scheduled by the DCI and the UE in the serving cell transmits the configured one or two SRS resource set(s) with higher layer parameter usage set to 'antennaSwitching' and higher layer parameter resourceType in SRS-ResourceSet set to 'aperiodic'.\nIf the UE is not configured for PUSCH/PUCCH transmission on carrier c1 with slot formats comprised of DL and UL symbols, and if the UE is not capable of simultaneous reception and transmission on carrier c1 and serving cell c2, the UE is not expected to be configured or indicated with SRS resource(s) such that SRS transmission on carrier c1 (including any interruption due to uplink or downlink RF retuning time [11, TS 38.133] as defined by higher layer parameters switchingTimeUL and switchingTimeDL of SRS-SwitchingTimeNR) would collide with the REs corresponding to the SS/PBCH blocks configured for the UE or the slots belonging to a control resource set indicated by MIB or SIB1 on serving cell c2.\nFor n-th (n \u2265 1) aperiodic SRS transmission on a cell c, upon detection of a positive SRS request on a grant, the UE shall commence this SRS transmission on the configured symbol and slot provided\n-\tit is no earlier than the summation of\n-\tthe maximum time duration between the two durations spanned by N OFDM symbols of the numerology of cell c and the cell carrying the grant respectively, and\n-\tthe UL or DL RF retuning time [11, TS 38.133] as defined by higher layer parameters switchingTimeUL and switchingTimeDL of SRS-SwitchingTimeNR,\n-\tit does not collide with any previous SRS transmissions, or interruption due to UL or DL RF retuning time, except if the previous SRS transmission is in the same cell c and the UE reports stayOnTargetCC-SRS-CarrierSwitch for the corresponding band combination.\notherwise, n-th SRS transmission is dropped, where N is the reported capability as the minimum time interval in unit of symbols, between the DCI triggering and aperiodic SRS transmission.\nIn case of inter-band carrier aggregation, a UE can simultaneously transmit SRS and PUCCH/PUSCH across component carriers in different bands subject to the UE's capability.\nIn case of inter-band carrier aggregation, a UE can simultaneously transmit PRACH and SRS across component carriers in different bands subject to UE's capability.\nIf the UE is not configured for PUSCH/PUCCH transmission for at least one serving cell configured with slot formats comprised of DL and UL symbols, and if the UE is not capable of simultaneous reception and transmission on serving cell c1 and serving cell s(c2), and if a UE \n-\tis configured with multiple serving cells and is provided with directionalCollisionHandling-r16 = 'enabled' for a set of serving cell(s) among the configured multiple serving cells including serving cell c1 and s(c2), and\n-\tindicates support of half-DuplexTDD-CA-SameSCS-r16 capability, and \n-\tis not configured to monitor PDCCH for detection of DCI format 2_0 on any of the multiple serving cells, \nthe UE shall apply first the prioritization/dropping rules described above for sounding procedure between component carriers and then apply the procedures for directional collision handling in clause 11.1 of [6, TS 38.213].\n6.2.1.4\tUE sounding procedure for positioning purposes\nWhen the SRS is configured by the higher layer parameter SRS-PosResource and if the higher layer parameter spatialRelationInfoPos is configured, it contains the ID of the configuration fields of a reference RS according to Clause 6.3.2 of [TS 38.331]. The reference RS can be an SRS configured by the higher layer parameter SRS-Resource or SRS-PosResource, CSI-RS, SS/PBCH block, or a DL PRS configured on a serving cell or a SS/PBCH block or a DL PRS configured on a non-serving cell. If the UE is configured for transmission of SRS-PosResource in RRC_INACTIVE mode, the configured spatialRelationInfoPos is also applicable.\nThe UE is not expected to transmit multiple SRS resources with different spatial relations in the same OFDM symbol.\nIf the UE is not configured with the higher layer parameter spatialRelationInfoPos the UE may use a fixed spatial domain transmission filter for transmissions of the SRS configured by the higher layer parameter SRS-PosResource across multiple SRS resources or it may use a different spatial domain transmission filter across multiple SRS resources. \nIn RRC_CONNECTED mode, the UE is only expected to transmit an SRS configured by the higher layer parameter SRS-PosResource within the active UL BWP of the UE.\nWhen the configuration of SRS is done by the higher layer parameter SRS-PosResource, the UE can only be provided with a single RS source in spatialRelationInfoPos per SRS resource for positioning.\nFor operation on the same carrier, if an SRS configured by the higher parameter SRS-PosResource collides with a scheduled PUSCH, the SRS is dropped in the symbols where the collision occurs. \nUnless specified otherwise, the UE does not expect to be configured with SRS-PosResource on a carrier of a serving cell with slot formats comprised of DL and UL symbols, not configured for PUSCH/PUCCH transmission.\nTiming Error Group (TEG) at UE side is defined: \n-\tUE Tx TEG is associated with the transmissions of one or more UL SRS resources for the positioning purpose, which have the Tx timing error difference within a certain margin.\nThe UE may be configured to report, via high layer parameter nr-UE-RxTxTEG-Request or ue-TxTEG-RequestUL-TDOA-Config, subject to UE capability, association information of the already transmitted SRS resource(s) configured by the higher layer parameter SRS-PosResource with UE Tx TEG(s) via higher layer parameter nr-SRS-TxTEG-Set or ue-TxTEG-AssociationList. \nThe UE may report, via high layer parameter ue-TxTEG-TimingErrorMarginValue, the UE Tx TEG timing error margin value of all the UE Tx TEGs within one UEPositioningAssistanceInfo.\nIf the UE reports a UE Tx TEG ID with a UE Rx-Tx time difference measurement, as defined in clause 5.1.6.5, the UE shall report the association information of the already transmitted SRS resources configured by the higher layer parameter SRS-PosResource with the UE Tx TEG ID.\nIf the UE is configured with SRS resources configured by the higher layer parameter SRS-PosResource in multiple CCs, the UE should report the carrierFreq or servCellId of the SRS resources when it reports the UE Tx TEG associations.\nIf the UE reports a UE RxTx TEG ID with a UE Rx-Tx time difference measurement, the UE may report a UE Tx TEG ID.\nIf the UE reports a UE Tx TEG ID with a UE Rx-Tx time difference measurement, the UE may report a UE Tx TEG timing error margin value, via high layer parameter nr-UE-TxTEG-TimingErrorMargin, for all the UE Tx TEGs within one NR-Multi-RTT-SignalMeasurementInformation.\nSubject to UE capability, the UE may be configured with an SRS resource for positioning associated with the initial UL BWP, and the SRS resource is transmitted inside the initial UL BWP during RRC_INACTIVE mode with the same CP and subcarrier spacing as configured for the initial UL BWP. Subject to UE capability, the UE may be configured with an SRS resource for positioning outside the initial BWP including frequency location and bandwidth, subcarrier spacing, and CP length for transmission of the SRS in RRC_INACTIVE mode. If an SRS symbol for positioning outside the initial BWP in RRC_INACTIVE mode including the switching time, indicated in higher layer parameter switchingTimeSRS-TX-OtherTX, in unpaired spectrum, subject to UE capability, collides in time domain with other DL signals or channels or UL signals or channels, the colliding SRS symbol for positioning is dropped. If an SRS symbol for positioning outside the initial BWP in RRC_INACTIVE mode including the switching time, indicated in higher layer parameter switchingTimeSRS-TX-OtherTX, in paired spectrum or SUL band, subject to UE capability, collides in time domain with UL signals or channels on the same carrier, the colliding SRS symbol for positioning is dropped. The SRS resource for positioning outside the initial BWP in RRC_INACTIVE mode is configured in the same band and CC as the initial UL BWP.\nIf the UE in RRC_INACTIVE mode is not provided SRS-PosRRC-InactiveValidityAreaConfig and determines that the UE is not able to accurately measure the configured DL RS in SRS-SpatialRelationInfoPos for a SRS resource for positioning where the DL RS is semi-persistent or periodic, the UE stops transmission of the SRS resource for positioning.\nThe UE is not expected to simultaneously transmit SRS resources configured by the higher layer parameter SRS-PosResource on NUL and SUL band in RRC_INACTIVE mode.\nThe UE may be configured with SRS, via SRS-PosRRC-InactiveValidityAreaConfig, subject to UE capability, valid in multiple cells within a validity area for RRC_INACTIVE mode. For the configured SRS via SRS-PosRRC-InactiveValidityAreaConfig, if the UE in RRC_INACTIVE mode determines that the UE is not able to accurately measure the configured DL RS in [SRS-SpatialRelationInfoPos] for a SRS resource for positioning where the DL RS is semi-persistent or periodic, the UE would not perform SRS transmission of the SRS resource for positioning. If the UE determines that the configured DL RS in [SRS-SpatialRelationInfoPos] for a SRS resource for positioning is being accurately measured, the UE is expected to perform the SRS transmission.\n6.2.1.4.1\tSRS frequency hopping for positioning\nThe reduced capability UE may be configured via [higher layer parameter], subject to UE capability, to perform transmit frequency hopping separate from the UL BWP configuration and outside of the UL BWP, where the UE may be configured with subcarrier spacing, CP and bandwidth that are different from the UL active BWP. The reduced capability UE transmit frequency hopping is configured within one SRS resource for positioning, that may be configured with a bandwidth larger than the maximum bandwidth of the reduced capability UE, in RRC_CONNECTED or RRC_INACTIVE mode. The reduced capability UE transmit frequency hopping, may be configured with overlapping or non-overlapping frequency hops in the frequency domain.  When the reduced capability UE is configured to perform transmit frequency hopping:\n-\tit expects to be configured with the following parameters:\n-\tstarting PRB of the first hop in time domain in [higher layer parameter]\n-\tstarting slot offset and starting symbol for each hop in [higher layer parameter]\n-\tnumber of symbols in each hop in [higher layer parameter]\n-\thop bandwidth in [higher layer parameter]\n-\tnumber of overlapping resource block(s) between hops, if present, in [higher layer parameter]\n-\tnumber of hops in [higher layer parameter].\n-\tit does not expect to be configured with the sum of [StartingSymbol] and [Length] for a hop that exceeds a slot duration.\n-\tit expects to be configured with the same periodicity of each hop of an SRS resource with the transmit frequency hopping.\nThe reduced capability UE may be configured, via [uplinkTimeWindow-Config], subject to UE capability, with an UL time window where the UE is not expected to transmit other signals/channels and is only expected to transmit the SRS for positioning using frequency hopping. The UE is not expected to be configured with one [cycle] of the transmit frequency hopping, including the switching time from/to active BWP required ahead of the first hop and after the last hop, that is partially overlapped with the time window. \nThe reduced capability UE is expected to switch back to the active BWP if the time between two consecutive hops exceeds twice the switching time from/to the active BWP.\nFor a transmission of a hop for an SRS resource for positioning with frequency hopping starting in symbol  and a colliding PUSCH or PUCCH transmissionstarting in symbol , the UE shall apply the dropping rules taking into account:\n-\tDCI(s) for which the time interval between the last symbol of PDCCH and the SRS symbol is at least  symbols and additional time duration , where  is the switching time to/from the active BWP.\n-\tDCI(s) for which the time interval between the last symbol of PDCCH and the colliding PUSCH/PUCCH symbol is at least  symbols, where calculation of  is based on the smallest SCS between the SCS configured for positioning SRS with the frequency hopping, the SCS of the PUSCH/PUCCH, and the SCS of the PDCCH.\nIf the SRS symbol(s), including the switching time to and from the active bandwidth part, of the transmit frequency hopping collides with PUSCH or PUCCH, and if the UE determines the SRS to be dropped, the colliding SRS symbol(s) are dropped.\nFor operation in the same carrier, the reduced capability UE is not expected to be configured on overlapping symbols with an SRS resource of the transmit frequency hopping configured by the higher layer parameter [to_be_defined] including the switching time to or from the active bandwidth part and an SRS resource with resourceType of both SRS resources as 'periodic'.\nFor operation in the same carrier, the reduced capability UE is not expected to be activated or triggered to transmit SRS on overlapping symbols with a SRS resource of the transmit frequency hopping configured by the higher layer parameter [XX] including the switching time to or from the active bandwidth part and a SRS resource with resourceType of both SRS resources as 'semi-persistent' or 'aperiodic'.\n6.2.1.4.2\tSRS bandwidth aggregation for positioning measurements\nThe UE is expected to be configured with linkage information SRS-PosResourceSetLinkedForAggBWList on SRS resource sets for positioning across two or three CCs which are linked for bandwidth aggregation. For the linked SRS resource sets, the UE is expected to be configured with the same values of startPosition, nrofSymbols, periodicityAndOffset, slotOffset, alpha, p0, spatialRelationInfoPos, resourceType, subcarrier spacing, CP, and comb size, and the UE is expected to maintain phase continuity for the SRS transmission on the same symbol(s). The UE assumes that SRS resources across the linked SRS resource sets which satisfy the above conditions are linked for bandwidth aggregation, otherwise, the UE does not assume that SRS resources of the linked SRS resource sets are linked for bandwidth aggregation. For the linked SRS resource sets for bandwidth aggregation across CCs, if an SRS configured by the higher layer parameter SRS-PosResource, along with the [switching period] when applicable, collides with other signals or channels on a symbol and if the SRS in that symbol is dropped, SRS transmission of the linked SRS resource sets across all CCs is dropped on that symbol.\nIf the UE is configured with dci-TriggeringPosResourceSetLink, and if the UE receives a DCI 0_1, 0_2, 1_1, or 1_2 triggering an aperiodic SRS resource set for positioning linked for bandwidth aggregation in a CC, subject to UE capability, UE transmits SRS of the linked SRS resource sets across all CCs.\nA UE in RRC_INACTIVE mode is expected to be configured with freqInfoAdditionalCcList on additional component carrier(s) with respective SRS configuration(s) for bandwidth aggregation.\nWhen an SRS resource configured in a CC without PUSCH or PUCCH is linked for bandwidth aggregation with an SRS resource configured in an active UL BWP of another CC, there is a guard period during which the UE is not expected to transmit or receive other signals or channels, subject to UE capability.\nIf the UE receives an activation or deactivation command of semi-persistent SRS resource set(s) for positioning in up to  three aggregated carriers or SRS resource set(s) for positioning in up to two aggregated carriers as specified in [10, TS 38.321] and when the UE would transmit a PUCCH with HARQ-ACK information in slot n corresponding to the PDSCH carrying the activation or deactivation command, the corresponding actions in [10, TS 38.321] and the UE assumptions on SRS transmission or cessation corresponding to the SRS resource set(s) shall be applied starting from the first slot that is after slot  where \u00b5 is the SCS configuration for the PUCCH.\nFor positioning SRS resources on multiple carriers linked for aggregation, the channel over which a symbol on one carrier for SRS transmission is conveyed can be inferred from the channel over which the same symbol of another carrier or the aggregated carrier is conveyed.\n6.2.2\tUE DM-RS transmission procedure\nThe DM-RS transmission procedures for PUSCH scheduled by PDCCH with DCI format 0_1 described in this clause equally apply to PUSCH scheduled by PDCCH with DCI format 0_2, by applying the parameters of dmrs-UplinkForPUSCH-MappingTypeA-DCI-0-2 and dmrs-UplinkForPUSCH-MappingTypeB-DCI-0-2 instead of dmrs-UplinkForPUSCH-MappingTypeA and dmrs-UplinkForPUSCH-MappingTypeB. The DM-RS transmission procedures for PUSCH scheduled by PDCCH with DCI format 0_1 described in this clause equally apply to PUSCH scheduled by PDCCH with DCI format 0_3.\nWhen transmitted PUSCH is neither scheduled by DCI format 0_1/0_2 with CRC scrambled by C-RNTI, CS-RNTI, SP-CSI-RNTI or MCS-C-RNTI, nor corresponding to a configured grant, nor being a PUSCH for Type-2 random access procedure, the UE shall use single symbol front-loaded DM-RS of configuration type 1 on DM-RS port 0 and the remaining REs not used for DM-RS in the symbols are not used for any PUSCH transmission except for PUSCH with allocation duration of 2 or less OFDM symbols with transform precoding disabled, additional DM-RS can be transmitted according to the scheduling type and the PUSCH duration as specified in Table 6.4.1.1.3-3 of [4, TS38.211] for frequency hopping disabled and as specified in Table 6.4.1.1.3-6 of [4, TS38.211] for frequency hopping enabled, and \nIf frequency hopping is disabled:\n-\tThe UE shall assume dmrs-AdditionalPosition equals to 'pos2' and up to two additional DM-RS can be transmitted according to PUSCH duration, or\nIf frequency hopping is enabled:\n-\tThe UE shall assume dmrs-AdditionalPosition equals to 'pos1' and up to one additional DM-RS can be transmitted according to PUSCH duration.\nWhen transmitted PUSCH is scheduled by activation DCI format 0_0 with CRC scrambled by CS-RNTI, the UE shall use single symbol front-loaded DM-RS of configuration type provided by higher layer parameter dmrs-Type in DMRS-UplinkConfig on DM-RS port 0 and the remaining REs not used for DM-RS in the symbols are not used for any PUSCH transmission except for PUSCH with allocation duration of 2 or less OFDM symbols with transform precoding disabled, and additional DM-RS with dmrs-AdditionalPosition from ConfiguredGrantConfig can be transmitted according to the scheduling type and the PUSCH duration as specified  in Table 6.4.1.1.3-3 of [4, TS38.211] for frequency hopping disabled and as specified in Table 6.4.1.1.3-6 of [4, TS38.211] for frequency hopping enabled.\nFor the UE-specific reference signals generation as defined in Clause 6.4.1.1 of [4, TS 38.211], a UE can be configured by higher layers with one or two scrambling identity(s), i = 0,1 which are the same for both PUSCH mapping Type A and Type B.\nWhen transmitted PUSCH is scheduled by DCI format 0_1 with CRC scrambled by C-RNTI, CS-RNTI, SP-CSI-RNTI or MCS-C-RNTI, or corresponding to a configured grant, or being a PUSCH for Type-2 random access procedure,\n-\tfor a configured-grant based PUSCH transmission in RRC_INACTIVE state, the UE is provided with a set of DM-RS port(s) by sdt-DMRS-Ports. The DM-RS port for the PUSCH is determined by the mapping between SS/PBCH block(s) and a PUSCH occasion and the associated DM-RS resource as described in Clause 19.1 of [6, TS 38.213]. \n-\tthe UE may be configured with higher layer parameter dmrs-Type in DMRS-UplinkConfig, and the configured DM-RS configuration type is used for transmitting PUSCH in as defined in Clause 6.4.1.1 of [4, TS 38.211]. \n-\tthe UE may be configured with the maximum number of front-loaded DM-RS symbols for PUSCH by higher layer parameter maxLength in DMRS-UplinkConfig, or by higher layer parameter msgA-MaxLength in msgA-DMRS-Config,\n-\tif maxLength is not configured, single-symbol DM-RS can be scheduled for the UE by DCI or configured by the configured grant configuration, and the UE can be configured with a number of additional DM-RS for PUSCH by higher layer parameter dmrs-AdditionalPosition, which can be 'pos0', 'pos1', 'pos2', 'pos3'. \n-\tif maxLength is configured, either single-symbol DM-RS or double symbol DM-RS can be scheduled for the UE by DCI or configured by the configured grant configuration, and the UE can be configured with a number of additional DM-RS for PUSCH by higher layer parameter dmrs-AdditionalPosition, which can be 'pos0' or 'pos1'. \n-\tfor MsgA PUSCH for Type-2 random access procedure the UE can be configured with a number of additional DM-RS for PUSCH by higher layer parameter msgA-DMRS-AdditionalPosition, which can be 'pos0', 'pos1', 'pos2', 'pos3' for single-symbol DM-RS or 'pos0', 'pos1' for double-symbol DM-RS.\n-\tand, the UE shall transmit a number of additional DM-RS as specified in Table 6.4.1.1.3-3 and Table 6.4.1.1.3-4 in -Clause 6.4.1.1.3 of [4, TS 38.211].\nIf a UE transmitting PUSCH scheduled by DCI format 0_2 is configured with the higher layer parameter phaseTrackingRS in dmrs-UplinkForPUSCH-MappingTypeA-DCI-0-2 or dmrs-UplinkForPUSCH-MappingTypeB-DCI-0-2, or a UE transmitting PUSCH scheduled by DCI format 0_0, 0_1 or 0_3 is configured with the higher layer parameter phaseTrackingRS in dmrs-UplinkForPUSCH-MappingTypeA or dmrs-UplinkForPUSCH-MappingTypeB, the UE may assume that the following configurations are not occurring simultaneously for the transmitted PUSCH\n-\tany DM-RS ports among \n4-7 or 6-11 for DM-RS configurations type 1 and type 2, respectively, or\n4-7 or 12-15 for DM-RS configuration enhanced type 1, or \n6-11 or 18-23 for DM-RS configuration enhanced type 2, \nare scheduled for the UE and PT-RS is transmitted from the UE.\nFor PUSCH scheduled by DCI format 0_1, by activation DCI format 0_1 with CRC scrambled by CS-RNTI, or configured by configured grant Type 1 configuration, the UE shall assume the DM-RS CDM groups indicated in Tables 7.3.1.1.2-6 to 7.3.1.1.2-23D and Tables 7.3.1.1.2-38 to 7.3.1.1.2-69 of Clause 7.3.1.1 of [5, TS38.212] are not used for data transmission, where \"1\", \"2\" and \"3\" for the number of DM-RS CDM group(s) correspond to CDM group 0, {0,1}, {0,1,2}, respectively. \nFor PUSCH scheduled by DCI format 0_0 or by activation DCI format 0_0 with CRC scrambled by CS-RNTI, the UE shall assume the number of DM-RS CDM groups without data is 1 which corresponds to CDM group 0 for the case of PUSCH with allocation duration of 2 or less OFDM symbols with transform precoding disabled, the UE shall assume that the number of DM-RS CDM groups without data is 3 which corresponds to CDM group {0,1,2} for the case of PUSCH scheduled by activation DCI format 0_0 and the dmrs-Type in DMRS-UplinkConfig equal to 'type2' and the PUSCH allocation duration being more than 2 OFDM symbols, and the UE shall assume that the number of DM-RS CDM groups without data is 2 which corresponds to CDM group {0,1} for all other cases. \nFor MsgA PUSCH transmission, if the UE is not configured with msgA-PUSCH-DMRS-CDM-group, the UE shall assume that 2 DM-RS CDM groups are configured. Otherwise, msgA-PUSCH-DMRS-CDM-group indicates which DM-RS CDM group to use from the set of {0,1}. \nFor MsgA PUSCH transmission, if the UE is not configured with msgA-PUSCH-NrofPorts, the UE shall assume that 4 ports are configured per DM-RS CDM group for double-symbol DM-RS. Otherwise, msgA-PUSCH-NrofPorts with value of 0 indicates the first port per DM-RS CDM group, while a value of 1 indicates the first two ports per DM-RS CDM group.\nFor uplink DM-RS with PUSCH, the UE may assume the ratio of PUSCH EPRE to DM-RS EPRE ( [dB]) is given by Table 6.2.2-1 according to the number of DM-RS CDM groups without data. The DM-RS scaling factor  specified in clause 6.4.1.1.3 of [4, TS 38.211] is given by .\nTable 6.2.2-1: The ratio of PUSCH EPRE to DM-RS EPRE\n\nFor PUSCH repetition Type B, the DM-RS transmission procedure is applied for each actual repetition separately based on the allocation duration of the actual repetition. A UE is not expected to be indicated with an antenna port configuration that is invalid for the allocated duration of any actual repetition.\n6.2.3\tUE PT-RS transmission procedure\nThe procedures on PT-RS transmission described in this clause as well as clauses 6.2.3.1 and 6.2.3.2 apply to a UE PUSCH transmission scheduled by DCI format 0_2 if the higher layer parameter phaseTrackingRS in dmrs-UplinkForPUSCH-MappingTypeA-DCI-0-2 or dmrs-UplinkForPUSCH-MappingTypeB-DCI-0-2 is configured, to PUSCH transmissions scheduled by DCI format 0_0, 0_1 or 0_3 if the higher layer parameter phaseTrackingRS in dmrs-UplinkForPUSCH-MappingTypeA or dmrs-UplinkForPUSCH-MappingTypeB is configured and PUSCH transmissions corresponding to a configured grant if the higher layer parameter phaseTrackingRS in cg-DMRS-Configuration is configured. If a UE is not configured with the higher layer parameter phaseTrackingRS in the respective DMRS-UplinkConfig, the UE shall not transmit PT-RS. The PT-RS is only present on PUSCH scheduled by PDCCH with CRC scrambled by MCS-C-RNTI, C-RNTI, CS-RNTI, SP-CSI-RNTI and on PUSCH corresponding to a configured grant. For PUSCH repetition Type B, the PT-RS transmission procedure is applied for each actual repetition separately based on the allocation duration of the actual repetition.\n6.2.3.1\tUE PT-RS transmission procedure when transform precoding is not enabled\nWhen transform precoding is not enabled and if a UE is configured with the higher layer parameter phaseTrackingRS in DMRS-UplinkConfig, \n-\tthe higher layer parameters timeDensity and frequencyDensity in PTRS-UplinkConfig indicate the threshold values ptrs-MCSi, i=1,2,3 and NRB,i , i=0,1, as shown in Table 6.2.3.1-1 and Table 6.2.3.1-2, respectively. \n-\tif either or both higher layer parameters timeDensity and/or frequencyDensity in PTRS-UplinkConfig are configured, the UE shall assume the PT-RS antenna ports' presence and pattern are a function of the corresponding scheduled MCS of the codeword associated with the PT-RS and scheduled bandwidth in a corresponding bandwidth part as shown in Table 6.2.3.1-1 and Table 6.2.3.1-2, respectively, \n-\tif the higher layer parameter timeDensity is not configured, the UE shall assume LPT-RS = 1.\n-\tif the higher layer parameter frequencyDensity is not configured, the UE shall assume KPT-RS = 2. \n-\tif a UE is configured with the higher layer parameter maxNrofPorts in PTRS-UplinkConfig set to 'n2' and scheduled with two codewords, the PT-RS time-density for both PT-RS ports is determined based on the higher MCSs of two codewords associated with the initial transmission.\n-\tif none of the higher layer parameters timeDensity and frequencyDensity in PTRS-UplinkConfig are configured, the UE shall assume LPT-RS = 1 and KPT-RS = 2.\nTable 6.2.3.1-1: Time density of PT-RS as a function of scheduled MCS\n\nTable 6.2.3.1-2: Frequency density of PT-RS as a function of scheduled bandwidth\n\nThe higher layer parameter PTRS-UplinkConfig provides the parameters ptrs-MCSi, i=1,2,3 and with values in 0-29 when MCS Table 5.1.3.1-1 or Table 5.1.3.1-3 is used and 0-28 when MCS Table 5.1.3.1-2 is used, respectively. ptrs-MCS4 is not explicitly configured by higher layers but assumed 29 when MCS Table 5.1.3.1-1 or Table 5.1.3.1-3 is used and 28 when MCS Table 5.1.3.1-2 is used. The higher layer parameter PTRS-UplinkConfig provides the parameters NRBi i=0,1 with values in range 1-276. \nIf the higher layer parameter PTRS-UplinkConfig indicates that the time density thresholds ptrs-MCSi = ptrs-MCSi+1, then the time density LPTRS of the associated row where both these thresholds appear in Table 6.2.3.1-1 is disabled. If the higher layer parameter frequencyDensity in PTRS-UplinkConfig indicates that the frequency density thresholds NRB,i = NRB,i+1, then the frequency density KPTRS of the associated row where both these thresholds appear in Table 6.2.3.1-2 is disabled.\nIf either or both of the parameters PT-RS time density (LPT-RS) and PT-RS frequency density (KPT-RS), shown in Table 6.2.3.1-1 and Table 6.2.3.1-2, indicates that are configured as 'PT-RS not present', the UE shall assume that PT-RS is not present.\nWhen a UE is scheduled to transmit PUSCH with allocation duration of 2 symbols or less, and if LPT-RS is set to 2 or 4, the UE shall not transmit PT-RS. When a UE is scheduled to transmit PUSCH with allocation duration of 4 symbols or less, and if LPT-RS is set to 4, the UE shall not transmit PT-RS.\nWhen a UE is scheduled to transmit PUSCH for retransmission, if the UE is scheduled with IMCS > V, where V = 28 for MCS Table 5.1.3.1-1 and MCS Table 5.1.3.1-3 and V = 27 for MCS Table 5.1.3.1-2, respectively, the MCS for PT-RS time-density determination is obtained from the DCI for the same transport block in the initial transmission, which is smaller than or equal to V. \nThe maximum number of configured PT-RS ports is given by the higher layer parameter maxNrofPorts in PTRS-UplinkConfig. The UE is not expected to be configured with a larger number of UL PT-RS ports than it has reported need for.\nIf a UE has reported the capability of supporting full-coherent UL transmission, the UE shall expect maxNrofPorts in PTRS-UplinkConfig to be configured as one if ULPT-RS is configured. If a UE has reported the capability of supporting full-coherent UL transmission and when the higher layer parameter multipanelScheme is set to 'sdmscheme', subject to UE capability, the UE can be configured with maxNrofPortsforSDM in PTRS-UplinkConfig set to n2, where at most one PT-RS port is associated with each SRS resource set with higher layer parameter usage set to 'codebook'/'nonCodebook'.\nFor codebook or non-codebook based UL transmission, the association between UL PT-RS port(s) and DM-RS port(s) is signalled by PTRS-DMRS association field(s) in DCI format 0_1, 0_2 and 0_3. For a PUSCH corresponding to a configured grant Type 1 transmission, the UE may assume the association between UL PT-RS port(s) and DM-RS port(s) defined by value 0 in Table 7.3.1.1.2-25, or value \"00\" in Table 7.3.1.1.1.2-26 or value \"00\" in Table 7.3.1.1.1.2-25a described in Clause 7.3.1 of [5, TS38.212].\nFor PUSCH scheduled by DCI format 0_0 or by activation DCI format 0_0, the UL PT-RS port is associated to DM-RS port 0.\nFor non-codebook based UL transmission, the actual number of UL PT-RS port(s) to transmit is determined based on SRI(s) in DCI format 0_1, 0_2 or 0_3 or higher layer parameter sri-ResourceIndicator in rrc-ConfiguredUplinkGrant. When two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'noncodebook', the actual number of UL PT-RS port(s) to transmit corresponding to each SRS resource set is determined based on SRI(s) corresponding to the associated SRS resource set or higher layer parameter sri-ResourceIndicator or sri-ResourceIndicator2 corresponding to the associated SRS resource set in rrc-ConfiguredUplinkGrant. A UE is configured with the PT-RS port index for each configured SRS resource by the higher layer parameter ptrs-PortIndex configured by SRS-Config if the UE is configured with the higher layer parameter phaseTrackingRS in DMRS-UplinkConfig. If the PT-RS port index associated with different SRIs are the same, the corresponding UL DM-RS ports are associated to the one UL PT-RS port.\nWhen the higher layer parameter multipanelScheme is set to 'sdmscheme' and two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook'/'nonCodebook' and higher layer parameter maxNrofPortsforSDM in PTRS-UplinkConfig set to n2, the actual number of UL PT-RS port(s) to transmit corresponding to SRS resource sets is 2.\nWhen the higher layer parameter multipanelScheme is set to 'SFNscheme' and two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook'/'nonCodebook' and the higher layer parameter maxNrofPorts in PTRS-UplinkConfig is set to n2, the actual number of UL PT-RS port(s) to transmit corresponding to each SRS resource set is determined based on 1st TPMI codepoint field for 'codebook' or 1st SRI(s) codepoint field for 'nonCodebook'.\nFor partial-coherent and non-coherent codebook-based UL transmission, the actual number of UL PT-RS port(s) is determined based on TPMI(s) and/or number of layers which are indicated by 'Precoding information and number of layers' field(s) in DCI format 0_1, 0_2 or 0_3 or configured by higher layer parameter precodingAndNumberOfLayers:\n-\tif the UE is configured with the higher layer parameter maxNrofPorts in PTRS-UplinkConfig set to 'n2', the actual UL PT-RS port(s) and the associated transmission layer(s) are derived from indicated TPMI(s) as:\n-\tfor PUSCH transmission with 2 or 4 ports, PUSCH antenna port 1000 and 1002 in indicated TPMI(s) share PT-RS port 0, and PUSCH antenna port 1001 and 1003 in indicated TPMI(s) share PT-RS port 1.\n-\tUL PT-RS port 0 is associated with the UL layer 'x' of layers which are transmitted with PUSCH antenna port 1000 and PUSCH antenna port 1002 in indicated TPMI(s), and UL PT-RS port 1 is associated with the UL layer 'y' of layers which are transmitted with PUSCH antenna port 1001 and PUSCH antenna port 1003 in indicated TPMI(s), where 'x' and/or 'y' are given by DCI parameter 'PTRS-DMRS association' as shown in DCI format 0_1, 0_2 and 0_3 described in Clause 7.3.1 of [5, TS38.212].\n-\tfor PUSCH transmission with 8 ports, PUSCH antenna port 1000, 1001, 1004 and 1005 in indicated TPMI(s) share PT-RS port 0, and PUSCH antenna port 1002, 1003, 1006 and 1007 in indicated TPMI(s) share PT-RS port 1.\n-\tUL PT-RS port 0 is associated with the UL layer 'x' of layers which are transmitted with one or more of PUSCH antenna port 1000, 1001, 1004 and 1005 in indicated TPMI(s), and UL PT-RS port 1 is associated with the UL layer 'y' of layers which are transmitted with one or more of PUSCH antenna port 1002, 1003, 1006 and 1007 in indicated TPMI(s), where 'x' and/or 'y' are given by DCI parameter 'PTRS-DMRS association' as shown in DCI format 0_1 and DCI format 0_2 described in Clause 7.3.1 of [5, TS38.212].\nIf a UE is scheduled with two codewords,\n-\tif the UE is configured with the higher layer parameter maxNrofPorts in PTRS-UplinkConfig set to 'n1', the PT-RS port is associated with the one of DM-RS ports indicated by DCI field PTRS-DMRS association for the codeword with the higher MCS. If the MCS indices of the two codewords are the same, the PT-RS antenna port is associated with codeword 0. When a codeword is scheduled to transmit PUSCH for retransmission, the MCS for determining PT-RS association to codeword is obtained from the DCI for the same transport block in the initial transmission.\nWhen the UE is scheduled with Qp={1,2} PT-RS port(s) in uplink and the number of scheduled layers is ,\n-\tIf the UE is configured with higher layer parameter ptrs-Power, the PUSCH to PT-RS power ratio per layer per RE  is given by , where  is shown in the Table 6.2.3.1-3, Table 6.2.3.1-3A and Table 6.2.3.1-3B according to the higher layer parameter ptrs-Power, the PT-RS scaling factor  specified in clause 6.4.1.2.2.1 of [4, TS 38.211] is given by and also on the 'Precoding Information and Number of Layers' field in DCI.\n-\tThe UE shall assume ptrs-Power in PTRS-UplinkConfig is set to state \"00\" in Table 6.2.3.1-3, Table 6.2.3.1-3A, and Table 6.2.3.1-3B  if not configured or in case of non-codebook based PUSCH.\n-\tFor partial coherent codebook-based 8TX PUSCH transmission, Lx is the number of PUSCH layers in the antenna port group which are precoded coherently with the PUSCH layer/DM-RS port that PT-RS port x is associated with, and Qp is the number of PT-RS ports scheduled to the UE.\n-\tWhen the higher layer parameter multipanelScheme is set to \u2018sdmscheme\u2019 and two SRS resource sets are configured in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with higher layer parameter usage in SRS-ResourceSet set to 'codebook'/\u2019nonCodebook\u2019, and codepoint \"10\" of SRS Resource Set indicator is indicated, for each PT-RS port is based on Table 6.2.3.1-3B, where Qp is the total number of PT-RS ports for the PUSCH.\nTable 6.2.3.1-3: Factor related to PUSCH to PT-RS power ratio per layer per RE  other than 8TX PUSCH transmission and other than SDM PUSCH\n\nTable 6.2.3.1-3A: Factor related to PUSCH to PT-RS power ratio per layer per RE  for 8TX PUSCH transmission\n\nTable 6.2.3.1-3B: Factor related to PUSCH to PT-RS power ratio per layer per RE for SDM PUSCH\n\n6.2.3.2\tUE PT-RS transmission procedure when transform precoding is enabled\nWhen transform precoding is enabled and if a UE is configured with the higher layer parameter transformPrecoderEnabled in PTRS-UplinkConfig,\n-\tthe UE shall be configured with the higher layer parameters sampleDensity and the UE shall assume the PT-RS antenna ports' presence and PT-RS group pattern are a function of the corresponding scheduled bandwidth in a corresponding bandwidth part, as shown in Table 6.2.3.2-1. The UE shall assume no PT-RS is present when the number of scheduled RBs is less than NRB0 if NRB0 > 1 or if the RNTI equals TC-RNTI.\n-\tand the UE may be configured PT-RS time density LPT-RS = 2 with the higher layer parameter timeDensityTransformPrecoding. Otherwise, the UE shall assume LPT-RS = 1.\n-\tif the higher layer parameter sampleDensity indicates that the sample density thresholds NRB,i = NRB,i+1, then the associated row where both these thresholds appear in Table 6.2.3.2-1 is disabled.\nTable 6.2.3.2-1: PT-RS group pattern as a function of scheduled bandwidth\n\nWhen transform precoding is enabled and if a UE is configured with the higher layer parameter transformPrecoderEnabled in PTRS-UplinkConfig, the PT-RS scaling factor \u03b2' specified in Clause 6.4.1.2.2.2 of [4, TS 38.211] is determined by the scheduled modulation order as shown in table 6.2.3.2-2.\nTable 6.2.3.2-2: PT-RS scaling factor (\u03b2') when transform precoding enabled. \n\n6.3\tUE PUSCH frequency hopping procedure\n6.3.1\tFrequency hopping for PUSCH repetition Type A and for TB processing over multiple slots\nFor PUSCH repetition Type A other than the PUSCH scheduled by RAR UL grant or fallbackRAR UL grant or by DCI format 0_0 with CRC scrambled by TC-RNTI and for TB processing over multiple slots (as determined according to procedures defined in Clause 6.1.2.1 for scheduled PUSCH, or Clause 6.1.2.3 for configured PUSCH), a UE is configured for frequency hopping by the higher layer parameter frequencyHoppingDCI-0-2 in pusch-Config for PUSCH transmission scheduled by DCI format 0_2, and by frequencyHopping provided in pusch-Config for PUSCH transmission scheduled by a DCI format other than 0_2, and by frequencyHopping provided in configuredGrantConfig for configured PUSCH transmission. For PUSCH repetition Type A scheduled by RAR UL grant or by DCI format 0_0 with CRC scrambled by TC-RNTI, a UE is configured for frequency hopping by the frequency hopping flag information field of the RAR UL grant, and by the frequency hopping flag information field of DCI format 0_0 with CRC scrambled by TC-RNTI, respectively. One of two frequency hopping modes can be configured:\n-\tIntra-slot frequency hopping, applicable to single slot and multi-slot configured PUSCH transmission, multi-slot PUSCH transmission scheduled by DCI format 0_1, 0_2 or 0_3, each of multiple PUSCH transmissions on a serving cell scheduled by a DCI if the higher layer parameter pusch-TimeDomainAllocationListForMultiPUSCH is configured and each of multiple configured grant PUSCH transmissions in a configuration where the higher layer parameters cg-nrofSlots and cg-nrofPUSCH-InSlot are provided.\n-\tInter-slot frequency hopping, applicable to multi-slot PUSCH transmission.\nFor operation with shared spectrum channel access in FR1, the UE does not expect that two hops of a PUSCH transmission are in different RB sets.\nIn case of resource allocation type 2, the UE transmits PUSCH without frequency hopping.\nIn case of resource allocation type 1, whether or not transform precoding is enabled for PUSCH transmission, the UE may perform PUSCH frequency hopping, if the frequency hopping field in a corresponding detected DCI format or in a random access response UL grant is set to 1, or if for a Type 1 PUSCH transmission with a configured grant the higher layer parameter frequencyHoppingOffset is provided, otherwise no PUSCH frequency hopping is performed. When frequency hopping is enabled for PUSCH, the RE mapping is defined in clause 6.3.1.6 of [4, TS 38.211].\nFor a PUSCH scheduled by RAR UL grant, fallbackRAR UL grant, or by DCI format 0_0 with CRC scrambled by TC-RNTI, frequency offsets are obtained as described in clause 8.3 of [6, TS 38.213]. Otherwise, for a PUSCH scheduled by DCI format 0_0/0_1/0_3 or a PUSCH based on a Type2 configured UL grant activated by DCI format 0_0/0_1 and for resource allocation type 1, frequency offsets are configured by higher layer parameter frequencyHoppingOffsetLists in pusch-Config. For a PUSCH scheduled by DCI format 0_2 or a PUSCH based on a Type2 configured UL grant activated by DCI format 0_2 and for resource allocation type 1, frequency offsets are configured by higher layer parameter frequencyHoppingOffsetListsDCI-0-2 in pusch-Config.\n-\tWhen the size of the active BWP is less than 50 PRBs, one of two higher layer configured offsets is indicated in the UL grant.\n-\tWhen the size of the active BWP is equal to or greater than 50 PRBs, one of four higher layer configured offsets is indicated in the UL grant.\nFor PUSCH based on a Type1 configured UL grant the frequency offset is provided by the higher layer parameter frequencyHoppingOffset in rrc-ConfiguredUplinkGrant. \nFor a MsgA PUSCH the frequency offset is provided by the higher layer parameter as described in [6, TS 38.213].\nIn case of intra-slot frequency hopping, the starting RB in each hop is given by:\n\t,\nwhere i=0 and i=1 are the first hop and the second hop respectively, and  is the starting RB within the UL BWP, as calculated from the resource block assignment information of resource allocation type 1 (described in Clause 6.1.2.2.2) or as calculated from the resource assignment for MsgA PUSCH (described in [6, TS 38.213]) and is the frequency offset in RBs between the two frequency hops. The number of symbols in the first hop is given by , the number of symbols in the second hop is given by , where  is the length of the PUSCH transmission in OFDM symbols in one slot.\nIn case of inter-slot frequency hopping and when pusch-DMRS-Bundling is not enabled, or for inter-slot frequency hopping for a PUSCH scheduled by RAR UL grant or DCI format 0_0 with CRC scrambled by TC-RNTI, the starting RB during slot  is given by:\n\t, \nwhere  is the current slot number within a system radio frame, where a multi-slot PUSCH transmission can take place,  is the starting RB within the UL BWP, as calculated from the resource block assignment information of resource allocation type 1 (described in Clause 6.1.2.2.2) and is the frequency offset in RBs between the two frequency hops.\nIn case of inter-slot frequency hopping and when pusch-DMRS-Bundling is enabled, and when a PUSCH is not scheduled by RAR UL grant or DCI format 0_0 with CRC scrambled by TC-RNTI, the starting RB during slot  is given by: \n\t\nwhere  is the current slot number within a system radio frame,  is the value of the higher layer parameter pusch-FrequencyHopping-Interval,  is the starting RB within the UL BWP, as calculated from the resource block assignment information of resource allocation type 1 (described in Clause 6.1.2.2.2) andis the frequency offset in RBs between the two frequency hops.\n6.3.2\tFrequency hopping for PUSCH repetition Type B\nFor PUSCH repetition Type B (as determined according to procedures defined in Clause 6.1.2.1 for scheduled PUSCH, or Clause 6.1.2.3 for configured PUSCH), a UE is configured for frequency hopping by the higher layer parameter frequencyHoppingDCI-0-2 in pusch-Config for PUSCH transmission scheduled by DCI format 0_2, by frequencyHoppingDCI-0-1 provided in pusch-Config for PUSCH transmission scheduled by DCI format 0_1, and by frequencyHoppingPUSCH-RepTypeB provided in rrc-ConfiguredUplinkGrant for Type 1 configured PUSCH transmission. The frequency hopping mode for Type 2 configured PUSCH transmission follows the configuration of the activating DCI format. One of two frequency hopping modes can be configured:\n-\tInter-repetition frequency hopping\n-\tInter-slot frequency hopping\nFor operation with shared spectrum channel access in FR1, the UE does not expect that two hops of a PUSCH transmission are in different RB sets.\nIn case of resource allocation type 1, whether or not transform precoding is enabled for PUSCH transmission, the UE may perform PUSCH frequency hopping, if the frequency hopping field in a corresponding detected DCI format is set to 1, or if for a Type 1 PUSCH transmission with a configured grant the higher layer parameter frequencyHoppingPUSCH-RepTypeB is provided, otherwise no PUSCH frequency hopping is performed. When frequency hopping is enabled for PUSCH, the RE mapping is defined in clause 6.3.1.6 of [4, TS 38.211].\nFor a PUSCH scheduled by DCI format 0_1 or a PUSCH based on a Type 2 configured UL grant activated by DCI format 0_1 and for resource allocation type 1, frequency offsets are configured by higher layer parameter frequencyHoppingOffsetLists in pusch-Config. For a PUSCH scheduled by DCI format 0_2 or a PUSCH based on a Type 2 configured UL grant activated by DCI format 0_2 and for resource allocation type 1, frequency offsets are configured by higher layer parameter frequencyHoppingOffsetListsDCI-0-2 in pusch-Config.\n-\tWhen the size of the active BWP is less than 50 PRBs, one of two higher layer configured offsets is indicated in the UL grant.\n-\tWhen the size of the active BWP is equal to or greater than 50 PRBs, one of four higher layer configured offsets is indicated in the UL grant.\nFor PUSCH based on a Type1 configured UL grant the frequency offset is provided by the higher layer parameter frequencyHoppingOffset in rrc-ConfiguredUplinkGrant.\nIn case of inter-repetition frequency hopping, the starting RB for an actual repetition within the n-th nominal repetition (as defined in Clause 6.1.2.1) is given by:\n\t,\nwhere RBstart is the starting RB within the UL BWP, as calculated from the resource block assignment information of resource allocation type 1 (described in Clause 6.1.2.2.2) and RBoffset is the frequency offset in RBs between the two frequency hops.\nIn case of inter-slot frequency hopping, the starting RB during slot  follows that of inter-slot frequency hopping for PUSCH Repetition Type A in Clause 6.3.1.\n6.4\tUE PUSCH preparation procedure time\nIf the first uplink symbol in the PUSCH allocation for a transport block, including the DM-RS, as defined by the slot offset K2 and Koffset, if configured, and the start S and length L of the PUSCH allocation indicated by 'Time domain resource assignment' of the scheduling DCI and including the effect of the timing advance, is no earlier than at symbol L2, where L2 is defined as the next uplink symbol with its CP starting  after the end of the reception of the last symbol of the PDCCH carrying the DCI scheduling the PUSCH, then the UE shall transmit the transport block. When the PDCCH reception includes two PDCCH candidates from two respective search space sets, as described in clause 10.1 of [6, TS 38.213], for the purpose of determining the last symbol of the PDCCH carrying the DCI scheduling the PUSCH, the PDCCH candidate that ends later in time is used.\n-\tN2 is based on \u00b5 of Table 6.4-1 and Table 6.4-2 for UE processing capability 1 and 2 respectively, where \u00b5 corresponds to the one of (\u00b5DL, \u00b5UL) resulting with the largest Tproc,2, where the \u00b5DL corresponds to the subcarrier spacing of the downlink with which the PDCCH carrying the DCI scheduling the PUSCH was transmitted and \u00b5UL corresponds to the subcarrier spacing of the uplink channel with which the PUSCH is to be transmitted, and \u03ba is defined in clause 4.1 of [4, TS 38.211]. \n-\tFor operation with shared spectrum channel access in FR1, is calculated according to [4, TS 38.211], otherwise =0.\n-\tIf the first symbol of the PUSCH allocation consists of DM-RS only, then d2,1 = 0, otherwise d2,1 = 1. \n-\tIf the UE is configured with multiple active component carriers, the first uplink symbol in the PUSCH allocation further includes the effect of timing difference between component carriers as given in [11, TS 38.133]. \n-\tIf the scheduling DCI triggered a switch of BWP, d2,2 equals to the switching time as defined in [11, TS 38.133], otherwise d2,2=0. \n-\tIf a PUSCH of a larger priority index would overlap with a PUCCH of a smaller priority index and the PUCCH and PUSCH are not simultaneously transmitted, and the UE is not provided uci-MuxWithDiffPrio for the primary PUCCH group or uci-MuxWithDiffPrioSecondaryPUCCHgroup for the secondary PUCCH group, d2 for the PUSCH of a larger priority is set as reported by the UE; otherwise d2 = 0.\n-\tFor a UE that supports capability 2 on a given cell, the processing time according to UE processing capability 2 is applied if the high layer parameter processingType2Enabled in PUSCH-ServingCellConfig is configured for the cell and set to 'enable',\n-\tIf the PUSCH indicated by the DCI is overlapping with one or more PUCCH channels, then the transport block is multiplexed following the procedure in clause 9.2.5 of [6, TS 38.213], otherwise the transport block is transmitted on the PUSCH indicated by the DCI.\n-\tIf uplink switching gap is triggered as defined in clause 6.1.6,  equals to the switching gap duration and for the UE configured with higher layer parameter uplinkTxSwitchingOption set to 'dualUL' for uplink carrier aggregation \u00b5UL=min(\u00b5UL,carrier1, \u00b5UL,carrier2), otherwise . \nOtherwise the UE may ignore the scheduling DCI. \nThe value of  is used both in the case of normal and extended cyclic prefix.\nTable 6.4-1: PUSCH preparation time for PUSCH timing capability 1\n\nTable 6.4-2: PUSCH preparation time for PUSCH timing capability 2\n\n7\tUE procedures for transmitting and receiving on a carrier with intra-cell guard bands\nFor operation with shared spectrum channel access for FR1, when the UE is configured with any of IntraCellGuardBandsPerSCS for UL carrier and for DL carrier and intraCellGuardBandsSL-List for SL carrier with SCS configuration , the UE is provided with  intra-cell guard bands on a carrier with , each defined by start CRB and size in number of CRBs,  and , provided by higher layer parameters startCRB and nrofCRBs, respectively, where . The subscript x is set to DL, UL, or SL for the downlink, uplink, or sidelink, respectively. Where there is no risk of confusion, the subscript x can be dropped. The intra-cell guard bands separate RB sets, each defined by start and end CRB, and , respectively. The UE does not expect that nrofCRBs is configured with non-zero value smaller than the applicable intra-cell guard bands as specified in [8, TS 38.101-1] corresponding to  and carrier size . The UE determines the start and end CRB indices for  as\n \nand\n \nThe RB set with index  consists of  resource blocks where . When the UE is not configured with IntraCellGuardBandsPerSCS for UL carrier and for DL carrier with SCS configuration , or is not configured with intraCellGuardBandsSL-List for SL carrier with SCS configuration , the UE determines the CRB indices for the intra-cell guard band(s), if any, and corresponding RB set(s) according to the nominal intra-cell guard band and RB set pattern as specified in [8, TS 38.101-1] corresponding to  and carrier size . For any one or more of DL, UL, SL, if the nominal intra-cell guard band and RB set pattern as specified in [8, TS 38.101-1] contains no intra-cell guard bands, the number of RB sets for the carrier is .\nFor a carrier with , the UE expects  and  where  for a BWP i configured by initialDownlinkBWP or BWP-Downlink for the DL BWP, or initialUplinkBWP or BWP-Uplink for the UL BWP, or configured by SL-BWP-Config for the SL BWP. Within the BWP i, RB sets are numbered in increasing order from 0 to  where  is the number of RB sets contained in the BWP i and RB set 0 within the BWP i corresponds to RB set  in the carrier and RB set  within the BWP i corresponds to RB set  in the carrier.\nWhen a UE is provided with nrofCRBs = 0 for all intra-cell guard band(s) on a carrier with , the UE is indicated that no intra-cell guard-bands are configured for the carrier and expects . For , the UE expects the number of RBs within a RB set is between 100 and 110. For , the UE expects the number of RBs within a RB set is between 50 and 55 except for at most one RB set which may contain 56 RBs.\n\n8\tPhysical sidelink shared channel related procedures\nA UE can be configured by higher layers with one or more sidelink resource pools. A sidelink resource pool can be for transmission of PSSCH, as described in Clause 8.1, and/or SL PRS, as described in Clause 8.2.4, or for reception of PSSCH, as described in Clause 8.3, and/or SL PRS, as described in Clause 8.4.4, and can be associated with either sidelink resource allocation mode 1 or sidelink resource allocation mode 2.\nA sidelink resource pool which can be used for transmission of both SL PRS and PSSCH will be referred to as shared SL PRS resource pool.\nA sidelink resource pool which can be used for transmission of SL PRS and cannot be used for transmission of PSSCH will be referred to as dedicated SL PRS resource pool.\nIn the frequency domain, \n-\tIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is not provided, or it is set to 'contiguousRB', a sidelink resource pool consists of sl-NumSubchannel contiguous sub-channels. A sub-channel consists of sl-SubchannelSize contiguous PRBs, where sl-NumSubchannel and sl-SubchannelSize are higher layer parameters.\n-\tIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'interlaceRB', in the frequency domain, each RB set of a sidelink resource pool consists of integer number of sub-channels, where each sub-channel consists of numInterlacePerSubchannel interlaces having contiguous interlace indices.\nFor operation with shared spectrum channel access for frequency range 1, a sidelink resource pool can be (pre-)configured to include integer number of RB sets, and the lowest RB of the sidelink resource pool is aligned with the lowest RB of lowest RB set in the resource pool, and the highest RB of the sidelink resource pool is aligned with the highest RB of highest RB set in the resource pool. A UE can be configured with intra-cell guard bands according to the higher layer parameter intraCellGuardBandsSL-List. The configured intra-cell guard band PRBs between any two adjacent RB sets can be used only for PSSCH transmission, if and only if, the UE has successfully performed channel access procedure in both adjacent RB sets, and the UE uses both of these RB sets for PSSCH transmission. If the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to \u2018contiguousRB', and if more than 1 sub-channel is used for PSSCH transmission, when the highest sub-channel of PSSCH overlaps with a single RB set and intra-cell guard band PRBs, the UE can transmit PSSCH on the PRBs belonging to the allocated sub-channel(s) except for the intra-cell guard band PRBs within the highest sub-channel. \nThe set of slots that may belong to a sidelink resource pool is denoted by  where\n-\t \n-\tthe slot index is relative to slot#0 of the radio frame corresponding to SFN 0 of the serving cell or DFN 0,\n-\tthe set includes all the slots except the following slots, \n-\t slots in which S-SS/PSBCH block (S-SSB) or additional transmission occasion for S-SSB is configured,\n-\t slots in each of which at least one of Y-th, (Y+1)-th, \u2026, (Y+X-1)-th OFDM symbols are not semi-statically configured as UL as per the higher layer parameter tdd-UL-DL-ConfigurationCommon of the serving cell if provided or sl-TDD-Configuration if provided or sl-TDD-Config of the received PSBCH if provided, where Y and X are set by the higher layer parameters sl-StartSymbol and sl-LengthSymbols, respectively.\n-\tThe reserved slots which are determined by the following steps.\n1)\tthe remaining slots excluding  slots and  slots from the set of all the slots are denoted by  arranged in increasing order of slot index. \n2)\ta slot  belongs to the reserved slots if , here  and  where  denotes the length of bitmap configured by higher layers.  \n-\tThe slots in the set are arranged in increasing order of slot index.  \nThe UE determines the set of logical slots assigned to a sidelink resource pool as follows:\n-\ta bitmap  associated with the resource pool is used where  the length of the bitmap is configured by higher layers.\n-\ta slot  belongs to the set if  where . \n-\tThe slots in the set are re-indexed such that the subscripts i of the remaining slots   are successive {0, 1, \u2026,  where  is the number of the slots remaining in the set.\nThe UE determines the set of resource blocks assigned to a sidelink resource pool as follows:\n-\tThe resource block pool consists of  PRBs. \n-\tIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is not provided, or is set to 'contiguousRB', the sub-channel m for  consists of a set of  contiguous resource blocks with the physical resource block number  for , where ,  and numSubchannel are given by higher layer parameters sl-StartRB-Subchannel, sl-SubchannelSize and sl-NumSubchannel, respectively.\n-\tIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'interlaceRB', the sub-channel m for  consists of a set of numInterlacePerSubchannel contiguous interlaces, where each interlace consists of at least 10 resource blocks as defined in clause 4.4.4.6 of [4, TS 38.211], numSubchannel is equal to the number of interlaces within one RB set divided by numInterlacePerSubchannel, and numInterlacePerSubchannel is given by higher layer parameter sl-NumInterlacePerSubchannel. The sub-channel m is indexed per RB set and is periodically indexed across multiple RB sets within the resource pool. The sub-channel with the same index is mapped to the set of numInterlacePerSubchannel interlace(s) with the same index(s) in different RB sets. The sub-channel#0 is mapped to interlaces 0 to  numInterlacePerSubchannel-1, the subchannel #1 is mapped to interlaces numInterlacePerSubchannel to numInterlacePerSubchannel*2-1, and so on.\nIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is not provided, or is set to \u2018contiguousRB\u2019, a UE is not expected to use the last  PRBs in the resource pool, except when the resource pool is a dedicated SL PRS resource pool.\nIn case of dynamic co-channel coexistence of LTE sidelink and NR sidelink, the UE expects to be (pre-)configured with 15 kHz SCS or 30 kHz SCS for a SL BWP, for NR sidelink transmissions in 30kHz SCS, the UE expects that the start of the first symbol of the earlier overlapping NR SL slot is aligned with the start of the first symbol of the overlapping LTE SL subframe.\n8.1\tUE procedure for transmitting the physical sidelink shared channel\nEach PSSCH transmission is associated with an PSCCH transmission.\nThat PSCCH transmission carries the 1st stage of the SCI associated with the PSSCH transmission; the 2nd stage of the associated SCI is carried within the resource of the PSSCH.\nIf the UE transmits SCI format 1-A on PSCCH according to a PSCCH resource configuration in slot n and PSCCH resource m, then for the associated PSSCH transmission in the same slot\n-\tone transport block is transmitted with up to two layers;\n-\tThe number of layers (\u028b) is determined according to the 'Number of DMRS port' field in the SCI;\n-\tThe set of consecutive symbols within the slot for transmission of the PSSCH is determined according to clause 8.1.2.1;\n-\tThe set of contiguous or interlaced resource blocks for transmission of the PSSCH is determined according to clause 8.1.2.2;\nTransform precoding is not supported for PSSCH transmission.\nOnly wideband precoding is supported for PSSCH transmission.\nThe DM-RS antenna ports  in Clause 8.4.1.1.2 of [4, TS38.211] are determined according to the ordering of DM-RS port(s) given by Tables 8.3.1.1-3 in Clause 8.3.1.1 of [5, TS 38.212].\nThe UE shall set the contents of the SCI format 2-A as follows:\n-\tthe UE shall set value of the 'HARQ process number' field as indicated by higher layers.\n-\tthe UE shall set value of the 'NDI' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Redundancy version' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Source ID' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Destination ID' field as indicated by higher layers.\n-\tthe UE shall set value of the 'HARQ feedback enabled/disabled indicator' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Cast type indicator' field as indicated by higher layers.\n-\tthe UE shall set value of the 'CSI request' field as indicated by higher layers.\n-\tthe UE shall set value of the 'CAPC' field, if present, as indicated by higher layers.\n-\tthe UE shall set value of the 'COT sharing cast type' field, if present, as indicated by higher layers.\n-\tthe UE shall set value of the 'COT sharing Additional ID' field, if present, as indicated by higher layers.\n-\tthe UE shall set value of the 'Remaining COT duration' field, if present, as indicated by higher layers.\nThe UE shall set the contents of the SCI formats 2-B as follows:\n-\tthe UE shall set value of the 'HARQ process number' field as indicated by higher layers.\n-\tthe UE shall set value of the 'NDI' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Redundancy version' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Source ID' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Destination ID' field as indicated by higher layers.\n-\tthe UE shall set value of the 'HARQ feedback enabled/disabled indicator' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Zone ID' field as indicated by higher layers.\n-\tthe UE shall set the 'Communication range requirement' field as indicated by higher layers.\nThe UE shall set the contents of the SCI format 2-C as follows:\n-\tthe UE shall set value of the 'HARQ process number' field as indicated by higher layers.\n-\tthe UE shall set value of the 'NDI' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Redundancy version' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Source ID' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Destination ID' field as indicated by higher layers.\n-\tthe UE shall set value of the 'HARQ feedback enabled/disabled indicator' field as indicated by higher layers.\n-\tthe UE shall set value of the 'CSI request' field as indicated by higher layers.\n-\tthe UE shall set value of 'Providing/Requesting indicator' field as indicated by higher layers.\n-\tif 'Providing/Requesting indicator' indicates SCI format 2-C is used to convey an explicit request for inter-UE coordination information:\n-\tthe UE shall set value of the 'Priority' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Number of subchannels' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Number of RB sets' field as indicated by higher layers if the higher layer parameter transmissionStructureForPSCCHandPSSCH in SL-BWP-Config is configured to 'interlaceRB'.\n-\tthe UE shall set value of the 'Resource reservation period' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Resource selection window location' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Resource set type' field as indicated by higher layers if higher layer parameter sl-DetermineResourceType is configured to 'UE-B's request'; otherwise this field is omitted.\n-\tif 'Providing/Requesting indicator' indicates SCI format 2-C is used to convey inter-UE coordination information:\n-\tthe UE shall set value of the 'Resource set type' field as indicated by higher layers.\n-\tthe UE shall set value of the 'Resource combination(s)' field (clause 8.1.5A) as indicated by higher layers.\n-\tthe UE shall set value of the 'Lowest subchannel indices' as indicated by higher layers\n-\tthe UE shall set value of the 'Lowest RB set indices' as indicated by higher layers if the higher layer parameter transmissionStructureForPSCCHandPSSCH in SL-BWP-Config is configured to 'interlaceRB'.\n-\tthe UE shall set value of the 'First resource location' as indicated by higher layers\n-\tthe UE shall set value of the 'Reference slot location' as indicated by higher layers\nThe UE shall set the contents of the SCI format 2-D as follows:\n-\tthe UE shall set value of the '[SL PRS resource ID]' field as indicated by higher layers.\n-\tthe UE shall set value of the '[SL PRS request]' field as indicated by higher layers.\n-\tthe UE shall set value of the '[Embedded SCI format]' field as indicated by higher layers.\n-\tif 'Embedded SCI format' indicates that SCI format 2-A is embedded within this SCI format 2-D then the UE shall include in the '[Embedded SCI format payload]' field the fields of SCI format 2-A, set as specified above.\n-\tif 'Embedded SCI format' indicates that SCI format 2-B is embedded within this SCI format 2-D then the UE shall include in the '[Embedded SCI format payload]' field the fields of SCI format 2-B, set as specified above.\n8.1.1\tTransmission schemes\nOnly one transmission scheme is defined for the PSSCH and is used for all PSSCH transmissions.\nPSSCH transmission is performed with up to two antenna ports, with antenna ports 1000-1001 as defined in clause 8.2.4 of [4, TS 38.211].\n8.1.2\tResource allocation\nIn sidelink resource allocation mode 1:\n-\tfor PSSCH and PSCCH transmission, dynamic grant, configured grant type 1 and configured grant type 2 are supported. The configured grant Type 2 sidelink transmission is semi-persistently scheduled by a SL grant in a valid activation DCI according to Clause 10.2A of [6, TS 38.213].\n8.1.2.1\tResource allocation in time domain\nThe UE shall transmit the PSSCH in the same slot as the associated PSCCH.\nThe minimum resource allocation unit in the time domain is a slot.\nThe UE shall transmit the PSSCH in consecutive symbols within the slot, subject to the following restrictions:\n-\tThe UE shall not transmit PSSCH in symbols which are not configured for sidelink. A symbol is configured for sidelink, according to higher layer parameters sl-StartSymbol and sl-LengthSymbols, where sl-StartSymbol is the symbol index of the first symbol of sl-LengthSymbols consecutive symbols configured for sidelink.\n-\tWithin the slot, PSSCH resource allocation starts at symbol sl-StartSymbol+1, except when startingSymbolFirst and startingSymbolSecond are provided for a SL-BWP. If startingSymbolFirst and startingSymbolSecond are provided for the SL-BWP, there are 2 candidate starting symbols, given by startingSymbolFirst and startingSymbolSecond respectively, for PSSCH transmission for slots without PSFCH symbols; and there is one starting symbol, given by startingSymbolFirst, for PSSCH transmission for slots with PSFCH symbols. PSSCH resource allocation starts at the next symbol after each candidate starting symbol. In a slot, the UE may use the second candidate starting symbol, provided by startingSymbolSecond, only if it fails to access the channel prior to the first candidate starting symbol provided by startingSymbolFirst. \n-\tThe UE shall not transmit PSSCH in symbols which are configured for use by PSFCH, if PSFCH is configured in this slot.\n-\tThe UE shall not transmit PSSCH in the last symbol configured for sidelink.\n-\tThe UE shall not transmit PSSCH in the symbol immediately preceding the symbols which are configured for use by PSFCH, if PSFCH is configured in this slot.\n-\tFor operation with shared spectrum channel access in frequency range 1, for the first SL transmission with PSSCH/PSCCH by a UE to initiate a channel occupancy for a slot, if no resource reservation is transmitted or detected for the slot and any one of the RB set(s) of the intended PSCCH/PSSCH transmission, and if UE is configured with multiple CPE starting positions provided by CPEStartingPositionsPSCCH-PSSCH-InitiateCOT, the UE determines a duration of a cyclic prefix extension Text to be applied according to [4, TS 38.211] where the index i for \ud835\udc36\ud835\udc56 and  [4, TS 38.211] is chosen randomly from a set of values configured per priority of the PSCCH/PSSCH by the higher layer parameter CPEStartingPositionsPSCCH-PSSCH-InitiateCOT. Otherwise, the UE uses a configured default cyclic prefix extension Text indicated by DefaultCPEStartingPositionsPSCCH-PSSCH-InitiateCOT.\n-\tFor operation with shared spectrum channel access in frequency range 1, for the first SL transmission with PSSCH/PSCCH by a UE within a channel occupancy, the UE transmitting in the channel occupancy determines the duration of a cyclic prefix extension Text  according to higher layer parameter DefaultCPEStartingPositionsPSCCH-PSSCH-SharedCOT, unless the UE is configured with multiple CPE starting positions for transmitting within a shared channel occupancy by CPEStartingPositionsPSCCH-PSSCH-SharedCOT, in which case the UE determines the duration of a cyclic prefix extension Text to be applied according to [4, TS 38.211] where the index i for \ud835\udc36\ud835\udc56 and  [4, TS 38.211] is chosen randomly from a set of values configured per priority of the PSCCH/PSSCH by the higher layer parameter CPEStartingPositionsPSCCH-PSSCH-SharedCOT, if no resource reservation is transmitted or detected for the slot and the RB set(s) of the intended PSCCH/PSSCH transmission, otherwise, the UE uses the configured default cyclic prefix extension Text indicated by DefaultCPEStartingPositionsPSCCH-PSSCH-SharedCOT.\n-\tFor operation with shared spectrum channel access in frequency range 1, for a PSSCH/PSCCH transmission by a UE that follows another SL transmission by the same UE in a channel occupancy, the UE determines the duration of a cyclic prefix extension Text as follows:\n-\tWhen gap between the PSSCH/PSCCH transmission and the previous SL transmission is 1 symbol, the index i for is set to '1'.\n-\tWhen gap between the PSSCH/PSCCH transmission and the previous SL transmission is 2 symbols, the index i for is set to '3' for \u00b5=1 and to '2' for \u00b5=2.\nIn sidelink resource allocation mode 1:\n-\tFor sidelink dynamic grant, the PSSCH transmission is scheduled by a DCI format 3_0. \n-\tFor sidelink configured grant type 2, the configured grant is activated by a DCI format 3_0. \n-\tFor sidelink dynamic grant and sidelink configured grant type 2:\n-\tThe \"Time gap\" field value m of the DCI format 3_0 provides an index m + 1 into a slot offset table. That table is given by higher layer parameter sl-DCI-ToSL-Trans and the table value at index m + 1 will be referred to as slot offset .\n-\tThe slot of the first sidelink transmission scheduled by the DCI is the first SL slot of the corresponding resource pool that starts not earlier than , where  is the starting time of the downlink slot carrying the corresponding DCI,  is the timing advance value corresponding to the TAG of the serving cell on which the DCI is received and is the slot offset between the slot of the DCI and the first sidelink transmission scheduled by DCI and  is the SL slot duration.\n-\tThe \"Configuration index\" field of the DCI format 3_0, if provided and not reserved, indicates the index of the sidelink configured type 2.\n-\tFor sidelink configured grant type 1:\n-\tThe slot of the first sidelink transmissions follows the higher layer configuration according to [10, TS 38.321].\n8.1.2.2\tResource allocation in frequency domain\nThe resource allocation unit in the frequency domain is the sub-channel.\nThe sub-channel assignment for sidelink transmission is determined using the \"Frequency resource assignment\" field in the associated SCI.\nThe lowest sub-channel for sidelink transmission is the sub-channel on which the lowest PRB of the associated PSCCH is transmitted.\nIf a PSSCH scheduled by a PSCCH would overlap with resources containing the PSCCH, the resources corresponding to a union of the PSCCH that scheduled the PSSCH and associated PSCCH DM-RS are not available for the PSSCH.\nWhen PSSCH is transmitted on multiple RB sets, the corresponding PSCCH is located on the sub-channel with the lowest index of the RB set with the lowest index within the multiple RB sets.\nFor operation with shared spectrum channel access for frequency range 1, if the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to \u2018interlaceRB:, \n-\tthe lowest index of the RB set allocation to the initial PSSCH transmission is indicated via the field \"Lowest index of the RB set allocation to the initial transmission\" of the DCI format 3_0. \n-\tthe starting RB set index of the initial PSSCH transmission of the sidelink configured grant Type 1 is indicated via the higher layer parameter sl-StartRBsetCG-Type1.\n8.1.3\tModulation order, target code rate, redundancy version and transport block size determination\nThe redundancy version is given by the \"Redundancy version\" field in SCI format 2-A, 2-B, 2-C or 2-D.\n8.1.3.1\tModulation order and target code rate determination\nIMCS is given by the 'Modulation and coding scheme' field in SCI format 1-A.\nThe MCS table is determined as follows: Table 5.1.3.1-1 is used if no additional MCS table is configured by higher layer parameter sl-Additional-MCS-Table; otherwise an MCS table is determined according to Table 8.1.3.1-1 or Table 8.1.3.1-2 and 'Additional MCS table indicator' field in SCI format 1-A. \nTable 8.1.3.1-1: Mapping of one bit of MCS table indicator to MCS table\n\nTable 8.1.3.1-2: Mapping of two bits of MCS table indicator to MCS table\n\nThe UE shall use IMCS and the MCS table determined according to the previous step to determine the modulation order (Qm) and Target code rate (R) used in the physical sidelink shared channel.\n8.1.3.2\tTransport block size determination\nFor the PSSCH assigned by SCI, if Table 5.1.3.1-2 is used and , or a table other than Table 5.1.3.1-2 is used and , the UE shall first determine the TBS as specified below:\nThe UE shall first determine the number of REs (NRE) within the slot.\n-\tA UE first determines the number of REs allocated for PSSCH within a PRB () by , where  \n-\t is the number of subcarriers in a physical resource block, \n-\t = sl-LengthSymbols -2, where sl-LengthSymbols is the number of sidelink symbols within the slot provided by higher layers. If startingSymbolFirst and startingSymbolSecond are provided for the SL-BWP, the number of sidelink symbols assumed in transport block size determination is determined by a reference number of symbols, numRefSymbolLength, provided by higher layers, such that numRefSymbolLength replaces sl-LengthSymbols in calculation of . \n-\t = 3 if 'PSFCH overhead indication' field of SCI format 1-A indicates \"1\", and  = 0 otherwise, if higher layer parameter sl-PSFCH-Period is 2 or 4. If higher layer parameter sl-PSFCH-Period is 0, . If higher layer parameter sl-PSFCH-Period is 1, .\n-\t is the number of OFDM symbols used for SL PRS in the slot as indicated by the \u2018SL PRS resource ID\u2019 in SCI format 2-D if the 2nd-stage SCI is SCI format 2-D, and , otherwise.,\n-\t is the overhead given by higher layer parameter sl-X-Overhead, \n-\t is given by Table 8.1.3.2-1 according to higher layer parameter sl-PSSCH-DMRS-TimePatternList.\nTable 8.1.3.2-1:  according to higher layer parameter sl-PSSCH-DMRS-TimePatternList\n-\tA UE determines the total number of REs allocated for PSSCH () by , where\n-\tnPRB is the total number of allocated PRBs for the PSSCH. If the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'interlaceRB', a reference number of PRBs (nref) per interlace within 1 RB set, numRefPRBOfInterlace, is provided by higher layers for determination of total number of PRBs for PSSCH, that is nPRB = nref * ninter,subCH * nsubCH * nRB-set, where ninter,subCH is given by the higher layer parameter numInterlacePerSubchannel, nsubCH is the number of occupied sub-channels within one RB set  for the PSSCH, and  nRB-set is the number of occupied RB sets  for the PSSCH. If the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to \u2018contiguousRB\u2019, nPRB =  * nsubCH , where  is provided by higher layer parameter sl-SubchannelSize, and nsubCH is the number of occupied sub-channels for the PSSCH.\n-\t is the total number of REs occupied by the PSCCH and PSCCH DM-RS.\n-\t is the number of coded modulation symbols generated for 2nd-stage SCI transmission (prior to duplication for the 2nd layer, if present) according to Clause 8.4.4 of [5, TS 38.212], with the assumption of .\nThe UE determines TBS according to Steps 2), 3), and 4) in clause 5.1.3.2.\nA UE is not expected to receive an SCI indicating  if Table 5.1.3.1-2 is used, or  otherwise.\n8.1.4\tUE procedure for determining the subset of resources to be reported to higher layers in PSSCH resource selection in sidelink resource allocation mode 2\nIn resource allocation mode 2, the higher layer can request the UE to determine a subset of resources from which the higher layer will select resources for PSSCH/PSCCH transmission for a carrier. To trigger this procedure, in slot n for this carrier, the higher layer provides the following parameters for this PSSCH/PSCCH transmission:\n-\tthe resource pool from which the resources are to be reported;\n-\tL1 priority, ;\n-\tthe remaining packet delay budget;\n-\tnumber of sub-channels, : If the higher layer parameter transmissionStructureForPSCCHandPSSCH is not provided, the number of sub-channels to be used for the PSSCH/PSCCH transmission in a slot is . If the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'contiguousRB',  corresponds to the number of sub-channels within all used RB sets to be used for the PSCCH/PSSCH transmission in a slot. If the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'interlaceRB',  corresponds to the number of sub-channels to be used for the PSSCH/PSCCH transmission in a slot in each RB set,\n-\tIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'interlaceRB', the number of used RB sets for one PSCCH/PSSCH transmission, LRBset.\n-\toptionally, the number of consecutive slots for Multi-consecutive slots transmission, .\n-\toptionally, the resource reservation interval, , in units of msec. \n-\tif the higher layer requests the UE to determine a subset of resources from which the higher layer will select resources for PSSCH/PSCCH transmission as part of re-evaluation or pre-emption procedure, the higher layer provides a set of resources which may be subject to re-evaluation and a set of resources which may be subject to pre-emption.\n-\tit is up to UE implementation to determine the subset of resources as requested by higher layers before or after the slot  - , where  is the slot with the smallest slot index among and , and  is equal to , where \u00a0is defined in slots in Table 8.1.4-2 where  is the SCS configuration of the SL BWP.\n-\tEach of the resource(s) in  and/or  corresponds to  consecutive slots if is provided with a value larger than 1.\n-\tOptionally, the indication of resource selection mechanism.\n-\tOptionally, rbSetsWithConsecutiveLBTFailure, which indicates the RB sets where consistent LBT failure has been indicated.\nThe following higher layer parameters affect this procedure:\n-\tsl-SelectionWindowList: internal parameter  is set to the corresponding value from higher layer parameter sl-SelectionWindowList for the given value of .\n-\tsl-Thres-RSRP-List: this higher layer parameter provides an RSRP threshold for each combination , where  is the value of the priority field in a received SCI format 1-A and  is the priority of the transmission of the UE selecting resources; for a given invocation of this procedure, .\n-\tsl-RS-ForSensing selects if the UE uses the PSSCH-RSRP or PSCCH-RSRP measurement, as defined in clause 8.4.2.1.\n-\tsl-ResourceReservePeriodList\n-\tsl-SensingWindow: internal parameter  is defined as the number of slots corresponding to sl-SensingWindow msec\n-\tsl-TxPercentageList: internal parameter  for a given  is defined as sl-TxPercentageList () converted from percentage to ratio\n-\tsl-PreemptionEnable: if sl-PreemptionEnable is provided, and if it is not equal to 'enabled', internal parameter  is set to the higher layer provided parameter sl-PreemptionEnable.\n-\tOptionally, minimum number of Y slots as  (sl-MinNumCandidateSlotsPeriodic), which indicates the minimum number of Y slots that are included in the candidate resources corresponding to periodic-based partial sensing and contiguous partial sensing for resource (re)selection triggered by periodic transmission ().\n-\tOptionally, minimum number of  slots as  (sl-MinNumCandidateSlotsAperiodic), which indicates the minimum number of  slots that are included in the candidate resources corresponding to periodic-based partial sensing and/or contiguous partial sensing results (if available) for resource (re)selection triggered by aperiodic transmission ().\n-\tOptionally, sensing occasion as sl-PBPS-OccasionReservePeriodList, which indicates the subset of periodicity values from sl-ResourceReservePeriodList used to determine periodic sensing occasions in periodic-based partial sensing. If not configured, all periodicity values from sl-ResourceReservePeriodList are used to determine periodic sensing occasions in periodic-based partial sensing.\n-\tOptionally, additional sensing occasions as sl-Additional-PBPS-Occasion, which indicates that UE additionally monitors periodic sensing occasions that correspond to a set of values. The possible values of the set at least includes the most recent sensing occasion before the first slot of the candidate slots subject to processing time restriction as specified below for a given reservation periodicity and the last periodic sensing occasion prior to the most recent one for the given reservation periodicity. If not (pre-)configured, the UE monitors the most recent sensing occasion before the first slot of the candidate slots subject to processing time restriction as specified below for the given periodicity used to determine periodic sensing occasions in periodic-based partial sensing.\n-\tOptionally, indication of the size in logical slots of contiguous partial sensing window for periodic transmissions as defined by the parameter sl-CPS-WindowPeriodic.\n\tOptionally, indication of the size in logical slots of contiguous partial sensing window for aperiodic transmissions as defined by the parameter sl-CPS-WindowAperiodic.\n-\tOptionally, indication of whether UE is required to perform SL reception of PSCCH and RSRP measurement for partial sensing on slots in SL DRX inactive time as sl-PartialSensingInactiveTime.\nIn case of dynamic co-channel coexistence of LTE sidelink and NR sidelink, that is coexistence over time and frequency resources that are shared between NR sidelink and LTE sidelink:\n-\tsl-NRPSSCH-EUTRA-ThresRSRP-List: this higher layer parameter provides an RSRP threshold for each combination , where  is the value of the priority field in a received LTE SCI format 1, and  is the priority of the transmission of the UE selecting resources; for a given invocation of this procedure, .\n-\tsl-NRPSFCH-EUTRA-ThresRSRP-List: this higher layer parameter, if provided, provides an RSRP threshold for each combination , where  is the value of the priority field in a received LTE SCI format 1, and  is the priority of the transmission of the UE selecting resources; for a given invocation of this procedure, .\nThe resource reservation interval, , if provided, is converted from units of msec to units of logical slots, resulting in  according to clause 8.1.7.\nWhen the resource pool is (pre-)configured with sl-AllowedResourceSelectionConfig including full sensing, and full sensing is configured in the UE by higher layers, the UE performs full sensing.\nWhen periodic reservation for another TB (sl-MultiReserveResource) is enabled for the resource pool, the resource pool is (pre-)configured with sl-AllowedResourceSelectionConfig including partial sensing, and partial sensing is configured by higher layer, the UE performs periodic-based partial sensing, unless other conditions state otherwise in the specification. \nWhen a UE is triggered by higher layer to report resources for resource (re-)selection in a mode 2 Tx pool, the resource pool is (pre-)configured with sl-AllowedResourceSelectionConfig including partial sensing, and partial sensing is configured by higher layer, the UE performs contiguous partial sensing, unless stated otherwise in the specification.\nNotation:\n denotes the set of slots which belongs to the sidelink resource pool and is defined in Clause 8.\nFor dynamic co-channel coexistence of LTE sidelink and NR sidelink,  denotes the set of subframes that may belong to an LTE sidelink resource pool as defined in clause 14.1.5 of [19, TS36.213].\nThe following steps are used:\n1)\tIf a number of consecutive slots is provided with a value larger than 1, the candidate multi-slot resource definition is applied. Otherwise, the candidate single-slot resource definition is applied. \nIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'contiguousRB', a candidate multi-slot resource   is defined as a set of  contiguous sub-channels starting from sub-channel  in  consecutive slots starting from slot , when the set of  slots that are consecutive in physical slots. \nIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'interlaceRB', a candidate multi-slot resource  is defined as a set of  contiguous sub-channels starting from sub-channel  in  consecutive slots starting from slot  in  contiguous RB sets starting from RB set z, when the set of  slots that are consecutive in physical slots. A candidate single-slot resource  is defined as a set of  contiguous sub-channels starting from sub-channel  in slot  in  contiguous RB sets starting from RB set z. \nIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is not provided or if the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to \u2018contiguousRB\u2019, a candidate single-slot resource for transmission  is defined as a set of  contiguous sub-channels with sub-channel x+j in slot  where . \nThe UE shall assume that any set of  contiguous sub-channels or  contiguous sub-channels in  contiguous RB sets included in the corresponding resource pool within the time interval  correspond to one candidate single-slot resource or the UE shall assume that any set of  contiguous sub-channels or  contiguous sub-channels in  contiguous RB sets in  consecutive slots included in the corresponding resource pool within the time interval  correspond to one candidate multi-slot resource for UE performing full sensing. The UE shall assume that any set of  contiguous sub-channels included in the corresponding resource pool in a set of Y candidate slots within the time interval  correspond to one candidate single-slot resource or one candidate multi-slot resource for UE performing periodic-based partial sensing together with contiguous partial sensing and resource (re)selection triggered by periodic transmission (), or in a set of Y' candidate slots within the time interval  correspond to one candidate single-slot resource or one candidate multi-slot resource for UE performing at least contiguous partial sensing and resource (re)selection triggered by aperiodic transmission (), where \n-\tselection of  is up to UE implementation under   , where  is defined in slots in Table 8.1.4-2 where  is the SCS configuration of the SL BWP; \n-\tif  is shorter than the remaining packet delay budget (in slots) then is up to UE implementation subject to    remaining packet delay budget (in slots); otherwise is set to the remaining packet delay budget (in slots).\n-\t is selected by UE where .\n-\t is selected by UE where . When the UE performs at least contiguous partial sensing and if , the UE selects a set of  candidate slots with corresponding PBPS and/or CPS results (if available). If the number of candidate slots  is smaller than , it is up to UE implementation to include other candidate slots.\nIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'contiguousRB', the UE shall exclude candidate single-slot or candidate multi-slot resources with the sub-channel with the smallest index including resource blocks of the intra-cell guardband PRBs, configured by higher layer parameter, intraCellGuardBandsSL-List, or determined according to the nominal intra-cell guard band and RB set pattern as specified in [8, TS 38.101-1] when higher layer parameter, intraCellGuardBandsSL-List, is not configured.\nIf rbSetsWithConsecutiveLBTFailure is provided, the UE shall exclude candidate single-slot resources or candidate multi-slot resources, whose associated one or more RB set(s) is included in the rbSetsWithConsecutiveLBTFailure parameter.\nThe total number of remaining candidate single-slot resources or candidate multi-slot resources is denoted by .\n2)\tThe sensing window is defined by the range of slots [), when the UE performs full sensing, where  is defined above and  is defined in slots in Table 8.1.4-1 where  is the SCS configuration of the SL BWP. The UE shall monitor slots which belongs to a sidelink resource pool within the sensing window except for those in which its own transmissions occur. The UE shall perform the behaviour in the following steps based on PSCCH decoded and RSRP measured in these slots.\n\tWhen the UE performs periodic-based partial sensing, the UE shall monitor slots at , where  is a slot of the selected candidate slots and  is  converted to units of logical slot according to clause 8.1.7. The UE shall perform the behaviour in the following steps based on PSCCH decoded and RSRP measured in these slots.\nThe value of  corresponds to sl-PBPS-OccasionReservePeriodList if (pre-)configured, otherwise, the values correspond to all periodicity from sl-ResourceReservePeriodList. \n\tThe UE monitors sensing occasion(s) determined by sl-Additional-PBPS-Occasion, as previously described, and not earlier than . For a given periodicity , the values of k correspond to the most recent sensing occasion earlier than if sl-Additional-PBPS-Occasion is not (pre-)configured, and additionally includes the value of k corresponding to the last periodic sensing occasion prior to the most recent one if sl-Additional-PBPS-Occasion is (pre-)configured.  is the first slot of the selected Y candidate slots of PBPS.\n\tWhen the UE performs periodic-based partial sensing and contiguous partial sensing with periodic reservation for another TB (sl-MultiReserveResource) enabled and , the contiguous partial sensing window is defined by the range of slots . n+TA is M consecutive logical slots earlier than slot , and n+TB is  slots earlier than , where  is the first slot of the selected Y candidate slots of PBPS, and ,  are in units of physical time/slots. The value of M is (pre-)configured with the sl-CPS-WindowPeriodic. The UE shall perform the behaviour in the following steps based on PSCCH decoded and RSRP measured in these slots. If sl-CPS-WindowPeriodic is not (pre-)configured, M equals to 31. \n\tWhen the UE performs at least contiguous partial sensing and if , the contiguous partial sensing window is defined by the range of slots .  and  are both selected such that the UE has sensing results starting at least M consecutive logical slots before  and ending at  slots earlier than , where  is the first slot of the selected candidate slots. The value of M is (pre-)configured with the sl-CPS-WindowAperiodic. The UE shall perform the behaviour in the following steps based on PSCCH decoded and RSRP measured in these slots. If sl-CPS-WindowAperiodic is not (pre-)configured, M equals to 31. When the minimum M slots for CPS cannot be guaranteed and when , it is up to UE implementation to either continue with step 3) or perform random selection.\n\tWhether the UE is required to performs SL reception of PSCCH and RSRP measurement for partial sensing on slots in SL DRX inactive time is enabled/disabled by higher layer parameter sl-PartialSensingInactiveTime. When it is enabled, if UE performs periodic-based partial sensing on the slots in SL DRX inactive time for a given periodicity corresponding to , UE monitors only the default periodic sensing occasions (most recent sensing occasion) from the slots; if UE performs contiguous partial sensing on the slots in SL DRX inactive time, UE monitors a minimum of M slots from the slots.\n2LTE1)\tIn case of dynamic co-channel coexistence of LTE sidelink and NR sidelink: The UE uses information determined by the E-UTRA radio access within the range of LTE subframes [], where is an LTE subframe no later than LTE subframe  is the LTE subframe ,  is the LTE subframe which overlaps slot n,   is 1100 msec and   is up to UE implementation under ; is 4+T msec, where T \u2264 4 msec. The UE shall perform the procedures in 5LTE1, 5LTE3 and 6LTE based on the information for these LTE subframes which is known to the NR radio access at the latest T msec prior to slot n. \n2LTE2)\tIn case of dynamic co-channel coexistence of LTE sidelink and NR sidelink: The UE shall perform the procedures in 5LTE2 based on the information determined by the E-UTRA radio access, which is known by the NR radio access at the latest T msec prior to slot n.\n3)\tThe internal parameter  is set to the corresponding value of RSRP threshold indicated by the i-th field in sl-Thres-RSRP-List, where .\n3LTE)\tIn case of dynamic co-channel coexistence of LTE sidelink and NR sidelink:\n-\tThe internal parameter  is set to the corresponding value of RSRP threshold indicated by the i-th field in sl-NRPSSCH-EUTRA-ThresRSRP-List, where .\n-\tThe internal parameter  is set to the corresponding value of RSRP threshold indicated by the i-th field in sl-NRPSFCH-EUTRA-ThresRSRP-List, if provided, where . If sl-NRPSFCH-EUTRA-ThresRSRP-List is not provided then each element of  is set to minus Infinity dBm.\n4)\tThe set  is initialized to the set of all the remaining candidate single-slot resources or candidate multi-slot resources identified in step 1. \n5)\tThe UE shall exclude any candidate single-slot resource  or  , or candidate multi-slot resource  or  from the set  if it meets all the following conditions:\n-\tthe UE has not monitored slot  in Step 2.\n-\tfor any periodicity value allowed by the higher layer parameter sl-ResourceReservePeriodList and a hypothetical SCI format 1-A received in slot  with 'Resource reservation period' field set to that periodicity value and indicating all subchannels of the resource pool in this slot, condition c in step 6 would be met.\n5LTE1)\tIn case of dynamic co-channel coexistence of LTE sidelink and NR sidelink: The UE shall exclude any candidate single-slot resource  from the set  if all the following conditions are met:\n-\tthe resource pool overlaps with an LTE sidelink resource pool;\n-\tthe UE has not monitored LTE subframe  .\n-\tfor any periodicity value allowed by the LTE higher layer parameter restrictResourceReservationPeriod and a hypothetical LTE SCI format 1 received in LTE subframe   with 'Resource reservation' field set to that periodicity value and indicating all subchannels of the LTE sidelink resource pool in this LTE subframe, condition c in step 6LTE would be met.\n5LTE2)\tIn case of dynamic co-channel coexistence of LTE sidelink and NR sidelink: The UE shall exclude any candidate single-slot resource  from the set  if all the following conditions are met:\n-\tthe UE has a selected sidelink grant for LTE V2X sidelink according to [19, TS 36.321]  .\n-\tthe selected sidelink grant for LTE V2X sidelink determines the set of LTE resource blocks and LTE subframes which overlaps in time with  for j=0, 1, \u2026, ;\n-\tthe priority value associated with the selected sidelink grant for LTE V2X sidelink is lower than ; It is up to UE implementation whether or not to apply this exclusion step if the priority value associated with selected sidelink grant for LTE V2X sidelink is higher than or equal to .\n5LTE3) In case of dynamic co-channel coexistence of LTE sidelink and NR sidelink: The UE shall exclude any candidate single-slot resource  from the set  if all the following conditions are met:\na)\tthe resource pool is configured with PSFCH resources;\nb)\tan LTE SCI format 1 is received in LTE subframe , and the 'Resource reservation' field and 'Priority' field in the received LTE SCI format 1 indicate the values  and , respectively according to Clause 14.2.1 in [19, TS 36.213], where LTE subframes are indexed according to Clause 14.1.5 in [19, TS 36.213];\nc)\tthe LTE PSSCH-RSRP measurement according to the received LTE SCI format 1 is higher than \nd)\tthe SCI format received in LTE subframe  or the same SCI format which is assumed to be received in LTE subframe(s)  determines according to clause 14.1.1.4C or clause 14.2.4 in [19, TS 36.213] the set of LTE subframes which overlaps with PSFCH slots associated with  for q=1, 2, \u2026, Q and j=0, 1, \u2026, where the PSFCH association is according to [6, TS 38.213]. and Q are determined as in condition c) of step 6LTE.\n5a)\tIf the number of candidate single-slot resources  or , or the number of candidate multi-slot resource  or  remaining in the set  is smaller than , the set  is initialized to the set of all the candidate single-slot resources or candidate multi-slot resources as in step 4.\n6)\tThe UE shall exclude any candidate single-slot resource  or , or candidate multi-slot resource  or  from the set  if it meets all the following conditions:\na)\tthe UE receives an SCI format 1-A in slot , and 'Resource reservation period' field, if present, and 'Priority' field in the received SCI format 1-A indicate the values  and , respectively according to Clause 16.4 in [6, TS 38.213];\nb)\tthe RSRP measurement performed, according to clause 8.4.2.1 for the received SCI format 1-A, is higher than \nc)\tthe SCI format received in slot or the same SCI format which, if and only if the 'Resource reservation period' field is present in the received SCI format 1-A, is assumed to be received in slot(s)  determines according to clause 8.1.5 the set of resource blocks and slots which overlaps with  or  for q=1, 2, \u2026, Q and j=0, 1, \u2026, . Here,  is  converted to units of logical slots according to clause 8.1.7,  if  and , where if the UE is configured with full sensing by its higher layer,  if slot n belongs to the set , otherwise slot  is the first slot after slot n belonging to the set ; If UE is configured with partial sensing by its higher layer,  if slot  belongs to the set , otherwise, slot  is the first slot after slot  belonging to the set . Otherwise . If the UE is configured with full sensing by its higher layer,  is set to selection window size T2 converted to units of msec. If UE is configured with partial sensing by its higher layer,  shall be converted to milliseconds, where slot  is the last slot of the  or  candidate slots. The slot  is the first slot of the selected/remaining set of  or  candidate slots.\n6LTE)\tIn case of dynamic co-channel coexistence of LTE sidelink and NR sidelink: The UE shall exclude any candidate single-slot resource  from the set  if all the following conditions are met:\na)\tan LTE SCI format 1 is received in LTE subframe , and the 'Resource reservation' field and 'Priority' field in the received LTE SCI format 1 indicate the values  and , respectively according to Clause 14.2.1 in [19, TS 36.213], where LTE subframes are indexed according to Clause 14.1.5 in [19, TS 36.213];\nb)\tthe LTE PSSCH-RSRP measurement according to the received LTE SCI format 1 is higher than \nc)\tthe SCI format received in LTE subframe  or the same SCI format which is assumed to be received in LTE subframe(s)  determines according to clause 14.1.1.4C or clause 14.2.4 in [19, TS 36.213] the set of LTE resource blocks and LTE subframes which overlaps with  for q=1, 2, \u2026, Q and j=0, 1, \u2026, . Here,  is with  determined according to  Table 14.1.1-1 in [19, TS 36.213],  if  and , where if subframe  belongs to the set , otherwise subframe  is the first subframe after subframe belonging to the set ; Otherwise .  is set to selection window size T2 converted to units of msec. \n6a)\tThis step is executed only if the procedure in clause 8.1.4A is triggered.\n6b)\tThis step is executed only if the procedure in clause 8.1.4C is triggered.\n7)\tIf the number of candidate single-slot resources or candidate multi-slot resources remaining in the set  is smaller than , then  and , if set, is increased by 3 dB for each priority value  and the procedure continues with step 4.\n7a)\tIf sidelink DRX active time of RX UE is provided by the higher layer and there is no candidate single-slot or multi-slot resource remained within the sidelink DRX active time in the set , the UE based on its implementation additionally selects and includes at least one candidate single-slot resource or at least one candidate multi-slot resource within the sidelink DRX active time in the set .\nThe UE shall report set  to higher layers. \nIf a resource  from the set  is not a member of , then the UE shall report re-evaluation of the resource  to higher layers.\nIf a resource  from the set  meets the conditions below then the UE shall report pre-emption of the resource  to higher layers.\n-\t is not a member of , and\n-\t meets the conditions for exclusion in step 6, with  set to the final threshold after executing steps 1)-7), i.e. including all necessary increments for reaching , or for exclusion in step 6LTE, with  set to the final threshold after executing steps 1-7, i.e. including all necessary increments for reaching , or for exclusion in step 5LTE3, and\n-\tthe associated priority  satisfies one of the following conditions:\n-\tsl-PreemptionEnable is provided and is equal to 'enabled' and \n-\tsl-PreemptionEnable is provided and is not equal to 'enabled', and  and \n\nTable 8.1.4-1:  depending on sub-carrier spacing\n\nTable 8.1.4-2:  depending on sub-carrier spacing\n\nWhen the UE performs periodic-based partial sensing and contiguous partial sensing, and when the UE is triggered to perform re-evaluation and/or pre-emption checking, and if ,\n-\tDuring the qth reservation period (q=0,1,2,\u2026, Cresel-1), candidate resource set (SA) is initialized to the remaining Y candidate slots\u00a0starting from slot  and ending at the last slot of the Y candidate slots, where the slot indices of the remaining Y candidate slots are equal to , where  is a slot index of Y candidate slots used in the initial resource (re)selection.\n-\t is the first candidate slot starting from slot n+T3.\n-\tThe UE performs PBPS for the remaining Y candidate slots according to  except for those in which its own transmissions occur, where is a slot belonging to the remaining Y candidate slots, and\u00a0k and Preserve are the same as resource (re)selection, where the values of k correspond to the most recent sensing occasion earlier than if sl-Additional-PBPS-Occasion is not (pre-)configured, and additionally includes the value of k corresponding to the last periodic sensing occasion prior to the most recent one if sl-Additional-PBPS-Occasion is (pre-)configured.\n-\tThe UE performs CPS starting from M logical slots earlier than  to  slots earlier than  except for those in which its own transmissions occur.\n-\tBy default, M is 31 unless (pre-)configured with another value by sl-CPS-WindowPeriodic.\nWhen the UE is triggered to perform re-evaluation and/or pre-emption checking, performs at least contiguous partial sensing, and if ,\n-\tCandidate resource set (SA) is initialized to the remaining Y' candidate slots\u00a0starting from slot  and ending at the last slot of the Y' candidate slots, where  is the first candidate slot starting from slot n+T3.\n-\tIt is up to UE implementation that UE may perform PBPS for periodic sensing occasions after the resource (re)selection when higher layer parameter sl-MultiReserveResource is enabled.\n-\tUE performs CPS starting from at least M consecutive logical slots earlier than  to  slots earlier than  except for those in which its own transmissions occur.\n-\tFor minimum size M of the contiguous partial sensing window , by default, M is 31 unless (pre-)configured with another value, by sl-CPS-WindowAperiodic.\nWhen the minimum M slots for CPS cannot be guaranteed, UE senses in all available slots starting from\u00a0the resource (re)selection trigger slot of the same TB to  slots earlier than . The UE re-evaluation and pre-emption checking is based on all available sensing results after .\n8.1.4A\tUE procedure for determining a set of preferred or non-preferred resources for another UE's transmission\nWhen this procedure is triggered, the following parameters are provided by the higher layer:\n-\tthe resource pool from which the preferred or non-preferred resources are to be determined;\n-\tthe resource selection window  within which the preferred or non-preferred resources are to be determined;\n-\tthe resource set type (either preferred or non-preferred resource set);\n-\tif the resource set type indicates preferred set, then the higher layer additionally provides the following parameters:\n-\tL1 priority, ;\n-\tthe number of sub-channels to be used for the PSSCH/PSCCH transmission in a slot, ;\n-\tIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'interlaceRB', the number of used RB sets for one PSCCH/PSSCH transmission, LRBset;\n-\tthe resource reservation period, , if present.\nThe value of  is determined by the UE according to clause 8.1.5.\n\nWhen this procedure is triggered by another UE's explicit request, the fields in the request are interpreted as follows:\n-\tThe field 'Resource selection window location' is the concatenation of the starting time location and the ending time location of the resource selection window. The starting and ending time locations of the resource selection window are each encoded in the same way as the reference slot as described in clause 8.1.5A.\n-\tThe field 'Resource reservation period' is encoded in the same way as the field of the same name in SCI format 1-A.\nWhen determining a preferred resource set, the UE applies the procedure described in clause 8.1.4 with the above parameters and the following modifications:\n-\tStep 6a) The UE excludes candidate single-slot resource(s) belonging to slot(s) where the UE does not expect to perform SL reception of a TB due to half-duplex operation, if all the following conditions are met:\n-\tthe UE is a destination UE of the TB for whose transmission the preferred resource set is being determined;\n-\tthe higher layer parameter sl-Condition1-A-2 is not set to 'Disabled'.\nWhen determining a non-preferred resource set, the UE considers any resource(s) within the resource selection window, if indicated by a received explicit request, and satisfying at least one of the following conditions as non-preferred resource(s): \n-\tresource(s) indicated by a received SCI format 1-A, satisfying at least one of the following criteria:\n-\tthe RSRP measurement performed, according to clause 8.4.2.1, for the received SCI format 1-A, is higher than  where  is the value of the priority field in the received SCI format 1-A. The internal parameter  is set to the corresponding value of RSRP threshold indicated by the k-th field in sl-ThresholdRSRP-Condition1-B-1-Option1List, where .\n-\tthe UE is a destination UE of a TB associated with the received SCI format 1-A and the RSRP measurement performed, according to clause 8.4.2.1 for the received SCI format 1-A, is lower than  where  is the value of the priority field in the received SCI format 1-A. The internal parameter  is set to the corresponding value of RSRP threshold indicated by the k-th field in sl-ThresholdRSRP-Condition1-B-1-Option2List, where .\n-\tresources(s) in slot(s) in which the UE does not expect to perform SL reception due to half duplex operation, if the UE is a destination UE of a TB for whose transmission the non-preferred resource set is being determined.\n8.1.4B\tVoid \n8.1.4C\tUE procedure for using a received non-preferred resource set \nA UE configured with the higher layer parameter sl-InterUE-CoordinationScheme1 uses a received non-preferred resource set as follows when performing resource (re-)selection:\n-\tthe UE excludes in Step 6b) of clause 8.1.4 resource(s) overlapping with the non-preferred resource set.\nIf it is not possible to meet the requirement that the number of candidate single-slot resources remaining in the set  be at least  after excluding resource(s) overlapping with the received non-preferred resource set, it is up to UE implementation whether or not to take into account the received non-preferred resource set to meet such requirement.\nThe UE is not required to use any resource from the non-preferred resource set in its resource (re-)selection if that resource is earlier than (+ + ) after the resource of inter-UE coordination information transmission, where  is equal to (+ ) when only MAC CE is used for inter-UE coordination information transmission, or  is equal to  when MAC CE and SCI format 2-C are both used for inter-UE coordination information transmission. \nThe case when  is equal to  is assuming that SCI format 2-C is received.\n8.1.5\tUE procedure for determining slots and resource blocks for PSSCH transmission associated with an SCI format 1-A\nThe set of slots and resource blocks for PSSCH transmission is determined by the resource used for the PSCCH transmission containing the associated SCI format 1-A, and fields 'Frequency resource assignment', 'Time resource assignment' of the associated SCI format 1-A as described below.\n'Time resource assignment' carries logical slot offset indication of N = 1 or 2 actual resources when sl-MaxNumPerReserve is 2, and N = 1 or 2 or 3 actual resources when sl-MaxNumPerReserve is 3, in a form of time RIV (TRIV) field which is determined as follows:\nif \n \nelseif \n \nelse\nif \n \nelse\n \nend if\nend if\nwhere the first resource is in the slot where SCI format 1-A was received, and  denotes i-th resource time offset in logical slots of a resource pool with respect to the first resource where for N = 2, ; and for N = 3, , .\nThe starting sub-channel  of the first resource is determined according to clause 8.1.2.2. The number of contiguously allocated sub-channels for each of the N resources  and the starting sub-channel indexes of resources indicated by the received SCI format 1-A, except the resource in the slot where SCI format 1-A was received, are determined from \"Frequency resource assignment\" which is equal to a frequency RIV (FRIV) where.\nIf sl-MaxNumPerReserve is 2 then\n \nIf sl-MaxNumPerReserve is 3 then\n \nwhere\n-\t denotes the starting sub-channel index for the second resource\n-\t denotes the starting sub-channel index for the third resource\n-\t is the number of sub-channels in a resource pool, or if the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'interlaceRB', the number of sub-channels in each RB set,   provided according to the higher layer parameter sl-NumSubchannel\nIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'interlaceRB', the applied interlace index(s) in different RB sets are the same. \nIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'interlaceRB', the starting RB set  of the first resource is determined according to the clause 8.1.2.2. The number of contiguously allocated RB sets for each of the N resources LRBset\u22651 and the starting RB set indexes of resources indicated by the received SCI format 1-A, except the resource in the slot where SCI format 1-A was received, are determined from \"Frequency resource assignment\" which is equal to a frequency RIV (FRIV) where.\nIf sl-MaxNumPerReserve is 2 then\n\nIf sl-MaxNumPerReserve is 3 then\n\nwhere\n-\t denotes the starting RB set index for the second resource,\n-\t denotes the starting RB set index for the third resource,\n-\t is the number of RB sets in a resource pool,\n-\t is the number of RB sets for each of the indicated resources,\n-\tfor FRIV indication, within the resource pool, RB sets are numbered in increasing order from 0 to  from lowest frequency location to highest frequency location.\nIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'interlaceRB', the resource is determined by an intersection of the interlaces corresponding to the indicated sub-channel(s) and the union of the indicated set of RB sets and intra-cell guard bands between the indicated RB sets, if any.\nIf TRIV indicates N < sl-MaxNumPerReserve, \n-\tif the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to 'interlaceRB', the starting sub-channel indexes and the starting RB set indexes corresponding to sl-MaxNumPerReserve minus N last resources are not used.\n-\totherwise, the starting sub-channel indexes corresponding to sl-MaxNumPerReserve minus N last resources are not used.\nThe number of slots in one set of the time and frequency resources for transmission opportunities of PSSCH is given by  where = 10*SL_RESOURCE_RESELECTION_COUNTER [10, TS 38.321] if configured else  is set to 1.\nIf a set of sub-channels in slot  is determined as the time and frequency resource for PSSCH transmission corresponding to the selected sidelink grant (described in [10, TS 38.321]), the same set of sub-channels in slots  are also determined for PSSCH transmissions corresponding to the same sidelink grant where j=1, 2,\u2026, , , if provided, is converted from units of msec to units of logical slots, resulting in  according to clause 8.1.7, and  is determined by Clause 8. Here,  is the resource reservation interval indicated by higher layers.\n8.1.5A\tUE procedure for determining slots and resource blocks indicated by a preferred or non-preferred resource set\nThe set of slots and resource blocks indicated by a set of preferred or non-preferred resource(s) is determined as described below.\nIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is not provided, or it is set to \u2018contiguousRB', the set of preferred or non-preferred resources , is indicated by a reference slot  and  tuples ,  indicated by the 'resource combination' field, where for each tuple  is indicated by the 9 MSBs, followed by  and  (if present). \nIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to \u2018interlaceRB', the set of preferred or non-preferred resources , is indicated by a reference slot  and  tuples ,  indicated by the 'resource combination' field, where for each tuple  is indicated by the 9 MSBs, followed by  ,  and  (if present).\nThe reference slot  is indicated by the 'Reference slot location' field as a combination of DFN index and slot index [5, TS 38.212], with the 10 MSBs indicating the DFN index. ,  and  if any are interpreted according to clause 8.1.5, with the following modifications:\n-\tthe value of sl-MaxNumPerReserve is fixed to 3.\n-\t\"slot where SCI format 1-A was received\" is replaced by slot indicated as the first resource location of a .\n-\tthe first resource location of each  for  is indicated by a slot offset  in logical slots with respect to the reference slot ; the slot offset  is indicated by the 'first resource location' field; the first resource location of  is at slot offset 0 with respect to the reference slot.\n-\t\"the received SCI format 1-A, except the resource in the slot where SCI format 1-A was received\" is replaced by \"each tuple\".\n-\tthe starting sub-channel  of the first resource of each tuple is separately indicated.\n-\tif the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to \u2018interlaceRB', the starting RB set  of the first resource of each tuple is separately indicated.\nThe starting sub-channel  of the first resource of each tuple is indicated by the 'Lowest subChannel indices' field. The starting RB set  of the first resource of each tuple, if any, is indicated by the 'Lowest RB set indices' field. The resource reservation period   is encoded as in SCI format 1-A.\nIf the set is indicated by an SCI format 2-C, the number of tuples is .\nIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is not provided, or it is set to \u2018contiguousRB', a UE forms the union of the subsets indicated by each tuple  to obtain the set .\nIf the higher layer parameter transmissionStructureForPSCCHandPSSCH is set to \u2018interlaceRB', a UE forms the union of the subsets indicated by each tuple   to obtain the set .\n8.1.6\tSidelink congestion control in sidelink resource allocation mode 2\nIf a UE is configured with higher layer parameter sl-CR-Limit and transmits PSSCH in slot n, the UE shall ensure the following limits for any priority value k;\n\t\nwhere  is the CR evaluated in slot n-N for the PSSCH transmissions with 'Priority' field in the SCI set to i, and  corresponds to the high layer parameter sl-CR-Limit that is associated with the priority value k and the CBR range which includes the CBR measured in slot n-N, where N is the congestion control processing time.\nThe congestion control processing time N is based on \u00b5 of Table 8.1.6-1 and Table 8.1.6-2 for UE processing capability 1 and 2 respectively, where \u00b5 corresponds to the subcarrier spacing of the sidelink channel with which the PSSCH is to be transmitted. A UE shall only apply a single processing time capability in sidelink congestion control.\nTable 8.1.6-1: Congestion control processing time for processing timing capability 1\n\nTable 8.1.6-2: Congestion control processing time for processing timing capability 2\n\nIt is up to UE implementation how to meet the above limits, including dropping the transmissions in slot n. \n8.1.7\tUE procedure for determining the number of logical slots for a reservation period \nA given resource reservation period  in milliseconds is converted to a period  in logical slots as:\n\nwhere  is the number of slots that belong to a resource pool as defined in Clause 8.\n8.2\tUE procedure for transmitting sidelink reference signals\n8.2.1\tCSI-RS transmission procedure\nA UE transmits sidelink CSI-RS within a unicast PSSCH transmission if the following conditions hold:\n-\tCSI reporting is enabled by higher layer parameter sl-CSI-Acquisition; and\n-\tthe 'CSI request' field in the corresponding SCI format 2-A, 2-C or 2-D is set to 1.\nThe following parameters for CSI-RS transmission are configured for each CSI-RS configuration:\n-\tsl-CSI-RS-FirstSymbol indicates the first OFDM symbol in a PRB used for SL CSI-RS\n-\tsl-CSI-RS-FreqAllocation indicates the number of antenna ports and the frequency domain allocation for SL CSI-RS. \nWhen the UE is configured with Qp={1,2} CSI-RS port(s) in sidelink and the number of scheduled layers is ,\n-\tThe CSI-RS scaling factor  specified in clause 8.4.1.5.3 of [4, TS 38.211] is given by  where  is the scaling factor for the corresponding PSSCH specified in clause 8.3.1.5 of [4, TS 38.211].\n8.2.2\tPSSCH DM-RS transmission procedure\nThe UE selects the DM-RS time domain pattern out of the patterns configured using the higher layer parameter sl-PSSCH-DMRS-TimePatternList for the resource pool on which the PSSCH is to be transmitted. If more than one DM-RS time domain pattern is configured, the selected pattern is indicated by the 'DMRS pattern' field in the SCI format 1-A associated with the PSSCH transmission.\nIf PSSCH DM-RS and PSCCH are mapped to the same OFDM symbol, then this mapping within a single sub-channel is only supported if higher layer parameter sl-SubchannelSize >= 20, i.e. the sub-channel size is at least 20 PRBs. \nWhen a sub-channel size is less than 20 PRBs and the size of PSCCH is less than the sub-channel size, a UE is not expected to choose a PSSCH DM-RS pattern to be transmitted in the same OFDM symbol with PSCCH.\n8.2.3\tPT-RS transmission procedure\nTransmission of PT-RS is only supported in frequency range 2.\nThe UE PT-RS transmission procedure specified in clause 6.2.3.1 applies for derivation of the PT-RS parameters LPT-RS and, KPT-RS  and for determination of PT-RS presence, with the following changes:\n-\ttimeDensity and frequencyDensity in PTRS-UplinkConfig are replaced by sl-PTRS-TimeDensity and sl-PTRS-FreqDensity in SL-PTRS-Config respectively, and SL-PTRS-Config is (pre)configured per resource pool;\n-\tthe number of antenna ports is the same as the number of PSSCH DM-RS antenna ports and the association between a PT-RS antenna port and a PSSCH DM-RS antenna port is fixed.\n-\tIn a shared SL PRS resource pool, transmission of PT-RS is cancelled in OFDM symbols with SL PRS.\n8.2.4\tSL PRS transmission procedure\nThe following parameters for SL PRS transmission are associated with each SL PRS resource:\n-\tSL PRS resource ID provided by sl-PRS-ResourceID indicates an identity of a SL PRS resource. The SL PRS resource is identified by the SL PRS resource ID that is unique within a slot of a dedicated SL PRS resource pool. For a shared SL PRS resource pool, a SL PRS resource is uniquely identified by a combination of the SL PRS resource ID, SL PRS frequency domain allocation within a slot indicated by \u201cfrequency resource assignment\u201d field in the associated SCI format 1-A, and a starting symbol within the slot as determined by clause 8.2.4.1.1.\n-\tsl-CombSize and sl-PRS-comb-offset indicates a comb offset and a comb size of the SL PRS resource\n-\tsl-PRS-starting-symbol and sl-NumberOfSymbols indicates the starting symbol index and the number of symbols of the SL PRS resource within a slot in a dedicated SL PRS resource pool. sl-NumberOfSymbols indicates the number of symbols of the SL PRS resource within a slot in a shared SL PRS resource pool.\nFor a dedicated SL PRS resource pool, SL PRS resources for a same  combination of number of SL PRS symbols  and comb size can be mapped to a set of consecutive symbols in a slot. SL PRS resources for different  combinations shall be mapped to non-overlapping sets of consecutive symbols in a slot. Up to four non-overlapping sets of consecutive symbols within a slot can be used to map SL PRS resources for same or different  combinations, where the case of four non-overlapping sets of consecutive symbols only applies when  for all the  combinations.\nEach SL PRS transmission is associated with an PSCCH transmission in the same slot.\nIn the case of dedicated SL PRS resource pool, that PSCCH carries the SCI format 1-B associated with the SL PRS transmission.\nThe UE may report the association information between the already transmitted SL PRSs of SL PRS resources and UE Tx ARP ID. The association information includes ARP ID(s) indicated by sl-POS-ARP-ID-Tx, SL PRS transmission timestamp(s) indicated by sl-TimeStamp, and optional SL PRS resource ID(s) indicated by sl-PRS-ResourceID.\n8.2.4.1\tResource allocation\nIn sidelink resource allocation mode 1: \n-\tfor SL PRS transmission, dynamic grant, configured grant type 1, and configured grant type 2 are supported. \n-\tfor a dedicated SL PRS resource pool, the UE shall perform the procedure described in clause 8.6 (excluding the case of PSSCH for retransmission of a transport block), with the following modifications:\n-\t\"PSSCH for a transport block\" is replaced by \"SL PRS\"\n-\t\"PSSCH\" is replaced by \"SL PRS\".\nThe total number of SL configured grants including type 1 and type 2 across all resource pools is not greater than 8.\n8.2.4.1.1\tResource allocation in time domain\nThe UE shall transmit the SL PRS in the same slot as the associated PSCCH.\nFor a dedicated SL PRS resource pool, the minimum resource allocation unit in the time domain is a SL PRS resource in a slot.\nThe UE shall transmit the SL PRS in consecutive symbols within the slot.\nA UE does not transmit multiple SL PRS resources in the same slot.\nFor a shared SL PRS resource pool, the UE transmits the SL PRS in PSSCH symbols according to clause 8.1.2.1, with the following restrictions:\n-\tthe number of contiguous symbols for SL PRS transmission, , shall correspond to one of the SL PRS resources in parameter SL-PRS-ResourceSharedSL-PRS-RP.\n-\tthe UE shall not transmit SL PRS in symbols where associated PSCCH is transmitted.\n-\tthe UE shall not transmit SL PRS and PSSCH DMRS in the same symbol.\n-\tthe UE shall not transmit SL PRS and SL CSI-RS in the same symbol.\n-\tthe UE shall transmit SL PRS on contiguous symbols either in between or after symbols where PSSCH DMRS is transmitted.\n-\tthe UE shall transmit SL PRS only after the last symbol with second stage SCI. \n-\tFor a given value of , SL PRS resource is mapped to the last consecutive  SL symbols in the slot that meet all the other restrictions\nFor a dedicated SL PRS resource pool, the UE transmits SL PRS subject to the following restrictions:\n-\tthe UE shall not transmit SL PRS and associated PSCCH in the same symbol;\n-\tthe number of contiguous symbols and the starting symbol for SL PRS transmission shall correspond to one of the SL PRS resources in parameter SL-PRS-ResourceDedicatedSL-PRS-RP.\nIn sidelink resource allocation mode 1 for a shared SL PRS resource pool, the time domain behaviour for sidelink dynamic grants and sidelink configured grants for SL PRS follows the behaviour in clause 8.1.2.1.\nIn sidelink resource allocation mode 1 for a dedicated SL PRS resource pool, the time domain behaviour for sidelink dynamic grants and sidelink configured grants for SL PRS follows the behaviour in clause 8.1.2.1, with the following modifications:\n-\t\"DCI format 3_0\" is replaced by \"DCI format 3_2\".\n-\t\"PSSCH\" is replaced by \"SL PRS\".\n8.2.4.1.2\tResource allocation in frequency domain\nFor a shared SL PRS resource pool, the frequency domain resource assignment of a SL PRS resource is the same as PSSCH in the same slot.\nFor a dedicated SL PRS resource pool, the frequency domain resource assignment of a SL PRS resource is same as frequency resources of the resource pool provided by the higher layer parameter sl-RB-Number.\n8.2.4.2\tUE procedure for determining the subset of resources to be reported to higher layers in SL PRS resource selection in a dedicated SL PRS resource pool in sidelink resource allocation mode 2\nIn resource allocation mode 2 in a dedicated SL PRS resource pool, the higher layer can request the UE to determine a subset of resources from which the higher layer will select resources for SL PRS/PSCCH transmission. To trigger this procedure, in slot n, the higher layer provides the following parameters for this SL PRS/PSCCH transmission:\n-\tthe resource pool from which the resources are to be reported;\n-\tL1 priority, ;\n-\tthe remaining SL PRS delay budget;\n-\tSet of SL-PRS resource ID(s);\n-\toptionally, the resource reservation interval, , in units of msec. \n-\tif the higher layer requests the UE to determine a subset of resources from which the higher layer will select resources for SL PRS/PSCCH transmission as part of re-evaluation or pre-emption procedure, the higher layer provides a set of resources which may be subject to re-evaluation and a set of resources which may be subject to pre-emption.\n-\tit is up to UE implementation to determine the subset of resources as requested by higher layers before or after the slot  - , where  is the slot with the smallest slot index among and , and  is equal to , where \u00a0is defined in slots in Table 8.1.4-2 where  is the SCS configuration of the SL BWP.\nThe following higher layer parameters affect this procedure:\n-\t[sl-SelectionWindowList: internal parameter  is set to the corresponding value from higher layer parameter sl-SelectionWindowList for the given value of .]\n-\t[sl-Thres-RSRP-List]: this higher layer parameter provides an RSRP threshold for each combination , where  is the value of the priority field in a received SCI format 1-B and  is the priority of the transmission of the UE selecting resources; for a given invocation of this procedure, .\n-\tsl-PRS-ResourceReservePeriodList: the resource reservation interval, , is set to the corresponding value from higher layer parameter in units of mse\n-\tsl-SensingWindowDedicatedSL-PRS-RP: internal parameter  is defined as the number of slots corresponding to sl-SensingWindowDedicatedSL-PRS-RP msec\n-\tsl-TxPercentageDedicatedSL-PRS-RP-List: internal parameter  for a given  is defined as sl-TxPercentageDedicatedSL-PRS-RP-List () converted from percentage to ratio\n-\t[sl-PreemptionEnable]: if sl-PreemptionEnable is provided, and if it is not equal to 'enabled', internal parameter  is set to the higher layer provided parameter sl-PreemptionEnable.\nThe UE shall perform this procedure according to clause 8.1.4, with the following modifications:\n-\t\"packet delay budget\" is replaced by \"SL PRS delay budget\",\n-\tpartial sensing is not applicable in a dedicated SL PRS resource pool,\n-\t\"candidate single-slot resource\" is replaced by \"candidate SL PRS resource\",\n-\ta candidate single-slot resource for transmission  is defined as the SL PRS resource with index  within the Set of SL-PRS resource ID(s) provided by the higher layer and in slot ,\n-\t\"SCI format 1-A\" is replaced by \"SCI format 1-B\",\n-\tin step 5, the second condition is modified as follows: for any periodicity value allowed by the higher layer parameter sl-PRS-ResourceReservePeriodList and any SL PRS resource ID in the set of SL PRS resource ID(s) provided by the higher layer, and a hypothetical SCI format 1-B received in slot  with 'Resource reservation period' field set to that periodicity value and indicating that SL-PRS resource ID, condition c in step 6 would be met,\n-\tIn condition b of step 6, the RSRP measurement is the PSCCH-RSRP over the DM-RS resource elements of the PSCCH;\n-\tIn condition c of step 6 \"determines according to clause 8.1.5 the set of resource blocks and slots\" is replaced by \"determines according to clause 8.2.4.2A the set of SL PRS resources and slots \".\n8.2.4.2A\tUE procedure for determining slots and SL PRS resource(s) associated with an SCI format 1-B in a dedicated SL PRS resource pool\nThe set of slots and SL PRS resources for SL PRS transmission is determined by the PSCCH containing the associated SCI format 1-B, and fields 'SL-PRS resource ID (s)', 'Time resource assignment' of the associated SCI format 1-B as described below.\nThe set of slots is determined as in clause 8.1.5, with the following modifications:\n-\t\"SCI format 1-A\" is replaced by \"SCI format 1-B\",\n-\t[potential parameter name changes].\nThe first SL PRS resource is determined according to the sub-channel used for the PSCCH transmission containing the associated SCI format 1-B, where the index of the sub-channel in the resource pool is identical to the index of the SL PRS resource provided by sl-PRS-ResourceID.\nThe second SL-PRS and third SL PRS resource, if reserved by SCI format 1-B, are determined from \" Resource ID indication\" which is equal to a PRS Resource ID value (PRIV) where,\nIf sl-MaxNumPerReserveDedicatedSL-PRS-RP is 2 then\n \nIf sl-MaxNumPerReserveDedicatedSL-PRS-RP is 3 then\n \nWhere\n-\t  denotes the SL PRS resource ID for the second resource\n-\t  denotes the SL PRS resource ID for the third resource\n-\t  is the number of SL-PRS resources (pre-)configured in a slot of a resource pool.\nIf TRIV determined according to clause 8.1.5 indicates N < sl-MaxNumPerReserveDedicatedSL-PRS-RP, the SL PRS resource indices corresponding to sl-MaxNumPerReserveDedicatedSL-PRS-RP minus N last resources are not used.\nThe number of slots in one set of the time and frequency resources for transmission opportunities of SL PRS is given by  where = 10*SL_RESOURCE_RESELECTION_COUNTER [10, TS 38.321] if configured else  is set to 1.\nIf a SL PRS resource in slot  is determined as the time and frequency resource for SL PRS transmission corresponding to the selected sidelink grant (described in [10, TS 38.321]), the same SL PRS resource in slots  is also determined for SL PRS transmissions corresponding to the same sidelink grant where j=1, 2,\u2026, , , if provided, is converted from units of msec to units of logical slots, resulting in  according to clause 8.1.7, and  is determined by Clause 8. Here,  is the resource reservation interval indicated by higher layers.\n8.2.4.3\tSidelink congestion control in a dedicated SL PRS resource pool in sidelink resource allocation mode 2\nWhen transmitting SL-PRS in a dedicated SL PRS resource pool the UE shall perform sidelink congestion control as specified in clause 8.1.6, with the following modification(s):\n-\t\"PSSCH\" is replaced by \"SL PRS\"\n-\t[potential parameter name changes]\n-\t[potential changes to processing times]\n8.3\tUE procedure for receiving the physical sidelink shared channel\nFor sidelink resource allocation mode 1, a UE upon detection of SCI format 1-A on PSCCH can decode PSSCH according to the detected SCI formats 2-A, 2-B, 2-C and 2-D, and associated PSSCH resource configuration configured by higher layers. The UE is not required to decode more than one PSCCH at each PSCCH resource candidate.\nFor sidelink resource allocation mode 2, a UE upon detection of SCI format 1-A on PSCCH can decode PSSCH according to the detected SCI formats 2-A, 2-B, 2-C and 2-D, and associated PSSCH resource configuration configured by higher layers. The UE is not required to decode more than one PSCCH at each PSCCH resource candidate.\nA UE is required to decode neither the corresponding SCI formats 2-A, 2-B, 2-C nor the PSSCH associated with an SCI format 1-A if the SCI format 1-A indicates an MCS table that the UE does not support.\nIn any slot without PSFCH symbols, the UE attempts, subject to UE capability, to decode PSSCH transmission starting from the second candidate starting symbol provided by sl-startingSymbolSecond, if sl-startingSymbolFirst and sl-startingSymbolSecond are provided.\n8.4\tUE procedure for receiving reference signals\n8.4.1\tCSI-RS reception procedure\nThe CSI-RS defined in Clause 8.4.1.5 of [4, TS 38.211] may be used for CSI computation. \n8.4.2\tDM-RS reception procedure for RSRP computation\n8.4.2.1\tRSRP for resource selection in sidelink resource allocation mode 2\nIn sidelink resource allocation mode 2, the UE measures RSRP for resource selection as follows: \n-\tPSSCH-RSRP over the DM-RS resource elements for the PSSCH according to the received SCI format 1-A if higher layer parameter sl-RS-ForSensing is set to 'pssch', and \n-\tPSCCH-RSRP over the DM-RS resource elements for the PSCCH carrying the received SCI format 1-A if higher layer parameter sl-RS-ForSensing is set to 'pscch'.\n8.4.3\tPT-RS reception procedure\nReception of PT-RS is only supported in frequency range 2.\nThe UE PT-RS reception procedure specified in clause 5.1.6.3 applies for derivation of the PT-RS parameters LPT-RS and KPT-RS and for determination of PT-RS presence, with the following changes:\n-\ttimeDensity and frequencyDensity in PTRS-DownlinkConfig are replaced by sl-PTRS-TimeDensity and sl-PTRS-FreqDensity in SL-PTRS-Config respectively, and SL-PTRS-Config is (pre)configured per resource pool;\n-\tthe number of antenna ports is the same as the number of PSSCH DM-RS antenna ports and the association between a PT-RS antenna port and a PSSCH DM-RS antenna port is fixed.\n8.4.4\tSL PRS reception procedure\nThe UE may be configured to measure and report one or more of the SL RSTD, SL Rx-Tx time difference, SL RTOA, SL PRS-RSRPP, for the first detected path and up to 8 additional detected paths, and SL PRS-RSRP measurements. The UE may be configured to measure and report one or more of the SL AoA, SL PRS-RSRPP for the first path and up to 2 additional detected paths, and SL PRS-RSRP measurement.\nThe UE may report an ARP ID associated with the reported measurements. The UE may provide the ARP location information via sl-ARP-LocationInfoPerTxUE.\nThe UE uses the same ARP for both the transmission and reception of sidelink positioning reference signals while performing an SL Rx-Tx time difference measurement.\nThe UE may include SL PRS resource ID(s) when it reports one or more of the SL RSTD, SL Rx-Tx time difference, SL RTOA, SL AoA, SL PRS-RSRP, and SL PRS-RSRPP measurements.\nFor the SL RSTD, SL Rx-Tx time difference, SL RTOA, SL AoA, SL PRS-RSRP, and SL PRS-RSRPP measurements, the UE reports an associated SL PRS reception timestamp via higher layer parameter Timestamps. For SL Rx-Tx time difference, the UE may report an associated SL PRS transmission timestamp via higher layer parameter tx-TimeInfo and the UE may be configured to report a SL PRS transmission timestamp via associatedSL-PRS-TxTimeStampRequest. The timestamp includes the SFN, slot number, and optionally nr-PhysCellID, nr-ARFCN, nr-CellGlobalID, or the timestamp includes DFN and slot number. The timestamp of DFN and slot number may include synchronization source indication of DFN.\nThe UE may be configured to report up to N Rx-Tx time difference measurements for the same SL PRS transmission associated with N different SL PRS receptions for the same pair of UE(s). The UE may be configured to report up to N Rx-Tx time difference measurements for the same SL PRS reception associated with N different SL PRS transmissions for the same pair of UE(s).\nThe UE may report, LoS/NLoS indicator(s) via los-NLOS-Indicator associated with each SL RSTD, SL Rx-Tx time difference, SL RTOA, SL AoA, SL PRS-RSRP, and SL PRS-RSRPP measurements.\nThe UE may report synchronization source type via syncSourceType and/or relative time difference with the associated quality metric, via sl-RTD-Info. If reported syncSourceType is gNB-eNB, the UE may report cell identity information. For UE-based positioning, the UE may be provided with synchronization source type of a UE and/or the relative time difference with the associated quality metric, via syncSourceType and sl-RTD-Info, respectively. For the SL RSTD measurement, the UE may report a reference UE information.\nFor SL RTOA measurement, SFN or DFN initialization time may be provided to the UE by a UE or the network.\nThe UE may be provided with the location information of other UEs via anchorUE-LocationInformation. The UE may report the location information of the UE to the network.\nThe UE may be provided with expected SL AoA and uncertainty range of the expected SL AoA via expectedSL-AzimuthAoA-AndUncertainty and expectedSL-ZenithAoA-AndUncertainty.\nThe UE may report quality metric sl-TimingQuality corresponding to the SL RSTD, SL RTOA or SL Rx-Tx time difference measurements. The UE may report quality metric sl-AngleQuality corresponding to the SL AoA measurement.\nIf the 'SL PRS request' field in the SCI associated with the received SL PRS is set to 1 then this request for SL PRS transmission is reported to higher layers.\n8.5\tUE procedure for reporting channel state information (CSI)\n8.5.1\tChannel state information framework\nCSI consists of Channel Quality Indicator (CQI) and Rank Indicator (RI). The CQI and RI are always reported together.\n8.5.1.1\tReporting configurations\nThe UE shall calculate CSI parameters (if reported) assuming the following dependencies between CSI parameters (if reported)\n-\tCQI shall be calculated conditioned on the reported RI\nThe CSI reporting can be aperiodic (using [10, TS 38.321]). Table 8.5.1.1-1 shows the supported combinations of CSI reporting configurations and CSI-RS configurations and how the CSI reporting is triggered for CSI-RS configuration. Aperiodic CSI-RS is configured and triggered/activated as described in Clause 8.5.1.2.\nTable 8.5.1.1-1 Triggering/Activation of CSI reporting for the possible CSI-RS Configurations.\n\nFor CSI reporting, wideband CQI reporting is supported. A wideband CQI is reported for a single codeword for the entire CSI reporting band.\n8.5.1.2\tTriggering of sidelink CSI reports\nThe CSI-triggering UE is not allowed to trigger another aperiodic CSI report for the same UE before the last slot of the expected reception or completion of the ongoing aperiodic CSI report associated with the SCI format 2-A, 2-C or 2-D with the 'CSI request' field set to 1, where the last slot of the expected reception of the ongoing aperiodic CSI report is given by [10, TS38.321].\nAn aperiodic CSI report is triggered by an SCI format 2-A, 2-C or 2-D with the 'CSI request' field set to 1. \nA UE is not expected to transmit a sidelink CSI-RS and a sidelink PT-RS which overlap.\n8.5.2\tChannel state information\n8.5.2.1\tCSI reporting quantities\n8.5.2.1.1\tChannel quality indicator (CQI)\nThe UE shall derive CQI as specified in clause 5.2.2.1, with the following changes\n-\tPDSCH replaced by PSSCH\n-\tuplink slot replaced by sidelink slot\n-\tdownlink physical resource blocks replaced by sidelink physical resource blocks\n-\tTransport Block Size determination according to Clause 8.1.3.2\n-\tCSI reference resource according to the Clause 8.5.2.3\n-\tinterference measurements are not supported\n-\tsub-band CQI is not supported\n-\tcqi-Table is determined as follows\n-\tcqi-Table = 'table1' if Table 5.1.3.1-1 is determined as the MCS table according to Clause 8.1.3.1 of [6, 38.214],\n-\tcqi-Table = 'table2' if Table 5.1.3.1-2 is determined as the MCS table according to Clause 8.1.3.1 of [6, 38.214],\n-\tcqi-Table = 'table3' if Table 5.1.3.1-3 is determined as the MCS table according to Clause 8.1.3.1 of [6, 38.214]\n8.5.2.2\tReference signal (CSI-RS)\nThe UE can be configured with one CSI-RS pattern as indicated by the higher layer parameters sl-CSI-RS-FreqAllocation, sl-CSI-RS-FirstSymbol in SL-CSI-RS-Config.\nParameters for which the UE shall assume non-zero transmission power for CSI-RS are configured according to clause 8.2.1. \nA UE is not expected to be configured such that a CSI-RS and the corresponding PSCCH can be mapped to the same resource element. A UE is not expected to receive sidelink CSI-RS and PSSCH DM-RS, nor CSI-RS and 2nd-stage SCI, on the same symbol.\nSidelink CSI-RS shall be transmitted according to [4, TS 38.211] in the resource blocks used for the PSSCH associated with the SCI format 2-A, 2-C or 2-D triggering a report.\n8.5.2.3\tCSI reference resource definition\nThe CSI reference resource in sidelink is defined as follows:\n-\tIn the frequency domain, the CSI reference resource is defined by the group of sidelink physical resource blocks containing the sidelink CSI-RS to which the derived CSI relates.\n-\tIn the time domain, the CSI reference resource for a CSI reporting in sidelink slot n is defined by a single sidelink slot nCSI_ref where nCSI_ref is the same sidelink slot as the corresponding CSI request.\nIf configured to report CQI index and RI index, in the CSI reference resource, the UE shall assume the following for the purpose of deriving the CQI index and RI index:\n-\tThe reference resource uses the CP length and subcarrier spacing configured for the SL BWP.\n-\tRedundancy Version 0.\n-\tPSCCH occupies 2 OFDM symbols.\n-\tThe number of PSSCH and DM-RS symbols is equal to sl-LengthSymbols\u20122.\n-\tAssume no REs allocated for sidelink CSI-RS.\n-\tAssume no REs allocated for SCI format 2-A, SCI format 2-B, SCI format 2-C or SCI format 2-D.\n-\tAssume the same number of DM-RS symbols as the smallest one configured by the higher layer parameter sl-PSSCH-DMRS-TimePatternList. \n-\tAssume no REs allocated for sidelink PT-RS.\n-\tAssume sidelink CSI-RS RE power is the same as PSSCH RE power. \n-\tThe PSSCH transmission scheme where the UE may assume that PSSCH transmission would be performed with up to 2 transmission layers as defined in Clause 8.3.1.4 of [4, TS 38.211]. For CQI calculation, the UE should assume that PSSCH signals on antenna ports in the set [1000,\u2026, 1000+\u03bd-1] for \u03bd layers would result in signals equivalent to corresponding symbols transmitted on antenna ports [3000,\u2026, 3000+P-1], as given by\n\t\nwhere  is a vector of PSSCH symbols from the layer mapping defined in Clause 8.3.1.4 of [4, TS 38.211],  is the number of CSI-RS ports. If only one CSI-RS port is configured, W(i) is 1. Otherwise, W(i) is the identity matrix.\n8.5.3\tCSI reporting\nThe UE can be configured with one CSI reporting latency bound as indicated by the higher layer parameter sl-LatencyBoundCSI-Report. CSI reporting is aperiodic and is described in [10, TS 38.321].\n8.6\tUE PSSCH preparation procedure time\nFor sidelink dynamic grant and for SL configured grant type 2 activation, if the first sidelink symbol in the sidelink allocation for a PSSCH for a transport block and the associated PSCCH, including the DM-RS and the duplicated symbol, as defined by the slot offset  of the scheduling DCI for dynamic grant or the activating DCI for SL configured grant type 2, is no earlier than at symbol L, where L is defined as the next sidelink symbol with its CP starting  after the end of the reception of the last symbol of the PDCCH carrying the DCI scheduling the sidelink transmissions for dynamic grant or activating the SL configured grant type 2, then the UE shall transmit the PSSCH and the associated PSCCH.\n-\tN2 is based on \u00b5 of Table 8.6-1, where \u00b5 corresponds to the one of (\u00b5DL, \u00b5SL) resulting with the largest Tproc, where the \u00b5DL corresponds to the subcarrier spacing of the downlink with which the PDCCH carrying the DCI scheduling the PSSCH for dynamic grant or activating the SL configured grant type 2 was transmitted and \u00b5SL corresponds to the subcarrier spacing of the sidelink channel with which the PSSCH and the associated PSCCH are to be transmitted, and \u03ba is defined in Clause 4.1 of [4, TS 38.211].\n-\tFor operation with shared spectrum channel access in FR1, Text is calculated according to [4, TS 38.211] with the index i for Ci and \u0394i set to\u20181\u2019 for \u00b5SL = 0, to \u20183\u2019 for \u00b5SL = 1, and to \u20182\u2019 for \u00b5SL = 2. Otherwise, Text = 0.\n-\td2,1 = 1. \nOtherwise the UE may ignore the scheduling DCI for dynamic grant or the activating DCI for SL configured grant type 2. \nThe value of  is used both in the case of normal and extended cyclic prefix.\nTable 8.6-1: PSSCH preparation time\n\nFor sidelink resource allocation mode 1, the UE does not expect that the first sidelink symbol in the sidelink allocation for a PSSCH for retransmission of a transport block and the associated PSCCH, including the DM-RS and the duplicated symbol as defined by the \"Time resource assignment\" field of the corresponding DCI for dynamic grant or for SL configured grant type 2, or by sl-TimeResourceCG-Type1 for configured grant type 1 starts earlier than at symbol  where  is defined as the next sidelink symbol with its CP starting  after the end of the last symbol of the PSFCH occasion corresponding to the most recent transmission of PSSCH for the same transport block, where  is defined in Clause 16.5 of [6, TS 38.213] and . Otherwise the UE may skip the retransmission of the PSSCH and the transmission of the corresponding PSCCH. \n9\tUE procedures for transmitting and receiving for RTT-based propagation delay compensation\nFor operation with RTT-based propagation delay compensation, the UE may be configured with either:\n-\tone CSI-RS for tracking with higher layer parameter pdc-Info for Rx \u2013 Tx time difference estimation at UE side and one SRS resource set with usage-PDC, or\n-\tone PRS configuration of higher layer parameter nr-DL-PRS-PDC-ResourceSet [12, TS 38.331] for Rx \u2013 Tx time difference estimation at UE side and one SRS resource set with usage-PDC.\nThe related UE procedures for transmitting uplink reference signals and receiving downlink reference signals for RTT-based propagation delay compensation are defined as follows:\n-\tfor reception of CSI-RS for tracking with higher layer parameter pdc-Info, the UE follows the procedures for reception of CSI-RS for tracking defined in Clause 5.1.6.1.1.  \n-\tfor reception of the one PRS configuration provided by RRC [12, TS 38.331] for RTT-based propagation delay compensation, the UE follows the procedure for PRS reception for RTT-based propagation delay compensation defined in Clause 9.1.\n-\tfor transmission of an SRS resource set configured with usage-PDC, the UE follows the procedures for SRS transmission defined in Clause 6.2.1.\n9.1\tPRS reception procedure for RTT-based propagation delay compensation\nThe DL PRS resource set for RTT-based propagation delay compensation consists of K\u22651 DL PRS resource(s) where each has an associated spatial transmission filter. Each DL PRS resource is configured via higher layer parameters NR-DL-PRS-Resource and is uniquely defined by nr-DL-PRS-ResourceID. The subcarrier spacing and the cyclic prefix of the DL PRS resources are defined by the subcarrier spacing and the cyclic prefix of the DL active bandwidth part of the serving cell. \nThe DL PRS resource set for RTT-based propagation delay compensation is configured by nr-DL-PRS-PDC-ResourceSet, consists of one or more DL PRS resource(s) and it is defined by:\n-\tperiodicityAndOffset defines the DL PRS resource periodicity and takes values slots, where for 15, 30, 60 and 120 kHz subcarrier spacing respectively and the slot offset for DL PRS resource set with respect to SFN0 slot 0. All the DL PRS resources are configured with the same DL PRS resource periodicity. \n-\trepetitionFactor defines how many times each DL-PRS resource is repeated for a single instance of the DL-PRS resource set and takes values . All the DL PRS resources within the resource set have the same resource repetition factor.\n-\ttimeGap defines the offset in number of slots between two repeated instances of a DL PRS resource with the same nr-DL-PRS-ResourceID within a single instance of the DL PRS resource set. The UE only expects to be configured with timeGap if repetitionFactor is configured with value greater than 1. The time duration spanned by one instance of a nr-DL-PRS-ResourceSet is not expected to exceed the configured value of DL PRS periodicity. All the DL PRS resources within the resource set have the same value of timeGap.\n-\tresourceList determines the DL PRS resources that are contained within the DL PRS resource set. \n-\tdl-PRS-ResourceBandwidth defines the number of resource blocks configured for DL PRS transmission. The parameter has a granularity of 4 PRBs with a minimum of 24 PRBs and a maximum of 272 PRBs. All the DL PRS resources within the resource set have the same value of dl-PRS-ResourceBandwidth.\n-\tdl-PRS-StartPRB defines the starting PRB index of the DL PRS resource with respect to subcarrier 0 in common resource block 0. The starting PRB index has a granularity of one PRB with a minimum value of 0 and a maximum value of 2176 PRBs. All the DL PRS resources within the resource set have the same value of dl-PRS-StartPRB.\n-\tnumSymbols defines the number of symbols of the DL PRS resource within a slot where the allowable values are given in Clause 7.4.1.7.3 of [4, TS38.211]. All the DL PRS resources within the resource set have the same value of numSymbols.\nA DL PRS resource is defined by:\n-\tnr-DL-PRS-ResourceID determines the DL PRS resource configuration identity. All DL PRS resource IDs are locally defined within the DL PRS resource set.\n-\tdl-PRS-SequenceID is used to initialize cinit value used in pseudo random generator as described in Clause 7.4.1.7.2 of [4, TS 38.211] for generation of DL PRS sequence for a given DL PRS resource.\n-\tdl-PRS-CombSizeN-AndReOffset defines the comb size of a DL PRS resource, where the allowable values are given in Clause 7.4.1.7.3 of [TS38.211], and the starting RE offset of the first symbol within a DL PRS resource in frequency. The UE may expect the same comb size to be configured for all DL PRS resources of the PRS resource set. The relative RE offsets of the remaining symbols within a DL PRS resource are defined based on the initial offset and the rule described in Clause 7.4.1.7.3 of [4, TS 38.211]. \n-\tdl-PRS-ResourceSlotOffset determines the starting slot of the DL PRS resource with respect to corresponding DL PRS resource set slot offset.\n-\tdl-PRS-ResourceSymbolOffset determines the starting symbol of a slot configured with the DL PRS resource. \n-\tdl-PRS-QCL-Info defines any quasi co-location information of the DL PRS resource with other reference signals. The DL PRS may be configured with QCL 'typeD' with a DL PRS in the same PRS resource set, or with rs-Type set to 'typeC', 'typeD', or 'typeC-plus-typeD' with a SS/PBCH Block from the serving cell.\nThe UE assumes constant EPRE is used for all REs of a given DL PRS resource.\nThe UE assumes that the DL PRS from the serving cell is not mapped to any symbol that contains SS/PBCH block from the serving cell. \nThe UE does not expect to be scheduled or configured for reception of any downlink channel or any other downlink signal(s) in the OFDM symbol(s) and PRBs of the DL PRS resource for RTT-based propagation delay compensation to be received.\nThe UE is expected to receive the DL PRS for RTT-based propagation delay compensation only in RRC_CONNECTED state and within the DL active bandwidth part of the serving cell.\n\nAnnex <A> (informative):\nChange history\n\n",
    "metadata": {
        "title0": "3GPP TS 38.214",
        "title1": "Technical Specification Group Radio Access Network",
        "title2": "NR",
        "title3": "Physical layer procedures for data",
        "Release": 18,
        "Version": "V18.2.0",
        "Publish_time": "2024-03"
    }
}