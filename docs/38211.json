{
    "page_content": "3GPP TS 38.211 V18.2.0 (2024-03)\nTechnical Specification\n3rd Generation Partnership Project;\nTechnical Specification Group Radio Access Network;\nNR;\nPhysical channels and modulation\n(Release 18)\n\t\n\t\n\nThe present document has been developed within the 3rd Generation Partnership Project (3GPP TM) and may be further elaborated for the purposes of 3GPP..\nThe present document has not been subject to any approval process by the 3GPP Organizational Partners and shall not be implemented.\nThis Specification is provided for future development work within 3GPP only. The Organizational Partners accept no liability for any use of this Specification.\nSpecifications and Reports for implementation of the 3GPP TM system should be obtained via the 3GPP Organizational Partners' Publications Offices.\n\n\n\n\nKeywords\nNew Radio, Layer 1\n\n3GPP\nPostal address\n\n3GPP support office address\n650 Route des Lucioles - Sophia Antipolis\nValbonne - FRANCE\nTel.: +33 4 92 94 42 00 Fax: +33 4 93 65 47 16\nInternet\nhttp://www.3gpp.org\n\nCopyright Notification\nNo part may be reproduced except as authorized by written permission.\nThe copyright and the foregoing restriction extend to reproduction in all media.\n\n\u00a9 2024, 3GPP Organizational Partners (ARIB, ATIS, CCSA, ETSI, TSDSI, TTA, TTC).\nAll rights reserved.\n\nUMTS\u2122 is a Trade Mark of ETSI registered for the benefit of its members\n3GPP\u2122 is a Trade Mark of ETSI registered for the benefit of its Members and of the 3GPP Organizational Partners\nLTE\u2122 is a Trade Mark of ETSI registered for the benefit of its Members and of the 3GPP Organizational Partners\nGSM\u00ae and the GSM logo are registered and owned by the GSM Association\nContents\nForeword\t8\n1\tScope\t9\n2\tReferences\t9\n3\tDefinitions of terms, symbols and abbreviations\t9\n3.1\tTerms\t9\n3.2\tSymbols\t9\n3.3\tAbbreviations\t11\n4\tFrame structure and physical resources\t11\n4.1\tGeneral\t11\n4.2\tNumerologies\t11\n4.3\tFrame structure\t12\n4.3.1\tFrames and subframes\t12\n4.3.2\tSlots\t12\n4.4\tPhysical resources\t13\n4.4.1\tAntenna ports\t13\n4.4.2\tResource grid\t14\n4.4.3\tResource elements\t14\n4.4.4\tResource blocks\t14\n4.4.4.1\tGeneral\t14\n4.4.4.2\tPoint A\t14\n4.4.4.3\tCommon resource blocks\t15\n4.4.4.4\tPhysical resource blocks\t15\n4.4.4.5\tVirtual resource blocks\t15\n4.4.4.6\tInterlaced resource blocks\t15\n4.4.5\tBandwidth part\t15\n4.4.6\tCommon MBS frequency resource\t16\n4.5\tCarrier aggregation\t16\n5\tGeneric functions\t16\n5.1\tModulation mapper\t16\n5.1.1\t\u03c0/2-BPSK\t17\n5.1.2\tBPSK\t17\n5.1.3\tQPSK\t17\n5.1.4\t16QAM\t17\n5.1.5\t64QAM\t17\n5.1.6\t256QAM\t17\n5.1.7\t1024QAM\t17\n5.2\tSequence generation\t18\n5.2.1\tPseudo-random sequence generation\t18\n5.2.2\tLow-PAPR sequence generation type 1\t18\n5.2.2.1\tBase sequences of length 36 or larger\t18\n5.2.2.2\tBase sequences of length less than 36\t18\n5.2.3\tLow-PAPR sequence generation type 2\t22\n5.2.3.1\tSequences of length 30 or larger\t22\n5.2.3.2\tSequences of length less than 30\t22\n5.3\tOFDM baseband signal generation\t26\n5.3.1\tOFDM baseband signal generation for all channels except PRACH and RIM-RS\t26\n5.3.2\tOFDM baseband signal generation for PRACH\t28\n5.3.3\tOFDM baseband signal generation for RIM-RS\t30\n5.4\tModulation and upconversion\t30\n6\tUplink\t31\n6.1\tOverview\t31\n6.1.1\tOverview of physical channels\t31\n6.1.2\tOverview of physical signals\t31\n6.2\tPhysical resources\t31\n6.3\tPhysical channels\t32\n6.3.1\tPhysical uplink shared channel\t32\n6.3.1.1\tScrambling\t32\n6.3.1.2\tModulation\t33\n6.3.1.3\tLayer mapping\t33\n6.3.1.4\tTransform precoding\t33\n6.3.1.5\tPrecoding\t34\n6.3.1.6\tMapping to virtual resource blocks\t59\n6.3.1.7\tMapping from virtual to physical resource blocks\t60\n6.3.2\tPhysical uplink control channel\t60\n6.3.2.1\tGeneral\t60\n6.3.2.2\tSequence and cyclic shift hopping\t60\n6.3.2.2.1\tGroup and sequence hopping\t60\n6.3.2.2.2\tCyclic shift hopping\t61\n6.3.2.3\tPUCCH format 0\t62\n6.3.2.3.1\tSequence generation\t62\n6.3.2.3.2\tMapping to physical resources\t62\n6.3.2.4\tPUCCH format 1\t62\n6.3.2.4.1\tSequence modulation\t62\n6.3.2.4.2\tMapping to physical resources\t63\n6.3.2.5\tPUCCH format 2\t64\n6.3.2.5.1\tScrambling\t64\n6.3.2.5.2\tModulation\t64\n6.3.2.5.2A\tSpreading\t64\n6.3.2.5.3\tMapping to physical resources\t65\n6.3.2.6\tPUCCH formats 3 and 4\t65\n6.3.2.6.1\tScrambling\t65\n6.3.2.6.2\tModulation\t66\n6.3.2.6.3\tBlock-wise spreading\t66\n6.3.2.6.4\tTransform precoding\t67\n6.3.2.6.5\tMapping to physical resources\t67\n6.3.3\tPhysical random-access channel\t67\n6.3.3.1\tSequence generation\t67\n6.3.3.2\tMapping to physical resources\t74\n6.4\tPhysical signals\t91\n6.4.1\tReference signals\t91\n6.4.1.1\tDemodulation reference signal for PUSCH\t91\n6.4.1.1.1\tSequence generation\t91\n6.4.1.1.2\t(void)\t93\n6.4.1.1.3\tPrecoding and mapping to physical resources\t93\n6.4.1.2\tPhase-tracking reference signals for PUSCH\t98\n6.4.1.2.1\tSequence generation\t98\n6.4.1.2.1.1\tSequence generation if transform precoding is not enabled\t98\n6.4.1.2.1.2\tSequence generation if transform precoding is enabled\t98\n6.4.1.2.2\tMapping to physical resources\t99\n6.4.1.2.2.1\tPrecoding and mapping to physical resources if transform precoding is not enabled\t99\n6.4.1.2.2.2\tMapping to physical resources if transform precoding is enabled\t101\n6.4.1.3\tDemodulation reference signal for PUCCH\t102\n6.4.1.3.1\tDemodulation reference signal for PUCCH format 1\t102\n6.4.1.3.1.1\tSequence generation\t102\n6.4.1.3.1.2\tMapping to physical resources\t103\n6.4.1.3.2\tDemodulation reference signal for PUCCH format 2\t103\n6.4.1.3.2.1\tSequence generation\t103\n6.4.1.3.2.2\tMapping to physical resources\t104\n6.4.1.3.3\tDemodulation reference signal for PUCCH formats 3 and 4\t104\n6.4.1.3.3.1\tSequence generation\t104\n6.4.1.3.3.2\tMapping to physical resources\t104\n6.4.1.4\tSounding reference signal\t105\n6.4.1.4.1\tSRS resource\t105\n6.4.1.4.2\tSequence generation\t105\n6.4.1.4.3\tMapping to physical resources\t107\n6.4.1.4.4\tSounding reference signal slot configuration\t112\n7\tDownlink\t112\n7.1\tOverview\t112\n7.1.1\tOverview of physical channels\t112\n7.1.2\tOverview of physical signals\t113\n7.2\tPhysical resources\t113\n7.3\tPhysical channels\t113\n7.3.1\tPhysical downlink shared channel\t113\n7.3.1.1\tScrambling\t113\n7.3.1.2\tModulation\t114\n7.3.1.3\tLayer mapping\t114\n7.3.1.4\tAntenna port mapping\t115\n7.3.1.5\tMapping to virtual resource blocks\t116\n7.3.1.6\tMapping from virtual to physical resource blocks\t116\n7.3.2\tPhysical downlink control channel (PDCCH)\t118\n7.3.2.1\tControl-channel element (CCE)\t118\n7.3.2.2\tControl-resource set (CORESET)\t118\n7.3.2.3\tScrambling\t120\n7.3.2.4\tPDCCH modulation\t120\n7.3.2.5\tMapping to physical resources\t120\n7.3.3\tPhysical broadcast channel\t121\n7.3.3.1\tScrambling\t121\n7.3.3.2\tModulation\t121\n7.3.3.3\tMapping to physical resources\t121\n7.4\tPhysical signals\t121\n7.4.1\tReference signals\t121\n7.4.1.1\tDemodulation reference signals for PDSCH\t121\n7.4.1.1.1\tSequence generation\t121\n7.4.1.1.2\tMapping to physical resources\t122\n7.4.1.2\tPhase-tracking reference signals for PDSCH\t126\n7.4.1.2.1\tSequence generation\t126\n7.4.1.2.2\tMapping to physical resources\t126\n7.4.1.3\tDemodulation reference signals for PDCCH\t128\n7.4.1.3.1\tSequence generation\t128\n7.4.1.3.2\tMapping to physical resources\t128\n7.4.1.4\tDemodulation reference signals for PBCH\t129\n7.4.1.4.1\tSequence generation\t129\n7.4.1.4.2\tMapping to physical resources\t129\n7.4.1.5\tCSI reference signals\t129\n7.4.1.5.1\tGeneral\t129\n7.4.1.5.2\tSequence generation\t130\n7.4.1.5.3\tMapping to physical resources\t130\n7.4.1.6\tRIM reference signals\t133\n7.4.1.6.1\tGeneral\t133\n7.4.1.6.2\tSequence generation\t133\n7.4.1.6.3\tMapping to physical resources\t134\n7.4.1.6.4\tRIM-RS configuration\t134\n7.4.1.6.4.1\tGeneral\t134\n7.4.1.6.4.2\tTime-domain parameters and mapping from  to time-domain parameters\t134\n7.4.1.6.4.3\tFrequency-domain parameters and mapping from  to frequency-domain parameters\t135\n7.4.1.6.4.4\tSequence parameters and mapping from  to sequence parameters\t136\n7.4.1.6.4.5\tMapping between resource triplet and set ID\t136\n7.4.1.7\tPositioning reference signals\t137\n7.4.1.7.1\tGeneral\t137\n7.4.1.7.2\tSequence generation\t137\n7.4.1.7.3\tMapping to physical resources in a downlink PRS resource\t137\n7.4.1.7.4\tMapping to slots in a downlink PRS resource set\t138\n7.4.2\tSynchronization signals\t139\n7.4.2.1\tPhysical-layer cell identities\t139\n7.4.2.2\tPrimary synchronization signal\t139\n7.4.2.2.1\tSequence generation\t139\n7.4.2.2.2\tMapping to physical resources\t139\n7.4.2.3\tSecondary synchronization signal\t139\n7.4.2.3.1\tSequence generation\t139\n7.4.2.3.2\tMapping to physical resources\t139\n7.4.3\tSS/PBCH block\t140\n7.4.3.1\tTime-frequency structure of an SS/PBCH block\t140\n7.4.3.1.1\tMapping of PSS within an SS/PBCH block\t141\n7.4.3.1.2\tMapping of SSS within an SS/PBCH block\t141\n7.4.3.1.3\tMapping of PBCH and DM-RS within an SS/PBCH block\t141\n7.4.3.2\tTime location of an SS/PBCH block\t141\n8\tSidelink\t142\n8.1\tOverview\t142\n8.1.1\tOverview of physical channels\t142\n8.1.2\tOverview of physical signals\t142\n8.2\tPhysical resources\t142\n8.2.1\tGeneral\t142\n8.2.2\tNumerologies\t142\n8.2.3\tFrame structure\t143\n8.2.3.1\tFrames and subframes\t143\n8.2.3.2\tSlots\t143\n8.2.4\tAntenna ports\t143\n8.2.5\tResource grid\t143\n8.2.6\tResource elements\t144\n8.2.7\tResource blocks\t144\n8.2.8\tBandwidth part\t144\n8.3\tPhysical channels\t144\n8.3.1\tPhysical sidelink shared channel\t144\n8.3.1.1\tScrambling\t144\n8.3.1.2\tModulation\t145\n8.3.1.3\tLayer mapping\t145\n8.3.1.4\tPrecoding\t145\n8.3.1.5\tMapping to virtual resource blocks\t145\n8.3.1.6\tMapping from virtual to physical resource blocks\t146\n8.3.2\tPhysical sidelink control channel\t146\n8.3.2.1\tScrambling\t146\n8.3.2.2\tModulation\t146\n8.3.2.3\tMapping to physical resources\t146\n8.3.3\tPhysical sidelink broadcast channel\t146\n8.3.3.1\tScrambling\t146\n8.3.3.2\tModulation\t147\n8.3.3.3\tMapping to physical resources\t147\n8.3.4\tPhysical sidelink feedback channel\t147\n8.3.4.1\tGeneral\t147\n8.3.4.2\tPSFCH format 0\t147\n8.3.4.2.1\tSequence generation\t147\n8.3.4.2.2\tMapping to physical resources\t147\n8.4\tPhysical signals\t148\n8.4.1\tReference signals\t148\n8.4.1.1\tDemodulation reference signals for PSSCH\t148\n8.4.1.1.1\tSequence generation\t148\n8.4.1.1.2\tMapping to physical resources\t148\n8.4.1.2\tPhase-tracking reference signals for PSSCH\t149\n8.4.1.2.1\tSequence generation\t149\n8.4.1.2.2\tMapping to physical resources\t149\n8.4.1.3\tDemodulation reference signals for PSCCH\t150\n8.4.1.3.1\tSequence generation\t150\n8.4.1.3.2\tMapping to physical resources\t151\n8.4.1.4\tDemodulation reference signals for PSBCH\t151\n8.4.1.4.1\tSequence generation\t151\n8.4.1.4.2\tMapping to physical resources\t151\n8.4.1.5\tCSI reference signals\t152\n8.4.1.5.1\tGeneral\t152\n8.4.1.5.2\tSequence generation\t152\n8.4.1.5.3\tMapping to physical resources\t152\n8.4.1.6\tPositioning reference signals\t152\n8.4.1.6.1\tGeneral\t152\n8.4.1.6.2\tSequence generation\t152\n8.4.1.6.3\tMapping to physical resources\t153\n8.4.2\tSynchronization signals\t154\n8.4.2.1\tPhysical-layer sidelink synchronization identities\t154\n8.4.2.2\tSidelink primary synchronization signal\t154\n8.4.2.2.1\tSequence generation\t154\n8.4.2.2.2\tMapping to physical resources\t154\n8.4.2.3\tSidelink secondary synchronization signal\t154\n8.4.2.3.1\tSequence generation\t154\n8.4.2.3.2\tMapping to physical resources\t154\n8.4.3\tS-SS/PSBCH block\t155\n8.4.3.1\tTime-frequency structure of an S-SS/PSBCH block\t155\n8.4.3.1.1\tMapping of S-PSS within an S-SS/PSBCH block\t155\n8.4.3.1.2\tMapping of S-SSS within an S-SS/PSBCH block\t155\n8.4.3.1.3\tMapping of PSBCH and DM-RS within an S-SS/PSBCH block\t155\n8.4.3.2\tTime location of an S-SS/PSBCH block\t156\n8.5\tTiming\t156\nAnnex A: Change history\t157\n\nForeword\nThis Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n1\tScope\nThe present document describes the physical channels and signals for 5G-NR.\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 38.201: \"NR; Physical Layer \u2013 General Description\"\n[3]\t3GPP TS 38.202: \"NR; Services provided by the physical layer\"\n[4]\t3GPP TS 38.212: \"NR; Multiplexing and channel coding\"\n[5]\t3GPP TS 38.213: \"NR; Physical layer procedures for control \"\n[6]\t3GPP TS 38.214: \"NR; Physical layer procedures for data \"\n[7]\t3GPP TS 38.215: \"NR; Physical layer measurements\"\n[8]\t3GPP TS 38.104: \"NR; Base Station (BS) radio transmission and reception\"\n[9]\tvoid\n[10]\t3GPP TS 38.306: \"NR; User Equipment (UE) radio access capabilities\"\n[11]\t3GPP TS 38.321: \"NR; Medium Access Control (MAC) protocol specification\"\n[12]\t3GPP TS 38.133: \"NR; Requirements for support of radio resource management\"\n[13]\t3GPP TS 38.304: \"NR; User Equipment (UE) procedures in Idle mode and RRC Inactive state\"\n[14]\t3GPP TS 38.101-1: \"NR; User Equipment (UE) radio transmission and reception; Part 1: Range 1 Standalone\"\n\n\n3\tDefinitions of terms, symbols and abbreviations\n3.1\tTerms\nFor the purposes of the present document, the following definitions apply:\n3.2\tSymbols\nFor the purposes of the present document, the following symbols apply:\n\tResource element with frequency-domain index  and time-domain index  for antenna port  and subcarrier spacing configuration ; see clause 4.4.3\n\tValue of resource element  for antenna port and subcarrier spacing configuration ; see clause 4.4.3\n\tAmplitude scaling for a physical channel/signal\n\tPN sequence; see clause 5.2.1\n\tSubcarrier spacing\n\tSubcarrier spacing for random-access preambles\n\tThe ratio between  and ; see clause 4.1\n\tSubcarrier index relative to a reference\n\tOFDM symbol index relative to a reference\n\tSubcarrier spacing configuration, \n\tNumber of coded bits to transmit on a physical channel [for codeword ]\n\tNumber of modulation symbols to transmit on a physical channel [for codeword ]\n\tNumber of modulation symbols to transmit per layer for a physical channel\n\tScheduled bandwidth for uplink transmission, expressed as a number of subcarriers \n\tScheduled bandwidth for uplink transmission, expressed as a number of resource blocks\n\tNumber of modulation symbols to transmit per antenna port for a physical channel\n\tNumber of transmission layers\n\tSize of bandwidth part ; see clause 4.4.4.4\n\tStart of bandwidth part ; see clause 4.4.4.4\n\tCyclic prefix length; see clause 5.3.1\n\tThe size of the resource grid; see clauses 4.4.2 and 5.3\n\tThe start of the resource grid; see clause 4.4.2\n\tThe number of PT-RS groups; see clause 6.3.1.4\n\tPhysical layer cell identity; see clause 7.4.2.1\n\tPhysical-layer sidelink identity; see clause 8.4.2.1\n\tFrequency-domain size of a control resource set; see clause 7.3.2.2\n\tNumber of resource-element groups in a CORESET; see clause 7.3.2.2\n\tNumber of samples per PT-RS group; see clause 6.3.1.4\n\tNumber of subcarriers per resource block, see clause 4.4.4.1\n\tNumber of slots per subframe for subcarrier spacing configuration , see clause 4.3.2\n\tNumber of slots per frame for subcarrier spacing configuration , see clause 4.3.2\n\tTime duration of a control resource set; see clause 7.3.2.2\n\tLength of the PUCCH transmission in OFDM symbols; see clause 6.3.2.1\n\tNumber of OFDM symbols per subframe for subcarrier spacing configuration ; see clause 4.3.1\n\tNumber of symbols per slot\n\tTiming advance between downlink and uplink; see clause 4.3.1\n\tA fixed offset used to calculate the timing advance; see clause 4.3.1\n\tNetwork-controlled timing correction; see clause 4.3.1\n\tUE-derived timing correction; see clause 4.3.1\n\tMinimum time from reception to transmission for a half-duplex UE; see clause 4.3.2\n\tSystem frame number (SFN)\n\tCommon resource block number for subcarrier spacing configuration , see clause 4.4.4.3\n\tHyper-frame number\n\tPhysical resource block number; see clause 4.4.4.4\n\tRadio network temporary identifier\n\tSlot number within a subframe for subcarrier spacing configuration ; see clause 4.3.2\n\tSlot number within a frame for subcarrier spacing configuration ; see clause 4.3.2\n\tAntenna port number\n\tModulation order\n\tNumber of antenna ports\n\tLow-PAPR base sequence; see clause 5.2.2\n\tLow-PAPR sequence; see clause 5.2.2\n\tThe time-continuous signal on antenna port  and subcarrier spacing configuration  for OFDM symbol  in a subframe; see clause 5.3.1\n\tBasic time unit for NR; see clause 4.1\n\tRadio frame duration; see clause 4.3.1\n\tBasic time unit for LTE\n\tSubframe duration; see clause 4.3.1\n\tSlot duration; see clause 4.3.2\n\tTiming advance between downlink and uplink; see clause 4.3.1\n\tPrecoding matrix for spatial multiplexing\n\n3.3\tAbbreviations\nFor the purposes of the present document, the following abbreviations apply:\nBWP\tBandwidth Part\nCCE\tControl Channel Element\nCORESET\tControl Resource Set\nCRB\tCommon Resource Block\nCSI\tChannel-State Information\nCSI-RS\tCSI Reference Signal \nDCI\tDownlink Control Information\nDM-RS\tDemodulation Reference Signal\nFR1\tFrequency Range 1 as defined in TS 38.104 [8]\nFR2\tFrequency Range 2 as defined in TS 38.104 [8]\nIAB\tIntegrated Access and Backhaul\nIAB-MT\tIAB Mobile Termination \nIE\tInformation Element\nNCR\tNetwork-Controlled repeater\nNCR-MT\tNCR Mobile Termination\nPBCH\tPhysical Broadcast Channel\nPDCCH\tPhysical Downlink Control Channel\nPDSCH\tPhysical Downlink Shared Channel\nPRACH\tPhysical Random-Access Channel \nPRB\tPhysical Resource Block\nPSS\tPrimary Synchronization Signal\nPT-RS\tPhase-tracking reference signal\nPUCCH\tPhysical Uplink Control Channel\nPUSCH\tPhysical Uplink Shared Channel\nRAR\tRandom Access Response\nREG\tResource-Element Group\nRIM\tRemote Interference Management\nRIM-RS\tRemote Interference Management Reference Signal\nSRS\tSounding Reference Signal\nSSS\tSecondary Synchronization Signal\nVRB\tVirtual Resource Block\n\n4\tFrame structure and physical resources\n4.1\tGeneral\nThroughout this specification, unless otherwise noted, the size of various fields in the time domain is expressed in time units  where  Hz and . The constant  where ,  and .\nThroughout this specification, unless otherwise noted, statements using the term \"UE\" in clauses 4, 5, 6, or 7 are equally applicable to the IAB-MT part of an IAB-node and the NCR-MT part of an NCR node. \n4.2\tNumerologies\nMultiple OFDM numerologies are supported as given by Table 4.2-1 where  and the cyclic prefix for a downlink or uplink bandwidth part are obtained from the higher-layer parameters subcarrierSpacing and cyclicPrefix, respectively. \nTable 4.2-1: Supported transmission numerologies.\n\n4.3\tFrame structure\n4.3.1\tFrames and subframes\nDownlink, uplink, and sidelink transmissions are organized into frames with  duration, each consisting of ten subframes of  duration. The number of consecutive OFDM symbols per subframe is . Each frame is divided into two equally-sized half-frames of five subframes each with half-frame 0 consisting of subframes 0 \u2013 4 and half-frame 1 consisting of subframes 5 \u2013 9.\nThere is one set of frames in the uplink and one set of frames in the downlink on a carrier. \nUplink frame number  for transmission from the UE shall start  before the start of the corresponding downlink frame at the UE where\n-  and  are given by clause 4.2 of [5, TS 38.213], except for msgA transmission on PUSCH where  shall be used;\n-\t given by clause 4.2 of [5, TS 38.213] is derived from the higher-layer parameters ta-Common, ta-CommonDrift, and ta-CommonDriftVariant if configured, otherwise ;\n-\t given by clause 4.2 of [5, TS 38.213] is computed by the UE based on UE position and serving-satellite-ephemeris-related higher-layers parameters if configured, otherwise .\n\n\nFigure 4.3.1-1: Uplink-downlink timing relation.\n\n4.3.2\tSlots\nFor subcarrier spacing configuration , slots are numbered  in increasing order within a subframe and  in increasing order within a frame. There are  consecutive OFDM symbols in a slot where  depends on the cyclic prefix as given by Tables 4.3.2-1 and 4.3.2-2. The start of slot  in a subframe is aligned in time with the start of OFDM symbol  in the same subframe.\nOFDM symbols in a slot in a downlink or uplink frame can be classified as 'downlink', 'flexible', or 'uplink'. Signaling of slot formats is described in clause 11.1 of [5, TS 38.213]. \nIn a slot in a downlink frame, the UE shall assume that downlink transmissions only occur in 'downlink' or 'flexible' symbols.\nIn a slot in an uplink frame, the UE shall only transmit in 'uplink' or 'flexible' symbols.\nA UE not capable of full-duplex communication and not supporting simultaneous transmission and reception as defined by parameter simultaneousRxTxInterBandENDC, simultaneousRxTxInterBandCA or simultaneousRxTxSUL [10, TS 38.306] among all cells within a group of cells is not expected to transmit in the uplink in one cell within the group of cells earlier than  after the end of the last received downlink symbol in the same or different cell within the group of cells where  is given by Table 4.3.2-3. \nA UE not capable of full-duplex communication and not supporting simultaneous transmission and reception as defined by parameter simultaneousRxTxInterBandENDC, simultaneousRxTxInterBandCA or simultaneousRxTxSUL [10, TS 38.306] among all cells within a group of cells is not expected to receive in the downlink in one cell within the group of cells earlier than  after the end of the last transmitted uplink symbol in the same or different cell within the group of cells where  is given by Table 4.3.2-3. \nFor DAPS handover operation, a UE not capable of full-duplex communication is not expected to transmit in the uplink to a cell earlier than  after the end of the last received downlink symbol in the different cell where  is given by Table 4.3.2-3. \nFor DAPS handover operation, a UE not capable of full-duplex communication is not expected to receive in the downlink from a cell earlier than  after the end of the last transmitted uplink symbol in the different cell where  is given by Table 4.3.2-3.\nA UE not capable of full-duplex communication is not expected to transmit in the uplink earlier than  after the end of the last received downlink symbol in the same cell where  is given by Table 4.3.2-3. \nA UE not capable of full-duplex communication is not expected to receive in the downlink earlier than  after the end of the last transmitted uplink symbol in the same cell where  is given by Table 4.3.2-3.\nTable 4.3.2-1: Number of OFDM symbols per slot, slots per frame, and slots per subframe for normal cyclic prefix.\n\nTable 4.3.2-2: Number of OFDM symbols per slot, slots per frame, and slots per subframe for extended cyclic prefix.\n\nTable 4.3.2-3: Transition time  and \n\n4.4\tPhysical resources\n4.4.1\tAntenna ports\nAn antenna port is defined such that the channel over which a symbol on the antenna port is conveyed can be inferred from the channel over which another symbol on the same antenna port is conveyed. \nTwo antenna ports are said to be quasi co-located if the large-scale properties of the channel over which a symbol on one antenna port is conveyed can be inferred from the channel over which a symbol on the other antenna port is conveyed. The large-scale properties include one or more of delay spread, Doppler spread, Doppler shift, average gain, average delay, and spatial Rx parameters. \n4.4.2\tResource grid\nFor each numerology and carrier, a resource grid of  subcarriers and  OFDM symbols is defined, starting at common resource block  indicated by higher-layer signalling. There is one set of resource grids per transmission direction (uplink, downlink, or sidelink) with the subscript set to DL, UL, and SL for downlink, uplink, and sidelink, respectively. When there is no risk for confusion, the subscript  may be dropped. There is one resource grid for a given antenna port , subcarrier spacing configuration , and transmission direction (downlink, uplink, or sidelink). \nFor uplink and downlink, the carrier bandwidth  for subcarrier spacing configuration  is given by the higher-layer parameter carrierBandwidth in the SCS-SpecificCarrier IE. The starting position  for subcarrier spacing configuration  is given by the higher-layer parameter offsetToCarrier in the SCS-SpecificCarrier IE.\nThe frequency location of a subcarrier refers to the center frequency of that subcarrier.\nFor the downlink, the higher-layer parameter txDirectCurrentLocation in the SCS-SpecificCarrier IE indicates the location of the transmitter DC subcarrier in the downlink for each of the numerologies configured in the downlink. Values in the range 0 \u2013 3299 represent the number of the DC subcarrier and the value 3300 indicates that the DC subcarrier is located outside the resource grid.\nFor the uplink, the higher-layer parameter txDirectCurrentLocation in the UplinkTxDirectCurrentBWP IE indicates the location of the transmitter DC subcarrier in the uplink for each of the configured bandwidth parts, including whether the DC subcarrier location is offset by 7.5 kHz relative to the center of the indicated subcarrier or not. Values in the range 0 \u2013 3299 represent the number of the DC subcarrier, the value 3300 indicates that the DC subcarrier is located outside the resource grid, and the value 3301 indicates that the position of the DC subcarrier in the uplink is undetermined.\n4.4.3\tResource elements\nEach element in the resource grid for antenna port  and subcarrier spacing configuration  is called a resource element and is uniquely identified by  where  is the index in the frequency domain and  refers to the symbol position in the time domain relative to some reference point. Resource element  corresponds to a physical resource and the complex value . When there is no risk for confusion, or no particular antenna port or subcarrier spacing is specified, the indices  and  may be dropped, resulting in  or .\n4.4.4\tResource blocks\n4.4.4.1\tGeneral\nA resource block is defined as  consecutive subcarriers in the frequency domain. \n4.4.4.2\tPoint A\nPoint A serves as a common reference point for resource block grids and is obtained from:\n-\toffsetToPointA for a PCell downlink where offsetToPointA represents the frequency offset between point A and the lowest subcarrier of the lowest resource block, which overlaps with the SS/PBCH block, or the SS/PBCH block after puncturing if applicable, used by the UE for initial cell selection, expressed in units of resource blocks assuming 15 kHz subcarrier spacing for FR1 and 60 kHz subcarrier spacing for FR2; \n-\tfor operation without shared spectrum channel access in FR1 and FR2-1, the lowest resource block has the subcarrier spacing provided by the higher layer parameter subCarrierSpacingCommon;\n-\tfor operation with shared spectrum channel access in FR1 or FR2, and for operation without shared spectrum channel access in FR2-2, the lowest resource block has the subcarrier spacing same as the SS/PBCH block used by the UE for initial cell selection;\n-\tabsoluteFrequencyPointA for all other cases where absoluteFrequencyPointA represents the frequency-location of point A expressed as in ARFCN.\n4.4.4.3\tCommon resource blocks\nCommon resource blocks are numbered from 0 and upwards in the frequency domain for subcarrier spacing configuration . The center of subcarrier 0 of common resource block 0 for subcarrier spacing configuration  coincides with 'point A'. \nThe relation between the common resource block number  in the frequency domain and resource elements  for subcarrier spacing configuration  is given by\n\t\nwhere  is defined relative to point A such that  corresponds to the subcarrier centered around point A.\n4.4.4.4\tPhysical resource blocks\nPhysical resource blocks for subcarrier spacing configuration  are defined within a bandwidth part and numbered from 0 to  where  is the number of the bandwidth part. The relation between the physical resource block  in bandwidth part  and the common resource block  is given by\n\nwhere  is the common resource block where bandwidth part  starts relative to common resource block 0. When there is no risk for confusion the index  may be dropped.\n4.4.4.5\tVirtual resource blocks\nVirtual resource blocks are defined within a bandwidth part and numbered from 0 to  where  is the number of the bandwidth part. \n4.4.4.6\tInterlaced resource blocks\nMultiple interlaces of resource blocks are defined where interlace  consists of common resource blocks , with  being the number of interlaces given by Table 4.4.4.6-1. The relation between the interlaced resource block  in bandwidth part  and interlace  and the common resource block  is given by\n\nwhere  is the common resource block where bandwidth part starts relative to common resource block 0. When there is no risk for confusion the index  may be dropped. \nThe UE expects that the number of common resource blocks in an interlace contained within bandwidth part  is no less than 10.\nTable 4.4.4.6-1: The number of resource block interlaces.\n\n4.4.5\tBandwidth part\nA bandwidth part is a subset of contiguous common resource blocks defined in clause 4.4.4.3 for a given numerology  in bandwidth part  on a given carrier. The starting position  and the number of resource blocks  in a bandwidth part shall fulfil  and , respectively. Configuration of a bandwidth part is described in clause 12 of [5, TS 38.213].\nA UE can be configured with up to four bandwidth parts in the downlink with a single downlink bandwidth part being active at a given time. The UE is not expected to receive PDSCH, PDCCH, or CSI-RS (except for RRM) outside an active bandwidth part.\nA UE can be configured with up to four bandwidth parts in the uplink with a single uplink bandwidth part being active at a given time. If a UE is configured with a supplementary uplink, the UE can in addition be configured with up to four bandwidth parts in the supplementary uplink with a single supplementary uplink bandwidth part being active at a given time. The UE shall not transmit PUSCH or PUCCH outside an active bandwidth part. For an active cell, the UE shall not transmit SRS outside an active bandwidth part.\nUnless otherwise noted, the description in this specification applies to each of the bandwidth parts. When there is no risk of confusion, the index  may be dropped from , , , and .\n4.4.6\tCommon MBS frequency resource\nA common MBS frequency resource is a contiguous set of common resource blocks. The starting position  of the common MBS frequency resource  is defined relative to point A and the size of the common MBS frequency resource is given by . Resource blocks in a common MBS frequency resource are numbered in the same way as resource blocks in clause 4.4.4.4 with  and  replaced by  and , respectively.\nA UE is not expected to receive PDSCH or PDCCH associated with MBS transmissions scheduled with G-RNTI, G-CS-RNTI, MCCH-RNTI, or multicast-MCCH-RNTI outside the common MBS frequency resource.\n4.5\tCarrier aggregation\nTransmissions in multiple cells can be aggregated. Unless otherwise noted, the description in this specification applies to each of the serving cells. \nFor carrier aggregation of cells with unaligned frame boundaries, the slot offset  between a PCell/PScell and an SCell is determined by higher-layer parameter ca-SlotOffset for the SCell. The quantity  is defined as the maximum of the lowest subcarrier spacing configuration among the subcarrier spacings given by the higher-layer parameters scs-SpecificCarrierList configured for PCell/PSCell and the SCell, respectively. The slot offset  fulfills\n-\twhen the lowest subcarrier spacing configuration among the subcarrier spacings configured for the cell is  for both cells or  for both cells, the start of slot 0 for the cell whose point A has a lower frequency coincides with the start of slot  for the other cell where   if point A of the PCell/PSCell has a frequency lower than the frequency of point A for the SCell, otherwise ;\n-\totherwise, the start of slot 0 for the cell with the lower subcarrier spacing of the lowest subcarrier spacing given by the higher-layer parameters scs-SpecificCarrierList configured for the two cells, or the Pcell/PSCell if both cells have the same lowest subcarrier spacing given by the higher-layer parameters scs-SpecificCarrierList configured for the two cells, coincides with the start of slot  for the other cell where   if the lowest subcarreier spacing configuration given by scs-SpecificCarrierList of the PCell/PSCell is smaller than or equal to the lowest subcarrier spacing given by scs-SpecificCarrierList for the SCell, otherwise .\n\n5\tGeneric functions\n5.1\tModulation mapper\nThe modulation mapper takes binary digits, 0 or 1, as input and produces complex-valued modulation symbols as output. \n5.1.1\t\u03c0/2-BPSK\nIn case of \u03c0/2-BPSK modulation, bit  is mapped to complex-valued modulation symbol  according to\n\t\n5.1.2\tBPSK\nIn case of BPSK modulation, bit  is mapped to complex-valued modulation symbol  according to\n\t\n5.1.3\tQPSK\nIn case of QPSK modulation, pairs of bits, , are mapped to complex-valued modulation symbols  according to\n\t\n5.1.4\t16QAM\nIn case of 16QAM modulation, quadruplets of bits, , are mapped to complex-valued modulation symbols  according to\n\n5.1.5\t64QAM\nIn case of 64QAM modulation, hextuplets of bits, , are mapped to complex-valued modulation symbols  according to\n\n5.1.6\t256QAM\nIn case of 256QAM modulation, octuplets of bits, , are mapped to complex-valued modulation symbols  according to\n\n5.1.7\t1024QAM\nIn case of 1024QAM modulation, 10-tuplets of bits, , are mapped to complex-valued modulation symbols  according to\n\n5.2\tSequence generation\n5.2.1\tPseudo-random sequence generation\nGeneric pseudo-random sequences are defined by a length-31 Gold sequence. The output sequence  of length, where, is defined by \n\nwhere  and the first m-sequence  shall be initialized with. The initialization of the second m-sequence, , is denoted by  with the value depending on the application of the sequence.\n5.2.2\tLow-PAPR sequence generation type 1\nThe low-PAPR sequence  is defined by a cyclic shift  of a base sequence  according to \n\nwhere  is the length of the sequence. Multiple sequences are defined from a single base sequence through different values of  and . \nBase sequences  are divided into groups, where  is the group number and  is the base sequence number within the group, such that each group contains one base sequence () of each length ,  and two base sequences () of each length , . The definition of the base sequence  depends on the sequence length .\n5.2.2.1\tBase sequences of length 36 or larger\nFor, the base sequence  is given by\n\nwhere\n\nThe length  is given by the largest prime number such that.\n5.2.2.2\tBase sequences of length less than 36\nFor  the base sequence is given by\n\nwhere the value of  is given by Tables 5.2.2.2-1 to 5.2.2.2-4. \nFor , the base sequence  is given by\n\n\nTable 5.2.2.2-1: Definition of  for.\n\n\nTable 5.2.2.2-2: Definition of  for. \n\nTable 5.2.2.2-3: Definition of  for  \n\nTable 5.2.2.2-4: Definition of  for  \n\n5.2.3\tLow-PAPR sequence generation type 2\nThe low-PAPR sequence  is defined by a base sequence  according to \n\nwhere  is the length of the sequence. \nBase sequences  are divided into groups, where  is the group number and  is the base sequence number within the group, such that each group contains one base sequence () of length , . The sequence  is defined by\n\nwhere the definition of  depends on the sequence length.\n5.2.3.1\tSequences of length 30 or larger\nFor , the sequence  is obtained as the complex-valued modulations symbols resulting from \u03c0/2-BPSK modulation as defined in clause 5.1.1 applied to the binary sequence  given by clause 5.2.1, initialized with .\n5.2.3.2\tSequences of length less than 30\nFor , the sequence   is given by\n\nwhere the value of  is given by Table 5.2.3.2-1. \nFor , the sequence  is obtained as the complex-valued modulations symbols resulting from \u03c0/2-BPSK modulation as defined in clause 5.1.1 applied to the binary sequence  given by Tables 5.2.3.2-2 to 5.2.3.2-4.\n\nTable 5.2.3.2-1: Definition of  for .\n\nTable 5.2.3.2-2: Definition of  for . \n\nTable 5.2.3.2-3: Definition of  for .\n\nTable 5.2.3.2-4: Definition of  for  \n\n5.3\tOFDM baseband signal generation\n5.3.1\tOFDM baseband signal generation for all channels except PRACH and RIM-RS\nThe time-continuous signal  on antenna port  and subcarrier spacing configuration  for OFDM symbol  in a subframe for any physical channel or signal except PRACH is defined by\n\t\nwhere  at the start of the subframe, \n\nand\n-\t is given by clause 4.2;\n-\t is the subcarrier spacing configuration; \n-\t is the largest  value among the subcarrier spacing configurations by scs-SpecificCarrierList for each of uplink and downlink and by sl-SCS-SpecificCarrierList for sidelink.\nThe starting position of OFDM symbol  for subcarrier spacing configuration  in a subframe is given by\n\nIn case of cyclic prefix extension of the first OFDM symbol  allocated for PUSCH, SRS, PUCCH, PSCCH/PSSCH, PSFCH, or S-SS/PSBCH block transmission, the time-continuous signal  for the interval  preceding the first OFDM symbol for PUSCH, SRS, PUCCH, PSCCH/PSSCH, PSFCH, or S-SS/PSBCH block is given by\n\nwhere  refers to the signal in the previous subframe and \n-\tfor dynamically scheduled PUSCH, SRS, and PUCCH transmissions\n\n\n\twhere  is given by Table 5.3.1-1 with  for ,  for , and  and  given by the higher-layer parameters cp-ExtensionC2 and cp-ExtensionC3, respectively, and  given by clause 4.3.1. For contention-based random access, or in absence of higher-layer configuration of  and , the value of shall be set to the largest integer fulfilling  for each of the values of . Text is applied to the first UL transmission scheduled by the scheduling DCI.\n-\tfor a PUSCH transmission using configured grant\n\n\twhere   is given by Table 5.3.1-2 with the index  given by the procedure in [6, TS 38.214].\n-\tfor PSCCH/PSSCH, PSFCH, and S-SS/PSBCH block transmission\n\n\twhere   and  are given by Table 5.3.1-3 with the index  given by the procedure in [5, TS 38.213] or [6, TS 38.214].\n\nTable 5.3.1-1: The variables  and  for uplink cyclic prefix extension \n\nTable 5.3.1-2: The variable  for uplink cyclic prefix extension with configured grants.\n\nTable 5.3.1-3: The variables  and  for sidelink cyclic prefix extension \n\n5.3.2\tOFDM baseband signal generation for PRACH\nThe time-continuous signal  on antenna port  for PRACH is defined by\n\nwhere  and \n-\t is given by clause 6.3.3; \n-\t is the subcarrier spacing of the initial uplink bandwidth part during initial access. Otherwise,  is the subcarrier spacing of the active uplink bandwidth part; \n-\t is the largest  value among the subcarrier spacing configurations by the higher-layer parameter scs-SpecificCarrierList;\n-\t is the lowest numbered resource block of the initial uplink bandwidth part and is derived by the higher-layer parameter initialUplinkBWP or initialUplinkBWP-RedCap during initial access. Otherwise,  is the lowest numbered resource block of the active uplink bandwidth part and is derived by the higher-layer parameter BWP-Uplink; \n-\t is the frequency offset of the lowest PRACH transmission occasion in frequency domain with respect to physical resource block 0 of the active uplink bandwidth part. The quantity  is given by the higher-layer parameter msgA-RO-FrequencyStart if configured and a type-2 random-access procedure is initiated as described in clause 8.1 of [5, TS 38.213], otherwise by msg1-FrequencyStart as described in clause 8.1 of [5 TS 38.213];\n-\t is the PRACH transmission occasion index in frequency domain for a given PRACH transmission occasion in one time instance as given by clause 6.3.3.2; \n-\t is the number of resource blocks occupied and is given by the parameter allocation expressed in number of RBs for PUSCH in Table 6.3.3.2-1. \n-\t is the start CRB index of uplink RB set  corresponding to the quantity . The UE assumes that the RB set is defined as when the UE is not provided IntraCellGuardBandsPerSCS for an UL carrier as described in Clause 7 of [6, TS 38.214]\n-\t is the index of the RB set which contains the lowest PRACH transmission occasion in frequency domain indicated by . The UE may assume that  is configured such that each PRACH transmission occasion is fully contained within an RB set.\n-\t and  are given by clause 6.3.3\n-\t where \n-\tfor ,  \n-\tfor kHz,  is the number of times the interval  overlaps with either time instance 0 or time instance  in a subframe\nThe starting position  of the PRACH preamble in a subframe (for ) or in a 60 kHz slot (for kHz) is given by\n\t\nwhere \n-\tthe subframe or 60 kHz slot is assumed to start at ;\n-\ta timing advance value  shall be assumed; \n-\t and  are given by clause 5.3.1;\n-\t shall be assumed for  kHz, otherwise the value of  corresponds to  kHz and the symbol position  is given by\n\t\nwhere \n-\t is given by the parameter \"starting symbol\" in Tables 6.3.3.2-2 to 6.3.3.2-4;\n-\t is the PRACH transmission occasion within the PRACH slot, numbered in increasing order from 0 to  within a RACH slot where  is given Tables 6.3.3.2-2 to 6.3.3.2-4 for  and fixed to 1 for ;\n-\t is given by Tables 6.3.3.2-2 to 6.3.3.2-4;\n-\t is given by\n-\tif  kHz, then \n-\tif  kHz and either of \"Number of PRACH slots within a subframe\" in Tables 6.3.3.2-2 to 6.3.3.2-3 or \"Number of PRACH slots within a 60 kHz slot\" in Table 6.3.3.2-4 is equal to 1, then , otherwise \n-\tif  kHz and \n-\tthe \"Number of PRACH slots within a 60 kHz slot\" in Table 6.3.3.2-4 is equal to 1, then  for  kHz and  for kHz, or\n-\tthe \"Number of PRACH slots within a 60 kHz slot\" in Table 6.3.3.2-4 is equal to 2, then  for kHz and  for kHz.\nIf the preamble format given by Tables 6.3.3.2-2 to 6.3.3.2-4 is A1/B1, A2/B2 or A3/B3, then\n-\tif , then the PRACH preamble with the corresponding PRACH preamble format from B1, B2 and B3 is transmitted in the PRACH transmission occasion;\n-\totherwise the PRACH preamble with the corresponding PRACH preamble format from A1, A2 and A3 is transmitted in the PRACH transmission occasion\n5.3.3\tOFDM baseband signal generation for RIM-RS\nThe time-continuous signal  on antenna port  for RIM-RS is defined by\n\t\nwhere\n\n\n\n\nand \n-\t where  is the subcarrier spacing configuration for the RIM-RS; \n-\t is the starting frequency offset of the RIM-RS as given by clause 7.4.1.6.4.3;\n-\t is the length of the RIM-RS sequence where  is the bandwidth of the RIM-RS in resource blocks;\n-\t is the starting symbol given by clause 7.4.1.6.3;\n-\t is given by clause 5.3.1 with ;\n-\t is given by clause 5.3.1 with .\n5.4\tModulation and upconversion\nModulation and upconversion to the carrier frequency  of the complex-valued OFDM baseband signal for antenna port , subcarrier spacing configuration , and OFDM symbol  in a subframe assumed to start at  is given by \n-\tfor PRACH\n\t\n-\tfor RIM-RS\n\t\nwhere  is the configured reference point for RIM-RS;\n-\tfor all other channels and signals\n\t\nNOTE:\tFor the uplink, the signal  and the baseband signals part thereof should be filtered per UE implementation, as required, to meet the minimum requirements as specified in [38.101-1] and [38.101-2] for the respective frequency range. \n6\tUplink\n6.1\tOverview\n6.1.1\tOverview of physical channels\nAn uplink physical channel corresponds to a set of resource elements carrying information originating from higher layers. The following uplink physical channels are defined:\n-\tPhysical Uplink Shared Channel, PUSCH\n-\tPhysical Uplink Control Channel, PUCCH\n-\tPhysical Random Access Channel, PRACH\n6.1.2\tOverview of physical signals\nAn uplink physical signal is used by the physical layer but does not carry information originating from higher layers. The following uplink physical signals are defined:\n-\tDemodulation reference signals, DM-RS\n-\tPhase-tracking reference signals, PT-RS\n-\tSounding reference signal, SRS\n6.2\tPhysical resources\nThe frame structure and physical resources the UE shall use when transmitting in the uplink transmissions are defined in Clause 4.\nThe following antenna ports are defined for the uplink:\n-\tAntenna ports starting with 0 for demodulation reference signals for PUSCH\n-\tAntenna ports starting with 1000 for SRS, PUSCH\n-\tAntenna ports starting with 2000 for PUCCH\n-\tAntenna port 4000 for PRACH \nIf PUSCH repetition Type B as described in clause 6.1 of [6, TS38.214] is applied to a physical channel, the UE transmission shall be such that the channel over which a symbol on the antenna port used for uplink transmission is conveyed can be inferred from the channel over which another symbol on the same antenna port is conveyed if the two symbols correspond to the same actual repetition of a PUSCH transmission with repetition Type B.\nIf intra-slot frequency hopping is not enabled for a physical channel and PUSCH repetition Type B is not applied to the physical channel, the UE transmission shall be such that the channel over which a symbol on the antenna port used for uplink transmission is conveyed can be inferred from the channel over which another symbol on the same antenna port is conveyed if the two symbols correspond to the same slot.\nIf intra-slot frequency hopping is enabled for a physical channel, the UE transmission shall be such that the channel over which a symbol on the antenna port used for uplink transmission is conveyed can be inferred from the channel over which another symbol on the same antenna port is conveyed only if the two symbols correspond to the same frequency hop, regardless of whether the frequency hop distance is zero or not.\nIf DM-RS bundling is applied to PUSCH and/or PUCCH repetitions and/or transport-block processing over multiple slots as described in clause 6.1.7 of [6, 38.214], the UE transmission shall be such that the channel over which a symbol on the antenna port used for uplink transmission is conveyed can be inferred from the channel over which another symbol on the same antenna port is conveyed if the two symbols are transmitted within the same actual time-domain window.\n6.3\tPhysical channels\n6.3.1\tPhysical uplink shared channel\n6.3.1.1\tScrambling\nUp to two codewords  can be transmitted. In case of single-codeword transmission, .\nFor each codeword, the block of bits , where  is the number of bits in codeword  transmitted on the physical channel, shall be scrambled prior to modulation, resulting in a block of scrambled bits  according to the following pseudo code\nSet i = 0\nwhile \nif \t// UCI placeholder bits\n\nelse\nif \t// UCI placeholder bits\n\nelse\n\nend if\nend if \ni = i + 1\nend while\nwhere x and y are tags defined in [4, TS 38.212] and where the scrambling sequence  is given by clause 5.2.1. The scrambling sequence generator shall be initialized with \n\nwhere\n-\t equals the higher-layer parameter dataScramblingIdentityPUSCH if configured and the RNTI equals the C-RNTI, MCS-C-RNTI, SP-CSI-RNTI or CS-RNTI, and the transmission is not scheduled using DCI format 0_0 in a common search space;\n-\t equals the higher-layer parameter msgA-DataScramblingIndex if configured and the PUSCH transmission is triggered by a Type-2 random access procedure as described in clause 8.1A of [5, TS 38.213];\n-\t otherwise\n-\t is the index of the random-access preamble transmitted for msgA as described in clause 5.1.3A of [11, TS 38.321]\nand where  equals the RA-RNTI for msgA and otherwise corresponds to the RNTI associated with the PUSCH transmission as described in clause 6.1 of [6, TS 38.214] and clause 8.3 of [5, TS 38.213].\n6.3.1.2\tModulation\nFor each codeword , the block of scrambled bits  shall be modulated as described in clause\u00a05.1 using one of the modulation schemes in Table 6.3.1.2-1, resulting in a block of complex-valued modulation symbols . \nTable 6.3.1.2-1: Supported modulation schemes.\n\n6.3.1.3\tLayer mapping\nThe complex-valued modulation symbols for each of the codewords to be transmitted shall be mapped onto up to four layers according to Table 7.3.1.3-1. Complex-valued modulation symbols  for codeword  shall be mapped onto the layers ,  where  is the number of layers and  is the number of modulation symbols per layer.\n6.3.1.4\tTransform precoding\nIf transform precoding is not enabled according to 6.1.3 of [6, TS38.214],  for each layer .\nIf transform precoding is enabled according to 6.1.3 of [6, TS38.214],  and  depends on the configuration of phase-tracking reference signals.\nIf the procedure in [6, TS 38.214] indicates that phase-tracking reference signals are not being used, the block of complex-valued symbols  for the single layer  shall be divided into  sets, each corresponding to one OFDM symbol and . \nIf the procedure in [6, TS 38.214] indicates that phase-tracking reference signals are being used, the block of complex-valued symbols  shall be divided into sets, each set corresponding to one OFDM symbol, and where set  contains  symbols and is mapped to the complex-valued symbols  corresponding to OFDM symbol  prior to transform precoding, with  and . The index  of PT-RS samples in set , the number of samples per PT-RS group , and the number of PT-RS groups  are defined in clause 6.4.1.2.2.2. The quantity  when OFDM symbol  contains one or more PT-RS samples, otherwise .\nTransform precoding shall be applied according to\n\t\nresulting in a block of complex-valued symbols . The variable, where  represents the bandwidth of the PUSCH in terms of resource blocks, and shall fulfil\n\t\nwhere  is a set of non-negative integers. \n6.3.1.5\tPrecoding\nThe block of vectors  shall be precoded according to\n\nwhere , . The set of antenna ports  shall be determined according to the procedure in [6, TS 38.214]. \nFor non-codebook-based transmission, the precoding matrix  equals the identity matrix.\nFor codebook-based transmission, the precoding matrix  depends on the number of antenna ports used for the transmission: \n-\tfor single-layer transmission on a single antenna port, ;\n-\tfor transmissions using 2, or 4 antenna ports,  is given by Tables 6.3.1.5-1 to 6.3.1.5-7; \n-\tfor transmissions using 8 antenna ports,  is given by\n\n\twhere \n-\tthe subscripts  and  denote the row of the respective matrix;\n-\t is given by Table 6.3.1.5-8;\n-\tthe intermediate precoding matrix  is given by Tables 6.3.1.5-9 to  6.3.1.5-24, 6.3.1.5-29 to 6.3.1.5-36, and 6.3.1.5-39 to 6.3.1.5-47 with  representing the all-zero matrix with  rows and  columns;\n-\tthe submatrices  are given by Tables 6.3.1.5-25 to 6.3.1.5-28 and 6.3.1.5-37 to 6.3.1.5-38.\nThe TPMI index used in the tables above is obtained from the DCI scheduling the uplink transmission or the higher layer parameters according to the procedure in [6, TS 38.214]. \nWhen the higher-layer parameter txConfig is not configured, the precoding matrix .\nTable 6.3.1.5-1: Precoding matrix  for single-layer transmission using two antenna ports.\n\nTable 6.3.1.5-2: Precoding matrix  for single-layer transmission using four antenna ports with transform precoding enabled.\n\nTable 6.3.1.5-3: Precoding matrix  for single-layer transmission using four antenna ports with transform precoding disabled.\n\nTable 6.3.1.5-4: Precoding matrix  for two-layer transmission using two antenna ports with transform precoding disabled.\n\nTable 6.3.1.5-5: Precoding matrix  for two-layer transmission using four antenna ports with transform precoding disabled.\n\nTable 6.3.1.5-6: Precoding matrix  for three-layer transmission using four antenna ports with transform precoding disabled.\n\nTable 6.3.1.5-7: Precoding matrix  for four-layer transmission using four antenna ports with transform precoding disabled.\n\nTable 6.3.1.5-8: The port mapping function  for transmission using 8 antenna ports.\n\nTable 6.3.1.5-9: Intermediate precoding matrix  for codebook1=ng1n4n1 and single-layer transmission using eight antenna ports.\n\nTable 6.3.1.5-10: Intermediate precoding matrix  for codebook1=ng1n4n1 and two-layer transmission using eight antenna ports with transform precoding disabled.\n\nTable 6.3.1.5-11: Intermediate precoding matrix  for codebook1=ng1n4n1 and three-layer transmission using eight antenna ports with transform precoding disabled.\n\nTable 6.3.1.5-12: Intermediate precoding matrix  for codebook1=ng1n4n1 and four-layer transmission using eight antenna ports with transform precoding disabled.\n\nTable 6.3.1.5-13: Intermediate precoding matrix  for codebook1=ng1n4n1 and five-layer transmission using eight antenna ports with transform precoding disabled.\n\nTable 6.3.1.5-14: Intermediate precoding matrix  for codebook1=ng1n4n1 and six-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-15: Intermediate precoding matrix  for codebook1=ng1n4n1 and seven-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-16: Intermediate precoding matrix  for codebook1=ng1n4n1 and eight-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-17: Intermediate precoding matrix  for codebook1=ng1n2n2 and single-layer transmission using eight antenna ports.\n\nTable 6.3.1.5-18: Intermediate precoding matrix  for codebook1=ng1n2n2 and two-layer transmission using eight antenna ports with transform precoding disabled.\n\nTable 6.3.1.5-19: Intermediate precoding matrix  for codebook1=ng1n2n2 and three-layer transmission using eight antenna ports with transform precoding disabled.\n\nTable 6.3.1.5-20: Intermediate precoding matrix  for codebook1=ng1n2n2 and four-layer transmission using eight antenna ports with transform precoding disabled.\n\nTable 6.3.1.5-21: Intermediate precoding matrix  for codebook1=ng1n2n2 and five-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-22: Intermediate precoding matrix  for codebook1=ng1n2n2 and six-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-23: Intermediate precoding matrix  for codebook1=ng1n2n2 and seven-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-24: Intermediate precoding matrix  for codebook1=ng1n2n2 and eight-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-25: Submatrices  for codebook2 and used in Tables 6.3.1.5-29 to 6.3.1.5-31.\n\nTable 6.3.1.5-26: Submatrices  for codebook2 and used in Tables 6.3.1.5-30 to 6.3.1.5-33.\n\nTable 6.3.1.5-27: Submatrices  for codebook2 and used in Tables 6.3.1.5-31, 6.3.1.5-33, 6.3.1.5-34, and 6.3.1.5-35.\n\nTable 6.3.1.5-28: Submatrices  for codebook2 and used in Tables 6.3.1.5-32, 6.3.1.5-35, and 6.3.1.5-36.\n\nTable 6.3.1.5-29: Intermediate precoding matrix  for codebook2 and single-layer transmission using eight antenna ports.\n\nTable 6.3.1.5-30: Intermediate precoding matrix  for codebook2 and two-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-31: Intermediate precoding matrix  for codebook2 and three-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-32: Intermediate precoding matrix  for codebook2 and four-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-33: Intermediate precoding matrix  for codebook2 and five-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-34: Intermediate precoding matrix  for codebook2 and six-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-35: Intermediate precoding matrix  for codebook2 and seven-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-36: Intermediate precoding matrix  for codebook2 and eight-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-37: Submatrices  for codebook3 and used in Tables 6.3.1.5-39 to 6.3.1.5-45.\n\nTable 6.3.1.5-38: Submatrices  for codebook3 and used in Tables 6.3.1.5-40 to 6.3.1.5-46.\n\nTable 6.3.1.5-39: Intermediate precoding matrix  for codebook3 and single-layer transmission using eight antenna ports. \n\nTable 6.3.1.5-40: Intermediate precoding matrix  for codebook3 and two-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-41: Intermediate precoding matrix  for codebook3 and three-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-42: Intermediate precoding matrix  for codebook3 and four-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-43: Intermediate precoding matrix  for codebook3 and five-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-44: Intermediate precoding matrix  for codebook3 and six-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-45: Intermediate precoding matrix  for codebook3 and seven-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-46: Intermediate precoding matrix  for codebook3 and eight-layer transmission using eight antenna ports with transform precoding disabled. \n\nTable 6.3.1.5-47: Intermediate precoding matrix  for codebook4 and transmission using eight antenna ports. Up to 8 layers are supported with transform precoding disabled and up to one layer with transform precoding enabled.\n\n6.3.1.6\tMapping to virtual resource blocks\nFor each of the antenna ports used for transmission of the PUSCH, the block of complex-valued symbols  shall be multiplied with the amplitude scaling factor  in order to conform to the transmit power specified in [5, TS 38.213] and mapped in sequence starting with  to resource elements  in the virtual resource blocks assigned for transmission which meet all of the following criteria: \n-\tthey are in the virtual resource blocks assigned for transmission, and\n-\tthe corresponding resource elements in the corresponding physical resource blocks are not used for transmission of the associated DM-RS, PT-RS, or DM-RS intended for other co-scheduled UEs as described in clause 6.4.1.1.3\nThe mapping to resource elements  allocated for PUSCH according to [6, TS 38.214] shall be in increasing order of first the index  over the assigned virtual resource blocks, where  is the first subcarrier in the lowest-numbered virtual resource block assigned for transmission, and then the index , with the starting position given by [6, TS 38.214]. \n6.3.1.7\tMapping from virtual to physical resource blocks\nVirtual resource blocks shall be mapped to physical resource blocks according to non-interleaved mapping.\nFor non-interleaved VRB-to-PRB mapping for uplink resource allocation types 0 and 1 [6, TS 38.214], virtual resource block  is mapped to physical resource block  except for PUSCH scheduled by RAR UL grant or PUSCH scheduled by DCI format 0_0 with CRC scrambled by TC-RNTI in active uplink bandwidth part  starting at , including all resource blocks of the initial uplink bandwidth part starting at , and having the same subcarrier spacing and cyclic prefix as the initial uplink bandwidth part, in which case virtual resource block  is mapped to physical resource block . \nFor non-interleaved VRB-to-PRB mapping for uplink resource allocation type 2 [6, TS 38.214], virtual resource block  is mapped to physical resource block .\n6.3.2\tPhysical uplink control channel\n6.3.2.1\tGeneral\nThe physical uplink control channel supports multiple formats as shown in Table 6.3.2.1-1. In case intra-slot frequency hopping is configured for PUCCH formats 1, 3, or 4 according to clause 9.2.1 of [5, TS38.213], the number of symbols in the first hop is given by  where  is the length of the PUCCH transmission in OFDM symbols.\nTable 6.3.2.1-1: PUCCH formats.\n\n6.3.2.2\tSequence and cyclic shift hopping\nPUCCH formats 0, 1, 3, and 4 use sequences  given by clause 5.2.2 with  where the sequence group  and the sequence number  depend on the sequence hopping in clause 6.3.2.2.1 and the cyclic shift  depends on the cyclic shift hopping in clause 6.3.2.2.2.\n6.3.2.2.1\tGroup and sequence hopping\nThe sequence group  and the sequence number  within the group depends on the higher-layer parameter pucch-GroupHopping:\n-\tif pucch-GroupHopping equals 'neither'\n\n\twhere  is given by the higher-layer parameter hoppingId if configured, otherwise .\n-\tif pucch-GroupHopping equals 'enable' \n\n\twhere the pseudo-random sequence  is defined by clause 5.2.1 and shall be initialized at the beginning of each radio frame with  where  is given by the higher-layer parameter hoppingId if configured, otherwise .\n-\tif pucch-GroupHopping equals 'disable'\n\n\twhere the pseudo-random sequence  is defined by clause 5.2.1 and shall be initialized at the beginning of each radio frame with  where  is given by the higher-layer parameter hoppingId if configured, otherwise .\nThe frequency hopping index  if intra-slot frequency hopping is disabled by the higher-layer parameter intraSlotFrequencyHopping. If frequency hopping is enabled by the higher-layer parameter intraSlotFrequencyHopping,  for the first hop and  for the second hop.\n6.3.2.2.2\tCyclic shift hopping\nThe cyclic shift  varies as a function of the symbol and slot number according to\n\nwhere\n-\t is the slot number in the radio frame\n-\t is the OFDM symbol number in the PUCCH transmission where  corresponds to the first OFDM symbol of the PUCCH transmission,\n-\t is the index of the OFDM symbol in the slot that corresponds to the first OFDM symbol of the PUCCH transmission in the slot given by [5, TS 38.213]\n-\t is given by [5, TS 38.213] for PUCCH format 0 and 1 while for PUCCH format 3 and 4 is defined in clause 6.4.1.3.3.1\n-\t except for PUCCH format 0 when it depends on the information to be transmitted according to clause 9.2 of [5, TS 38.213]. \n-\t is given by\n-\t for PUCCH formats 0 and 1 if PUCCH shall use interlaced mapping according to any of the higher-layer parameters useInterlacePUCCH-PUSCH in BWP-UplinkCommon or useInterlacePUCCH-PUSCH in BWP-UplinkDedicated, where  is the resource block number within the interlace;\n-\t otherwise\nThe function  is given by\n\t\nwhere the pseudo-random sequence  is defined by clause 5.2.1. The pseudo-random sequence generator shall be initialized with , where  is given by the higher-layer parameter hoppingId if configured, otherwise .\n6.3.2.3\tPUCCH format 0\n6.3.2.3.1\tSequence generation\nThe sequence  shall be generated according to\n\nwhere  is given by clause 6.3.2.2 with  depending on the information to be transmitted according to clause 9.2 of [5, TS 38.213]. The quantity  is given by clause 9.2.1 of [5, TS 38.213].\n6.3.2.3.2\tMapping to physical resources\nThe sequence  shall be multiplied with the amplitude scaling factor  in order to conform to the transmit power specified in [5, TS 38.213] and mapped in sequence starting with  to resource elements  assigned for transmission according to clause 9.2.1 of [5, TS 38.213] in increasing order of first the index  over the assigned physical resources spanning  resource blocks, and then the index  on antenna port . \nFor interlaced transmission, the mapping operation shall be repeated for each resource block in the interlace and in the active bandwidth part over the assigned physical resource blocks according to clause 9.2.1 of [5, TS 38.213], with the resource-block dependent sequence generated according to clause 6.3.2.2.\n6.3.2.4\tPUCCH format 1\n6.3.2.4.1\tSequence modulation\nThe block of bits  shall be modulated as described in clause 5.1 using BPSK if  and QPSK if , resulting in a complex-valued symbol . \nThe complex-valued symbol  shall be multiplied with a sequence  according to\n\nwhere  is given by clause 6.3.2.2. The quantity  is given by clause 9.2.1 of [5, TS 38.213].\nThe block of complex-valued symbols  shall be block-wise spread with the orthogonal sequence  according to\n\nwhere  is given by Table 6.3.2.4.1-1. Intra-slot frequency hopping shall be assumed when the higher-layer parameter intraSlotFrequencyHopping is provided, regardless of whether the frequency-hop distance is zero or not, and interlaced mapping is not enabled, otherwise no intra-slot frequency hopping shall be assumed.\nThe orthogonal sequence  is given by Table 6.3.2.4.1-2 where  is the index of the orthogonal sequence to use according to clause 9.2.1 of [5, TS 38.213]. In case of a PUCCH transmission spanning multiple slots according to clause 9.2.6 of [5, TS38.213], the complex-valued symbol  is repeated for the subsequent slots.\nTable 6.3.2.4.1-1: Number of PUCCH symbols and the corresponding .\n\nTable 6.3.2.4.1-2: Orthogonal sequences  for PUCCH format 1. \n\n6.3.2.4.2\tMapping to physical resources\nThe sequence  shall be multiplied with the amplitude scaling factor  in order to conform to the transmit power specified in [5, TS 38.213] and mapped in sequence starting with  to resource elements  which meet all of the following criteria: \n-\tthey are in the resource blocks assigned for transmission,\n-\tthey are not used by the associated DM-RS \nThe mapping to resource elements  not reserved for other purposes shall be in increasing order of first the index  over the assigned physical resource blocks according to clause 9.2.1 of [5, TS 38.213], and then the index  on antenna port . \nFor interlaced transmission, the mapping operation shall be repeated for each resource block in the interlace and in the active bandwidth part over the assigned physical resource blocks according to clause 9.2.1 of [5, TS 38.213], with the resource-block dependent sequence generated according to clause 6.3.2.2.\n6.3.2.5\tPUCCH format 2\n6.3.2.5.1\tScrambling\nThe block of bits , where  is the number of bits transmitted on the physical channel, shall be scrambled prior to modulation, resulting in a block of scrambled bits  according to the following pseudo code\nSet i = 0\nwhile \nif \t// UCI placeholder bits\n \nelse\n \nend if \ni = i + 1\nend while\nwhere y is the tag defined in [4, TS38.212] and the scrambling sequence  is given by clause 5.2.1. The scrambling sequence generator shall be initialized with \n\nwhere\n-\t equals the higher-layer parameter dataScramblingIdentityPUSCH if configured,\n-\t otherwise\nand  is given by the C-RNTI.\n6.3.2.5.2\tModulation\nThe block of scrambled bits  shall be modulated as described in clause\u00a05.1 using QPSK, resulting in a block of complex-valued modulation symbols  where . \n6.3.2.5.2A\tSpreading\nSpreading shall be applied according to\n\nresulting in a block of complex-valued symbols .\nIf the higher layer parameter interlace1 is not configured, and the higher-layer parameter occ-Length is configured,\n-\t is given by the higher-layer parameter occ-Length; \n-\t is given by Tables 6.3.2.5A-1 and 6.3.2.5A-2 where , the quantity  is the index of the orthogonal sequence to use given by the higher-layer parameter occ-Index, and  is the interlaced resource block number as defined in clause 4.4.4.6 within the interlace given by the higher-layer parameter Interlace0.\notherwise  and \nTable 6.3.2.5A-1: Orthogonal sequences  for PUCCH format 2 when .\n\nTable 6.3.2.5A-2: Orthogonal sequences  for PUCCH format 2 when .\n\n6.3.2.5.3\tMapping to physical resources\nThe block of complex-valued symbols  shall be multiplied with the amplitude scaling factor  in order to conform to the transmit power specified in [5, TS 38.213] and mapped in sequence starting with  to resource elements  which meet all of the following criteria: \n-\tthey are in the resource blocks assigned for transmission,\n-\tthey are not used by the associated DM-RS. \nThe mapping to resource elements  not reserved for other purposes shall be in increasing order of first the index  over the assigned physical resource blocks according to clause 9.2.1 of [5, TS 38.213], and then the index  on antenna port .\n6.3.2.6\tPUCCH formats 3 and 4\n6.3.2.6.1\tScrambling\nThe block of bits , where  is the number of bits transmitted on the physical channel, shall be scrambled prior to modulation, resulting in a block of scrambled bits  according to the following pseudo code\nSet i = 0\nwhile \nif \t// UCI placeholder bits\n \nelse\n \nend if \ni = i + 1\nend while\nwhere y is the tag defined in [4, TS38.212] and the scrambling sequence  is given by clause 5.2.1. The scrambling sequence generator shall be initialized with \n\nwhere\n-\t equals the higher-layer parameter dataScramblingIdentityPUSCH if configured,\n-\t otherwise\nand  is given by the C-RNTI.\n6.3.2.6.2\tModulation\nThe block of scrambled bits  shall be modulated as described in clause\u00a05.1 using QPSK unless \u03c0/2-BPSK is configured, resulting in a block of complex-valued modulation symbols  where  for QPSK and  for \u03c0/2-BPSK. \n6.3.2.6.3\tBlock-wise spreading\nFor both PUCCH format 3 and 4,   with  representing the bandwidth of the PUCCH in terms of resource blocks according to clauses 9.2.3, 9.2.5.1 and 9.2.5.2 of [5, TS 38.213] and shall for non-interlaced mapping fulfil\n\t\nwhere  is a set of non-negative integers and . For interlaced mapping,  if a single interlace is configured and  if two interlaces are configured.\nFor PUCCH format 3, if interlaced mapping is not configured, no block-wise spreading is applied and\n\nwhere  is given by clauses 9.2.3, 9.2.5.1 and 9.2.5.2 of [5, TS 38.213] and .\nFor PUCCH format 3 with interlaced mapping and PUCCH format 4, block-wise spreading shall be applied according to \n\nwhere \n-\tfor PUCCH format 3 with interlaced mapping,  if a single interlace is configured and ,  if two interlaces are configured;\n-\tfor PUCCH format 4,  is given by the higher-layer parameter occ-Length;\nand  is given by Tables 6.3.2.6.3-1 and 6.3.2.6.3-2 for  where  is the index of the orthogonal sequence to use according to clause 9.2.1 of [5, TS 38.213]. The quantity  is given by the higher-layer parameter occ-Length if provided, otherwise .\nTable 6.3.2.6.3-1: Orthogonal sequences  for PUCCH format 3 with interlaced mapping and PUCCH format 4 when .\n\nTable 6.3.2.6.3-2: Orthogonal sequences  for PUCCH format 3 with interlaced mapping and PUCCH format 4 when .\n\n6.3.2.6.4\tTransform precoding\nThe block of complex-valued symbols  shall be transform precoded according to\n\nresulting in a block of complex-valued symbols . \n\n6.3.2.6.5\tMapping to physical resources\nThe block of modulation symbols  shall be multiplied with the amplitude scaling factor  in order to conform to the transmit power specified in [5, TS 38.213] and mapped in sequence starting with  to resource elements  which meet all of the following criteria: \n-\tthey are in the resource blocks assigned for transmission,\n-\tthey are not used by the associated DM-RS\nThe mapping to resource elements  not reserved for other purposes shall be in increasing order of first the index  over the assigned physical resource blocks according to clause 9.2.1 of [5, TS 38.213], and then the index  on antenna port . \nIn case of intra-slot frequency hopping according to clause 9.2.1 of [5, TS 38.213],  OFDM symbols shall be transmitted in the first hop and  symbols in the second hop where  is the total number of OFDM symbols used in one slot for PUCCH transmission.\n6.3.3\tPhysical random-access channel\n6.3.3.1\tSequence generation\nThe set of random-access preambles  shall be generated according to\n\nfrom which the frequency-domain representation shall be generated according to\n\nwhere , , , or  depending on the PRACH preamble format as given by Tables 6.3.3.1-1 and 6.3.3.1-2.\nThere are 64 preambles defined in each time-frequency PRACH occasion, enumerated in increasing order of first increasing cyclic shift  of a logical root sequence, and then in increasing order of the logical root sequence index, starting with the index obtained from the higher-layer parameter prach-RootSequenceIndex or rootSequenceIndex-BFR or by msgA-PRACH-RootSequenceIndex if configured and a type-2 random-access procedure is initiated as described in clause 8.1 of [5, TS 38.213]. Additional preamble sequences, in case 64 preambles cannot be generated from a single root Zadoff-Chu sequence, are obtained from the root sequences with the consecutive logical indexes until all the 64 sequences are found. The logical root sequence order is cyclic; the logical index 0 is consecutive to . The sequence number  is obtained from the logical root sequence index according to Tables 6.3.3.1-3 to 6.3.3.1-4B.\nThe cyclic shift  is given by\n\nwhere  is given by Tables 6.3.3.1-5 to 6.3.3.1-7, the higher-layer parameter msgA-RestrictedSetConfig, if provided, determines the type of restricted sets (unrestricted, restricted type A, restricted type B); otherwise, the higher-layer parameter restrictedSetConfig determines the type of restricted sets (unrestricted, restricted type A, restricted type B), and Tables 6.3.3.1-1 and 6.3.3.1-2 indicate the type of restricted sets supported for the different preamble formats. \nThe variable  is given by\n\nwhere  is the smallest non-negative integer that fulfils . The parameters for restricted sets of cyclic shifts depend on . \nFor restricted set type A, the parameters are given by:\n-\tfor \n\n-\tfor \n\nFor restricted set type B, the parameters are given by:\n-\tfor \n\n-\tfor \n\n-\tfor \n\n-\tfor \n\n-\tfor \n\n-\tfor \n\nFor all other values of , there are no cyclic shifts in the restricted set.\nTable 6.3.3.1-1: PRACH preamble formats for  and  kHz.\n\nTable 6.3.3.1-2: Preamble formats for  and  kHz where .\n\nTable 6.3.3.1-3: Mapping from logical index  to sequence number  for preamble formats with .\n\nTable 6.3.3.1-4: Mapping from logical index  to sequence number  for preamble formats with .\n\nTable 6.3.3.1-4A: Mapping from logical index  to sequence number  for preamble formats with .\n\nTable 6.3.3.1-4B: Mapping from logical index  to sequence number  for preamble formats with .\n\nTable 6.3.3.1-5:  for preamble formats with  kHz.\n\nTable 6.3.3.1-6:  for preamble formats with  kHz.\n\nTable 6.3.3.1-7:  for preamble formats with  .\n\n6.3.3.2\tMapping to physical resources\nThe preamble sequence shall be mapped to physical resources according to\n\nwhere  is an amplitude scaling factor in order to conform to the transmit power specified in [5, TS38.213], and  is the antenna port. Baseband signal generation shall be done according to clause 5.3 using the parameters in Table 6.3.3.1-1 or Table 6.3.3.1-2 with  given by Table 6.3.3.2-1.\nRandom access preambles can only be transmitted in the time resources obtained from Tables 6.3.3.2-2 to 6.3.3.2-4 and depends on FR1 or FR2 and the spectrum type as defined in [8, TS38.104]. The PRACH configuration index in Tables 6.3.3.2-2 to 6.3.3.2-4 is\n-\tfor Table 6.3.3.2-3 given by the higher-layer parameter prach-ConfigurationIndex, or by msgA-PRACH-ConfigurationIndex if configured; and\n-\tfor Tables 6.3.3.2-2 and 6.3.3.2-4 given by the higher-layer parameter prach-ConfigurationIndex, or by msgA-PRACH-ConfigurationIndex if configured.\nFor the IAB-MT part of an IAB-node, the following applies:\n-\tif the higher-layer parameter prach-ConfigurationPeriodScaling-IAB is configured, the variable  used in  of Tables 6.3.3.2-2 to 6.3.3.2-4 shall be replaced by  , where  and  is given by the higher-layer parameter prach-ConfigurationPeriodScaling-IAB and the IAB-node does not expect  to be larger than 64;\n-\tif the higher-layer parameter prach-ConfigurationFrameOffset-IAB is configured, the variable  used in  of Tables 6.3.3.2-2 to 6.3.3.2-4 shall be replaced by  where  is given by the higher-layer parameter prach-ConfigurationFrameOffset-IAB, and ;\n-\tif the higher-layer parameter prach-ConfigurationSOffset-IAB is configured, the subframe number  from Tables 6.3.3.2-2 to 6.3.3.2-3 and the slot number  from Table 6.3.3.2-4 shall be replaced by  where  is given by the higher-layer parameter prach-ConfigurationSOffset-IAB, and  is the number of subframes in a frame when using Tables 6.3.3.2-2 to 6.3.3.2-3 and the number of slots in a frame for 60 kHz subcarrier spacing when using in Table 6.3.3.2-4.\nRandom access preambles can only be transmitted in the frequency resources given by either the higher-layer parameter msg1-FrequencyStart or msgA-RO-FrequencyStart if configured as described in clause 8.1 of [5 TS 38.213]. The PRACH frequency resources , where  equals the higher-layer parameter msg1-FDM or msgA-RO-FDM if configured, are numbered in increasing order within the initial uplink bandwidth part during initial access, starting from the lowest frequency. Otherwise,  are numbered in increasing order within the active uplink bandwidth part, starting from the lowest frequency.\nFor operation with shared spectrum channel access, for , a UE expects to be provided with higher-layer parameter msg1-FrequencyStart or msgA-RO-FrequencyStart if configured, and higher-layer parameter msg1-FDM or msgA-RO-FDM if configured, such that a random-access preamble is confined within a single RB set. The UE assumes that the RB set is defined as when the UE is not provided intraCellGuardBandsPerSCS for an UL carrier as described in Clause 7 of [6, TS 38.214].\nFor operation with shared spectrum channel access, for  or  and Type-2 random access, a UE expects to be provided with higher-layer parameter msgA-RO-FDM equals to one.\nFor the purpose of slot numbering in the tables, the following subcarrier spacing shall be assumed:\n-\t15 kHz for FR1\n-\t60 kHz for FR2.\nFor handover purposes to a target cell in paired or unpaired spectrum where the target cell uses , the UE may assume the absolute value of the time difference between radio frame  in the current cell and radio frame  in the target cell is less than  if the association pattern period in clause 8.1 of [5, TS 38.213] is not equal to 10 ms.\nFor inter frequency handover purposes where the source cell is either in paired or unpaired spectrum and the target cell is in unpaired spectrum and uses , the UE may assume the absolute value of the time difference between radio frame  in the current cell and radio frame  in the target cell is less than \nTable 6.3.3.2-1: Supported combinations of  and , and the corresponding value of .\n\nTable 6.3.3.2-2: Random access configurations for FR1 and paired spectrum/supplementary uplink.\n\nTable 6.3.3.2-3: Random access configurations for FR1 and unpaired spectrum. \n\nTable 6.3.3.2-4: Random access configurations for FR2 and unpaired spectrum. \n\n6.4\tPhysical signals\n6.4.1\tReference signals\n6.4.1.1\tDemodulation reference signal for PUSCH\n6.4.1.1.1\tSequence generation\n6.4.1.1.1.1\tSequence generation when transform precoding is disabled\nIf transform precoding for PUSCH is not enabled, the sequence  shall be generated according to\n.\nwhere the pseudo-random sequence  is defined in clause 5.2.1. The pseudo-random sequence generator shall be initialized with\n\nwhere  is the OFDM symbol number within the slot,  is the slot number within a frame, and\n-\t are given by the higher-layer parameters scramblingID0 and scramblingID1, respectively, in the DMRS-UplinkConfig IE if provided and the PUSCH is scheduled by DCI format 0_1, 0_2, or 0_3, or by a PUSCH transmission with a configured grant; \n-\t is given by the higher-layer parameter scramblingID0 in the DMRS-UplinkConfig IE if provided and the PUSCH is scheduled by DCI format 0_0 with the CRC scrambled by C-RNTI, MCS-C-RNTI, or CS-RNTI; \n-\t are, for each msgA PUSCH configuration, given by the higher-layer parameters msgA-ScramblingID0 and msgA-ScramblingID1, respectively, in the msgA-DMRS-Config IE if provided and the PUSCH transmission is triggered by a Type-2 random access procedure as described in clause 8.1A of [5, TS 38.213];\n-\t  otherwise;\n-\t and  are given by\n-\tif the higher-layer parameter dmrs-Uplink in the DMRS-UplinkConfig IE is provided\n\n\twhere  is the CDM group defined in clause 6.4.1.1.3.\n-\totherwise \n\nThe quantity  is\n-\tindicated by the DM-RS initialization field, if present, either in the DCI associated with the PUSCH transmission if DCI format 0_1, 0_2, or 0_3, in [4, TS 38.212] is used;\n-\tindicated by the higher layer parameter dmrs-SeqInitialization, if present, for a Type 1 PUSCH transmission with a configured grant; \n-\tdetermined by the mapping between preamble(s) and a PUSCH occasion and the associated DMRS resource for a PUSCH transmission of Type-2 random access process in [5, TS 38.213];\n-\tdetermined by the mapping between SS/PBCH block(s) and a PUSCH occasion and the associated DMRS resource for a configured-grant based PUSCH transmission in RRC_INACTIVE state [5, TS 38.213];\n-\totherwise .\n6.4.1.1.1.2\tSequence generation when transform precoding is enabled\nIf transform precoding for PUSCH is enabled, the reference-signal sequence  shall be generated according to\n\nwhere  with  depends on the configuration:\n-\tif the higher-layer parameter dmrs-UplinkTransformPrecoding is configured, \u03c0/2-BPSK modulation is used for PUSCH, and the PUSCH transmission is not a msg3 transmission, and the transmission is not scheduled using DCI format 0_0 in a common search space,  is given by clause 5.2.3 with  given by\n\n\twhere  unless given by the DCI according to clause 7.3.1.1.2 in  [4, TS38.212] for a transmission scheduled by DCI format 0_1, or given by the DCI according to clause 7.3.1.1.3 in  [4, TS38.212] for a transmission scheduled by DCI format 0_2 if the antenna ports field in the DCI format 0_2 is not 0 bit, or given by the DCI according to clause 7.3.1.1.4 in  [4, TS38.212] for a transmission scheduled by DCI format 0_3, or given by the higher-layer parameter antennaPort for a PUSCH transmission scheduled by a type-1 configured grant; and\n-\t are given by the higher-layer parameters pi2BPSK-ScramblingID0 and pi2BPSK-ScramblingID1, respectively, in the DMRS-UplinkConfig IE if provided and the PUSCH is scheduled by DCI format 0_1, or by DCI format 0_2 if the antenna ports field in the DCI format 0_2 is not 0 bit, or by DCI format 0_3, or by a PUSCH transmission with a configured grant; \n-\t is given by the higher-layer parameter pi2BPSK-ScramblingID0 in the DMRS-UplinkConfig IE if provided and the PUSCH is scheduled by DCI format 0_0 with the CRC scrambled by C-RNTI, MCS-C-RNTI, or CS-RNTI, or by DCI format 0_2 if the antenna ports field in the DCI format 0_2 is  0 bit;\n-\t otherwise; \n-\totherwise,  is given by clause 5.2.2 with .\nThe sequence group , where  is given by\n-\t if  is configured by the higher-layer parameter nPUSCH-Identity in the DMRS-UplinkConfig IE, and \n-\tthe higher-layer parameter dmrs-UplinkTransformPrecoding is not configured or the higher-layer parameter dmrs-UplinkTransformPrecoding is configured and \u03c0/2-BPSK modulation is not used for PUSCH, and \n-\tthe PUSCH is neither scheduled by RAR UL grant nor scheduled by DCI format 0_0 with CRC scrambled by TC-RNTI according to clause 8.3 in [5, TS 38.213]; \n-\t if the higher-layer parameter dmrs-UplinkTransformPrecoding is configured, \u03c0/2-BPSK modulation is used for PUSCH, the PUSCH transmission is not a msg3 transmission, and the transmission is not scheduled using DCI format 0_0 in a common search space;\n-\t otherwise\nwhere  and the sequence number  are given by:\n-\tif neither group, nor sequence hopping is enabled\n\t\n-\tif group hopping is enabled and sequence hopping is disabled \n\t\n\twhere the pseudo-random sequence  is defined by clause 5.2.1 and shall be initialized with  at the beginning of each radio frame\n-\tif sequence hopping is enabled and group hopping is disabled\n\t\n\twhere the pseudo-random sequence  is defined by clause 5.2.1 and shall be initialized with  at the beginning of each radio frame. \nThe hopping mode is controlled by higher-layer parameters:\n-\tfor PUSCH transmission scheduled by RAR UL grant or by DCI format 0_0 with CRC scrambled by TC-RNTI, sequence hopping is disabled and group hopping is enabled or disabled by the higher-layer parameter groupHoppingEnabledTransformPrecoding;\n-\tfor all other transmissions, sequence hopping and group hopping are enabled or disabled by the respective higher-layer parameters sequenceHopping and sequenceGroupHopping if these parameters are provided, otherwise, the same hopping mode as for Msg3 shall be used.\nThe UE is not expected to handle the case of combined sequence hopping and group hopping.\nThe quantity  above is the OFDM symbol number in the slot except for the case of double-symbol DMRS in which case  is the OFDM symbol number in the slot of the first symbol of the double-symbol DMRS.\n6.4.1.1.2\t(void)\n6.4.1.1.3\tPrecoding and mapping to physical resources \nThe sequence  shall be mapped to the intermediate quantity  according to \n-\tif transform precoding is not enabled, \n-\tif the higher-layer parameter dmrs-TypeEnh is configured\n\n-\totherwise\n\n-\tif transform precoding is enabled\n\nwhere , , and  are given by Tables 6.4.1.1.3-1 and 6.4.1.1.3-2 and the configuration type is given by the higher-layer parameter DMRS-UplinkConfig, and both  and  correspond to . The intermediate quantity  if \u0394 corresponds to any other antenna ports than. \nThe intermediate quantity  shall be precoded, multiplied with the amplitude scaling factor  in order to conform to the transmit power specified in [6, TS 38.214], and mapped to physical resources according to\n\t\nwhere \n-\tthe precoding matrix  is given by clause 6.3.1.5, \n-\tthe set of antenna ports  is given by clause 6.3.1.5, and\n-\tthe set of antenna ports  is given by [6, TS 38.214];\nand the following conditions are fulfilled:\n-\tthe resource elements  are within the common resource blocks allocated for PUSCH transmission.\nThe reference point for  is \n-\tsubcarrier 0 in common resource block 0 if transform precoding is not enabled, and\n-\tsubcarrier 0 of the lowest-numbered resource block of the scheduled PUSCH allocation if transform precoding is enabled.\nThe reference point for  and the position  of the first DM-RS symbol depends on the mapping type:\n-\tfor PUSCH mapping type A: \n-\t is defined relative to the start of the slot if frequency hopping is disabled and relative to the start of each hop in case frequency hopping is enabled\n-\t is given by the higher-layer parameter dmrs-TypeA-Position\n-\tfor PUSCH mapping type B: \n-\t is defined relative to the start of the scheduled PUSCH resources if frequency hopping is disabled and relative to the start of each hop in case frequency hopping is enabled\n-\t \nThe position(s) of the DM-RS symbols is given by  and duration  where\n-\t is the duration between the first OFDM symbol of the slot and the last OFDM symbol of the scheduled PUSCH resources in the slot for PUSCH mapping type A according to Tables 6.4.1.1.3-3 and 6.4.1.1.3-4 if intra-slot frequency hopping is not used, or \n-\t is the duration of scheduled PUSCH resources for PUSCH mapping type B according to Tables 6.4.1.1.3-3 and 6.4.1.1.3-4 if intra-slot frequency hopping is not used, or\n-\t is the duration per hop according to Table 6.4.1.1.3-6 if intra-slot frequency hopping is used. \n-\tif the higher-layer parameter maxLength in DMRS-UplinkConfig is not configured, or for a msgA transmission msgA-MaxLength in msgA-DMRS-Config is not configured, the tables shall be used according to single-symbol DM-RS\n-\tif the higher-layer parameter maxLength in DMRS-UplinkConfig is equal to 'len2', the associated DCI or configured grant configuration determines whether single-symbol or double-symbol DM-RS shall be used\n-\tif the higher-layer parameter msgA-MaxLength in msgA-DMRS-Config is equal to 'len2', double-symbol DM-RS shall be used\n-\tif the higher-layer parameter dmrs-AdditionalPosition is not set to 'pos0' and intra-slot frequency hopping is enabled according to clause 7.3.1.1.2 in [4, TS 38.212] and by higher layer, Tables 6.4.1.1.3-6 shall be used assuming dmrs-AdditionalPosition is equal to 'pos1' for each hop.\nFor PUSCH mapping type A, \n-\tthe case dmrs-AdditionalPosition is equal to 'pos3' is only supported when dmrs-TypeA-Position is equal to 'pos2';\n-\t symbols in Table 6.4.1.1.3-4 is only applicable when dmrs-TypeA-Position is equal to 'pos2'.\nFor msgA transmitted using PUSCH mapping type A, \n-\tthe case msgA-DMRS-AdditionalPosition is equal to 'pos3' is only supported when dmrs-TypeA-Position is equal to 'pos2';\n-\t'dmrs-AdditionalPosition' in Tables 6.4.1.1.3-3 to 6.4.1.1.3-6 shall be replaced by msgA-DMRS-AdditionalPosition;\n-\tonly PUSCH DM-RS configuration type 1 is supported;\n-\tonly basic DM-RS multiplexing in Table 6.4.1.1.3-5 is supported.\nFor msgA transmitted using PUSCH mapping type B, \n-\t'dmrs-AdditionalPosition' in Tables 6.4.1.1.3-3 to 6.4.1.1.3-6 shall be replaced by msgA-DMRS-AdditionalPosition;\n-\tonly PUSCH DM-RS configuration type 1 is supported;\n-\tonly basic DM-RS multiplexing in Table 6.4.1.1.3-5 is supported.\nThe time-domain index , and the supported antenna ports  are given by Table 6.4.1.1.3-5. \n\nTable 6.4.1.1.3-1: Parameters for PUSCH DM-RS configuration type 1.\n\nTable 6.4.1.1.3-2: Parameters for PUSCH DM-RS configuration type 2.\n\nTable 6.4.1.1.3-3: PUSCH DM-RS positions  within a slot for single-symbol DM-RS and intra-slot frequency hopping disabled.\n\nTable 6.4.1.1.3-4: PUSCH DM-RS positions  within a slot for double-symbol DM-RS and intra-slot frequency hopping disabled.\n\nTable 6.4.1.1.3-5: PUSCH DM-RS time index .\n\nTable 6.4.1.1.3-6: PUSCH DM-RS positions  within a slot for single-symbol DM-RS and intra-slot frequency hopping enabled. \n\n6.4.1.2\tPhase-tracking reference signals for PUSCH\n6.4.1.2.1\tSequence generation\n6.4.1.2.1.1\tSequence generation if transform precoding is not enabled\nIf transform precoding is not enabled, the precoded phase-tracking reference signal for subcarrier  on layer  is given by\n\t\nwhere\n-\tantenna ports  or  associated with PT-RS transmission are given by clause 6.2.3 of [6, TS 38.214]\n-\t is given by clause 6.4.1.1.1.1 \n-\tat the position of the first DM-RS symbol in absence of PUSCH intra-slot frequency hopping\n-\tat the position of the first DM-RS symbol in hop  in presence of PUSCH intra-slot frequency hopping \n6.4.1.2.1.2\tSequence generation if transform precoding is enabled\nIf transform precoding is enabled, the phase-tracking reference signal  to be mapped in position  before transform precoding, where  depends on the number of PT-RS groups , the number of samples per PT-RS group , and  according to Table 6.4.1.2.2.2-1, shall be generated according to\n.\nwhere the pseudo-random sequence  is defined in clause 5.2.1 and  is given by Table 6.4.1.2.1.2-1. The pseudo-random sequence generator shall be initialized with\n\t\nwhere  is the lowest OFDM symbol number in the PUSCH allocation in slot  that contains PT-RS according to clause 6.4.1.2.2.2 and  is given by the higher-layer parameter nPUSCH-Identity. \nTable 6.4.1.2.1.2-1: The orthogonal sequence .\n\n6.4.1.2.2\tMapping to physical resources\n6.4.1.2.2.1\tPrecoding and mapping to physical resources if transform precoding is not enabled\nThe UE shall transmit phase-tracking reference signals only in the resource blocks used for the PUSCH, and only if the procedure in [6, TS 38.214] indicates that phase-tracking reference signals are being used.\nThe PUSCH PT-RS shall be mapped to resource elements according to\nif the higher-layer parameter dmrs-TypeEnh is configured\n\t\n\t\n-\totherwise\n\t\n\nwhen all the following conditions are fulfilled\n-\t is within the OFDM symbols allocated for the PUSCH transmission\n-\tresource element \u00a0is not used for DM-RS\n-\t and  correspond to \nThe quantities  and  are given by Tables 6.4.1.1.3-1 and 6.4.1.1.3-2, the configuration type is given by the higher-layer parameter dmrs-Type in the DMRS-UplinkConfig IE, and the precoding matrix  is given by clause 6.3.1.5. The quantity  is an amplitude scaling factor to conform with the transmit power specified in clause 6.2.2 of [6, TS 38.214].\nThe set of time indices \u00a0defined relative to the start of the PUSCH allocation is defined by\n1. set and \n2. if any symbol in the interval  overlaps with a symbol used for DM-RS according to clause 6.4.1.1.3\n-\tset \n-\tset  to the symbol index of the DM-RS symbol in case of a single-symbol DM-RS or to the symbol index of the second DM-RS symbol in case of a double-symbol DM-RS\n-\trepeat from step 2 as long as  is inside the PUSCH allocation\n3. add  to the set of time indices for PT-RS\n4. increment  by one\n5. repeat from step 2 above as long as  is inside the PUSCH allocation\nwhere  is defined in Table 6.2.3.1-1 of [6, TS 38.214].\nFor the purpose of PT-RS mapping, the resource blocks allocated for PUSCH transmission are numbered from 0 to  from the lowest scheduled resource block to the highest. The corresponding subcarriers in this set of resource blocks are numbered in increasing order starting from the lowest frequency from 0 to . The subcarriers to which the PT-RS shall be mapped are given by\n\nwhere\n-\t\n-\t is given by Table 6.4.1.2.2.1-1 for the DM-RS port associated with the PT-RS port according to clause 6.2.3 in [6, TS 38.214]. If the higher-layer parameter resourceElementOffset in PTRS-UplinkConfig is not configured, the column corresponding to 'offset00' shall be used.\n-\tis the RNTI associated with the DCI scheduling the transmission using C-RNTI, CS-RNTI, MCS-C-RNTI, SP-CSI-RNTI, or is the CS-RNTI in case of configured grant\n-\t is the number of resource blocks scheduled\n-\t is given by [6, TS 38.214].\nTable 6.4.1.2.2.1-1: The parameter  .\n\n6.4.1.2.2.2\tMapping to physical resources if transform precoding is enabled\nThe UE shall transmit phase-tracking reference signals only in the resource blocks and OFDM symbols used for the PUSCH, and only if the procedure in [6, TS 38.214] indicates that phase-tracking reference signals are being used.\nThe sequence  shall be multiplied by  and mapped to  complex valued symbols in  where\n-\t are the complex-valued symbols in OFDM symbol  before transform precoding according to clause 6.3.1.4\n-\t depends on the number of PT-RS groups , the number of samples per PT-RS group , and  according to Table 6.4.1.2.2.2-1\n-\t is the ratio between amplitude of one of the outermost constellation points for the modulation scheme used for PUSCH and one of the outermost constellation points for \u03c0/2-BPSK as defined in clause 6.2.3 of [TS 38.214]\nThe set of time indices \u00a0for which PT-RS shall be transmitted is defined relative to the start of the PUSCH allocation and is defined by\n1. set  and \n2. if any symbol in the interval  overlaps with a symbol used for DM-RS according to clause 6.4.1.1.3\n-\tset \n-\tset  to the symbol index of the DM-RS symbol in case of a single-symbol DM-RS and to the symbol index of the second DM-RS symbol in case of a double-symbol DM-RS\n-\trepeat from step 2 as long as  is inside the PUSCH allocation\n3. add  to the set of time indices for PT-RS\n4. increment  by one\n5. repeat from step 2 above as long as  is inside the PUSCH allocation\nwhere  is given by the higher-layer parameter timeDensityTransformPrecoding in the PTRS-UplinkConfig IE.\nTable 6.4.1.2.2.2-1: PT-RS symbol mapping.\n\n6.4.1.3\tDemodulation reference signal for PUCCH\n6.4.1.3.1\tDemodulation reference signal for PUCCH format 1\n6.4.1.3.1.1\tSequence generation\nThe reference signal sequence is defined by\n\nwhere  is given by Table 6.4.1.3.1.1-1,  by clause 9.2.1 of [5, TS 38.213], and the sequence  is given by clause 5.2.2. \nIntra-slot frequency hopping shall be assumed when the higher-layer parameter intraSlotFrequencyHopping is enabled, regardless of whether the frequency-hop distance is zero or not, otherwise no intra-slot frequency hopping shall be assumed.\nThe orthogonal sequence  is given by Table 6.3.2.4.1.-2 with the same index  as used in clause 6.3.2.4.1.\nTable 6.4.1.3.1.1-1: Number of DM-RS symbols and the corresponding .\n\n6.4.1.3.1.2\tMapping to physical resources\nThe sequence shall be multiplied with the amplitude scaling factor  in order to conform to the transmit power specified in [5, 38.213] and mapped in sequence starting with  to resource elements  in a slot on antenna port  according to\n\nwhere  corresponds to the first OFDM symbol of the PUCCH transmission and  shall be within the resource blocks assigned for PUCCH transmission according to [5, TS 38.213]. \nFor interlaced transmission, the mapping operation shall be repeated for each resource block in the interlace and in the active bandwidth part over the assigned physical resource blocks according to clause 9.2.1 of [5, TS 38.213], with the resource-block dependent sequence generated according to clause 6.3.2.2.\n6.4.1.3.2\tDemodulation reference signal for PUCCH format 2\n6.4.1.3.2.1\tSequence generation\nThe reference-signal sequence  shall be generated according to\n\nwhere the pseudo-random sequence  is defined in clause 5.2. The pseudo-random sequence generator shall be initialized with\n\t\nwhere  is the OFDM symbol number within the slot,  is the slot number within the radio frame, and  and  are defind in clause 6.3.2.5.2A.\nThe quantity  is given by the higher-layer parameter scramblingID0 in the DMRS-UplinkConfig IE if provided and by  otherwise. If a UE is configured with both dmrs-UplinkForPUSCH-MappingTypeA and dmrs-UplinkForPUSCH-MappingTypeB, scramblingID0 is obtained from dmrs-UplinkForPUSCH-MappingTypeB.\n6.4.1.3.2.2\tMapping to physical resources\nThe sequence shall be multiplied with the amplitude scaling factor  in order to conform to the transmit power specified in [5, 38.213] and mapped in sequence starting with  to resource elements  in a slot on antenna port  according to\n\t\t\nwhere  is defined relative to subcarrier 0 of common resource block 0 and  shall be within the resource blocks assigned for PUCCH transmission according to clause 9.2.1 of [5, TS 38.213]. \n6.4.1.3.3\tDemodulation reference signal for PUCCH formats 3 and 4\n6.4.1.3.3.1\tSequence generation\nThe reference-signal sequence  shall be generated according to\n\nwhere  is given by clause 6.3.2.6.3 and  depends on the configuration:\n-\tif the higher-layer parameter dmrs-UplinkTransformPrecodingPUCCH is configured, and -BPSK is used for PUCCH,  is given by clause 5.2.3 with  and  given by clause 6.4.1.3.2.1. The sequence group  and the sequence number  depend on the sequence hopping in clause 6.3.2.2.1.\n-\totherwise, for PUCCH format 3, PUCCH format 4 with =1, and PUCCH format 4 with >1 when -BPSK is not used for PUCCH,  is given by clause 6.3.2.2 and the cyclic shift  varies with the symbol number and slot number according to clause 6.3.2.2.2 with \n-\t for PUCCH format 3 without interlaced mapping;\n-\t obtained from Table 6.4.1.3.3.1-1 with the orthogonal sequence index  given by clause 6.3.2.6.3 for PUCCH format 3 with interlaced mapping and PUCCH format 4. \n\nTable 6.4.1.3.3.1-1: Cyclic shift index  for PUCCH format 3 with interlaced mapping and PUCCH format 4.\n\n6.4.1.3.3.2\tMapping to physical resources\nThe sequence shall be multiplied with the amplitude scaling factor , , in order to conform to the transmit power specified in [5, 38.213] and mapped in sequence starting with  to resource elements  on antenna port  according to\n\nwhere \n-\t is defined relative to subcarrier 0 of the lowest-numbered resource block assigned for PUCCH transmission, \n-\t is given by Table 6.4.1.3.3.2-1 for the case with and without intra-slot frequency hopping and with and without additional DM-RS as described in clause 9.2.1 of [TS 38.213], where  corresponds to the first OFDM symbol of the PUCCH transmission. \nThe resource elements  shall be within the resource blocks assigned for PUCCH transmission according to clause 9.2.1 of [5, TS 38.213]. \nTable 6.4.1.3.3.2-1: DM-RS positions for PUCCH format 3 and 4.\n\n6.4.1.4\tSounding reference signal\n6.4.1.4.1\tSRS resource\nAn SRS resource is configured by the SRS-Resource IE or the SRS-PosResource IE and consists of\n-\t antenna ports , where the number of antenna ports is given by the higher layer parameter nrofSRS-Ports or nrofSRS-Ports-n8 if configured, otherwise , and  when the SRS resource is in a SRS resource set with higher-layer parameter usage in SRS-ResourceSet not set to 'nonCodebook', or determined according to [6, TS 38.214] when the SRS resource is in a SRS resource set with higher-layer parameter usage in SRS-ResourceSet set to 'nonCodebook'.\n-\t, the number of hops for SRS Tx hopping for an SRS resource configured by SRS-PosResource given by the higher layer parameter SRShoppingNrofHops if configured, otherwise .\n-\t consecutive OFDM symbols given by the field nrofSymbols contained in the higher layer parameter resourceMapping. If ,  is the number of consecutive OFDM symbol per hop.\n-\t, the starting position in the time domain given by  where the offset  counts symbols backwards from the end of the slot and is given by the field startPosition contained in the higher layer parameter resourceMapping and . If   is the starting position of each hop in the time domain, determined by the field startPosition for each SRS transmission hop.\n-\t, the frequency-domain starting position of the sounding reference signal.\n6.4.1.4.2\tSequence generation\nThe sounding reference signal sequence for an SRS resource, or if SRShoppingNrofHops for SRS-PosResource is provided, for a given hop within an SRS resource, shall be generated according to\n\t\n\t\n\t\nwhere  is given by clause 6.4.1.4.3,  is given by clause 5.2.2 with  and the transmission comb number  is contained in the higher-layer parameter transmissionComb. The quantity  is the OFDM symbol number within the SRS resource.\nThe quantity  is given by\n-\tif the higher-layer parameter nrofSRS-Ports-n8 equals ports8tdm\n\n-\totherwise\n\nThe cyclic shift  for antenna port  is given as \n\nwhere\n\nwhere  is contained in the higher layer parameter transmissionComb. The maximum number of cyclic shifts  is given by Table 6.4.1.4.2-1.\nThe quantities  and  are given by\n-\tif the higher-layer parameter nrofSRS-Ports-n8 equals ports8tdm\n\n-\totherwise\n\nThe quantity  is given by\n-\tif the higher-layer parameter cyclicShiftHopping is not configured:\n\n-\tif the higher-layer parameter cyclicShiftHopping is configured:\n\n\twhere  and is the th entry and the cardinality of the set \n\n\trespectively, where  is given by the higher-layer parameter hoppingSubset in the cyclicShiftHopping IE if configured, otherwise . The higher-layer parameter hoppingSubset in the cyclicShiftHopping  IE includes a bitmap of  bits with  non-zero bits, where if the th non-zero bit is the :th bit in the bitmap, then .\n\tThe pseudo-random sequence  is defined by clause 5.2.1 and shall be initialized with  at the beginning of each radio frame for which , where the cyclic-shift hopping identity  is contained in the higher-layer parameter cyclicShiftHopping.\n\tIf the higher-layer parameter hoppingFinerGranularity is configured, , otherwise .\nThe sequence group  and the sequence number  in clause 5.2.2 depends on the higher-layer parameter groupOrSequenceHopping in the SRS-Resource IE or the SRS-PosResource IE. The SRS sequence identity  is given by the higher layer parameter sequenceId in the SRS-Resource IE, in which case , or the SRS-PosResource-r16 IE, in which case . \n-\tif groupOrSequenceHopping equals 'neither', neither group, nor sequence hopping shall be used and \n\n-\tif groupOrSequenceHopping equals 'groupHopping', group hopping but not sequence hopping shall be used and \n\n\twhere the pseudo-random sequence  is defined by clause 5.2.1 and shall be initialized with  at the beginning of each radio frame.\n-\tif groupOrSequenceHopping equals 'sequenceHopping', sequence hopping but not group hopping shall be used and\n\n\twhere the pseudo-random sequence  is defined by clause 5.2.1 and shall be initialized with  at the beginning of each radio frame. \nTable 6.4.1.4.2-1: Maximum number of cyclic shifts  as a function of .\n\n6.4.1.4.3\tMapping to physical resources\nThroughout this clause, when the higher layer parameter SRShoppingNrofHops is provided for SRS-PosResource, the sounding reference signal sequence definitions applies to a given hop.\nWhen SRS is transmitted on a given SRS resource, the sequence  for each OFDM symbol  and for each of the antenna ports of the SRS resource shall be multiplied with the amplitude scaling factor  in order to conform to the transmit power specified in [5, 38.213] and mapped in sequence starting with  to resource elements  in a slot for each of the antenna ports  according to\n\nThe length of the sounding reference signal sequence is given by\n\nwhere  is given by a selected row of Table 6.4.1.4.3-1 with  where  is given by the field b-SRS contained in the higher-layer parameter freqHopping if configured, otherwise . The row of the table is selected according to the index  given by the field c-SRS contained in the higher-layer parameter freqHopping. The quantity   is given by the higher-layer parameter FreqScalingFactor if configured, otherwise . When FreqScalingFactor is configured, the UE expects the length of the SRS sequence to be a multiple of 6.\nThe frequency-domain starting position  is defined by\n\nwhere \n\nand\n\n\n\nand\n-\t is given by the higher-layer parameter StartRBIndex if configured, otherwise ; \n-\t is given by Table 6.4.1.4.3-3 with\n\n\tif the higher-layer parameter EnableStartRBHopping is configured, otherwise .\n-\t is given by the higher-layer parameter YYY.\n-\tis the hop transmission counter in the time domain, which corresponds to the order of the higher-layer parameter SlotOffsetForRemainingHops.\n-\t is the initial hop index.\n\nThe quantity  is given by\n-\tif the higher-layer parameter combOffsetHopping is not configured:\n\n-\tif the higher-layer parameter combOffsetHopping is configured:\n\n\twhere  and is the th entry and the cardinality of the set \n\n\trespectively, where  is given by the higher-layer parameter hoppingSubset in the combOffsetHopping IE if configured, otherwise . The higher-layer parameter hoppingSubset in the combOffsetHopping IE includes a bitmap of  bits with  non-zero bits, where if the th non-zero bit is the :th bit in the bitmap, then .\n\tThe pseudo-random sequence  is defined by clause 5.2.1 and shall be initialized with  at the beginning of each radio frame for which , where the comb offset hopping identity  is contained in the higher-layer parameter combOffsetHopping.\n\tIf the higher-layer parameter hoppingWithRepetition is set to Repetition, , otherwise .\n\nIf SRShoppingNrofHops is configured:\n-\tThe reference point for  is the lowest subcarrier of the configured bandwidth for SRS with Tx hopping configured by the parameter XXX in TxhoppingBandwidth.\notherwise:\n-\tIf  the reference point for  is subcarrier 0 in common resource block 0, otherwise the reference point is the lowest subcarrier of the BWP. \nIf the SRS is configured by the IE SRS-PosResource, the quantity  is given by Table 6.4.1.4.3-2, otherwise .\nThe frequency domain shift value  adjusts the SRS allocation with respect to the reference point grid and is contained in the higher-layer parameter freqDomainShift in the SRS-Resource IE or the SRS-PosResource IE. The transmission comb offset  is contained in the higher-layer parameter transmissionComb in the SRS-Resource IE or the SRS-PosResource IE and  is a frequency position index.\nFrequency hopping of the sounding reference signal is configured by the parameter , given by the field b-hop contained in the higher-layer parameter freqHopping if configured, otherwise .\nIf , frequency hopping is disabled and the frequency position index  remains constant (unless re-configured) and is defined by\n\nfor all  OFDM symbols of the SRS resource. The quantity  is given by the higher-layer parameter freqDomainPosition if configured, otherwise , and the values of  and  for  are given by the selected row of Table 6.4.1.4.3-1 corresponding to the configured value of .\nIf , frequency hopping is enabled and the frequency position indices  are defined by\n\nwhere  is given by Table 6.4.1.4.3-1,\n\nand where  regardless of the value of . The quantity  counts the number of SRS transmissions. For the case of an SRS resource configured as aperiodic by the higher-layer parameter resourceType, it is given by  within the slot in which the  symbol SRS resource is transmitted. The quantity  is given by  if the higher-layer parameter nrofSRS-Ports-n8 equals \u2018ports8tdm\u2019, otherwise . The quantity  is the repetition factor given by the field repetitionFactor if configured, otherwise .\nFor the case of an SRS resource configured as periodic or semi-persistent by the higher-layer parameter resourceType, the SRS counter is given by\n\nfor slots that satisfy . The periodicity  in slots and slot offset  are given in clause 6.4.1.4.4.\n\nTable 6.4.1.4.3-1: SRS bandwidth configuration.\n\nTable 6.4.1.4.3-2: The offset  for SRS as a function of  and .\n\nTable 6.4.1.4.3-3: The quantity  as a function of .\n\n6.4.1.4.4\tSounding reference signal slot configuration\nThroughout this clause, when the higher layer parameter SRShoppingNrofHops is provided for SRS-PosResource, the sounding reference signal slot configuration applies to a given hop.\nFor an SRS resource configured as periodic or semi-persistent by the higher-layer parameter resourceType, a periodicity  (in slots) and slot offset  are configured according to the higher-layer parameter periodicityAndOffset-p or periodicityAndOffset-sp in the SRS-Resource IE, or periodicityAndOffset-p or periodicityAndOffset-sp in the SRS-PosResource IE. Candidate slots in which the configured SRS resource may be used for SRS transmission are the slots satisfying\n\nand, if the higher-layer parameter srs-PosHyperSFN-Index is configured for a periodicity larger than or equal to   slots, also\n\nwhere  is given by the higher-layer parameter srs-PosHyperSFN-Index and  is the hyper-frame number.\nSRS is transmitted as described in clause 6.2.1 of [6, TS 38.214].\n7\tDownlink\n7.1\tOverview\n7.1.1\tOverview of physical channels\nA downlink physical channel corresponds to a set of resource elements carrying information originating from higher layers. The following downlink physical channels are defined:\n-\tPhysical Downlink Shared Channel, PDSCH\n-\tPhysical Broadcast Channel, PBCH\n-\tPhysical Downlink Control Channel, PDCCH.\n7.1.2\tOverview of physical signals\nA downlink physical signal corresponds to a set of resource elements used by the physical layer but does not carry information originating from higher layers. \nThe following downlink physical signals are defined:\n-\tDemodulation reference signals, DM-RS\n-\tPhase-tracking reference signals, PT-RS\n-\tPositioning reference signal, PRS\n-\tChannel-state information reference signal, CSI-RS\n-\tPrimary synchronization signal, PSS\n-\tSecondary synchronization signal, SSS\n7.2\tPhysical resources\nThe frame structure and physical resources the UE shall assume when receiving downlink transmissions are defined in Clause 4.\nThe following antenna ports are defined for the downlink:\n-\tAntenna ports starting with 1000 for PDSCH\n-\tAntenna ports starting with 2000 for PDCCH\n-\tAntenna ports starting with 3000 for channel-state information reference signals\n-\tAntenna ports starting with 4000 for SS/PBCH block transmission\n-\tAntenna ports starting with 5000 for positioning reference signals \nThe UE shall not assume that two antenna ports are quasi co-located with respect to any QCL type unless specified otherwise.\nFor DM-RS associated with a PDSCH, the channel over which a PDSCH symbol on one antenna port is conveyed can be inferred from the channel over which a DM-RS symbol on the same antenna port is conveyed only if the two symbols are within the same resource as the scheduled PDSCH, in the same slot, and in the same PRG as described in clause 5.1.2.3 of [6, TS 38.214]. \nFor DM-RS associated with a PDCCH, the channel over which a PDCCH symbol on one antenna port is conveyed can be inferred from the channel over which a DM-RS symbol on the same antenna port is conveyed only if the two symbols are within resources for which the UE may assume the same precoding being used as described in clause 7.3.2.2.\nFor DM-RS associated with a PBCH, the channel over which a PBCH symbol on one antenna port is conveyed can be inferred from the channel over which a DM-RS symbol on the same antenna port is conveyed only if the two symbols are within a SS/PBCH block transmitted within the same slot, and with the same block index according to clause 7.4.3.1.\n7.3\tPhysical channels\n7.3.1\tPhysical downlink shared channel\n7.3.1.1\tScrambling\nUp to two codewords  can be transmitted. In case of single-codeword transmission, .\nFor each codeword , the UE shall assume the block of bits , where  is the number of bits in codeword  transmitted on the physical channel, are scrambled prior to modulation, resulting in a block of scrambled bits according to\n\t\nwhere the scrambling sequence  is given by clause 5.2.1. The scrambling sequence generator shall be initialized with\n\nwhere\n-\t equals the higher-layer parameter dataScramblingIdentityPDSCH if configured and the RNTI equals the C-RNTI, MCS-C-RNTI, or CS-RNTI, and the transmission is not scheduled using DCI format 1_0 in a common search space; \n-\t equals the higher-layer parameter dataScramblingIdentityPDSCH if configured in a common MBS frequency resource and the RNTI equals the G-RNTI, G-CS-RNTI, MCCH-RNTI, or multicast-MCCH-RNTI, and the transmission is scheduled using DCI in a common search space configured in the common MBS frequency resource;\n-\t equals\n-\tthe higher-layer parameter dataScramblingIdentityPDSCH if the codeword is scheduled using a CORESET with CORESETPoolIndex equal to 0;\n-\tthe higher-layer parameter dataScramblingIdentityPDSCH2 if the codeword is scheduled using a CORESET with CORESETPoolIndex equal to 1;\n\tif the higher-layer parameters dataScramblingIdentityPDSCH and dataScramblingIdentityPDSCH2 are configured together with the higher-layer parameter CORESETPoolIndex containing two different values, and the RNTI equals the C-RNTI, MCS-C-RNTI, or CS-RNTI, and the transmission is not scheduled using DCI format 1_0 in a common search space;\n-\t otherwise\nand where  corresponds to the RNTI associated with the PDSCH transmission as described in clause 5.1 of [6, TS 38.214].\n7.3.1.2\tModulation\nFor each codeword , the UE shall assume the block of scrambled bits  are modulated as described in clause\u00a05.1 using one of the modulation schemes in Table 7.3.1.2-1, resulting in a block of complex-valued modulation symbols . \nTable 7.3.1.2-1: Supported modulation schemes.\n\n7.3.1.3\tLayer mapping\nThe UE shall assume that complex-valued modulation symbols for each of the codewords to be transmitted are mapped onto one or several layers according to Table 7.3.1.3-1. Complex-valued modulation symbols  for codeword  shall be mapped onto the layers ,  where  is the number of layers and  is the number of modulation symbols per layer.\nTable 7.3.1.3-1: Codeword-to-layer mapping for spatial multiplexing.\n\n7.3.1.4\tAntenna port mapping\nThe block of vectors ,  shall be mapped to antenna ports according to\n\n\nwhere , . The set of antenna ports  shall be determined according to the procedure in [4, TS 38.212]. \n7.3.1.5\tMapping to virtual resource blocks\nThe UE shall, for each of the antenna ports used for transmission of the physical channel, assume the block of complex-valued symbols  conform to the downlink power allocation specified in [6, TS 38.214] and are mapped in sequence starting with  to resource elements  in the virtual resource blocks assigned for transmission which meet all of the following criteria: \n-\tthey are in the virtual resource blocks assigned for transmission; \n-\tthe corresponding physical resource blocks are declared as available for PDSCH according to clause 5.1.4 of [6, TS 38.214];\n-\tthe corresponding resource elements in the corresponding physical resource blocks are\n-\tnot used for transmission of the associated DM-RS or DM-RS intended for other co-scheduled UEs as described in clause 7.4.1.1.2;\n-\tnot used for non-zero-power CSI-RS, which is according to clause 7.4.1.5 and not configured by TRS-ResourceSet IE, if the corresponding physical resource blocks are for a PDSCH scheduled by a PDCCH with the CRC scrambled by C-RNTI, MCS-C-RNTI, CS-RNTI, G-RNTI for multicast, G-CS-RNTI, or a PDSCH with SPS, except if the non-zero-power CSI-RS is a CSI-RS configured by the higher-layer parameter CSI-RS-Resource-Mobility in the MeasObjectNR IE or except if the non-zero-power CSI-RS is an aperiodic non-zero-power CSI-RS resource;\n-\tnot used for PT-RS according to clause 7.4.1.2;\n-\tnot declared as 'not available for PDSCH according to clause 5.1.4 of [6, TS 38.214].\nThe mapping to resource elements  allocated for PDSCH according to [6, TS 38.214] and not reserved for other purposes shall be in increasing order of first the index  over the assigned virtual resource blocks, where  is the first subcarrier in the lowest-numbered virtual resource block assigned for transmission, and then the index . \n7.3.1.6\tMapping from virtual to physical resource blocks\nThe UE shall assume the virtual resource blocks are mapped to physical resource blocks according to the indicated mapping scheme, non-interleaved or interleaved mapping. If no mapping scheme is indicated, the UE shall assume non-interleaved mapping.\nFor non-interleaved VRB-to-PRB mapping, virtual resource block  is mapped to physical resource block , except for PDSCH transmissions scheduled with DCI format 1_0 in a common search space in which case virtual resource block  is mapped to physical resource block  where  is the lowest-numbered physical resource block in the control resource set where the corresponding DCI was received. When two PDCCH candidates from two linked common search space sets as indicated by the higher-layer parameter searchSpaceLinking are detected, and the two linked common search space sets are associated with different control resource sets, the control resource set with the lowest number among the two linked control resource sets is used to determine .\nFor interleaved VRB-to-PRB mapping, the mapping process is defined by:\n-\tResource block bundles are defined as\n-\tfor PDSCH transmissions scheduled with DCI format 1_0 with the CRC scrambled by SI-RNTI in Type0-PDCCH common search space in CORESET 0, the set of  resource blocks in CORESET 0 are divided into  resource-block bundles in increasing order of the resource-block number and bundle number where  is the bundle size and  is the size of CORESET 0.\n-\tresource block bundle  consists of  resource blocks if  and  resource blocks otherwise,\n-\tall other resource block bundles consists of  resource blocks.\n-\tfor PDSCH transmissions scheduled with DCI format 1_0 in any common search space in bandwidth part  with starting position , other than Type0-PDCCH common search space in CORESET 0, the set of  virtual resource blocks , where  is the size of CORESET 0 if CORESET 0 is configured for the cell and the size of initial downlink bandwidth part if CORESET 0 is not configured for the cell, are divided into  virtual resource-block bundles in increasing order of the virtual resource-block number and virtual bundle number and the set of  physical resource blocks  are divided into  physical resource-block bundles in increasing order of the physical resource-block number and physical bundle number, where ,  is the bundle size, and  is the lowest-numbered physical resource block in the control resource set where the corresponding DCI was received. When two PDCCH candidates from two linked search space sets as indicated by the higher-layer parameter searchSpaceLinking are detected, and the two linked search space sets are associated with different control resource sets, the control resource set with the lowest number among the two linked control resource sets is used to determine .\n-\tresource block bundle 0 consists of  resource blocks,\n-\tresource block bundle  consists of  resource blocks if  and  resource blocks otherwise,\n-\tall other resource block bundles consists of  resource blocks.\n-\tfor all other PDSCH transmissions, the set of  resource blocks in bandwidth part  with starting position  are divided into  resource-block bundles in increasing order of the resource-block number and bundle number where  is the bundle size for bandwidth part  provided by the higher-layer parameter vrb-ToPRB-Interleaver for DCI formats 1_0, 1_1, and 1_3 in a UE-specific search space, or vrb-ToPRB-InterleaverDCI-1-2 for DCI format 1_2, and\n-\tresource block bundle 0 consists of  resource blocks,\n-\tresource block bundle  consists of  resource blocks if  and  resource blocks otherwise,\n-\tall other resource block bundles consists of  resource blocks.\n-\tVirtual resource blocks in the interval  are mapped to physical resource blocks according to\n-\tvirtual resource block bundle  is mapped to physical resource block bundle \n-\tvirtual resource block bundle  is mapped to physical resource block bundle  where \n\n-\tThe UE is not expected to be configured with  simultaneously with a PRG size of 4 as defined in [6, TS 38.214]\nThe UE may assume that the same precoding in the frequency domain is used within a PRB bundle and the bundle size is determined by clause 5.1.2.3 in [6, TS 38.214]. The UE shall not make any assumption that the same precoding is used for different bundles of common resource blocks. \nFor PDSCH transmissions scheduled by DCI format 4_1 or 4_2, and using G-RNTI or G-CS-RNTI, the quantities  and   in this clause are replaced by  and , respectively, and  is the bundle size for the common MBS frequency resource provided by the higher-layer parameter vrb-ToPRB-Interleaver in pdsch-ConfigMulticast.\nFor PDSCH transmissions scheduled by DCI format 4_0, and using G-RNTI for broadcast, MCCH-RNTI, or multicast-MCCH-RNTI, the quantities  and   in this clause are replaced by  and , respectively, and .\n7.3.2\tPhysical downlink control channel (PDCCH)\n7.3.2.1\tControl-channel element (CCE)\nA physical downlink control channel consists of one or more control-channel elements (CCEs) as indicated in Table 7.3.2.1-1.\nTable 7.3.2.1-1: Supported PDCCH aggregation levels.\n\n7.3.2.2\tControl-resource set (CORESET)\nA control-resource set consists of  resource blocks in the frequency domain and  symbols in the time domain.\nA control-channel element consists of 6 resource-element groups (REGs) where a resource-element group equals one resource block during one OFDM symbol. Resource-element groups within a control-resource set are numbered in increasing order in a time-first manner, starting with 0 for the first OFDM symbol and the lowest-numbered resource block in the control resource set.\nA UE can be configured with multiple control-resource sets. Each control-resource set is associated with one CCE-to-REG mapping only.\nThe CCE-to-REG mapping for a control-resource set can be interleaved or non-interleaved and is described by REG bundles:\n-\tREG bundle  is defined as REGs  where  is the REG bundle size, , and  is the number of REGs in the CORESET\n-\tCCE  consists of REG bundles  where  is an interleaver\nFor non-interleaved CCE-to-REG mapping,  and .\nFor interleaved CCE-to-REG mapping,  for  and  for . The interleaver is defined by \n\nwhere .\nThe UE is not expected to handle configurations resulting in the quantity  not being an integer.\nFor a CORESET configured by the ControlResourceSet IE: \n-\t is given by the higher-layer parameter frequencyDomainResources;\n-\t is given by the higher-layer parameter duration, where  is supported only if the higher-layer parameter dmrs-TypeA-Position equals 3;\n-\tinterleaved or non-interleaved mapping is given by the higher-layer parameter cce-REG-MappingType;\n-\t equals 6 for non-interleaved mapping and is given by the higher-layer parameter reg-BundleSize for interleaved mapping;\n-\t is given by the higher-layer parameter interleaverSize;\n-\t is given by the higher-layer parameter shiftIndex if provided, otherwise ;\n-\tfor both interleaved and non-interleaved mapping:\n-\tif the higher-layer parameter precoderGranularity equals sameAsREG-bundle the UE may assume the same precoding being used within a REG bundle \n-\tif the higher-layer parameter precoderGranularity equals allContiguousRBs,\n-\tthe UE may assume the same precoding being used across the all resource-element groups within the set of contiguous resource blocks in the CORESET;\n-\tthe UE may assume that no resource elements in the CORESET overlap with an SSB;\n-\tif the UE is not provided with the higher-layer parameter pdcchCandidateReception-WithCRSOverlap, the UE may assume that no resource elements in the CORESET overlap with LTE cell-specific reference signals as indicated by the higher-layer parameter lte-CRS-ToMatchAround, lte-CRS-PatternList1, lte-CRS-PatternList2, lte-CRS-PatternList3, or lte-CRS-PatternList4.\nFor CORESET 0 configured by the ControlResourceSetZero IE:\n-\t and  are defined by clause 13 of [5, TS 38.213];\n-\tthe UE may assume interleaved mapping; \n-\t;\n-\t;\n-\t;\n-\tthe UE may assume normal cyclic prefix when CORESET 0 is configured by MIB or SIB1;\n-\tthe UE may assume the same precoding being used within a REG bundle.\nFor CORESET 0 on a carrier where the SS/PBCH block is detected at sync raster points defined in Tables 5.4.3.1-2 or 5.4.3.1-3 of [14, TS 38.101-1] and configured by the ControlResourceSetZero IE:\n-\t and  are defined by Table 13-0 in clause 13 of [5, TS 38.213];\n-\tif  on a carrier with a channel bandwidth of 3 MHz, the CORESET is obtained by applying the description above assuming interleaved mapping with ;\n-\tif  on a carrier with a channel bandwidth of 3 MHz, the CORESET is obtained by applying the description above assuming interleaved mapping with  or non-interleaved mapping as defined by clause 13 of [5, TS 38.213], followed by puncturing the 9 highest-numbered resource blocks to obtain the 15 resource blocks forming CORESET 0;\n-\tif  on a carrier with a channel bandwidth of 5 MHz, the CORESET is obtained by applying the description above assuming interleaved mapping with , followed by puncturing the 4 highest-numbered resource blocks to obtain the 20 resource blocks forming CORESET 0;\n-\t;\n-\t;\n-\tthe UE may assume normal cyclic prefix when CORESET 0 is configured by MIB or SIB1;\n-\tthe UE may assume the same precoding being used within a REG bundle.\n7.3.2.3\tScrambling\nThe UE shall assume the block of bits , where  is the number of bits transmitted on the physical channel, is scrambled prior to modulation, resulting in a block of scrambled bits  according to\n\nwhere the scrambling sequence  is given by clause 5.2.1. The scrambling sequence generator shall be initialized with\n\t\nwhere\n-\tfor a UE-specific search space as defined in clause 10 of [5, TS 38.213],  equals the higher-layer parameter pdcch-DMRS-ScramblingID if configured;\n-\tfor a PDCCH with the CRC scrambled by G-RNTI, G-CS-RNTI, MCCH-RNTI, or multicast-MCCH-RNTI in a common search space as defined in clause 10 of [5, TS 38.213],  equals the higher-layer parameter pdcch-DMRS-ScramblingID if configured in a common MBS frequency resource;\n-\t otherwise\nand where \n-\t is given by the C-RNTI for a PDCCH in a UE-specific search space if the higher-layer parameter pdcch-DMRS-ScramblingID is configured, and\n-\t otherwise.\n7.3.2.4\tPDCCH modulation\nThe UE shall assume the block of bits  to be QPSK modulated as described in clause\u00a05.1.3, resulting in a block of complex-valued modulation symbols .\n7.3.2.5\tMapping to physical resources\nThe UE shall assume the block of complex-valued symbols  to be scaled by a factor  and mapped to resource elements  used for the monitored PDCCH and not used for the associated PDCCH DMRS in increasing order of first , then . The antenna port .\n7.3.3\tPhysical broadcast channel\n7.3.3.1\tScrambling\nThe UE shall assume the block of bits, where  is the number of bits transmitted on the physical broadcast channel, are scrambled prior to modulation, resulting in a block of scrambled bits  according to\n\nwhere the scrambling sequence  is given by clause 5.2. The scrambling sequence shall be initialized with  at the start of each SS/PBCH block where\n-\tfor ,  is the two least significant bits of the candidate SS/PBCH block index\n-\tfor ,  is the three least significant bits of the candidate SS/PBCH block index\nwith  being the maximum number of candidate SS/PBCH blocks in a half frame, as described in [5, TS 38.213].\n7.3.3.2\tModulation\nThe UE shall assume the block of bits  are QPSK modulated as described in clause\u00a05.1.3, resulting in a block of complex-valued modulation symbols . \n7.3.3.3\tMapping to physical resources\nMapping to physical resources is described in clause 7.4.3.\n7.4\tPhysical signals\n7.4.1\tReference signals\n7.4.1.1\tDemodulation reference signals for PDSCH\n7.4.1.1.1\tSequence generation\nThe UE shall assume the sequence  is defined by\n.\nwhere the pseudo-random sequence  is defined in clause 5.2.1. The pseudo-random sequence generator shall be initialized with\n\nwhere  is the OFDM symbol number within the slot,   is the slot number within a frame, and\n-\t are given by the higher-layer parameters scramblingID0 and scramblingID1, respectively, in the DMRS-DownlinkConfig IE if provided and the PDSCH is scheduled by PDCCH using DCI format 1_1, 1_2, or 1_3 with the CRC scrambled by C-RNTI, MCS-C-RNTI, or CS-RNTI;\n-\t is given by the higher-layer parameter scramblingID0 in the DMRS-DownlinkConfig IE if provided and the PDSCH is scheduled by PDCCH using DCI format 1_0 with the CRC scrambled by C-RNTI, MCS-C-RNTI, or CS-RNTI;\n-\t are given by the higher-layer parameters scramblingID0 and scramblingID1, respectively, in the DMRS-DownlinkConfig IE if provided in a common MBS frequency resource for multicast and the PDSCH is scheduled by PDCCH using DCI format 4_2 with the CRC scrambled by G-RNTI or G-CS-RNTI;\n-\t is given by the higher-layer parameter scramblingID0 in the DMRS-DownlinkConfig IE if provided in a common MBS frequency resource and the PDSCH is scheduled by PDCCH with the CRC scrambled by G-RNTI, G-CS-RNTI, MCCH-RNTI, or multicast-MCCH-RNTI;\n-\t otherwise; \n-\t given by\n-\tif the higher-layer parameter dmrs-Downlink in the DMRS-DownlinkConfig IE is provided\n\n\n\twhere \u03bb is the CDM group defined in clause 7.4.1.1.2.\n-\totherwise by \n\n\nThe quantity  is given by the DM-RS sequence initialization field, if present, in the DCI associated with the PDSCH transmission if DCI format 1_1, 1_2, 1_3, or 4_2 in [4, TS 38.212] is used, otherwise .\n7.4.1.1.2\tMapping to physical resources\nThe UE shall assume the PDSCH DM-RS being mapped to physical resources according to configuration type 1 or configuration type 2 as given by the higher-layer parameter dmrs-Type.\nThe UE shall assume the sequence  is scaled by a factor  to conform with the transmission power specified in [6, TS 38.214] and mapped to resource elements  according to\n-\tif the higher-layer parameter dmrs-TypeEnh is configured\n\n-\totherwise\n\nwhere , , and  are given by Tables 7.4.1.1.2-1 and 7.4.1.1.2-2 and the following conditions are fulfilled:\n-\tthe resource elements are within the common resource blocks allocated for PDSCH transmission\nThe reference point for  is \n-\tsubcarrier 0 of the lowest-numbered resource block in CORESET 0 if the corresponding PDCCH is associated with CORESET 0 and Type0-PDCCH common search space and is addressed to SI-RNTI;\n-\totherwise, subcarrier 0 in common resource block 0 \nThe reference point for  and the position  of the first DM-RS symbol depends on the mapping type:\n-\tfor PDSCH mapping type A: \n-\t is defined relative to the start of the slot\n-\tif the higher-layer parameter dmrs-TypeA-Position is equal to 'pos3' and  otherwise\n-\tfor PDSCH mapping type B: \n-\t is defined relative to the start of the scheduled PDSCH resources\n-\t \nThe position(s) of the DM-RS symbols is given by  and duration  where\n-\tfor PDSCH mapping type A,  is the duration between the first OFDM symbol of the slot and the last OFDM symbol of the scheduled PDSCH resources in the slot \n-\tfor PDSCH mapping type B,  is the duration of the scheduled PDSCH resources\nand according to Tables 7.4.1.1.2-3 and 7.4.1.1.2-4. \nFor PDSCH mapping type A\n-\tthe case dmrs-AdditionalPosition equals to 'pos3' is only supported when dmrs-TypeA-Position is equal to 'pos2';\n-\t and  symbols in Tables 7.4.1.1.2-3 and 7.4.1.1.2-4 respectively is only applicable when dmrs-TypeA-Position is equal to 'pos2';\n-\tsingle-symbol DM-RS,  except if all of the following conditions are fulfilled in which case :\n-\tthe higher-layer parameter lte-CRS-ToMatchAround, lte-CRS-PatternList1, lte-CRS-PatternList2, lte-CRS-PatternList3, or lte-CRS-PatternList4 is configured; and\n-\tthe higher-layer parameter dmrs-AdditionalPosition is equal to 'pos1' and ; and\n-\tthe UE has indicated it is capable of additionalDMRS-DL-Alt \nFor PDSCH mapping type B\n-\tif the PDSCH duration   OFDM symbols for normal cyclic prefix or  OFDM symbols for extended cyclic prefix, and the front-loaded DM-RS of the PDSCH allocation collides with resources reserved for a search space set associated with a CORESET,  shall be incremented such that the first DM-RS symbol occurs immediately after the CORESET and until no collision with any CORESET occurs, and\n-\tif the PDSCH duration  is 2 symbols, the UE is not expected to receive a DM-RS symbol beyond the second symbol;\n-\tif the PDSCH duration  is 5 symbols and if one additional single-symbol DMRS is configured, the UE only expects the additional DM-RS to be transmitted on the 5th symbol when the front-loaded DM-RS symbol is in the 1st symbol of the PDSCH duration, otherwise the UE should expect that the additional DM-RS is not transmitted;\n-\tif the PDSCH duration  is 7 symbols for normal cyclic prefix or 6 symbols for extended cyclic prefix: \n-\tif one additional single-symbol DM-RS is configured, the UE only expects the additional DM-RS to be transmitted on the 5th or 6th symbol when the front-loaded DM-RS symbol is in the 1st or 2nd symbol, respectively, of the PDSCH duration, otherwise the UE should expect that the additional DM-RS is not transmitted;\n-\tif the PDSCH duration   OFDM symbols, the UE is not expected to receive the front-loaded DM-RS beyond the 4th symbol;\n-\tif the PDSCH duration  is 12 or 13 symbols, the UE is not expected to receive DM-RS mapped to symbol 12 or later in the slot;\n-\tfor all values of the PDSCH duration  other than 2, 5, and 7 symbols, the UE is not expected to receive DM-RS beyond the :th symbol;\n-\tif the PDSCH duration  is less than or equal to 4 OFDM symbols, only single-symbol DM-RS is supported. \n-\tif the higher-layer parameter lte-CRS-ToMatchAround, lte-CRS-PatternList1, lte-CRS-PatternList2, lte-CRS-PatternList3, or lte-CRS-PatternList4 is configured, the PDSCH duration  symbols for normal cyclic prefix, the subcarrier spacing configuration , single-symbol DM-RS is configured, and at least one PDSCH DM-RS symbol in the PDSCH allocation collides with a symbol containing resource elements as indicated by the higher-layer parameter lte-CRS-ToMatchAround, lte-CRS-PatternList1, lte-CRS-PatternList2, lte-CRS-PatternList3, or lte-CRS-PatternList4, then  shall be incremented by one in all slots.\nThe time-domain index  and the supported antenna ports  are given by Table 7.4.1.1.2-5 where \n-\tsingle-symbol DM-RS is used if the higher-layer parameter maxLength in the DMRS-DownlinkConfig IE is not configured;\n-\tsingle-symbol or double-symbol DM-RS is determined by the associated DCI if the higher-layer parameter maxLength in the DMRS-DownlinkConfig IE is equal to 'len2';\n-\tbasic or enhanced DM-RS multiplexing is controlled by the higher-layer parameter dmrs-TypeEnh.\nIn absence of CSI-RS configuration, and unless otherwise configured, the UE may assume PDSCH DM-RS and SS/PBCH block to be quasi co-located with respect to Doppler shift, Doppler spread, average delay, delay spread, and, when applicable, spatial Rx parameters. Unless specified otherwise, the UE may assume that the PDSCH DM-RS within the same CDM group are quasi co-located with respect to Doppler shift, Doppler spread, average delay, delay spread, and spatial Rx (when applicable). The UE may assume that DMRS ports associated with a TCI state as described in clause 5.1.6.2 of [6, TS 38.214] of a PDSCH are QCL with QCL Type A, Type D (when applicable) and average gain.\nThe UE may assume that no DM-RS collides with the SS/PBCH block.\nTable 7.4.1.1.2-1: Parameters for PDSCH DM-RS configuration type 1.\n\nTable 7.4.1.1.2-2: Parameters for PDSCH DM-RS configuration type 2.\n\nTable 7.4.1.1.2-3: PDSCH DM-RS positions  for single-symbol DM-RS.\n\nTable 7.4.1.1.2-4: PDSCH DM-RS positions  for double-symbol DM-RS.\n\nTable 7.4.1.1.2-5: PDSCH DM-RS time index  and antenna ports .\n\n7.4.1.2\tPhase-tracking reference signals for PDSCH\n7.4.1.2.1\tSequence generation\nThe phase-tracking reference signal for subcarrier  is given by\n-\tIf the higher-layer parameter dmrs-TypeEnh is configured\n\t\n-\totherwise\n\t\nwhere  is the demodulation reference signal given by clause 7.4.1.1.2 at position  and subcarrier .\n7.4.1.2.2\tMapping to physical resources\nThe UE shall assume phase-tracking reference signals being present only in the resource blocks used for the PDSCH, and only if the procedure in [6, TS 38.214] indicates phase-tracking reference signals being used.\nIf present, the UE shall assume the PDSCH PT-RS is scaled by a factor  to conform with the transmission power specified in clause 4.1 of [6, TS 38.214] and mapped to resource elements according to\n\nwhen all the following conditions are fulfilled\n-\t is within the OFDM symbols allocated for the PDSCH transmission\n-\tresource element    is not used for DM-RS, non-zero-power CSI-RS (except for those configured for mobility measurements or with resourceType in corresponding CSI-ResourceConfig configured as 'aperiodic'), zero-power CSI-RS, SS/PBCH block, a detected PDCCH according to clause 5.1.4.1 of [6, TS38.214], or is declared as 'not available' by clause 5.1.4 of [6, TS 38.214]\nThe set of time indices  defined relative to the start of the PDSCH allocation is defined by\n1.\tset  and \n2.\tif any symbol in the interval  overlaps with a symbol used for DM-RS according to clause 7.4.1.1.2\n-\tset \n-\tset  to the symbol index of the DM-RS symbol in case of a single-symbol DM-RS and to the symbol index of the second DM-RS symbol in case of a double-symbol DM-RS\n-\trepeat from step 2 as long as  is inside the PDSCH allocation\n3.\tadd  to the set of time indices for PT-RS\n4.\tincrement  by one\n5.\trepeat from step 2 above as long as  is inside the PDSCH allocation\nwhere .\nFor the purpose of PT-RS mapping, the resource blocks allocated for PDSCH transmission are numbered from 0 to  from the lowest scheduled resource block to the highest. The corresponding subcarriers in this set of resource blocks are numbered in increasing order starting from the lowest frequency from 0 to . The subcarriers to which the UE shall assume the PT-RS is mapped are given by\n\nwhere \n-\t\n-\t is given by Table 7.4.1.2.2-1 for the DM-RS port associated with the PT-RS port according to clause 5.1.6.3 in [6, TS 38.214]. If the higher-layer parameter resourceElementOffset in the PTRS-DownlinkConfig IE is not configured, the column corresponding to 'offset00' shall be used.\n-\t is the RNTI associated with the DCI scheduling the transmission\n-\t is the number of resource blocks scheduled\n-\t is given by [6, TS 38.214].\nTable 7.4.1.2.2-1: The parameter .\n\n7.4.1.3\tDemodulation reference signals for PDCCH\n7.4.1.3.1\tSequence generation\nThe UE shall assume the reference-signal sequence  for OFDM symbol  is defined by\n.\nwhere the pseudo-random sequence  is defined in clause 5.2.1. The pseudo-random sequence generator shall be initialized with\n\t\nwhere  is the OFDM symbol number within the slot,  is the slot number within a frame, and\n-\t is given by the higher-layer parameter pdcch-DMRS-ScramblingID if provided;\n-\t is given by the higher-layer parameter pdcch-DMRS-ScramblingID if configured for a common search space in a common MBS frequency resource;\n-\t otherwise.\n7.4.1.3.2\tMapping to physical resources\nThe UE shall assume the sequence  is mapped to resource elements  according to\n\nwhere the following conditions are fulfilled\n-\tthey are within the resource element groups constituting the PDCCH the UE attempts to decode if the higher-layer parameter precoderGranularity equals sameAsREG-bundle,\n-\tall resource-element groups within the set of contiguous resource blocks in the CORESET where the UE attempts to decode the PDCCH if the higher-layer parameter precoderGranularity equals allContiguousRBs.\nThe reference point for  is \n-\tsubcarrier 0 of the lowest-numbered resource block in the CORESET if the CORESET is configured by the PBCH or by the controlResourceSetZero field in the PDCCH-ConfigCommon IE,\n-\tsubcarrier 0 in common resource block 0 otherwise\nThe quantity  is the OFDM symbol number within the slot.\nThe antenna port .\nA UE not attempting to detect a PDCCH in a CORESET shall not make any assumptions on the presence or absence of DM-RS in the CORESET.\nIn absence of CSI-RS configuration, and unless otherwise configured, the UE may assume PDCCH DM-RS and SS/PBCH block to be quasi co-located with respect to Doppler shift, Doppler spread, average delay, delay spread, and, when applicable, spatial Rx parameters.\n7.4.1.4\tDemodulation reference signals for PBCH\n7.4.1.4.1\tSequence generation\nThe UE shall assume the reference-signal sequence  for an SS/PBCH block is defined by\n\nwhere  is given by clause 5.2. The scrambling sequence generator shall be initialized at the start of each SS/PBCH block occasion with \n\nwhere\n-\tfor ,  where  is the number of the half-frame in which the PBCH is transmitted in a frame with  for the first half-frame in the frame and  for the second half-frame in the frame, and  is the two least significant bits of the candidate SS/PBCH block index as defined in [5, TS 38.213]\n-\tfor ,  where  is the three least significant bits of the candidate SS/PBCH block index as defined in [5, TS 38.213]\nwith  being the maximum number of candidate SS/PBCH blocks in a half frame, as described in [5, TS 38.213]. \n7.4.1.4.2\tMapping to physical resources\nMapping to physical resources is described in clause 7.4.3.\n7.4.1.5\tCSI reference signals\n7.4.1.5.1\tGeneral\nZero-power (ZP) and non-zero-power (NZP) CSI-RS are defined\n-\tfor a non-zero-power CSI-RS configured by the NZP-CSI-RS-Resource IE or by the CSI-RS-Resource-Mobility field in the CSI-RS-ResourceConfigMobility IE or by the TRS-ResourceSet IE, the sequence shall be generated according to clause 7.4.1.5.2 and mapped to resource elements according to clause 7.4.1.5.3\n-\tfor a zero-power CSI-RS configured by the ZP-CSI-RS-Resource IE, the UE shall assume that the resource elements defined in clause 7.4.1.5.3 are not used for PDSCH transmission subject to clause 5.1.4.2 of [6, TS 38.214]. The UE performs the same measurement/reception on channels/signals except PDSCH regardless of whether they collide with ZP CSI-RS or not. \n7.4.1.5.2\tSequence generation\nThe UE shall assume the reference-signal sequence  is defined by\n\nwhere the pseudo-random sequence  is defined in clause 5.2.1. The pseudo-random sequence generator shall be initialised with\n\nat the start of each OFDM symbol where  is the slot number within a radio frame,  is the OFDM symbol number within a slot, and  equals the higher-layer parameter scramblingID or sequenceGenerationConfig.\n7.4.1.5.3\tMapping to physical resources\nFor each CSI-RS configured, the UE shall assume the sequence  being mapped to resources elements  according to \n\nwhen the following conditions are fulfilled:\n-\tthe resource element  is within the resource blocks occupied by the CSI-RS resource for which the UE is configured\nThe reference point for  is subcarrier 0 in common resource block 0.\nThe value of  is given by the higher-layer parameter density in the CSI-RS-ResourceMapping IE or the CSI-RS-CellMobility IE and the number of ports  is given by the higher-layer parameter nrofPorts. For NZP CSI-RS configured by the TRS-ResourceSet IE, the density  and number of ports .\nThe UE is not expected to receive CSI-RS and DM-RS on the same resource elements.\nThe UE shall assume  for a non-zero-power CSI-RS where  is selected such that the power offset specified by the higher-layer parameter powerControlOffsetSS in the NZP-CSI-RS-Resource IE or in the TRS-ResourceSet IE, if provided, is fulfilled.\nThe quantities , , , and  are given by Tables 7.4.1.5.3-1 to 7.4.1.5.3-5 where each  in a given row of Table 7.4.1.5.3-1 corresponds to a CDM group of size 1 (no CDM) or size 2, 4, or 8. The CDM type is provided by the higher layer parameter cdm-Type in the CSI-RS-ResourceMapping IE. For NZP CSI-RS configured by the TRS-ResourceSet IE, the CDM type is 'noCDM'. The indices  and  index resource elements within a CDM group.\nThe time-domain locations  and  are provided by the higher-layer parameters firstOFDMSymbolInTimeDomain and firstOFDMSymbolInTimeDomain2, respectively, in the CSI-RS-ResourceMapping IE or the CSI-RS-ResourceConfigMobility IE and defined relative to the start of a slot. For NZP CSI-RS configured by TRS-ResourceSet IE, the time-domain location  is provided by the higher-layer parameter firstOFDMSymbolInTimeDomain or firstOFDMSymbolInTimeDomain+4.\nThe frequency-domain location is given by a bitmap provided by the higher-layer parameter frequencyDomainAllocation in the CSI-RS-ResourceMapping IE, the CSI-RS-ResourceConfigMobility IE, or the TRS-ResourceSet IE, with the bitmap and value of  in Table 7.4.1.5.3-1 given by\n-\t,  for row 1 of Table 7.4.1.5.3-1\n-\t,  for row 2 of Table 7.4.1.5.3-1\n-\t,  for row 4 of Table 7.4.1.5.3-1\n-\t,  for all other cases\nwhere  is the bit number of the  bit in the bitmap set to one, repeated across every  of the resource blocks configured for CSI-RS reception by the UE. The starting position and number of the resource blocks in which the UE shall assume that CSI-RS is transmitted are given by the higher-layer parameters freqBand and density in the CSI-RS-ResourceMapping IE for the bandwidth part given by the higher-layer parameter BWP-Id in the CSI-ResourceConfig IE or given by the higher-layer parameters nrofPRBs in the CSI-RS-CellMobility IE where the the startPRB given by csi-rs-MeasurementBW is relative to common resource block 0. For NZP CSI-RS configured by TRS-ResourceSet IE, the starting position and number of the resource blocks in which the CSI-RS can be transmitted are given by the higher-layer parameters nrofRBs, and startingRB in the TRS-ResourceSet IE, where startingRB is relative to common resource block 0 and the density .\nThe UE shall assume that a CSI-RS is transmitted using antenna ports  numbered according to\n\t\nwhere  is the sequence index provided by Tables 7.4.1.5.3-2 to 7.4.1.5.3-5,  is the CDM group size, and  is the number of CSI-RS ports. The CDM group index  given in Table 7.4.1.5.3-1 corresponds to the time/frequency locations  for a given row of the table. The CDM groups are numbered in order of increasing frequency domain allocation first and then increasing time domain allocation. \nFor a CSI-RS resource configured as periodic or semi-persistent by the higher-layer parameter resourceType, configured by the higher-layer parameter CSI-RS-CellMobility or configured by the higher-layer parameter TRS-ResourceSet-r17, the UE shall assume that the CSI-RS is transmitted in slots satisfying\n\nwhere the periodicity  (in slots) and slot offset  are obtained from the higher-layer parameter CSI-ResourcePeriodicityAndOffset, slotConfig or periodicityAndOffset-r17. The UE shall assume that CSI-RS is transmitted in a candidate slot as described in clause 11.1 of [5, TS 38.213], clause 10.4B of [5, TS 38.213]. \nThe UE may assume that antenna ports within a CSI-RS resource are quasi co-located with QCL Type A, Type D (when applicable), and average gain.\n\nTable 7.4.1.5.3-1: CSI-RS locations within a slot.\n\nTable 7.4.1.5.3-2: The sequences  and  for cdm-Type equal to 'noCDM'.\n\nTable 7.4.1.5.3-3: The sequences  and  for cdm-Type equal to 'fd-CDM2'.\n\nTable 7.4.1.5.3-4: The sequences  and  for cdm-Type equal to 'cdm4-FD2-TD2'.\n\nTable 7.4.1.5.3-5: The sequences  and  for cdm-Type equal to 'cdm8-FD2-TD4'.\n\n7.4.1.6\tRIM reference signals\n7.4.1.6.1\tGeneral\nRIM-RS can be used by an gNB to measure inter-cell interference and to provide information about the experienced interference to other gNBs. Up to two different types of RIM-RS can be configured where \n-\tthe first RIM-RS type can be used to convey information,\n-\tthe second RIM-RS type depends on configuration only.\n7.4.1.6.2\tSequence generation\nThe RIM-RS receiver shall assume the reference-signal sequence  is defined by\n\t\nwhere the pseudo-random sequence  is defined in clause 5.2.1. The pseudo-random sequence generator shall be initialised with \n\t\nwhere\n-\t is given by clause 7.4.1.6.4.4; \n-\t where the pseudo-random sequence  is given by clause 5.2.1,  initialized with  where the multiplier factor  and the offset ;\n-\t is the number of RIM-RS transmission periods since  where \n-\t is the time in seconds relative to  of 00:00:00 on 1 January 1900, calculated as continuous time without leap second and traceable to a common time reference, and\n-\t is the RIM-RS transmission periodicity in seconds assuming that the first RIM-RS transmission period starts at , and where   is given by clause 7.4.1.6.4.2.\n7.4.1.6.3\tMapping to physical resources\nThe RIM-RS receiver shall assume the reference signal being mapped to physical resources according to\n\t\n\t\nwhere   is an amplitude scaling factor in order to control the RIM-RS transmission power and  is the antenna port. Baseband signal generation shall be done according to clause 5.3.3.\nThe starting position  for RIM-RS type  in slot  in a frame is given by\n\t\nin slots satisfying\n\t\nwhere\n-\t counts the number of times the SFN periods within the RIM-RS transmission period;\n-\t where  is the symbol offset of the reference point after the starting boundary of the uplink-downlink switching period in which the RIM-RS is mapped to and  is obtained as described in clause 7.4.1.6.4.2;\n-\t is the total number of slots in a RIM-RS transmission period as defined in clause 7.4.1.6.4.2;\n-\t is the slot offset of the uplink-downlink switching period with index  with respect to the starting boundary of the RIM-RS transmission period and is defined in clause 7.4.1.6.4.2;\n-\t is the RIM-RS transmission periodicity in units of uplink-downlink switching period as defined in clause 7.4.1.6.4.2. \n7.4.1.6.4\tRIM-RS configuration\n7.4.1.6.4.1\tGeneral\nA resource for RIM-RS transmission is defined by the indices , , and  used as indices into configured lists of time, frequency, and sequence parameters, respectively.\nAll RIM-RS resources occupy the same number of resource blocks, . At most 32 RIM-RS resources can be configured within a 10\u00a0ms period.\n7.4.1.6.4.2\tTime-domain parameters and mapping from  to time-domain parameters\nRIM-RS are transmitted periodically with the RIM-RS transmission period  defined in units of the uplink-downlink switching period determined from one or two configured uplink-downlink periods. \n-\tIf a single uplink-downlink period is configured for RIM-RS purposes, \n-\t is the RIM-RS transmission periodicity in terms of uplink-downlink switching periods given by\n\nwhere  ms;\n-\t is the total number of slots in a RIM-RS transmission period;\n-\t is the slot offset of the uplink-downlink switching period with index  with respect to the starting boundary of the RIM-RS transmission period \n-\tIf two uplink-downlink periods are configured for RIM-RS purposes, \n-\t is the RIM-RS transmission periodicity in terms of  pairs of uplink-downlink switching periods and is given by\n\n\twhere each pair consists of a first period of  ms and a second period of  ms and where \u00a0divides 20\u00a0ms;\n-\t is the total number of slots in a RIM-RS transmission period;\n-\t is the slot offset of the uplink-downlink switching period with index  with respect to the starting boundary of the RIM-RS transmission period \nThe intermediate quantity  is given by\n\nwhere \n-\t and  are the total number of setIDs for RIM-RS type 1 and RIM-RS type 2, respectively;\n-\t is the number of candidate frequency resources configured in the network;\n-\t is the number of candidate sequences assigned for RIM-RS type  in the network;\n-\t and  are the number of consecutive uplink-downlink switching periods for RIM-RS type 1 and RIM-RS type 2, respectively. If near-far functionality is not configured, , otherwise  and the first and second half of the  consecutive uplink-downlink switching periods are for near functionality and far functionality, respectively.\nThe quantity  is obtained from entry  in a list of configured symbol offsets for RIM-RS .\n7.4.1.6.4.3\tFrequency-domain parameters and mapping from  to frequency-domain parameters\nThe frequency-domain parameter  in clause 5.3.3 is the frequency offset relative to a configured reference point for RIM-RS and is obtained from entry  in a list of configured frequency offsets expressed in units of resource blocks. \nThe number of candidate frequency resources configured in the network, , shall fulfil\n\nIf , the frequency difference between any pair of configured frequency offsets in the list is not smaller than . \nThe number of resource blocks for RIM-RS is given by \n\n7.4.1.6.4.4\tSequence parameters and mapping from  to sequence parameters\nThe scrambling identity  clause 7.4.1.6.2 is obtained from entry  in a list of configured scrambling identities.\n7.4.1.6.4.5\tMapping between resource triplet and set ID\nThe resource indices , , and  are determined from the index  in the set ID  according to\n\nwhere\n-\t is given by\n\n-\t is the number of candidate frequency resources configured in the network;\n-\t is the number of sequence candidates for the current RIM-RS resource given by\n\n-\t is the starting time offset given by\n\n-\t is given by\n\nwhere  is the number of candidate sequences assigned for RIM-RS type 1\n-\t is the number of consecutive uplink-downlink periods for RIM-RS type  as given by clause 7.4.1.6.4.2;\n-\t.\nThe set ID is determined from the resource triplet according to\n\n7.4.1.7\tPositioning reference signals\n7.4.1.7.1\tGeneral\nA positioning frequency layer consists of one or more downlink PRS resource sets, each of which consists of one or more downlink PRS resources as described in [6, TS 38.214].\n7.4.1.7.2\tSequence generation\nThe UE shall assume the reference-signal sequence  is defined by\n\nwhere the pseudo-random sequence  is defined in clause 5.2.1. The pseudo-random sequence generator shall be initialised with\n\nwhere  is the slot number, the downlink PRS sequence ID  is given by the higher-layer parameter dl-PRS-SequenceID, and  is the OFDM symbol within the slot to which the sequence is mapped.\n7.4.1.7.3\tMapping to physical resources in a downlink PRS resource\nFor each downlink PRS resource configured, the UE shall assume the sequence  is scaled with a factor  and mapped to resources elements  according to \n\nwhen the following conditions are fulfilled:\n-\tthe resource element  is within the resource blocks occupied by the downlink PRS resource for which the UE is configured;\n-\tthe symbol  is not used by any SS/PBCH block used by a serving cell for downlink PRS transmitted from the same serving cell or any SS/PBCH block from a non-serving cell whose time frequency location is provided to the UE by higher layers for downlink PRS transmitted from the same non-serving cell;\n-\tthe slot number satisfies the conditions in clause 7.4.1.7.4.\nand where \n-\tthe antenna port \n-\t is the first symbol of the downlink PRS within a slot and given by the higher-layer parameter dl-PRS-ResourceSymbolOffset;\n-\tthe size of the downlink PRS resource in the time domain  is given by the higher-layer parameter dl-PRS-NumSymbols;\n-\tthe comb size  is given by the higher-layer parameter dl-PRS-CombSizeN-AndReOffset for a downlink PRS resource configured for RTT-based propagation delay compensation, otherwise by the higher-layer parameter dl-PRS-CombSizeN such that the combination  is one of {1, 2}, {2, 2},{4, 2}, {6, 2}, {12, 2}, {1, 4}, {4, 4}, {12, 4}, {1, 6}, {6, 6}, {12, 6}, {1, 12} and {12, 12};\n-\tthe resource-element offset  is obtained from the higher-layer parameter dl-PRS-CombSizeN-AndReOffset;\n-\tthe quantity  is given by Table 7.4.1.7.3-1.\nIf the downlink PRS resource is configured for RTT based propagation delay compensation as described in clause 9 of [6, TS 38.214], the reference point for  is subcarrier 0 in common resource block 0; Otherwise, the reference point for  is the location of the point A of the positioning frequency layer, in which the downlink PRS resource is configured where point A is given by the higher-layer parameter dl-PRS-PointA.\nTable 7.4.1.7.3-1: The frequency offset  as a function of .\n\n7.4.1.7.4\tMapping to slots in a downlink PRS resource set\nFor a downlink PRS resource in a downlink PRS resource set, the UE shall assume the downlink PRS resource being transmitted when the slot and frame numbers fulfil\n\nand one of the following conditions are fulfilled:\n-\tthe higher-layer parameters dl-PRS-MutingOption1 and dl-PRS-MutingOption2 are not provided;\n-\tthe higher-layer parameter dl-PRS-MutingOption1 is provided with bitmap  but dl-PRS-MutingOption2 with bitmap  is not provided, and bit  is set;\n-\tthe higher-layer parameter dl-PRS-MutingOption2 is provided with bitmap  but dl-PRS-MutingOption1 with bitmap  is not provided, and bit  is set;\n-\tthe higher-layer parameters dl-PRS-MutingOption1 with bitmap  and dl-PRS-MutingOption2 with  are both provided, and both bit  and  are set.\nwhere\n-\t is bit  in the bitmap given by the higher-layer parameter dl-PRS-MutingOption1 where  is the size of the bitmap; \n-\t is bit  in the bitmap given by the higher-layer parameter dl-PRS-MutingOption2;\n-\tthe periodicity  and the slot offset  are given by the higher-layer parameter dl-PRS-Periodicity-and-ResourceSetSlotOffset;\n-\tthe downlink PRS resource slot offset  is given by the higher-layer parameter dl-PRS-ResourceSlotOffset; \n-\tthe repetition factor  is given by the higher-layer parameter dl-PRS-ResourceRepetitionFactor;\n-\tthe muting repetition factor  is given by the higher-layer parameter dl-PRS-MutingBitRepetitionFactor;\n-\tthe time gap  is given by the higher-layer parameter dl-PRS-ResourceTimeGap;\nFor a downlink PRS resource in a downlink PRS resource set configured for RTT-based propagation delay compensation, the UE shall assume the downlink PRS resource being transmitted as described in clause 9 of [6, TS 38.214]; otherwise, the UE shall assume the downlink PRS resource being transmitted as described in clause 5.1.6.5 of [6, TS 38.214].\n7.4.2\tSynchronization signals\n7.4.2.1\tPhysical-layer cell identities\nThere are 1008 unique physical-layer cell identities given by\n\t\nwhere  and .\n7.4.2.2\tPrimary synchronization signal\n7.4.2.2.1\tSequence generation\nThe sequence  for the primary synchronization signal is defined by \n\t\nwhere\n\t\nand\n\t\n7.4.2.2.2\tMapping to physical resources\nMapping to physical resources is described in clause 7.4.3.\n7.4.2.3\tSecondary synchronization signal\n7.4.2.3.1\tSequence generation\nThe sequence  for the secondary synchronization signal is defined by \n\nwhere\n\t\nand\n\t\n7.4.2.3.2\tMapping to physical resources\nMapping to physical resources is described in clause 7.4.3.\n7.4.3\tSS/PBCH block \n7.4.3.1\tTime-frequency structure of an SS/PBCH block\nIn the time domain, an SS/PBCH block consists of 4 OFDM symbols, numbered in increasing order from 0 to 3 within the SS/PBCH block, where PSS, SSS, and PBCH with associated DM-RS are mapped to symbols as given by Table 7.4.3.1-1. \nIn the frequency domain, an SS/PBCH block consists of 240 contiguous subcarriers with the subcarriers numbered in increasing order from 0 to 239 within the SS/PBCH block. The quantities  and  represent the frequency and time indices, respectively, within one SS/PBCH block. The UE may assume that the complex-valued symbols corresponding to resource elements denoted as 'Set to 0' in Table 7.4.3.1-1 are set to zero. The quantity  in Table 7.4.3.1-1 is given by . The quantity  is the subcarrier offset from subcarrier 0 in common resource block  to the lowest-numbered subcarrier of the SS/PBCH block, or the SS/PBCH block after puncturing if applicable, where  is obtained from the higher-layer parameter offsetToPointA. \n-\tFor operation with shared spectrum channel access in FR2-2 and for operation without shared spectrum channel access, the 4 least significant bits of  are given by the higher-layer parameter ssb-SubcarrierOffset and for FR1 the most significant bit of  is given by  in the PBCH payload as defined in clause 7.1.1 of [4, TS 38.212]. \n-\tFor operation with shared spectrum channel access in FR1, the 4 least significant bits of  are given by the higher-layer parameter ssb-SubcarrierOffset and the most significant bit of  is given by  in the PBCH payload as defined in clause 7.1.1 of [4, TS 38.212]. If  ,  ; otherwise, .\nIf ssb-SubcarrierOffset is not provided,  is derived from the frequency difference between the SS/PBCH block and Point A.\nThe UE may assume that the complex-valued symbols corresponding to resource elements that are part of a common resource block partially or fully overlapping with an SS/PBCH block, or an SS/PBCH block after puncturing if applicable, and not used for SS/PBCH transmission are set to zero in the OFDM symbols partially or fully overlapping with OFDM symbols where SS/PBCH is transmitted. \nFor an SS/PBCH block, the UE shall assume \n-\tantenna port  is used for transmission of PSS, SSS, PBCH and DM-RS for PBCH,\n-\tthe same cyclic prefix length and subcarrier spacing for the PSS, SSS, PBCH and DM-RS for PBCH,\n-\tfor SS/PBCH block type A,  and  with the quantities , and  expressed in terms of 15\u00a0kHz subcarrier spacing, and\n-\tfor SS/PBCH block type B in FR2-1,  and  with the quantity  expressed in terms of the subcarrier spacing provided by the higher-layer parameter subCarrierSpacingCommon and  expressed in terms of 60\u00a0kHz subcarrier spacing; \n-\tfor SS/PBCH block type B in FR2-2,  and  with the quantity  expressed in terms of the SS/PBCH block subcarrier spacing and  expressed in terms of 60\u00a0kHz subcarrier spacing; \n-\tthe centre of subcarrier 0 of resource block   coincides with the centre of subcarrier 0 of a common resource block with the subcarrier spacing \n-\tprovided by the higher-layer parameter subCarrierSpacingCommon for operation without shared spectrum channel access in FR1 and FR2-1; and \n-\tsame as the subcarrier spacing of the SS/PBCH block for operation without shared spectrum access in FR2-2 and for operation with shared spectrum channel access. \n-\tThis common resource block overlaps with subcarrier 0 of the lowest-numbered resource block of the SS/PBCH block, or the SS/PBCH block after puncturing if applicable.\nThe UE may assume that SS/PBCH blocks transmitted with the same block index on the same center frequency location are quasi co-located with respect to Doppler spread, Doppler shift, average gain, average delay, delay spread, and, when applicable, spatial Rx parameters. The UE shall not assume quasi co-location for any other SS/PBCH block transmissions other than what is specified in [5, TS 38.213].\nFor cell search on a carrier with a channel bandwidth of 3 MHz, the UE is not expected to receive subcarriers 0 to 47 and 192 to 239 in any of the 4 OFDM symbols of the SS/PBCH block, where the remaining 12 resource blocks form the SS/PBCH block after puncturing.\nTable 7.4.3.1-1: Resources within an SS/PBCH block for PSS, SSS, PBCH, and DM-RS for PBCH. \n\n7.4.3.1.1\tMapping of PSS within an SS/PBCH block\nThe UE shall assume the sequence of symbols constituting the primary synchronization signal to be scaled by a factor  to conform to the PSS power allocation specified in [5, TS 38.213] and mapped to resource elements  in increasing order of  where  and  are given by Table 7.4.3.1-1 and represent the frequency and time indices, respectively, within one SS/PBCH block.\n7.4.3.1.2\tMapping of SSS within an SS/PBCH block\nThe UE shall assume the sequence of symbols  constituting the secondary synchronization signal to be scaled by a factor  and mapped to resource elements  in increasing order of  where  and  are given by Table 7.4.3.1-1 and represent the frequency and time indices, respectively, within one SS/PBCH block.\n7.4.3.1.3\tMapping of PBCH and DM-RS within an SS/PBCH block\nThe UE shall assume the sequence of complex-valued symbols  constituting the physical broadcast channel to be scaled by a factor  to conform to the PBCH power allocation specified in [5, TS 38.213] and mapped in sequence starting with  to resource elements  which meet all the following criteria:\n-\tthey are not used for PBCH demodulation reference signals\nThe mapping to resource elements  not reserved for PBCH DM-RS shall be in increasing order of first the index  and then the index , where  and  represent the frequency and time indices, respectively, within one SS/PBCH block and are given by Table 7.4.3.1-1.\nThe UE shall assume the sequence of complex-valued symbols  constituting the demodulation reference signals for the SS/PBCH block to be scaled by a factor of  to conform to the PBCH power allocation specified in [5, TS 38.213] and to be mapped to resource elements  in increasing order of first  and then  where  and  are given by Table 7.4.3.1-1 and represent the frequency and time indices, respectively, within one SS/PBCH block.\n7.4.3.2\tTime location of an SS/PBCH block\nThe locations in the time domain where a UE shall monitor for a possible SS/PBCH block are described in clause 4.1 of [5, TS 38.213].\n8\tSidelink\n8.1\tOverview\n8.1.1\tOverview of physical channels\nA sidelink physical channel corresponds to a set of resource elements carrying information originating from higher layers. The following sidelink physical channels are defined:\n-\tPhysical Sidelink Shared Channel, PSSCH\n-\tPhysical Sidelink Broadcast Channel, PSBCH\n-\tPhysical Sidelink Control Channel, PSCCH\n-\tPhysical Sidelink Feedback Channel, PSFCH\n8.1.2\tOverview of physical signals\nA sidelink physical signal corresponds to a set of resource elements used by the physical layer but does not carry information originating from higher layers. \nThe following sidelink physical signals are defined:\n-\tDemodulation reference signals, DM-RS\n-\tChannel-state information reference signal, CSI-RS\n-\tPhase-tracking reference signals, PT-RS\n-\tSidelink primary synchronization signal, S-PSS\n-\tSidelink secondary synchronization signal, S-SSS\n-\tSidelink positioning reference signal, SL PRS\n8.2\tPhysical resources\n8.2.1\tGeneral\nIn a shared SL PRS resource pool, the OFDM symbol immediately preceding the symbols which are configured for use by PSFCH if PSFCH is configured in this slot, and the last symbol configured for sidelink in a slot, serve as guard symbol(s). In a dedicated SL PRS resource pool, the last symbol configured for sidelink in a slot serves as a guard symbol. Otherwise, the OFDM symbol immediately following the last symbol used for PSSCH, PSFCH, or S-SSB serves as a guard symbol. \nThe first OFDM symbol of a PSSCH and its associated PSCCH is duplicated as described in clauses 8.3.1.5 and 8.3.2.3. The first OFDM symbol of a PSFCH is duplicated as described in clause 8.3.4.2.2.\nThe OFDM symbol immediately preceding an SL PRS transmission in a dedicated SL PRS resource pool is generated as described in clause 8.4.1.6.3.\n8.2.2\tNumerologies\nMultiple OFDM numerologies are supported as given by Table 8.2.2-1 where  and the cyclic prefix for a sidelink bandwidth part are obtained from the higher-layer parameter sl-BWP. \nTable 8.2.2-1: Supported transmission numerologies.\n\n8.2.3\tFrame structure\n8.2.3.1\tFrames and subframes\nThe frame and subframe structure for sidelink transmission is defined in clause 4.3.1.\n8.2.3.2\tSlots\nThe slot structure for sidelink transmission is defined in clause 4.3.2.\n8.2.4\tAntenna ports\nAn antenna port is defined in clause 4.4.1. \nThe following antenna ports are defined for the sidelink:\n-\tAntenna ports starting with 1000 for PSSCH\n-\tAntenna ports starting with 2000 for PSCCH\n-\tAntenna ports starting with 3000 for CSI-RS\n-\tAntenna ports starting with 4000 for S-SS/PSBCH block\n-\tAntenna ports starting with 5000 for PSFCH\n-\tAntenna ports starting with 6000 for SL PRS\nFor DM-RS associated with a PSBCH, the channel over which a PSBCH symbol on one antenna port is conveyed can be inferred from the channel over which a DM-RS symbol on the same antenna port is conveyed only if the two symbols are within a S-SS/PSBCH block transmitted within the same slot, and with the same block index according to clause 8.4.3.1. \nFor DM-RS associated with a PSSCH, the channel over which a PSSCH symbol on one antenna port is conveyed can be inferred from the channel over which a DM-RS symbol on the same antenna port is conveyed only if the two symbols are within the same frequency resource as the scheduled PSSCH and in the same slot. \nFor DM-RS associated with a PSCCH, the channel over which a PSCCH symbol on one antenna port is conveyed can be inferred from the channel over which a DM-RS symbol on the same antenna port is conveyed only if the two symbols are within the same frequency resource as the transmitted PSCCH and in the same slot.\n8.2.5\tResource grid\nThe resource grid for sidelink transmission is defined in clause 4.4.2.\nFor sidelink, the carrier bandwidth  and the starting position  for subcarrier spacing configuration  are obtained from the higher-layer parameter sl-SCS-SpecificCarrierList. \nFor the sidelink, the higher-layer parameter sl-TxDirectCurrentLocation indicates the location of the transmitter DC subcarrier in the sidelink for each of the configured bandwidth parts. Values in the range 0 \u2013 3299 represent the number of the DC subcarrier, the value 3300 indicates that the DC subcarrier is located outside the resource grid, and the value 3301 indicates that the position of the DC subcarrier in the sidelink is undetermined. The DC subcarrier location offset relative to the center of the indicated subcarrier is given by  if frequencyShift7p5khzSL is provided and by   otherwise, where  is given by the higher-layer parameter valueN.\n8.2.6\tResource elements\nResource elements are defined in clause 4.4.3.\n8.2.7\tResource blocks\nResource blocks are defined in clause 4.4.4.\nPoint A for sidelink transmission/reception is obtained from the higher-layer parameter sl-AbsoluteFrequencyPointA.\n8.2.8\tBandwidth part\nConfiguration of the single bandwidth part for sidelink transmission is described in clause 16 of [5, TS 38.213].\n8.3\tPhysical channels\n8.3.1\tPhysical sidelink shared channel\n8.3.1.1\tScrambling\nFor the single codeword , the block of bits , where  is the number of bits in codeword  transmitted on the physical channel as defined in [4, TS 38.212], shall be scrambled prior to modulation.\nScrambling shall be done according to the following pseudo code\nset  \nset \nwhile \nif \t// SCI placeholder bits\n \n \nelse\n\t \nend if \ni = i + 1\nend while\nwhere the scrambling sequence  is given by clause 5.2.1 and\n-\tfor \n-\t\n-\tThe scrambling sequence generator shall be initialized with\n\n\twhere  and the quantity  equals the decimal representation of the CRC on the PSCCH associated with the PSSCH according to  with  and  given by clause 8.3.2 in [4, TS 38.212].\n-\tfor \n-\t\n-\tThe scrambling sequence generator shall be initialized with\n\n\twhere  and the quantity  equals the decimal representation of the CRC on the PSCCH associated with the PSSCH according to  with  and  given by clause 8.3.2 in [4, TS 38.212].\n8.3.1.2\tModulation\nFor the single codeword , the block of scrambled bits shall be modulated, resulting in a block of complex-valued modulation symbols  where .\nModulation for  shall be done as described in clause 5.1 using QPSK, where .\nModulation for   shall be done as described in clause 5.1 using one of the modulation schemes in Table 8.3.1.2-1 where .\nTable 8.3.1.2-1: Supported modulation schemes.\n\n8.3.1.3\tLayer mapping\nLayer mapping shall be done according to clause 7.3.1.3 with the number of layers , resulting in , .\n8.3.1.4\tPrecoding\nThe block of vectors  shall be precoded according to clasue 6.3.1.5 where the precoding matrix  equals the identity matrix and .\n8.3.1.5\tMapping to virtual resource blocks\nFor each of the antenna ports used for transmission of the PSSCH, the block of complex-valued symbols  shall be multiplied with the amplitude scaling factor   in order to conform to the transmit power specified in [5, TS 38.213] and mapped to resource elements  in the virtual resource blocks assigned for transmission, where  is the first subcarrier in the lowest-numbered virtual resource block assigned for transmission.\nThe mapping operation shall be done in two steps:\n-\tfirst, the complex-valued symbols corresponding to the bit for the 2nd-stage SCI in increasing order of first the index  over the assigned virtual resource blocks and then the index , starting from the first PSSCH symbol carrying an associated DM-RS and meeting all of the following criteria:\n-\tthe corresponding resource elements in the corresponding physical resource blocks are not used for transmission of the associated DM-RS, PT-RS, or PSCCH;\n-\tsecondly, the complex-valued modulation symbols not corresponding to the 2nd -stage SCI shall be in increasing order of first the index  over the assigned virtual resource blocks, and then the index  with the starting position given by [6, TS 38.214] and meeting all of the following criteria:\n-\tthe resource elements are not used for 2nd-stage SCI in the first step; \n-\tthe resource elements are not in the  symbols used for transmission of the associated SL PRS according to clause 8.2.4.1.1 of [6, TS 38.214];\n-\tthe corresponding resource elements in the corresponding physical resource blocks are not used for transmission of the associated DM-RS, PT-RS, CSI-RS, or PSCCH.\nThe resource elements used for the PSSCH in the first OFDM symbol in the mapping operation above, including any DM-RS, PT-RS, or CSI-RS occurring in the first OFDM symbol, shall be duplicated in the OFDM symbol immediately preceding the first OFDM symbol in the mapping.\n8.3.1.6\tMapping from virtual to physical resource blocks\nVirtual resource blocks shall be mapped to physical resource blocks according to non-interleaved mapping.\nFor non-interleaved VRB-to-PRB mapping, virtual resource block  is mapped to physical resource block .\n8.3.2\tPhysical sidelink control channel\n8.3.2.1\tScrambling\nThe block of bits , where  is the number of bits transmitted on the physical channel, shall be scrambled prior to modulation, resulting in a block of scrambled bits  according to\n\nwhere the scrambling sequence  is given by clause 5.2.1. The scrambling sequence generator shall be initialized with \n\n8.3.2.2\tModulation\nThe block of scrambled bits  shall be modulated as described in clause\u00a05.1 using QPSK, resulting in a block of complex-valued modulation symbols  where . \n8.3.2.3\tMapping to physical resources\nThe set of complex-valued modulation symbols   shall be multiplied with the amplitude scaling factor  in order to conform to the transmit power specified in [5, TS 38.213] and mapped in sequence starting with  to resource elements  assigned for transmission according to clause 16.4 of [5, TS 38.213], and not used for the demodulation reference signals associated with PSCCH, in increasing order of first the index  over the assigned physical resources, and then the index  on antenna port. \nThe resource elements used for the PSCCH in the first OFDM symbol in the mapping operation above, including any DM-RS, PT-RS, or CSI-RS occurring in the first OFDM symbol, shall be duplicated in the immediately preceding OFDM symbol.\n8.3.3\tPhysical sidelink broadcast channel\n8.3.3.1\tScrambling\nThe block of bits, where  is the number of bits transmitted on the physical sidelink broadcast channel, shall be scrambled prior to modulation, resulting in a block of scrambled bits  according to\n\nwhere the scrambling sequence  is given by clause 5.2.1. The scrambling sequence generator shall be initialized with  at the start of each S-SS/PSBCH block.\n8.3.3.2\tModulation\nThe block of bits  shall be QPSK modulated as described in clause\u00a05.1.3, resulting in a block of complex-valued modulation symbols  where . \n8.3.3.3\tMapping to physical resources\nMapping to physical resources is described in clause 8.4.3.\n8.3.4\tPhysical sidelink feedback channel\n8.3.4.1\tGeneral\n8.3.4.2\tPSFCH format 0\n8.3.4.2.1\tSequence generation\nThe sequence  shall be generated according to\n\n\nwhere  is given by clause 6.3.2.2 with the following exceptions:\n-\t is given by clause 16.3 of [5, TS 38.213]; \n-\t is given by clause 16.3 of [5, TS 38.213];\n-\t is given by\n-\t if the higher-layer parameter sl-PSFCH-Type is configured and set to 'type1' and where  is the resource block number within the interlace;\n-\t otherwise\n-\t;\n-\t is the index of the OFDM symbol in the slot that corresponds to the second OFDM symbol of the PSFCH transmission in the slot given by [5, TS 38.213];\n-\t and  with  given by the higher-layer parameter sl-PSFCH-HopID if configured; otherwise, .\n-\t with  given by the higher-layer parameter sl-PSFCH-HopID if configured; otherwise, .\n8.3.4.2.2\tMapping to physical resources\nThe sequence  shall be multiplied with the amplitude scaling factor  in order to conform to the transmit power specified in [5, TS 38.213] and mapped in sequence starting with  to resource elements  assigned for transmission of the second PSFCH symbol according to clause 16.3 of [5, TS 38.213] in increasing order of the index  over the assigned physical resources on antenna port. \nThe resource elements used for the PSFCH in the OFDM symbol in the mapping operation above shall be duplicated in the immediately preceding OFDM symbol.\nIf the higher-layer parameter sl-PSFCH-Type is configured and set to \u2018type1\u2019, the mapping operation shall be repeated for each resource block in the interlace and in the RB set over the assigned physical resource blocks according to clause 16.3 of [5, TS 38.213], with the resource-block dependent sequence generated according to clause 8.3.4.2.1.\nIf the higher-layer parameter sl-PSFCH-Type is configured and set to \u2018type2\u2019, the mapping operation shall be repeated for each resource block assigned for transmission of the common interlace and for PSFCH transmission with HARQ-ACK information over the assigned physical resource according to clause 16.3 of [5, TS 38.213], with the resource-block dependent sequence generated according to clause 8.3.4.2.1, where the cyclic shift  on each resource block assigned for transmission of the common interlace is up to UE implementation.\n8.4\tPhysical signals\n8.4.1\tReference signals\n8.4.1.1\tDemodulation reference signals for PSSCH\n8.4.1.1.1\tSequence generation\nThe sequence  shall be generated according to\n\nwhere the pseudo-random sequence  is defined in clause 5.2.1. The pseudo-random sequence generator shall be initialized with\n\nwhere  is the OFDM symbol number within the slot,  is the slot number within a frame, and  where the quantity  equals the decimal representation of CRC on the PSCCH associated with the PSSCH according to  with  and  given by clause 7.3.2 in [4, TS 38.212].\n8.4.1.1.2\tMapping to physical resources\nThe sequence  shall be mapped to the intermediate quantity  according to clause 6.4.1.1.3 using configuration type 1 without transform precoding, and where , , and  are given by Table 8.4.1.1.2-2, and  is specified in clause 8.4.1.1.1.\nThe patterns used for the PSSCH DM-RS is indicated in the SCI as described in clause 8.3.1.1 of [4, TS 38.212].\nThe intermediate quantity  shall be precoded, multiplied with the amplitude scaling factor  specified in clause 8.3.1.5, and mapped to physical resources according to\n\nwhere \n-\tthe precoding matrix  is given by clause 8.3.1.4, \n-\tthe set of antenna ports  is given by clause 8.3.1.4, and\n-\tthe set of antenna ports  is given by [6, TS 38.214];\nand the following conditions are fulfilled:\n-\tthe resource elements  are within the common resource blocks allocated for PSSCH transmission.\nThe quantity  is defined relative to subcarrier 0 in common resource block 0 and the quantity  is defined relative to the start of the scheduled resources for transmission of PSSCH and the associated PSCCH, including the OFDM symbol duplicated as described in clauses 8.3.1.5 and 8.3.2.3.\nThe position(s) of the DM-RS symbols is given by  according to Table 8.4.1.1.2-1 where the number of PSSCH DM-RS is indicated in the SCI, and  is the duration of the scheduled resources for transmission of PSSCH according to clause 8.1.2.1 of [6, TS 38.214] and the associated PSCCH, including the OFDM symbol duplicated as described in clauses 8.3.1.5 and 8.3.2.3.\nTable 8.4.1.1.2-1: PSSCH DM-RS time-domain location.\n\nTable 8.4.1.1.2-2: Parameters for PSSCH DM-RS.\n\n8.4.1.2\tPhase-tracking reference signals for PSSCH\n8.4.1.2.1\tSequence generation \nThe precoded sidelink phase-tracking reference signal for subcarrier  on layer  is given by\n\nwhere\n-\tantenna ports  or  associated with PT-RS transmission are given by clause 8.2.3 of [6, TS 38.214];\n-\t is given by clause 8.4.1.1.1 at the position of the first PSSCH symbol carrying an associated DM-RS.\n8.4.1.2.2\tMapping to physical resources\nThe UE shall transmit phase-tracking reference signals only in the resource blocks used for the PSSCH, and only if the procedure in [6, TS 38.214] indicates that phase-tracking reference signals are being used.\nThe PSSCH PT-RS shall be mapped to resource elements according to\n\t\n\nwhen all the following conditions are fulfilled\n-\t is within the OFDM symbols allocated for the PSSCH transmission;\n-\tresource element  is not used for PSCCH, nor DM-RS associated with PSSCH;\n-\t and  correspond to \nThe precoding matrix  is given by clause 8.3.1.4. \nThe set of time indices \u00a0defined relative to the start of the PSSCH allocation is defined by\n1. set and \n2. if any symbol in the interval  overlaps with a symbol used for DM-RS according to clause 8.4.1.1.2\n-\tset \n-\tset  to the symbol index of the DM-RS symbol\n-\trepeat from step 2 as long as  is inside the PSSCH allocation\n3. add  to the set of time indices for PT-RS\n4. increment  by one\n5. repeat from step 2 above as long as  is inside the PSSCH allocation\nwhere  is given by clause 8.4.3 of [6, TS 38.214].\nFor the purpose of PT-RS mapping, the resource blocks allocated for PSSCH transmission are numbered from 0 to  from the lowest scheduled resource block to the highest. The corresponding subcarriers in this set of resource blocks are numbered in increasing order starting from the lowest frequency from 0 to . The subcarriers to which the PT-RS shall be mapped are given by\n\nwhere\n-\t\n-\t is given by Table 8.4.1.2.2-1 for the DM-RS port associated with the PT-RS port according to clause 8.2.3 in [6, TS 38.214]. \n-\t is the number of resource blocks scheduled;\n-\t is given by [6, TS 38.214];\n-\t where the quantity  equals the decimal representation of CRC on the PSCCH associated with the PSSCH according to  with  and  given by clause 7.3.2 in [4, TS 38.212].\nPSSCH PT-RS shall not be mapped to resource elements containing PSCCH or PSCCH DMRS by puncturing PSSCH PT-RS.\nA UE is not expected to receive sidelink CSI-RS and PSSCH PT-RS on the same resource elements.\n\nTable 8.4.1.2.2-1: The parameter  .\n\n8.4.1.3\tDemodulation reference signals for PSCCH\n8.4.1.3.1\tSequence generation\nThe sequence  shall be generated according to\n\nwhere the pseudo-random sequence  is defined in clause 5.2.1. The pseudo-random sequence generator shall be initialized with\n\nwhere \n-\t is the OFDM symbol number within the slot, \n-\t is the slot number within a frame, and\n-\t is given by the higher-layer parameter sl-DMRS-ScrambleID.\n8.4.1.3.2\tMapping to physical resources\nThe sequence  shall be multiplied with the amplitude scaling factor  in order to conform to the transmit power specified in [5, 38.213] and mapped in sequence starting with  to resource elements  in a slot on antenna port  according to\n\nwhere the following conditions are fulfilled\n-\tthey are within the resource elements constituting the PSCCH \nThe quantity  is given by Table 8.4.1.3.2-1 and  shall be randomly selected by the UE.\nThe reference point for  is subcarrier 0 in common resource block 0.\nThe quantity  is the OFDM symbol number within the slot. \nTable 8.4.1.3.2-1: The quantity .\n\n8.4.1.4\tDemodulation reference signals for PSBCH\n8.4.1.4.1\tSequence generation\nThe reference-signal sequence  for an S-SS/PSBCH block is defined by\n\nwhere  is given by clause 5.2. The scrambling sequence generator shall be initialized at the start of each S-SS/PSBCH block occasion with \n\n8.4.1.4.2\tMapping to physical resources\nMapping to physical resources is described in clause 8.4.3.\n8.4.1.5\tCSI reference signals\n8.4.1.5.1\tGeneral\n8.4.1.5.2\tSequence generation\nThe sequence  shall be generated according to\n\nwhere the pseudo-random sequence  is defined in clause 5.2.1. The pseudo-random sequence generator shall be initialised with\n\nat the start of each OFDM symbol where  is the slot number within a radio frame,  is the OFDM symbol number within a slot, and  where the quantity  equals the decimal representation of CRC for the sidelink control information mapped to the PSCCH associated with the CSI-RS according to  with  and  given by clause 7.3.2 in [4, TS 38.212].\n8.4.1.5.3\tMapping to physical resources\nMapping to resource elements shall be done according to clause 7.4.1.5.3 with the following exceptions:\n-\tonly 1 and 2 antenna ports are supported, ;\n-\tonly density  is supported;\n-\tzero-power CSI-RS is not supported; \n-\tthe quantity  is an amplitude scaling factor to conform with the transmit power specified in clause 8.2.1 of [6, TS 38.214].\n8.4.1.6\tPositioning reference signals\n8.4.1.6.1\tGeneral\nA SL PRS resource refers to a time-frequency resource within a slot, used for SL PRS transmission.\n8.4.1.6.2\tSequence generation\nThe sequence  is defined by\n\nwhere the pseudo-random sequence  is defined in clause 5.2.1. The pseudo-random sequence generator shall be initialised with\n\nwhere\n-\t is the slot number within the radio frame\n-\t is the OFDM symbol number within the slot to which the sequence is mapped\n-\t is the sidelink PRS sequence ID, which, if not provided by higher layers, is obtained from the decimal representation of the CRC for the sidelink control information mapped to the PSCCH associated with the SL PRS according to  with  and  given by clause 7.3.2 in [4, TS 38.212].\n8.4.1.6.3\tMapping to physical resources\nThe sequence shall be multiplied with the amplitude scaling factor  in order to conform to the transmit power specified in [5, TS 38.213] and mapped to resources elements  according to \n\nwhen the following conditions are fulfilled:\n-\tthe resource element  is within the common resource blocks occupied by the SL PRS resource\nand where\n-\tthe comb size  is provided by the higher layer parameter nCombSize\n-\tthe resource-element offset  \n-\tthe frequency offset  is given by Table 8.4.1.6.3-1\n-\tthe starting symbol  is provided by the higher-layer parameter sl-PRS-starting-symbol for a dedicated SL PRS resource pool, or is determined such that the symbols {} are mapped to the last consecutive  symbols in the slot that can be used for SL PRS for a shared SL PRS resource pool as described in clause 8.2.4.1.1 in [6, TS38.214]\n-\tthe number of symbols  is provided by the higher-layer parameter mNumberOfSymbols and limited to combinations  fulfilling \n-\tin a dedicated SL PRS resource pool: {1, 2}, {2, 2}, {2, 4}, {4, 4}, {6, 6}, and combinations with  and  where  \n-\tin a shared SL PRS resource pool:{1, 1}, {1, 2}, {2, 1}, {2, 2}, {2, 4}, {4, 1}, {4, 2}, {4, 4}\n-\tthe antenna port \nThe reference point for  is subcarrier 0 in common resource block 0.\nFor transmission of an SL PRS in a dedicated SL PRS resource pool, the content of the OFDM symbol immediately preceding the SL PRS resource shall be generated based on 8.4.1.6.2 and mapped to resource elements with\n-\tthe time-domain index  \n-\tthe set of frequency-domain indices  shall be identical to those of the last OFDM symbol in the SL PRS resource \n-\tthe amplitude scaling factor shall be same as the amplitude scaling factor  of the SL PRS resource.\n\nTable 8.4.1.6.3-1: The frequency offset  as a function of .\n\n8.4.2\tSynchronization signals\n8.4.2.1\tPhysical-layer sidelink synchronization identities\nThere are 672 unique physical-layer sidelink synchronization identities given by\n\t\nwhere  and . The sidelink synchronization identities are divided into two sets, id_net consisting of  and id_oon consisting of .\n8.4.2.2\tSidelink primary synchronization signal\n8.4.2.2.1\tSequence generation\nThe sequence  for the sidelink primary synchronization signal is defined by \n\nwhere \n\nand\n\n8.4.2.2.2\tMapping to physical resources\nMapping to physical resources is described in clause 8.4.3.\n8.4.2.3\tSidelink secondary synchronization signal\n8.4.2.3.1\tSequence generation\nThe sequence  for the sidelink secondary synchronization signal is defined by \n\nwhere\n\nand\n\n8.4.2.3.2\tMapping to physical resources\nMapping to physical resources is described in clause 8.4.3.\n8.4.3\tS-SS/PSBCH block\n8.4.3.1\tTime-frequency structure of an S-SS/PSBCH block\nIn the time domain, an S-SS/PSBCH block consists of  OFDM symbols, numbered in increasing order from 0 to  within the S-SS/PSBCH block, where S-PSS, S-SSS, and PSBCH with associated DM-RS are mapped to symbols as given by Table 8.4.3.1-1. The number of OFDM symbols in an S-SS/PSBCH block  for normal cyclic prefix and  for extended cyclic prefix. The first OFDM symbol in an S-SS/PSBCH block is the first OFDM symbol in the slot.\nIn the frequency domain, an S-SS/PSBCH block consists of 132 contiguous subcarriers with the subcarriers numbered in increasing order from 0 to 131 within the sidelink S-SS/PSBCH block. The quantities  and  represent the frequency and time indices, respectively, within one sidelink S-SS/PSBCH block. \nFor an S-SS/PSBCH block, the UE shall use \n-\tantenna port 4000 for transmission of S-PSS, S-SSS, PSBCH and DM-RS for PSBCH;\n-\tthe same cyclic prefix length and subcarrier spacing for the S-PSS, S-SSS, PSBCH and DM-RS for PSBCH,\n\nTable 8.4.3.1-1: Resources within an S-SS/PSBCH block for S-PSS, S-SSS, PSBCH, and DM-RS. \n\n8.4.3.1.1\tMapping of S-PSS within an S-SS/PSBCH block\nThe sequence of symbols  constituting the sidelink primary synchronization signal in one OFDM symbol shall be scaled by a factor  to conform to the S-PSS power allocation specified in [5, TS 38.213] and mapped to resource elements  in increasing order of  in each of the symbols , where  and  are given by Table 8.4.3.1-1 and represent the frequency and time indices, respectively, within one S-SS/PSBCH block.\n8.4.3.1.2\tMapping of S-SSS within an S-SS/PSBCH block\nThe sequence of symbols  constituting the sidelink secondary synchronization signal in one OFDM symbol shall be scaled by a factor  to conform to the S-SSS power allocation specified in [5, TS 38.213] and mapped to resource elements  in increasing order of  in each of the symbols , where  and  are given by Table 8.4.3.1-1 and represent the frequency and time indices, respectively, within one S-SS/PSBCH block.\n8.4.3.1.3\tMapping of PSBCH and DM-RS within an S-SS/PSBCH block\nThe sequence of complex-valued symbols  constituting the physical sidelink broadcast channel shall be scaled by a factor  to conform to the PSBCH power allocation specified in [5, TS 38.213] and mapped in sequence starting with  to resource elements  which meet all the following criteria:\n-\tthey are not used for PSBCH demodulation reference signals\nThe mapping to resource elements  not reserved for PSBCH DM-RS shall be in increasing order of first the index  and then the index, where  and  represent the frequency and time indices, respectively, within one S-SS/PSBCH block and are given by Table 8.4.3.1-1.\nThe sequence of complex-valued symbols  constituting the demodulation reference signals for the S-SS/PSBCH block shall be scaled by a factor of  to conform to the PSBCH power allocation specified in [5, TS 38.213] and mapped to resource elements  in increasing order of first  and then  where  and  are given by Table 8.4.3.1-1 and represent the frequency and time indices, respectively, within one S-SS/PSBCH block.\n8.4.3.2\tTime location of an S-SS/PSBCH block\nThe locations in the time domain where a UE shall monitor for a possible S-SS/PSBCH block are described in clause 16.1  of [5, TS 38.213].\n8.5\tTiming\nTransmission of a sidelink radio frame number  from the UE shall start  seconds before the start of the corresponding timing reference frame at the UE. The UE is not required to receive sidelink or downlink transmissions earlier than the value of , which is given in [12, TS 38.133], after the end of a sidelink transmission.\nFor sidelink transmissions:\nIf the UE has a serving cell fulfilling the S criterion according to clause 8.2 of [13, TS 38.304]\n-\tThe timing of reference radio frame  equals that of downlink radio frame  in the cell with the same uplink carrier frequency as the sidelink and\n-\t is given by clause 4.3.1 of [TS 38.211],\nOtherwise \n-\tThe timing of reference radio frame i and  value are given by clause 12.2.2, 12.2.3, 12.2.4 or 12.2.5 of [12, TS 38.133]. \n\nFigure 8.5-1: Sidelink timing relation\nThe quantity  equals to 0.\n\nAnnex A:\nChange history\n\n",
    "metadata": {
        "title0": "3GPP TS 38.211",
        "title1": "Technical Specification Group Radio Access Network",
        "title2": "NR",
        "title3": "Physical channels and modulation",
        "Release": 18,
        "Version": "V18.2.0",
        "Publish_time": "2024-03"
    }
}